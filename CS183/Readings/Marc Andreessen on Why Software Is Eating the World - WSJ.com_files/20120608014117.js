/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.manager"]){dojo._hasResource["dijit._base.manager"]=true;dojo.provide("dijit._base.manager");dojo.declare("dijit.WidgetSet",null,{constructor:function(){this._hash={};this.length=0},add:function(b){if(this._hash[b.id])throw Error("Tried to register widget with id=="+b.id+" but that id is already registered");this._hash[b.id]=b;this.length++},remove:function(b){if(this._hash[b]){delete this._hash[b];this.length--}},forEach:function(b,c){c=c||dojo.global;var f=0,e;
for(e in this._hash)b.call(c,this._hash[e],f++,this._hash);return this},filter:function(b,c){c=c||dojo.global;var f=new dijit.WidgetSet,e=0,m;for(m in this._hash){var n=this._hash[m];b.call(c,n,e++,this._hash)&&f.add(n)}return f},byId:function(b){return this._hash[b]},byClass:function(b){var c=new dijit.WidgetSet,f,e;for(f in this._hash){e=this._hash[f];e.declaredClass==b&&c.add(e)}return c},toArray:function(){var b=[],c;for(c in this._hash)b.push(this._hash[c]);return b},map:function(b,c){return dojo.map(this.toArray(),
b,c)},every:function(b,c){c=c||dojo.global;var f=0,e;for(e in this._hash)if(!b.call(c,this._hash[e],f++,this._hash))return false;return true},some:function(b,c){c=c||dojo.global;var f=0,e;for(e in this._hash)if(b.call(c,this._hash[e],f++,this._hash))return true;return false}});(function(){dijit.registry=new dijit.WidgetSet;var b=dijit.registry._hash,c=dojo.attr,f=dojo.hasAttr,e=dojo.style;dijit.byId=function(a){return typeof a=="string"?b[a]:a};var m={};dijit.getUniqueId=function(a){var d;do d=a+
"_"+(a in m?++m[a]:m[a]=0);while(b[d]);return dijit._scopeName=="dijit"?d:dijit._scopeName+"_"+d};dijit.findWidgets=function(a){function d(h){for(h=h.firstChild;h;h=h.nextSibling)if(h.nodeType==1){var j=h.getAttribute("widgetId");if(j)(j=b[j])&&i.push(j);else d(h)}}var i=[];d(a);return i};dijit._destroyAll=function(){dijit._curFocus=null;dijit._prevFocus=null;dijit._activeStack=[];dojo.forEach(dijit.findWidgets(dojo.body()),function(a){if(!a._destroyed)if(a.destroyRecursive)a.destroyRecursive();else a.destroy&&
a.destroy()})};dojo.isIE&&dojo.addOnWindowUnload(function(){dijit._destroyAll()});dijit.byNode=function(a){return b[a.getAttribute("widgetId")]};dijit.getEnclosingWidget=function(a){for(;a;){var d=a.getAttribute&&a.getAttribute("widgetId");if(d)return b[d];a=a.parentNode}return null};var n=dijit._isElementShown=function(a){var d=e(a);return d.visibility!="hidden"&&d.visibility!="collapsed"&&d.display!="none"&&c(a,"type")!="hidden"};dijit.hasDefaultTabStop=function(a){switch(a.nodeName.toLowerCase()){case "a":return f(a,
"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return true;case "iframe":var d;try{var i=a.contentDocument;if("designMode"in i&&i.designMode=="on")return true;d=i.body}catch(h){try{d=a.contentWindow.document.body}catch(j){return false}}return d.contentEditable=="true"||d.firstChild&&d.firstChild.contentEditable=="true";default:return a.contentEditable=="true"}};var t=dijit.isTabNavigable=function(a){return c(a,"disabled")?false:f(a,"tabIndex")?c(a,"tabIndex")>=
0:dijit.hasDefaultTabStop(a)};dijit._getTabNavigable=function(a){function d(l){return l&&l.tagName.toLowerCase()=="input"&&l.type&&l.type.toLowerCase()=="radio"&&l.name&&l.name.toLowerCase()}var i,h,j,q,p,r,o={},s=function(l){dojo.query("> *",l).forEach(function(g){if(!(dojo.isIE&&g.scopeName!=="HTML"||!n(g))){if(t(g)){var k=c(g,"tabIndex");if(!f(g,"tabIndex")||k==0){i||(i=g);h=g}else if(k>0){if(!j||k<q){q=k;j=g}if(!p||k>=r){r=k;p=g}}k=d(g);if(dojo.attr(g,"checked")&&k)o[k]=g}g.nodeName.toUpperCase()!=
"SELECT"&&s(g)}})};n(a)&&s(a);return{first:o[d(i)]||i,last:o[d(h)]||h,lowest:o[d(j)]||j,highest:o[d(p)]||p}};dijit.getFirstInTabbingOrder=function(a){a=dijit._getTabNavigable(dojo.byId(a));return a.lowest?a.lowest:a.first};dijit.getLastInTabbingOrder=function(a){a=dijit._getTabNavigable(dojo.byId(a));return a.last?a.last:a.highest};dijit.defaultDuration=dojo.config.defaultDuration||200})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.typematic"]){dojo._hasResource["dijit._base.typematic"]=true;dojo.provide("dijit._base.typematic");dijit.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(this._currentTimeout<0?this._initialDelay:this._subsequentDelay>1?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(dojo.hitch(this,"_fireEventAndReload"),
this._currentTimeout)},trigger:function(c,a,h,f,e,g,d,b){if(e!=this._obj){this.stop();this._initialDelay=d||500;this._subsequentDelay=g||0.9;this._minDelay=b||10;this._obj=e;this._evt=c;this._node=h;this._count=this._currentTimeout=-1;this._callback=dojo.hitch(a,f);this._fireEventAndReload();this._evt=dojo.mixin({faux:true},c)}},stop:function(){if(this._timer){clearTimeout(this._timer);this._timer=null}if(this._obj){this._callback(-1,this._node,this._evt);this._obj=null}},addKeyListener:function(c,
a,h,f,e,g,d){if(a.keyCode){a.charOrCode=a.keyCode;dojo.deprecated("keyCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0")}else if(a.charCode){a.charOrCode=String.fromCharCode(a.charCode);dojo.deprecated("charCode attribute parameter for dijit.typematic.addKeyListener is deprecated. Use charOrCode instead.","","2.0")}return[dojo.connect(c,"onkeypress",this,function(b){if(b.charOrCode==a.charOrCode&&(a.ctrlKey===undefined||a.ctrlKey==b.ctrlKey)&&
(a.altKey===undefined||a.altKey==b.altKey)&&(a.metaKey===undefined||a.metaKey==(b.metaKey||false))&&(a.shiftKey===undefined||a.shiftKey==b.shiftKey)){dojo.stopEvent(b);dijit.typematic.trigger(b,h,c,f,a,e,g,d)}else dijit.typematic._obj==a&&dijit.typematic.stop()}),dojo.connect(c,"onkeyup",this,function(){dijit.typematic._obj==a&&dijit.typematic.stop()})]},addMouseListener:function(c,a,h,f,e,g){var d=dojo.connect;return[d(c,"mousedown",this,function(b){dojo.stopEvent(b);dijit.typematic.trigger(b,a,
c,h,c,f,e,g)}),d(c,"mouseup",this,function(b){dojo.stopEvent(b);dijit.typematic.stop()}),d(c,"mouseout",this,function(b){dojo.stopEvent(b);dijit.typematic.stop()}),d(c,"mousemove",this,function(b){b.preventDefault()}),d(c,"dblclick",this,function(b){dojo.stopEvent(b);if(dojo.isIE){dijit.typematic.trigger(b,a,c,h,c,f,e,g);setTimeout(dojo.hitch(this,dijit.typematic.stop),50)}})]},addListener:function(c,a,h,f,e,g,d,b){return this.addKeyListener(a,h,f,e,g,d,b).concat(this.addMouseListener(c,f,e,g,d,b))}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.wai"]){dojo._hasResource["dijit._base.wai"]=true;dojo.provide("dijit._base.wai");dijit.wai={onload:function(){var a=dojo.create("div",{id:"a11yTestNode",style:{cssText:'border: 1px solid;border-color:red green;position: absolute;height: 5px;top: -999px;background-image: url("'+(dojo.config.blankGif||dojo.moduleUrl("dojo","resources/blank.gif"))+'");'}},dojo.body()),b=dojo.getComputedStyle(a);if(b){var c=b.backgroundImage;dojo[b.borderTopColor==b.borderRightColor||
c!=null&&(c=="none"||c=="url(invalid-url:)")?"addClass":"removeClass"](dojo.body(),"dijit_a11y");if(dojo.isIE)a.outerHTML="";else dojo.body().removeChild(a)}}};if(dojo.isIE||dojo.isMoz)dojo._loaders.unshift(dijit.wai.onload);dojo.mixin(dijit,{hasWaiRole:function(a,b){var c=this.getWaiRole(a);return b?c.indexOf(b)>-1:c.length>0},getWaiRole:function(a){return dojo.trim((dojo.attr(a,"role")||"").replace("wairole:",""))},setWaiRole:function(a,b){dojo.attr(a,"role",b)},removeWaiRole:function(a,b){var c=
dojo.attr(a,"role");if(c)if(b){c=dojo.trim((" "+c+" ").replace(" "+b+" "," "));dojo.attr(a,"role",c)}else a.removeAttribute("role")},hasWaiState:function(a,b){return a.hasAttribute?a.hasAttribute("aria-"+b):!!a.getAttribute("aria-"+b)},getWaiState:function(a,b){return a.getAttribute("aria-"+b)||""},setWaiState:function(a,b,c){a.setAttribute("aria-"+b,c)},removeWaiState:function(a,b){a.removeAttribute("aria-"+b)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Contained"]){dojo._hasResource["dijit._Contained"]=true;dojo.provide("dijit._Contained");dojo.declare("dijit._Contained",null,{getParent:function(){var a=dijit.getEnclosingWidget(this.domNode.parentNode);return a&&a.isContainer?a:null},_getSibling:function(a){var b=this.domNode;do b=b[a+"Sibling"];while(b&&b.nodeType!=1);return b&&dijit.byNode(b)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},
getIndexInParent:function(){var a=this.getParent();if(!a||!a.getIndexOfChild)return-1;return a.getIndexOfChild(this)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Container"]){dojo._hasResource["dijit._Container"]=true;dojo.provide("dijit._Container");dojo.declare("dijit._Container",null,{isContainer:true,buildRendering:function(){this.inherited(arguments);if(!this.containerNode)this.containerNode=this.domNode},addChild:function(a,b){var c=this.containerNode;if(b&&typeof b=="number"){var d=this.getChildren();if(d&&d.length>=b){c=d[b-1].domNode;b="after"}}dojo.place(a.domNode,c,b);this._started&&!a._started&&a.startup()},removeChild:function(a){if(typeof a==
"number")a=this.getChildren()[a];if(a)(a=a.domNode)&&a.parentNode&&a.parentNode.removeChild(a)},hasChildren:function(){return this.getChildren().length>0},destroyDescendants:function(a){dojo.forEach(this.getChildren(),function(b){b.destroyRecursive(a)})},_getSiblingOfChild:function(a,b){var c=a.domNode,d=b>0?"nextSibling":"previousSibling";do c=c[d];while(c&&(c.nodeType!=1||!dijit.byNode(c)));return c&&dijit.byNode(c)},getIndexOfChild:function(a){return dojo.indexOf(this.getChildren(),a)},startup:function(){if(!this._started){dojo.forEach(this.getChildren(),
function(a){a.startup()});this.inherited(arguments)}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._CssStateMixin"]){dojo._hasResource["dijit._CssStateMixin"]=true;dojo.provide("dijit._CssStateMixin");dojo.declare("dijit._CssStateMixin",[],{cssStateNodes:{},hovering:false,active:false,_applyAttributes:function(){this.inherited(arguments);dojo.forEach(["onmouseenter","onmouseleave","onmousedown"],function(b){this.connect(this.domNode,b,"_cssMouseEvent")},this);dojo.forEach(["disabled","readOnly","checked","selected","focused","state","hovering","active"],function(b){this.watch(b,
dojo.hitch(this,"_setStateClass"))},this);for(var a in this.cssStateNodes)this._trackMouseState(this[a],this.cssStateNodes[a]);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseenter":case "mouseover":this._set("hovering",true);this._set("active",this._mouseDown);break;case "mouseleave":case "mouseout":this._set("hovering",false);this._set("active",false);break;case "mousedown":this._set("active",true);this._mouseDown=true;var b=this.connect(dojo.body(),
"onmouseup",function(){this._mouseDown=false;this._set("active",false);this.disconnect(b)})}},_setStateClass:function(){function a(c){b=b.concat(dojo.map(b,function(e){return e+c}),"dijit"+c)}var b=this.baseClass.split(" ");this.isLeftToRight()||a("Rtl");this.checked&&a("Checked");this.state&&a(this.state);this.selected&&a("Selected");if(this.disabled)a("Disabled");else if(this.readOnly)a("ReadOnly");else if(this.active)a("Active");else this.hovering&&a("Hover");this._focused&&a("Focused");var d=
this.stateNode||this.domNode,f={};dojo.forEach(d.className.split(" "),function(c){f[c]=true});"_stateClasses"in this&&dojo.forEach(this._stateClasses,function(c){delete f[c]});dojo.forEach(b,function(c){f[c]=true});var g=[],h;for(h in f)g.push(h);d.className=g.join(" ");this._stateClasses=b},_trackMouseState:function(a,b){function d(){var i="disabled"in c&&c.disabled||"readonly"in c&&c.readonly;dojo.toggleClass(a,b+"Hover",f&&!g&&!i);dojo.toggleClass(a,b+"Active",g&&!i);dojo.toggleClass(a,b+"Focused",
h&&!i)}var f=false,g=false,h=false,c=this,e=dojo.hitch(this,"connect",a);e("onmouseenter",function(){f=true;d()});e("onmouseleave",function(){g=f=false;d()});e("onmousedown",function(){g=true;d()});e("onmouseup",function(){g=false;d()});e("onfocus",function(){h=true;d()});e("onblur",function(){h=false;d()});this.watch("disabled",d);this.watch("readOnly",d)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(b){this.pairs=[];this.returnWrappers=b||false};dojo.extend(dojo.AdapterRegistry,{register:function(b,a,c,d,e){this.pairs[e?"unshift":"push"]([b,a,c,d])},match:function(){for(var b=0;b<this.pairs.length;b++){var a=this.pairs[b];if(a[1].apply(this,arguments))return a[3]||this.returnWrappers?a[2]:a[2].apply(this,arguments)}throw Error("No match found");
},unregister:function(b){for(var a=0;a<this.pairs.length;a++)if(this.pairs[a][0]==b){this.pairs.splice(a,1);return true}return false}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.back"]){dojo._hasResource["dojo.back"]=true;dojo.provide("dojo.back");dojo.getObject("back",true,dojo);(function(){function h(){var a=c.pop();if(a){var b=c[c.length-1];if(!b&&c.length==0)b=j;if(b)if(b.kwArgs.back)b.kwArgs.back();else if(b.kwArgs.backButton)b.kwArgs.backButton();else b.kwArgs.handle&&b.kwArgs.handle("back");e.push(a)}}function m(){var a=e.pop();if(a){if(a.kwArgs.forward)a.kwArgs.forward();else if(a.kwArgs.forwardButton)a.kwArgs.forwardButton();else a.kwArgs.handle&&
a.kwArgs.handle("forward");c.push(a)}}function k(a,b,d){return{url:a,kwArgs:b,urlHash:d}}function n(a){a=a.split("?");return a.length<2?null:a[1]}function t(){var a=(dojo.config.dojoIframeHistoryUrl||dojo.moduleUrl("dojo","resources/iframe_history.html"))+"?"+(new Date).getTime();o=true;if(i)dojo.isWebKit?i.location=a:window.frames[i.name].location=a;return a}function y(){if(!p){var a=c.length,b=l();if((b===u||window.location.href==v)&&a==1)h();else{if(e.length>0)if(e[e.length-1].urlHash===b){m();
return}a>=2&&c[a-2]&&c[a-2].urlHash===b&&h()}}}var f=dojo.back,l=f.getHash=function(){var a=window.location.hash;if(a.charAt(0)=="#")a=a.substring(1);return dojo.isMozilla?a:decodeURIComponent(a)},q=f.setHash=function(a){a||(a="");window.location.hash=encodeURIComponent(a)},v=typeof window!=="undefined"?window.location.href:"",u=typeof window!=="undefined"?l():"",j=null,w=null,r=null,i=null,e=[],c=[],o=false,p=false;f.goBack=h;f.goForward=m;f.init=function(){if(!dojo.byId("dj_history")){var a=dojo.config.dojoIframeHistoryUrl||
dojo.moduleUrl("dojo","resources/iframe_history.html");dojo._postLoad?console.error("dojo.back.init() must be called before the DOM has loaded. If using xdomain loading or djConfig.debugAtAllCosts, include dojo.back in a build layer."):document.write('<iframe style="border:0;width:1px;height:1px;position:absolute;visibility:hidden;bottom:0;right:0;" name="dj_history" id="dj_history" src="'+a+'"></iframe>')}};f.setInitialState=function(a){j=k(v,a,u)};f.addToHistory=function(a){e=[];var b=null,d=null;
if(!i){dojo.config.useXDomain&&!dojo.config.dojoIframeHistoryUrl&&console.warn("dojo.back: When using cross-domain Dojo builds, please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl to the path on your domain to iframe_history.html");i=window.frames.dj_history}r||(r=dojo.create("a",{style:{display:"none"}},dojo.body()));if(a.changeUrl){b=""+(a.changeUrl!==true?a.changeUrl:(new Date).getTime());if(c.length==0&&j.urlHash==b){j=k(d,a,b);return}else if(c.length>0&&c[c.length-
1].urlHash==b){c[c.length-1]=k(d,a,b);return}p=true;setTimeout(function(){q(b);p=false},1);r.href=b;if(dojo.isIE){d=t();var z=a.back||a.backButton||a.handle,g=function(s){l()!=""&&setTimeout(function(){q(b)},1);z.apply(this,[s])};if(a.back)a.back=g;else if(a.backButton)a.backButton=g;else if(a.handle)a.handle=g;var x=a.forward||a.forwardButton||a.handle;g=function(s){l()!=""&&q(b);x&&x.apply(this,[s])};if(a.forward)a.forward=g;else if(a.forwardButton)a.forwardButton=g;else if(a.handle)a.handle=g}else dojo.isIE||
w||(w=setInterval(y,200))}else d=t();c.push(k(d,a,b))};f._iframeLoaded=function(a,b){var d=n(b.href);if(d==null)c.length==1&&h();else if(o)o=false;else if(c.length>=2&&d==n(c[c.length-2].url))h();else e.length>0&&d==n(e[e.length-1].url)&&m()}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cache"]){dojo._hasResource["dojo.cache"]=true;dojo.provide("dojo.cache");var cache={};dojo.cache=function(a,b,c){if(typeof a=="string")a=dojo.moduleUrl(a,b);else{a=a;c=b}b=a.toString();a=c;if(c!=undefined&&!dojo.isString(c))a="value"in c?c.value:undefined;c=c&&c.sanitize?true:false;if(typeof a=="string")a=cache[b]=c?dojo.cache._sanitize(a):a;else if(a===null)delete cache[b];else{if(!(b in cache)){a=dojo._getText(b);cache[b]=c?dojo.cache._sanitize(a):a}a=cache[b]}return a};
dojo.cache._sanitize=function(a){if(a){a=a.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(b)a=b[1]}else a="";return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.data.util.filter"]){dojo._hasResource["dojo.data.util.filter"]=true;dojo.provide("dojo.data.util.filter");dojo.getObject("data.util.filter",true,dojo);dojo.data.util.filter.patternToRegExp=function(d,e){for(var a="^",c=null,b=0;b<d.length;b++){c=d.charAt(b);switch(c){case "\\":a+=c;b++;a+=d.charAt(b);break;case "*":a+=".*";break;case "?":a+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":a+="\\";default:a+=
c}}a+="$";return e?RegExp(a,"mi"):RegExp(a,"m")}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.data.util.sorter"]){dojo._hasResource["dojo.data.util.sorter"]=true;dojo.provide("dojo.data.util.sorter");dojo.getObject("data.util.sorter",true,dojo);dojo.data.util.sorter.basicComparator=function(a,b){var d=-1;if(a===null)a=undefined;if(b===null)b=undefined;if(a==b)d=0;else if(a>b||a==null)d=1;return d};dojo.data.util.sorter.createSortFunction=function(a,b){function d(g,i,h,e){return function(o,p){var q=e.getValue(o,g),r=e.getValue(p,g);return i*h(q,r)}}for(var j=[],
f,l=b.comparatorMap,m=dojo.data.util.sorter.basicComparator,k=0;k<a.length;k++){f=a[k];var c=f.attribute;if(c){f=f.descending?-1:1;var n=m;if(l){if(typeof c!=="string"&&"toString"in c)c=c.toString();n=l[c]||m}j.push(d(c,f,n,b))}}return function(g,i){for(var h=0;h<j.length;){var e=j[h++](g,i);if(e!==0)return e}return 0}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date"]){dojo._hasResource["dojo.date"]=true;dojo.provide("dojo.date");dojo.getObject("date",true,dojo);dojo.date.getDaysInMonth=function(b){var a=b.getMonth();if(a==1&&dojo.date.isLeapYear(b))return 29;return[31,28,31,30,31,30,31,31,30,31,30,31][a]};dojo.date.isLeapYear=function(b){b=b.getFullYear();return!(b%400)||!(b%4)&&!!(b%100)};dojo.date.getTimezoneName=function(b){var a=b.toString(),c="",d=a.indexOf("(");if(d>-1)c=a.substring(++d,a.indexOf(")"));else{d=/([A-Z\/]+) \d{4}$/;
if(a=a.match(d))c=a[1];else{a=b.toLocaleString();d=/ ([A-Z\/]+)$/;if(a=a.match(d))c=a[1]}}return c=="AM"||c=="PM"?"":c};dojo.date.compare=function(b,a,c){b=new Date(+b);a=new Date(+(a||new Date));if(c=="date"){b.setHours(0,0,0,0);a.setHours(0,0,0,0)}else if(c=="time"){b.setFullYear(0,0,0);a.setFullYear(0,0,0)}if(b>a)return 1;if(b<a)return-1;return 0};dojo.date.add=function(b,a,c){var d=new Date(+b),e=false,f="Date";switch(a){case "day":break;case "weekday":var g;if(a=c%5){a=a;g=parseInt(c/5)}else{a=
c>0?5:-5;g=c>0?(c-5)/5:(c+5)/5}var h=b.getDay(),i=0;if(h==6&&c>0)i=1;else if(h==0&&c<0)i=-1;h=h+a;if(h==0||h==6)i=c>0?2:-2;c=7*g+a+i;break;case "year":f="FullYear";e=true;break;case "week":c*=7;break;case "quarter":c*=3;case "month":e=true;f="Month";break;default:f="UTC"+a.charAt(0).toUpperCase()+a.substring(1)+"s"}f&&d["set"+f](d["get"+f]()+c);e&&d.getDate()<b.getDate()&&d.setDate(0);return d};dojo.date.difference=function(b,a,c){a=a||new Date;c=c||"day";var d=a.getFullYear()-b.getFullYear(),e=1;
switch(c){case "quarter":b=b.getMonth();a=a.getMonth();b=Math.floor(b/3)+1;a=Math.floor(a/3)+1;a+=d*4;e=a-b;break;case "weekday":d=Math.round(dojo.date.difference(b,a,"day"));c=parseInt(dojo.date.difference(b,a,"week"));e=d%7;if(e==0)d=c*5;else{var f=0,g=b.getDay();a=a.getDay();c=parseInt(d/7);e=d%7;b=new Date(b);b.setDate(b.getDate()+c*7);b=b.getDay();if(d>0)switch(true){case g==6:f=-1;break;case g==0:f=0;break;case a==6:f=-1;break;case a==0:f=-2;break;case b+e>5:f=-2}else if(d<0)switch(true){case g==
6:f=0;break;case g==0:f=1;break;case a==6:f=2;break;case a==0:f=1;break;case b+e<0:f=2}d+=f;d-=c*2}e=d;break;case "year":e=d;break;case "month":e=a.getMonth()-b.getMonth()+d*12;break;case "week":e=parseInt(dojo.date.difference(b,a,"day")/7);break;case "day":e/=24;case "hour":e/=60;case "minute":e/=60;case "second":e/=1E3;case "millisecond":e*=a.getTime()-b.getTime()}return Math.round(e)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date.stamp"]){dojo._hasResource["dojo.date.stamp"]=true;dojo.provide("dojo.date.stamp");dojo.getObject("date.stamp",true,dojo);dojo.date.stamp.fromISOString=function(e,d){if(!dojo.date.stamp._isoRegExp)dojo.date.stamp._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/;var a=dojo.date.stamp._isoRegExp.exec(e),f=null;if(a){a.shift();a[1]&&a[1]--;if(a[6])a[6]*=1E3;if(d){d=new Date(d);dojo.forEach(dojo.map(["FullYear",
"Month","Date","Hours","Minutes","Seconds","Milliseconds"],function(g){return d["get"+g]()}),function(g,h){a[h]=a[h]||g})}f=new Date(a[0]||1970,a[1]||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0);if(a[0]<100)f.setFullYear(a[0]||1970);var b=0,c=a[7]&&a[7].charAt(0);if(c!="Z"){b=(a[8]||0)*60+(Number(a[9])||0);if(c!="-")b*=-1}if(c)b-=f.getTimezoneOffset();b&&f.setTime(f.getTime()+b*6E4)}return f};dojo.date.stamp.toISOString=function(e,d){var a=function(h){return h<10?"0"+h:h};d=d||{};var f=[],b=d.zulu?
"getUTC":"get",c="";if(d.selector!="time"){c=e[b+"FullYear"]();c=["0000".substr((c+"").length)+c,a(e[b+"Month"]()+1),a(e[b+"Date"]())].join("-")}f.push(c);if(d.selector!="date"){c=[a(e[b+"Hours"]()),a(e[b+"Minutes"]()),a(e[b+"Seconds"]())].join(":");b=e[b+"Milliseconds"]();if(d.milliseconds)c+="."+(b<100?"0":"")+a(b);if(d.zulu)c+="Z";else if(d.selector!="time"){b=e.getTimezoneOffset();var g=Math.abs(b);c+=(b>0?"-":"+")+a(Math.floor(g/60))+":"+a(g%60)}f.push(c)}return f.join("T")}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.hash"]){dojo._hasResource["dojo.hash"]=true;dojo.provide("dojo.hash");(function(){function m(a,b){var e=a.indexOf(b);return e>=0?a.substring(e+1):""}function d(){return m(location.href,"#")}function i(){dojo.publish("/dojo/hashchange",[d()])}function o(){if(d()!==c){c=d();i()}}function p(a){if(g)if(g.isTransitioning())setTimeout(dojo.hitch(null,p,a),j);else{var b=g.iframe.location.href,e=b.indexOf("?");g.iframe.location.replace(b.substring(0,e)+"?"+a)}else{location.replace("#"+
a);!q&&o()}}function u(){function a(){c=d();r=f?c:m(n.href,"?");k=false;l=null}var b=document.createElement("iframe"),e=dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html");dojo.config.useXDomain&&!dojo.config.dojoBlankHtmlUrl&&console.warn("dojo.hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html");b.id="dojo-hash-iframe";b.src=e+"?"+d();b.style.display="none";
document.body.appendChild(b);this.iframe=dojo.global["dojo-hash-iframe"];var r,k,l,s,f,n=this.iframe.location;this.isTransitioning=function(){return k};this.pollLocation=function(){if(!f)try{var t=m(n.href,"?");if(document.title!=s)s=this.iframe.document.title=document.title}catch(v){f=true;console.error("dojo.hash: Error adding history entry. Server unreachable.")}var h=d();if(k&&c===h)if(f||t===l){a();i()}else{setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!(c===h&&(f||r===t)))if(c!==
h){c=h;k=true;l=h;b.src=e+"?"+l;f=false;setTimeout(dojo.hitch(this,this.pollLocation),0);return}else if(!f){location.href="#"+n.search.substring(1);a();i()}setTimeout(dojo.hitch(this,this.pollLocation),j)};a();setTimeout(dojo.hitch(this,this.pollLocation),j)}dojo.hash=function(a,b){if(!arguments.length)return d();if(a.charAt(0)=="#")a=a.substring(1);if(b)p(a);else location.href="#"+a;return a};var c,g,q,j=dojo.config.hashPollFrequency||100;dojo.addOnLoad(function(){if("onhashchange"in dojo.global&&
(!dojo.isIE||dojo.isIE>=8&&document.compatMode!="BackCompat"))q=dojo.connect(dojo.global,"onhashchange",i);else if(document.addEventListener){c=d();setInterval(o,j)}else if(document.attachEvent)g=new u})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.i18n"]){dojo._hasResource["dojo.i18n"]=true;dojo.provide("dojo.i18n");dojo.getObject("i18n",true,dojo);dojo.i18n.getLocalization=dojo.i18n.getLocalization||function(a,f,d){d=dojo.i18n.normalizeLocale(d);var e=d.split("-"),b=[a,"nls",f].join(".");if(b=dojo._loadedModules[b]){for(var c,h=e.length;h>0;h--){var g=e.slice(0,h).join("_");if(b[g]){c=b[g];break}}if(!c)c=b.ROOT;if(c){a=function(){};a.prototype=c;return new a}}throw Error("Bundle not found: "+f+" in "+a+" , locale="+
d);};dojo.i18n.normalizeLocale=function(a){a=a?a.toLowerCase():dojo.locale;if(a=="root")a="ROOT";return a};dojo.i18n._requireLocalization=function(a,f,d,e){d=dojo.i18n.normalizeLocale(d);var b=[a,"nls",f].join("."),c="";if(e){for(var h=e.split(","),g=0;g<h.length;g++)if(d.indexOf(h[g])==0)if(h[g].length>c.length)c=h[g];c||(c="ROOT")}h=e?c:d;var i=dojo._loadedModules[b];g=null;if(i){if(dojo.config.localizationComplete&&i._built)return;g=h.replace(/-/g,"_");g=dojo._loadedModules[b+"."+g]}if(!g){i=dojo.provide(b);
var r=dojo._getModuleSymbols(a).concat("nls").join("/"),n;dojo.i18n._searchLocalePath(h,e,function(l){var j=l.replace(/-/g,"_"),k=b+"."+j,o=false;if(dojo._loadedModules[k])o=true;else{dojo.provide(k);k=[r];l!="ROOT"&&k.push(l);k.push(f);l=k.join("/")+".js";o=dojo._loadPath(l,null,function(m){m=m.root||m;var p=function(){};p.prototype=n;i[j]=new p;for(var q in m)i[j][q]=m[q]})}if(o&&i[j])n=i[j];else i[j]=n;if(e)return true})}if(e&&d!=c)i[d.replace(/-/g,"_")]=i[c.replace(/-/g,"_")]};(function(){var a=
dojo.config.extraLocale;if(a){if(!a instanceof Array)a=[a];var f=dojo.i18n._requireLocalization;dojo.i18n._requireLocalization=function(d,e,b,c){f(d,e,b,c);if(!b)for(b=0;b<a.length;b++)f(d,e,a[b],c)}}})();dojo.i18n._searchLocalePath=function(a,f,d){a=dojo.i18n.normalizeLocale(a);var e=a.split("-");a=[];for(var b=e.length;b>0;b--)a.push(e.slice(0,b).join("-"));a.push(false);f&&a.reverse();for(f=a.length-1;f>=0;f--)if(d(a[f]||"ROOT"))break};dojo.i18n._preloadLocalizations=function(a,f){function d(c){c=
dojo.i18n.normalizeLocale(c);dojo.i18n._searchLocalePath(c,true,function(h){for(var g=0;g<f.length;g++)if(f[g]==h){dojo.require(a+"_"+h);return true}return false})}d();for(var e=dojo.config.extraLocale||[],b=0;b<e.length;b++)d(e[b])}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.getObject("regexp",true,dojo);dojo.regexp.escapeString=function(a,b){return a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(c){if(b&&b.indexOf(c)!=-1)return c;return"\\"+c})};dojo.regexp.buildGroupRE=function(a,b,c){if(!(a instanceof Array))return b(a);for(var e=[],d=0;d<a.length;d++)e.push(b(a[d]));return dojo.regexp.group(e.join("|"),c)};dojo.regexp.group=function(a,b){return"("+(b?"?:":
"")+a+")"}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.Stateful"]){dojo._hasResource["dojo.Stateful"]=true;dojo.provide("dojo.Stateful");dojo.declare("dojo.Stateful",null,{postscript:function(a){a&&dojo.mixin(this,a)},get:function(a){return this[a]},set:function(a,c){if(typeof a==="object"){for(var b in a)this.set(b,a[b]);return this}b=this[a];this[a]=c;this._watchCallbacks&&this._watchCallbacks(a,b,c);return this},watch:function(a,c){var b=this._watchCallbacks;if(!b){var i=this;b=this._watchCallbacks=function(g,j,k,l){var h=
function(d){if(d){d=d.slice();for(var f=0,m=d.length;f<m;f++)try{d[f].call(i,g,j,k)}catch(n){console.error(n)}}};h(b["_"+g]);l||h(b["*"])}}if(!c&&typeof a==="function"){c=a;a="*"}else a="_"+a;var e=b[a];if(typeof e!=="object")e=b[a]=[];e.push(c);return{unwatch:function(){e.splice(dojo.indexOf(e,c),1)}}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.string"]){dojo._hasResource["dojo.string"]=true;dojo.provide("dojo.string");dojo.getObject("string",true,dojo);dojo.string.rep=function(a,b){if(b<=0||!a)return"";for(var c=[];;){b&1&&c.push(a);if(!(b>>=1))break;a+=a}return c.join("")};dojo.string.pad=function(a,b,c,d){c||(c="0");a=String(a);b=dojo.string.rep(c,Math.ceil((b-a.length)/c.length));return d?a+b:b+a};dojo.string.substitute=function(a,b,c,d){d=d||dojo.global;c=c?dojo.hitch(d,c):function(e){return e};return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,
function(e,f,g){e=dojo.getObject(f,false,b);if(g)e=dojo.getObject(g,false,d).call(d,e,f);return c(e,f).toString()})};dojo.string.trim=String.prototype.trim?dojo.trim:function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;b>=0;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.uacss"]){dojo._hasResource["dojo.uacss"]=true;dojo.provide("dojo.uacss");(function(){var a=dojo,d=a.doc.documentElement,b=a.isIE,g=a.isOpera,c=Math.floor,h=a.isFF,i=a.boxModel.replace(/-/,"");b={dj_ie:b,dj_ie6:c(b)==6,dj_ie7:c(b)==7,dj_ie8:c(b)==8,dj_ie9:c(b)==9,dj_quirks:a.isQuirks,dj_iequirks:b&&a.isQuirks,dj_opera:g,dj_khtml:a.isKhtml,dj_webkit:a.isWebKit,dj_safari:a.isSafari,dj_chrome:a.isChrome,dj_gecko:a.isMozilla,dj_ff3:c(h)==3};b["dj_"+i]=true;var e="",f;for(f in b)if(b[f])e+=
f+" ";d.className=a.trim(d.className+" "+e);dojo._loaders.unshift(function(){if(!dojo._isBodyLtr()){var j="dj_rtl dijitRtl "+e.replace(/ /g,"-rtl ");d.className=a.trim(d.className+" "+j)}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.window"]){dojo._hasResource["dojo.window"]=true;dojo.provide("dojo.window");dojo.getObject("window",true,dojo);dojo.window.getBox=function(){var b=dojo.doc.compatMode=="BackCompat"?dojo.body():dojo.doc.documentElement,i=dojo._docScroll();return{w:b.clientWidth,h:b.clientHeight,l:i.x,t:i.y}};dojo.window.get=function(b){if(dojo.isIE&&window!==document.parentWindow){b.parentWindow.execScript("document._parentWindow = window;","Javascript");var i=b._parentWindow;b._parentWindow=
null;return i}return b.parentWindow||b.defaultView};dojo.window.scrollIntoView=function(b,i){try{b=dojo.byId(b);var d=b.ownerDocument||dojo.doc,j=d.body||dojo.body(),o=d.documentElement||j.parentNode,f=dojo.isIE,e=dojo.isWebKit;if((!(dojo.isMoz||f||e||dojo.isOpera)||b==j||b==o)&&typeof b.scrollIntoView!="undefined")b.scrollIntoView(false);else{var p=d.compatMode=="BackCompat";d=p?j:o;e=e?j:d;var q=d.clientWidth,r=d.clientHeight,s=!dojo._isBodyLtr(),g=i||dojo.position(b),c=b.parentNode;d=function(x){return f<=
6||f&&p?false:dojo.style(x,"position").toLowerCase()=="fixed"};if(!d(b))for(;c;){if(c==j)c=e;var a=dojo.position(c),t=d(c);if(c==e){a.w=q;a.h=r;if(e==o&&f&&s)a.x+=e.offsetWidth-a.w;if(a.x<0||!f)a.x=0;if(a.y<0||!f)a.y=0}else{var k=dojo._getPadBorderExtents(c);a.w-=k.w;a.h-=k.h;a.x+=k.l;a.y+=k.t}if(c!=e){var h=c.clientWidth,l=a.w-h;if(h>0&&l>0){a.w=h;if(f&&s)a.x+=l}h=c.clientHeight;l=a.h-h;if(h>0&&l>0)a.h=h}if(t){if(a.y<0){a.h+=a.y;a.y=0}if(a.x<0){a.w+=a.x;a.x=0}if(a.y+a.h>r)a.h=r-a.y;if(a.x+a.w>q)a.w=
q-a.x}var m=g.x-a.x,n=g.y-Math.max(a.y,0),u=m+g.w-a.w,v=n+g.h-a.h;if(u*m>0){var w=Math[m<0?"max":"min"](m,u);g.x+=c.scrollLeft;c.scrollLeft+=f>=8&&!p&&s?-w:w;g.x-=c.scrollLeft}if(v*n>0){g.y+=c.scrollTop;c.scrollTop+=Math[n<0?"max":"min"](n,v);g.y-=c.scrollTop}c=c!=e&&!t&&c.parentNode}}}catch(y){console.error("scrollIntoView: "+y);b.scrollIntoView(false)}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.base64"]){dojo._hasResource["dojox.encoding.base64"]=true;dojo.provide("dojox.encoding.base64");dojo.getObject("encoding.base64",true,dojox);(function(){var g=dojox.encoding;g.base64.encode=function(b){var a=[],f=b.length,d=f%3;f=f-d;for(var c=0;c<f;){var e=b[c++]<<16|b[c++]<<8|b[c++];a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>18&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>
12&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e&63))}switch(d){case 2:e=b[c++]<<16|b[c++]<<8;a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>18&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>12&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6&
63));a.push("=");break;case 1:e=b[c++]<<16;a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>18&63));a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>12&63));a.push("=");a.push("=")}return a.join("")};g.base64.decode=function(b){b=b.split("");for(var a=[],f=b.length;b[--f]=="=";);for(var d=0;d<f;){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++])<<18;if(d<=f)c|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++])<<
12;if(d<=f)c|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++])<<6;if(d<=f)c|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d++]);a.push(c>>>16&255);a.push(c>>>8&255);a.push(c&255)}for(;a[a.length-1]==0;)a.pop();return a}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.crypto._base"]){dojo._hasResource["dojox.encoding.crypto._base"]=true;dojo.provide("dojox.encoding.crypto._base");dojo.getObject("encoding.crypto",true,dojox);(function(){var a=dojox.encoding.crypto;a.cipherModes={ECB:0,CBC:1,PCBC:2,CFB:3,OFB:4,CTR:5};a.outputTypes={Base64:0,Hex:1,String:2,Raw:3}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.digests._base"]){dojo._hasResource["dojox.encoding.digests._base"]=true;dojo.provide("dojox.encoding.digests._base");dojo.getObject("encodoing.digests",true,dojox);(function(){var e=dojox.encoding.digests;e.outputTypes={Base64:0,Hex:1,String:2,Raw:3};e.addWords=function(b,c){var a=(b&65535)+(c&65535);return(b>>16)+(c>>16)+(a>>16)<<16|a&65535};e.stringToWord=function(b){for(var c=[],a=0,d=b.length*8;a<d;a+=8)c[a>>5]|=(b.charCodeAt(a/8)&255)<<a%32;return c};e.wordToString=
function(b){for(var c=[],a=0,d=b.length*32;a<d;a+=8)c.push(String.fromCharCode(b[a>>5]>>>a%32&255));return c.join("")};e.wordToHex=function(b){for(var c=[],a=0,d=b.length*4;a<d;a++)c.push("0123456789abcdef".charAt(b[a>>2]>>a%4*8+4&15)+"0123456789abcdef".charAt(b[a>>2]>>a%4*8&15));return c.join("")};e.wordToBase64=function(b){for(var c=[],a=0,d=b.length*4;a<d;a+=3)for(var g=(b[a>>2]>>8*(a%4)&255)<<16|(b[a+1>>2]>>8*((a+1)%4)&255)<<8|b[a+2>>2]>>8*((a+2)%4)&255,f=0;f<4;f++)a*8+f*6>b.length*32?c.push("="):
c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>6*(3-f)&63));return c.join("")}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.scroll"]){dojo._hasResource["dijit._base.scroll"]=true;dojo.provide("dijit._base.scroll");dojo.require("dojo.window");dijit.scrollIntoView=function(a,b){dojo.window.scrollIntoView(a,b)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.sniff"]){dojo._hasResource["dijit._base.sniff"]=true;dojo.provide("dijit._base.sniff");dojo.require("dojo.uacss")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.window"]){dojo._hasResource["dijit._base.window"]=true;dojo.provide("dijit._base.window");dojo.require("dojo.window");dijit.getDocumentWindow=function(a){return dojo.window.get(a)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._KeyNavContainer"]){dojo._hasResource["dijit._KeyNavContainer"]=true;dojo.provide("dijit._KeyNavContainer");dojo.require("dijit._Container");dojo.declare("dijit._KeyNavContainer",dijit._Container,{tabIndex:"0",_keyNavCodes:{},connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},d=dojo.hitch(this,this.focusPrev),f=dojo.hitch(this,this.focusNext);dojo.forEach(a,function(e){c[e]=d});dojo.forEach(b,function(e){c[e]=f});c[dojo.keys.HOME]=dojo.hitch(this,"focusFirstChild");
c[dojo.keys.END]=dojo.hitch(this,"focusLastChild");this.connect(this.domNode,"onkeypress","_onContainerKeypress");this.connect(this.domNode,"onfocus","_onContainerFocus")},startupKeyNavChildren:function(){dojo.forEach(this.getChildren(),dojo.hitch(this,"_startupChild"))},addChild:function(a){dijit._KeyNavContainer.superclass.addChild.apply(this,arguments);this._startupChild(a)},focus:function(){this.focusFirstChild()},focusFirstChild:function(){var a=this._getFirstFocusableChild();a&&this.focusChild(a)},
focusLastChild:function(){var a=this._getLastFocusableChild();a&&this.focusChild(a)},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),true)},focusChild:function(a,b){this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild);a.focus(b?"end":"start");this._set("focusedChild",a)},_startupChild:function(a){a.set("tabIndex","-1");this.connect(a,"_onFocus",function(){a.set("tabIndex",
this.tabIndex)});this.connect(a,"_onBlur",function(){a.set("tabIndex","-1")})},_onContainerFocus:function(a){if(a.target===this.domNode){this.focusFirstChild();dojo.attr(this.domNode,"tabIndex","-1")}},_onBlur:function(){this.tabIndex&&dojo.attr(this.domNode,"tabIndex",this.tabIndex);this.inherited(arguments)},_onContainerKeypress:function(a){if(!(a.ctrlKey||a.altKey)){var b=this._keyNavCodes[a.charOrCode];if(b){b();dojo.stopEvent(a)}}},_onChildBlur:function(){},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,
1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},_getNextFocusableChild:function(a,b){if(a)a=this._getSiblingOfChild(a,b);for(var c=this.getChildren(),d=0;d<c.length;d++){a||(a=c[b>0?0:c.length-1]);if(a.isFocusable())return a;a=this._getSiblingOfChild(a,b)}return null}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form._FormMixin"]){dojo._hasResource["dijit.form._FormMixin"]=true;dojo.provide("dijit.form._FormMixin");dojo.require("dojo.window");dojo.declare("dijit.form._FormMixin",null,{state:"",reset:function(){dojo.forEach(this.getDescendants(),function(b){b.reset&&b.reset()})},validate:function(){var b=false;return dojo.every(dojo.map(this.getDescendants(),function(a){a._hasBeenBlurred=true;var c=a.disabled||!a.validate||a.validate();if(!c&&!b){dojo.window.scrollIntoView(a.containerNode||
a.domNode);a.focus();b=true}return c}),function(a){return a})},setValues:function(b){dojo.deprecated(this.declaredClass+"::setValues() is deprecated. Use set('value', val) instead.","","2.0");return this.set("value",b)},_setValueAttr:function(b){var a={};dojo.forEach(this.getDescendants(),function(d){if(d.name)(a[d.name]||(a[d.name]=[])).push(d)});for(var c in a)if(a.hasOwnProperty(c)){var e=a[c],f=dojo.getObject(c,false,b);if(f!==undefined){dojo.isArray(f)||(f=[f]);if(typeof e[0].checked=="boolean")dojo.forEach(e,
function(d){d.set("value",dojo.indexOf(f,d.value)!=-1)});else e[0].multiple?e[0].set("value",f):dojo.forEach(e,function(d,g){d.set("value",f[g])})}}},getValues:function(){dojo.deprecated(this.declaredClass+"::getValues() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},_getValueAttr:function(){var b={};dojo.forEach(this.getDescendants(),function(a){var c=a.name;if(!(!c||a.disabled)){var e=a.get("value");if(typeof a.checked=="boolean")if(/Radio/.test(a.declaredClass))if(e!==
false)dojo.setObject(c,e,b);else{e=dojo.getObject(c,false,b);e===undefined&&dojo.setObject(c,null,b)}else{a=dojo.getObject(c,false,b);if(!a){a=[];dojo.setObject(c,a,b)}e!==false&&a.push(e)}else{a=dojo.getObject(c,false,b);if(typeof a!="undefined")dojo.isArray(a)?a.push(e):dojo.setObject(c,[a,e],b);else dojo.setObject(c,e,b)}}});return b},isValid:function(){return this.state==""},onValidStateChange:function(){},_getState:function(){var b=dojo.map(this._descendants,function(a){return a.get("state")||
""});return dojo.indexOf(b,"Error")>=0?"Error":dojo.indexOf(b,"Incomplete")>=0?"Incomplete":""},disconnectChildren:function(){dojo.forEach(this._childConnections||[],dojo.hitch(this,"disconnect"));dojo.forEach(this._childWatches||[],function(b){b.unwatch()})},connectChildren:function(b){var a=this;this.disconnectChildren();this._descendants=this.getDescendants();b=b?function(d,g){a[d]=g}:dojo.hitch(this,"_set");b("value",this.get("value"));b("state",this._getState());var c=this._childConnections=
[],e=this._childWatches=[];dojo.forEach(dojo.filter(this._descendants,function(d){return d.validate}),function(d){dojo.forEach(["state","disabled"],function(g){e.push(d.watch(g,function(){a.set("state",a._getState())}))})});var f=function(){a._onChangeDelayTimer&&clearTimeout(a._onChangeDelayTimer);a._onChangeDelayTimer=setTimeout(function(){delete a._onChangeDelayTimer;a._set("value",a.get("value"))},10)};dojo.forEach(dojo.filter(this._descendants,function(d){return d.onChange}),function(d){c.push(a.connect(d,
"onChange",f));e.push(d.watch("disabled",f))})},startup:function(){this.inherited(arguments);this.connectChildren(true);this.watch("state",function(b,a,c){this.onValidStateChange(c=="")})},destroy:function(){this.disconnectChildren();this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout._ContentPaneResizeMixin"]){dojo._hasResource["dijit.layout._ContentPaneResizeMixin"]=true;dojo.provide("dijit.layout._ContentPaneResizeMixin");dojo.require("dijit._Contained");dojo.declare("dijit.layout._ContentPaneResizeMixin",null,{doLayout:true,isContainer:true,isLayoutContainer:true,_startChildren:function(){dojo.forEach(this.getChildren(),function(a){a.startup();a._started=true})},startup:function(){if(!this._started){var a=dijit._Contained.prototype.getParent.call(this);
this._childOfLayoutWidget=a&&a.isLayoutContainer;this._needLayout=!this._childOfLayoutWidget;this.inherited(arguments);this._startChildren()}},_checkIfSingleChild:function(){var a=dojo.query("> *",this.containerNode).filter(function(b){return b.tagName!=="SCRIPT"}),c=a.filter(function(b){return dojo.hasAttr(b,"data-dojo-type")||dojo.hasAttr(b,"dojoType")||dojo.hasAttr(b,"widgetId")}),d=dojo.filter(c.map(dijit.byNode),function(b){return b&&b.domNode&&b.resize});if(a.length==c.length&&d.length==1)this._singleChild=
d[0];else delete this._singleChild;dojo.toggleClass(this.containerNode,this.baseClass+"SingleChild",!!this._singleChild)},resize:function(a,c){this._layout(a,c)},_layout:function(a,c){a&&dojo.marginBox(this.domNode,a);var d=this.containerNode;if(d===this.domNode){var b=c||{};dojo.mixin(b,a||{});if(!("h"in b)||!("w"in b))b=dojo.mixin(dojo.marginBox(d),b);this._contentBox=dijit.layout.marginBox2contentBox(d,b)}else this._contentBox=dojo.contentBox(d);this._layoutChildren();delete this._needLayout},
_layoutChildren:function(){this.doLayout&&this._checkIfSingleChild();if(this._singleChild&&this._singleChild.resize){var a=this._contentBox||dojo.contentBox(this.containerNode);this._singleChild.resize({w:a.w,h:a.h})}else dojo.forEach(this.getChildren(),function(c){c.resize&&c.resize()})}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cldr.supplemental"]){dojo._hasResource["dojo.cldr.supplemental"]=true;dojo.provide("dojo.cldr.supplemental");dojo.require("dojo.i18n");dojo.getObject("cldr.supplemental",true,dojo);dojo.cldr.supplemental.getFirstDayOfWeek=function(a){a={mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,er:6,et:6,iq:6,ir:6,jo:6,ke:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,so:6,sy:6,tn:6,ye:6,ar:0,as:0,az:0,bw:0,ca:0,cn:0,fo:0,ge:0,gl:0,gu:0,hk:0,il:0,"in":0,jm:0,jp:0,kg:0,kr:0,la:0,mh:0,mn:0,mo:0,mp:0,mt:0,
nz:0,ph:0,pk:0,sg:0,th:0,tt:0,tw:0,um:0,us:0,uz:0,vi:0,zw:0}[dojo.cldr.supplemental._region(a)];return a===undefined?1:a};dojo.cldr.supplemental._region=function(a){a=dojo.i18n.normalizeLocale(a);a=a.split("-");var b=a[1];if(b){if(b.length==4)b=a[2]}else b={de:"de",en:"us",es:"es",fi:"fi",fr:"fr",he:"il",hu:"hu",it:"it",ja:"jp",ko:"kr",nl:"nl",pt:"br",sv:"se",zh:"cn"}[a[0]];return b};dojo.cldr.supplemental.getWeekend=function(a){var b=dojo.cldr.supplemental._region(a);a={"in":0,af:4,dz:4,ir:4,om:4,
sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[b];b={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[b];if(a===undefined)a=6;if(b===undefined)b=0;return{start:a,end:b}}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.cookie"]){dojo._hasResource["dojo.cookie"]=true;dojo.provide("dojo.cookie");dojo.require("dojo.regexp");dojo.cookie=function(f,e,b){var a=document.cookie;if(arguments.length==1){var d=a.match(RegExp("(?:^|; )"+dojo.regexp.escapeString(f)+"=([^;]*)"));return d?decodeURIComponent(d[1]):undefined}else{b=b||{};a=b.expires;if(typeof a=="number"){var c=new Date;c.setTime(c.getTime()+a*24*60*60*1E3);a=b.expires=c}if(a&&a.toUTCString)b.expires=a.toUTCString();e=encodeURIComponent(e);
a=f+"="+e;for(d in b){a+="; "+d;c=b[d];if(c!==true)a+="="+c}document.cookie=a}};dojo.cookie.isSupported=function(){if(!("cookieEnabled"in navigator)){this("__djCookieTest__","CookiesAllowed");navigator.cookieEnabled=this("__djCookieTest__")=="CookiesAllowed";navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1})}return navigator.cookieEnabled}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.data.util.simpleFetch"]){dojo._hasResource["dojo.data.util.simpleFetch"]=true;dojo.provide("dojo.data.util.simpleFetch");dojo.require("dojo.data.util.sorter");dojo.getObject("data.util.simpleFetch",true,dojo);dojo.data.util.simpleFetch.fetch=function(d){d=d||{};if(!d.store)d.store=this;var h=this,k=function(b,a){if(a.onError)a.onError.call(a.scope||dojo.global,b,a)},m=function(b,a){var i=a.abort||null,e=false,f=a.start?a.start:0,j=a.count&&a.count!==Infinity?f+a.count:
b.length;a.abort=function(){e=true;i&&i.call(a)};var g=a.scope||dojo.global;if(!a.store)a.store=h;a.onBegin&&a.onBegin.call(g,b.length,a);a.sort&&b.sort(dojo.data.util.sorter.createSortFunction(a.sort,h));if(a.onItem)for(var c=f;c<b.length&&c<j;++c){var l=b[c];e||a.onItem.call(g,l,a)}if(a.onComplete&&!e){c=null;a.onItem||(c=b.slice(f,j));a.onComplete.call(g,c,a)}};this._fetchItems(d,m,k);return d}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.parser"]){dojo._hasResource["dojo.parser"]=true;dojo.provide("dojo.parser");dojo.require("dojo.date.stamp");dojo.parser=new function(){function s(a){if(d.isString(a))return"string";if(typeof a=="number")return"number";if(typeof a=="boolean")return"boolean";if(d.isFunction(a))return"function";if(d.isArray(a))return"array";if(a instanceof Date)return"date";if(a instanceof d._Url)return"url";return"object"}function B(a,b){switch(b){case "string":return a;case "number":return a.length?
Number(a):NaN;case "boolean":return typeof a=="boolean"?a:a.toLowerCase()!="false";case "function":if(d.isFunction(a)){a=a.toString();a=d.trim(a.substring(a.indexOf("{")+1,a.length-1))}try{return a===""||a.search(/[^\w\.]+/i)!=-1?new Function(a):d.getObject(a,false)||new Function(a)}catch(c){return new Function}case "array":return a?a.split(/\s*,\s*/):[];case "date":switch(a){case "":return new Date("");case "now":return new Date;default:return d.date.stamp.fromISOString(a)}case "url":return d.baseUrl+
a;default:return d.fromJson(a)}}function x(a,b){for(var c in a)if(c.charAt(0)!="_")c in C||(b[c]=s(a[c]));return b}function v(a,b){var c=y[a];if(c){if(!b&&!c.params)c.params=x(c.cls.prototype,{})}else{c=d.getObject(a);var k=null;if(!c)return null;b||(k=x(c.prototype,{}));c={cls:c,params:k}}return c}var d=dojo,C={},y={};d.connect(d,"extend",function(){y={}});this._functionFromScript=function(a,b){var c="",k="",o=a.getAttribute(b+"args")||a.getAttribute("args");o&&d.forEach(o.split(/\s*,\s*/),function(n,
f){c+="var "+n+" = arguments["+f+"]; "});(o=a.getAttribute("with"))&&o.length&&d.forEach(o.split(/\s*,\s*/),function(n){c+="with("+n+"){";k+="}"});return new Function(c+a.innerHTML+k)};this.instantiate=function(a,b,c){var k=[];b=b||{};c=c||{};var o=(c.scope||d._scopeName)+"Type",n="data-"+(c.scope||d._scopeName)+"-";d.forEach(a,function(f){if(f){var e,i,g,l,q,j;if(f.node){e=f.node;i=f.type;j=f.fastpath;l=(g=f.clsInfo||i&&v(i,j))&&g.cls;q=f.scripts}else{e=f;q=(l=(g=(i=o in b?b[o]:e.getAttribute(o))&&
v(i))&&g.cls)&&(l._noScript||l.prototype._noScript)?[]:d.query("> script[type^='dojo/']",e)}if(!g)throw Error("Could not load class '"+i);var h={};c.defaults&&d._mixin(h,c.defaults);f.inherited&&d._mixin(h,f.inherited);if(j){if((g=e.getAttribute(n+"props"))&&g.length)try{g=d.fromJson.call(c.propsThis,"{"+g+"}");d._mixin(h,g)}catch(r){throw Error(r.toString()+" in data-dojo-props='"+g+"'");}if(g=e.getAttribute(n+"attach-point"))h.dojoAttachPoint=g;if(g=e.getAttribute(n+"attach-event"))h.dojoAttachEvent=
g;dojo.mixin(h,b)}else{f=e.attributes;for(var p in g.params){i=p in b?{value:b[p],specified:true}:f.getNamedItem(p);if(!(!i||!i.specified&&(!dojo.isIE||p.toLowerCase()!="value"))){i=i.value;switch(p){case "class":i="className"in b?b.className:e.className;break;case "style":i="style"in b?b.style:e.style&&e.style.cssText}var t=g.params[p];h[p]=typeof i=="string"?B(i,t):i}}}var z=[],A=[];d.forEach(q,function(m){e.removeChild(m);var w=m.getAttribute(n+"event")||m.getAttribute("event"),D=m.getAttribute("type");
m=d.parser._functionFromScript(m,n);if(w)if(D=="dojo/connect")z.push({event:w,func:m});else h[w]=m;else A.push(m)});var u=(q=l.markupFactory||l.prototype&&l.prototype.markupFactory)?q(h,e,l):new l(h,e);k.push(u);(l=e.getAttribute(n+"id")||e.getAttribute("jsId"))&&d.setObject(l,u);d.forEach(z,function(m){d.connect(u,m.event,null,m.func)});d.forEach(A,function(m){m.call(u)})}});b._started||d.forEach(k,function(f){if(!c.noStart&&f&&dojo.isFunction(f.startup)&&!f._started&&(!f.getParent||!f.getParent()))f.startup()});
return k};this.parse=function(a,b){function c(e,i){var g=dojo.clone(e.inherited);dojo.forEach(["dir","lang"],function(p){var t=e.node.getAttribute(p);if(t)g[p]=t});for(var l=e.clsInfo&&!e.clsInfo.cls.prototype._noScript?e.scripts:null,q=!e.clsInfo||!e.clsInfo.cls.prototype.stopParser||b&&b.template,j=e.node.firstChild;j;j=j.nextSibling)if(j.nodeType==1){var h,r=q&&j.getAttribute(n+"type");h=r?r:q&&j.getAttribute(o);r=r==h;if(h){h={type:h,fastpath:r,clsInfo:v(h,r),node:j,scripts:[],inherited:g};i.push(h);
c(h,i)}else if(l&&j.nodeName.toLowerCase()=="script")(h=j.getAttribute("type"))&&/^dojo\/\w/i.test(h)&&l.push(j);else q&&c({node:j,inherited:g},i)}}var k;if(!b&&a&&a.rootNode){b=a;k=b.rootNode}else k=a;b=b||{};var o=(b.scope||d._scopeName)+"Type",n="data-"+(b.scope||d._scopeName)+"-",f=[];c({node:k?dojo.byId(k):dojo.body(),inherited:b&&b.inherited||{dir:dojo._isBodyLtr()?"ltr":"rtl"}},f);return this.instantiate(f,b&&b.template?{template:true}:null,b)}};(function(){var s=function(){dojo.config.parseOnLoad&&
dojo.parser.parse()};dojo.getObject("dijit.wai.onload")===dojo._loaders[0]?dojo._loaders.splice(1,0,s):dojo._loaders.unshift(s)})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.digests.MD5"]){dojo._hasResource["dojox.encoding.digests.MD5"]=true;dojo.provide("dojox.encoding.digests.MD5");dojo.require("dojox.encoding.digests._base");(function(){function n(e,g){return e<<g|e>>>32-g}function i(e,g,c,a,d,b){return h.addWords(n(h.addWords(h.addWords(g,e),h.addWords(a,b)),d),c)}function j(e,g,c,a,d,b,f){return i(g&c|~g&a,e,g,d,b,f)}function k(e,g,c,a,d,b,f){return i(g&a|c&~a,e,g,d,b,f)}function l(e,g,c,a,d,b,f){return i(c^(g|~a),e,g,d,b,f)}
function m(e,g){e[g>>5]|=128<<g%32;e[(g+64>>>9<<4)+14]=g;for(var c=1732584193,a=-271733879,d=-1732584194,b=271733878,f=0;f<e.length;f+=16){var o=c,p=a,q=d,r=b;c=j(c,a,d,b,e[f+0],7,-680876936);b=j(b,c,a,d,e[f+1],12,-389564586);d=j(d,b,c,a,e[f+2],17,606105819);a=j(a,d,b,c,e[f+3],22,-1044525330);c=j(c,a,d,b,e[f+4],7,-176418897);b=j(b,c,a,d,e[f+5],12,1200080426);d=j(d,b,c,a,e[f+6],17,-1473231341);a=j(a,d,b,c,e[f+7],22,-45705983);c=j(c,a,d,b,e[f+8],7,1770035416);b=j(b,c,a,d,e[f+9],12,-1958414417);d=j(d,
b,c,a,e[f+10],17,-42063);a=j(a,d,b,c,e[f+11],22,-1990404162);c=j(c,a,d,b,e[f+12],7,1804603682);b=j(b,c,a,d,e[f+13],12,-40341101);d=j(d,b,c,a,e[f+14],17,-1502002290);a=j(a,d,b,c,e[f+15],22,1236535329);c=k(c,a,d,b,e[f+1],5,-165796510);b=k(b,c,a,d,e[f+6],9,-1069501632);d=k(d,b,c,a,e[f+11],14,643717713);a=k(a,d,b,c,e[f+0],20,-373897302);c=k(c,a,d,b,e[f+5],5,-701558691);b=k(b,c,a,d,e[f+10],9,38016083);d=k(d,b,c,a,e[f+15],14,-660478335);a=k(a,d,b,c,e[f+4],20,-405537848);c=k(c,a,d,b,e[f+9],5,568446438);
b=k(b,c,a,d,e[f+14],9,-1019803690);d=k(d,b,c,a,e[f+3],14,-187363961);a=k(a,d,b,c,e[f+8],20,1163531501);c=k(c,a,d,b,e[f+13],5,-1444681467);b=k(b,c,a,d,e[f+2],9,-51403784);d=k(d,b,c,a,e[f+7],14,1735328473);a=k(a,d,b,c,e[f+12],20,-1926607734);c=i(a^d^b,c,a,e[f+5],4,-378558);b=i(c^a^d,b,c,e[f+8],11,-2022574463);d=i(b^c^a,d,b,e[f+11],16,1839030562);a=i(d^b^c,a,d,e[f+14],23,-35309556);c=i(a^d^b,c,a,e[f+1],4,-1530992060);b=i(c^a^d,b,c,e[f+4],11,1272893353);d=i(b^c^a,d,b,e[f+7],16,-155497632);a=i(d^b^c,a,
d,e[f+10],23,-1094730640);c=i(a^d^b,c,a,e[f+13],4,681279174);b=i(c^a^d,b,c,e[f+0],11,-358537222);d=i(b^c^a,d,b,e[f+3],16,-722521979);a=i(d^b^c,a,d,e[f+6],23,76029189);c=i(a^d^b,c,a,e[f+9],4,-640364487);b=i(c^a^d,b,c,e[f+12],11,-421815835);d=i(b^c^a,d,b,e[f+15],16,530742520);a=i(d^b^c,a,d,e[f+2],23,-995338651);c=l(c,a,d,b,e[f+0],6,-198630844);b=l(b,c,a,d,e[f+7],10,1126891415);d=l(d,b,c,a,e[f+14],15,-1416354905);a=l(a,d,b,c,e[f+5],21,-57434055);c=l(c,a,d,b,e[f+12],6,1700485571);b=l(b,c,a,d,e[f+3],10,
-1894986606);d=l(d,b,c,a,e[f+10],15,-1051523);a=l(a,d,b,c,e[f+1],21,-2054922799);c=l(c,a,d,b,e[f+8],6,1873313359);b=l(b,c,a,d,e[f+15],10,-30611744);d=l(d,b,c,a,e[f+6],15,-1560198380);a=l(a,d,b,c,e[f+13],21,1309151649);c=l(c,a,d,b,e[f+4],6,-145523070);b=l(b,c,a,d,e[f+11],10,-1120210379);d=l(d,b,c,a,e[f+2],15,718787259);a=l(a,d,b,c,e[f+9],21,-343485551);c=h.addWords(c,o);a=h.addWords(a,p);d=h.addWords(d,q);b=h.addWords(b,r)}return[c,a,d,b]}var h=dojox.encoding.digests;h.MD5=function(e,g){var c=g||h.outputTypes.Base64,
a=m(h.stringToWord(e),e.length*8);switch(c){case h.outputTypes.Raw:return a;case h.outputTypes.Hex:return h.wordToHex(a);case h.outputTypes.String:return h.wordToString(a);default:return h.wordToBase64(a)}};h.MD5._hmac=function(e,g,c){c=c||h.outputTypes.Base64;var a=h.stringToWord(g);if(a.length>16)a=m(a,g.length*8);var d=[];g=[];for(var b=0;b<16;b++){d[b]=a[b]^909522486;g[b]=a[b]^1549556828}e=m(d.concat(h.stringToWord(e)),512+e.length*8);e=m(g.concat(e),640);switch(c){case h.outputTypes.Raw:return e;
case h.outputTypes.Hex:return h.wordToHex(e);case h.outputTypes.String:return h.wordToString(e);default:return h.wordToBase64(e)}}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.html"]){dojo._hasResource["dojo.html"]=true;dojo.provide("dojo.html");dojo.require("dojo.parser");dojo.getObject("html",true,dojo);(function(){var f=0,e=dojo;dojo.html._secureForInnerHtml=function(a){return a.replace(/(?:\s*<!DOCTYPE\s[^>]+>|<title[^>]*>[\s\S]*?<\/title>)/ig,"")};dojo.html._emptyNode=dojo.empty;dojo.html._setNodeContent=function(a,b){e.empty(a);if(b){if(typeof b=="string")b=e._toDom(b,a.ownerDocument);if(!b.nodeType&&e.isArrayLike(b))for(var c=b.length,
d=0;d<b.length;d=c==b.length?d+1:0)e.place(b[d],a,"last");else e.place(b,a,"last")}return a};dojo.declare("dojo.html._ContentSetter",null,{node:"",content:"",id:"",cleanContent:false,extractContent:false,parseContent:false,parserScope:dojo._scopeName,startup:true,constructor:function(a,b){dojo.mixin(this,a||{});b=this.node=dojo.byId(this.node||b);if(!this.id)this.id=["Setter",b?b.id||b.tagName:"",f++].join("_")},set:function(a,b){if(undefined!==a)this.content=a;b&&this._mixin(b);this.onBegin();this.setContent();
this.onEnd();return this.node},setContent:function(){var a=this.node;if(!a)throw Error(this.declaredClass+": setContent given no node");try{a=dojo.html._setNodeContent(a,this.content)}catch(b){var c=this.onContentError(b);try{a.innerHTML=c}catch(d){console.error("Fatal "+this.declaredClass+".setContent could not change content due to "+d.message,d)}}this.node=a},empty:function(){if(this.parseResults&&this.parseResults.length){dojo.forEach(this.parseResults,function(a){a.destroy&&a.destroy()});delete this.parseResults}dojo.html._emptyNode(this.node)},
onBegin:function(){var a=this.content;if(dojo.isString(a)){if(this.cleanContent)a=dojo.html._secureForInnerHtml(a);if(this.extractContent){var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);if(b)a=b[1]}}this.empty();this.content=a;return this.node},onEnd:function(){this.parseContent&&this._parse();return this.node},tearDown:function(){delete this.parseResults;delete this.node;delete this.content},onContentError:function(a){return"Error occured setting content: "+a},_mixin:function(a){var b={},
c;for(c in a)c in b||(this[c]=a[c])},_parse:function(){var a=this.node;try{this.parseResults=dojo.parser.parse({rootNode:a,noStart:!this.startup,inherited:{dir:this.dir,lang:this.lang},scope:this.parserScope})}catch(b){this._onError("Content",b,"Error parsing in _ContentSetter#"+this.id)}},_onError:function(a,b,c){a=this["on"+a+"Error"].call(this,b);if(c)console.error(c,b);else a&&dojo.html._setNodeContent(this.node,a,true)}});dojo.html.set=function(a,b,c){if(undefined==b){console.warn("dojo.html.set: no cont argument provided, using empty string");
b=""}return c?(new dojo.html._ContentSetter(dojo.mixin(c,{content:b,node:a}))).set():dojo.html._setNodeContent(a,b,true)}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.focus"]){dojo._hasResource["dijit._base.focus"]=true;dojo.provide("dijit._base.focus");dojo.require("dojo.window");dojo.require("dijit._base.manager");dojo.mixin(dijit,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return dijit.getBookmark().isCollapsed},getBookmark:function(){var a,d,b=dojo.doc.selection,c=dijit._curFocus;if(dojo.global.getSelection){if(b=dojo.global.getSelection())if(b.isCollapsed){if(a=c?c.tagName:""){a=a.toLowerCase();if(a=="textarea"||
a=="input"&&(!c.type||c.type.toLowerCase()=="text")){b={start:c.selectionStart,end:c.selectionEnd,node:c,pRange:true};return{isCollapsed:b.end<=b.start,mark:b}}}a={isCollapsed:true}}else{d=b.getRangeAt(0);a={isCollapsed:false,mark:d.cloneRange()}}}else if(b){a=c?c.tagName:"";a=a.toLowerCase();if(c&&a&&(a=="button"||a=="textarea"||a=="input"))if(b.type&&b.type.toLowerCase()=="none")return{isCollapsed:true,mark:null};else{d=b.createRange();return{isCollapsed:d.text&&d.text.length?false:true,mark:{range:d,
pRange:true}}}a={};try{d=b.createRange();a.isCollapsed=!(b.type=="Text"?d.htmlText.length:d.length)}catch(e){a.isCollapsed=true;return a}if(b.type.toUpperCase()=="CONTROL")if(d.length){a.mark=[];b=0;for(c=d.length;b<c;)a.mark.push(d.item(b++))}else{a.isCollapsed=true;a.mark=null}else a.mark=d.getBookmark()}else console.warn("No idea how to store the current selection for this browser!");return a},moveToBookmark:function(a){var d=dojo.doc;if(a=a.mark)if(dojo.global.getSelection){var b=dojo.global.getSelection();
if(b&&b.removeAllRanges)if(a.pRange){b=a.node;b.selectionStart=a.start;b.selectionEnd=a.end}else{b.removeAllRanges();b.addRange(a)}else console.warn("No idea how to restore selection for this browser!")}else if(d.selection&&a){var c;if(a.pRange)c=a.range;else if(dojo.isArray(a)){c=d.body.createControlRange();dojo.forEach(a,function(e){c.addElement(e)})}else{c=d.body.createTextRange();c.moveToBookmark(a)}c.select()}},getFocus:function(a,d){var b=!dijit._curFocus||a&&dojo.isDescendant(dijit._curFocus,
a.domNode)?dijit._prevFocus:dijit._curFocus;return{node:b,bookmark:b==dijit._curFocus&&dojo.withGlobal(d||dojo.global,dijit.getBookmark),openedForWindow:d}},focus:function(a){if(a){var d="node"in a?a.node:a,b=a.bookmark;a=a.openedForWindow;var c=b?b.isCollapsed:false;if(d){var e=d.tagName.toLowerCase()=="iframe"?d.contentWindow:d;if(e&&e.focus)try{e.focus()}catch(g){}dijit._onFocusNode(d)}if(b&&dojo.withGlobal(a||dojo.global,dijit.isCollapsed)&&!c){a&&a.focus();try{dojo.withGlobal(a||dojo.global,
dijit.moveToBookmark,null,[b])}catch(h){}}}},_activeStack:[],registerIframe:function(a){return dijit.registerWin(a.contentWindow,a)},unregisterIframe:function(a){dijit.unregisterWin(a)},registerWin:function(a,d){var b=function(f){dijit._justMouseDowned=true;setTimeout(function(){dijit._justMouseDowned=false},0);dojo.isIE&&f&&f.srcElement&&f.srcElement.parentNode==null||dijit._onTouchNode(d||f.target||f.srcElement,"mouse")},c=dojo.isIE?a.document.documentElement:a.document;if(c)if(dojo.isIE){a.document.body.attachEvent("onmousedown",
b);var e=function(f){f.srcElement.tagName.toLowerCase()!="#document"&&dijit.isTabNavigable(f.srcElement)?dijit._onFocusNode(d||f.srcElement):dijit._onTouchNode(d||f.srcElement)};c.attachEvent("onactivate",e);var g=function(f){dijit._onBlurNode(d||f.srcElement)};c.attachEvent("ondeactivate",g);return function(){a.document.detachEvent("onmousedown",b);c.detachEvent("onactivate",e);c.detachEvent("ondeactivate",g);c=null}}else{c.body.addEventListener("mousedown",b,true);var h=function(f){dijit._onFocusNode(d||
f.target)};c.addEventListener("focus",h,true);var i=function(f){dijit._onBlurNode(d||f.target)};c.addEventListener("blur",i,true);return function(){c.body.removeEventListener("mousedown",b,true);c.removeEventListener("focus",h,true);c.removeEventListener("blur",i,true);c=null}}},unregisterWin:function(a){a&&a()},_onBlurNode:function(){dijit._prevFocus=dijit._curFocus;dijit._curFocus=null;if(!dijit._justMouseDowned){dijit._clearActiveWidgetsTimer&&clearTimeout(dijit._clearActiveWidgetsTimer);dijit._clearActiveWidgetsTimer=
setTimeout(function(){delete dijit._clearActiveWidgetsTimer;dijit._setStack([]);dijit._prevFocus=null},100)}},_onTouchNode:function(a,d){if(dijit._clearActiveWidgetsTimer){clearTimeout(dijit._clearActiveWidgetsTimer);delete dijit._clearActiveWidgetsTimer}var b=[];try{for(;a;){var c=dojo.attr(a,"dijitPopupParent");if(c)a=dijit.byId(c).domNode;else if(a.tagName&&a.tagName.toLowerCase()=="body"){if(a===dojo.body())break;a=dojo.window.get(a.ownerDocument).frameElement}else{var e=a.getAttribute&&a.getAttribute("widgetId"),
g=e&&dijit.byId(e);g&&!(d=="mouse"&&g.get("disabled"))&&b.unshift(e);a=a.parentNode}}}catch(h){}dijit._setStack(b,d)},_onFocusNode:function(a){if(a)if(a.nodeType!=9){dijit._onTouchNode(a);if(a!=dijit._curFocus){if(dijit._curFocus)dijit._prevFocus=dijit._curFocus;dijit._curFocus=a;dojo.publish("focusNode",[a])}}},_setStack:function(a,d){var b=dijit._activeStack;dijit._activeStack=a;for(var c=0;c<Math.min(b.length,a.length);c++)if(b[c]!=a[c])break;for(var e,g=b.length-1;g>=c;g--)if(e=dijit.byId(b[g])){e._focused=
false;e.set("focused",false);e._hasBeenBlurred=true;e._onBlur&&e._onBlur(d);dojo.publish("widgetBlur",[e,d])}for(g=c;g<a.length;g++)if(e=dijit.byId(a[g])){e._focused=true;e.set("focused",true);e._onFocus&&e._onFocus(d);dojo.publish("widgetFocus",[e,d])}}});dojo.addOnLoad(function(){var a=dijit.registerWin(window);dojo.isIE&&dojo.addOnWindowUnload(function(){dijit.unregisterWin(a);a=null})})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.place"]){dojo._hasResource["dijit._base.place"]=true;dojo.provide("dijit._base.place");dojo.require("dojo.window");dojo.require("dojo.AdapterRegistry");dijit.getViewport=function(){return dojo.window.getBox()};dijit.placeOnScreen=function(c,a,b,f){b=dojo.map(b,function(d){var e={corner:d,pos:{x:a.x,y:a.y}};if(f){e.pos.x+=d.charAt(1)=="L"?f.x:-f.x;e.pos.y+=d.charAt(0)=="T"?f.y:-f.y}return e});return dijit._place(c,b)};dijit._place=function(c,a,b,f){var d=dojo.window.getBox();
if(!c.parentNode||String(c.parentNode.tagName).toLowerCase()!="body")dojo.body().appendChild(c);var e=null;dojo.some(a,function(k){var h=k.corner,g=k.pos,j=0,p={w:h.charAt(1)=="L"?d.l+d.w-g.x:g.x-d.l,h:h.charAt(1)=="T"?d.t+d.h-g.y:g.y-d.t};if(b){j=b(c,k.aroundCorner,h,p,f);j=typeof j=="undefined"?0:j}var i=c.style,n=i.display,l=i.visibility;i.visibility="hidden";i.display="";var m=dojo.marginBox(c);i.display=n;i.visibility=l;i=Math.max(d.l,h.charAt(1)=="L"?g.x:g.x-m.w);n=Math.max(d.t,h.charAt(0)==
"T"?g.y:g.y-m.h);l=Math.min(d.l+d.w,h.charAt(1)=="L"?i+m.w:g.x);g=Math.min(d.t+d.h,h.charAt(0)=="T"?n+m.h:g.y);l=l-i;g=g-n;j+=m.w-l+(m.h-g);if(e==null||j<e.overflow)e={corner:h,aroundCorner:k.aroundCorner,x:i,y:n,w:l,h:g,overflow:j,spaceAvailable:p};return!j});e.overflow&&b&&b(c,e.aroundCorner,e.corner,e.spaceAvailable,f);a=dojo._isBodyLtr();var o=c.style;o.top=e.y+"px";o[a?"left":"right"]=(a?e.x:d.w-e.x-e.w)+"px";return e};dijit.placeOnScreenAroundNode=function(c,a,b,f){a=dojo.byId(a);a=dojo.position(a,
true);return dijit._placeOnScreenAroundRect(c,a.x,a.y,a.w,a.h,b,f)};dijit.placeOnScreenAroundRectangle=function(c,a,b,f){return dijit._placeOnScreenAroundRect(c,a.x,a.y,a.width,a.height,b,f)};dijit._placeOnScreenAroundRect=function(c,a,b,f,d,e,o){var k=[],h;for(h in e)k.push({aroundCorner:h,corner:e[h],pos:{x:a+(h.charAt(1)=="L"?0:f),y:b+(h.charAt(0)=="T"?0:d)}});return dijit._place(c,k,o,{w:f,h:d})};dijit.placementRegistry=new dojo.AdapterRegistry;dijit.placementRegistry.register("node",function(c,
a){return typeof a=="object"&&typeof a.offsetWidth!="undefined"&&typeof a.offsetHeight!="undefined"},dijit.placeOnScreenAroundNode);dijit.placementRegistry.register("rect",function(c,a){return typeof a=="object"&&"x"in a&&"y"in a&&"width"in a&&"height"in a},dijit.placeOnScreenAroundRectangle);dijit.placeOnScreenAroundElement=function(){return dijit.placementRegistry.match.apply(dijit.placementRegistry,arguments)};dijit.getPopupAroundAlignment=function(c,a){var b={};dojo.forEach(c,function(f){switch(f){case "after":b[a?
"BR":"BL"]=a?"BL":"BR";break;case "before":b[a?"BL":"BR"]=a?"BR":"BL";break;case "below-alt":a=!a;case "below":b[a?"BL":"BR"]=a?"TL":"TR";b[a?"BR":"BL"]=a?"TR":"TL";break;case "above-alt":a=!a;default:b[a?"TL":"TR"]=a?"BL":"BR";b[a?"TR":"TL"]=a?"BR":"BL"}});return b}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._WidgetBase"]){dojo._hasResource["dijit._WidgetBase"]=true;dojo.provide("dijit._WidgetBase");dojo.require("dijit._base.manager");dojo.require("dojo.Stateful");(function(){dojo.declare("dijit._WidgetBase",dojo.Stateful,{id:"",lang:"",dir:"","class":"",style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,attributeMap:{id:"",dir:"",lang:"","class":"",style:"",title:""},_blankGif:(dojo.config.blankGif||dojo.moduleUrl("dojo","resources/blank.gif")).toString(),
postscript:function(a,b){this.create(a,b)},create:function(a,b){this.srcNodeRef=dojo.byId(b);this._connects=[];this._subscribes=[];if(this.srcNodeRef&&typeof this.srcNodeRef.id=="string")this.id=this.srcNodeRef.id;if(a){this.params=a;dojo._mixin(this,a)}this.postMixInProperties();if(!this.id)this.id=dijit.getUniqueId(this.declaredClass.replace(/\./g,"_"));dijit.registry.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&c.parentNode&&this.domNode!==c&&
c.parentNode.replaceChild(this.domNode,c)}this.domNode&&this.domNode.setAttribute("widgetId",this.id);this.postCreate();this.srcNodeRef&&!this.srcNodeRef.parentNode&&delete this.srcNodeRef;this._created=true},_applyAttributes:function(){var a=function(c,d){if(d.params&&c in d.params||d[c])d.set(c,d[c])},b;for(b in this.attributeMap)a(b,this);dojo.forEach(this._getSetterAttributes(),function(c){c in this.attributeMap||a(c,this)},this)},_getSetterAttributes:function(){var a=this.constructor;if(!a._setterAttrs){var b=
a._setterAttrs=[],c,d=a.prototype,e;for(e in d)if(dojo.isFunction(d[e])&&(c=e.match(/^_set([a-zA-Z]*)Attr$/))&&c[1])b.push(c[1].charAt(0).toLowerCase()+c[1].substr(1))}return a._setterAttrs},postMixInProperties:function(){},buildRendering:function(){if(!this.domNode)this.domNode=this.srcNodeRef||dojo.create("div");if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(dojo.map(a,function(b){return b+"Rtl"})));dojo.addClass(this.domNode,a)}},postCreate:function(){},startup:function(){this._started=
true},destroyRecursive:function(a){this._beingDestroyed=true;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){this._beingDestroyed=true;this.uninitialize();var b=dojo,c=b.forEach,d=b.unsubscribe;c(this._connects,function(e){c(e,b.disconnect)});c(this._subscribes,function(e){d(e)});c(this._supportingWidgets||[],function(e){if(e.destroyRecursive)e.destroyRecursive();else e.destroy&&e.destroy()});this.destroyRendering(a);dijit.registry.remove(this.id);this._destroyed=true},destroyRendering:function(a){if(this.bgIframe){this.bgIframe.destroy(a);
delete this.bgIframe}if(this.domNode){a?dojo.removeAttr(this.domNode,"widgetId"):dojo.destroy(this.domNode);delete this.domNode}if(this.srcNodeRef){a||dojo.destroy(this.srcNodeRef);delete this.srcNodeRef}},destroyDescendants:function(a){dojo.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return false},_setClassAttr:function(a){dojo.replaceClass(this[this.attributeMap["class"]||"domNode"],a,this["class"]);this._set("class",a)},_setStyleAttr:function(a){var b=
this[this.attributeMap.style||"domNode"];if(dojo.isObject(a))dojo.style(b,a);else if(b.style.cssText)b.style.cssText+="; "+a;else b.style.cssText=a;this._set("style",a)},_attrToDom:function(a,b){var c=this.attributeMap[a];dojo.forEach(dojo.isArray(c)?c:[c],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":if(dojo.isFunction(b))b=dojo.hitch(this,b);d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;dojo.attr(e,d,b);break;case "innerText":e.innerHTML=
"";e.appendChild(dojo.doc.createTextNode(b));break;case "innerHTML":e.innerHTML=b;break;case "class":dojo.replaceClass(e,b,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this[a]},set:function(a,b){if(typeof a==="object"){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);if(this[c.s])var d=this[c.s].apply(this,Array.prototype.slice.call(arguments,1));else{a in this.attributeMap&&this._attrToDom(a,b);this._set(a,b)}return d||this},_attrPairNames:{},
_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.charAt(0).toUpperCase()+a.substr(1);return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr"}},_set:function(a,b){var c=this[a];this[a]=b;this._watchCallbacks&&this._created&&b!==c&&this._watchCallbacks(a,c,b)},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getDescendants:function(){return this.containerNode?dojo.query("[widgetId]",this.containerNode).map(dijit.byNode):[]},getChildren:function(){return this.containerNode?
dijit.findWidgets(this.containerNode):[]},connect:function(a,b,c){a=[dojo._connect(a,b,this,c)];this._connects.push(a);return a},disconnect:function(a){for(var b=0;b<this._connects.length;b++)if(this._connects[b]==a){dojo.forEach(a,dojo.disconnect);this._connects.splice(b,1);break}},subscribe:function(a,b){var c=dojo.subscribe(a,this,b);this._subscribes.push(c);return c},unsubscribe:function(a){for(var b=0;b<this._subscribes.length;b++)if(this._subscribes[b]==a){dojo.unsubscribe(a);this._subscribes.splice(b,
1);break}},isLeftToRight:function(){return this.dir?this.dir=="ltr":dojo._isBodyLtr()},placeAt:function(a,b){a.declaredClass&&a.addChild?a.addChild(this,b):dojo.place(this.domNode,a,b);return this}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.data.QueryReadStore"]){dojo._hasResource["dojox.data.QueryReadStore"]=true;dojo.provide("dojox.data.QueryReadStore");dojo.require("dojo.data.util.sorter");dojo.require("dojo.string");dojo.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,_numRows:-1,lastRequestHash:null,doClientPaging:false,doClientSorting:false,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":true,
"dojo.data.api.Identity":true},_labelAttr:"label",constructor:function(a){dojo.mixin(this,a)},getValue:function(a,c,g){this._assertIsItem(a);if(!dojo.isString(c))throw Error(this._className+".getValue(): Invalid attribute, string expected!");if(!this.hasAttribute(a,c))if(g)return g;return a.i[c]},getValues:function(a,c){this._assertIsItem(a);var g=[];this.hasAttribute(a,c)&&g.push(a.i[c]);return g},getAttributes:function(a){this._assertIsItem(a);var c=[],g;for(g in a.i)c.push(g);return c},hasAttribute:function(a,
c){return this.isItem(a)&&typeof a.i[c]!="undefined"},containsValue:function(a,c,g){a=this.getValues(a,c);c=a.length;for(var f=0;f<c;f++)if(a[f]==g)return true;return false},isItem:function(a){if(a)return typeof a.r!="undefined"&&a.r==this;return false},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this.isItemLoaded(a.item)},fetch:function(a){a=a||{};if(!a.store)a.store=this;var c=this,g=function(d,b){if(b.onError)b.onError.call(b.scope||dojo.global,d,b)},f=function(d,b,e){var h=
b.abort||null,j=false,i=b.start?b.start:0;if(c.doClientPaging==false)i=0;var l=b.count?i+b.count:d.length;b.abort=function(){j=true;h&&h.call(b)};var k=b.scope||dojo.global;if(!b.store)b.store=c;b.onBegin&&b.onBegin.call(k,e,b);b.sort&&c.doClientSorting&&d.sort(dojo.data.util.sorter.createSortFunction(b.sort,c));if(b.onItem)for(e=i;e<d.length&&e<l;++e){var m=d[e];j||b.onItem.call(k,m,b)}if(b.onComplete&&!j){e=null;b.onItem||(e=d.slice(i,l));b.onComplete.call(k,e,b)}};this._fetchItems(a,f,g);return a},
getFeatures:function(){return this._features},close:function(){},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},getLabelAttributes:function(){if(this._labelAttr)return[this._labelAttr];return null},_xhrFetchHandler:function(a,c,g){a=this._filterResponse(a);if(a.label)this._labelAttr=a.label;var f=a.numRows||-1;this._items=[];dojo.forEach(a.items,function(h){this._items.push({i:h,r:this})},this);a=a.identifier;this._itemsByIdentity={};if(a){this._identifier=
a;var d;for(d=0;d<this._items.length;++d){var b=this._items[d].i,e=b[a];if(this._itemsByIdentity[e])throw Error(this._className+":  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+a+"].  Value collided: ["+e+"]");else this._itemsByIdentity[e]=b}}else{this._identifier=Number;for(d=0;d<this._items.length;++d)this._items[d].n=d}f=this._numRows=f===-1?this._items.length:f;g(this._items,c,f);this._numRows=f},_fetchItems:function(a,c,g){var f=a.serverQuery||
a.query||{};if(!this.doClientPaging){f.start=a.start||0;if(a.count)f.count=a.count}if(!this.doClientSorting&&a.sort){var d=[];dojo.forEach(a.sort,function(e){if(e&&e.attribute)d.push((e.descending?"-":"")+e.attribute)});f.sort=d.join(",")}if(this.doClientPaging&&this._lastServerQuery!==null&&dojo.toJson(f)==dojo.toJson(this._lastServerQuery)){this._numRows=this._numRows===-1?this._items.length:this._numRows;c(this._items,a,this._numRows)}else{var b=(this.requestMethod.toLowerCase()=="post"?dojo.xhrPost:
dojo.xhrGet)({url:this.url,handleAs:"json-comment-optional",content:f,failOk:true});a.abort=function(){b.cancel()};b.addCallback(dojo.hitch(this,function(e){this._xhrFetchHandler(e,a,c,g)}));b.addErrback(function(e){g(e,a)});this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=dojo.mixin({},f)}},_filterResponse:function(a){return a},_assertIsItem:function(a){if(!this.isItem(a))throw Error(this._className+": Invalid item argument.");},_assertIsAttribute:function(a){if(typeof a!==
"string")throw Error(this._className+": Invalid attribute argument ('"+a+"').");},fetchItemByIdentity:function(a){if(this._itemsByIdentity){var c=this._itemsByIdentity[a.identity];if(c!==undefined){if(a.onItem)a.onItem.call(a.scope?a.scope:dojo.global,{i:c,r:this});return}}var g=function(d){var b=a.scope?a.scope:dojo.global;a.onError&&a.onError.call(b,d)},f=function(d){var b=a.scope?a.scope:dojo.global;try{var e=null;if(d&&d.length==1)e=d[0];a.onItem&&a.onItem.call(b,e)}catch(h){a.onError&&a.onError.call(b,
h)}};this._fetchItems({serverQuery:{id:a.identity}},f,g)},getIdentity:function(a){var c=null;return c=this._identifier===Number?a.n:a.i[this._identifier]},getIdentityAttributes:function(){return[this._identifier]}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.encoding.crypto.SimpleAES"]){dojo._hasResource["dojox.encoding.crypto.SimpleAES"]=true;dojo.provide("dojox.encoding.crypto.SimpleAES");dojo.require("dojox.encoding.base64");dojo.require("dojox.encoding.crypto._base");dojo.getObject("encoding.crypto.SimpleAES",true,dojox);(function(){function k(d,f){for(var b=f.length/4-1,c=[[],[],[],[]],a=0;a<16;a++)c[a%4][Math.floor(a/4)]=d[a];c=n(c,f,0,4);for(a=1;a<b;a++){c=o(c,4);c=c=p(c,4);for(var e=0;e<4;e++){for(var h=Array(4),g=
Array(4),i=0;i<4;i++){h[i]=c[i][e];g[i]=c[i][e]&128?c[i][e]<<1^283:c[i][e]<<1}c[0][e]=g[0]^h[1]^g[1]^h[2]^h[3];c[1][e]=h[0]^g[1]^h[2]^g[2]^h[3];c[2][e]=h[0]^h[1]^g[2]^h[3]^g[3];c[3][e]=h[0]^g[0]^h[1]^h[2]^g[3]}c=c;c=n(c,f,a,4)}c=o(c,4);c=p(c,4);c=n(c,f,b,4);b=Array(16);for(a=0;a<16;a++)b[a]=c[a%4][Math.floor(a/4)];return b}function o(d,f){for(var b=0;b<4;b++)for(var c=0;c<f;c++)d[b][c]=q[d[b][c]];return d}function p(d,f){for(var b=Array(4),c=1;c<4;c++){for(var a=0;a<4;a++)b[a]=d[c][(a+c)%f];for(a=
0;a<4;a++)d[c][a]=b[a]}return d}function n(d,f,b,c){for(var a=0;a<4;a++)for(var e=0;e<c;e++)d[a][e]^=f[b*4+e][a];return d}function l(d){for(var f=d.length/4,b=f+6,c=Array(4*(b+1)),a=Array(4),e=0;e<f;e++)c[e]=[d[4*e],d[4*e+1],d[4*e+2],d[4*e+3]];for(e=f;e<4*(b+1);e++){c[e]=Array(4);for(d=0;d<4;d++)a[d]=c[e-1][d];if(e%f==0){a=a;a[4]=a[0];for(d=0;d<4;d++)a[d]=a[d+1];a=r(a);for(d=0;d<4;d++)a[d]^=u[e/f][d]}else if(f>6&&e%f==4)a=r(a);for(d=0;d<4;d++)c[e][d]=c[e-f][d]^a[d]}return c}function r(d){for(var f=
0;f<4;f++)d[f]=q[d[f]];return d}function s(d){var f=[];d.replace(/(..)/g,function(b){f.push(parseInt(b,16))});return f}var q=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,
2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,
66,104,65,153,45,15,176,84,187,22],u=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];dojox.encoding.crypto.SimpleAES=new function(){this.encrypt=function(d,f){var b;var c=Array(32);for(b=0;b<32;b++)c[b]=f.charCodeAt(b)&255;var a=k(c,l(c));a=a.concat(a.slice(0,16));c=Array(16);var e=(new Date).getTime();for(b=0;b<4;b++)c[b]=e>>>b*8&255;for(b=0;b<4;b++)c[b+4]=e/4294967296>>>b*8&255;e=l(a);var h=Math.ceil(d.length/16);a=Array(h);
for(var g=0;g<h;g++){for(b=0;b<4;b++)c[15-b]=g>>>b*8&255;for(b=0;b<4;b++)c[15-b-4]=g/4294967296>>>b*8;var i=k(c,e),m=g<h-1?16:(d.length-1)%16+1,j="";for(b=0;b<m;b++){var t=d.charCodeAt(g*16+b)^i[b];j+=(t<16?"0":"")+t.toString(16)}a[g]=j}e="";for(b=0;b<8;b++)e+=(c[b]<16?"0":"")+c[b].toString(16);b=e+" "+a.join(" ");return b};this.decrypt=function(d,f){var b;b=d;for(var c=Array(32),a=0;a<32;a++)c[a]=f.charCodeAt(a)&255;a=l(c);a=k(c,a);a=a.concat(a.slice(0,16));c=l(a);b=b.split(" ");var e=Array(16);
e=s(b[0]);for(var h=Array(b.length-1),g=1;g<b.length;g++){for(a=0;a<4;a++)e[15-a]=g-1>>>a*8&255;for(a=0;a<4;a++)e[15-a-4]=g/4294967296-1>>>a*8&255;var i=k(e,c),m="",j=s(b[g]);for(a=0;a<j.length;a++){b[g].charCodeAt(a);m+=String.fromCharCode(j[a]^i[a])}h[g-1]=m}b=h.join("");return b}}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.number"]){dojo._hasResource["dojo.number"]=true;dojo.provide("dojo.number");dojo.require("dojo.i18n");dojo.requireLocalization("dojo.cldr","number",null,"ROOT,ar,ca,cs,da,de,el,en,en-au,en-gb,es,fi,fr,fr-ch,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-hant,zh-hk");dojo.require("dojo.string");dojo.require("dojo.regexp");dojo.getObject("number",true,dojo);dojo.number.format=function(a,b){b=dojo.mixin({},b||{});var c=dojo.i18n.normalizeLocale(b.locale);c=dojo.i18n.getLocalization("dojo.cldr",
"number",c);b.customs=c;c=b.pattern||c[(b.type||"decimal")+"Format"];if(isNaN(a)||Math.abs(a)==Infinity)return null;return dojo.number._applyPattern(a,c,b)};dojo.number._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;dojo.number._applyPattern=function(a,b,c){c=c||{};var d=c.customs.group,e=c.customs.decimal;b=b.split(";");var f=b[0];b=b[a<0?1:0]||"-"+f;if(b.indexOf("%")!=-1)a*=100;else if(b.indexOf("\u2030")!=-1)a*=1E3;else if(b.indexOf("\u00a4")!=-1){d=c.customs.currencyGroup||d;e=c.customs.currencyDecimal||
e;b=b.replace(/\u00a4{1,3}/,function(h){return c[["symbol","currency","displayName"][h.length-1]]||c.currency||""})}else if(b.indexOf("E")!=-1)throw Error("exponential notation not supported");var j=dojo.number._numberPatternRE;f=f.match(j);if(!f)throw Error("unable to find a number expression in pattern: "+b);if(c.fractional===false)c.places=0;return b.replace(j,dojo.number._formatAbsolute(a,f[0],{decimal:e,group:d,places:c.places,round:c.round}))};dojo.number.round=function(a,b,c){c=10/(c||10);
return(c*+a).toFixed(b)/c};(0.9).toFixed()==0&&function(){var a=dojo.number.round;dojo.number.round=function(b,c,d){var e=Math.pow(10,-c||0),f=Math.abs(b);if(!b||f>=e||f*Math.pow(10,c+1)<5)e=0;return a(b,c,d)+(b>0?e:-e)}}();dojo.number._formatAbsolute=function(a,b,c){c=c||{};if(c.places===true)c.places=0;if(c.places===Infinity)c.places=6;b=b.split(".");var d=typeof c.places=="string"&&c.places.indexOf(","),e=c.places;if(d)e=c.places.substring(d+1);else if(!(e>=0))e=(b[1]||[]).length;c.round<0||(a=
dojo.number.round(a,e,c.round));a=String(Math.abs(a)).split(".");var f=a[1]||"";if(b[1]||c.places){if(d)c.places=c.places.substring(0,d);d=c.places!==undefined?c.places:b[1]&&b[1].lastIndexOf("0")+1;if(d>f.length)a[1]=dojo.string.pad(f,d,"0",true);if(e<f.length)a[1]=f.substr(0,e)}else a[1]&&a.pop();e=b[0].replace(",","");d=e.indexOf("0");if(d!=-1){d=e.length-d;if(d>a[0].length)a[0]=dojo.string.pad(a[0],d);if(e.indexOf("#")==-1)a[0]=a[0].substr(a[0].length-d)}e=b[0].lastIndexOf(",");var j,h;if(e!=
-1){j=b[0].length-e-1;b=b[0].substr(0,e);e=b.lastIndexOf(",");if(e!=-1)h=b.length-e-1}b=[];for(e=a[0];e;){d=e.length-j;b.push(d>0?e.substr(d):e);e=d>0?e.slice(0,d):"";if(h){j=h;delete h}}a[0]=b.reverse().join(c.group||",");return a.join(c.decimal||".")};dojo.number.regexp=function(a){return dojo.number._parseInfo(a).regexp};dojo.number._parseInfo=function(a){a=a||{};var b=dojo.i18n.normalizeLocale(a.locale);b=dojo.i18n.getLocalization("dojo.cldr","number",b);var c=a.pattern||b[(a.type||"decimal")+
"Format"],d=b.group,e=b.decimal,f=1;if(c.indexOf("%")!=-1)f/=100;else if(c.indexOf("\u2030")!=-1)f/=1E3;else{var j=c.indexOf("\u00a4")!=-1;if(j){d=b.currencyGroup||d;e=b.currencyDecimal||e}}b=c.split(";");b.length==1&&b.push("-"+b[0]);b=dojo.regexp.buildGroupRE(b,function(h){h="(?:"+dojo.regexp.escapeString(h,".")+")";return h.replace(dojo.number._numberPatternRE,function(g){var k={signed:false,separator:a.strict?d:[d,""],fractional:a.fractional,decimal:e,exponent:false};g=g.split(".");var i=a.places;
if(g.length==1&&f!=1)g[1]="###";if(g.length==1||i===0)k.fractional=false;else{if(i===undefined)i=a.pattern?g[1].lastIndexOf("0")+1:Infinity;if(i&&a.fractional==undefined)k.fractional=true;if(!a.places&&i<g[1].length)i+=","+g[1].length;k.places=i}g=g[0].split(",");if(g.length>1){k.groupSize=g.pop().length;if(g.length>1)k.groupSize2=g.pop().length}return"("+dojo.number._realNumberRegexp(k)+")"})},true);if(j)b=b.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(h,g,k,i){h=dojo.regexp.escapeString(a[["symbol",
"currency","displayName"][k.length-1]]||a.currency||"");g=g?"[\\s\\xa0]":"";i=i?"[\\s\\xa0]":"";if(!a.strict){if(g)g+="*";if(i)i+="*";return"(?:"+g+h+i+")?"}return g+h+i});return{regexp:b.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:d,decimal:e,factor:f}};dojo.number.parse=function(a,b){var c=dojo.number._parseInfo(b),d=RegExp("^"+c.regexp+"$").exec(a);if(!d)return NaN;var e=d[1];if(!d[1]){if(!d[2])return NaN;e=d[2];c.factor*=-1}e=e.replace(RegExp("["+c.group+"\\s\\xa0]","g"),"").replace(c.decimal,".");
return e*c.factor};dojo.number._realNumberRegexp=function(a){a=a||{};if(!("places"in a))a.places=Infinity;if(typeof a.decimal!="string")a.decimal=".";if(!("fractional"in a)||/^0/.test(a.places))a.fractional=[true,false];if(!("exponent"in a))a.exponent=[true,false];if(!("eSigned"in a))a.eSigned=[true,false];var b=dojo.number._integerRegexp(a),c=dojo.regexp.buildGroupRE(a.fractional,function(e){var f="";if(e&&a.places!==0){f="\\"+a.decimal;if(a.places==Infinity)f="(?:"+f+"\\d+)?";else f+="\\d{"+a.places+
"}"}return f},true),d=dojo.regexp.buildGroupRE(a.exponent,function(e){if(e)return"([eE]"+dojo.number._integerRegexp({signed:a.eSigned})+")";return""});b=b+c;if(c)b="(?:(?:"+b+")|(?:"+c+"))";return b+d};dojo.number._integerRegexp=function(a){a=a||{};if(!("signed"in a))a.signed=[true,false];if("separator"in a){if(!("groupSize"in a))a.groupSize=3}else a.separator="";var b=dojo.regexp.buildGroupRE(a.signed,function(d){return d?"[-+]":""},true),c=dojo.regexp.buildGroupRE(a.separator,function(d){if(!d)return"(?:\\d+)";
d=dojo.regexp.escapeString(d);if(d==" ")d="\\s";else if(d=="\u00a0")d="\\s\\xa0";var e=a.groupSize,f=a.groupSize2;if(f){d="(?:0|[1-9]\\d{0,"+(f-1)+"}(?:["+d+"]\\d{"+f+"})*["+d+"]\\d{"+e+"})";return e-f>0?"(?:"+d+"|(?:0|[1-9]\\d{0,"+(e-1)+"}))":d}return"(?:0|[1-9]\\d{0,"+(e-1)+"}(?:["+d+"]\\d{"+e+"})*)"},true);return b+c}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojo.date.locale"]){dojo._hasResource["dojo.date.locale"]=true;dojo.provide("dojo.date.locale");dojo.require("dojo.date");dojo.require("dojo.cldr.supplemental");dojo.require("dojo.regexp");dojo.require("dojo.string");dojo.require("dojo.i18n");dojo.requireLocalization("dojo.cldr","gregorian",null,"ROOT,ar,ca,cs,da,de,el,en,en-au,en-ca,en-gb,es,fi,fr,fr-ch,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-hant,zh-hk,zh-tw");dojo.getObject("date.locale",true,dojo);(function(){function k(b,
d,g,f){return f.replace(/([a-z])\1*/ig,function(i){var a,e,c=i.charAt(0);i=i.length;var n=["abbr","wide","narrow"];switch(c){case "G":a=d[i<4?"eraAbbr":"eraNames"][b.getFullYear()<0?0:1];break;case "y":a=b.getFullYear();switch(i){case 1:break;case 2:if(!g.fullYear){a=String(a);a=a.substr(a.length-2);break}default:e=true}break;case "Q":case "q":a=Math.ceil((b.getMonth()+1)/3);e=true;break;case "M":a=b.getMonth();if(i<3){a=a+1;e=true}else{c=["months-format",n[i-3]].join("-");a=d[c][a]}break;case "w":a=
dojo.date.locale._getWeekOfYear(b,0);e=true;break;case "d":a=b.getDate();e=true;break;case "D":a=dojo.date.locale._getDayOfYear(b);e=true;break;case "E":a=b.getDay();if(i<3){a=a+1;e=true}else{c=["days-format",n[i-3]].join("-");a=d[c][a]}break;case "a":a=b.getHours()<12?"am":"pm";a=g[a]||d["dayPeriods-format-wide-"+a];break;case "h":case "H":case "K":case "k":e=b.getHours();switch(c){case "h":a=e%12||12;break;case "H":a=e;break;case "K":a=e%12;break;case "k":a=e||24}e=true;break;case "m":a=b.getMinutes();
e=true;break;case "s":a=b.getSeconds();e=true;break;case "S":a=Math.round(b.getMilliseconds()*Math.pow(10,i-3));e=true;break;case "v":case "z":if(a=dojo.date.locale._getZone(b,true,g))break;i=4;case "Z":a=dojo.date.locale._getZone(b,false,g);a=[a<=0?"+":"-",dojo.string.pad(Math.floor(Math.abs(a)/60),2),dojo.string.pad(Math.abs(a)%60,2)];if(i==4){a.splice(0,0,"GMT");a.splice(3,0,":")}a=a.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+f);}if(e)a=dojo.string.pad(a,
i);return a})}function m(b,d,g,f){var i=function(c){return c};d=d||i;g=g||i;f=f||i;var a=b.match(/(''|[^'])+/g),e=b.charAt(0)=="'";dojo.forEach(a,function(c,n){if(c){a[n]=(e?g:d)(c.replace(/''/g,"'"));e=!e}else a[n]=""});return f(a.join(""))}function j(b,d,g,f){f=dojo.regexp.escapeString(f);g.strict||(f=f.replace(" a"," ?a"));return f.replace(/([a-z])\1*/ig,function(i){var a;a=i.charAt(0);var e=i.length,c="",n="";if(g.strict){if(e>1)c="0{"+(e-1)+"}";if(e>2)n="0{"+(e-2)+"}"}else{c="0?";n="0{0,2}"}switch(a){case "y":a=
"\\d{2,4}";break;case "M":a=e>2?"\\S+?":c+"[1-9]|1[0-2]";break;case "D":a=c+"[1-9]|"+n+"[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6]";break;case "d":a="3[01]|[12]\\d|"+c+"[1-9]";break;case "w":a=c+"[1-9]|[1-4][0-9]|5[0-3]";break;case "E":a="\\S+";break;case "h":a=c+"[1-9]|1[0-2]";break;case "k":a=c+"\\d|1[01]";break;case "H":a=c+"\\d|1\\d|2[0-3]";break;case "K":a=c+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":a="[0-5]\\d";break;case "S":a="\\d{"+e+"}";break;case "a":e=g.am||d["dayPeriods-format-wide-am"];
c=g.pm||d["dayPeriods-format-wide-pm"];if(g.strict)a=e+"|"+c;else{a=e+"|"+c;if(e!=e.toLowerCase())a+="|"+e.toLowerCase();if(c!=c.toLowerCase())a+="|"+c.toLowerCase();if(a.indexOf(".")!=-1)a+="|"+a.replace(/\./g,"")}a=a.replace(/\./g,"\\.");break;default:a=".*"}b&&b.push(i);return"("+a+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}dojo.date.locale._getZone=function(b,d){return d?dojo.date.getTimezoneName(b):b.getTimezoneOffset()};dojo.date.locale.format=function(b,d){d=d||{};var g=dojo.i18n.normalizeLocale(d.locale),
f=d.formatLength||"short";g=dojo.date.locale._getGregorianBundle(g);var i=[],a=dojo.hitch(this,k,b,g,d);if(d.selector=="year")return m(g["dateFormatItem-yyyy"]||"yyyy",a);var e;if(d.selector!="date")(e=d.timePattern||g["timeFormat-"+f])&&i.push(m(e,a));if(d.selector!="time")(e=d.datePattern||g["dateFormat-"+f])&&i.push(m(e,a));return i.length==1?i[0]:g["dateTimeFormat-"+f].replace(/\{(\d+)\}/g,function(c,n){return i[n]})};dojo.date.locale.regexp=function(b){return dojo.date.locale._parseInfo(b).regexp};
dojo.date.locale._parseInfo=function(b){b=b||{};var d=dojo.i18n.normalizeLocale(b.locale);d=dojo.date.locale._getGregorianBundle(d);var g=b.formatLength||"short",f=b.datePattern||d["dateFormat-"+g],i=b.timePattern||d["timeFormat-"+g];g=b.selector=="date"?f:b.selector=="time"?i:d["dateTimeFormat-"+g].replace(/\{(\d+)\}/g,function(e,c){return[i,f][c]});var a=[];return{regexp:m(g,dojo.hitch(this,j,a,d,b)),tokens:a,bundle:d}};dojo.date.locale.parse=function(b,d){var g=/[\u200E\u200F\u202A\u202E]/g,f=
dojo.date.locale._parseInfo(d),i=f.tokens,a=f.bundle;g=RegExp("^"+f.regexp.replace(g,"")+"$",f.strict?"":"i").exec(b&&b.replace(g,""));if(!g)return null;var e=["abbr","wide","narrow"],c=[1970,0,1,0,0,0,0],n="";g=dojo.every(g,function(h,s){if(!s)return true;var l=i[s-1],o=l.length;switch(l.charAt(0)){case "y":if(o!=2&&d.strict)c[0]=h;else if(h<100){h=Number(h);o=""+(new Date).getFullYear();l=o.substring(0,2)*100;o=Math.min(Number(o.substring(2,4))+20,99);c[0]=h<o?l+h:l-100+h}else{if(d.strict)return false;
c[0]=h}break;case "M":if(o>2){l=a["months-format-"+e[o-3]].concat();if(!d.strict){h=h.replace(".","").toLowerCase();l=dojo.map(l,function(q){return q.replace(".","").toLowerCase()})}h=dojo.indexOf(l,h);if(h==-1)return false}else h--;c[1]=h;break;case "E":case "e":l=a["days-format-"+e[o-3]].concat();if(!d.strict){h=h.toLowerCase();l=dojo.map(l,function(q){return q.toLowerCase()})}h=dojo.indexOf(l,h);if(h==-1)return false;break;case "D":c[1]=0;case "d":c[2]=h;break;case "a":l=d.am||a["dayPeriods-format-wide-am"];
o=d.pm||a["dayPeriods-format-wide-pm"];if(!d.strict){var r=/\./g;h=h.replace(r,"").toLowerCase();l=l.replace(r,"").toLowerCase();o=o.replace(r,"").toLowerCase()}if(d.strict&&h!=l&&h!=o)return false;n=h==o?"p":h==l?"a":"";break;case "K":if(h==24)h=0;case "h":case "H":case "k":if(h>23)return false;c[3]=h;break;case "m":c[4]=h;break;case "s":c[5]=h;break;case "S":c[6]=h}return true});f=+c[3];if(n==="p"&&f<12)c[3]=f+12;else if(n==="a"&&f==12)c[3]=0;f=new Date(c[0],c[1],c[2],c[3],c[4],c[5],c[6]);d.strict&&
f.setFullYear(c[0]);var p=i.join(""),t=p.indexOf("d")!=-1;p=p.indexOf("M")!=-1;if(!g||p&&f.getMonth()>c[1]||t&&f.getDate()>c[2])return null;if(p&&f.getMonth()<c[1]||t&&f.getDate()<c[2])f=dojo.date.add(f,"hour",1);return f}})();(function(){var k=[];dojo.date.locale.addCustomFormats=function(m,j){k.push({pkg:m,name:j})};dojo.date.locale._getGregorianBundle=function(m){var j={};dojo.forEach(k,function(b){b=dojo.i18n.getLocalization(b.pkg,b.name,m);j=dojo.mixin(j,b)},this);return j}})();dojo.date.locale.addCustomFormats("dojo.cldr",
"gregorian");dojo.date.locale.getNames=function(k,m,j,b){var d;b=dojo.date.locale._getGregorianBundle(b);k=[k,j,m];if(j=="standAlone"){j=k.join("-");d=b[j];if(d[0]==1)d=undefined}k[1]="format";return(d||b[k.join("-")]).concat()};dojo.date.locale.isWeekend=function(k,m){var j=dojo.cldr.supplemental.getWeekend(m),b=(k||new Date).getDay();if(j.end<j.start){j.end+=7;if(b<j.start)b+=7}return b>=j.start&&b<=j.end};dojo.date.locale._getDayOfYear=function(k){return dojo.date.difference(new Date(k.getFullYear(),
0,1,k.getHours()),k)+1};dojo.date.locale._getWeekOfYear=function(k,m){if(arguments.length==1)m=0;var j=(new Date(k.getFullYear(),0,1)).getDay(),b=(j-m+7)%7;b=Math.floor((dojo.date.locale._getDayOfYear(k)+b-1)/7);j==m&&b++;return b}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base.popup"]){dojo._hasResource["dijit._base.popup"]=true;dojo.provide("dijit._base.popup");dojo.require("dijit._base.focus");dojo.require("dijit._base.place");dojo.require("dijit._base.window");dijit.popup={_stack:[],_beginZIndex:1E3,_idGen:1,_createWrapper:function(a){var b=a.declaredClass?a._popupWrapper:dojo.hasClass(a.parentNode,"dijitPopup")&&a.parentNode,c=a.domNode||a;if(!b){b=dojo.create("div",{"class":"dijitPopup",style:{display:"none"},role:"presentation"},
dojo.body());b.appendChild(c);c=c.style;c.display="";c.visibility="";c.position="";c.top="0px";if(a.declaredClass){a._popupWrapper=b;dojo.connect(a,"destroy",function(){dojo.destroy(b);delete a._popupWrapper})}}return b},moveOffScreen:function(a){a=this._createWrapper(a);dojo.style(a,{visibility:"hidden",top:"-9999px",display:""})},hide:function(a){a=this._createWrapper(a);dojo.style(a,"display","none")},getTopPopup:function(){for(var a=this._stack,b=a.length-1;b>0&&a[b].parent===a[b-1].widget;b--);
return a[b]},open:function(a){for(var b=this._stack,c=a.popup,d=a.orient||((a.parent?a.parent.isLeftToRight():dojo._isBodyLtr())?{BL:"TL",BR:"TR",TL:"BL",TR:"BR"}:{BR:"TR",BL:"TL",TR:"BR",TL:"BL"}),f=a.around,h=a.around&&a.around.id?a.around.id+"_dropdown":"popup_"+this._idGen++;b.length&&(!a.parent||!dojo.isDescendant(a.parent.domNode,b[b.length-1].widget.domNode));)dijit.popup.close(b[b.length-1].widget);var g=this._createWrapper(c);dojo.attr(g,{id:h,style:{zIndex:this._beginZIndex+b.length},"class":"dijitPopup "+
(c.baseClass||c["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:a.parent?a.parent.id:""});if(dojo.isIE||dojo.isMoz)if(!c.bgIframe)c.bgIframe=new dijit.BackgroundIframe(g);d=f?dijit.placeOnScreenAroundElement(g,f,d,c.orient?dojo.hitch(c,"orient"):null):dijit.placeOnScreen(g,a,d=="R"?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],a.padding);g.style.display="";g.style.visibility="visible";c.domNode.style.visibility="visible";f=[];f.push(dojo.connect(g,"onkeypress",this,function(e){if(e.charOrCode==
dojo.keys.ESCAPE&&a.onCancel){dojo.stopEvent(e);a.onCancel()}else if(e.charOrCode===dojo.keys.TAB){dojo.stopEvent(e);(e=this.getTopPopup())&&e.onCancel&&e.onCancel()}}));c.onCancel&&f.push(dojo.connect(c,"onCancel",a.onCancel));f.push(dojo.connect(c,c.onExecute?"onExecute":"onChange",this,function(){var e=this.getTopPopup();e&&e.onExecute&&e.onExecute()}));b.push({widget:c,parent:a.parent,onExecute:a.onExecute,onCancel:a.onCancel,onClose:a.onClose,handlers:f});c.onOpen&&c.onOpen(d);return d},close:function(a){for(var b=
this._stack;a&&dojo.some(b,function(h){return h.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,f=c.onClose;d.onClose&&d.onClose();dojo.forEach(c.handlers,dojo.disconnect);d&&d.domNode&&this.hide(d);f&&f()}}};dijit._frames=new function(){var a=[];this.pop=function(){var b;if(a.length){b=a.pop();b.style.display=""}else{if(dojo.isIE<9){b="<iframe src='"+(dojo.config.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html")+""||'javascript:""')+"' style='position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity=\"0\");'>";
b=dojo.doc.createElement(b)}else{b=dojo.create("iframe");b.src='javascript:""';b.className="dijitBackgroundIframe";dojo.style(b,"opacity",0.1)}b.tabIndex=-1;dijit.setWaiRole(b,"presentation")}return b};this.push=function(b){b.style.display="none";a.push(b)}};dijit.BackgroundIframe=function(a){if(!a.id)throw Error("no id");if(dojo.isIE||dojo.isMoz){var b=this.iframe=dijit._frames.pop();a.appendChild(b);if(dojo.isIE<7||dojo.isQuirks){this.resize(a);this._conn=dojo.connect(a,"onresize",this,function(){this.resize(a)})}else dojo.style(b,
{width:"100%",height:"100%"})}};dojo.extend(dijit.BackgroundIframe,{resize:function(a){this.iframe&&dojo.style(this.iframe,{width:a.offsetWidth+"px",height:a.offsetHeight+"px"})},destroy:function(){if(this._conn){dojo.disconnect(this._conn);this._conn=null}if(this.iframe){dijit._frames.push(this.iframe);delete this.iframe}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._base"]){dojo._hasResource["dijit._base"]=true;dojo.provide("dijit._base");dojo.require("dijit._base.focus");dojo.require("dijit._base.manager");dojo.require("dijit._base.place");dojo.require("dijit._base.popup");dojo.require("dijit._base.scroll");dojo.require("dijit._base.sniff");dojo.require("dijit._base.typematic");dojo.require("dijit._base.wai");dojo.require("dijit._base.window")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Widget"]){dojo._hasResource["dijit._Widget"]=true;dojo.provide("dijit._Widget");dojo.require("dijit._WidgetBase");dojo.require("dijit._base");dojo.connect(dojo,"_connect",function(a,c){a&&dojo.isFunction(a._onConnect)&&a._onConnect(c)});dijit._connectOnUseEventHandler=function(){};dijit._lastKeyDownNode=null;dojo.isIE?function(){var a=function(c){dijit._lastKeyDownNode=c.srcElement};dojo.doc.attachEvent("onkeydown",a);dojo.addOnWindowUnload(function(){dojo.doc.detachEvent("onkeydown",
a)})}():dojo.doc.addEventListener("keydown",function(a){dijit._lastKeyDownNode=a.target},true);(function(){dojo.declare("dijit._Widget",dijit._WidgetBase,{_deferredConnects:{onClick:"",onDblClick:"",onKeyDown:"",onKeyPress:"",onKeyUp:"",onMouseMove:"",onMouseDown:"",onMouseOut:"",onMouseOver:"",onMouseLeave:"",onMouseEnter:"",onMouseUp:""},onClick:dijit._connectOnUseEventHandler,onDblClick:dijit._connectOnUseEventHandler,onKeyDown:dijit._connectOnUseEventHandler,onKeyPress:dijit._connectOnUseEventHandler,
onKeyUp:dijit._connectOnUseEventHandler,onMouseDown:dijit._connectOnUseEventHandler,onMouseMove:dijit._connectOnUseEventHandler,onMouseOut:dijit._connectOnUseEventHandler,onMouseOver:dijit._connectOnUseEventHandler,onMouseLeave:dijit._connectOnUseEventHandler,onMouseEnter:dijit._connectOnUseEventHandler,onMouseUp:dijit._connectOnUseEventHandler,create:function(){this._deferredConnects=dojo.clone(this._deferredConnects);for(var a in this.attributeMap)delete this._deferredConnects[a];for(a in this._deferredConnects)this[a]!==
dijit._connectOnUseEventHandler&&delete this._deferredConnects[a];this.inherited(arguments);if(this.domNode)for(a in this.params)this._onConnect(a)},_onConnect:function(a){if(a in this._deferredConnects){this.connect(this[this._deferredConnects[a]||"domNode"],a.toLowerCase(),a);delete this._deferredConnects[a]}},focused:false,isFocusable:function(){return this.focus&&dojo.style(this.domNode,"display")!="none"},onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()},
setAttribute:function(a,c){dojo.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,c)},attr:function(a){if(dojo.config.isDebug){var c=arguments.callee._ach||(arguments.callee._ach={}),e=(arguments.callee.caller||"unknown caller").toString();if(!c[e]){dojo.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+e,"","2.0");c[e]=true}}return arguments.length>=2||typeof a==="object"?this.set.apply(this,
arguments):this.get(a)},nodesWithKeyClick:["input","button"],connect:function(a,c,e){var d=dojo,f=d._connect,g=this.inherited(arguments,[a,c=="ondijitclick"?"onclick":c,e]);if(c=="ondijitclick")if(d.indexOf(this.nodesWithKeyClick,a.nodeName.toLowerCase())==-1){var h=d.hitch(this,e);g.push(f(a,"onkeydown",this,function(b){if((b.keyCode==d.keys.ENTER||b.keyCode==d.keys.SPACE)&&!b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey){dijit._lastKeyDownNode=b.target;"openDropDown"in this&&a==this._buttonNode||
b.preventDefault()}}),f(a,"onkeyup",this,function(b){if((b.keyCode==d.keys.ENTER||b.keyCode==d.keys.SPACE)&&b.target==dijit._lastKeyDownNode&&!b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey){dijit._lastKeyDownNode=null;return h(b)}}))}return g},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return true}})})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._DialogMixin"]){dojo._hasResource["dijit._DialogMixin"]=true;dojo.provide("dijit._DialogMixin");dojo.require("dijit._Widget");dojo.declare("dijit._DialogMixin",null,{attributeMap:dijit._Widget.prototype.attributeMap,execute:function(){},onCancel:function(){},onExecute:function(){},_onSubmit:function(){this.onExecute();this.execute(this.get("value"))},_getFocusItems:function(){var a=dijit._getTabNavigable(this.containerNode);this._firstFocusItem=a.lowest||a.first||this.closeButtonNode||
this.domNode;this._lastFocusItem=a.last||a.highest||this._firstFocusItem}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._HasDropDown"]){dojo._hasResource["dijit._HasDropDown"]=true;dojo.provide("dijit._HasDropDown");dojo.require("dijit._Widget");dojo.declare("dijit._HasDropDown",null,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:true,forceWidth:false,maxHeight:0,dropDownPosition:["below","above"],_stopClickEvents:true,_onDropDownMouseDown:function(){if(!(this.disabled||this.readOnly)){this._docHandler=this.connect(dojo.doc,"onmouseup",
"_onDropDownMouseUp");this.toggleDropDown()}},_onDropDownMouseUp:function(a){a&&this._docHandler&&this.disconnect(this._docHandler);var c=this.dropDown,f=false;if(a&&this._opened){var b=dojo.position(this._buttonNode,true);if(!(a.pageX>=b.x&&a.pageX<=b.x+b.w)||!(a.pageY>=b.y&&a.pageY<=b.y+b.h)){for(b=a.target;b&&!f;)if(dojo.hasClass(b,"dijitPopup"))f=true;else b=b.parentNode;if(f){b=a.target;if(c.onItemClick){for(var d;b&&!(d=dijit.byNode(b));)b=b.parentNode;d&&d.onClick&&d.getParent&&d.getParent().onItemClick(d,
a)}return}}}this._opened&&c.focus&&c.autoFocus!==false&&window.setTimeout(dojo.hitch(c,"focus"),1)},_onDropDownClick:function(a){this._stopClickEvents&&dojo.stopEvent(a)},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";dojo.addClass(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);this.connect(this._buttonNode,"onmousedown","_onDropDownMouseDown");this.connect(this._buttonNode,"onclick","_onDropDownClick");this.connect(this.focusNode,"onkeypress","_onKey")},destroy:function(){if(this.dropDown){this.dropDown._destroyed||this.dropDown.destroyRecursive();delete this.dropDown}this.inherited(arguments)},_onKey:function(a){if(!(this.disabled||
this.readOnly)){var c=this.dropDown,f=a.target;if(c&&this._opened&&c.handleKey)if(c.handleKey(a)===false){dojo.stopEvent(a);return}if(c&&this._opened&&a.charOrCode==dojo.keys.ESCAPE){this.closeDropDown();dojo.stopEvent(a)}else if(!this._opened&&(a.charOrCode==dojo.keys.DOWN_ARROW||(a.charOrCode==dojo.keys.ENTER||a.charOrCode==" ")&&((f.tagName||"").toLowerCase()!=="input"||f.type&&f.type.toLowerCase()!=="text"))){this.toggleDropDown();(c=this.dropDown)&&c.focus&&setTimeout(dojo.hitch(c,"focus"),1);
dojo.stopEvent(a)}}},_onBlur:function(){this.closeDropDown(dijit._curFocus&&this.dropDown&&dojo.isDescendant(dijit._curFocus,this.dropDown.domNode));this.inherited(arguments)},isLoaded:function(){return true},loadDropDown:function(a){a()},toggleDropDown:function(){if(!(this.disabled||this.readOnly))if(this._opened)this.closeDropDown();else this.isLoaded()?this.openDropDown():this.loadDropDown(dojo.hitch(this,"openDropDown"))},openDropDown:function(){var a=this.dropDown,c=a.domNode,f=this._aroundNode||
this.domNode,b=this;if(!this._preparedNode){this._preparedNode=true;if(c.style.width)this._explicitDDWidth=true;if(c.style.height)this._explicitDDHeight=true}if(this.maxHeight||this.forceWidth||this.autoWidth){var d={display:"",visibility:"hidden"};if(!this._explicitDDWidth)d.width="";if(!this._explicitDDHeight)d.height="";dojo.style(c,d);d=this.maxHeight;if(d==-1){d=dojo.window.getBox();var e=dojo.position(f,false);d=Math.floor(Math.max(e.y,d.h-(e.y+e.h)))}a.startup&&!a._started&&a.startup();dijit.popup.moveOffScreen(a);
e=dojo._getMarginSize(c);var g=d&&e.h>d;dojo.style(c,{overflowX:"hidden",overflowY:g?"auto":"hidden"});if(g){e.h=d;if("w"in e)e.w+=16}else delete e.h;if(this.forceWidth)e.w=f.offsetWidth;else if(this.autoWidth)e.w=Math.max(e.w,f.offsetWidth);else delete e.w;dojo.isFunction(a.resize)?a.resize(e):dojo.marginBox(c,e)}a=dijit.popup.open({parent:this,popup:a,around:f,orient:dijit.getPopupAroundAlignment(this.dropDownPosition&&this.dropDownPosition.length?this.dropDownPosition:["below"],this.isLeftToRight()),
onExecute:function(){b.closeDropDown(true)},onCancel:function(){b.closeDropDown(true)},onClose:function(){dojo.attr(b._popupStateNode,"popupActive",false);dojo.removeClass(b._popupStateNode,"dijitHasDropDownOpen");b._opened=false}});dojo.attr(this._popupStateNode,"popupActive","true");dojo.addClass(b._popupStateNode,"dijitHasDropDownOpen");this._opened=true;return a},closeDropDown:function(a){if(this._opened){a&&this.focus();dijit.popup.close(this.dropDown);this._opened=false}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout._LayoutWidget"]){dojo._hasResource["dijit.layout._LayoutWidget"]=true;dojo.provide("dijit.layout._LayoutWidget");dojo.require("dijit._Widget");dojo.require("dijit._Container");dojo.require("dijit._Contained");dojo.declare("dijit.layout._LayoutWidget",[dijit._Widget,dijit._Container,dijit._Contained],{baseClass:"dijitLayoutContainer",isLayoutContainer:true,buildRendering:function(){this.inherited(arguments);dojo.addClass(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var b=this.getParent&&this.getParent();if(!(b&&b.isLayoutContainer)){this.resize();this.connect(dojo.isIE?this.domNode:dojo.global,"onresize",function(){this.resize()})}}},resize:function(b,e){var a=this.domNode;if(b){dojo.marginBox(a,b);if(b.t)a.style.top=b.t+"px";if(b.l)a.style.left=b.l+"px"}var d=e||{};dojo.mixin(d,b||{});if(!("h"in d)||!("w"in d))d=dojo.mixin(dojo.marginBox(a),d);var f=dojo.getComputedStyle(a),i=dojo._getMarginExtents(a,f),c=dojo._getBorderExtents(a,f);d=this._borderBox={w:d.w-
(i.w+c.w),h:d.h-(i.h+c.h)};i=dojo._getPadExtents(a,f);this._contentBox={l:dojo._toPixelValue(a,f.paddingLeft),t:dojo._toPixelValue(a,f.paddingTop),w:d.w-i.w,h:d.h-i.h};this.layout()},layout:function(){},_setupChild:function(b){dojo.addClass(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b){this.inherited(arguments);this._started&&this._setupChild(b)},removeChild:function(b){dojo.removeClass(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+
this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}});dijit.layout.marginBox2contentBox=function(b,e){var a=dojo.getComputedStyle(b),d=dojo._getMarginExtents(b,a),f=dojo._getPadBorderExtents(b,a);return{l:dojo._toPixelValue(b,a.paddingLeft),t:dojo._toPixelValue(b,a.paddingTop),w:e.w-(d.w+f.w),h:e.h-(d.h+f.h)}};(function(){var b=function(e,a){e.resize?e.resize(a):dojo.marginBox(e.domNode,a);dojo.mixin(e,dojo.marginBox(e.domNode));dojo.mixin(e,a)};dijit.layout.layoutChildren=function(e,a,
d,f,i){a=dojo.mixin({},a);dojo.addClass(e,"dijitLayoutContainer");d=dojo.filter(d,function(c){return c.region!="center"&&c.layoutAlign!="client"}).concat(dojo.filter(d,function(c){return c.region=="center"||c.layoutAlign=="client"}));dojo.forEach(d,function(c){var h=c.domNode,g=c.region||c.layoutAlign,j=h.style;j.left=a.l+"px";j.top=a.t+"px";j.bottom=j.right="auto";dojo.addClass(h,"dijitAlign"+(g.substring(0,1).toUpperCase()+g.substring(1)));h={};if(f&&f==c.id)h[c.region=="top"||c.region=="bottom"?
"h":"w"]=i;if(g=="top"||g=="bottom"){h.w=a.w;b(c,h);a.h-=c.h;if(g=="top")a.t+=c.h;else j.top=a.t+a.h+"px"}else if(g=="left"||g=="right"){h.h=a.h;b(c,h);a.w-=c.w;if(g=="left")a.l+=c.w;else j.left=a.l+a.w+"px"}else if(g=="client"||g=="center")b(c,a)})}})()};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit._Templated"]){dojo._hasResource["dijit._Templated"]=true;dojo.provide("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dojo.string");dojo.require("dojo.parser");dojo.require("dojo.cache");dojo.declare("dijit._Templated",null,{templateString:null,templatePath:null,widgetsInTemplate:false,_skipNodeCache:false,_earlyTemplatedStartup:false,constructor:function(){this._attachPoints=[];this._attachEvents=[]},_stringRepl:function(b){var a=this.declaredClass,f=
this;return dojo.string.substitute(b,this,function(e,d){if(d.charAt(0)=="!")e=dojo.getObject(d.substr(1),false,f);if(typeof e=="undefined")throw Error(a+" template:"+d);if(e==null)return"";return d.charAt(0)=="!"?e:e.toString().replace(/"/g,"&quot;")},this)},buildRendering:function(){var b=dijit._Templated.getCachedTemplate(this.templatePath,this.templateString,this._skipNodeCache),a;if(dojo.isString(b)){a=dojo._toDom(this._stringRepl(b));if(a.nodeType!=1)throw Error("Invalid template: "+b);}else a=
b.cloneNode(true);this.domNode=a;this.inherited(arguments);this._attachTemplateNodes(a);if(this.widgetsInTemplate){b=this._startupWidgets=dojo.parser.parse(a,{noStart:!this._earlyTemplatedStartup,template:true,inherited:{dir:this.dir,lang:this.lang},propsThis:this,scope:"dojo"});this._supportingWidgets=dijit.findWidgets(a);this._attachTemplateNodes(b,function(f,e){return f[e]})}this._fillContent(this.srcNodeRef)},_fillContent:function(b){var a=this.containerNode;if(b&&a)for(;b.hasChildNodes();)a.appendChild(b.firstChild)},
_attachTemplateNodes:function(b,a){a=a||function(g,k){return g.getAttribute(k)};for(var f=dojo.isArray(b)?b:b.all||b.getElementsByTagName("*"),e=dojo.isArray(b)?0:-1;e<f.length;e++){var d=e==-1?b:f[e];if(!(this.widgetsInTemplate&&(a(d,"dojoType")||a(d,"data-dojo-type")))){var c=a(d,"dojoAttachPoint")||a(d,"data-dojo-attach-point");if(c)for(var i=c.split(/\s*,\s*/);c=i.shift();){if(dojo.isArray(this[c]))this[c].push(d);else this[c]=d;this._attachPoints.push(c)}if(c=a(d,"dojoAttachEvent")||a(d,"data-dojo-attach-event")){i=
c.split(/\s*,\s*/);for(var j=dojo.trim;c=i.shift();)if(c){var h=null;if(c.indexOf(":")!=-1){h=c.split(":");c=j(h[0]);h=j(h[1])}else c=j(c);h||(h=c);this._attachEvents.push(this.connect(d,c,h))}}(c=a(d,"waiRole"))&&dijit.setWaiRole(d,c);(c=a(d,"waiState"))&&dojo.forEach(c.split(/\s*,\s*/),function(g){if(g.indexOf("-")!=-1){g=g.split("-");dijit.setWaiState(d,g[0],g[1])}})}}},startup:function(){dojo.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&b.startup()});this.inherited(arguments)},
destroyRendering:function(){dojo.forEach(this._attachPoints,function(b){delete this[b]},this);this._attachPoints=[];dojo.forEach(this._attachEvents,this.disconnect,this);this._attachEvents=[];this.inherited(arguments)}});dijit._Templated._templateCache={};dijit._Templated.getCachedTemplate=function(b,a,f){var e=dijit._Templated._templateCache,d=a||b,c=e[d];if(c){try{if(!c.ownerDocument||c.ownerDocument==dojo.doc)return c}catch(i){}dojo.destroy(c)}a||(a=dojo.cache(b,{sanitize:true}));a=dojo.string.trim(a);
if(f||a.match(/\$\{([^\}]+)\}/g))return e[d]=a;else{b=dojo._toDom(a);if(b.nodeType!=1)throw Error("Invalid template: "+a);return e[d]=b}};dojo.isIE&&dojo.addOnWindowUnload(function(){var b=dijit._Templated._templateCache,a;for(a in b){var f=b[a];typeof f=="object"&&dojo.destroy(f);delete b[a]}});dojo.extend(dijit._Widget,{dojoAttachEvent:"",dojoAttachPoint:"",waiRole:"",waiState:""})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.Tooltip"]){dojo._hasResource["dijit.Tooltip"]=true;dojo.provide("dijit.Tooltip");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.declare("dijit._MasterTooltip",[dijit._Widget,dijit._Templated],{duration:dijit.defaultDuration,templateString:dojo.cache("dijit","templates/Tooltip.html",'<div class="dijitTooltip dijitTooltipLeft" id="dojoTooltip"\n\t><div class="dijitTooltipContainer dijitTooltipContents" dojoAttachPoint="containerNode" role=\'alert\'></div\n\t><div class="dijitTooltipConnector" dojoAttachPoint="connectorNode"></div\n></div>\n'),
postCreate:function(){dojo.body().appendChild(this.domNode);this.bgIframe=new dijit.BackgroundIframe(this.domNode);this.fadeIn=dojo.fadeIn({node:this.domNode,duration:this.duration,onEnd:dojo.hitch(this,"_onShow")});this.fadeOut=dojo.fadeOut({node:this.domNode,duration:this.duration,onEnd:dojo.hitch(this,"_onHide")})},show:function(a,b,c,d){if(!(this.aroundNode&&this.aroundNode===b)){this.domNode.width="auto";if(this.fadeOut.status()=="playing")this._onDeck=arguments;else{this.containerNode.innerHTML=
a;dijit.placeOnScreenAroundElement(this.domNode,b,dijit.getPopupAroundAlignment(c&&c.length?c:dijit.Tooltip.defaultPosition,!d),dojo.hitch(this,"orient"));dojo.style(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=true;this.aroundNode=b}}},orient:function(a,b,c,d,h){this.connectorNode.style.top="";var i=d.w-this.connectorNode.offsetWidth;a.className="dijitTooltip "+{"BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight",
"TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[b+"-"+c];this.domNode.style.width="auto";var f=dojo.contentBox(this.domNode),g=Math.min(Math.max(i,1),f.w),e=g<f.w;this.domNode.style.width=g+"px";if(e){this.containerNode.style.overflow="auto";e=this.containerNode.scrollWidth;this.containerNode.style.overflow="visible";if(e>g){e=e+dojo.style(this.domNode,"paddingLeft")+dojo.style(this.domNode,"paddingRight");this.domNode.style.width=e+"px"}}if(c.charAt(0)==
"B"&&b.charAt(0)=="B"){a=dojo.marginBox(a);b=this.connectorNode.offsetHeight;if(a.h>d.h){this.connectorNode.style.top=d.h-h.h/2-b/2+"px";this.connectorNode.style.bottom=""}else{this.connectorNode.style.bottom=Math.min(Math.max(h.h/2-b/2,0),a.h-b)+"px";this.connectorNode.style.top=""}}else{this.connectorNode.style.top="";this.connectorNode.style.bottom=""}return Math.max(0,f.w-i)},_onShow:function(){if(dojo.isIE)this.domNode.style.filter=""},hide:function(a){if(this._onDeck&&this._onDeck[1]==a)this._onDeck=
null;else if(this.aroundNode===a){this.fadeIn.stop();this.isShowingNow=false;this.aroundNode=null;this.fadeOut.play()}},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";if(this._onDeck){this.show.apply(this,this._onDeck);this._onDeck=null}}});dijit.showTooltip=function(a,b,c,d){if(!dijit._masterTT)dijit._masterTT=new dijit._MasterTooltip;return dijit._masterTT.show(a,b,c,d)};dijit.hideTooltip=function(a){if(!dijit._masterTT)dijit._masterTT=new dijit._MasterTooltip;
return dijit._masterTT.hide(a)};dojo.declare("dijit.Tooltip",dijit._Widget,{label:"",showDelay:400,connectId:[],position:[],_setConnectIdAttr:function(a){dojo.forEach(this._connections||[],function(c){dojo.forEach(c,dojo.hitch(this,"disconnect"))},this);var b=dojo.isArrayLike(a)?a:a?[a]:[];this._connections=dojo.map(b,function(c){return(c=dojo.byId(c))?[this.connect(c,"onmouseenter","_onTargetMouseEnter"),this.connect(c,"onmouseleave","_onTargetMouseLeave"),this.connect(c,"onfocus","_onTargetFocus"),
this.connect(c,"onblur","_onTargetBlur")]:[]},this);this._set("connectId",a);this._connectIds=b},addTarget:function(a){a=a.id||a;dojo.indexOf(this._connectIds,a)==-1&&this.set("connectId",this._connectIds.concat(a))},removeTarget:function(a){a=dojo.indexOf(this._connectIds,a.id||a);if(a>=0){this._connectIds.splice(a,1);this.set("connectId",this._connectIds)}},buildRendering:function(){this.inherited(arguments);dojo.addClass(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);
var a=this.connectId;dojo.forEach(dojo.isArrayLike(a)?a:[a],this.addTarget,this)},_onTargetMouseEnter:function(a){this._onHover(a)},_onTargetMouseLeave:function(a){this._onUnHover(a)},_onTargetFocus:function(a){this._focus=true;this._onHover(a)},_onTargetBlur:function(a){this._focus=false;this._onUnHover(a)},_onHover:function(a){if(!this._showTimer){var b=a.target;this._showTimer=setTimeout(dojo.hitch(this,function(){this.open(b)}),this.showDelay)}},_onUnHover:function(){if(!this._focus){if(this._showTimer){clearTimeout(this._showTimer);
delete this._showTimer}this.close()}},open:function(a){if(this._showTimer){clearTimeout(this._showTimer);delete this._showTimer}dijit.showTooltip(this.label||this.domNode.innerHTML,a,this.position,!this.isLeftToRight());this._connectNode=a;this.onShow(a,this.position)},close:function(){if(this._connectNode){dijit.hideTooltip(this._connectNode);delete this._connectNode;this.onHide()}if(this._showTimer){clearTimeout(this._showTimer);delete this._showTimer}},onShow:function(){},onHide:function(){},uninitialize:function(){this.close();
this.inherited(arguments)}});dijit.Tooltip.defaultPosition=["after","before"]};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.MenuSeparator"]){dojo._hasResource["dijit.MenuSeparator"]=true;dojo.provide("dijit.MenuSeparator");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Contained");dojo.declare("dijit.MenuSeparator",[dijit._Widget,dijit._Templated,dijit._Contained],{templateString:dojo.cache("dijit","templates/MenuSeparator.html",'<tr class="dijitMenuSeparator">\n\t<td class="dijitMenuSeparatorIconCell">\n\t\t<div class="dijitMenuSeparatorTop"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n\t<td colspan="3" class="dijitMenuSeparatorLabelCell">\n\t\t<div class="dijitMenuSeparatorTop dijitMenuSeparatorLabel"></div>\n\t\t<div class="dijitMenuSeparatorBottom"></div>\n\t</td>\n</tr>\n'),
buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.domNode,false)},isFocusable:function(){return false}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form._FormWidget"]){dojo._hasResource["dijit.form._FormWidget"]=true;dojo.provide("dijit.form._FormWidget");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._CssStateMixin");dojo.declare("dijit.form._FormWidget",[dijit._Widget,dijit._Templated,dijit._CssStateMixin],{name:"",alt:"",value:"",type:"text",tabIndex:"0",disabled:false,intermediateChanges:false,scrollOnFocus:true,attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,
{value:"focusNode",id:"focusNode",tabIndex:"focusNode",alt:"focusNode",title:"focusNode"}),postMixInProperties:function(){this.nameAttrSetting=this.name?'name="'+this.name.replace(/'/g,"&quot;")+'"':"";this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onmousedown","_onMouseDown")},_setDisabledAttr:function(a){this._set("disabled",a);dojo.attr(this.focusNode,"disabled",a);this.valueNode&&dojo.attr(this.valueNode,"disabled",a);dijit.setWaiState(this.focusNode,
"disabled",a);if(a){this._set("hovering",false);this._set("active",false);a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"focusNode";dojo.forEach(dojo.isArray(a)?a:[a],function(b){b=this[b];dojo.isWebKit||dijit.hasDefaultTabStop(b)?b.setAttribute("tabIndex","-1"):b.removeAttribute("tabIndex")},this)}else this.tabIndex!=""&&this.focusNode.setAttribute("tabIndex",this.tabIndex)},setDisabled:function(a){dojo.deprecated("setDisabled("+a+") is deprecated. Use set('disabled',"+a+") instead.",
"","2.0");this.set("disabled",a)},_onFocus:function(){this.scrollOnFocus&&dojo.window.scrollIntoView(this.domNode);this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&dojo.style(this.domNode,"display")!="none"},focus:function(){this.disabled||dijit.focus(this.focusNode)},compare:function(a,b){return typeof a=="number"&&typeof b=="number"?isNaN(a)&&isNaN(b)?0:a-b:a>b?1:a<b?-1:0},onChange:function(){},_onChangeActive:false,_handleOnChange:function(a,b){if(this._lastValueReported==
undefined&&(b===null||!this._onChangeActive))this._resetValue=this._lastValueReported=a;this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||this.compare(a,this._lastValueReported)!=0;if((this.intermediateChanges||b||b===undefined)&&this._pendingOnChange){this._lastValueReported=a;this._pendingOnChange=false;if(this._onChangeActive){this._onChangeHandle&&clearTimeout(this._onChangeHandle);this._onChangeHandle=setTimeout(dojo.hitch(this,function(){this._onChangeHandle=
null;this.onChange(a)}),0)}}},create:function(){this.inherited(arguments);this._onChangeActive=true},destroy:function(){if(this._onChangeHandle){clearTimeout(this._onChangeHandle);this.onChange(this._lastValueReported)}this.inherited(arguments)},setValue:function(a){dojo.deprecated("dijit.form._FormWidget:setValue("+a+") is deprecated.  Use set('value',"+a+") instead.","","2.0");this.set("value",a)},getValue:function(){dojo.deprecated(this.declaredClass+"::getValue() is deprecated. Use get('value') instead.",
"","2.0");return this.get("value")},_onMouseDown:function(a){if(!a.ctrlKey&&dojo.mouseButtons.isLeft(a)&&this.isFocusable())var b=this.connect(dojo.body(),"onmouseup",function(){this.isFocusable()&&this.focus();this.disconnect(b)})}});dojo.declare("dijit.form._FormValueWidget",dijit.form._FormWidget,{readOnly:false,attributeMap:dojo.delegate(dijit.form._FormWidget.prototype.attributeMap,{value:"",readOnly:"focusNode"}),_setReadOnlyAttr:function(a){dojo.attr(this.focusNode,"readOnly",a);dijit.setWaiState(this.focusNode,
"readonly",a);this._set("readOnly",a)},postCreate:function(){this.inherited(arguments);if(dojo.isIE)this.connect(this.focusNode||this.domNode,"onkeydown",this._onKeyDown);if(this._resetValue===undefined)this._lastValueReported=this._resetValue=this.value},_setValueAttr:function(a,b){this._handleOnChange(a,b)},_handleOnChange:function(a){this._set("value",a);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,false)},reset:function(){this._hasBeenBlurred=false;this._setValueAttr(this._resetValue,
true)},_onKeyDown:function(a){if(a.keyCode==dojo.keys.ESCAPE&&!(a.ctrlKey||a.altKey||a.metaKey)){var b;if(dojo.isIE){a.preventDefault();b=document.createEventObject();b.keyCode=dojo.keys.ESCAPE;b.shiftKey=a.shiftKey;a.srcElement.fireEvent("onkeypress",b)}}},_layoutHackIE7:function(){if(dojo.isIE==7)for(var a=this.domNode,b=a.parentNode,c=a.firstChild||a,e=c.style.filter,d=this;b&&b.clientHeight==0;){(function(){var f=d.connect(b,"onscroll",function(){d.disconnect(f);c.style.filter=(new Date).getMilliseconds();
setTimeout(function(){c.style.filter=e},0)})})();b=b.parentNode}}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.TextBox"]){dojo._hasResource["dijit.form.TextBox"]=true;dojo.provide("dijit.form.TextBox");dojo.require("dijit.form._FormWidget");dojo.declare("dijit.form.TextBox",dijit.form._FormValueWidget,{trim:false,uppercase:false,lowercase:false,propercase:false,maxLength:"",selectOnClick:false,placeHolder:"",templateString:dojo.cache("dijit.form","templates/TextBox.html",'<div class="dijit dijitReset dijitInline dijitLeft" id="widget_${id}" role="presentation"\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class="dijitReset dijitInputInner" dojoAttachPoint=\'textbox,focusNode\' autocomplete="off"\n\t\t\t${!nameAttrSetting} type=\'${type}\'\n\t/></div\n></div>\n'),
_singleNodeTemplate:'<input class="dijit dijitReset dijitLeft dijitInputField" dojoAttachPoint="textbox,focusNode" autocomplete="off" type="${type}" ${!nameAttrSetting} />',_buttonInputDisabled:dojo.isIE?"disabled":"",baseClass:"dijitTextBox",attributeMap:dojo.delegate(dijit.form._FormValueWidget.prototype.attributeMap,{maxLength:"focusNode"}),postMixInProperties:function(){var a=this.type.toLowerCase();if(this.templateString&&this.templateString.toLowerCase()=="input"||(a=="hidden"||a=="file")&&
this.templateString==dijit.form.TextBox.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},_setPlaceHolderAttr:function(a){this._set("placeHolder",a);if(!this._phspan){this._attachPoints.push("_phspan");this._phspan=dojo.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after")}this._phspan.innerHTML="";this._phspan.appendChild(document.createTextNode(a));this._updatePlaceHolder()},_updatePlaceHolder:function(){if(this._phspan)this._phspan.style.display=
this.placeHolder&&!this._focused&&!this.textbox.value?"":"none"},_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(a,b,c){var d;if(a!==undefined){d=this.filter(a);if(typeof c!="string")c=d!==null&&(typeof d!="number"||!isNaN(d))?this.filter(this.format(d,this.constraints)):""}if(c!=null&&c!=undefined&&(typeof c!="number"||!isNaN(c))&&this.textbox.value!=c){this.textbox.value=c;this._set("displayedValue",this.get("displayedValue"))}this._updatePlaceHolder();
this.inherited(arguments,[d,b])},displayedValue:"",getDisplayedValue:function(){dojo.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use set('displayedValue') instead.","","2.0");return this.get("displayedValue")},_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},setDisplayedValue:function(a){dojo.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",a)},_setDisplayedValueAttr:function(a){if(a===
null||a===undefined)a="";else if(typeof a!="string")a=String(a);this.textbox.value=a;this._setValueAttr(this.get("value"),undefined);this._set("displayedValue",this.get("displayedValue"))},format:function(a){return a==null||a==undefined?"":a.toString?a.toString():a},parse:function(a){return a},_refreshState:function(){},_onInput:function(a){if(a&&a.type&&/key/i.test(a.type)&&a.keyCode)switch(a.keyCode){case dojo.keys.SHIFT:case dojo.keys.ALT:case dojo.keys.CTRL:case dojo.keys.TAB:return}if(this.intermediateChanges){var b=
this;setTimeout(function(){b._handleOnChange(b.get("value"),false)},0)}this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){dojo.isIE&&setTimeout(dojo.hitch(this,function(){var a=dojo.getComputedStyle(this.domNode);if(a)if(a=a.fontFamily){var b=this.domNode.getElementsByTagName("INPUT");if(b)for(var c=0;c<b.length;c++)b[c].style.fontFamily=a}}),0);this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);if(dojo.isMoz||dojo.isOpera)this.connect(this.textbox,
"oninput","_onInput");else{this.connect(this.textbox,"onkeydown","_onInput");this.connect(this.textbox,"onkeyup","_onInput");this.connect(this.textbox,"onpaste","_onInput");this.connect(this.textbox,"oncut","_onInput")}},_blankValue:"",filter:function(a){if(a===null)return this._blankValue;if(typeof a!="string")return a;if(this.trim)a=dojo.trim(a);if(this.uppercase)a=a.toUpperCase();if(this.lowercase)a=a.toLowerCase();if(this.propercase)a=a.replace(/[^\s]+/g,function(b){return b.substring(0,1).toUpperCase()+
b.substring(1)});return a},_setBlurValue:function(){this._setValueAttr(this.get("value"),true)},_onBlur:function(){if(!this.disabled){this._setBlurValue();this.inherited(arguments);this._selectOnClickHandle&&this.disconnect(this._selectOnClickHandle);if(this.selectOnClick&&dojo.isMoz)this.textbox.selectionStart=this.textbox.selectionEnd=undefined;this._updatePlaceHolder()}},_onFocus:function(a){if(!(this.disabled||this.readOnly)){if(this.selectOnClick&&a=="mouse")this._selectOnClickHandle=this.connect(this.domNode,
"onmouseup",function(){this.disconnect(this._selectOnClickHandle);var b;if(dojo.isIE){b=dojo.doc.selection.createRange();b=b.parentElement()==this.textbox&&b.text.length==0}else b=this.textbox.selectionStart==this.textbox.selectionEnd;b&&dijit.selectInputText(this.textbox)});this._updatePlaceHolder();this.inherited(arguments);this._refreshState()}},reset:function(){this.textbox.value="";this.inherited(arguments)}});dijit.selectInputText=function(a,b,c){var d=dojo.global,e=dojo.doc;a=dojo.byId(a);
if(isNaN(b))b=0;if(isNaN(c))c=a.value?a.value.length:0;dijit.focus(a);if(e.selection&&dojo.body().createTextRange){if(a.createTextRange){a=a.createTextRange();a.collapse(true);a.moveStart("character",-99999);a.moveStart("character",b);a.moveEnd("character",c-b);a.select()}}else d.getSelection&&a.setSelectionRange&&a.setSelectionRange(b,c)}};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.MenuItem"]){dojo._hasResource["dijit.MenuItem"]=true;dojo.provide("dijit.MenuItem");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit._Contained");dojo.require("dijit._CssStateMixin");dojo.declare("dijit.MenuItem",[dijit._Widget,dijit._Templated,dijit._Contained,dijit._CssStateMixin],{templateString:dojo.cache("dijit","templates/MenuItem.html",'<tr class="dijitReset dijitMenuItem" dojoAttachPoint="focusNode" role="menuitem" tabIndex="-1"\n\t\tdojoAttachEvent="onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitIcon dijitMenuItemIcon" dojoAttachPoint="iconNode"/>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" dojoAttachPoint="containerNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" dojoAttachPoint="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">\n\t\t<div dojoAttachPoint="arrowWrapper" style="visibility: hidden">\n\t\t\t<img src="${_blankGif}" alt="" class="dijitMenuExpand"/>\n\t\t\t<span class="dijitMenuExpandA11y">+</span>\n\t\t</div>\n\t</td>\n</tr>\n'),
attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{label:{node:"containerNode",type:"innerHTML"},iconClass:{node:"iconNode",type:"class"}}),baseClass:"dijitMenuItem",label:"",iconClass:"",accelKey:"",disabled:false,_fillContent:function(a){a&&!("label"in this.params)&&this.set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);var a=this.id+"_text";dojo.attr(this.containerNode,"id",a);if(this.accelKeyNode){dojo.attr(this.accelKeyNode,"id",this.id+"_accel");a+=
" "+this.id+"_accel"}dijit.setWaiState(this.domNode,"labelledby",a);dojo.setSelectable(this.domNode,false)},_onHover:function(){this.getParent().onItemHover(this)},_onUnhover:function(){this.getParent().onItemUnhover(this);this._set("hovering",false)},_onClick:function(a){this.getParent().onItemClick(this,a);dojo.stopEvent(a)},onClick:function(){},focus:function(){try{dojo.isIE==8&&this.containerNode.focus();dijit.focus(this.focusNode)}catch(a){}},_onFocus:function(){this._setSelected(true);this.getParent()._onItemFocus(this);
this.inherited(arguments)},_setSelected:function(a){dojo.toggleClass(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){dojo.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){dojo.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){dijit.setWaiState(this.focusNode,"disabled",a?"true":"false");this._set("disabled",
a)},_setAccelKeyAttr:function(a){this.accelKeyNode.style.display=a?"":"none";this.accelKeyNode.innerHTML=a;dojo.attr(this.containerNode,"colSpan",a?"1":"2");this._set("accelKey",a)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.CheckedMenuItem"]){dojo._hasResource["dijit.CheckedMenuItem"]=true;dojo.provide("dijit.CheckedMenuItem");dojo.require("dijit.MenuItem");dojo.declare("dijit.CheckedMenuItem",dijit.MenuItem,{templateString:dojo.cache("dijit","templates/CheckedMenuItem.html",'<tr class="dijitReset dijitMenuItem" dojoAttachPoint="focusNode" role="menuitemcheckbox" tabIndex="-1"\n\t\tdojoAttachEvent="onmouseenter:_onHover,onmouseleave:_onUnhover,ondijitclick:_onClick">\n\t<td class="dijitReset dijitMenuItemIconCell" role="presentation">\n\t\t<img src="${_blankGif}" alt="" class="dijitMenuItemIcon dijitCheckedMenuItemIcon" dojoAttachPoint="iconNode"/>\n\t\t<span class="dijitCheckedMenuItemIconChar">&#10003;</span>\n\t</td>\n\t<td class="dijitReset dijitMenuItemLabel" colspan="2" dojoAttachPoint="containerNode,labelNode"></td>\n\t<td class="dijitReset dijitMenuItemAccelKey" style="display: none" dojoAttachPoint="accelKeyNode"></td>\n\t<td class="dijitReset dijitMenuArrowCell" role="presentation">&nbsp;</td>\n</tr>\n'),
checked:false,_setCheckedAttr:function(a){dojo.toggleClass(this.domNode,"dijitCheckedMenuItemChecked",a);dijit.setWaiState(this.domNode,"checked",a);this._set("checked",a)},onChange:function(){},_onClick:function(){if(!this.disabled){this.set("checked",!this.checked);this.onChange(this.checked)}this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.PopupMenuItem"]){dojo._hasResource["dijit.PopupMenuItem"]=true;dojo.provide("dijit.PopupMenuItem");dojo.require("dijit.MenuItem");dojo.declare("dijit.PopupMenuItem",dijit.MenuItem,{_fillContent:function(){if(this.srcNodeRef){var a=dojo.query("*",this.srcNodeRef);dijit.PopupMenuItem.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){this.inherited(arguments);if(!this.popup){var a=dojo.query("[widgetId]",
this.dropDownContainer)[0];this.popup=dijit.byNode(a)}dojo.body().appendChild(this.popup.domNode);this.popup.startup();this.popup.domNode.style.display="none";this.arrowWrapper&&dojo.style(this.arrowWrapper,"visibility","");dijit.setWaiState(this.focusNode,"haspopup","true")}},destroyDescendants:function(){if(this.popup){this.popup._destroyed||this.popup.destroyRecursive();delete this.popup}this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.layout.ContentPane"]){dojo._hasResource["dijit.layout.ContentPane"]=true;dojo.provide("dijit.layout.ContentPane");dojo.require("dijit._Widget");dojo.require("dijit.layout._LayoutWidget");dojo.require("dijit.layout._ContentPaneResizeMixin");dojo.require("dojo.string");dojo.require("dojo.html");dojo.requireLocalization("dijit","loading",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.declare("dijit.layout.ContentPane",
[dijit._Widget,dijit.layout._ContentPaneResizeMixin],{href:"",extractContent:false,parseOnLoad:true,parserScope:dojo._scopeName,preventCache:false,preload:false,refreshOnShow:false,loadingMessage:"<span class='dijitContentPaneLoading'>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'>${errorState}</span>",isLoaded:false,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,attributeMap:dojo.delegate(dijit._Widget.prototype.attributeMap,{title:[]}),stopParser:true,template:false,
create:function(a,b){if((!a||!a.template)&&b&&!("href"in a)&&!("content"in a)){var c=dojo.doc.createDocumentFragment();for(b=dojo.byId(b);b.firstChild;)c.appendChild(b.firstChild);a=dojo.delegate(a,{content:c})}this.inherited(arguments,[a,b])},postMixInProperties:function(){this.inherited(arguments);var a=dojo.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=dojo.string.substitute(this.loadingMessage,a);this.errorMessage=dojo.string.substitute(this.errorMessage,a)},buildRendering:function(){this.inherited(arguments);
if(!this.containerNode)this.containerNode=this.domNode;this.domNode.title="";dojo.attr(this.domNode,"role")||dijit.setWaiRole(this.domNode,"group")},_startChildren:function(){this.inherited(arguments);this._contentSetter&&dojo.forEach(this._contentSetter.parseResults,function(a){if(!a._started&&!a._destroyed&&dojo.isFunction(a.startup)){a.startup();a._started=true}},this)},startup:function(){if(!this._started){this.inherited(arguments);this._isShown()&&this._onShow()}},setHref:function(a){dojo.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.",
"","2.0");return this.set("href",a)},_setHrefAttr:function(a){this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._set("href",a);if(this.preload||this._created&&this._isShown())this._load();else this._hrefChanged=true;return this.onLoadDeferred},setContent:function(a){dojo.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0");this.set("content",a)},_setContentAttr:function(a){this._set("href",
"");this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this._created&&this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._setContent(a||"");this._isDownloaded=false;return this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&this._xhrDfd.fired==-1&&this._xhrDfd.cancel();delete this._xhrDfd;this.onLoadDeferred=null},uninitialize:function(){this._beingDestroyed&&this.cancel();this.inherited(arguments)},
destroyRecursive:function(){this._beingDestroyed||this.inherited(arguments)},resize:function(a,b){!this._wasShown&&this.open!==false&&this._onShow();this._resizeCalled=true;this._scheduleLayout(a,b)},_isShown:function(){if(this._childOfLayoutWidget){if(this._resizeCalled&&"open"in this)return this.open;return this._resizeCalled}else if("open"in this)return this.open;else{var a=this.domNode,b=this.domNode.parentNode;return a.style.display!="none"&&a.style.visibility!="hidden"&&!dojo.hasClass(a,"dijitHidden")&&
b&&b.style&&b.style.display!="none"}},_onShow:function(){if(this.href){if(!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))var a=this.refresh()}else this._needLayout&&this._layout(this._changeSize,this._resultSize);this.inherited(arguments);this._wasShown=true;return a},refresh:function(){this.cancel();this.onLoadDeferred=new dojo.Deferred(dojo.hitch(this,"cancel"));this.onLoadDeferred.addCallback(dojo.hitch(this,"onLoad"));this._load();return this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),
true);var a=this,b={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};dojo.isObject(this.ioArgs)&&dojo.mixin(b,this.ioArgs);var c=this._xhrDfd=(this.ioMethod||dojo.xhrGet)(b);c.addCallback(function(d){try{a._isDownloaded=true;a._setContent(d,false);a.onDownloadEnd()}catch(e){a._onError("Content",e)}delete a._xhrDfd;return d});c.addErrback(function(d){c.canceled||a._onError("Download",d);delete a._xhrDfd;return d});delete this._hrefChanged},_onLoadHandler:function(a){this._set("isLoaded",
true);try{this.onLoadDeferred.callback(a)}catch(b){console.error("Error "+this.widgetId+" running custom onLoad code: "+b.message)}},_onUnloadHandler:function(){this._set("isLoaded",false);try{this.onUnload()}catch(a){console.error("Error "+this.widgetId+" running custom onUnload code: "+a.message)}},destroyDescendants:function(){this.isLoaded&&this._onUnloadHandler();var a=this._contentSetter;dojo.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive()});if(a){dojo.forEach(a.parseResults,
function(b){b.destroyRecursive&&b.domNode&&b.domNode.parentNode==dojo.body()&&b.destroyRecursive()});delete a.parseResults}dojo.html._emptyNode(this.containerNode);delete this._singleChild},_setContent:function(a,b){this.destroyDescendants();var c=this._contentSetter;if(!(c&&c instanceof dojo.html._ContentSetter))c=this._contentSetter=new dojo.html._ContentSetter({node:this.containerNode,_onError:dojo.hitch(this,this._onError),onContentError:dojo.hitch(this,function(e){e=this.onContentError(e);try{this.containerNode.innerHTML=
e}catch(f){console.error("Fatal "+this.id+" could not change content due to "+f.message,f)}})});var d=dojo.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:this.parseOnLoad,parserScope:this.parserScope,startup:false,dir:this.dir,lang:this.lang},this._contentSetterParams||{});c.set(dojo.isObject(a)&&a.domNode?a.domNode:a,d);delete this._contentSetterParams;this.doLayout&&this._checkIfSingleChild();if(!b){if(this._started){this._startChildren();this._scheduleLayout()}this._onLoadHandler(a)}},
_onError:function(a,b,c){this.onLoadDeferred.errback(b);a=this["on"+a+"Error"].call(this,b);if(c)console.error(c,b);else a&&this._setContent(a,true)},_scheduleLayout:function(a,b){if(this._isShown())this._layout(a,b);else{this._needLayout=true;this._changeSize=a;this._resultSize=b}},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.Button"]){dojo._hasResource["dijit.form.Button"]=true;dojo.provide("dijit.form.Button");dojo.require("dijit.form._FormWidget");dojo.require("dijit._Container");dojo.require("dijit._HasDropDown");dojo.declare("dijit.form.Button",dijit.form._FormWidget,{label:"",showLabel:true,iconClass:"",type:"button",baseClass:"dijitButton",templateString:dojo.cache("dijit.form","templates/Button.html",'<span class="dijit dijitReset dijitInline"\n\t><span class="dijitReset dijitInline dijitButtonNode"\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdojoAttachPoint="titleNode,focusNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode"></span\n\t\t\t><span class="dijitReset dijitToggleButtonIconChar">&#x25CF;</span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tid="${id}_label"\n\t\t\t\tdojoAttachPoint="containerNode"\n\t\t\t></span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdojoAttachPoint="valueNode"\n/></span>\n'),
attributeMap:dojo.delegate(dijit.form._FormWidget.prototype.attributeMap,{value:"valueNode"}),_onClick:function(a){if(this.disabled)return false;this._clicked();return this.onClick(a)},_onButtonClick:function(a){if(this._onClick(a)===false)a.preventDefault();else if(this.type=="submit"&&!(this.valueNode||this.focusNode).form)for(var b=this.domNode;b.parentNode;b=b.parentNode){var c=dijit.byNode(b);if(c&&typeof c._onSubmit=="function"){c._onSubmit(a);break}}else if(this.valueNode){this.valueNode.click();
a.preventDefault()}},buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.focusNode,false)},_fillContent:function(a){if(a&&(!this.params||!("label"in this.params)))this.set("label",a.innerHTML)},_setShowLabelAttr:function(a){this.containerNode&&dojo.toggleClass(this.containerNode,"dijitDisplayNone",!a);this._set("showLabel",a)},onClick:function(){return true},_clicked:function(){},setLabel:function(a){dojo.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.",
"","2.0");this.set("label",a)},_setLabelAttr:function(a){this._set("label",a);this.containerNode.innerHTML=a;if(this.showLabel==false&&!this.params.title)this.titleNode.title=dojo.trim(this.containerNode.innerText||this.containerNode.textContent||"")},_setIconClassAttr:function(a){dojo.replaceClass(this.iconNode,a||"dijitNoIcon",this.iconClass||"dijitNoIcon");this._set("iconClass",a)}});dojo.declare("dijit.form.DropDownButton",[dijit.form.Button,dijit._Container,dijit._HasDropDown],{baseClass:"dijitDropDownButton",
templateString:dojo.cache("dijit.form","templates/DropDownButton.html",'<span class="dijit dijitReset dijitInline"\n\t><span class=\'dijitReset dijitInline dijitButtonNode\'\n\t\tdojoAttachEvent="ondijitclick:_onButtonClick" dojoAttachPoint="_buttonNode"\n\t\t><span class="dijitReset dijitStretch dijitButtonContents"\n\t\t\tdojoAttachPoint="focusNode,titleNode,_arrowWrapperNode"\n\t\t\trole="button" aria-haspopup="true" aria-labelledby="${id}_label"\n\t\t\t><span class="dijitReset dijitInline dijitIcon"\n\t\t\t\tdojoAttachPoint="iconNode"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitButtonText"\n\t\t\t\tdojoAttachPoint="containerNode,_popupStateNode"\n\t\t\t\tid="${id}_label"\n\t\t\t></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonInner"></span\n\t\t\t><span class="dijitReset dijitInline dijitArrowButtonChar">&#9660;</span\n\t\t></span\n\t></span\n\t><input ${!nameAttrSetting} type="${type}" value="${value}" class="dijitOffScreen"\n\t\tdojoAttachPoint="valueNode"\n/></span>\n'),
_fillContent:function(){if(this.srcNodeRef){var a=dojo.query("*",this.srcNodeRef);dijit.form.DropDownButton.superclass._fillContent.call(this,a[0]);this.dropDownContainer=this.srcNodeRef}},startup:function(){if(!this._started){if(!this.dropDown&&this.dropDownContainer){var a=dojo.query("[widgetId]",this.dropDownContainer)[0];this.dropDown=dijit.byNode(a);delete this.dropDownContainer}this.dropDown&&dijit.popup.hide(this.dropDown);this.inherited(arguments)}},isLoaded:function(){var a=this.dropDown;
return!!a&&(!a.href||a.isLoaded)},loadDropDown:function(){var a=this.dropDown;if(a)if(this.isLoaded())this.openDropDown();else{var b=dojo.connect(a,"onLoad",this,function(){dojo.disconnect(b);this.openDropDown()});a.refresh()}},isFocusable:function(){return this.inherited(arguments)&&!this._mouseDown}});dojo.declare("dijit.form.ComboButton",dijit.form.DropDownButton,{templateString:dojo.cache("dijit.form","templates/ComboButton.html",'<table class="dijit dijitReset dijitInline dijitLeft"\n\tcellspacing=\'0\' cellpadding=\'0\' role="presentation"\n\t><tbody role="presentation"><tr role="presentation"\n\t\t><td class="dijitReset dijitStretch dijitButtonNode" dojoAttachPoint="buttonNode" dojoAttachEvent="ondijitclick:_onButtonClick,onkeypress:_onButtonKeyPress"\n\t\t><div id="${id}_button" class="dijitReset dijitButtonContents"\n\t\t\tdojoAttachPoint="titleNode"\n\t\t\trole="button" aria-labelledby="${id}_label"\n\t\t\t><div class="dijitReset dijitInline dijitIcon" dojoAttachPoint="iconNode" role="presentation"></div\n\t\t\t><div class="dijitReset dijitInline dijitButtonText" id="${id}_label" dojoAttachPoint="containerNode" role="presentation"></div\n\t\t></div\n\t\t></td\n\t\t><td id="${id}_arrow" class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton\'\n\t\t\tdojoAttachPoint="_popupStateNode,focusNode,_buttonNode"\n\t\t\tdojoAttachEvent="onkeypress:_onArrowKeyPress"\n\t\t\ttitle="${optionsTitle}"\n\t\t\trole="button" aria-haspopup="true"\n\t\t\t><div class="dijitReset dijitArrowButtonInner" role="presentation"></div\n\t\t\t><div class="dijitReset dijitArrowButtonChar" role="presentation">&#9660;</div\n\t\t></td\n\t\t><td style="display:none !important;"\n\t\t\t><input ${!nameAttrSetting} type="${type}" value="${value}" dojoAttachPoint="valueNode"\n\t\t/></td></tr></tbody\n></table>\n'),
attributeMap:dojo.mixin(dojo.clone(dijit.form.Button.prototype.attributeMap),{id:"",tabIndex:["focusNode","titleNode"],title:"titleNode"}),optionsTitle:"",baseClass:"dijitComboButton",cssStateNodes:{buttonNode:"dijitButtonNode",titleNode:"dijitButtonContents",_popupStateNode:"dijitDownArrowButton"},_focusedNode:null,_onButtonKeyPress:function(a){if(a.charOrCode==dojo.keys[this.isLeftToRight()?"RIGHT_ARROW":"LEFT_ARROW"]){dijit.focus(this._popupStateNode);dojo.stopEvent(a)}},_onArrowKeyPress:function(a){if(a.charOrCode==
dojo.keys[this.isLeftToRight()?"LEFT_ARROW":"RIGHT_ARROW"]){dijit.focus(this.titleNode);dojo.stopEvent(a)}},focus:function(a){this.disabled||dijit.focus(a=="start"?this.titleNode:this._popupStateNode)}});dojo.declare("dijit.form.ToggleButton",dijit.form.Button,{baseClass:"dijitToggleButton",checked:false,attributeMap:dojo.mixin(dojo.clone(dijit.form.Button.prototype.attributeMap),{checked:"focusNode"}),_clicked:function(){this.set("checked",!this.checked)},_setCheckedAttr:function(a,b){this._set("checked",
a);dojo.attr(this.focusNode||this.domNode,"checked",a);dijit.setWaiState(this.focusNode||this.domNode,"pressed",a);this._handleOnChange(a,b)},setChecked:function(a){dojo.deprecated("setChecked("+a+") is deprecated. Use set('checked',"+a+") instead.","","2.0");this.set("checked",a)},reset:function(){this._hasBeenBlurred=false;this.set("checked",this.params.checked||false)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.DropDownButton"]){dojo._hasResource["dijit.form.DropDownButton"]=true;dojo.provide("dijit.form.DropDownButton");dojo.require("dijit.form.Button")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.ToggleButton"]){dojo._hasResource["dijit.form.ToggleButton"]=true;dojo.provide("dijit.form.ToggleButton");dojo.require("dijit.form.Button")};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.ValidationTextBox"]){dojo._hasResource["dijit.form.ValidationTextBox"]=true;dojo.provide("dijit.form.ValidationTextBox");dojo.require("dojo.i18n");dojo.require("dijit.form.TextBox");dojo.require("dijit.Tooltip");dojo.requireLocalization("dijit.form","validate",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");dojo.declare("dijit.form.ValidationTextBox",dijit.form.TextBox,{templateString:dojo.cache("dijit.form",
"templates/ValidationTextBox.html",'<div class="dijit dijitReset dijitInlineTable dijitLeft"\n\tid="widget_${id}" role="presentation"\n\t><div class=\'dijitReset dijitValidationContainer\'\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935;" type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t/></div\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class="dijitReset dijitInputInner" dojoAttachPoint=\'textbox,focusNode\' autocomplete="off"\n\t\t\t${!nameAttrSetting} type=\'${type}\'\n\t/></div\n></div>\n'),
baseClass:"dijitTextBox dijitValidationTextBox",required:false,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},regExp:".*",regExpGen:function(){return this.regExp},state:"",tooltipPosition:[],_setValueAttr:function(){this.inherited(arguments);this.validate(this._focused)},validator:function(a,b){return RegExp("^(?:"+this.regExpGen(b)+")"+(this.required?"":"?")+"$").test(a)&&(!this.required||!this._isEmpty(a))&&(this._isEmpty(a)||this.parse(a,b)!==undefined)},
_isValidSubset:function(){return this.textbox.value.search(this._partialre)==0},isValid:function(){return this.validator(this.textbox.value,this.constraints)},_isEmpty:function(a){return(this.trim?/^\s*$/:/^$/).test(a)},getErrorMessage:function(){return this.required&&this._isEmpty(this.textbox.value)?this.missingMessage:this.invalidMessage},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:true,validate:function(a){var b="",c=this.disabled||this.isValid(a);if(c)this._maskValidSubsetError=
true;var d=this._isEmpty(this.textbox.value),e=!c&&a&&this._isValidSubset();this._set("state",c?"":((!this._hasBeenBlurred||a)&&d||e)&&this._maskValidSubsetError?"Incomplete":"Error");dijit.setWaiState(this.focusNode,"invalid",c?"false":"true");if(this.state=="Error"){this._maskValidSubsetError=a&&e;b=this.getErrorMessage(a)}else if(this.state=="Incomplete"){b=this.getPromptMessage(a);this._maskValidSubsetError=!this._hasBeenBlurred||a}else if(d)b=this.getPromptMessage(a);this.set("message",b);return c},
displayMessage:function(a){dijit.hideTooltip(this.domNode);a&&this._focused&&dijit.showTooltip(a,this.domNode,this.tooltipPosition,!this.isLeftToRight())},_refreshState:function(){this.validate(this._focused);this.inherited(arguments)},constructor:function(){this.constraints={}},_setConstraintsAttr:function(a){if(!a.locale&&this.lang)a.locale=this.lang;this._set("constraints",a);this._computePartialRE()},_computePartialRE:function(){var a=this.regExpGen(this.constraints);this.regExp=a;var b="";a!=
".*"&&this.regExp.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(d){switch(d.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":b+=d;break;case ")":b+="|$)";break;default:b+="(?:"+d+"|$)"}});try{"".search(b)}catch(c){b=this.regExp;console.warn("RegExp error in "+this.declaredClass+": "+this.regExp)}this._partialre="^(?:"+b+")$"},postMixInProperties:function(){this.inherited(arguments);this.messages=dojo.i18n.getLocalization("dijit.form","validate",
this.lang);if(this.invalidMessage=="$_unset_$")this.invalidMessage=this.messages.invalidMessage;if(!this.invalidMessage)this.invalidMessage=this.promptMessage;if(this.missingMessage=="$_unset_$")this.missingMessage=this.messages.missingMessage;if(!this.missingMessage)this.missingMessage=this.invalidMessage;this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);dijit.setWaiState(this.focusNode,
"required",a);this._refreshState()},_setMessageAttr:function(a){this._set("message",a);this.displayMessage(a)},reset:function(){this._maskValidSubsetError=true;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)}});dojo.declare("dijit.form.MappedTextBox",dijit.form.ValidationTextBox,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},serialize:function(a){return a.toString?a.toString():""},toString:function(){var a=this.filter(this.get("value"));
return a!=null?typeof a=="string"?a:this.serialize(a,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=dojo.place("<input type='hidden'"+(this.name?" name='"+this.name.replace(/'/g,"&quot;")+"'":"")+"/>",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}});dojo.declare("dijit.form.RangeBoundTextBox",dijit.form.MappedTextBox,{rangeMessage:"",
rangeCheck:function(a,b){return("min"in b?this.compare(a,b.min)>=0:true)&&("max"in b?this.compare(a,b.max)<=0:true)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var a=this.get("value"),b=false,c=false;if("min"in this.constraints){b=this.constraints.min;b=this.compare(a,typeof b=="number"&&b>=0&&a!=0?0:b);b=typeof b=="number"&&b<0}if("max"in this.constraints){c=this.constraints.max;c=this.compare(a,typeof c!="number"||c>0?c:0);
c=typeof c=="number"&&c>0}return b||c},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(a){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(a))},getErrorMessage:function(a){var b=this.get("value");if(b!==null&&b!==""&&b!==undefined&&(typeof b!="number"||!isNaN(b))&&!this.isInRange(a))return this.rangeMessage;return this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);
if(!this.rangeMessage){this.messages=dojo.i18n.getLocalization("dijit.form","validate",this.lang);this.rangeMessage=this.messages.rangeMessage}},_setConstraintsAttr:function(){this.inherited(arguments);if(this.focusNode){this.constraints.min!==undefined?dijit.setWaiState(this.focusNode,"valuemin",this.constraints.min):dijit.removeWaiState(this.focusNode,"valuemin");this.constraints.max!==undefined?dijit.setWaiState(this.focusNode,"valuemax",this.constraints.max):dijit.removeWaiState(this.focusNode,
"valuemax")}},_setValueAttr:function(a){dijit.setWaiState(this.focusNode,"valuenow",a);this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.TooltipDialog"]){dojo._hasResource["dijit.TooltipDialog"]=true;dojo.provide("dijit.TooltipDialog");dojo.require("dijit.layout.ContentPane");dojo.require("dijit._Templated");dojo.require("dijit.form._FormMixin");dojo.require("dijit._DialogMixin");dojo.declare("dijit.TooltipDialog",[dijit.layout.ContentPane,dijit._Templated,dijit.form._FormMixin,dijit._DialogMixin],{title:"",doLayout:false,autofocus:true,baseClass:"dijitTooltipDialog",_firstFocusItem:null,_lastFocusItem:null,
templateString:dojo.cache("dijit","templates/TooltipDialog.html",'<div role="presentation" tabIndex="-1">\n\t<div class="dijitTooltipContainer" role="presentation">\n\t\t<div class ="dijitTooltipContents dijitTooltipFocusNode" dojoAttachPoint="containerNode" role="dialog"></div>\n\t</div>\n\t<div class="dijitTooltipConnector" role="presentation"></div>\n</div>\n'),_setTitleAttr:function(a){this.containerNode.title=a;this._set("title",a)},postCreate:function(){this.inherited(arguments);this.connect(this.containerNode,
"onkeypress","_onKey")},orient:function(a,c,b){a="dijitTooltipAB"+(b.charAt(1)=="L"?"Left":"Right")+" dijitTooltip"+(b.charAt(0)=="T"?"Below":"Above");dojo.replaceClass(this.domNode,a,this._currentOrientClass||"");this._currentOrientClass=a},focus:function(){this._getFocusItems(this.containerNode);dijit.focus(this._firstFocusItem)},onOpen:function(a){this.orient(this.domNode,a.aroundCorner,a.corner);this._onShow()},onClose:function(){this.onHide()},_onKey:function(a){var c=a.target,b=dojo.keys;a.charOrCode===
b.TAB&&this._getFocusItems(this.containerNode);var d=this._firstFocusItem==this._lastFocusItem;if(a.charOrCode==b.ESCAPE){setTimeout(dojo.hitch(this,"onCancel"),0);dojo.stopEvent(a)}else if(c==this._firstFocusItem&&a.shiftKey&&a.charOrCode===b.TAB){d||dijit.focus(this._lastFocusItem);dojo.stopEvent(a)}else if(c==this._lastFocusItem&&a.charOrCode===b.TAB&&!a.shiftKey){d||dijit.focus(this._firstFocusItem);dojo.stopEvent(a)}else a.charOrCode===b.TAB&&a.stopPropagation()}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.Menu"]){dojo._hasResource["dijit.Menu"]=true;dojo.provide("dijit.Menu");dojo.require("dojo.window");dojo.require("dijit._Widget");dojo.require("dijit._KeyNavContainer");dojo.require("dijit._Templated");dojo.require("dijit.MenuItem");dojo.require("dijit.PopupMenuItem");dojo.require("dijit.CheckedMenuItem");dojo.require("dijit.MenuSeparator");dojo.declare("dijit._MenuBase",[dijit._Widget,dijit._Templated,dijit._KeyNavContainer],{parentMenu:null,popupDelay:500,startup:function(){if(!this._started){dojo.forEach(this.getChildren(),
function(a){a.startup()});this.startupKeyNavChildren();this.inherited(arguments)}},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.focusedChild._onClick(a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){if(this.currentPopup&&this.currentPopup._pendingClose_timer){var a=this.currentPopup.parentMenu;a.focusedChild&&a.focusedChild._setSelected(false);a.focusedChild=
this.currentPopup.from_item;a.focusedChild._setSelected(true);this._stopPendingCloseTimer(this.currentPopup)}},onItemHover:function(a){if(this.isActive){this.focusChild(a);if(this.focusedChild.popup&&!this.focusedChild.disabled&&!this.hover_timer)this.hover_timer=setTimeout(dojo.hitch(this,"_openPopup"),this.popupDelay)}this.focusedChild&&this.focusChild(a);this._hoveredChild=a},_onChildBlur:function(a){this._stopPopupTimer();a._setSelected(false);var b=a.popup;if(b){this._stopPendingCloseTimer(b);
b._pendingClose_timer=setTimeout(function(){b._pendingClose_timer=null;if(b.parentMenu)b.parentMenu.currentPopup=null;dijit.popup.close(b)},this.popupDelay)}},onItemUnhover:function(a){this.isActive&&this._stopPopupTimer();if(this._hoveredChild==a)this._hoveredChild=null},_stopPopupTimer:function(){if(this.hover_timer){clearTimeout(this.hover_timer);this.hover_timer=null}},_stopPendingCloseTimer:function(a){if(a._pendingClose_timer){clearTimeout(a._pendingClose_timer);a._pendingClose_timer=null}},
_stopFocusTimer:function(){if(this._focus_timer){clearTimeout(this._focus_timer);this._focus_timer=null}},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){typeof this.isShowingNow=="undefined"&&this._markActive();this.focusChild(a);if(a.disabled)return false;if(a.popup)this._openPopup();else{this.onExecute();a.onClick(b)}},_openPopup:function(){this._stopPopupTimer();var a=this.focusedChild;if(a){var b=a.popup;if(!b.isShowingNow){if(this.currentPopup){this._stopPendingCloseTimer(this.currentPopup);
dijit.popup.close(this.currentPopup)}b.parentMenu=this;b.from_item=a;var c=this;dijit.popup.open({parent:this,popup:b,around:a.domNode,orient:this._orient||(this.isLeftToRight()?{TR:"TL",TL:"TR",BR:"BL",BL:"BR"}:{TL:"TR",TR:"TL",BL:"BR",BR:"BL"}),onCancel:function(){c.focusChild(a);c._cleanUp();a._setSelected(true);c.focusedChild=a},onExecute:dojo.hitch(this,"_cleanUp")});this.currentPopup=b;b.connect(b.domNode,"onmouseenter",dojo.hitch(c,"_onPopupHover"));if(b.focus)b._focus_timer=setTimeout(dojo.hitch(b,
function(){this._focus_timer=null;this.focus()}),0)}}},_markActive:function(){this.isActive=true;dojo.replaceClass(this.domNode,"dijitMenuActive","dijitMenuPassive")},onOpen:function(){this.isShowingNow=true;this._markActive()},_markInactive:function(){this.isActive=false;dojo.replaceClass(this.domNode,"dijitMenuPassive","dijitMenuActive")},onClose:function(){this._stopFocusTimer();this._markInactive();this.isShowingNow=false;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();if(this.currentPopup){dijit._curFocus&&
dojo.isDescendant(dijit._curFocus,this.currentPopup.domNode)&&this.focusedChild.focusNode.focus();dijit.popup.close(this.currentPopup);this.currentPopup=null}if(this.focusedChild){this.focusedChild._setSelected(false);this.focusedChild._onUnhover();this.focusedChild=null}},_onItemFocus:function(a){this._hoveredChild&&this._hoveredChild!=a&&this._hoveredChild._onUnhover()},_onBlur:function(){this._cleanUp();this.inherited(arguments)},_cleanUp:function(){this._closeChild();typeof this.isShowingNow==
"undefined"&&this._markInactive()}});dojo.declare("dijit.Menu",dijit._MenuBase,{constructor:function(){this._bindings=[]},templateString:dojo.cache("dijit","templates/Menu.html",'<table class="dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role="menu" tabIndex="${tabIndex}" dojoAttachEvent="onkeypress:_onKeyPress" cellspacing="0">\n\t<tbody class="dijitReset" dojoAttachPoint="containerNode"></tbody>\n</table>\n'),baseClass:"dijitMenu",targetNodeIds:[],contextMenuForWindow:false,leftClickToOpen:false,
refocus:true,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(dojo.body()):dojo.forEach(this.targetNodeIds,this.bindDomNode,this);var a=dojo.keys,b=this.isLeftToRight();this._openSubMenuKey=b?a.RIGHT_ARROW:a.LEFT_ARROW;this._closeSubMenuKey=b?a.LEFT_ARROW:a.RIGHT_ARROW;this.connectKeyNavHandlers([a.UP_ARROW],[a.DOWN_ARROW])},_onKeyPress:function(a){if(!(a.ctrlKey||a.altKey))switch(a.charOrCode){case this._openSubMenuKey:this._moveToPopup(a);dojo.stopEvent(a);break;case this._closeSubMenuKey:if(this.parentMenu)this.parentMenu._isMenuBar?
this.parentMenu.focusPrev():this.onCancel(false);else dojo.stopEvent(a)}},_iframeContentWindow:function(a){return dojo.window.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&dojo.doc.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&dojo.doc.frames[a.name]&&dojo.doc.frames[a.name].document||null},bindDomNode:function(a){a=dojo.byId(a);var b;if(a.tagName.toLowerCase()=="iframe"){var c=
a,e=this._iframeContentWindow(c);b=dojo.withGlobal(e,dojo.body)}else b=a==dojo.body()?dojo.doc.documentElement:a;var d={node:a,iframe:c};dojo.attr(a,"_dijitMenu"+this.id,this._bindings.push(d));var f=dojo.hitch(this,function(h){return[dojo.connect(h,this.leftClickToOpen?"onclick":"oncontextmenu",this,function(g){dojo.stopEvent(g);this._scheduleOpen(g.target,c,{x:g.pageX,y:g.pageY})}),dojo.connect(h,"onkeydown",this,function(g){if(g.shiftKey&&g.keyCode==dojo.keys.F10){dojo.stopEvent(g);this._scheduleOpen(g.target,
c)}})]});d.connects=b?f(b):[];if(c){d.onloadHandler=dojo.hitch(this,function(){var h=this._iframeContentWindow(c);b=dojo.withGlobal(h,dojo.body);d.connects=f(b)});c.addEventListener?c.addEventListener("load",d.onloadHandler,false):c.attachEvent("onload",d.onloadHandler)}},unBindDomNode:function(a){var b;try{b=dojo.byId(a)}catch(c){return}a="_dijitMenu"+this.id;if(b&&dojo.hasAttr(b,a)){var e=dojo.attr(b,a)-1,d=this._bindings[e];dojo.forEach(d.connects,dojo.disconnect);var f=d.iframe;if(f)f.removeEventListener?
f.removeEventListener("load",d.onloadHandler,false):f.detachEvent("onload",d.onloadHandler);dojo.removeAttr(b,a);delete this._bindings[e]}},_scheduleOpen:function(a,b,c){if(!this._openTimer)this._openTimer=setTimeout(dojo.hitch(this,function(){delete this._openTimer;this._openMyself({target:a,iframe:b,coords:c})}),1)},_openMyself:function(a){function b(){i.refocus&&dijit.focus(j);dijit.popup.close(i)}var c=a.target,e=a.iframe;if(a=a.coords){if(e){c=dojo.position(e,true);var d=this._iframeContentWindow(e);
d=dojo.withGlobal(d,"_docScroll",dojo);var f=dojo.getComputedStyle(e),h=dojo._toPixelValue,g=(dojo.isIE&&dojo.isQuirks?0:h(e,f.paddingLeft))+(dojo.isIE&&dojo.isQuirks?h(e,f.borderLeftWidth):0);e=(dojo.isIE&&dojo.isQuirks?0:h(e,f.paddingTop))+(dojo.isIE&&dojo.isQuirks?h(e,f.borderTopWidth):0);a.x+=c.x+g-d.x;a.y+=c.y+e-d.y}}else{a=dojo.position(c,true);a.x+=10;a.y+=10}var i=this,j=dijit.getFocus(this);dijit.popup.open({popup:this,x:a.x,y:a.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});
this.focus();this._onBlur=function(){this.inherited("_onBlur",arguments);dijit.popup.close(this)}},uninitialize:function(){dojo.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})};
/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dijit.form.ComboBox"]){dojo._hasResource["dijit.form.ComboBox"]=true;dojo.provide("dijit.form.ComboBox");dojo.require("dojo.window");dojo.require("dojo.regexp");dojo.require("dojo.data.util.simpleFetch");dojo.require("dojo.data.util.filter");dojo.require("dijit._CssStateMixin");dojo.require("dijit.form._FormWidget");dojo.require("dijit.form.ValidationTextBox");dojo.require("dijit._HasDropDown");dojo.requireLocalization("dijit.form","ComboBox",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw");
dojo.declare("dijit.form.ComboBoxMixin",dijit._HasDropDown,{item:null,pageSize:Infinity,store:null,fetchProperties:{},query:{},autoComplete:true,highlightMatch:"first",searchDelay:100,searchAttr:"name",labelAttr:"",labelType:"text",queryExpr:"${0}*",ignoreCase:true,hasDownArrow:true,templateString:dojo.cache("dijit.form","templates/DropDownBox.html",'<div class="dijit dijitReset dijitInlineTable dijitLeft"\n\tid="widget_${id}"\n\trole="combobox"\n\t><div class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\n\t\tdojoAttachPoint="_buttonNode, _popupStateNode" role="presentation"\n\t\t><input class="dijitReset dijitInputField dijitArrowButtonInner" value="&#9660; " type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t\t\t${_buttonInputDisabled}\n\t/></div\n\t><div class=\'dijitReset dijitValidationContainer\'\n\t\t><input class="dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value="&#935;" type="text" tabIndex="-1" readonly="readonly" role="presentation"\n\t/></div\n\t><div class="dijitReset dijitInputField dijitInputContainer"\n\t\t><input class=\'dijitReset dijitInputInner\' ${!nameAttrSetting} type="text" autocomplete="off"\n\t\t\tdojoAttachPoint="textbox,focusNode" role="textbox" aria-haspopup="true"\n\t/></div\n></div>\n'),
baseClass:"dijitTextBox dijitComboBox",dropDownClass:"dijit.form._ComboBoxMenu",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},maxHeight:-1,_getCaretPos:function(a){var b=0;if(typeof a.selectionStart=="number")b=a.selectionStart;else if(dojo.isIE){var c=dojo.doc.selection.createRange().duplicate();a=a.createTextRange();c.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",c);b=String(a.text).replace(/\r/g,"").length}catch(d){}}return b},_setCaretPos:function(a,b){b=parseInt(b);
dijit.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);dijit.setWaiState(this.domNode,"disabled",a)},_abortQuery:function(){if(this.searchTimer){clearTimeout(this.searchTimer);this.searchTimer=null}if(this._fetchHandle){this._fetchHandle.abort&&this._fetchHandle.abort();this._fetchHandle=null}},_onInput:function(a){if(!this.searchTimer&&(a.type=="paste"||a.type=="input")&&this._lastInput!=this.textbox.value)this.searchTimer=setTimeout(dojo.hitch(this,function(){this._onKey({charOrCode:229})}),
100);this.inherited(arguments)},_onKey:function(a){var b=a.charOrCode;if(!(a.altKey||(a.ctrlKey||a.metaKey)&&b!="x"&&b!="v"||b==dojo.keys.SHIFT)){var c=false,d=this.dropDown,e=dojo.keys,f=null;this._prev_key_backspace=false;this._abortQuery();this.inherited(arguments);if(this._opened)f=d.getHighlightedOption();switch(b){case e.PAGE_DOWN:case e.DOWN_ARROW:case e.PAGE_UP:case e.UP_ARROW:this._opened&&this._announceOption(f);dojo.stopEvent(a);break;case e.ENTER:if(f)if(f==d.nextButton){this._nextSearch(1);
dojo.stopEvent(a);break}else{if(f==d.previousButton){this._nextSearch(-1);dojo.stopEvent(a);break}}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length)}if(this._opened||this._fetchHandle)a.preventDefault();case e.TAB:b=this.get("displayedValue");if(d&&(b==d._messages.previousMessage||b==d._messages.nextMessage))break;f&&this._selectOption();if(this._opened){this._lastQuery=null;this.closeDropDown()}break;case " ":if(f){dojo.stopEvent(a);this._selectOption();this.closeDropDown()}else c=
true;break;case e.DELETE:case e.BACKSPACE:c=this._prev_key_backspace=true;break;default:c=typeof b=="string"||b==229}if(c){this.item=undefined;this.searchTimer=setTimeout(dojo.hitch(this,"_startSearchFromInput"),1)}}},_autoCompleteText:function(a){var b=this.focusNode;dijit.selectInputText(b,b.value.length);var c=this.ignoreCase?"toLowerCase":"substr";if(a[c](0).indexOf(this.focusNode.value[c](0))==0){c=this._getCaretPos(b);if(c+1>b.value.length){b.value=a;dijit.selectInputText(b,c)}}else{b.value=
a;dijit.selectInputText(b)}},_openResultList:function(a,b){this._fetchHandle=null;if(!(this.disabled||this.readOnly||b.query[this.searchAttr]!=this._lastQuery)){var c=this.dropDown._highlighted_option&&dojo.hasClass(this.dropDown._highlighted_option,"dijitMenuItemSelected");this.dropDown.clearResultList();if(!a.length&&!this._maxOptions)this.closeDropDown();else{b._maxOptions=this._maxOptions;var d=this.dropDown.createOptions(a,b,dojo.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if(b.direction){if(1==
b.direction)this.dropDown.highlightFirstOption();else-1==b.direction&&this.dropDown.highlightLastOption();c&&this._announceOption(this.dropDown.getHighlightedOption())}else this.autoComplete&&!this._prev_key_backspace&&!/^[*]+$/.test(b.query[this.searchAttr])&&this._announceOption(d[1])}}},_showResultList:function(){this.closeDropDown(true);this.displayMessage("");this.openDropDown();dijit.setWaiState(this.domNode,"expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return false},
closeDropDown:function(){this._abortQuery();if(this._opened){this.inherited(arguments);dijit.setWaiState(this.domNode,"expanded","false");dijit.removeWaiState(this.focusNode,"activedescendant")}},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;if(b&&(a==b._messages.previousMessage||a==b._messages.nextMessage))this._setValueAttr(this._lastValueReported,true);else if(typeof this.item=="undefined"){this.item=null;this.set("displayedValue",a)}else{this.value!=this._lastValueReported&&
dijit.form._FormValueWidget.prototype._setValueAttr.call(this,this.value,true);this._refreshState()}},_onBlur:function(){this.closeDropDown();this.inherited(arguments)},_setItemAttr:function(a,b,c){if(!c){c=this.labelFunc(a,this.store);if(this.labelType=="html"){var d=this._helperSpan;d.innerHTML=c;c=d.innerText||d.textContent}else c=c}d=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c;this._set("item",a);dijit.form.ComboBox.superclass._setValueAttr.call(this,d,b,c)},_announceOption:function(a){if(a){var b;
if(a==this.dropDown.nextButton||a==this.dropDown.previousButton){b=a.innerHTML;this.item=undefined;this.value=""}else{b=a.innerText||a.textContent||"";this.set("item",a.item,false,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);dijit.setWaiState(this.focusNode,"activedescendant",dojo.attr(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){a&&this._announceOption(a.target);this.closeDropDown();this._setCaretPos(this.focusNode,this.focusNode.value.length);
dijit.form._FormValueWidget.prototype._setValueAttr.call(this,this.value,true)},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"))},_getQueryString:function(a){return dojo.string.substitute(this.queryExpr,[a])},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (dojo.getObject(this.dropDownClass,false))({onChange:dojo.hitch(this,this._selectOption),id:b,dir:this.dir});
dijit.removeWaiState(this.focusNode,"activedescendant");dijit.setWaiState(this.textbox,"owns",b)}b=dojo.clone(this.query);this._lastInput=a;this._lastQuery=b[this.searchAttr]=this._getQueryString(a);this.searchTimer=setTimeout(dojo.hitch(this,function(c,d){this.searchTimer=null;var e={queryOptions:{ignoreCase:this.ignoreCase,deep:true},query:c,onBegin:dojo.hitch(this,"_setMaxOptions"),onComplete:dojo.hitch(this,"_openResultList"),onError:function(f){d._fetchHandle=null;console.error("dijit.form.ComboBox: "+
f);d.closeDropDown()},start:0,count:this.pageSize};dojo.mixin(e,d.fetchProperties);this._fetchHandle=d.store.fetch(e);this._nextSearch=this.dropDown.onPage=dojo.hitch(this,function(f,g){f.start+=f.count*g;f.direction=g;this._fetchHandle=this.store.fetch(f);this.focus()},this._fetchHandle)},b,this),this.searchDelay)},_setMaxOptions:function(a){this._maxOptions=a},_getValueField:function(){return this.searchAttr},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){this.store=
new dijit.form._ComboBoxDataStore(this.srcNodeRef);if(!("value"in this.params)){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=b!=this.searchAttr?this.store.getValue(a,b):this.labelFunc(a,this.store)}}}this._helperSpan=dojo.create("span");this.inherited(arguments)},postCreate:function(){var a=dojo.query('label[for="'+this.id+'"]');if(a.length){a[0].id=this.id+"_label";dijit.setWaiState(this.domNode,"labelledby",a[0].id)}this.inherited(arguments)},destroy:function(){dojo.destroy(this._helperSpan);
this.inherited(arguments)},_setHasDownArrowAttr:function(a){this.hasDownArrow=a;this._buttonNode.style.display=a?"":"none"},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){a=this.doHighlight(a,this._escapeHtml(this._lastInput));b="html"}return{html:b=="html",label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+(this.highlightMatch=="all"?"g":""),d=this.queryExpr.indexOf("${0}");
b=dojo.regexp.escapeString(b);return this._escapeHtml(a).replace(RegExp((d==0?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),'<span class="dijitComboBoxHighlightMatch">$1</span>')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,b){return b.getValue(a,this.labelAttr||this.searchAttr).toString()}});dojo.declare("dijit.form._ComboBoxMenu",
[dijit._Widget,dijit._Templated,dijit._CssStateMixin],{templateString:"<ul class='dijitReset dijitMenu' dojoAttachEvent='onmousedown:_onMouseDown,onmouseup:_onMouseUp,onmouseover:_onMouseOver,onmouseout:_onMouseOut' style='overflow: \"auto\"; overflow-x: \"hidden\";'><li class='dijitMenuItem dijitMenuPreviousButton' dojoAttachPoint='previousButton' role='option'></li><li class='dijitMenuItem dijitMenuNextButton' dojoAttachPoint='nextButton' role='option'></li></ul>",_messages:null,baseClass:"dijitComboBoxMenu",
postMixInProperties:function(){this.inherited(arguments);this._messages=dojo.i18n.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(a){this.value=a;this.onChange(a)},onChange:function(){},onPage:function(){},onClose:function(){this._blurOptionNode()},_createOption:function(a,b){var c=dojo.create("li",{"class":"dijitReset dijitMenuItem"+
(this.isLeftToRight()?"":" dijitMenuItemRtl"),role:"option"}),d=b(a);if(d.html)c.innerHTML=d.label;else c.appendChild(dojo.doc.createTextNode(d.label));if(c.innerHTML=="")c.innerHTML="&nbsp;";c.item=a;return c},createOptions:function(a,b,c){this.previousButton.style.display=b.start==0?"none":"";dojo.attr(this.previousButton,"id",this.id+"_prev");dojo.forEach(a,function(e,f){var g=this._createOption(e,c);dojo.attr(g,"id",this.id+f);this.domNode.insertBefore(g,this.nextButton)},this);var d=false;if(b._maxOptions&&
b._maxOptions!=-1)if(b.start+b.count<b._maxOptions)d=true;else{if(b.start+b.count>b._maxOptions&&b.count==a.length)d=true}else if(b.count==a.length)d=true;this.nextButton.style.display=d?"":"none";dojo.attr(this.nextButton,"id",this.id+"_next");return this.domNode.childNodes},clearResultList:function(){for(;this.domNode.childNodes.length>2;)this.domNode.removeChild(this.domNode.childNodes[this.domNode.childNodes.length-2]);this._blurOptionNode()},_onMouseDown:function(a){dojo.stopEvent(a)},_onMouseUp:function(a){if(!(a.target===
this.domNode||!this._highlighted_option))if(a.target==this.previousButton){this._blurOptionNode();this.onPage(-1)}else if(a.target==this.nextButton){this._blurOptionNode();this.onPage(1)}else{for(a=a.target;!a.item;)a=a.parentNode;this._setValueAttr({target:a},true)}},_onMouseOver:function(a){if(a.target!==this.domNode){a=a.target;if(!(a==this.previousButton||a==this.nextButton))for(;!a.item;)a=a.parentNode;this._focusOptionNode(a)}},_onMouseOut:function(a){a.target!==this.domNode&&this._blurOptionNode()},
_focusOptionNode:function(a){if(this._highlighted_option!=a){this._blurOptionNode();this._highlighted_option=a;dojo.addClass(this._highlighted_option,"dijitMenuItemSelected")}},_blurOptionNode:function(){if(this._highlighted_option){dojo.removeClass(this._highlighted_option,"dijitMenuItemSelected");this._highlighted_option=null}},_highlightNextOption:function(){if(this.getHighlightedOption()){var a=this._highlighted_option.nextSibling;a&&a.style.display!="none"?this._focusOptionNode(a):this.highlightFirstOption()}else{a=
this.domNode.firstChild;this._focusOptionNode(a.style.display=="none"?a.nextSibling:a)}dojo.window.scrollIntoView(this._highlighted_option)},highlightFirstOption:function(){var a=this.domNode.firstChild,b=a.nextSibling;this._focusOptionNode(b.style.display=="none"?a:b);dojo.window.scrollIntoView(this._highlighted_option)},highlightLastOption:function(){this._focusOptionNode(this.domNode.lastChild.previousSibling);dojo.window.scrollIntoView(this._highlighted_option)},_highlightPrevOption:function(){if(this.getHighlightedOption()){var a=
this._highlighted_option.previousSibling;a&&a.style.display!="none"?this._focusOptionNode(a):this.highlightLastOption()}else{a=this.domNode.lastChild;this._focusOptionNode(a.style.display=="none"?a.previousSibling:a)}dojo.window.scrollIntoView(this._highlighted_option)},_page:function(a){var b=0,c=this.domNode.scrollTop,d=dojo.style(this.domNode,"height");for(this.getHighlightedOption()||this._highlightNextOption();b<d;){if(a){if(!this.getHighlightedOption().previousSibling||this._highlighted_option.previousSibling.style.display==
"none")break;this._highlightPrevOption()}else{if(!this.getHighlightedOption().nextSibling||this._highlighted_option.nextSibling.style.display=="none")break;this._highlightNextOption()}var e=this.domNode.scrollTop;b+=(e-c)*(a?-1:1);c=e}},pageUp:function(){this._page(true)},pageDown:function(){this._page(false)},getHighlightedOption:function(){var a=this._highlighted_option;return a&&a.parentNode?a:null},handleKey:function(a){switch(a.charOrCode){case dojo.keys.DOWN_ARROW:this._highlightNextOption();
return false;case dojo.keys.PAGE_DOWN:this.pageDown();return false;case dojo.keys.UP_ARROW:this._highlightPrevOption();return false;case dojo.keys.PAGE_UP:this.pageUp();return false;default:return true}}});dojo.declare("dijit.form.ComboBox",[dijit.form.ValidationTextBox,dijit.form.ComboBoxMixin],{_setValueAttr:function(a,b,c){this._set("item",null);a||(a="");dijit.form.ValidationTextBox.prototype._setValueAttr.call(this,a,b,c)}});dojo.declare("dijit.form._ComboBoxDataStore",null,{constructor:function(a){this.root=
a;if(a.tagName!="SELECT"&&a.firstChild){a=dojo.query("select",a);if(a.length>0)a=a[0];else{this.root.innerHTML="<SELECT>"+this.root.innerHTML+"</SELECT>";a=this.root.firstChild}this.root=a}dojo.query("> option",a).forEach(function(b){b.innerHTML=dojo.trim(b.innerHTML)})},getValue:function(a,b){return b=="value"?a.value:a.innerText||a.textContent||""},isItemLoaded:function(){return true},getFeatures:function(){return{"dojo.data.api.Read":true,"dojo.data.api.Identity":true}},_fetchItems:function(a,
b){if(!a.query)a.query={};if(!a.query.name)a.query.name="";if(!a.queryOptions)a.queryOptions={};var c=dojo.data.util.filter.patternToRegExp(a.query.name,a.queryOptions.ignoreCase),d=dojo.query("> option",this.root).filter(function(e){return(e.innerText||e.textContent||"").match(c)});a.sort&&d.sort(dojo.data.util.sorter.createSortFunction(a.sort,this));b(d,a)},close:function(){},getLabel:function(a){return a.innerHTML},getIdentity:function(a){return dojo.attr(a,"value")},fetchItemByIdentity:function(a){var b=
dojo.query("> option[value='"+a.identity+"']",this.root)[0];a.onItem(b)},fetchSelectedItem:function(){var a=this.root,b=a.selectedIndex;return typeof b=="number"?dojo.query("> option:nth-child("+(b!=-1?b+1:1)+")",a)[0]:null}});dojo.extend(dijit.form._ComboBoxDataStore,dojo.data.util.simpleFetch)};
dojo.provide('bizbuysell.wsj');

var BBSWSJ = (function()
{
  var bbsWSJ = {};
  var currentSearchType = 'eb';
  var contentProviderUrl = 'http://www.bizbuysell.com/';
  
  var bbsWidgetContainer = document.getElementById(
    'bbsWidgetContainer');
  
  bbsWSJ.SearchTypeToggle = function(
    searchType)
  {
    if (typeof(searchType) == 'undefined')
    {
      searchType = 'eb';
    }
    
    setSearchType(
      searchType);
      
    var hidCurrentSearchType = document.getElementById(
      'hidCurrentSearchType');
      
    if (hidCurrentSearchType)
    {
      hidCurrentSearchType.value = searchType;
    }
  };
  
  bbsWSJ.LoadCounties = function(
    ddlCountiesClientID,
    maintainSelectedCounty)
  {
    if (!maintainSelectedCounty)
    {
      var hidSelectedCountyCode = document.getElementById(
        'hidSelectedCountyCode');
        
      if (hidSelectedCountyCode)
      {
        hidSelectedCountyCode.value = '0';
      }
    }
    
    if ((typeof(ddlCountiesClientID) != 'undefined') &&
      (ddlCountiesClientID.length > 0))
    {
      var ddlCounties = document.getElementById(
        ddlCountiesClientID);
          
      if (ddlCounties)
      {
        ddlCounties.disabled = true;
        
        if ((bbsWidgetContainer) &&
          (typeof(this.selectedIndex) != 'undefined') &&
          (this.selectedIndex > 0) &&
          (typeof(this.value) != 'undefined') &&
          (this.value.length > 0) &&
          (this.value.toUpperCase() != 'XX'))
        {
          var callBackFunctionName = (
            'loadCountiesCallBack_' +
            Math.floor(Math.random() * 1000));
            
          var webServiceScript = document.createElement(
            'script');
            
          webServiceScript.type = 'text/javascript';
          
          webServiceScript.setAttribute(
            'async', 
            'true');
          
          webServiceScript.src = (
            contentProviderUrl +
            'cobranding/Services/Geo.get.asmx/GetCountiesByRegionLegacyStateCode?selectedRegionLegacyStateCode="' +
            this.value +
            '"&callback="BBSWSJ.' +
            callBackFunctionName +
            '"');
            
          bbsWSJ[callBackFunctionName] = function(
            counties)
          {
            if ((typeof(counties) != 'undefined') &&
              (typeof(counties.length) != 'undefined') &&
              (counties.length > 0))
            {
              ddlCounties.length = 0;
              
              ddlCounties.options.add(
                new Option(
                  'All Counties',
                  ''));
                  
              var selectedCounty = 0;
                  
              var hidSelectedCountyCode = document.getElementById(
                'hidSelectedCountyCode');
                
              if ((hidSelectedCountyCode) &&
                (parseInt(hidSelectedCountyCode.value, 10) > 0))
              {
                selectedCounty = parseInt(hidSelectedCountyCode.value, 10);
              }
                
              for (var index = 0; index < counties.length; index++)
              {
                ddlCounties.options.add(
                  new Option(
                    counties[index].CountyName,
                    counties[index].CountyCode));
              }
              
              if (selectedCounty > 0)
              {
                ddlCounties.value = selectedCounty;
              }
              
              ddlCounties.disabled = false;
            }
            
            if (webServiceScript)
            {
              bbsWidgetContainer.removeChild(
                webServiceScript);
            }
            
            delete bbsWSJ[callBackFunctionName];
          };
            
          bbsWidgetContainer.appendChild(
            webServiceScript);
        }
        else
        {
          ddlCounties.options[0] = new Option(
            'County',
            '');
            
          ddlCounties.options.length = 1;
        }
      }
    }
  };
  
  bbsWSJ.SetSelectedCountyCode = function(
    countyCode)
  {
    if ((typeof(countyCode) != 'undefined') &&
      (countyCode.length > 0) &&
      (parseInt(countyCode, 10) > 0))
    {
      var hidSelectedCountyCode = document.getElementById(
        'hidSelectedCountyCode');
        
      if (hidSelectedCountyCode)
      {
        hidSelectedCountyCode.value = countyCode;
      }
    }
  };
  
  bbsWSJ.OnKeywordFocus = function()
  {
    this.className = this.className.replace(
      /\s+?default/, 
      '');
  };
  
  bbsWSJ.OnKeywordBlur = function()
  {
    if (this.value.length == 0)
    {
      this.className += (
        ((this.className.length > 0) ? ' ' : '') + 
        'default');
    }
  };
  
  function setSearchType(
    searchType)
  {
    if ((typeof(searchType) == 'undefined') ||
      (typeof(searchType.length) == 'undefined') ||
      (searchType.length <= 0))
    {
      searchType = 'eb';
    }
    
    currentSearchType = searchType;
    
    var searchTypeContainer = document.getElementById(
      'searchTypeContainer');
      
    if (searchTypeContainer)
    {
      searchTypeContainer.className = searchType;
    }
  }
  
  function attachEvent(
    eventName,
    eventHandler)
  {
    if (window.attachEvent)
    {
      window.attachEvent(
        ('on' +
          eventName),
        eventHandler);
    }
    else
    {
      window.addEventListener(
        eventName,
        eventHandler,
        false);
    }
  }
  
  attachEvent(
    'load',
    function()
    {
      var ddlBFSCategories = document.getElementById(
        'ddlBFSCategories');
        
      if ((ddlBFSCategories) &&
        (ddlBFSCategories.selectedIndex > 0) &&
        (ddlBFSCategories.value.toUpperCase() == 'XX'))
      {
        ddlBFSCategories.selectedIndex = 0;
      }
      
      var ddlBizOpCategories = document.getElementById(
        'ddlBizOpCategories');
        
      if ((ddlBizOpCategories) &&
        (ddlBizOpCategories.selectedIndex > 0) &&
        (ddlBizOpCategories.value.toUpperCase() == 'XX'))
      {
        ddlBizOpCategories.selectedIndex = 0;
      }
      
      var txtKeywords = document.getElementById(
        'txtKeywords');
        
      if ((txtKeywords) &&
        (txtKeywords.value.length > 0))
      {
        txtKeywords.className = txtKeywords.className.replace(
          /\s+?default/, 
          '');
      }
      
      var hidCurrentSearchType = document.getElementById(
        'hidCurrentSearchType');
        
      if ((hidCurrentSearchType) &&
        (hidCurrentSearchType.value.length > 0))
      {
        setSearchType(
          hidCurrentSearchType.value);
      }
      
      var ddlBFSStates = document.getElementById(
        'ddlBFSStates');
        
      if (ddlBFSStates)
      {
        bbsWSJ.LoadCounties.call(
          ddlBFSStates,
          'ddlBFSCounties',
          true);
      }
      
      var ddlBizOpStates = document.getElementById(
        'ddlBizOpStates');
        
      if (ddlBizOpStates)
      {
        bbsWSJ.LoadCounties.call(
          ddlBizOpStates,
          'ddlBizOpCounties',
          true);
      }
    });
  
  return bbsWSJ;
})();
if (typeof dojo !== "undefined") {
  dojo.provide("blueKai.blueKai");
}

/* global blueKai document unescape */
if (typeof blueKai === "undefined") {
	blueKai = {};
}
var KRUXSetup = {
	pubid:"1c6ac852-8938-481a-84b8-4806affc8c13", 
    async: true

};
blueKai.blueKai = {
	dataJson :{},
	timercounter:0,	
	adDivs:[],
	bk_track:function(check, data){
		if(check && document.location.protocol.indexOf('https')==-1){
			if(data){
				this.dataJson = data;
				this.sendBlueKai();
			}else{
				this.adDivs = this.getbyclass();	
				if(!this.getData()){
					return;
				}
			}
		}
	},
	sendBlueKai: function(){
		/* 2.4.0-31349 */ 
		if(typeof BKTAG=="undefined"||!BKTAG){var BKTAG=(function(){var params=[];var doTagged=false;var _={getKwds:function(){var meta=document.getElementsByTagName('meta');var kwds=[];var ii=meta.length;for(var i=0;i<ii;i++){if(meta[i].name&&meta[i].name.toLowerCase()=='keywords'){kwds.push(meta[i].content)}}return kwds.join(',')},addBkParam:function(k,v){self.addParam('phint','__bk_'+k,v)}};var self={_dest:null,createHidden:function(k,v){var myInput=document.createElement("input");myInput.setAttribute('type','hidden');myInput.setAttribute("name",k);myInput.setAttribute("value",v);return myInput},doTag:function(site,limit,excludeBkParams,allowMultipleCalls){var bkFrame=null;if(doTagged&&!(allowMultipleCalls===true)){return}doTagged=true;params.unshift('r='+parseInt(Math.random()*99999));params.unshift('limit='+limit);params.unshift('ret=html');if(!excludeBkParams){self.addParam('phint','__bk_k',document.title);self.addParam('phint','__bk_k',_.getKwds())}self._dest=('https:'==document.location.protocol?'https://stags':'http://tags')+'.bluekai.com/site/'+site+'?'+params.join('&');self._dest=self._dest.substr(0,2000);var isOpera=false,isIE=false;if(typeof(window.opera)!='undefined'){isOpera=true}var ieIndex=navigator.userAgent.indexOf('Internet Explorer');if(!isOpera&&ieIndex>-1){isIE=true};if(!isIE){bkFrame=document.createElement("iframe");bkFrame.setAttribute('height','1');bkFrame.setAttribute('width','1');bkFrame.setAttribute("name","__bkframe");bkFrame.setAttribute("frameborder","0");bkFrame.setAttribute("src",self._dest);document.body.appendChild(bkFrame)}else{bkFrame=document.createElement("div");bkFrame.innerHTML='<iframe name="__bkframe" height="1" width="1" frameborder="0" src="'+self._dest+'" />';document.body.appendChild(bkFrame)}params=[]},addParam:function(type,k,v){if(v){var val=k+'='+v;val=encodeURIComponent(val);params.push(type+'='+val)}},addValue:function(k,v){if(v){var val=encodeURIComponent(v);params.push(k+'='+val)}}};return self})();function bk_addPageCtx(k,v){BKTAG.addParam('phint',k,v)}function bk_addVar(k,v){BKTAG.addValue(k,v)}function bk_doJSTag(site,limit,allowMultipleCalls){BKTAG.doTag(site,limit,false,allowMultipleCalls)}function bk_doSendData(site,limit,excludeBkParams,allowMultipleCalls){BKTAG.doTag(site,limit,excludeBkParams,allowMultipleCalls)}}		
		
		for(var key in this.dataJson ) {
			if(key && this.dataJson[key] != "" ) {
				bk_addPageCtx(key, this.dataJson[key]);
			}
		}
		
		var siteIds = { 
				"wsj.com" : "4454", 
				"barrons.com" : "4457", 
				"marketwatch.com":"4455", 
				"smartmoney.com":"4458", 
				"allthingsd.com":"4459", 
				"fins.com":"4456", 
				"wsjwine.com":"4461",	
				"efinancialnews.com":"4460"
					};
		var limit = 10;  //( we can tune it later )
		var site = document.location.href;
		var siteId = this.getSiteId(siteIds);
		this.makeFrame();
		bk_doSendData(siteId, limit, false);
		this.sendKrux();
		var url = document.URL.toLowerCase();
		if(url.indexOf('bluekaidebug=yes')>0) this.showData();
	},
	sendKrux: function(){

		KRUXSetup['site'] = this.dataJson['primaryProduct'];
		KRUXSetup['section'] = this.dataJson['section'];
		KRUXSetup['subSection'] = this.dataJson['articleType'];

		this.include("http://sj.wsj.net/internal/krux.js");
		
	},
	getSiteId:function(siteIds){
		var site = document.location.href;
		var defaultKey ="";
		for( key in siteIds ) {
			if(site.indexOf(key)>-1){
				return siteIds[key];
			}else if(".wsj.com".indexOf(key)>-1){
				defaultKey = siteIds[key];
			} 
		}		
		return defaultKey;
	},
	getData:function(){

		 this.dataJson = { 
			"serverDomain" : s?s.server:"",
			"primaryProduct" : s?s.channel:"",
			"pageName" : s?s.pageName:"",
			"section" : s?s.prop2:"",
			"articleType" : s?s.prop3:"",
			"subSection" : s?s.prop26:"",
			"contentType" : s?s.prop19:"",
			"encryptedUUID" : s?s.prop25:"",
			"contentChannel" : s?s.prop1:"",
			"isSub" : s?s.prop27:"",
			"edition" : s?s.prop24:"",
			"referrer" : document.referrer!=""?document.referrer.split('/')[2]:""
				};
		 if(typeof this.dataJson.subsection=="undefined" || this.dataJson.subsection=="")this.dataJson.subsection=this.dataJson.section;
		return this.getAdsData();
	},
	getAdsData:function(){
		if(this.adDivs.length>0){		
			var countSize=1;
			var countZone=1;
			var countSection=1;						
			var strSection = ",";
			var strZone = ",";
			var strSize = ",";
			for(i=0;i<this.adDivs.length;i++){
				if((this.adDivs[i].innerHTML.replace(/^\s+|\s+$/g,"")!='' && this.adDivs[i].getElementsByTagName('iframe')[0]!=undefined)|| this.timercounter>5){
					var ad=this.adDivs[i].getElementsByTagName('iframe')[0];
					if(ad){
						var ind=ad.src.indexOf('doubleclick.net');
						var height=ad.height;
						var width=ad.width;	
						if(ind>1 && height >2 && width >2){
							var str=ad.src.substring(ind);
							if(strSize.indexOf(","+str+",")==-1){
								strSize = strSize+width+"x"+height + ",";
								this.dataJson['adSize'+(countSize++)] = width+"x"+height;
								if(countSize>10)break;
							}
							if(str.split('/')[3]){
								var zone = str.split('/')[3].split(';')[0];
								if(strZone.indexOf(","+zone+",")==-1){
									strZone = strZone + zone+",";
									this.dataJson['adZone'+(countZone++)] = zone;
								}
								var section = str.split('/')[2];
								if(strSection.indexOf(","+section+",")==-1){
									strSection = strSection + section+",";
									this.dataJson['adSection'+(countSection++)] = section;
								}
	
							}
						}
					}
				}else{
					this.timercounter++;
					window.setTimeout('blueKai.blueKai.getAdsData()',1000);
					return false;
				}
				
				
			}
			
		}
		this.sendBlueKai();
	},
	makeFrame:function () {
	   var ifrm = document.createElement("IFRAME");
	   ifrm.setAttribute("src", "javascript:void(0)");
	   ifrm.setAttribute("name", "__bkframe");
	   ifrm.setAttribute("frameborder", 0);
	   ifrm.style.width = 0+"px";
	   ifrm.style.height = 0+"px";
	   document.body.appendChild(ifrm);
	},
	include: function(file){
		var script  = document.createElement('script');
		script.src  = file;
		script.type = 'text/javascript';
		script.defer = true;
		document.getElementsByTagName('head').item(0).appendChild(script);
	},
	showData:function(){
		var out = '';
		for (var data in blueKai.blueKai.dataJson) {
			if(blueKai.blueKai.dataJson[data]!=null && blueKai.blueKai.dataJson[data].replace(/^\s+|\s+$/g,"")!=""){
				out += data + ': ' + blueKai.blueKai.dataJson[data] + '\n';
			}
		}
		alert(out);		
	},
	getbyclass: function(){
	  var elements = document.getElementsByTagName("div");
	  var result = [];
	  var attName= "class";
	  if(elements[0].getAttribute("className")!=null){
		  attName= "className";
	  }
	  for(z=0;z<elements.length;z++){
		  if(elements[z].getAttribute(attName) && elements[z].getAttribute(attName).match(/adSummary/)){
	      result.push(elements[z]);
	    }
	  }
	  return result;
	}

};
/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  COMMIT: c93da0623f1d30ebcb065e94a0476d8275225c72
 *  URL: https://github.com/twitter/hogan.js/commits/master/lib/compiler.js
 *  DATE: Apr 17, 2012
 *
 *  NOTE: one more modification (dojox.hogan) at the end of the file
 */

dojo.provide("hogan._compiler");

(function (Hogan) {
  // Setup regex  assignments
  // remove whitespace according to Mustache spec
  var rIsWhitespace = /\S/,
      rQuot = /\"/g,
      rNewline =  /\n/g,
      rCr = /\r/g,
      rSlash = /\\/g;

  Hogan.tags = {
    '#': 1, '^': 2, '<': 3, '$': 4,
    '/': 5, '!': 6, '>': 7, '=': 8, '_v': 9,
    '{': 10, '&': 11, '_t': 12
  };

  Hogan.scan = function scan(text, delimiters) {
    var len = text.length,
        IN_TEXT = 0,
        IN_TAG_TYPE = 1,
        IN_TAG = 2,
        state = IN_TEXT,
        tagType = null,
        tag = null,
        buf = '',
        tokens = [],
        seenTag = false,
        i = 0,
        lineStart = 0,
        otag = '{{',
        ctag = '}}';

    function addBuf() {
      if (buf.length > 0) {
        tokens.push({tag: '_t', text: new String(buf)});
        buf = '';
      }
    }

    function lineIsWhitespace() {
      var isAllWhitespace = true;
      for (var j = lineStart; j < tokens.length; j++) {
        isAllWhitespace =
          (Hogan.tags[tokens[j].tag] < Hogan.tags['_v']) ||
          (tokens[j].tag == '_t' && tokens[j].text.match(rIsWhitespace) === null);
        if (!isAllWhitespace) {
          return false;
        }
      }

      return isAllWhitespace;
    }

    function filterLine(haveSeenTag, noNewLine) {
      addBuf();

      if (haveSeenTag && lineIsWhitespace()) {
        for (var j = lineStart, next; j < tokens.length; j++) {
          if (tokens[j].text) {
            if ((next = tokens[j+1]) && next.tag == '>') {
              // set indent to token value
              next.indent = tokens[j].text.toString()
            }
            tokens.splice(j, 1);
          }
        }
      } else if (!noNewLine) {
        tokens.push({tag:'\n'});
      }

      seenTag = false;
      lineStart = tokens.length;
    }

    function changeDelimiters(text, index) {
      var close = '=' + ctag,
          closeIndex = text.indexOf(close, index),
          delimiters = trim(
            text.substring(text.indexOf('=', index) + 1, closeIndex)
          ).split(' ');

      otag = delimiters[0];
      ctag = delimiters[1];

      return closeIndex + close.length - 1;
    }

    if (delimiters) {
      delimiters = delimiters.split(' ');
      otag = delimiters[0];
      ctag = delimiters[1];
    }

    for (i = 0; i < len; i++) {
      if (state == IN_TEXT) {
        if (tagChange(otag, text, i)) {
          --i;
          addBuf();
          state = IN_TAG_TYPE;
        } else {
          if (text.charAt(i) == '\n') {
            filterLine(seenTag);
          } else {
            buf += text.charAt(i);
          }
        }
      } else if (state == IN_TAG_TYPE) {
        i += otag.length - 1;
        tag = Hogan.tags[text.charAt(i + 1)];
        tagType = tag ? text.charAt(i + 1) : '_v';
        if (tagType == '=') {
          i = changeDelimiters(text, i);
          state = IN_TEXT;
        } else {
          if (tag) {
            i++;
          }
          state = IN_TAG;
        }
        seenTag = i;
      } else {
        if (tagChange(ctag, text, i)) {
          tokens.push({tag: tagType, n: trim(buf), otag: otag, ctag: ctag,
                       i: (tagType == '/') ? seenTag - otag.length : i + ctag.length});
          buf = '';
          i += ctag.length - 1;
          state = IN_TEXT;
          if (tagType == '{') {
            if (ctag == '}}') {
              i++;
            } else {
              cleanTripleStache(tokens[tokens.length - 1]);
            }
          }
        } else {
          buf += text.charAt(i);
        }
      }
    }

    filterLine(seenTag, true);

    return tokens;
  }

  function cleanTripleStache(token) {
    if (token.n.substr(token.n.length - 1) === '}') {
      token.n = token.n.substring(0, token.n.length - 1);
    }
  }

  function trim(s) {
    if (s.trim) {
      return s.trim();
    }

    return s.replace(/^\s*|\s*$/g, '');
  }

  function tagChange(tag, text, index) {
    if (text.charAt(index) != tag.charAt(0)) {
      return false;
    }

    for (var i = 1, l = tag.length; i < l; i++) {
      if (text.charAt(index + i) != tag.charAt(i)) {
        return false;
      }
    }

    return true;
  }

  // the tags allowed inside super templates
  var allowedInSuper = {'_t': true, '\n': true, '$': true, '/': true};

  function buildTree(tokens, kind, stack, customTags) {
    var instructions = [],
        opener = null,
        tail = null,
        token = null;

    tail = stack[stack.length - 1];

    while (tokens.length > 0) {
      token = tokens.shift();

      if (tail && tail.tag == '<' && !(token.tag in allowedInSuper)) {
        throw new Error('Illegal content in < super tag.');
      }

      if (Hogan.tags[token.tag] <= Hogan.tags['$'] || isOpener(token, customTags)) {
        stack.push(token);
        token.nodes = buildTree(tokens, token.tag, stack, customTags);
      } else if (token.tag == '/') {
        if (stack.length === 0) {
          throw new Error('Closing tag without opener: /' + token.n);
        }
        opener = stack.pop();
        if (token.n != opener.n && !isCloser(token.n, opener.n, customTags)) {
          throw new Error('Nesting error: ' + opener.n + ' vs. ' + token.n);
        }
        opener.end = token.i;
        return instructions;
      } else if (token.tag == '\n') {
        token.last = (tokens.length == 0) || (tokens[0].tag == '\n');
      }

      instructions.push(token);
    }

    if (stack.length > 0) {
      throw new Error('missing closing tag: ' + stack.pop().n);
    }

    return instructions;
  }

  function isOpener(token, tags) {
    for (var i = 0, l = tags.length; i < l; i++) {
      if (tags[i].o == token.n) {
        token.tag = '#';
        return true;
      }
    }
  }

  function isCloser(close, open, tags) {
    for (var i = 0, l = tags.length; i < l; i++) {
      if (tags[i].c == close && tags[i].o == open) {
        return true;
      }
    }
  }

  function stringifyFunctions(obj) {
    var items = [];
    for (var key in obj) {
      items.push('"' + esc(key) + '": function(c,p,t) {' + obj[key] + '}');
    }
    return "{ " + items.join(",") + " }";
  }

  function stringifyPartials(codeObj) {
    var partials = [];
    for (var key in codeObj.partials) {
      partials.push('"' + esc(key) + '":{name:"' + esc(codeObj.partials[key].name) + '", ' + stringifyPartials(codeObj.partials[key]) + "}");
    }
    return "partials: {" + partials.join(",") + "}, subs: " + stringifyFunctions(codeObj.subs);
  }

  Hogan.stringify = function(codeObj, text, options) {
    return "{code: function (c,p,i) { " + Hogan.wrapMain(codeObj.code) + " }," + stringifyPartials(codeObj) +  "}";
  }

  var serialNo = 0;
  Hogan.generate = function(tree, text, options) {
    serialNo = 0;
    var context = { code: '', subs: {}, partials: {} };
    Hogan.walk(tree, context);

    if (options.asString) {
      return this.stringify(context, text, options);
    }

    return this.makeTemplate(context, text, options);
  }

  Hogan.wrapMain = function(code) {
    return 'var t=this;t.b(i=i||"");' + code + 'return t.fl();';
  }

  Hogan.template = Hogan.Template;

  Hogan.makeTemplate = function(codeObj, text, options) {
    var template = this.makePartials(codeObj);
    template.code = new Function('c', 'p', 'i', this.wrapMain(codeObj.code));
    return new this.template(template, text, this, options);
  }

  Hogan.makePartials = function(codeObj) {
    var key, template = {subs: {}, partials: codeObj.partials, name: codeObj.name};
    for (key in template.partials) {
      template.partials[key] = this.makePartials(template.partials[key]);
    }
    for (key in codeObj.subs) {
      template.subs[key] = new Function('c', 'p', 't', codeObj.subs[key]);
    }
    return template;
  }

  function esc(s) {
    return s.replace(rSlash, '\\\\')
            .replace(rQuot, '\\\"')
            .replace(rNewline, '\\n')
            .replace(rCr, '\\r');
  }

  function chooseMethod(s) {
    return (~s.indexOf('.')) ? 'd' : 'f';
  }

  function createPartial(node, context) {
    var prefix = "<" + (context.prefix || "");
    var sym = prefix + node.n + serialNo++;
    context.partials[sym] = {name: node.n, partials: {}};
    context.code += 't.b(t.rp("' +  esc(sym) + '",c,p,"' + (node.indent || '') + '"));';
    return sym;
  }

  Hogan.codegen = {
    '#': function(node, context) {
      context.code += 'if(t.s(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,1),' +
                      'c,p,0,' + node.i + ',' + node.end + ',"' + node.otag + " " + node.ctag + '")){' +
                      't.rs(c,p,' + 'function(c,p,t){';
      Hogan.walk(node.nodes, context);
      context.code += '});c.pop();}';
    },

    '^': function(node, context) {
      context.code += 'if(!t.s(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,1),c,p,1,0,0,"")){';
      Hogan.walk(node.nodes, context);
      context.code += '};';
    },

    '>': createPartial,
    '<': function(node, context) {
      var ctx = {partials: {}, code: '', subs: {}, inPartial: true};
      Hogan.walk(node.nodes, ctx);
      var template = context.partials[createPartial(node, context)];
      template.subs = ctx.subs;
      template.partials = ctx.partials;
    },

    '$': function(node, context) {
      var ctx = {subs: {}, code: '', partials: context.partials, prefix: node.n};
      Hogan.walk(node.nodes, ctx);
      context.subs[node.n] = ctx.code;
      if (!context.inPartial) {
        context.code += 't.sub("' + esc(node.n) + '",c,p);';
      }
    },

    '\n': function(node, context) {
      context.code += write('"\\n"' + (node.last ? '' : ' + i'));
    },

    '_v': function(node, context) {
      context.code += 't.b(t.v(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,0)));';
    },

    '_t': function(node, context) {
      context.code += write('"' + esc(node.text) + '"');
    },

    '{': tripleStache,

    '&': tripleStache
  }

  function tripleStache(node, context) {
    context.code += 't.b(t.t(t.' + chooseMethod(node.n) + '("' + esc(node.n) + '",c,p,0)));';
  }

  function write(s) {
    return 't.b(' + s + ');';
  }

  Hogan.walk = function (nodelist, context) {
    var func;
    for (var i = 0, l = nodelist.length; i < l; i++) {
      func = Hogan.codegen[nodelist[i].tag];
      func && func(nodelist[i], context);
    }
    return context;
  }

  Hogan.parse = function(tokens, text, options) {
    options = options || {};
    return buildTree(tokens, '', [], options.sectionTags || []);
  },

  Hogan.cache = {};

  Hogan.cacheKey = function(text, options) {
    return [text, !!options.asString, !!options.disableLambda].join('||');
  },

  Hogan.compile = function(text, options) {
    options = options || {};
    var key = Hogan.cacheKey(text, options);
    var template = this.cache[key];

    if (template) {
      return template;
    }

    template = this.generate(this.parse(this.scan(text, options.delimiters), text, options), text, options);
    return this.cache[key] = template;
  };
})(typeof exports !== 'undefined' ? exports : hogan);
/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  COMMIT: 5b442f08817a00e9fe33d329c66e204b40f6312b
 *  URL: https://github.com/twitter/hogan.js/commits/master/lib/template.js
 *  DATE: Apr 02, 2012
 *
 *  NOTE: 2 mods (removed var Hogan = {}), and added dojox.hogan at the end of file
 */
dojo.provide("hogan.Template");

(function (Hogan, useArrayBuffer) {
  Hogan.Template = function (codeObj, text, compiler, options) {
    codeObj = codeObj || {};
    this.r = codeObj.code || this.r;
    this.c = compiler;
    this.options = options;
    this.text = text || '';
    this.partials = codeObj.partials || {};
    this.subs = codeObj.subs || {};
    this.ib();
  }

  Hogan.Template.prototype = {
    // render: replaced by generated code.
    r: function (context, partials, indent) { return ''; },

    // variable escaping
    v: hoganEscape,

    // triple stache
    t: coerceToString,

    render: function render(context, partials, indent) {
      return this.ri([context], partials || {}, indent);
    },

    // render internal -- a hook for overrides that catches partials too
    ri: function (context, partials, indent) {
      return this.r(context, partials, indent);
    },

    // ensurePartial
    ep: function(symbol, partials) {
      var partial = this.partials[symbol];

      // check to see that if we've instantiated this partial before
      var template = partials[partial.name];
      if (partial.instance && partial.base == template) {
        return partial.instance;
      }

      if (typeof template == 'string') {
        if (!this.c) {
          throw new Error("No compiler available.");
        }
        template = this.c.compile(template, this.options);
      }

      if (!template) {
        return null;
      }

      // We use this to check whether the partials dictionary has changed
      this.partials[symbol].base = template;

      if (partial.subs) {
        template = createSpecializedPartial(template, partial.subs, partial.partials);
      }

      this.partials[symbol].instance = template;
      return template;
    },

    // tries to find a partial in the curent scope and render it
    rp: function(symbol, context, partials, indent) {
      var partial = this.ep(symbol, partials);
      if (!partial) {
        return '';
      }

      return partial.ri(context, partials, indent);
    },

    // render a section
    rs: function(context, partials, section) {
      var tail = context[context.length - 1];

      if (!isArray(tail)) {
        section(context, partials, this);
        return;
      }

      for (var i = 0; i < tail.length; i++) {
        context.push(tail[i]);
        section(context, partials, this);
        context.pop();
      }
    },

    // maybe start a section
    s: function(val, ctx, partials, inverted, start, end, tags) {
      var pass;

      if (isArray(val) && val.length === 0) {
        return false;
      }

      if (typeof val == 'function') {
        val = this.ms(val, ctx, partials, inverted, start, end, tags);
      }

      pass = (val === '') || !!val;

      if (!inverted && pass && ctx) {
        ctx.push((typeof val == 'object') ? val : ctx[ctx.length - 1]);
      }

      return pass;
    },

    // find values with dotted names
    d: function(key, ctx, partials, returnFound) {
      var names = key.split('.'),
          val = this.f(names[0], ctx, partials, returnFound),
          cx = null;

      if (key === '.' && isArray(ctx[ctx.length - 2])) {
        return ctx[ctx.length - 1];
      }

      for (var i = 1; i < names.length; i++) {
        if (val && typeof val == 'object' && val[names[i]] != null) {
          cx = val;
          val = val[names[i]];
        } else {
          val = '';
        }
      }

      if (returnFound && !val) {
        return false;
      }

      if (!returnFound && typeof val == 'function') {
        ctx.push(cx);
        val = this.mv(val, ctx, partials);
        ctx.pop();
      }

      return val;
    },

    // find values with normal names
    f: function(key, ctx, partials, returnFound) {
      var val = false,
          v = null,
          found = false;

      for (var i = ctx.length - 1; i >= 0; i--) {
        v = ctx[i];
        if (v && typeof v == 'object' && v[key] != null) {
          val = v[key];
          found = true;
          break;
        }
      }

      if (!found) {
        return (returnFound) ? false : "";
      }

      if (!returnFound && typeof val == 'function') {
        val = this.mv(val, ctx, partials);
      }

      return val;
    },

    // higher order templates
    ls: function(func, cx, partials, text, tags) {
      var oldTags = this.options.delimiters;

      this.options.delimiters = tags;
      this.b(this.ct(coerceToString(func.call(cx, text)), cx, partials));
      this.options.delimiters = oldTags;

      return false;
    },

    // compile text
    ct: function(text, cx, partials) {
      if (this.options.disableLambda) {
        throw new Error('Lambda features disabled.');
      }
      return this.c.compile(text, this.options).render(cx, partials);
    },

    // template result buffering
    b: (useArrayBuffer) ? function(s) { this.buf.push(s); } :
                          function(s) { this.buf += s; },

    fl: (useArrayBuffer) ? function() { var r = this.buf.join(''); this.buf = []; return r; } :
                           function() { var r = this.buf; this.buf = ''; return r; },
    // init the buffer
    ib: function () {
      this.buf = (useArrayBuffer) ? [] : '';
    },

    // method replace section
    ms: function(func, ctx, partials, inverted, start, end, tags) {
      var cx = ctx[ctx.length - 1],
          result = func.call(cx);

      if (typeof result == 'function') {
        if (inverted) {
          return true;
        } else {
          return this.ls(result, cx, partials, this.text.substring(start, end), tags);
        }
      }

      return result;
    },

    // method replace variable
    mv: function(func, ctx, partials) {
      var cx = ctx[ctx.length - 1];
      var result = func.call(cx);

      if (typeof result == 'function') {
        return this.ct(coerceToString(result.call(cx)), cx, partials);
      }

      return result;
    },

    sub: function(name, context, partials) {
      var f = this.subs[name];
      if (f) {
        f(context, partials, this);
      }
    }

  };

  function createSpecializedPartial(instance, subs, partials) {
    function PartialTemplate() {};
    PartialTemplate.prototype = instance;
    function Substitutions() {};
    Substitutions.prototype = instance.subs;
    var key;
    var partial = new PartialTemplate();
    partial.subs = new Substitutions();
    partial.ib();

    for (key in subs) {
      partial.subs[key] = subs[key];
    }

    for (key in partials) {
      partial.partials[key] = partials[key];
    }

    return partial;
  }

  var rAmp = /&/g,
      rLt = /</g,
      rGt = />/g,
      rApos =/\'/g,
      rQuot = /\"/g,
      hChars =/[&<>\"\']/;

  function coerceToString(val) {
    return String((val === null || val === undefined) ? '' : val);
  }

  function hoganEscape(str) {
    str = coerceToString(str);
    return hChars.test(str) ?
      str
        .replace(rAmp,'&amp;')
        .replace(rLt,'&lt;')
        .replace(rGt,'&gt;')
        .replace(rApos,'&#39;')
        .replace(rQuot, '&quot;') :
      str;
  }

  var isArray = Array.isArray || function(a) {
    return Object.prototype.toString.call(a) === '[object Array]';
  };

})(typeof exports !== 'undefined' ? exports : hogan);
dojo.provide("jkl.jkl-parsexml");

// ================================================================
//  jkl-parsexml.js ---- JavaScript Kantan Library for Parsing XML
//  Copyright 2005-2007 Kawasaki Yusuke <u-suke@kawa.net>
//  http://www.kawa.net/works/js/jkl/parsexml.html
// ================================================================
//  v0.01  2005/05/18  first release
//  v0.02  2005/05/20  Opera 8.0beta may be abailable but somtimes crashed
//  v0.03  2005/05/20  overrideMimeType( "text/xml" );
//  v0.04  2005/05/21  class variables: REQUEST_TYPE, RESPONSE_TYPE
//  v0.05  2005/05/22  use Msxml2.DOMDocument.5.0 for GET method on IE6
//  v0.06  2005/05/22  CDATA_SECTION_NODE
//  v0.07  2005/05/23  use Microsoft.XMLDOM for GET method on IE6
//  v0.10  2005/10/11  new function: JKL.ParseXML.HTTP.responseText()
//  v0.11  2005/10/13  new sub class: JKL.ParseXML.Text, JSON and DOM.
//  v0.12  2005/10/14  new sub class: JKL.ParseXML.CSV and CSVmap.
//  v0.13  2005/10/28  bug fixed: TEXT_NODE regexp for white spaces
//  v0.14  2005/11/06  bug fixed: TEXT_NODE regexp at Safari
//  v0.15  2005/11/08  bug fixed: JKL.ParseXML.CSV.async() method
//  v0.16  2005/11/15  new sub class: LoadVars, and UTF-8 text on Safari
//  v0.18  2005/11/16  improve: UTF-8 text file on Safari
//  v0.19  2006/02/03  use XMLHTTPRequest instead of ActiveX on IE7,iCab
//  v0.20  2006/03/22  (skipped)
//  v0.21  2006/11/30  use ActiveX again on IE7
//  v0.22  2007/01/04  JKL.ParseXML.JSON.parseResponse() updated
// ================================================================

if ( typeof(JKL) == 'undefined' ){JKL = function() {};}

// ================================================================
//  class: JKL.ParseXML

JKL.ParseXML = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, false );
    return this;
};

// ================================================================
//  class variables

JKL.ParseXML.VERSION = "0.22";
JKL.ParseXML.MIME_TYPE_XML  = "text/xml";
JKL.ParseXML.MAP_NODETYPE = [
    "",
    "ELEMENT_NODE",                 // 1
    "ATTRIBUTE_NODE",               // 2
    "TEXT_NODE",                    // 3
    "CDATA_SECTION_NODE",           // 4
    "ENTITY_REFERENCE_NODE",        // 5
    "ENTITY_NODE",                  // 6
    "PROCESSING_INSTRUCTION_NODE",  // 7
    "COMMENT_NODE",                 // 8
    "DOCUMENT_NODE",                // 9
    "DOCUMENT_TYPE_NODE",           // 10
    "DOCUMENT_FRAGMENT_NODE",       // 11
    "NOTATION_NODE"                 // 12
];

// ================================================================
//  define callback function (ajax)

JKL.ParseXML.prototype.async = function ( func, args ) {
    this.callback_func = func;      // callback function
    this.callback_arg  = args;      // first argument
};

JKL.ParseXML.prototype.onerror = function ( func, args ) {
    this.onerror_func = func;       // callback function
};

// ================================================================
//  method: parse()
//  return: parsed object
//  Download a file from remote server and parse it.

JKL.ParseXML.prototype.parse = function () {
    if ( ! this.http ) {
      return;
    }

    // set onerror call back
    if ( this.onerror_func ) {
        this.http.onerror( this.onerror_func );
    }

    if ( this.callback_func ) {                             // async mode
        var copy = this;
        var proc = function() {
            if ( ! copy.http ) {
              return;
            }
            var data = copy.parseResponse();
            copy.callback_func( data, copy.callback_arg );  // call back
        };
        this.http.async( proc );
    }

    this.http.load();

    if ( ! this.callback_func ) {                           // sync mode
        var data = this.parseResponse();
        return data;
    }
};

// ================================================================
//  every child/children into array
JKL.ParseXML.prototype.setOutputArrayAll = function () {
    this.setOutputArray( true );
};
//  a child into scalar, children into array
JKL.ParseXML.prototype.setOutputArrayAuto = function () {
    this.setOutputArray( null );
};
//  every child/children into scalar (first sibiling only)
JKL.ParseXML.prototype.setOutputArrayNever = function () {
    this.setOutputArray( false );
};
//  specified child/children into array, other child/children into scalar
JKL.ParseXML.prototype.setOutputArrayElements = function ( list ) {
    this.setOutputArray( list );
};
//  specify how to treate child/children into scalar/array
JKL.ParseXML.prototype.setOutputArray = function ( mode ) {
    if ( typeof(mode) == "string" ) {
        mode = [ mode ];                // string into array
    }
    if ( mode && typeof(mode) == "object" ) {
        if ( mode.length < 0 ) {
            mode = false;               // false when array == []
        } else {
            var hash = {};
            for( var i=0; i<mode.length; i++ ) {
                hash[mode[i]] = true;
            }
            mode = hash;                // array into hashed array
            if ( mode["*"] ) {
                mode = true;            // true when includes "*"
            }
        }
    }
    this.usearray = mode;
};

// ================================================================
//  method: parseResponse()

JKL.ParseXML.prototype.parseResponse = function () {
    var root = this.http.documentElement();
    var data = this.parseDocument( root );
    return data;
};

// ================================================================
//  convert from DOM root node to JavaScript Object
//  method: parseElement( rootElement )

JKL.ParseXML.prototype.parseDocument = function ( root ) {
    // debug.print( "parseDocument: "+root );
    if ( ! root ) {
      return;
    }

    var ret = this.parseElement( root );            // parse root node
    // debug.print( "parsed: "+ret );

    if ( this.usearray == true ) {                  // always into array
        ret = [ ret ];
    } else if ( this.usearray == false ) {          // always into scalar
        //
    } else if ( this.usearray == null ) {           // automatic
        //
    } else if ( this.usearray[root.nodeName] ) {    // specified tag
        ret = [ ret ];
    }

    var json = {};
    json[root.nodeName] = ret;                      // root nodeName
    return json;
};

// ================================================================
//  convert from DOM Element to JavaScript Object
//  method: parseElement( element )

JKL.ParseXML.prototype.parseElement = function ( elem ) {
    // debug.print( "nodeType: "+JKL.ParseXML.MAP_NODETYPE[elem.nodeType]+" <"+elem.nodeName+">" );

    //  COMMENT_NODE

    if ( elem.nodeType == 7 ) {
        return;
    }

    //  TEXT_NODE CDATA_SECTION_NODE

    if ( elem.nodeType == 3 || elem.nodeType == 4 ) {
        // var bool = elem.nodeValue.match( /[^\u0000-\u0020]/ );
        var bool = elem.nodeValue.match( /[^\x00-\x20]/ ); // for Safari
        if ( bool == null ) {
          return;     // ignore white spaces
        }
        // debug.print( "TEXT_NODE: "+elem.nodeValue.length+ " "+bool );
        return elem.nodeValue;
    }

    var retval;
    var cnt = {};

    //  parse attributes

    if ( elem.attributes && elem.attributes.length ) {
        retval = {};
        for ( var i=0; i<elem.attributes.length; i++ ) {
            var key = elem.attributes[i].nodeName;
            if ( typeof(key) != "string" ) {
              continue;
            }
            var val = elem.attributes[i].nodeValue;
            if ( ! val ) {
              continue;
            }
            if ( typeof(cnt[key]) == "undefined" ){cnt[key] = 0;}
            cnt[key] ++;
            this.addNode( retval, key, cnt[key], val );
        }
    }

    //  parse child nodes (recursive)

    if ( elem.childNodes && elem.childNodes.length ) {
        var textonly = true;
        if ( retval ){textonly = false;        // some attributes exists
}
        for ( var i=0; i<elem.childNodes.length && textonly; i++ ) {
            var ntype = elem.childNodes[i].nodeType;
            if ( ntype == 3 || ntype == 4 ) {
              continue;
            }
            textonly = false;
        }
        if ( textonly ) {
            if ( ! retval ){retval = "";}
            for ( var i=0; i<elem.childNodes.length; i++ ) {
                retval += elem.childNodes[i].nodeValue;
            }
        } else {
            if ( ! retval ){retval = {};}
            for ( var i=0; i<elem.childNodes.length; i++ ) {
                var key = elem.childNodes[i].nodeName;
                if ( typeof(key) != "string" ) {
                  continue;
                }
                var val = this.parseElement( elem.childNodes[i] );
                if ( ! val ) {
                  continue;
                }
                if ( typeof(cnt[key]) == "undefined" ){cnt[key] = 0;}
                cnt[key] ++;
                this.addNode( retval, key, cnt[key], val );
            }
        }
    }
    return retval;
};

// ================================================================
//  method: addNode( hash, key, count, value )

JKL.ParseXML.prototype.addNode = function ( hash, key, cnts, val ) {
    if ( this.usearray == true ) {              // into array
        if ( cnts == 1 ){hash[key] = [];}
        hash[key][hash[key].length] = val;      // push
    } else if ( this.usearray == false ) {      // into scalar
        if ( cnts == 1 ){hash[key] = val;       // only 1st sibling
}
    } else if ( this.usearray == null ) {
        if ( cnts == 1 ) {                      // 1st sibling
            hash[key] = val;
        } else if ( cnts == 2 ) {               // 2nd sibling
            hash[key] = [ hash[key], val ];
        } else {                                // 3rd sibling and more
            hash[key][hash[key].length] = val;
        }
    } else if ( this.usearray[key] ) {
        if ( cnts == 1 ){hash[key] = [];}
        hash[key][hash[key].length] = val;      // push
    } else {
        if ( cnts == 1 ){hash[key] = val;       // only 1st sibling
}
    }
};

// ================================================================
//  class: JKL.ParseXML.Text

JKL.ParseXML.Text = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.Text( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.Text.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.Text.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.Text.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.Text.prototype.parseResponse = function () {
    var data = this.http.responseText();
    return data;
};

// ================================================================
//  class: JKL.ParseXML.JSON

JKL.ParseXML.JSON = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.JSON( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.JSON.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.JSON.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.JSON.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.JSON.prototype.parseResponse = function () {
    var text = this.http.responseText();
    // http://www.antimon2.atnifty.com/2007/01/jklparsexmljson.html
    if ( typeof(text) == 'undefined' ) {
      return;
    }
    if ( ! text.length ) {
      return;
    }
    var data = eval( "("+text+")" );
    return data;
};

// ================================================================
//  class: JKL.ParseXML.DOM

JKL.ParseXML.DOM = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.DOM( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, false );
    return this;
};

JKL.ParseXML.DOM.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.DOM.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.DOM.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.DOM.prototype.parseResponse = function () {
    var data = this.http.documentElement();
    return data;
};

// ================================================================
//  class: JKL.ParseXML.CSV

JKL.ParseXML.CSV = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.CSV( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.CSV.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.CSV.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.CSV.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.CSV.prototype.parseResponse = function () {
    var text = this.http.responseText();
    var data = this.parseCSV( text );
    return data;
};

JKL.ParseXML.CSV.prototype.parseCSV = function ( text ) {
    text = text.replace( /\r\n?/g, "\n" );              // new line character
    var pos = 0;
    var len = text.length;
    var table = [];
    while( pos<len ) {
        var line = [];
        while( pos<len ) {
            if ( text.charAt(pos) == '"' ) {            // "..." quoted column
                var nextquote = text.indexOf( '"', pos+1 );
                while ( nextquote<len && nextquote > -1 ) {
                    if ( text.charAt(nextquote+1) != '"' ) {
                        break;                          // end of column
                    }
                    nextquote = text.indexOf( '"', nextquote+2 );
                }
                if ( nextquote < 0 ) {
                    // unclosed quote
                } else if ( text.charAt(nextquote+1) == "," ) { // end of column
                    var quoted = text.substr( pos+1, nextquote-pos-1 );
                    quoted = quoted.replace(/""/g,'"');
                    line[line.length] = quoted;
                    pos = nextquote+2;
                    continue;
                } else if ( text.charAt(nextquote+1) == "\n" || // end of line
                            len==nextquote+1 ) {                // end of file
                    var quoted = text.substr( pos+1, nextquote-pos-1 );
                    quoted = quoted.replace(/""/g,'"');
                    line[line.length] = quoted;
                    pos = nextquote+2;
                    break;
                } else {
                    // invalid column
                }
            }
            var nextcomma = text.indexOf( ",", pos );
            var nextnline = text.indexOf( "\n", pos );
            if ( nextnline < 0 ){nextnline = len;}
            if ( nextcomma > -1 && nextcomma < nextnline ) {
                line[line.length] = text.substr( pos, nextcomma-pos );
                pos = nextcomma+1;
            } else {                                    // end of line
                line[line.length] = text.substr( pos, nextnline-pos );
                pos = nextnline+1;
                break;
            }
        }
        if ( line.length >= 0 ) {
            table[table.length] = line;                 // push line
        }
    }
    if ( table.length < 0 ) {
      return;                     // null data
    }
    return table;
};

// ================================================================
//  class: JKL.ParseXML.CSVmap

JKL.ParseXML.CSVmap = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.CSVmap( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.CSVmap.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.CSVmap.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.CSVmap.prototype.onerror = JKL.ParseXML.prototype.onerror;
JKL.ParseXML.CSVmap.prototype.parseCSV = JKL.ParseXML.CSV.prototype.parseCSV;

JKL.ParseXML.CSVmap.prototype.parseResponse = function () {
    var text = this.http.responseText();
    var source = this.parseCSV( text );
    if ( ! source ) {
      return;
    }
    if ( source.length < 0 ) {
      return;
    }

    var title = source.shift();                 // first line as title
    var data = [];
    for( var i=0; i<source.length; i++ ) {
        var hash = {};
        for( var j=0; j<title.length && j<source[i].length; j++ ) {
            hash[title[j]] = source[i][j];      // array to map
        }
        data[data.length] = hash;               // push line
    }
    return data;
};

// ================================================================
//  class: JKL.ParseXML.LoadVars

JKL.ParseXML.LoadVars = function ( url, query, method ) {
    // debug.print( "new JKL.ParseXML.LoadVars( '"+url+"', '"+query+"', '"+method+"' );" );
    this.http = new JKL.ParseXML.HTTP( url, query, method, true );
    return this;
};

JKL.ParseXML.LoadVars.prototype.parse = JKL.ParseXML.prototype.parse;
JKL.ParseXML.LoadVars.prototype.async = JKL.ParseXML.prototype.async;
JKL.ParseXML.LoadVars.prototype.onerror = JKL.ParseXML.prototype.onerror;

JKL.ParseXML.LoadVars.prototype.parseResponse = function () {
    var text = this.http.responseText();
    text = text.replace( /\r\n?/g, "\n" );              // new line character
    var hash = {};
    var list = text.split( "&" );
    for( var i=0; i<list.length; i++ ) {
        var eq = list[i].indexOf( "=" );
        if ( eq > -1 ) {
            var key = decodeURIComponent(list[i].substr(0,eq).replace("+","%20"));
            var val = decodeURIComponent(list[i].substr(eq+1).replace("+","%20"));
            hash[key] = val;
        } else {
            hash[list[i]] = "";
        }
    }
    return hash;
};

// ================================================================
//  class: JKL.ParseXML.HTTP
//  constructer: new JKL.ParseXML.HTTP()

JKL.ParseXML.HTTP = function( url, query, method, textmode ) {
    // debug.print( "new JKL.ParseXML.HTTP( '"+url+"', '"+query+"', '"+method+"', '"+textmode+"' );" );
    this.url = url;
    if ( typeof(query) == "string" ) {
        this.query = query;
    } else {
        this.query = "";
    }
    if ( method ) {
        this.method = method;
    } else if ( typeof(query) == "string" ) {
        this.method = "POST";
    } else {
        this.method = "GET";
    }
    this.textmode = textmode ? true : false;
    this.req = null;
    this.xmldom_flag = false;
    this.onerror_func  = null;
    this.callback_func = null;
    this.already_done = null;
    return this;
};

// ================================================================
//  class variables

JKL.ParseXML.HTTP.REQUEST_TYPE  = "application/x-www-form-urlencoded";
JKL.ParseXML.HTTP.ACTIVEX_XMLDOM  = "Microsoft.XMLDOM";  // Msxml2.DOMDocument.5.0
JKL.ParseXML.HTTP.ACTIVEX_XMLHTTP = "Microsoft.XMLHTTP"; // Msxml2.XMLHTTP.3.0
JKL.ParseXML.HTTP.EPOCH_TIMESTAMP = "Thu, 01 Jun 1970 00:00:00 GMT";

// ================================================================

JKL.ParseXML.HTTP.prototype.onerror = JKL.ParseXML.prototype.onerror;
JKL.ParseXML.HTTP.prototype.async = function( func ) {
    this.async_func = func;
};

// ================================================================
//  [IE+IXMLDOMElement]
//      XML     text/xml            OK
//      XML     application/rdf+xml OK
//      TEXT    text/plain          NG
//      TEXT    others              NG
//  [IE+IXMLHttpRequest]
//      XML     text/xml            OK
//      XML     application/rdf+xml NG
//      TEXT    text/plain          OK
//      TEXT    others              OK
//  [Firefox+XMLHttpRequest]
//      XML     text/xml            OK
//      XML     application/rdf+xml OK (overrideMimeType)
//      TEXT    text/plain          OK
//      TEXT    others              OK (overrideMimeType)
//  [Opera+XMLHttpRequest]
//      XML     text/xml            OK
//      XML     application/rdf+xml OK
//      TEXT    text/plain          OK
//      TEXT    others              OK
// ================================================================

JKL.ParseXML.HTTP.prototype.load = function() {
    // create XMLHttpRequest object
    if ( window.ActiveXObject ) {                           // IE5.5,6,7
        var activex = JKL.ParseXML.HTTP.ACTIVEX_XMLHTTP;    // IXMLHttpRequest
        if ( this.method == "GET" && ! this.textmode ) {
            // use IXMLDOMElement to accept any mime types
            // because overrideMimeType() is not available on IE6
            activex = JKL.ParseXML.HTTP.ACTIVEX_XMLDOM;     // IXMLDOMElement
        }
        // debug.print( "new ActiveXObject( '"+activex+"' )" );
        this.req = new ActiveXObject( activex );
    } else if ( window.XMLHttpRequest ) {                   // Firefox, Opera, iCab
        // debug.print( "new XMLHttpRequest()" );
        this.req = new XMLHttpRequest();
    }

    // async mode when call back function is specified
    var async_flag = this.async_func ? true : false;
    // debug.print( "async: "+ async_flag );

    // open for XMLHTTPRequest (not for IXMLDOMElement)
    if ( typeof(this.req.send) != "undefined" ) {
        // debug.print( "open( '"+this.method+"', '"+this.url+"', "+async_flag+" );" );
        this.req.open( this.method, this.url, async_flag );
    }

//  // If-Modified-Since: Thu, 01 Jun 1970 00:00:00 GMT
//  if ( typeof(this.req.setRequestHeader) != "undefined" ) {
//      // debug.print( "If-Modified-Since"+JKL.ParseXML.HTTP.EPOCH_TIMESTAMP );
//      this.req.setRequestHeader( "If-Modified-Since", JKL.ParseXML.HTTP.EPOCH_TIMESTAMP );
//  }

    // Content-Type: application/x-www-form-urlencoded (request header)
    // Some server does not accept without request content-type.
    if ( typeof(this.req.setRequestHeader) != "undefined" ) {
        // debug.print( "Content-Type: "+JKL.ParseXML.HTTP.REQUEST_TYPE+" (request)" );
        this.req.setRequestHeader( "Content-Type", JKL.ParseXML.HTTP.REQUEST_TYPE );
    }

    // Content-Type: text/xml (response header)
    // FireFox does not accept other mime types like application/rdf+xml etc.
    if ( typeof(this.req.overrideMimeType) != "undefined" && ! this.textmode ) {
        // debug.print( "Content-Type: "+JKL.ParseXML.MIME_TYPE_XML+" (response)" );
        this.req.overrideMimeType( JKL.ParseXML.MIME_TYPE_XML );
    }

    // set call back handler when async mode
    if ( async_flag ) {
        var copy = this;
        copy.already_done = false;                  // not parsed yet
        var check_func = function () {
            if ( copy.req.readyState != 4 ) {
              return;
            }
            // debug.print( "readyState(async): "+copy.req.readyState );
            var succeed = copy.checkResponse();
            // debug.print( "checkResponse(async): "+succeed );
            if ( ! succeed ) {
              return;                // failed
            }
            if ( copy.already_done ) {
              return;        // parse only once
            }
            copy.already_done = true;               // already parsed
            copy.async_func();                      // call back async
        };
        this.req.onreadystatechange = check_func;
        // for document.implementation.createDocument
        // this.req.onload = check_func;
    }

    // send the request and query string
    if ( typeof(this.req.send) != "undefined" ) {
        // debug.print( "XMLHTTPRequest: send( '"+this.query+"' );" );
        this.req.send( this.query );                        // XMLHTTPRequest
    } else if ( typeof(this.req.load) != "undefined" ) {
        // debug.print( "IXMLDOMElement: load( '"+this.url+"' );" );
        this.req.async = async_flag;
        this.req.load( this.url );                          // IXMLDOMElement
    }

    // just return when async mode
    if ( async_flag ) {
      return;
    }

    var succeed = this.checkResponse();
    // debug.print( "checkResponse(sync): "+succeed );
};

// ================================================================
//  method: checkResponse()

JKL.ParseXML.HTTP.prototype.checkResponse = function() {
    // parseError on IXMLDOMElement
    if ( this.req.parseError && this.req.parseError.errorCode != 0 ) {
        // debug.print( "parseError: "+this.req.parseError.reason );
        if ( this.onerror_func ){this.onerror_func( this.req.parseError.reason );}
        return false;                       // failed
    }

    // HTTP response code
    if ( this.req.status-0 > 0 &&
         this.req.status != 200 &&          // OK
         this.req.status != 206 &&          // Partial Content
         this.req.status != 304 ) {         // Not Modified
        // debug.print( "status: "+this.req.status );
        if ( this.onerror_func ){this.onerror_func( this.req.status );}
        return false;                       // failed
    }

    return true;                            // succeed
};

// ================================================================
//  method: documentElement()
//  return: XML DOM in response body

JKL.ParseXML.HTTP.prototype.documentElement = function() {
    // debug.print( "documentElement: "+this.req );
    if ( ! this.req ) {
      return;
    }
    if ( this.req.responseXML ) {
        return this.req.responseXML.documentElement;    // XMLHTTPRequest
    } else {
        return this.req.documentElement;                // IXMLDOMDocument
    }
};

// ================================================================
//  method: responseText()
//  return: text string in response body

JKL.ParseXML.HTTP.prototype.responseText = function() {
    // debug.print( "responseText: "+this.req );
    if ( ! this.req ) {
      return;
    }

    //  Safari and Konqueror cannot understand the encoding of text files.
    if ( navigator.appVersion.match( "KHTML" ) ) {
        var esc = escape( this.req.responseText );
//        debug.print( "escape: "+esc );
        if ( ! esc.match("%u") && esc.match("%") ) {
            return decodeURIComponent(esc);
        }
    }

    return this.req.responseText;
};

// ================================================================
//  http://msdn.microsoft.com/library/en-us/xmlsdk/html/d051f7c5-e882-42e8-a5b6-d1ce67af275c.asp
// ================================================================

dojo.provide("nielsenTracking");

nielsenTracking = {
      init: function() {
//  if(dj.util.Region.getViewByRegion() === "na,us") {
            var d = new Image(1, 1);
            d.onerror = d.onload = function () {
              d.onerror = d.onload = null;
            };
            d.src = ["//secure-us.imrworldwide.com/cgi-bin/m?ci=us-403743h&cg=0&cc=1&si=", escape(window.location.href), "&rp=", escape(document.referrer), "&ts=compact&rnd=", (new Date()).getTime()].join('');
//        }
      }

};
dojo.provide("swfobject.swfobject_1_5.swfobject");
/**
 * SWFObject v1.5: Flash Player detection and embed - http://blog.deconcept.com/swfobject/
 *
 * SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */
if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;
/*  SWFObject v2.2 <http://code.google.com/p/swfobject/>
  is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
dojo.provide("swfobject.swfobject_2_2.swfobject");

swfobject = function() {
	
	var UNDEF = "undefined",
		OBJECT = "object",
		SHOCKWAVE_FLASH = "Shockwave Flash",
		SHOCKWAVE_FLASH_AX = "ShockwaveFlash.ShockwaveFlash",
		FLASH_MIME_TYPE = "application/x-shockwave-flash",
		EXPRESS_INSTALL_ID = "SWFObjectExprInst",
		ON_READY_STATE_CHANGE = "onreadystatechange",
		
		win = window,
		doc = document,
		nav = navigator,
		
		plugin = false,
		domLoadFnArr = [main],
		regObjArr = [],
		objIdArr = [],
		listenersArr = [],
		storedAltContent,
		storedAltContentId,
		storedCallbackFn,
		storedCallbackObj,
    isInitDelayed = true,
		isDomLoaded = isInitDelayed,
		isExpressInstallActive = false,
		dynamicStylesheet,
		dynamicStylesheetMedia,
		autoHideShow = true,
	
	/* Centralized function for browser feature detection
		- User agent string detection is only used when no good alternative is possible
		- Is executed directly for optimal performance
	*/	
	ua = function() {
		var w3cdom = typeof doc.getElementById != UNDEF && typeof doc.getElementsByTagName != UNDEF && typeof doc.createElement != UNDEF,
			u = nav.userAgent.toLowerCase(),
			p = nav.platform.toLowerCase(),
			windows = p ? /win/.test(p) : /win/.test(u),
			mac = p ? /mac/.test(p) : /mac/.test(u),
			webkit = /webkit/.test(u) ? parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, "$1")) : false, // returns either the webkit version or false if not webkit
			ie = !+"\v1", // feature detection based on Andrea Giammarchi's solution: http://webreflection.blogspot.com/2009/01/32-bytes-to-know-if-your-browser-is-ie.html
			playerVersion = [0,0,0],
			d = null;
		if (typeof nav.plugins != UNDEF && typeof nav.plugins[SHOCKWAVE_FLASH] == OBJECT) {
			d = nav.plugins[SHOCKWAVE_FLASH].description;
			if (d && !(typeof nav.mimeTypes != UNDEF && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) { // navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin indicates whether plug-ins are enabled or disabled in Safari 3+
				plugin = true;
				ie = false; // cascaded feature detection for Internet Explorer
				d = d.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
				playerVersion[0] = parseInt(d.replace(/^(.*)\..*$/, "$1"), 10);
				playerVersion[1] = parseInt(d.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
				playerVersion[2] = /[a-zA-Z]/.test(d) ? parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
			}
		}
		else if (typeof win.ActiveXObject != UNDEF) {
			try {
				var a = new ActiveXObject(SHOCKWAVE_FLASH_AX);
				if (a) { // a will return null when ActiveX is disabled
					d = a.GetVariable("$version");
					if (d) {
						ie = true; // cascaded feature detection for Internet Explorer
						d = d.split(" ")[1].split(",");
						playerVersion = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
					}
				}
			}
			catch(e) {}
		}
		return { w3:w3cdom, pv:playerVersion, wk:webkit, ie:ie, win:windows, mac:mac };
	}(),
	
	/* Cross-browser onDomLoad
		- Will fire an event as soon as the DOM of a web page is loaded
		- Internet Explorer workaround based on Diego Perini's solution: http://javascript.nwbox.com/IEContentLoaded/
		- Regular onload serves as fallback
	*/ 
	onDomLoad = function() {
		if (!ua.w3) { return; }
		if ((typeof doc.readyState != UNDEF && doc.readyState == "complete") || (typeof doc.readyState == UNDEF && (doc.getElementsByTagName("body")[0] || doc.body))) { // function is fired after onload, e.g. when script is inserted dynamically 
			callDomLoadFunctions();
		}
		if (!isDomLoaded) {
			if (typeof doc.addEventListener != UNDEF) {
				doc.addEventListener("DOMContentLoaded", callDomLoadFunctions, false);
			}		
			if (ua.ie && ua.win) {
				doc.attachEvent(ON_READY_STATE_CHANGE, function() {
					if (doc.readyState == "complete") {
						doc.detachEvent(ON_READY_STATE_CHANGE, arguments.callee);
						callDomLoadFunctions();
					}
				});
				if (win == top) { // if not inside an iframe
					(function(){
						if (isDomLoaded) { return; }
						try {
							doc.documentElement.doScroll("left");
						}
						catch(e) {
							setTimeout(arguments.callee, 0);
							return;
						}
						callDomLoadFunctions();
					})();
				}
			}
			if (ua.wk) {
				(function(){
					if (isDomLoaded) { return; }
					if (!/loaded|complete/.test(doc.readyState)) {
						setTimeout(arguments.callee, 0);
						return;
					}
					callDomLoadFunctions();
				})();
			}
			addLoadEvent(callDomLoadFunctions);
		}
	}();
	
	function callDomLoadFunctions() {
		if (isDomLoaded) { return; }
		try { // test if we can really add/remove elements to/from the DOM; we don't want to fire it too early
			var t = doc.getElementsByTagName("body")[0].appendChild(createElement("span"));
			t.parentNode.removeChild(t);
		}
		catch (e) { return; }
		isDomLoaded = true;
		var dl = domLoadFnArr.length;
		for (var i = 0; i < dl; i++) {
			domLoadFnArr[i]();
		}
	}
	
	function addDomLoadEvent(fn) {
		if (isDomLoaded) {
			fn();
		}
		else { 
			domLoadFnArr[domLoadFnArr.length] = fn; // Array.push() is only available in IE5.5+
		}
	}
	
	/* Cross-browser onload
		- Based on James Edwards' solution: http://brothercake.com/site/resources/scripts/onload/
		- Will fire an event as soon as a web page including all of its assets are loaded 
	 */
	function addLoadEvent(fn) {
		if (typeof win.addEventListener != UNDEF) {
			win.addEventListener("load", fn, false);
		}
		else if (typeof doc.addEventListener != UNDEF) {
			doc.addEventListener("load", fn, false);
		}
		else if (typeof win.attachEvent != UNDEF) {
			addListener(win, "onload", fn);
		}
		else if (typeof win.onload == "function") {
			var fnOld = win.onload;
			win.onload = function() {
				fnOld();
				fn();
			};
		}
		else {
			win.onload = fn;
		}
	}
	
	/* Main function
		- Will preferably execute onDomLoad, otherwise onload (as a fallback)
	*/
	function main() { 
		if (plugin) {
			testPlayerVersion();
		}
		else {
			matchVersions();
		}
	}
	
	/* Detect the Flash Player version for non-Internet Explorer browsers
		- Detecting the plug-in version via the object element is more precise than using the plugins collection item's description:
		  a. Both release and build numbers can be detected
		  b. Avoid wrong descriptions by corrupt installers provided by Adobe
		  c. Avoid wrong descriptions by multiple Flash Player entries in the plugin Array, caused by incorrect browser imports
		- Disadvantage of this method is that it depends on the availability of the DOM, while the plugins collection is immediately available
	*/
	function testPlayerVersion() {
		var b = doc.getElementsByTagName("body")[0];
		var o = createElement(OBJECT);
		o.setAttribute("type", FLASH_MIME_TYPE);
		var t = b.appendChild(o);
		if (t) {
			var counter = 0;
			(function(){
				if (typeof t.GetVariable != UNDEF) {
					var d = t.GetVariable("$version");
					if (d) {
						d = d.split(" ")[1].split(",");
						ua.pv = [parseInt(d[0], 10), parseInt(d[1], 10), parseInt(d[2], 10)];
					}
				}
				else if (counter < 10) {
					counter++;
					setTimeout(arguments.callee, 10);
					return;
				}
				b.removeChild(o);
				t = null;
				matchVersions();
			})();
		}
		else {
			matchVersions();
		}
	}
	
	/* Perform Flash Player and SWF version matching; static publishing only
	*/
	function matchVersions() {
		var rl = regObjArr.length;
		if (rl > 0) {
			for (var i = 0; i < rl; i++) { // for each registered object element
				var id = regObjArr[i].id;
				var cb = regObjArr[i].callbackFn;
				var cbObj = {success:false, id:id};
				if (ua.pv[0] > 0) {
					var obj = getElementById(id);
					if (obj) {
						if (hasPlayerVersion(regObjArr[i].swfVersion) && !(ua.wk && ua.wk < 312)) { // Flash Player version >= published SWF version: Houston, we have a match!
							setVisibility(id, true);
							if (cb) {
								cbObj.success = true;
								cbObj.ref = getObjectById(id);
								cb(cbObj);
							}
						}
						else if (regObjArr[i].expressInstall && canExpressInstall()) { // show the Adobe Express Install dialog if set by the web page author and if supported
							var att = {};
							att.data = regObjArr[i].expressInstall;
							att.width = obj.getAttribute("width") || "0";
							att.height = obj.getAttribute("height") || "0";
							if (obj.getAttribute("class")) { att.styleclass = obj.getAttribute("class"); }
							if (obj.getAttribute("align")) { att.align = obj.getAttribute("align"); }
							// parse HTML object param element's name-value pairs
							var par = {};
							var p = obj.getElementsByTagName("param");
							var pl = p.length;
							for (var j = 0; j < pl; j++) {
								if (p[j].getAttribute("name").toLowerCase() != "movie") {
									par[p[j].getAttribute("name")] = p[j].getAttribute("value");
								}
							}
							showExpressInstall(att, par, id, cb);
						}
						else { // Flash Player and SWF version mismatch or an older Webkit engine that ignores the HTML object element's nested param elements: display alternative content instead of SWF
							displayAltContent(obj);
							if (cb) { cb(cbObj); }
						}
					}
				}
				else {	// if no Flash Player is installed or the fp version cannot be detected we let the HTML object element do its job (either show a SWF or alternative content)
					setVisibility(id, true);
					if (cb) {
						var o = getObjectById(id); // test whether there is an HTML object element or not
						if (o && typeof o.SetVariable != UNDEF) { 
							cbObj.success = true;
							cbObj.ref = o;
						}
						cb(cbObj);
					}
				}
			}
		}
	}
	
	function getObjectById(objectIdStr) {
		var r = null;
		var o = getElementById(objectIdStr);
		if (o && o.nodeName == "OBJECT") {
			if (typeof o.SetVariable != UNDEF) {
				r = o;
			}
			else {
				var n = o.getElementsByTagName(OBJECT)[0];
				if (n) {
					r = n;
				}
			}
		}
		return r;
	}
	
	/* Requirements for Adobe Express Install
		- only one instance can be active at a time
		- fp 6.0.65 or higher
		- Win/Mac OS only
		- no Webkit engines older than version 312
	*/
	function canExpressInstall() {
		return !isExpressInstallActive && hasPlayerVersion("6.0.65") && (ua.win || ua.mac) && !(ua.wk && ua.wk < 312);
	}
	
	/* Show the Adobe Express Install dialog
		- Reference: http://www.adobe.com/cfusion/knowledgebase/index.cfm?id=6a253b75
	*/
	function showExpressInstall(att, par, replaceElemIdStr, callbackFn) {
		isExpressInstallActive = true;
		storedCallbackFn = callbackFn || null;
		storedCallbackObj = {success:false, id:replaceElemIdStr};
		var obj = getElementById(replaceElemIdStr);
		if (obj) {
			if (obj.nodeName == "OBJECT") { // static publishing
				storedAltContent = abstractAltContent(obj);
				storedAltContentId = null;
			}
			else { // dynamic publishing
				storedAltContent = obj;
				storedAltContentId = replaceElemIdStr;
			}
			att.id = EXPRESS_INSTALL_ID;
			if (typeof att.width == UNDEF || (!/%$/.test(att.width) && parseInt(att.width, 10) < 310)) { att.width = "310"; }
			if (typeof att.height == UNDEF || (!/%$/.test(att.height) && parseInt(att.height, 10) < 137)) { att.height = "137"; }
			doc.title = doc.title.slice(0, 47) + " - Flash Player Installation";
			var pt = ua.ie && ua.win ? "ActiveX" : "PlugIn",
				fv = "MMredirectURL=" + win.location.toString().replace(/&/g,"%26") + "&MMplayerType=" + pt + "&MMdoctitle=" + doc.title;
			if (typeof par.flashvars != UNDEF) {
				par.flashvars += "&" + fv;
			}
			else {
				par.flashvars = fv;
			}
			// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,
			// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work
			if (ua.ie && ua.win && obj.readyState != 4) {
				var newObj = createElement("div");
				replaceElemIdStr += "SWFObjectNew";
				newObj.setAttribute("id", replaceElemIdStr);
				obj.parentNode.insertBefore(newObj, obj); // insert placeholder div that will be replaced by the object element that loads expressinstall.swf
				obj.style.display = "none";
				(function(){
					if (obj.readyState == 4) {
						obj.parentNode.removeChild(obj);
					}
					else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			createSWF(att, par, replaceElemIdStr);
		}
	}
	
	/* Functions to abstract and display alternative content
	*/
	function displayAltContent(obj) {
		if (ua.ie && ua.win && obj.readyState != 4) {
			// IE only: when a SWF is loading (AND: not available in cache) wait for the readyState of the object element to become 4 before removing it,
			// because you cannot properly cancel a loading SWF file without breaking browser load references, also obj.onreadystatechange doesn't work
			var el = createElement("div");
			obj.parentNode.insertBefore(el, obj); // insert placeholder div that will be replaced by the alternative content
			el.parentNode.replaceChild(abstractAltContent(obj), el);
			obj.style.display = "none";
			(function(){
				if (obj.readyState == 4) {
					obj.parentNode.removeChild(obj);
				}
				else {
					setTimeout(arguments.callee, 10);
				}
			})();
		}
		else {
			obj.parentNode.replaceChild(abstractAltContent(obj), obj);
		}
	} 

	function abstractAltContent(obj) {
		var ac = createElement("div");
		if (ua.win && ua.ie) {
			ac.innerHTML = obj.innerHTML;
		}
		else {
			var nestedObj = obj.getElementsByTagName(OBJECT)[0];
			if (nestedObj) {
				var c = nestedObj.childNodes;
				if (c) {
					var cl = c.length;
					for (var i = 0; i < cl; i++) {
						if (!(c[i].nodeType == 1 && c[i].nodeName == "PARAM") && !(c[i].nodeType == 8)) {
							ac.appendChild(c[i].cloneNode(true));
						}
					}
				}
			}
		}
		return ac;
	}
	
	/* Cross-browser dynamic SWF creation
	*/
	function createSWF(attObj, parObj, id) {
		var r, el = getElementById(id);
		if (ua.wk && ua.wk < 312) { return r; }
		if (el) {
			if (typeof attObj.id == UNDEF) { // if no 'id' is defined for the object element, it will inherit the 'id' from the alternative content
				attObj.id = id;
			}
			if (ua.ie && ua.win) { // Internet Explorer + the HTML object element + W3C DOM methods do not combine: fall back to outerHTML
				var att = "";
				for (var i in attObj) {
					if (attObj[i] != Object.prototype[i]) { // filter out prototype additions from other potential libraries
						if (i.toLowerCase() == "data") {
							parObj.movie = attObj[i];
						}
						else if (i.toLowerCase() == "styleclass") { // 'class' is an ECMA4 reserved keyword
							att += ' class="' + attObj[i] + '"';
						}
						else if (i.toLowerCase() != "classid") {
							att += ' ' + i + '="' + attObj[i] + '"';
						}
					}
				}
				var par = "";
				for (var j in parObj) {
					if (parObj[j] != Object.prototype[j]) { // filter out prototype additions from other potential libraries
						par += '<param name="' + j + '" value="' + parObj[j] + '" />';
					}
				}
				el.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + att + '>' + par + '</object>';
				objIdArr[objIdArr.length] = attObj.id; // stored to fix object 'leaks' on unload (dynamic publishing only)
				r = getElementById(attObj.id);	
			}
			else { // well-behaving browsers
				var o = createElement(OBJECT);
				o.setAttribute("type", FLASH_MIME_TYPE);
				for (var m in attObj) {
					if (attObj[m] != Object.prototype[m]) { // filter out prototype additions from other potential libraries
						if (m.toLowerCase() == "styleclass") { // 'class' is an ECMA4 reserved keyword
							o.setAttribute("class", attObj[m]);
						}
						else if (m.toLowerCase() != "classid") { // filter out IE specific attribute
							o.setAttribute(m, attObj[m]);
						}
					}
				}
				for (var n in parObj) {
					if (parObj[n] != Object.prototype[n] && n.toLowerCase() != "movie") { // filter out prototype additions from other potential libraries and IE specific param element
						createObjParam(o, n, parObj[n]);
					}
				}
				el.parentNode.replaceChild(o, el);
				r = o;
			}
		}
		return r;
	}
	
	function createObjParam(el, pName, pValue) {
		var p = createElement("param");
		p.setAttribute("name", pName);	
		p.setAttribute("value", pValue);
		el.appendChild(p);
	}
	
	/* Cross-browser SWF removal
		- Especially needed to safely and completely remove a SWF in Internet Explorer
	*/
	function removeSWF(id) {
		var obj = getElementById(id);
		if (obj && obj.nodeName == "OBJECT") {
			if (ua.ie && ua.win) {
				obj.style.display = "none";
				(function(){
					if (obj.readyState == 4) {
						removeObjectInIE(id);
					}
					else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			else {
				obj.parentNode.removeChild(obj);
			}
		}
	}
	
	function removeObjectInIE(id) {
		var obj = getElementById(id);
		if (obj) {
			for (var i in obj) {
				if (typeof obj[i] == "function") {
					obj[i] = null;
				}
			}
			obj.parentNode.removeChild(obj);
		}
	}
	
	/* Functions to optimize JavaScript compression
	*/
	function getElementById(id) {
		var el = null;
		try {
			el = doc.getElementById(id);
		}
		catch (e) {}
		return el;
	}
	
	function createElement(el) {
		return doc.createElement(el);
	}
	
	/* Updated attachEvent function for Internet Explorer
		- Stores attachEvent information in an Array, so on unload the detachEvent functions can be called to avoid memory leaks
	*/	
	function addListener(target, eventType, fn) {
		target.attachEvent(eventType, fn);
		listenersArr[listenersArr.length] = [target, eventType, fn];
	}
	
	/* Flash Player and SWF content version matching
	*/
	function hasPlayerVersion(rv) {
		var pv = ua.pv, v = rv.split(".");
		v[0] = parseInt(v[0], 10);
		v[1] = parseInt(v[1], 10) || 0; // supports short notation, e.g. "9" instead of "9.0.0"
		v[2] = parseInt(v[2], 10) || 0;
		return (pv[0] > v[0] || (pv[0] == v[0] && pv[1] > v[1]) || (pv[0] == v[0] && pv[1] == v[1] && pv[2] >= v[2])) ? true : false;
	}
	
	/* Cross-browser dynamic CSS creation
		- Based on Bobby van der Sluis' solution: http://www.bobbyvandersluis.com/articles/dynamicCSS.php
	*/	
	function createCSS(sel, decl, media, newStyle) {
		if (ua.ie && ua.mac) { return; }
		var h = doc.getElementsByTagName("head")[0];
		if (!h) { return; } // to also support badly authored HTML pages that lack a head element
		var m = (media && typeof media == "string") ? media : "screen";
		if (newStyle) {
			dynamicStylesheet = null;
			dynamicStylesheetMedia = null;
		}
		if (!dynamicStylesheet || dynamicStylesheetMedia != m) { 
			// create dynamic stylesheet + get a global reference to it
			var s = createElement("style");
			s.setAttribute("type", "text/css");
			s.setAttribute("media", m);
			dynamicStylesheet = h.appendChild(s);
			if (ua.ie && ua.win && typeof doc.styleSheets != UNDEF && doc.styleSheets.length > 0) {
				dynamicStylesheet = doc.styleSheets[doc.styleSheets.length - 1];
			}
			dynamicStylesheetMedia = m;
		}
		// add style rule
		if (ua.ie && ua.win) {
			if (dynamicStylesheet && typeof dynamicStylesheet.addRule == OBJECT) {
				dynamicStylesheet.addRule(sel, decl);
			}
		}
		else {
			if (dynamicStylesheet && typeof doc.createTextNode != UNDEF) {
				dynamicStylesheet.appendChild(doc.createTextNode(sel + " {" + decl + "}"));
			}
		}
	}
	
	function setVisibility(id, isVisible) {
		if (!autoHideShow) { return; }
		var v = isVisible ? "visible" : "hidden";
		if (isDomLoaded && getElementById(id)) {
			getElementById(id).style.visibility = v;
		}
		else {
			createCSS("#" + id, "visibility:" + v);
		}
	}

	/* Filter to avoid XSS attacks
	*/
	function urlEncodeIfNecessary(s) {
		var regex = /[\\\"<>\.;]/;
		var hasBadChars = regex.exec(s) != null;
		return hasBadChars && typeof encodeURIComponent != UNDEF ? encodeURIComponent(s) : s;
	}
	
	/* Release memory to avoid memory leaks caused by closures, fix hanging audio/video threads and force open sockets/NetConnections to disconnect (Internet Explorer only)
	*/
	var cleanup = function() {
		if (ua.ie && ua.win) {
			window.attachEvent("onunload", function() {
				// remove listeners to avoid memory leaks
				var ll = listenersArr.length;
				for (var i = 0; i < ll; i++) {
					listenersArr[i][0].detachEvent(listenersArr[i][1], listenersArr[i][2]);
				}
				// cleanup dynamically embedded objects to fix audio/video threads and force open sockets and NetConnections to disconnect
				var il = objIdArr.length;
				for (var j = 0; j < il; j++) {
					removeSWF(objIdArr[j]);
				}
				// cleanup library's main closures to avoid memory leaks
				for (var k in ua) {
					ua[k] = null;
				}
				ua = null;
				for (var l in swfobject) {
					swfobject[l] = null;
				}
				swfobject = null;
			});
		}
	}();
	
	var publicApi = {
		/* Public API
			- Reference: http://code.google.com/p/swfobject/wiki/documentation
		*/ 
		registerObject: function(objectIdStr, swfVersionStr, xiSwfUrlStr, callbackFn) {
			if (ua.w3 && objectIdStr && swfVersionStr) {
				var regObj = {};
				regObj.id = objectIdStr;
				regObj.swfVersion = swfVersionStr;
				regObj.expressInstall = xiSwfUrlStr;
				regObj.callbackFn = callbackFn;
				regObjArr[regObjArr.length] = regObj;
				setVisibility(objectIdStr, false);
			}
			else if (callbackFn) {
				callbackFn({success:false, id:objectIdStr});
			}
		},
		
		getObjectById: function(objectIdStr) {
			if (ua.w3) {
				return getObjectById(objectIdStr);
			}
		},
		
		embedSWF: function(swfUrlStr, replaceElemIdStr, widthStr, heightStr, swfVersionStr, xiSwfUrlStr, flashvarsObj, parObj, attObj, callbackFn) {
			var callbackObj = {success:false, id:replaceElemIdStr};
			if (ua.w3 && !(ua.wk && ua.wk < 312) && swfUrlStr && replaceElemIdStr && widthStr && heightStr && swfVersionStr) {
				setVisibility(replaceElemIdStr, false);
				addDomLoadEvent(function() {
					widthStr += ""; // auto-convert to string
					heightStr += "";
					var att = {};
					if (attObj && typeof attObj === OBJECT) {
						for (var i in attObj) { // copy object to avoid the use of references, because web authors often reuse attObj for multiple SWFs
							att[i] = attObj[i];
						}
					}
					att.data = swfUrlStr;
					att.width = widthStr;
					att.height = heightStr;
					var par = {}; 
					if (parObj && typeof parObj === OBJECT) {
						for (var j in parObj) { // copy object to avoid the use of references, because web authors often reuse parObj for multiple SWFs
							par[j] = parObj[j];
						}
					}
					if (flashvarsObj && typeof flashvarsObj === OBJECT) {
						for (var k in flashvarsObj) { // copy object to avoid the use of references, because web authors often reuse flashvarsObj for multiple SWFs
							if (typeof par.flashvars != UNDEF) {
								par.flashvars += "&" + k + "=" + flashvarsObj[k];
							}
							else {
								par.flashvars = k + "=" + flashvarsObj[k];
							}
						}
					}
					if (hasPlayerVersion(swfVersionStr)) { // create SWF
						var obj = createSWF(att, par, replaceElemIdStr);
						if (att.id == replaceElemIdStr) {
							setVisibility(replaceElemIdStr, true);
						}
						callbackObj.success = true;
						callbackObj.ref = obj;
					}
					else if (xiSwfUrlStr && canExpressInstall()) { // show Adobe Express Install
						att.data = xiSwfUrlStr;
						showExpressInstall(att, par, replaceElemIdStr, callbackFn);
						return;
					}
					else { // show alternative content
						setVisibility(replaceElemIdStr, true);
					}
					if (callbackFn) { callbackFn(callbackObj); }
				});
			}
			else if (callbackFn) { callbackFn(callbackObj);	}
		},
		
		switchOffAutoHideShow: function() {
			autoHideShow = false;
		},
		
		ua: ua,
		
		getFlashPlayerVersion: function() {
			return { major:ua.pv[0], minor:ua.pv[1], release:ua.pv[2] };
		},
		
		hasFlashPlayerVersion: hasPlayerVersion,
		
		createSWF: function(attObj, parObj, replaceElemIdStr) {
			if (ua.w3) {
				return createSWF(attObj, parObj, replaceElemIdStr);
			}
			else {
				return undefined;
			}
		},
		
		showExpressInstall: function(att, par, replaceElemIdStr, callbackFn) {
			if (ua.w3 && canExpressInstall()) {
				showExpressInstall(att, par, replaceElemIdStr, callbackFn);
			}
		},
		
		removeSWF: function(objElemIdStr) {
			if (ua.w3) {
				removeSWF(objElemIdStr);
			}
		},
		
		createCSS: function(selStr, declStr, mediaStr, newStyleBoolean) {
			if (ua.w3) {
				createCSS(selStr, declStr, mediaStr, newStyleBoolean);
			}
		},
		
		addDomLoadEvent: addDomLoadEvent,
		
		addLoadEvent: addLoadEvent,
		
		getQueryParamValue: function(param) {
			var q = doc.location.search || doc.location.hash;
			if (q) {
				if (/\?/.test(q)) { q = q.split("?")[1]; } // strip question mark
				if (param == null) {
					return urlEncodeIfNecessary(q);
				}
				var pairs = q.split("&");
				for (var i = 0; i < pairs.length; i++) {
					if (pairs[i].substring(0, pairs[i].indexOf("=")) == param) {
						return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=") + 1)));
					}
				}
			}
			return "";
		},
		
		// For internal usage only
		expressInstallCallback: function() {
			if (isExpressInstallActive) {
				var obj = getElementById(EXPRESS_INSTALL_ID);
				if (obj && storedAltContent) {
					obj.parentNode.replaceChild(storedAltContent, obj);
					if (storedAltContentId) {
						setVisibility(storedAltContentId, true);
						if (ua.ie && ua.win) { storedAltContent.style.display = "block"; }
					}
					if (storedCallbackFn) { storedCallbackFn(storedCallbackObj); }
				}
				isExpressInstallActive = false;
			} 
		}
	};

  if (isInitDelayed) {
    var that = this,
        isInitialized = false;
    for (var fn in publicApi) {
      (function(oldFn) {
        if (typeof oldFn === "function") {
          publicApi[fn] = function() {
            if (!isInitialized) { 
              main();
              isInitialized = true;
            }
            return oldFn.apply(that, arguments);
          };
        }
      }(publicApi[fn]));
    }
  }

  return publicApi;
}();

dojo.provide('trimpath.TrimPath');
/**
 * TrimPath Template. Release 1.1.2.
 * Copyright (C) 2004 - 2007 TrimPath.
 *
 * TrimPath Template is licensed under the GNU General Public License
 * and the Apache License, Version 2.0, as follows:
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed WITHOUT ANY WARRANTY; without even the
 * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if (typeof(TrimPath) == 'undefined'){TrimPath = {};}

// TODO: Debugging mode vs stop-on-error mode - runtime flag.
// TODO: Handle || (or) characters and backslashes.
// TODO: Add more modifiers.

(function() {               // Using a closure to keep global namespace clean.
    if (TrimPath.evalEx == null){TrimPath.evalEx = function(src) { return eval(src); };}

    var UNDEFINED;
    if (Array.prototype.pop == null){Array.prototype.pop = function() {
        if (this.length === 0) {return UNDEFINED;}
        return this[--this.length];
    };}
    if (Array.prototype.push == null){Array.prototype.push = function() {
        for (var i = 0; i < arguments.length; ++i) {this[this.length] = arguments[i];}
        return this.length;
    };}

    TrimPath.parseTemplate = function(tmplContent, optTmplName, optEtc) {
        if (optEtc == null){optEtc = TrimPath.parseTemplate_etc;}
        var funcSrc = parse(tmplContent, optTmplName, optEtc);
        var func = TrimPath.evalEx(funcSrc, optTmplName, 1);
        if (func != null) {
          return new optEtc.Template(optTmplName, tmplContent, funcSrc, func, optEtc);
        }
        return null;
    }

    var exceptionDetails = function(e) {
        return (e.toString()) + ";\n " +
               (e.message) + ";\n " +
               (e.name) + ";\n " +
               (e.stack       || 'no stack trace') + ";\n " +
               (e.description || 'no further description') + ";\n " +
               (e.fileName    || 'no file name') + ";\n " +
               (e.lineNumber  || 'no line number');
    }

    try {
        String.prototype.process = function(context, optFlags) {
            var template = TrimPath.parseTemplate(this, null);
            if (template != null) {
              return template.process(context, optFlags);
            }
            return this;
        }
    } catch (e) { // Swallow exception, such as when String.prototype is sealed.
    }

    TrimPath.parseTemplate_etc = {};            // Exposed for extensibility.
    TrimPath.parseTemplate_etc.statementTag = "forelse|for|if|elseif|else|var|macro";
    TrimPath.parseTemplate_etc.statementDef = { // Lookup table for statement tags.
        "if"     : { delta:  1, prefix: "if (", suffix: ") {", paramMin: 1 },
        "else"   : { delta:  0, prefix: "} else {" },
        "elseif" : { delta:  0, prefix: "} else if (", suffix: ") {", paramDefault: "true" },
        "/if"    : { delta: -1, prefix: "}" },
        "for"    : { delta:  1, paramMin: 3,
                     prefixFunc : function(stmtParts, state, tmplName, etc) {
                        if (stmtParts[2] != "in") {
                          throw new etc.ParseError(tmplName, state.line, "bad for loop statement: " + stmtParts.join(' '));
                        }
                        var iterVar = stmtParts[1];
                        var listVar = "__LIST__" + iterVar;
                        return [ "var ", listVar, " = ", stmtParts[3], ";",
                             // Fix from Ross Shaull for hash looping, make sure that we have an array of loop lengths to treat like a stack.
                             "var __LENGTH_STACK__;",
                             "if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();",
                             "__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;", // Push a new for-loop onto the stack of loop lengths.
                             "if ((", listVar, ") != null) { ",
                             "var ", iterVar, "_ct = 0;",       // iterVar_ct variable, added by B. Bittman
                             "for (var ", iterVar, "_index in ", listVar, ") { ",
                             iterVar, "_ct++;",
                             "if (typeof(", listVar, "[", iterVar, "_index]) == 'function') {continue;}", // IE 5.x fix from Igor Poteryaev.
                             "__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;",
                             "var ", iterVar, " = ", listVar, "[", iterVar, "_index];" ].join("");
                     } },
        "forelse" : { delta:  0, prefix: "} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (", suffix: ") {", paramDefault: "true" },
        "/for"    : { delta: -1, prefix: "} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];" }, // Remove the just-finished for-loop from the stack of loop lengths.
        "var"     : { delta:  0, prefix: "var ", suffix: ";" },
        "macro"   : { delta:  1,
                      prefixFunc : function(stmtParts, state, tmplName, etc) {
                          var macroName = stmtParts[1].split('(')[0];
                          return [ "var ", macroName, " = function",
                                   stmtParts.slice(1).join(' ').substring(macroName.length),
                                   "{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; " ].join('');
                     } },
        "/macro"  : { delta: -1, prefix: " return _OUT_arr.join(''); };" }
    }
    TrimPath.parseTemplate_etc.modifierDef = {
        "eat"        : function(v)    { return ""; },
        "escape"     : function(s)    { return String(s).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); },
        "capitalize" : function(s)    { return String(s).toUpperCase(); },
        "default"    : function(s, d) { return s != null ? s : d; }
    }
    TrimPath.parseTemplate_etc.modifierDef.h = TrimPath.parseTemplate_etc.modifierDef.escape;

    TrimPath.parseTemplate_etc.Template = function(tmplName, tmplContent, funcSrc, func, etc) {
        this.process = function(context, flags) {
            if (context == null){context = {};}
            if (context._MODIFIERS == null){context._MODIFIERS = {};}
            if (context.defined == null){context.defined = function(str) { return (context[str] != undefined); };}
            for (var k in etc.modifierDef) {
                if (context._MODIFIERS[k] == null){context._MODIFIERS[k] = etc.modifierDef[k];}
            }
            if (flags == null){flags = {};}
            var resultArr = [];
            var resultOut = { write: function(m) { resultArr.push(m); } };
            try {
                func(resultOut, context, flags);
            } catch (e) {
                if (flags.throwExceptions == true) {
                  throw e;
                }
                var result = new String(resultArr.join("") +
                    "[ERROR: template: <pre>" + exceptionDetails(e) + "</pre>]");
                result["exception"] = e;
                return result;
            }
            return resultArr.join("");
        }
        this.name       = tmplName;
        this.source     = tmplContent;
        this.sourceFunc = funcSrc;
        this.toString   = function() { return "TrimPath.Template [" + tmplName + "]"; }
    }
    TrimPath.parseTemplate_etc.ParseError = function(name, line, message) {
        this.name    = name;
        this.line    = line;
        this.message = message;
    }
    TrimPath.parseTemplate_etc.ParseError.prototype.toString = function() {
        return ("TrimPath template ParseError in " + this.name + ": line " + this.line + ", " + this.message);
    }

    var parse = function(body, tmplName, etc) {
        body = cleanWhiteSpace(body);
        var funcText = [ "var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {" ];
        var state    = { stack: [], line: 1 };                              // TODO: Fix line number counting.
        var endStmtPrev = -1;
        while (endStmtPrev + 1 < body.length) {
            var begStmt = endStmtPrev;
            // Scan until we find some statement markup.
            begStmt = body.indexOf("{", begStmt + 1);
            while (begStmt >= 0) {
                var endStmt = body.indexOf('}', begStmt + 1);
                var stmt = body.substring(begStmt, endStmt);
                var blockrx = stmt.match(/^\{(cdata|minify|eval)/); // From B. Bittman, minify/eval/cdata implementation.
                if (blockrx) {
                    var blockType = blockrx[1];
                    var blockMarkerBeg = begStmt + blockType.length + 1;
                    var blockMarkerEnd = body.indexOf('}', blockMarkerBeg);
                    if (blockMarkerEnd >= 0) {
                        var blockMarker;
                        if( blockMarkerEnd - blockMarkerBeg <= 0 ) {
                            blockMarker = "{/" + blockType + "}";
                        } else {
                            blockMarker = body.substring(blockMarkerBeg + 1, blockMarkerEnd);
                        }

                        var blockEnd = body.indexOf(blockMarker, blockMarkerEnd + 1);
                        if (blockEnd >= 0) {
                            emitSectionText(body.substring(endStmtPrev + 1, begStmt), funcText);

                            var blockText = body.substring(blockMarkerEnd + 1, blockEnd);
                            if (blockType == 'cdata') {
                                emitText(blockText, funcText);
                            } else if (blockType == 'minify') {
                                emitText(scrubWhiteSpace(blockText), funcText);
                            } else if (blockType == 'eval') {
                                if (blockText != null && blockText.length > 0){funcText.push('_OUT.write( (function() { ' + blockText + ' })() );');}
                            }
                            begStmt = endStmtPrev = blockEnd + blockMarker.length - 1;
                        }
                    }
                } else if (body.charAt(begStmt - 1) != '$' &&               // Not an expression or backslashed,
                           body.charAt(begStmt - 1) != '\\') {              // so check if it is a statement tag.
                    var offset = (body.charAt(begStmt + 1) == '/' ? 2 : 1); // Close tags offset of 2 skips '/'.
                                                                            // 10 is larger than maximum statement tag length.
                    if (body.substring(begStmt + offset, begStmt + 10 + offset).search(TrimPath.parseTemplate_etc.statementTag) == 0) {
                      break;                                              // Found a match.
                    }
                }
                begStmt = body.indexOf("{", begStmt + 1);
            }
            if (begStmt < 0) {
              break;
            }
            var endStmt = body.indexOf("}", begStmt + 1); // In "a{for}c", endStmt will be 5.
            if (endStmt < 0) {
              break;
            }
            emitSectionText(body.substring(endStmtPrev + 1, begStmt), funcText);
            emitStatement(body.substring(begStmt, endStmt + 1), state, funcText, tmplName, etc);
            endStmtPrev = endStmt;
        }
        emitSectionText(body.substring(endStmtPrev + 1), funcText);
        if (state.stack.length != 0) {
          throw new etc.ParseError(tmplName, state.line, "unclosed, unmatched statement(s): " + state.stack.join(","));
        }
        funcText.push("}}; TrimPath_Template_TEMP");
        return funcText.join("");
    }

    var emitStatement = function(stmtStr, state, funcText, tmplName, etc) {
        var parts = stmtStr.slice(1, -1).split(' ');
        var stmt = etc.statementDef[parts[0]]; // Here, parts[0] == for/if/else/...
        if (stmt == null) {                    // Not a real statement.
            emitSectionText(stmtStr, funcText);
            return;
        }
        if (stmt.delta < 0) {
            if (state.stack.length <= 0) {
              throw new etc.ParseError(tmplName, state.line, "close tag does not match any previous statement: " + stmtStr);
            }
            state.stack.pop();
        }
        if (stmt.delta > 0){state.stack.push(stmtStr);}

        if (stmt.paramMin != null &&
            stmt.paramMin >= parts.length) {
          throw new etc.ParseError(tmplName, state.line, "statement needs more parameters: " + stmtStr);
        }
        if (stmt.prefixFunc != null){funcText.push(stmt.prefixFunc(parts, state, tmplName, etc));} else {funcText.push(stmt.prefix);}
        if (stmt.suffix != null) {
            if (parts.length <= 1) {
                if (stmt.paramDefault != null){funcText.push(stmt.paramDefault);}
            } else {
                for (var i = 1; i < parts.length; i++) {
                    if (i > 1){funcText.push(' ');}
                    funcText.push(parts[i]);
                }
            }
            funcText.push(stmt.suffix);
        }
    }

    var emitSectionText = function(text, funcText) {
        if (text.length <= 0) {
          return;
        }
        var nlPrefix = 0;               // Index to first non-newline in prefix.
        var nlSuffix = text.length - 1; // Index to first non-space/tab in suffix.
        while (nlPrefix < text.length && (text.charAt(nlPrefix) == '\n')){nlPrefix++;}
        while (nlSuffix >= 0 && (text.charAt(nlSuffix) == ' ' || text.charAt(nlSuffix) == '\t')){nlSuffix--;}
        if (nlSuffix < nlPrefix){nlSuffix = nlPrefix;}
        if (nlPrefix > 0) {
            funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');
            var s = text.substring(0, nlPrefix).replace('\n', '\\n'); // A macro IE fix from BJessen.
            if (s.charAt(s.length - 1) == '\n'){s = s.substring(0, s.length - 1);}
            funcText.push(s);
            funcText.push('");');
        }
        var lines = text.substring(nlPrefix, nlSuffix + 1).split('\n');
        for (var i = 0; i < lines.length; i++) {
            emitSectionTextLine(lines[i], funcText);
            if (i < lines.length - 1){funcText.push('_OUT.write("\\n");\n');}
        }
        if (nlSuffix + 1 < text.length) {
            funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');
            var s = text.substring(nlSuffix + 1).replace('\n', '\\n');
            if (s.charAt(s.length - 1) == '\n'){s = s.substring(0, s.length - 1);}
            funcText.push(s);
            funcText.push('");');
        }
    }

    var emitSectionTextLine = function(line, funcText) {
        var endMarkPrev = '}';
        var endExprPrev = -1;
        while (endExprPrev + endMarkPrev.length < line.length) {
            var begMark = "${", endMark = "}";
            var begExpr = line.indexOf(begMark, endExprPrev + endMarkPrev.length); // In "a${b}c", begExpr == 1
            if (begExpr < 0) {
              break;
            }
            if (line.charAt(begExpr + 2) == '%') {
                begMark = "${%";
                endMark = "%}";
            }
            var endExpr = line.indexOf(endMark, begExpr + begMark.length);         // In "a${b}c", endExpr == 4;
            if (endExpr < 0) {
              break;
            }
            emitText(line.substring(endExprPrev + endMarkPrev.length, begExpr), funcText);
            // Example: exprs == 'firstName|default:"John Doe"|capitalize'.split('|')
            var exprArr = line.substring(begExpr + begMark.length, endExpr).replace(/\|\|/g, "#@@#").split('|');
            for (var k in exprArr) {
                if (exprArr[k].replace){exprArr[k] = exprArr[k].replace(/#@@#/g, '||');}
            }
            funcText.push('_OUT.write(');
            emitExpression(exprArr, exprArr.length - 1, funcText);
            funcText.push(');');
            endExprPrev = endExpr;
            endMarkPrev = endMark;
        }
        emitText(line.substring(endExprPrev + endMarkPrev.length), funcText);
    }

    var emitText = function(text, funcText) {
        if (text == null ||
            text.length <= 0) {
          return;
        }
        text = text.replace(/\\/g, '\\\\');
        text = text.replace(/\n/g, '\\n');
        text = text.replace(/"/g,  '\\"');
        funcText.push('_OUT.write("');
        funcText.push(text);
        funcText.push('");');
    }

    var emitExpression = function(exprArr, index, funcText) {
        // Ex: foo|a:x|b:y1,y2|c:z1,z2 is emitted as c(b(a(foo,x),y1,y2),z1,z2)
        var expr = exprArr[index]; // Ex: exprArr == [firstName,capitalize,default:"John Doe"]
        if (index <= 0) {          // Ex: expr    == 'default:"John Doe"'
            funcText.push(expr);
            return;
        }
        var parts = expr.split(':');
        funcText.push('_MODIFIERS["');
        funcText.push(parts[0]); // The parts[0] is a modifier function name, like capitalize.
        funcText.push('"](');
        emitExpression(exprArr, index - 1, funcText);
        if (parts.length > 1) {
            funcText.push(',');
            funcText.push(parts[1]);
        }
        funcText.push(')');
    }

    var cleanWhiteSpace = function(result) {
        result = result.replace(/\t/g,   "    ");
        result = result.replace(/\r\n/g, "\n");
        result = result.replace(/\r/g,   "\n");
        result = result.replace(/^(\s*\S*(\s+\S+)*)\s*$/, '$1'); // Right trim by Igor Poteryaev.
        return result;
    }

    var scrubWhiteSpace = function(result) {
        result = result.replace(/^\s+/g,   "");
        result = result.replace(/\s+$/g,   "");
        result = result.replace(/\s+/g,   " ");
        result = result.replace(/^(\s*\S*(\s+\S+)*)\s*$/, '$1'); // Right trim by Igor Poteryaev.
        return result;
    }

    // The DOM helper functions depend on DOM/DHTML, so they only work in a browser.
    // However, these are not considered core to the engine.
    //
    TrimPath.parseDOMTemplate = function(elementId, optDocument, optEtc) {
        if (optDocument == null){optDocument = document;}
        var element = optDocument.getElementById(elementId);
        var content = element.value;     // Like textarea.value.
        if (content == null){content = element.innerHTML; // Like textarea.innerHTML.
}
        content = content.replace(/&lt;/g, "<").replace(/&gt;/g, ">");
        return TrimPath.parseTemplate(content, elementId, optEtc);
    }

    TrimPath.processDOMTemplate = function(elementId, context, optFlags, optDocument, optEtc) {
        return TrimPath.parseDOMTemplate(elementId, optDocument, optEtc).process(context, optFlags);
    }
}) ();
dojo.provide("yui.yui-2.5.2");
if(typeof YAHOO=="undefined"||!YAHOO){var YAHOO={};}YAHOO.namespace=function(){var A=arguments,E=null,C,B,D;for(C=0;C<A.length;C=C+1){D=A[C].split(".");E=YAHOO;for(B=(D[0]=="YAHOO")?1:0;B<D.length;B=B+1){E[D[B]]=E[D[B]]||{};E=E[D[B]];}}return E;};YAHOO.log=function(D,A,C){var B=YAHOO.widget.Logger;if(B&&B.log){return B.log(D,A,C);}else{return false;}};YAHOO.register=function(A,E,D){var I=YAHOO.env.modules;if(!I[A]){I[A]={versions:[],builds:[]};}var B=I[A],H=D.version,G=D.build,F=YAHOO.env.listeners;B.name=A;B.version=H;B.build=G;B.versions.push(H);B.builds.push(G);B.mainClass=E;for(var C=0;C<F.length;C=C+1){F[C](B);}if(E){E.VERSION=H;E.BUILD=G;}else{YAHOO.log("mainClass is undefined for module "+A,"warn");}};YAHOO.env=YAHOO.env||{modules:[],listeners:[]};YAHOO.env.getVersion=function(A){return YAHOO.env.modules[A]||null;};YAHOO.env.ua=function(){var C={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0};var B=navigator.userAgent,A;if((/KHTML/).test(B)){C.webkit=1;}A=B.match(/AppleWebKit\/([^\s]*)/);if(A&&A[1]){C.webkit=parseFloat(A[1]);if(/ Mobile\//.test(B)){C.mobile="Apple";}else{A=B.match(/NokiaN[^\/]*/);if(A){C.mobile=A[0];}}A=B.match(/AdobeAIR\/([^\s]*)/);if(A){C.air=A[0];}}if(!C.webkit){A=B.match(/Opera[\s\/]([^\s]*)/);if(A&&A[1]){C.opera=parseFloat(A[1]);A=B.match(/Opera Mini[^;]*/);if(A){C.mobile=A[0];}}else{A=B.match(/MSIE\s([^;]*)/);if(A&&A[1]){C.ie=parseFloat(A[1]);}else{A=B.match(/Gecko\/([^\s]*)/);if(A){C.gecko=1;A=B.match(/rv:([^\s\)]*)/);if(A&&A[1]){C.gecko=parseFloat(A[1]);}}}}}return C;}();(function(){YAHOO.namespace("util","widget","example");if("undefined"!==typeof YAHOO_config){var B=YAHOO_config.listener,A=YAHOO.env.listeners,D=true,C;if(B){for(C=0;C<A.length;C=C+1){if(A[C]==B){D=false;break;}}if(D){A.push(B);}}}})();YAHOO.lang=YAHOO.lang||{};(function(){var A=YAHOO.lang,C=["toString","valueOf"],B={isArray:function(D){if(D){return A.isNumber(D.length)&&A.isFunction(D.splice);}return false;},isBoolean:function(D){return typeof D==="boolean";},isFunction:function(D){return typeof D==="function";},isNull:function(D){return D===null;},isNumber:function(D){return typeof D==="number"&&isFinite(D);},isObject:function(D){return(D&&(typeof D==="object"||A.isFunction(D)))||false;},isString:function(D){return typeof D==="string";},isUndefined:function(D){return typeof D==="undefined";},_IEEnumFix:(YAHOO.env.ua.ie)?function(F,E){for(var D=0;D<C.length;D=D+1){var H=C[D],G=E[H];if(A.isFunction(G)&&G!=Object.prototype[H]){F[H]=G;}}}:function(){},extend:function(H,I,G){if(!I||!H){throw new Error("extend failed, please check that "+"all dependencies are included.");}var E=function(){};E.prototype=I.prototype;H.prototype=new E();H.prototype.constructor=H;H.superclass=I.prototype;if(I.prototype.constructor==Object.prototype.constructor){I.prototype.constructor=I;}if(G){for(var D in G){if(A.hasOwnProperty(G,D)){H.prototype[D]=G[D];}}A._IEEnumFix(H.prototype,G);}},augmentObject:function(H,G){if(!G||!H){throw new Error("Absorb failed, verify dependencies.");}var D=arguments,F,I,E=D[2];if(E&&E!==true){for(F=2;F<D.length;F=F+1){H[D[F]]=G[D[F]];}}else{for(I in G){if(E||!(I in H)){H[I]=G[I];}}A._IEEnumFix(H,G);}},augmentProto:function(G,F){if(!F||!G){throw new Error("Augment failed, verify dependencies.");}var D=[G.prototype,F.prototype];for(var E=2;E<arguments.length;E=E+1){D.push(arguments[E]);}A.augmentObject.apply(this,D);},dump:function(D,I){var F,H,K=[],L="{...}",E="f(){...}",J=", ",G=" => ";if(!A.isObject(D)){return D+"";}else{if(D instanceof Date||("nodeType"in D&&"tagName"in D)){return D;}else{if(A.isFunction(D)){return E;}}}I=(A.isNumber(I))?I:3;if(A.isArray(D)){K.push("[");for(F=0,H=D.length;F<H;F=F+1){if(A.isObject(D[F])){K.push((I>0)?A.dump(D[F],I-1):L);}else{K.push(D[F]);}K.push(J);}if(K.length>1){K.pop();}K.push("]");}else{K.push("{");for(F in D){if(A.hasOwnProperty(D,F)){K.push(F+G);if(A.isObject(D[F])){K.push((I>0)?A.dump(D[F],I-1):L);}else{K.push(D[F]);}K.push(J);}}if(K.length>1){K.pop();}K.push("}");}return K.join("");},substitute:function(S,E,L){var I,H,G,O,P,R,N=[],F,J="dump",M=" ",D="{",Q="}";for(;;){I=S.lastIndexOf(D);if(I<0){break;}H=S.indexOf(Q,I);if(I+1>=H){break;}F=S.substring(I+1,H);O=F;R=null;G=O.indexOf(M);if(G>-1){R=O.substring(G+1);O=O.substring(0,G);}P=E[O];if(L){P=L(O,P,R);}if(A.isObject(P)){if(A.isArray(P)){P=A.dump(P,parseInt(R,10));}else{R=R||"";var K=R.indexOf(J);if(K>-1){R=R.substring(4);}if(P.toString===Object.prototype.toString||K>-1){P=A.dump(P,parseInt(R,10));}else{P=P.toString();}}}else{if(!A.isString(P)&&!A.isNumber(P)){P="~-"+N.length+"-~";N[N.length]=F;}}S=S.substring(0,I)+P+S.substring(H+1);}for(I=N.length-1;I>=0;I=I-1){S=S.replace(new RegExp("~-"+I+"-~"),"{"+N[I]+"}","g");}return S;},trim:function(D){try{return D.replace(/^\s+|\s+$/g,"");}catch(E){return D;}},merge:function(){var G={},E=arguments;for(var F=0,D=E.length;F<D;F=F+1){A.augmentObject(G,E[F],true);}return G;},later:function(K,E,L,G,H){K=K||0;E=E||{};var F=L,J=G,I,D;if(A.isString(L)){F=E[L];}if(!F){throw new TypeError("method undefined");}if(!A.isArray(J)){J=[G];}I=function(){F.apply(E,J);};D=(H)?setInterval(I,K):setTimeout(I,K);return{interval:H,cancel:function(){if(this.interval){clearInterval(D);}else{clearTimeout(D);}}};},isValue:function(D){return(A.isObject(D)||A.isString(D)||A.isNumber(D)||A.isBoolean(D));}};A.hasOwnProperty=(Object.prototype.hasOwnProperty)?function(D,E){return D&&D.hasOwnProperty(E);}:function(D,E){return!A.isUndefined(D[E])&&D.constructor.prototype[E]!==D[E];};B.augmentObject(A,B,true);YAHOO.util.Lang=A;A.augment=A.augmentProto;YAHOO.augment=A.augmentProto;YAHOO.extend=A.extend;})();YAHOO.register("yahoo",YAHOO,{version:"2.5.2",build:"1076"});(function(){var B=YAHOO.util,K,I,J={},F={},M=window.document;YAHOO.env._id_counter=YAHOO.env._id_counter||0;var C=YAHOO.env.ua.opera,L=YAHOO.env.ua.webkit,A=YAHOO.env.ua.gecko,G=YAHOO.env.ua.ie;var E={HYPHEN:/(-[a-z])/i,ROOT_TAG:/^body|html$/i,OP_SCROLL:/^(?:inline|table-row)$/i};var N=function(P){if(!E.HYPHEN.test(P)){return P;}if(J[P]){return J[P];}var Q=P;while(E.HYPHEN.exec(Q)){Q=Q.replace(RegExp.$1,RegExp.$1.substr(1).toUpperCase());}J[P]=Q;return Q;};var O=function(Q){var P=F[Q];if(!P){P=new RegExp("(?:^|\\s+)"+Q+"(?:\\s+|$)");F[Q]=P;}return P;};if(M.defaultView&&M.defaultView.getComputedStyle){K=function(P,S){var R=null;if(S=="float"){S="cssFloat";}var Q=P.ownerDocument.defaultView.getComputedStyle(P,"");if(Q){R=Q[N(S)];}return P.style[S]||R;};}else{if(M.documentElement.currentStyle&&G){K=function(P,R){switch(N(R)){case"opacity":var T=100;try{T=P.filters["DXImageTransform.Microsoft.Alpha"].opacity;}catch(S){try{T=P.filters("alpha").opacity;}catch(S){}}return T/100;case"float":R="styleFloat";default:var Q=P.currentStyle?P.currentStyle[R]:null;return(P.style[R]||Q);}};}else{K=function(P,Q){return P.style[Q];};}}if(G){I=function(P,Q,R){switch(Q){case"opacity":if(YAHOO.lang.isString(P.style.filter)){P.style.filter="alpha(opacity="+R*100+")";if(!P.currentStyle||!P.currentStyle.hasLayout){P.style.zoom=1;}}break;case"float":Q="styleFloat";default:P.style[Q]=R;}};}else{I=function(P,Q,R){if(Q=="float"){Q="cssFloat";}P.style[Q]=R;};}var D=function(P,Q){return P&&P.nodeType==1&&(!Q||Q(P));};YAHOO.util.Dom={get:function(R){if(R&&(R.nodeType||R.item)){return R;}if(YAHOO.lang.isString(R)||!R){return M.getElementById(R);}if(R.length!==undefined){var S=[];for(var Q=0,P=R.length;Q<P;++Q){S[S.length]=B.Dom.get(R[Q]);}return S;}return R;},getStyle:function(P,R){R=N(R);var Q=function(S){return K(S,R);};return B.Dom.batch(P,Q,B.Dom,true);},setStyle:function(P,R,S){R=N(R);var Q=function(T){I(T,R,S);};B.Dom.batch(P,Q,B.Dom,true);},getXY:function(P){var Q=function(R){if((R.parentNode===null||R.offsetParent===null||this.getStyle(R,"display")=="none")&&R!=R.ownerDocument.body){return false;}return H(R);};return B.Dom.batch(P,Q,B.Dom,true);},getX:function(P){var Q=function(R){return B.Dom.getXY(R)[0];};return B.Dom.batch(P,Q,B.Dom,true);},getY:function(P){var Q=function(R){return B.Dom.getXY(R)[1];};return B.Dom.batch(P,Q,B.Dom,true);},setXY:function(P,S,R){var Q=function(V){var U=this.getStyle(V,"position");if(U=="static"){this.setStyle(V,"position","relative");U="relative";}var X=this.getXY(V);if(X===false){return false;}var W=[parseInt(this.getStyle(V,"left"),10),parseInt(this.getStyle(V,"top"),10)];if(isNaN(W[0])){W[0]=(U=="relative")?0:V.offsetLeft;}if(isNaN(W[1])){W[1]=(U=="relative")?0:V.offsetTop;}if(S[0]!==null){V.style.left=S[0]-X[0]+W[0]+"px";}if(S[1]!==null){V.style.top=S[1]-X[1]+W[1]+"px";}if(!R){var T=this.getXY(V);if((S[0]!==null&&T[0]!=S[0])||(S[1]!==null&&T[1]!=S[1])){this.setXY(V,S,true);}}};B.Dom.batch(P,Q,B.Dom,true);},setX:function(Q,P){B.Dom.setXY(Q,[P,null]);},setY:function(P,Q){B.Dom.setXY(P,[null,Q]);},getRegion:function(P){var Q=function(R){if((R.parentNode===null||R.offsetParent===null||this.getStyle(R,"display")=="none")&&R!=R.ownerDocument.body){return false;}var S=B.Region.getRegion(R);return S;};return B.Dom.batch(P,Q,B.Dom,true);},getClientWidth:function(){return B.Dom.getViewportWidth();},getClientHeight:function(){return B.Dom.getViewportHeight();},getElementsByClassName:function(T,X,U,V){X=X||"*";U=(U)?B.Dom.get(U):null||M;if(!U){return[];}var Q=[],P=U.getElementsByTagName(X),W=O(T);for(var R=0,S=P.length;R<S;++R){if(W.test(P[R].className)){Q[Q.length]=P[R];if(V){V.call(P[R],P[R]);}}}return Q;},hasClass:function(R,Q){var P=O(Q);var S=function(T){return P.test(T.className);};return B.Dom.batch(R,S,B.Dom,true);},addClass:function(Q,P){var R=function(S){if(this.hasClass(S,P)){return false;}S.className=YAHOO.lang.trim([S.className,P].join(" "));return true;};return B.Dom.batch(Q,R,B.Dom,true);},removeClass:function(R,Q){var P=O(Q);var S=function(T){if(!Q||!this.hasClass(T,Q)){return false;}var U=T.className;T.className=U.replace(P," ");if(this.hasClass(T,Q)){this.removeClass(T,Q);}T.className=YAHOO.lang.trim(T.className);return true;};return B.Dom.batch(R,S,B.Dom,true);},replaceClass:function(S,Q,P){if(!P||Q===P){return false;}var R=O(Q);var T=function(U){if(!this.hasClass(U,Q)){this.addClass(U,P);return true;}U.className=U.className.replace(R," "+P+" ");if(this.hasClass(U,Q)){this.replaceClass(U,Q,P);}U.className=YAHOO.lang.trim(U.className);return true;};return B.Dom.batch(S,T,B.Dom,true);},generateId:function(P,R){R=R||"yui-gen";var Q=function(S){if(S&&S.id){return S.id;}var T=R+YAHOO.env._id_counter++;if(S){S.id=T;}return T;};return B.Dom.batch(P,Q,B.Dom,true)||Q.apply(B.Dom,arguments);},isAncestor:function(P,Q){P=B.Dom.get(P);Q=B.Dom.get(Q);if(!P||!Q){return false;}if(P.contains&&Q.nodeType&&!L){return P.contains(Q);}else{if(P.compareDocumentPosition&&Q.nodeType){return!!(P.compareDocumentPosition(Q)&16);}else{if(Q.nodeType){return!!this.getAncestorBy(Q,function(R){return R==P;});}}}return false;},inDocument:function(P){return this.isAncestor(M.documentElement,P);},getElementsBy:function(W,Q,R,T){Q=Q||"*";R=(R)?B.Dom.get(R):null||M;if(!R){return[];}var S=[],V=R.getElementsByTagName(Q);for(var U=0,P=V.length;U<P;++U){if(W(V[U])){S[S.length]=V[U];if(T){T(V[U]);}}}return S;},batch:function(T,W,V,R){T=(T&&(T.tagName||T.item))?T:B.Dom.get(T);if(!T||!W){return false;}var S=(R)?V:window;if(T.tagName||T.length===undefined){return W.call(S,T,V);}var U=[];for(var Q=0,P=T.length;Q<P;++Q){U[U.length]=W.call(S,T[Q],V);}return U;},getDocumentHeight:function(){var Q=(M.compatMode!="CSS1Compat")?M.body.scrollHeight:M.documentElement.scrollHeight;var P=Math.max(Q,B.Dom.getViewportHeight());return P;},getDocumentWidth:function(){var Q=(M.compatMode!="CSS1Compat")?M.body.scrollWidth:M.documentElement.scrollWidth;var P=Math.max(Q,B.Dom.getViewportWidth());return P;},getViewportHeight:function(){var P=self.innerHeight;var Q=M.compatMode;if((Q||G)&&!C){P=(Q=="CSS1Compat")?M.documentElement.clientHeight:M.body.clientHeight;}return P;},getViewportWidth:function(){var P=self.innerWidth;var Q=M.compatMode;if(Q||G){P=(Q=="CSS1Compat")?M.documentElement.clientWidth:M.body.clientWidth;}return P;},getAncestorBy:function(P,Q){while(P=P.parentNode){if(D(P,Q)){return P;}}return null;},getAncestorByClassName:function(Q,P){Q=B.Dom.get(Q);if(!Q){return null;}var R=function(S){return B.Dom.hasClass(S,P);};return B.Dom.getAncestorBy(Q,R);},getAncestorByTagName:function(Q,P){Q=B.Dom.get(Q);if(!Q){return null;}var R=function(S){return S.tagName&&S.tagName.toUpperCase()==P.toUpperCase();};return B.Dom.getAncestorBy(Q,R);},getPreviousSiblingBy:function(P,Q){while(P){P=P.previousSibling;if(D(P,Q)){return P;}}return null;},getPreviousSibling:function(P){P=B.Dom.get(P);if(!P){return null;}return B.Dom.getPreviousSiblingBy(P);},getNextSiblingBy:function(P,Q){while(P){P=P.nextSibling;if(D(P,Q)){return P;}}return null;},getNextSibling:function(P){P=B.Dom.get(P);if(!P){return null;}return B.Dom.getNextSiblingBy(P);},getFirstChildBy:function(P,R){var Q=(D(P.firstChild,R))?P.firstChild:null;return Q||B.Dom.getNextSiblingBy(P.firstChild,R);},getFirstChild:function(P,Q){P=B.Dom.get(P);if(!P){return null;}return B.Dom.getFirstChildBy(P);},getLastChildBy:function(P,R){if(!P){return null;}var Q=(D(P.lastChild,R))?P.lastChild:null;return Q||B.Dom.getPreviousSiblingBy(P.lastChild,R);},getLastChild:function(P){P=B.Dom.get(P);return B.Dom.getLastChildBy(P);},getChildrenBy:function(Q,S){var R=B.Dom.getFirstChildBy(Q,S);var P=R?[R]:[];B.Dom.getNextSiblingBy(R,function(T){if(!S||S(T)){P[P.length]=T;}return false;});return P;},getChildren:function(P){P=B.Dom.get(P);if(!P){}return B.Dom.getChildrenBy(P);},getDocumentScrollLeft:function(P){P=P||M;return Math.max(P.documentElement.scrollLeft,P.body.scrollLeft);},getDocumentScrollTop:function(P){P=P||M;return Math.max(P.documentElement.scrollTop,P.body.scrollTop);},insertBefore:function(Q,P){Q=B.Dom.get(Q);P=B.Dom.get(P);if(!Q||!P||!P.parentNode){return null;}return P.parentNode.insertBefore(Q,P);},insertAfter:function(Q,P){Q=B.Dom.get(Q);P=B.Dom.get(P);if(!Q||!P||!P.parentNode){return null;}if(P.nextSibling){return P.parentNode.insertBefore(Q,P.nextSibling);}else{return P.parentNode.appendChild(Q);}},getClientRegion:function(){var R=B.Dom.getDocumentScrollTop(),Q=B.Dom.getDocumentScrollLeft(),S=B.Dom.getViewportWidth()+Q,P=B.Dom.getViewportHeight()+R;return new B.Region(R,S,P,Q);}};var H=function(){if(M.documentElement.getBoundingClientRect){return function(Q){var R=Q.getBoundingClientRect();var P=Q.ownerDocument;return[R.left+B.Dom.getDocumentScrollLeft(P),R.top+B.Dom.getDocumentScrollTop(P)];};}else{return function(R){var S=[R.offsetLeft,R.offsetTop];var Q=R.offsetParent;var P=(L&&B.Dom.getStyle(R,"position")=="absolute"&&R.offsetParent==R.ownerDocument.body);if(Q!=R){while(Q){S[0]+=Q.offsetLeft;S[1]+=Q.offsetTop;if(!P&&L&&B.Dom.getStyle(Q,"position")=="absolute"){P=true;}Q=Q.offsetParent;}}if(P){S[0]-=R.ownerDocument.body.offsetLeft;S[1]-=R.ownerDocument.body.offsetTop;}Q=R.parentNode;while(Q.tagName&&!E.ROOT_TAG.test(Q.tagName)){if(Q.scrollTop||Q.scrollLeft){if(!E.OP_SCROLL.test(B.Dom.getStyle(Q,"display"))){if(!C||B.Dom.getStyle(Q,"overflow")!=="visible"){S[0]-=Q.scrollLeft;S[1]-=Q.scrollTop;}}}Q=Q.parentNode;}return S;};}}();})();YAHOO.util.Region=function(C,D,A,B){this.top=C;this[1]=C;this.right=D;this.bottom=A;this.left=B;this[0]=B;};YAHOO.util.Region.prototype.contains=function(A){return(A.left>=this.left&&A.right<=this.right&&A.top>=this.top&&A.bottom<=this.bottom);};YAHOO.util.Region.prototype.getArea=function(){return((this.bottom-this.top)*(this.right-this.left));};YAHOO.util.Region.prototype.intersect=function(E){var C=Math.max(this.top,E.top);var D=Math.min(this.right,E.right);var A=Math.min(this.bottom,E.bottom);var B=Math.max(this.left,E.left);if(A>=C&&D>=B){return new YAHOO.util.Region(C,D,A,B);}else{return null;}};YAHOO.util.Region.prototype.union=function(E){var C=Math.min(this.top,E.top);var D=Math.max(this.right,E.right);var A=Math.max(this.bottom,E.bottom);var B=Math.min(this.left,E.left);return new YAHOO.util.Region(C,D,A,B);};YAHOO.util.Region.prototype.toString=function(){return("Region {"+"top: "+this.top+", right: "+this.right+", bottom: "+this.bottom+", left: "+this.left+"}");};YAHOO.util.Region.getRegion=function(D){var F=YAHOO.util.Dom.getXY(D);var C=F[1];var E=F[0]+D.offsetWidth;var A=F[1]+D.offsetHeight;var B=F[0];return new YAHOO.util.Region(C,E,A,B);};YAHOO.util.Point=function(A,B){if(YAHOO.lang.isArray(A)){B=A[1];A=A[0];}this.x=this.right=this.left=this[0]=A;this.y=this.top=this.bottom=this[1]=B;};YAHOO.util.Point.prototype=new YAHOO.util.Region();YAHOO.register("dom",YAHOO.util.Dom,{version:"2.5.2",build:"1076"});YAHOO.util.CustomEvent=function(D,B,C,A){this.type=D;this.scope=B||window;this.silent=C;this.signature=A||YAHOO.util.CustomEvent.LIST;this.subscribers=[];if(!this.silent){}var E="_YUICEOnSubscribe";if(D!==E){this.subscribeEvent=new YAHOO.util.CustomEvent(E,this,true);}this.lastError=null;};YAHOO.util.CustomEvent.LIST=0;YAHOO.util.CustomEvent.FLAT=1;YAHOO.util.CustomEvent.prototype={subscribe:function(B,C,A){if(!B){throw new Error("Invalid callback for subscriber to '"+this.type+"'");}if(this.subscribeEvent){this.subscribeEvent.fire(B,C,A);}this.subscribers.push(new YAHOO.util.Subscriber(B,C,A));},unsubscribe:function(D,F){if(!D){return this.unsubscribeAll();}var E=false;for(var B=0,A=this.subscribers.length;B<A;++B){var C=this.subscribers[B];if(C&&C.contains(D,F)){this._delete(B);E=true;}}return E;},fire:function(){this.lastError=null;var K=[],E=this.subscribers.length;if(!E&&this.silent){return true;}var I=[].slice.call(arguments,0),G=true,D,J=false;if(!this.silent){}var C=this.subscribers.slice(),A=YAHOO.util.Event.throwErrors;for(D=0;D<E;++D){var M=C[D];if(!M){J=true;}else{if(!this.silent){}var L=M.getScope(this.scope);if(this.signature==YAHOO.util.CustomEvent.FLAT){var B=null;if(I.length>0){B=I[0];}try{G=M.fn.call(L,B,M.obj);}catch(F){this.lastError=F;if(A){throw F;}}}else{try{G=M.fn.call(L,this.type,I,M.obj);}catch(H){this.lastError=H;if(A){throw H;}}}if(false===G){if(!this.silent){}break;}}}return(G!==false);},unsubscribeAll:function(){for(var A=this.subscribers.length-1;A>-1;A--){this._delete(A);}this.subscribers=[];return A;},_delete:function(A){var B=this.subscribers[A];if(B){delete B.fn;delete B.obj;}this.subscribers.splice(A,1);},toString:function(){return"CustomEvent: "+"'"+this.type+"', "+"scope: "+this.scope;}};YAHOO.util.Subscriber=function(B,C,A){this.fn=B;this.obj=YAHOO.lang.isUndefined(C)?null:C;this.override=A;};YAHOO.util.Subscriber.prototype.getScope=function(A){if(this.override){if(this.override===true){return this.obj;}else{return this.override;}}return A;};YAHOO.util.Subscriber.prototype.contains=function(A,B){if(B){return(this.fn==A&&this.obj==B);}else{return(this.fn==A);}};YAHOO.util.Subscriber.prototype.toString=function(){return"Subscriber { obj: "+this.obj+", override: "+(this.override||"no")+" }";};if(!YAHOO.util.Event){YAHOO.util.Event=function(){var H=false;var I=[];var J=[];var G=[];var E=[];var C=0;var F=[];var B=[];var A=0;var D={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9};return{POLL_RETRYS:2000,POLL_INTERVAL:20,EL:0,TYPE:1,FN:2,WFN:3,UNLOAD_OBJ:3,ADJ_SCOPE:4,OBJ:5,OVERRIDE:6,lastError:null,isSafari:YAHOO.env.ua.webkit,webkit:YAHOO.env.ua.webkit,isIE:YAHOO.env.ua.ie,_interval:null,_dri:null,DOMReady:false,throwErrors:false,startInterval:function(){if(!this._interval){var K=this;var L=function(){K._tryPreloadAttach();};this._interval=setInterval(L,this.POLL_INTERVAL);}},onAvailable:function(P,M,Q,O,N){var K=(YAHOO.lang.isString(P))?[P]:P;for(var L=0;L<K.length;L=L+1){F.push({id:K[L],fn:M,obj:Q,override:O,checkReady:N});}C=this.POLL_RETRYS;this.startInterval();},onContentReady:function(M,K,N,L){this.onAvailable(M,K,N,L,true);},onDOMReady:function(K,M,L){if(this.DOMReady){setTimeout(function(){var N=window;if(L){if(L===true){N=M;}else{N=L;}}K.call(N,"DOMReady",[],M);},0);}else{this.DOMReadyEvent.subscribe(K,M,L);}},addListener:function(M,K,V,Q,L){if(!V||!V.call){return false;}if(this._isValidCollection(M)){var W=true;for(var R=0,T=M.length;R<T;++R){W=this.on(M[R],K,V,Q,L)&&W;}return W;}else{if(YAHOO.lang.isString(M)){var P=this.getEl(M);if(P){M=P;}else{this.onAvailable(M,function(){YAHOO.util.Event.on(M,K,V,Q,L);});return true;}}}if(!M){return false;}if("unload"==K&&Q!==this){J[J.length]=[M,K,V,Q,L];return true;}var Y=M;if(L){if(L===true){Y=Q;}else{Y=L;}}var N=function(Z){return V.call(Y,YAHOO.util.Event.getEvent(Z,M),Q);};var X=[M,K,V,N,Y,Q,L];var S=I.length;I[S]=X;if(this.useLegacyEvent(M,K)){var O=this.getLegacyIndex(M,K);if(O==-1||M!=G[O][0]){O=G.length;B[M.id+K]=O;G[O]=[M,K,M["on"+K]];E[O]=[];M["on"+K]=function(Z){YAHOO.util.Event.fireLegacyEvent(YAHOO.util.Event.getEvent(Z),O);};}E[O].push(X);}else{try{this._simpleAdd(M,K,N,false);}catch(U){this.lastError=U;this.removeListener(M,K,V);return false;}}return true;},fireLegacyEvent:function(O,M){var Q=true,K,S,R,T,P;S=E[M].slice();for(var L=0,N=S.length;L<N;++L){R=S[L];if(R&&R[this.WFN]){T=R[this.ADJ_SCOPE];P=R[this.WFN].call(T,O);Q=(Q&&P);}}K=G[M];if(K&&K[2]){K[2](O);}return Q;},getLegacyIndex:function(L,M){var K=this.generateId(L)+M;if(typeof B[K]=="undefined"){return-1;}else{return B[K];}},useLegacyEvent:function(L,M){if(this.webkit&&("click"==M||"dblclick"==M)){var K=parseInt(this.webkit,10);if(!isNaN(K)&&K<418){return true;}}return false;},removeListener:function(L,K,T){var O,R,V;if(typeof L=="string"){L=this.getEl(L);}else{if(this._isValidCollection(L)){var U=true;for(O=L.length-1;O>-1;O--){U=(this.removeListener(L[O],K,T)&&U);}return U;}}if(!T||!T.call){return this.purgeElement(L,false,K);}if("unload"==K){for(O=J.length-1;O>-1;O--){V=J[O];if(V&&V[0]==L&&V[1]==K&&V[2]==T){J.splice(O,1);return true;}}return false;}var P=null;var Q=arguments[3];if("undefined"===typeof Q){Q=this._getCacheIndex(L,K,T);}if(Q>=0){P=I[Q];}if(!L||!P){return false;}if(this.useLegacyEvent(L,K)){var N=this.getLegacyIndex(L,K);var M=E[N];if(M){for(O=0,R=M.length;O<R;++O){V=M[O];if(V&&V[this.EL]==L&&V[this.TYPE]==K&&V[this.FN]==T){M.splice(O,1);break;}}}}else{try{this._simpleRemove(L,K,P[this.WFN],false);}catch(S){this.lastError=S;return false;}}delete I[Q][this.WFN];delete I[Q][this.FN];I.splice(Q,1);return true;},getTarget:function(M,L){var K=M.target||M.srcElement;return this.resolveTextNode(K);},resolveTextNode:function(L){try{if(L&&3==L.nodeType){return L.parentNode;}}catch(K){}return L;},getPageX:function(L){var K=L.pageX;if(!K&&0!==K){K=L.clientX||0;if(this.isIE){K+=this._getScrollLeft();}}return K;},getPageY:function(K){var L=K.pageY;if(!L&&0!==L){L=K.clientY||0;if(this.isIE){L+=this._getScrollTop();}}return L;},getXY:function(K){return[this.getPageX(K),this.getPageY(K)];},getRelatedTarget:function(L){var K=L.relatedTarget;if(!K){if(L.type=="mouseout"){K=L.toElement;}else{if(L.type=="mouseover"){K=L.fromElement;}}}return this.resolveTextNode(K);},getTime:function(M){if(!M.time){var L=new Date().getTime();try{M.time=L;}catch(K){this.lastError=K;return L;}}return M.time;},stopEvent:function(K){this.stopPropagation(K);this.preventDefault(K);},stopPropagation:function(K){if(K.stopPropagation){K.stopPropagation();}else{K.cancelBubble=true;}},preventDefault:function(K){if(K.preventDefault){K.preventDefault();}else{K.returnValue=false;}},getEvent:function(M,K){var L=M||window.event;if(!L){var N=this.getEvent.caller;while(N){L=N.arguments[0];if(L&&Event==L.constructor){break;}N=N.caller;}}return L;},getCharCode:function(L){var K=L.keyCode||L.charCode||0;if(YAHOO.env.ua.webkit&&(K in D)){K=D[K];}return K;},_getCacheIndex:function(O,P,N){for(var M=0,L=I.length;M<L;M=M+1){var K=I[M];if(K&&K[this.FN]==N&&K[this.EL]==O&&K[this.TYPE]==P){return M;}}return-1;},generateId:function(K){var L=K.id;if(!L){L="yuievtautoid-"+A;++A;K.id=L;}return L;},_isValidCollection:function(L){try{return(L&&typeof L!=="string"&&L.length&&!L.tagName&&!L.alert&&typeof L[0]!=="undefined");}catch(K){return false;}},elCache:{},getEl:function(K){return(typeof K==="string")?document.getElementById(K):K;},clearCache:function(){},DOMReadyEvent:new YAHOO.util.CustomEvent("DOMReady",this),_load:function(L){if(!H){H=true;var K=YAHOO.util.Event;K._ready();K._tryPreloadAttach();}},_ready:function(L){var K=YAHOO.util.Event;if(!K.DOMReady){K.DOMReady=true;K.DOMReadyEvent.fire();K._simpleRemove(document,"DOMContentLoaded",K._ready);}},_tryPreloadAttach:function(){if(F.length===0){C=0;clearInterval(this._interval);this._interval=null;return;}if(this.locked){return;}if(this.isIE){if(!this.DOMReady){this.startInterval();return;}}this.locked=true;var Q=!H;if(!Q){Q=(C>0&&F.length>0);}var P=[];var R=function(T,U){var S=T;if(U.override){if(U.override===true){S=U.obj;}else{S=U.override;}}U.fn.call(S,U.obj);};var L,K,O,N,M=[];for(L=0,K=F.length;L<K;L=L+1){O=F[L];if(O){N=this.getEl(O.id);if(N){if(O.checkReady){if(H||N.nextSibling||!Q){M.push(O);F[L]=null;}}else{R(N,O);F[L]=null;}}else{P.push(O);}}}for(L=0,K=M.length;L<K;L=L+1){O=M[L];R(this.getEl(O.id),O);}C--;if(Q){for(L=F.length-1;L>-1;L--){O=F[L];if(!O||!O.id){F.splice(L,1);}}this.startInterval();}else{clearInterval(this._interval);this._interval=null;}this.locked=false;},purgeElement:function(O,P,R){var M=(YAHOO.lang.isString(O))?this.getEl(O):O;var Q=this.getListeners(M,R),N,K;if(Q){for(N=Q.length-1;N>-1;N--){var L=Q[N];this.removeListener(M,L.type,L.fn);}}if(P&&M&&M.childNodes){for(N=0,K=M.childNodes.length;N<K;++N){this.purgeElement(M.childNodes[N],P,R);}}},getListeners:function(M,K){var P=[],L;if(!K){L=[I,J];}else{if(K==="unload"){L=[J];}else{L=[I];}}var R=(YAHOO.lang.isString(M))?this.getEl(M):M;for(var O=0;O<L.length;O=O+1){var T=L[O];if(T){for(var Q=0,S=T.length;Q<S;++Q){var N=T[Q];if(N&&N[this.EL]===R&&(!K||K===N[this.TYPE])){P.push({type:N[this.TYPE],fn:N[this.FN],obj:N[this.OBJ],adjust:N[this.OVERRIDE],scope:N[this.ADJ_SCOPE],index:Q});}}}}return(P.length)?P:null;},_unload:function(Q){var K=YAHOO.util.Event,N,M,L,P,O,R=J.slice();for(N=0,P=J.length;N<P;++N){L=R[N];if(L){var S=window;if(L[K.ADJ_SCOPE]){if(L[K.ADJ_SCOPE]===true){S=L[K.UNLOAD_OBJ];}else{S=L[K.ADJ_SCOPE];}}L[K.FN].call(S,K.getEvent(Q,L[K.EL]),L[K.UNLOAD_OBJ]);R[N]=null;L=null;S=null;}}J=null;if(I){for(M=I.length-1;M>-1;M--){L=I[M];if(L){K.removeListener(L[K.EL],L[K.TYPE],L[K.FN],M);}}L=null;}G=null;K._simpleRemove(window,"unload",K._unload);},_getScrollLeft:function(){return this._getScroll()[1];},_getScrollTop:function(){return this._getScroll()[0];},_getScroll:function(){var K=document.documentElement,L=document.body;if(K&&(K.scrollTop||K.scrollLeft)){return[K.scrollTop,K.scrollLeft];}else{if(L){return[L.scrollTop,L.scrollLeft];}else{return[0,0];}}},regCE:function(){},_simpleAdd:function(){if(window.addEventListener){return function(M,N,L,K){M.addEventListener(N,L,(K));};}else{if(window.attachEvent){return function(M,N,L,K){M.attachEvent("on"+N,L);};}else{return function(){};}}}(),_simpleRemove:function(){if(window.removeEventListener){return function(M,N,L,K){M.removeEventListener(N,L,(K));};}else{if(window.detachEvent){return function(L,M,K){L.detachEvent("on"+M,K);};}else{return function(){};}}}()};}();(function(){var EU=YAHOO.util.Event;EU.on=EU.addListener;if(EU.isIE){YAHOO.util.Event.onDOMReady(YAHOO.util.Event._tryPreloadAttach,YAHOO.util.Event,true);var n=document.createElement("p");EU._dri=setInterval(function(){try{n.doScroll("left");clearInterval(EU._dri);EU._dri=null;EU._ready();n=null;}catch(ex){}},EU.POLL_INTERVAL);}else{if(EU.webkit&&EU.webkit<525){EU._dri=setInterval(function(){var rs=document.readyState;if("loaded"==rs||"complete"==rs){clearInterval(EU._dri);EU._dri=null;EU._ready();}},EU.POLL_INTERVAL);}else{EU._simpleAdd(document,"DOMContentLoaded",EU._ready);}}EU._simpleAdd(window,"load",EU._load);EU._simpleAdd(window,"unload",EU._unload);EU._tryPreloadAttach();})();}YAHOO.util.EventProvider=function(){};YAHOO.util.EventProvider.prototype={__yui_events:null,__yui_subscribers:null,subscribe:function(A,C,F,E){this.__yui_events=this.__yui_events||{};var D=this.__yui_events[A];if(D){D.subscribe(C,F,E);}else{this.__yui_subscribers=this.__yui_subscribers||{};var B=this.__yui_subscribers;if(!B[A]){B[A]=[];}B[A].push({fn:C,obj:F,override:E});}},unsubscribe:function(C,E,G){this.__yui_events=this.__yui_events||{};var A=this.__yui_events;if(C){var F=A[C];if(F){return F.unsubscribe(E,G);}}else{var B=true;for(var D in A){if(YAHOO.lang.hasOwnProperty(A,D)){B=B&&A[D].unsubscribe(E,G);}}return B;}return false;},unsubscribeAll:function(A){return this.unsubscribe(A);},createEvent:function(G,D){this.__yui_events=this.__yui_events||{};var A=D||{};var I=this.__yui_events;if(I[G]){}else{var H=A.scope||this;var E=(A.silent);var B=new YAHOO.util.CustomEvent(G,H,E,YAHOO.util.CustomEvent.FLAT);I[G]=B;if(A.onSubscribeCallback){B.subscribeEvent.subscribe(A.onSubscribeCallback);}this.__yui_subscribers=this.__yui_subscribers||{};var F=this.__yui_subscribers[G];if(F){for(var C=0;C<F.length;++C){B.subscribe(F[C].fn,F[C].obj,F[C].override);}}}return I[G];},fireEvent:function(E,D,A,C){this.__yui_events=this.__yui_events||{};var G=this.__yui_events[E];if(!G){return null;}var B=[];for(var F=1;F<arguments.length;++F){B.push(arguments[F]);}return G.fire.apply(G,B);},hasEvent:function(A){if(this.__yui_events){if(this.__yui_events[A]){return true;}}return false;}};YAHOO.util.KeyListener=function(A,F,B,C){if(!A){}else{if(!F){}else{if(!B){}}}if(!C){C=YAHOO.util.KeyListener.KEYDOWN;}var D=new YAHOO.util.CustomEvent("keyPressed");this.enabledEvent=new YAHOO.util.CustomEvent("enabled");this.disabledEvent=new YAHOO.util.CustomEvent("disabled");if(typeof A=="string"){A=document.getElementById(A);}if(typeof B=="function"){D.subscribe(B);}else{D.subscribe(B.fn,B.scope,B.correctScope);}function E(J,I){if(!F.shift){F.shift=false;}if(!F.alt){F.alt=false;}if(!F.ctrl){F.ctrl=false;}if(J.shiftKey==F.shift&&J.altKey==F.alt&&J.ctrlKey==F.ctrl){var G;if(F.keys instanceof Array){for(var H=0;H<F.keys.length;H++){G=F.keys[H];if(G==J.charCode){D.fire(J.charCode,J);break;}else{if(G==J.keyCode){D.fire(J.keyCode,J);break;}}}}else{G=F.keys;if(G==J.charCode){D.fire(J.charCode,J);}else{if(G==J.keyCode){D.fire(J.keyCode,J);}}}}}this.enable=function(){if(!this.enabled){YAHOO.util.Event.addListener(A,C,E);this.enabledEvent.fire(F);}this.enabled=true;};this.disable=function(){if(this.enabled){YAHOO.util.Event.removeListener(A,C,E);this.disabledEvent.fire(F);}this.enabled=false;};this.toString=function(){return"KeyListener ["+F.keys+"] "+A.tagName+(A.id?"["+A.id+"]":"");};};YAHOO.util.KeyListener.KEYDOWN="keydown";YAHOO.util.KeyListener.KEYUP="keyup";YAHOO.util.KeyListener.KEY={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38};YAHOO.register("event",YAHOO.util.Event,{version:"2.5.2",build:"1076"});YAHOO.register("yahoo-dom-event",YAHOO,{version:"2.5.2",build:"1076"});

if(!YAHOO.util.DragDropMgr){YAHOO.util.DragDropMgr=function(){var Event=YAHOO.util.Event;return{ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:true,stopPropagation:true,initialized:false,locked:false,interactionInfo:null,init:function(){this.initialized=true;},POINT:0,INTERSECT:1,STRICT_INTERSECT:2,mode:0,_execOnAll:function(sMethod,args){for(var i in this.ids){for(var j in this.ids[i]){var oDD=this.ids[i][j];if(!this.isTypeOfDD(oDD)){continue;}
oDD[sMethod].apply(oDD,args);}}},_onLoad:function(){this.init();Event.on(document,"mouseup",this.handleMouseUp,this,true);Event.on(document,"mousemove",this.handleMouseMove,this,true);Event.on(window,"unload",this._onUnload,this,true);Event.on(window,"resize",this._onResize,this,true);},_onResize:function(e){this._execOnAll("resetConstraints",[]);},lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isLocked:function(){return this.locked;},locationCache:{},useCache:true,clickPixelThresh:3,clickTimeThresh:1000,dragThreshMet:false,clickTimeout:null,startX:0,startY:0,fromTimeout:false,regDragDrop:function(oDD,sGroup){if(!this.initialized){this.init();}
if(!this.ids[sGroup]){this.ids[sGroup]={};}
this.ids[sGroup][oDD.id]=oDD;},removeDDFromGroup:function(oDD,sGroup){if(!this.ids[sGroup]){this.ids[sGroup]={};}
var obj=this.ids[sGroup];if(obj&&obj[oDD.id]){delete obj[oDD.id];}},_remove:function(oDD){for(var g in oDD.groups){if(g&&this.ids[g][oDD.id]){delete this.ids[g][oDD.id];}}
delete this.handleIds[oDD.id];},regHandle:function(sDDId,sHandleId){if(!this.handleIds[sDDId]){this.handleIds[sDDId]={};}
this.handleIds[sDDId][sHandleId]=sHandleId;},isDragDrop:function(id){return(this.getDDById(id))?true:false;},getRelated:function(p_oDD,bTargetsOnly){var oDDs=[];for(var i in p_oDD.groups){for(var j in this.ids[i]){var dd=this.ids[i][j];if(!this.isTypeOfDD(dd)){continue;}
if(!bTargetsOnly||dd.isTarget){oDDs[oDDs.length]=dd;}}}
return oDDs;},isLegalTarget:function(oDD,oTargetDD){var targets=this.getRelated(oDD,true);for(var i=0,len=targets.length;i<len;++i){if(targets[i].id==oTargetDD.id){return true;}}
return false;},isTypeOfDD:function(oDD){return(oDD&&oDD.__ygDragDrop);},isHandle:function(sDDId,sHandleId){return(this.handleIds[sDDId]&&this.handleIds[sDDId][sHandleId]);},getDDById:function(id){for(var i in this.ids){if(this.ids[i][id]){return this.ids[i][id];}}
return null;},handleMouseDown:function(e,oDD){this.currentTarget=YAHOO.util.Event.getTarget(e);this.dragCurrent=oDD;var el=oDD.getEl();this.startX=YAHOO.util.Event.getPageX(e);this.startY=YAHOO.util.Event.getPageY(e);this.deltaX=this.startX-el.offsetLeft;this.deltaY=this.startY-el.offsetTop;this.dragThreshMet=false;this.clickTimeout=setTimeout(function(){var DDM=YAHOO.util.DDM;DDM.startDrag(DDM.startX,DDM.startY);DDM.fromTimeout=true;},this.clickTimeThresh);},startDrag:function(x,y){clearTimeout(this.clickTimeout);var dc=this.dragCurrent;if(dc&&dc.events.b4StartDrag){dc.b4StartDrag(x,y);dc.fireEvent('b4StartDragEvent',{x:x,y:y});}
if(dc&&dc.events.startDrag){dc.startDrag(x,y);dc.fireEvent('startDragEvent',{x:x,y:y});}
this.dragThreshMet=true;},handleMouseUp:function(e){if(this.dragCurrent){clearTimeout(this.clickTimeout);if(this.dragThreshMet){if(this.fromTimeout){this.fromTimeout=false;this.handleMouseMove(e);}
this.fromTimeout=false;this.fireEvents(e,true);}else{}
this.stopDrag(e);this.stopEvent(e);}},stopEvent:function(e){if(this.stopPropagation){YAHOO.util.Event.stopPropagation(e);}
if(this.preventDefault){YAHOO.util.Event.preventDefault(e);}},stopDrag:function(e,silent){var dc=this.dragCurrent;if(dc&&!silent){if(this.dragThreshMet){if(dc.events.b4EndDrag){dc.b4EndDrag(e);dc.fireEvent('b4EndDragEvent',{e:e});}
if(dc.events.endDrag){dc.endDrag(e);dc.fireEvent('endDragEvent',{e:e});}}
if(dc.events.mouseUp){dc.onMouseUp(e);dc.fireEvent('mouseUpEvent',{e:e});}}
this.dragCurrent=null;this.dragOvers={};},handleMouseMove:function(e){var dc=this.dragCurrent;if(dc){if(YAHOO.util.Event.isIE&&!e.button){this.stopEvent(e);return this.handleMouseUp(e);}else{if(e.clientX<0||e.clientY<0){}}
if(!this.dragThreshMet){var diffX=Math.abs(this.startX-YAHOO.util.Event.getPageX(e));var diffY=Math.abs(this.startY-YAHOO.util.Event.getPageY(e));if(diffX>this.clickPixelThresh||diffY>this.clickPixelThresh){this.startDrag(this.startX,this.startY);}}
if(this.dragThreshMet){if(dc&&dc.events.b4Drag){dc.b4Drag(e);dc.fireEvent('b4DragEvent',{e:e});}
if(dc&&dc.events.drag){dc.onDrag(e);dc.fireEvent('dragEvent',{e:e});}
if(dc){this.fireEvents(e,false);}}
this.stopEvent(e);}},fireEvents:function(e,isDrop){var dc=this.dragCurrent;if(!dc||dc.isLocked()||dc.dragOnly){return;}
var x=YAHOO.util.Event.getPageX(e),y=YAHOO.util.Event.getPageY(e),pt=new YAHOO.util.Point(x,y),pos=dc.getTargetCoord(pt.x,pt.y),el=dc.getDragEl(),events=['out','over','drop','enter'],curRegion=new YAHOO.util.Region(pos.y,pos.x+el.offsetWidth,pos.y+el.offsetHeight,pos.x),oldOvers=[],inGroupsObj={},inGroups=[],data={outEvts:[],overEvts:[],dropEvts:[],enterEvts:[]};for(var i in this.dragOvers){var ddo=this.dragOvers[i];if(!this.isTypeOfDD(ddo)){continue;}
if(!this.isOverTarget(pt,ddo,this.mode,curRegion)){data.outEvts.push(ddo);}
oldOvers[i]=true;delete this.dragOvers[i];}
for(var sGroup in dc.groups){if("string"!=typeof sGroup){continue;}
for(i in this.ids[sGroup]){var oDD=this.ids[sGroup][i];if(!this.isTypeOfDD(oDD)){continue;}
if(oDD.isTarget&&!oDD.isLocked()&&oDD!=dc){if(this.isOverTarget(pt,oDD,this.mode,curRegion)){inGroupsObj[sGroup]=true;if(isDrop){data.dropEvts.push(oDD);}else{if(!oldOvers[oDD.id]){data.enterEvts.push(oDD);}else{data.overEvts.push(oDD);}
this.dragOvers[oDD.id]=oDD;}}}}}
this.interactionInfo={out:data.outEvts,enter:data.enterEvts,over:data.overEvts,drop:data.dropEvts,point:pt,draggedRegion:curRegion,sourceRegion:this.locationCache[dc.id],validDrop:isDrop};for(var inG in inGroupsObj){inGroups.push(inG);}
if(isDrop&&!data.dropEvts.length){this.interactionInfo.validDrop=false;if(dc.events.invalidDrop){dc.onInvalidDrop(e);dc.fireEvent('invalidDropEvent',{e:e});}}
for(i=0;i<events.length;i++){var tmp=null;if(data[events[i]+'Evts']){tmp=data[events[i]+'Evts'];}
if(tmp&&tmp.length){var type=events[i].charAt(0).toUpperCase()+events[i].substr(1),ev='onDrag'+type,b4='b4Drag'+type,cev='drag'+type+'Event',check='drag'+type;if(this.mode){if(dc.events[b4]){dc[b4](e,tmp,inGroups);dc.fireEvent(b4+'Event',{event:e,info:tmp,group:inGroups});}
if(dc.events[check]){dc[ev](e,tmp,inGroups);dc.fireEvent(cev,{event:e,info:tmp,group:inGroups});}}else{for(var b=0,len=tmp.length;b<len;++b){if(dc.events[b4]){dc[b4](e,tmp[b].id,inGroups[0]);dc.fireEvent(b4+'Event',{event:e,info:tmp[b].id,group:inGroups[0]});}
if(dc.events[check]){dc[ev](e,tmp[b].id,inGroups[0]);dc.fireEvent(cev,{event:e,info:tmp[b].id,group:inGroups[0]});}}}}}},getBestMatch:function(dds){var winner=null;var len=dds.length;if(len==1){winner=dds[0];}else{for(var i=0;i<len;++i){var dd=dds[i];if(this.mode==this.INTERSECT&&dd.cursorIsOver){winner=dd;break;}else{if(!winner||!winner.overlap||(dd.overlap&&winner.overlap.getArea()<dd.overlap.getArea())){winner=dd;}}}}
return winner;},refreshCache:function(groups){var g=groups||this.ids;for(var sGroup in g){if("string"!=typeof sGroup){continue;}
for(var i in this.ids[sGroup]){var oDD=this.ids[sGroup][i];if(this.isTypeOfDD(oDD)){var loc=this.getLocation(oDD);if(loc){this.locationCache[oDD.id]=loc;}else{delete this.locationCache[oDD.id];}}}}},verifyEl:function(el){try{if(el){var parent=el.offsetParent;if(parent){return true;}}}catch(e){}
return false;},getLocation:function(oDD){if(!this.isTypeOfDD(oDD)){return null;}
var el=oDD.getEl(),pos,x1,x2,y1,y2,t,r,b,l;try{pos=YAHOO.util.Dom.getXY(el);}catch(e){}
if(!pos){return null;}
x1=pos[0];x2=x1+el.offsetWidth;y1=pos[1];y2=y1+el.offsetHeight;t=y1-oDD.padding[0];r=x2+oDD.padding[1];b=y2+oDD.padding[2];l=x1-oDD.padding[3];return new YAHOO.util.Region(t,r,b,l);},isOverTarget:function(pt,oTarget,intersect,curRegion){var loc=this.locationCache[oTarget.id];if(!loc||!this.useCache){loc=this.getLocation(oTarget);this.locationCache[oTarget.id]=loc;}
if(!loc){return false;}
oTarget.cursorIsOver=loc.contains(pt);var dc=this.dragCurrent;if(!dc||(!intersect&&!dc.constrainX&&!dc.constrainY)){return oTarget.cursorIsOver;}
oTarget.overlap=null;if(!curRegion){var pos=dc.getTargetCoord(pt.x,pt.y);var el=dc.getDragEl();curRegion=new YAHOO.util.Region(pos.y,pos.x+el.offsetWidth,pos.y+el.offsetHeight,pos.x);}
var overlap=curRegion.intersect(loc);if(overlap){oTarget.overlap=overlap;return(intersect)?true:oTarget.cursorIsOver;}else{return false;}},_onUnload:function(e,me){this.unregAll();},unregAll:function(){if(this.dragCurrent){this.stopDrag();this.dragCurrent=null;}
this._execOnAll("unreg",[]);this.ids={};},elementCache:{},getElWrapper:function(id){var oWrapper=this.elementCache[id];if(!oWrapper||!oWrapper.el){oWrapper=this.elementCache[id]=new this.ElementWrapper(YAHOO.util.Dom.get(id));}
return oWrapper;},getElement:function(id){return YAHOO.util.Dom.get(id);},getCss:function(id){var el=YAHOO.util.Dom.get(id);return(el)?el.style:null;},ElementWrapper:function(el){this.el=el||null;this.id=this.el&&el.id;this.css=this.el&&el.style;},getPosX:function(el){return YAHOO.util.Dom.getX(el);},getPosY:function(el){return YAHOO.util.Dom.getY(el);},swapNode:function(n1,n2){if(n1.swapNode){n1.swapNode(n2);}else{var p=n2.parentNode;var s=n2.nextSibling;if(s==n1){p.insertBefore(n1,n2);}else if(n2==n1.nextSibling){p.insertBefore(n2,n1);}else{n1.parentNode.replaceChild(n2,n1);p.insertBefore(n1,s);}}},getScroll:function(){var t,l,dde=document.documentElement,db=document.body;if(dde&&(dde.scrollTop||dde.scrollLeft)){t=dde.scrollTop;l=dde.scrollLeft;}else if(db){t=db.scrollTop;l=db.scrollLeft;}else{}
return{top:t,left:l};},getStyle:function(el,styleProp){return YAHOO.util.Dom.getStyle(el,styleProp);},getScrollTop:function(){return this.getScroll().top;},getScrollLeft:function(){return this.getScroll().left;},moveToEl:function(moveEl,targetEl){var aCoord=YAHOO.util.Dom.getXY(targetEl);YAHOO.util.Dom.setXY(moveEl,aCoord);},getClientHeight:function(){return YAHOO.util.Dom.getViewportHeight();},getClientWidth:function(){return YAHOO.util.Dom.getViewportWidth();},numericSort:function(a,b){return(a-b);},_timeoutCount:0,_addListeners:function(){var DDM=YAHOO.util.DDM;if(YAHOO.util.Event&&document){DDM._onLoad();}else{if(DDM._timeoutCount>2000){}else{setTimeout(DDM._addListeners,10);if(document&&document.body){DDM._timeoutCount+=1;}}}},handleWasClicked:function(node,id){if(this.isHandle(id,node.id)){return true;}else{var p=node.parentNode;while(p){if(this.isHandle(id,p.id)){return true;}else{p=p.parentNode;}}}
return false;}};}();YAHOO.util.DDM=YAHOO.util.DragDropMgr;YAHOO.util.DDM._addListeners();}
(function(){var Event=YAHOO.util.Event;var Dom=YAHOO.util.Dom;YAHOO.util.DragDrop=function(id,sGroup,config){if(id){this.init(id,sGroup,config);}};YAHOO.util.DragDrop.prototype={events:null,on:function(){this.subscribe.apply(this,arguments);},id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:false,lock:function(){this.locked=true;},unlock:function(){this.locked=false;},isTarget:true,padding:null,dragOnly:false,_domRef:null,__ygDragDrop:true,constrainX:false,constrainY:false,minX:0,maxX:0,minY:0,maxY:0,deltaX:0,deltaY:0,maintainOffset:false,xTicks:null,yTicks:null,primaryButtonOnly:true,available:false,hasOuterHandles:false,cursorIsOver:false,overlap:null,b4StartDrag:function(x,y){},startDrag:function(x,y){},b4Drag:function(e){},onDrag:function(e){},onDragEnter:function(e,id){},b4DragOver:function(e){},onDragOver:function(e,id){},b4DragOut:function(e){},onDragOut:function(e,id){},b4DragDrop:function(e){},onDragDrop:function(e,id){},onInvalidDrop:function(e){},b4EndDrag:function(e){},endDrag:function(e){},b4MouseDown:function(e){},onMouseDown:function(e){},onMouseUp:function(e){},onAvailable:function(){},getEl:function(){if(!this._domRef){this._domRef=Dom.get(this.id);}
return this._domRef;},getDragEl:function(){return Dom.get(this.dragElId);},init:function(id,sGroup,config){this.initTarget(id,sGroup,config);Event.on(this._domRef||this.id,"mousedown",this.handleMouseDown,this,true);for(var i in this.events){this.createEvent(i+'Event');}},initTarget:function(id,sGroup,config){this.config=config||{};this.events={};this.DDM=YAHOO.util.DDM;this.groups={};if(typeof id!=="string"){this._domRef=id;id=Dom.generateId(id);}
this.id=id;this.addToGroup((sGroup)?sGroup:"default");this.handleElId=id;Event.onAvailable(id,this.handleOnAvailable,this,true);this.setDragElId(id);this.invalidHandleTypes={A:"A"};this.invalidHandleIds={};this.invalidHandleClasses=[];this.applyConfig();},applyConfig:function(){this.events={mouseDown:true,b4MouseDown:true,mouseUp:true,b4StartDrag:true,startDrag:true,b4EndDrag:true,endDrag:true,drag:true,b4Drag:true,invalidDrop:true,b4DragOut:true,dragOut:true,dragEnter:true,b4DragOver:true,dragOver:true,b4DragDrop:true,dragDrop:true};if(this.config.events){for(var i in this.config.events){if(this.config.events[i]===false){this.events[i]=false;}}}
this.padding=this.config.padding||[0,0,0,0];this.isTarget=(this.config.isTarget!==false);this.maintainOffset=(this.config.maintainOffset);this.primaryButtonOnly=(this.config.primaryButtonOnly!==false);this.dragOnly=((this.config.dragOnly===true)?true:false);},handleOnAvailable:function(){this.available=true;this.resetConstraints();this.onAvailable();},setPadding:function(iTop,iRight,iBot,iLeft){if(!iRight&&0!==iRight){this.padding=[iTop,iTop,iTop,iTop];}else if(!iBot&&0!==iBot){this.padding=[iTop,iRight,iTop,iRight];}else{this.padding=[iTop,iRight,iBot,iLeft];}},setInitPosition:function(diffX,diffY){var el=this.getEl();if(!this.DDM.verifyEl(el)){if(el&&el.style&&(el.style.display=='none')){}else{}
return;}
var dx=diffX||0;var dy=diffY||0;var p=Dom.getXY(el);this.initPageX=p[0]-dx;this.initPageY=p[1]-dy;this.lastPageX=p[0];this.lastPageY=p[1];this.setStartPosition(p);},setStartPosition:function(pos){var p=pos||Dom.getXY(this.getEl());this.deltaSetXY=null;this.startPageX=p[0];this.startPageY=p[1];},addToGroup:function(sGroup){this.groups[sGroup]=true;this.DDM.regDragDrop(this,sGroup);},removeFromGroup:function(sGroup){if(this.groups[sGroup]){delete this.groups[sGroup];}
this.DDM.removeDDFromGroup(this,sGroup);},setDragElId:function(id){this.dragElId=id;},setHandleElId:function(id){if(typeof id!=="string"){id=Dom.generateId(id);}
this.handleElId=id;this.DDM.regHandle(this.id,id);},setOuterHandleElId:function(id){if(typeof id!=="string"){id=Dom.generateId(id);}
Event.on(id,"mousedown",this.handleMouseDown,this,true);this.setHandleElId(id);this.hasOuterHandles=true;},unreg:function(){Event.removeListener(this.id,"mousedown",this.handleMouseDown);this._domRef=null;this.DDM._remove(this);},isLocked:function(){return(this.DDM.isLocked()||this.locked);},handleMouseDown:function(e,oDD){var button=e.which||e.button;if(this.primaryButtonOnly&&button>1){return;}
if(this.isLocked()){return;}
var b4Return=this.b4MouseDown(e);if(this.events.b4MouseDown){b4Return=this.fireEvent('b4MouseDownEvent',e);}
var mDownReturn=this.onMouseDown(e);if(this.events.mouseDown){mDownReturn=this.fireEvent('mouseDownEvent',e);}
if((b4Return===false)||(mDownReturn===false)){return;}
this.DDM.refreshCache(this.groups);var pt=new YAHOO.util.Point(Event.getPageX(e),Event.getPageY(e));if(!this.hasOuterHandles&&!this.DDM.isOverTarget(pt,this)){}else{if(this.clickValidator(e)){this.setStartPosition();this.DDM.handleMouseDown(e,this);this.DDM.stopEvent(e);}else{}}},clickValidator:function(e){var target=YAHOO.util.Event.getTarget(e);return(this.isValidHandleChild(target)&&(this.id==this.handleElId||this.DDM.handleWasClicked(target,this.id)));},getTargetCoord:function(iPageX,iPageY){var x=iPageX-this.deltaX;var y=iPageY-this.deltaY;if(this.constrainX){if(x<this.minX){x=this.minX;}
if(x>this.maxX){x=this.maxX;}}
if(this.constrainY){if(y<this.minY){y=this.minY;}
if(y>this.maxY){y=this.maxY;}}
x=this.getTick(x,this.xTicks);y=this.getTick(y,this.yTicks);return{x:x,y:y};},addInvalidHandleType:function(tagName){var type=tagName.toUpperCase();this.invalidHandleTypes[type]=type;},addInvalidHandleId:function(id){if(typeof id!=="string"){id=Dom.generateId(id);}
this.invalidHandleIds[id]=id;},addInvalidHandleClass:function(cssClass){this.invalidHandleClasses.push(cssClass);},removeInvalidHandleType:function(tagName){var type=tagName.toUpperCase();delete this.invalidHandleTypes[type];},removeInvalidHandleId:function(id){if(typeof id!=="string"){id=Dom.generateId(id);}
delete this.invalidHandleIds[id];},removeInvalidHandleClass:function(cssClass){for(var i=0,len=this.invalidHandleClasses.length;i<len;++i){if(this.invalidHandleClasses[i]==cssClass){delete this.invalidHandleClasses[i];}}},isValidHandleChild:function(node){var valid=true;var nodeName;try{nodeName=node.nodeName.toUpperCase();}catch(e){nodeName=node.nodeName;}
valid=valid&&!this.invalidHandleTypes[nodeName];valid=valid&&!this.invalidHandleIds[node.id];for(var i=0,len=this.invalidHandleClasses.length;valid&&i<len;++i){valid=!Dom.hasClass(node,this.invalidHandleClasses[i]);}
return valid;},setXTicks:function(iStartX,iTickSize){this.xTicks=[];this.xTickSize=iTickSize;var tickMap={};for(var i=this.initPageX;i>=this.minX;i=i-iTickSize){if(!tickMap[i]){this.xTicks[this.xTicks.length]=i;tickMap[i]=true;}}
for(i=this.initPageX;i<=this.maxX;i=i+iTickSize){if(!tickMap[i]){this.xTicks[this.xTicks.length]=i;tickMap[i]=true;}}
this.xTicks.sort(this.DDM.numericSort);},setYTicks:function(iStartY,iTickSize){this.yTicks=[];this.yTickSize=iTickSize;var tickMap={};for(var i=this.initPageY;i>=this.minY;i=i-iTickSize){if(!tickMap[i]){this.yTicks[this.yTicks.length]=i;tickMap[i]=true;}}
for(i=this.initPageY;i<=this.maxY;i=i+iTickSize){if(!tickMap[i]){this.yTicks[this.yTicks.length]=i;tickMap[i]=true;}}
this.yTicks.sort(this.DDM.numericSort);},setXConstraint:function(iLeft,iRight,iTickSize){this.leftConstraint=parseInt(iLeft,10);this.rightConstraint=parseInt(iRight,10);this.minX=this.initPageX-this.leftConstraint;this.maxX=this.initPageX+this.rightConstraint;if(iTickSize){this.setXTicks(this.initPageX,iTickSize);}
this.constrainX=true;},clearConstraints:function(){this.constrainX=false;this.constrainY=false;this.clearTicks();},clearTicks:function(){this.xTicks=null;this.yTicks=null;this.xTickSize=0;this.yTickSize=0;},setYConstraint:function(iUp,iDown,iTickSize){this.topConstraint=parseInt(iUp,10);this.bottomConstraint=parseInt(iDown,10);this.minY=this.initPageY-this.topConstraint;this.maxY=this.initPageY+this.bottomConstraint;if(iTickSize){this.setYTicks(this.initPageY,iTickSize);}
this.constrainY=true;},resetConstraints:function(){if(this.initPageX||this.initPageX===0){var dx=(this.maintainOffset)?this.lastPageX-this.initPageX:0;var dy=(this.maintainOffset)?this.lastPageY-this.initPageY:0;this.setInitPosition(dx,dy);}else{this.setInitPosition();}
if(this.constrainX){this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize);}
if(this.constrainY){this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize);}},getTick:function(val,tickArray){if(!tickArray){return val;}else if(tickArray[0]>=val){return tickArray[0];}else{for(var i=0,len=tickArray.length;i<len;++i){var next=i+1;if(tickArray[next]&&tickArray[next]>=val){var diff1=val-tickArray[i];var diff2=tickArray[next]-val;return(diff2>diff1)?tickArray[i]:tickArray[next];}}
return tickArray[tickArray.length-1];}},toString:function(){return("DragDrop "+this.id);}};YAHOO.augment(YAHOO.util.DragDrop,YAHOO.util.EventProvider);})();YAHOO.util.DD=function(id,sGroup,config){if(id){this.init(id,sGroup,config);}};YAHOO.extend(YAHOO.util.DD,YAHOO.util.DragDrop,{scroll:true,autoOffset:function(iPageX,iPageY){var x=iPageX-this.startPageX;var y=iPageY-this.startPageY;this.setDelta(x,y);},setDelta:function(iDeltaX,iDeltaY){this.deltaX=iDeltaX;this.deltaY=iDeltaY;},setDragElPos:function(iPageX,iPageY){var el=this.getDragEl();this.alignElWithMouse(el,iPageX,iPageY);},alignElWithMouse:function(el,iPageX,iPageY){var oCoord=this.getTargetCoord(iPageX,iPageY);if(!this.deltaSetXY){var aCoord=[oCoord.x,oCoord.y];YAHOO.util.Dom.setXY(el,aCoord);var newLeft=parseInt(YAHOO.util.Dom.getStyle(el,"left"),10);var newTop=parseInt(YAHOO.util.Dom.getStyle(el,"top"),10);this.deltaSetXY=[newLeft-oCoord.x,newTop-oCoord.y];}else{YAHOO.util.Dom.setStyle(el,"left",(oCoord.x+this.deltaSetXY[0])+"px");YAHOO.util.Dom.setStyle(el,"top",(oCoord.y+this.deltaSetXY[1])+"px");}
this.cachePosition(oCoord.x,oCoord.y);var self=this;setTimeout(function(){self.autoScroll.call(self,oCoord.x,oCoord.y,el.offsetHeight,el.offsetWidth);},0);},cachePosition:function(iPageX,iPageY){if(iPageX){this.lastPageX=iPageX;this.lastPageY=iPageY;}else{var aCoord=YAHOO.util.Dom.getXY(this.getEl());this.lastPageX=aCoord[0];this.lastPageY=aCoord[1];}},autoScroll:function(x,y,h,w){if(this.scroll){var clientH=this.DDM.getClientHeight();var clientW=this.DDM.getClientWidth();var st=this.DDM.getScrollTop();var sl=this.DDM.getScrollLeft();var bot=h+y;var right=w+x;var toBot=(clientH+st-y-this.deltaY);var toRight=(clientW+sl-x-this.deltaX);var thresh=40;var scrAmt=(document.all)?80:30;if(bot>clientH&&toBot<thresh){window.scrollTo(sl,st+scrAmt);}
if(y<st&&st>0&&y-st<thresh){window.scrollTo(sl,st-scrAmt);}
if(right>clientW&&toRight<thresh){window.scrollTo(sl+scrAmt,st);}
if(x<sl&&sl>0&&x-sl<thresh){window.scrollTo(sl-scrAmt,st);}}},applyConfig:function(){YAHOO.util.DD.superclass.applyConfig.call(this);this.scroll=(this.config.scroll!==false);},b4MouseDown:function(e){this.setStartPosition();this.autoOffset(YAHOO.util.Event.getPageX(e),YAHOO.util.Event.getPageY(e));},b4Drag:function(e){this.setDragElPos(YAHOO.util.Event.getPageX(e),YAHOO.util.Event.getPageY(e));},toString:function(){return("DD "+this.id);}});YAHOO.util.DDProxy=function(id,sGroup,config){if(id){this.init(id,sGroup,config);this.initFrame();}};YAHOO.util.DDProxy.dragElId="ygddfdiv";YAHOO.extend(YAHOO.util.DDProxy,YAHOO.util.DD,{resizeFrame:true,centerFrame:false,createFrame:function(){var self=this,body=document.body;if(!body||!body.firstChild){setTimeout(function(){self.createFrame();},50);return;}
var div=this.getDragEl(),Dom=YAHOO.util.Dom;if(!div){div=document.createElement("div");div.id=this.dragElId;var s=div.style;s.position="absolute";s.visibility="hidden";s.cursor="move";s.border="2px solid #aaa";s.zIndex=999;s.height="25px";s.width="25px";var _data=document.createElement('div');Dom.setStyle(_data,'height','100%');Dom.setStyle(_data,'width','100%');Dom.setStyle(_data,'background-color','#ccc');Dom.setStyle(_data,'opacity','0');div.appendChild(_data);if(YAHOO.env.ua.ie){var ifr=document.createElement('iframe');ifr.setAttribute('src','javascript:');ifr.setAttribute('scrolling','no');ifr.setAttribute('frameborder','0');div.insertBefore(ifr,div.firstChild);Dom.setStyle(ifr,'height','100%');Dom.setStyle(ifr,'width','100%');Dom.setStyle(ifr,'position','absolute');Dom.setStyle(ifr,'top','0');Dom.setStyle(ifr,'left','0');Dom.setStyle(ifr,'opacity','0');Dom.setStyle(ifr,'zIndex','-1');Dom.setStyle(ifr.nextSibling,'zIndex','2');}
body.insertBefore(div,body.firstChild);}},initFrame:function(){this.createFrame();},applyConfig:function(){YAHOO.util.DDProxy.superclass.applyConfig.call(this);this.resizeFrame=(this.config.resizeFrame!==false);this.centerFrame=(this.config.centerFrame);this.setDragElId(this.config.dragElId||YAHOO.util.DDProxy.dragElId);},showFrame:function(iPageX,iPageY){var el=this.getEl();var dragEl=this.getDragEl();var s=dragEl.style;this._resizeProxy();if(this.centerFrame){this.setDelta(Math.round(parseInt(s.width,10)/2),Math.round(parseInt(s.height,10)/2));}
this.setDragElPos(iPageX,iPageY);YAHOO.util.Dom.setStyle(dragEl,"visibility","visible");},_resizeProxy:function(){if(this.resizeFrame){var DOM=YAHOO.util.Dom;var el=this.getEl();var dragEl=this.getDragEl();var bt=parseInt(DOM.getStyle(dragEl,"borderTopWidth"),10);var br=parseInt(DOM.getStyle(dragEl,"borderRightWidth"),10);var bb=parseInt(DOM.getStyle(dragEl,"borderBottomWidth"),10);var bl=parseInt(DOM.getStyle(dragEl,"borderLeftWidth"),10);if(isNaN(bt)){bt=0;}
if(isNaN(br)){br=0;}
if(isNaN(bb)){bb=0;}
if(isNaN(bl)){bl=0;}
var newWidth=Math.max(0,el.offsetWidth-br-bl);var newHeight=Math.max(0,el.offsetHeight-bt-bb);DOM.setStyle(dragEl,"width",newWidth+"px");DOM.setStyle(dragEl,"height",newHeight+"px");}},b4MouseDown:function(e){this.setStartPosition();var x=YAHOO.util.Event.getPageX(e);var y=YAHOO.util.Event.getPageY(e);this.autoOffset(x,y);},b4StartDrag:function(x,y){this.showFrame(x,y);},b4EndDrag:function(e){YAHOO.util.Dom.setStyle(this.getDragEl(),"visibility","hidden");},endDrag:function(e){var DOM=YAHOO.util.Dom;var lel=this.getEl();var del=this.getDragEl();DOM.setStyle(del,"visibility","");DOM.setStyle(lel,"visibility","hidden");YAHOO.util.DDM.moveToEl(lel,del);DOM.setStyle(del,"visibility","hidden");DOM.setStyle(lel,"visibility","");},toString:function(){return("DDProxy "+this.id);}});YAHOO.util.DDTarget=function(id,sGroup,config){if(id){this.initTarget(id,sGroup,config);}};YAHOO.extend(YAHOO.util.DDTarget,YAHOO.util.DragDrop,{toString:function(){return("DDTarget "+this.id);}});YAHOO.register("dragdrop",YAHOO.util.DragDropMgr,{version:"2.5.2",build:"1076"});

(function(){YAHOO.util.Config=function(owner){if(owner){this.init(owner);}};var Lang=YAHOO.lang,CustomEvent=YAHOO.util.CustomEvent,Config=YAHOO.util.Config;Config.CONFIG_CHANGED_EVENT="configChanged";Config.BOOLEAN_TYPE="boolean";Config.prototype={owner:null,queueInProgress:false,config:null,initialConfig:null,eventQueue:null,configChangedEvent:null,init:function(owner){this.owner=owner;this.configChangedEvent=this.createEvent(Config.CONFIG_CHANGED_EVENT);this.configChangedEvent.signature=CustomEvent.LIST;this.queueInProgress=false;this.config={};this.initialConfig={};this.eventQueue=[];},checkBoolean:function(val){return(typeof val==Config.BOOLEAN_TYPE);},checkNumber:function(val){return(!isNaN(val));},fireEvent:function(key,value){var property=this.config[key];if(property&&property.event){property.event.fire(value);}},addProperty:function(key,propertyObject){key=key.toLowerCase();this.config[key]=propertyObject;propertyObject.event=this.createEvent(key,{scope:this.owner});propertyObject.event.signature=CustomEvent.LIST;propertyObject.key=key;if(propertyObject.handler){propertyObject.event.subscribe(propertyObject.handler,this.owner);}
this.setProperty(key,propertyObject.value,true);if(!propertyObject.suppressEvent){this.queueProperty(key,propertyObject.value);}},getConfig:function(){var cfg={},prop,property;for(prop in this.config){property=this.config[prop];if(property&&property.event){cfg[prop]=property.value;}}
return cfg;},getProperty:function(key){var property=this.config[key.toLowerCase()];if(property&&property.event){return property.value;}else{return undefined;}},resetProperty:function(key){key=key.toLowerCase();var property=this.config[key];if(property&&property.event){if(this.initialConfig[key]&&!Lang.isUndefined(this.initialConfig[key])){this.setProperty(key,this.initialConfig[key]);return true;}}else{return false;}},setProperty:function(key,value,silent){var property;key=key.toLowerCase();if(this.queueInProgress&&!silent){this.queueProperty(key,value);return true;}else{property=this.config[key];if(property&&property.event){if(property.validator&&!property.validator(value)){return false;}else{property.value=value;if(!silent){this.fireEvent(key,value);this.configChangedEvent.fire([key,value]);}
return true;}}else{return false;}}},queueProperty:function(key,value){key=key.toLowerCase();var property=this.config[key],foundDuplicate=false,iLen,queueItem,queueItemKey,queueItemValue,sLen,supercedesCheck,qLen,queueItemCheck,queueItemCheckKey,queueItemCheckValue,i,s,q;if(property&&property.event){if(!Lang.isUndefined(value)&&property.validator&&!property.validator(value)){return false;}else{if(!Lang.isUndefined(value)){property.value=value;}else{value=property.value;}
foundDuplicate=false;iLen=this.eventQueue.length;for(i=0;i<iLen;i++){queueItem=this.eventQueue[i];if(queueItem){queueItemKey=queueItem[0];queueItemValue=queueItem[1];if(queueItemKey==key){this.eventQueue[i]=null;this.eventQueue.push([key,(!Lang.isUndefined(value)?value:queueItemValue)]);foundDuplicate=true;break;}}}
if(!foundDuplicate&&!Lang.isUndefined(value)){this.eventQueue.push([key,value]);}}
if(property.supercedes){sLen=property.supercedes.length;for(s=0;s<sLen;s++){supercedesCheck=property.supercedes[s];qLen=this.eventQueue.length;for(q=0;q<qLen;q++){queueItemCheck=this.eventQueue[q];if(queueItemCheck){queueItemCheckKey=queueItemCheck[0];queueItemCheckValue=queueItemCheck[1];if(queueItemCheckKey==supercedesCheck.toLowerCase()){this.eventQueue.push([queueItemCheckKey,queueItemCheckValue]);this.eventQueue[q]=null;break;}}}}}
return true;}else{return false;}},refireEvent:function(key){key=key.toLowerCase();var property=this.config[key];if(property&&property.event&&!Lang.isUndefined(property.value)){if(this.queueInProgress){this.queueProperty(key);}else{this.fireEvent(key,property.value);}}},applyConfig:function(userConfig,init){var sKey,oConfig;if(init){oConfig={};for(sKey in userConfig){if(Lang.hasOwnProperty(userConfig,sKey)){oConfig[sKey.toLowerCase()]=userConfig[sKey];}}
this.initialConfig=oConfig;}
for(sKey in userConfig){if(Lang.hasOwnProperty(userConfig,sKey)){this.queueProperty(sKey,userConfig[sKey]);}}},refresh:function(){var prop;for(prop in this.config){this.refireEvent(prop);}},fireQueue:function(){var i,queueItem,key,value,property;this.queueInProgress=true;for(i=0;i<this.eventQueue.length;i++){queueItem=this.eventQueue[i];if(queueItem){key=queueItem[0];value=queueItem[1];property=this.config[key];property.value=value;this.fireEvent(key,value);}}
this.queueInProgress=false;this.eventQueue=[];},subscribeToConfigEvent:function(key,handler,obj,override){var property=this.config[key.toLowerCase()];if(property&&property.event){if(!Config.alreadySubscribed(property.event,handler,obj)){property.event.subscribe(handler,obj,override);}
return true;}else{return false;}},unsubscribeFromConfigEvent:function(key,handler,obj){var property=this.config[key.toLowerCase()];if(property&&property.event){return property.event.unsubscribe(handler,obj);}else{return false;}},toString:function(){var output="Config";if(this.owner){output+=" ["+this.owner.toString()+"]";}
return output;},outputEventQueue:function(){var output="",queueItem,q,nQueue=this.eventQueue.length;for(q=0;q<nQueue;q++){queueItem=this.eventQueue[q];if(queueItem){output+=queueItem[0]+"="+queueItem[1]+", ";}}
return output;},destroy:function(){var oConfig=this.config,sProperty,oProperty;for(sProperty in oConfig){if(Lang.hasOwnProperty(oConfig,sProperty)){oProperty=oConfig[sProperty];oProperty.event.unsubscribeAll();oProperty.event=null;}}
this.configChangedEvent.unsubscribeAll();this.configChangedEvent=null;this.owner=null;this.config=null;this.initialConfig=null;this.eventQueue=null;}};Config.alreadySubscribed=function(evt,fn,obj){var nSubscribers=evt.subscribers.length,subsc,i;if(nSubscribers>0){i=nSubscribers-1;do{subsc=evt.subscribers[i];if(subsc&&subsc.obj==obj&&subsc.fn==fn){return true;}}
while(i--);}
return false;};YAHOO.lang.augmentProto(Config,YAHOO.util.EventProvider);}());(function(){YAHOO.widget.Module=function(el,userConfig){if(el){this.init(el,userConfig);}else{}};var Dom=YAHOO.util.Dom,Config=YAHOO.util.Config,Event=YAHOO.util.Event,CustomEvent=YAHOO.util.CustomEvent,Module=YAHOO.widget.Module,m_oModuleTemplate,m_oHeaderTemplate,m_oBodyTemplate,m_oFooterTemplate,EVENT_TYPES={"BEFORE_INIT":"beforeInit","INIT":"init","APPEND":"append","BEFORE_RENDER":"beforeRender","RENDER":"render","CHANGE_HEADER":"changeHeader","CHANGE_BODY":"changeBody","CHANGE_FOOTER":"changeFooter","CHANGE_CONTENT":"changeContent","DESTORY":"destroy","BEFORE_SHOW":"beforeShow","SHOW":"show","BEFORE_HIDE":"beforeHide","HIDE":"hide"},DEFAULT_CONFIG={"VISIBLE":{key:"visible",value:true,validator:YAHOO.lang.isBoolean},"EFFECT":{key:"effect",suppressEvent:true,supercedes:["visible"]},"MONITOR_RESIZE":{key:"monitorresize",value:true},"APPEND_TO_DOCUMENT_BODY":{key:"appendtodocumentbody",value:false}};Module.IMG_ROOT=null;Module.IMG_ROOT_SSL=null;Module.CSS_MODULE="yui-module";Module.CSS_HEADER="hd";Module.CSS_BODY="bd";Module.CSS_FOOTER="ft";Module.RESIZE_MONITOR_SECURE_URL="javascript:false;";Module.textResizeEvent=new CustomEvent("textResize");function createModuleTemplate(){if(!m_oModuleTemplate){m_oModuleTemplate=document.createElement("div");m_oModuleTemplate.innerHTML=("<div class=\""+
Module.CSS_HEADER+"\"></div>"+"<div class=\""+
Module.CSS_BODY+"\"></div><div class=\""+
Module.CSS_FOOTER+"\"></div>");m_oHeaderTemplate=m_oModuleTemplate.firstChild;m_oBodyTemplate=m_oHeaderTemplate.nextSibling;m_oFooterTemplate=m_oBodyTemplate.nextSibling;}
return m_oModuleTemplate;}
function createHeader(){if(!m_oHeaderTemplate){createModuleTemplate();}
return(m_oHeaderTemplate.cloneNode(false));}
function createBody(){if(!m_oBodyTemplate){createModuleTemplate();}
return(m_oBodyTemplate.cloneNode(false));}
function createFooter(){if(!m_oFooterTemplate){createModuleTemplate();}
return(m_oFooterTemplate.cloneNode(false));}
Module.prototype={constructor:Module,element:null,header:null,body:null,footer:null,id:null,imageRoot:Module.IMG_ROOT,initEvents:function(){var SIGNATURE=CustomEvent.LIST;this.beforeInitEvent=this.createEvent(EVENT_TYPES.BEFORE_INIT);this.beforeInitEvent.signature=SIGNATURE;this.initEvent=this.createEvent(EVENT_TYPES.INIT);this.initEvent.signature=SIGNATURE;this.appendEvent=this.createEvent(EVENT_TYPES.APPEND);this.appendEvent.signature=SIGNATURE;this.beforeRenderEvent=this.createEvent(EVENT_TYPES.BEFORE_RENDER);this.beforeRenderEvent.signature=SIGNATURE;this.renderEvent=this.createEvent(EVENT_TYPES.RENDER);this.renderEvent.signature=SIGNATURE;this.changeHeaderEvent=this.createEvent(EVENT_TYPES.CHANGE_HEADER);this.changeHeaderEvent.signature=SIGNATURE;this.changeBodyEvent=this.createEvent(EVENT_TYPES.CHANGE_BODY);this.changeBodyEvent.signature=SIGNATURE;this.changeFooterEvent=this.createEvent(EVENT_TYPES.CHANGE_FOOTER);this.changeFooterEvent.signature=SIGNATURE;this.changeContentEvent=this.createEvent(EVENT_TYPES.CHANGE_CONTENT);this.changeContentEvent.signature=SIGNATURE;this.destroyEvent=this.createEvent(EVENT_TYPES.DESTORY);this.destroyEvent.signature=SIGNATURE;this.beforeShowEvent=this.createEvent(EVENT_TYPES.BEFORE_SHOW);this.beforeShowEvent.signature=SIGNATURE;this.showEvent=this.createEvent(EVENT_TYPES.SHOW);this.showEvent.signature=SIGNATURE;this.beforeHideEvent=this.createEvent(EVENT_TYPES.BEFORE_HIDE);this.beforeHideEvent.signature=SIGNATURE;this.hideEvent=this.createEvent(EVENT_TYPES.HIDE);this.hideEvent.signature=SIGNATURE;},platform:function(){var ua=navigator.userAgent.toLowerCase();if(ua.indexOf("windows")!=-1||ua.indexOf("win32")!=-1){return"windows";}else if(ua.indexOf("macintosh")!=-1){return"mac";}else{return false;}}(),browser:function(){var ua=navigator.userAgent.toLowerCase();if(ua.indexOf('opera')!=-1){return'opera';}else if(ua.indexOf('msie 7')!=-1){return'ie7';}else if(ua.indexOf('msie')!=-1){return'ie';}else if(ua.indexOf('safari')!=-1){return'safari';}else if(ua.indexOf('gecko')!=-1){return'gecko';}else{return false;}}(),isSecure:function(){if(window.location.href.toLowerCase().indexOf("https")===0){return true;}else{return false;}}(),initDefaultConfig:function(){this.cfg.addProperty(DEFAULT_CONFIG.VISIBLE.key,{handler:this.configVisible,value:DEFAULT_CONFIG.VISIBLE.value,validator:DEFAULT_CONFIG.VISIBLE.validator});this.cfg.addProperty(DEFAULT_CONFIG.EFFECT.key,{suppressEvent:DEFAULT_CONFIG.EFFECT.suppressEvent,supercedes:DEFAULT_CONFIG.EFFECT.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.MONITOR_RESIZE.key,{handler:this.configMonitorResize,value:DEFAULT_CONFIG.MONITOR_RESIZE.value});this.cfg.addProperty(DEFAULT_CONFIG.APPEND_TO_DOCUMENT_BODY.key,{value:DEFAULT_CONFIG.APPEND_TO_DOCUMENT_BODY.value});},init:function(el,userConfig){var elId,child;this.initEvents();this.beforeInitEvent.fire(Module);this.cfg=new Config(this);if(this.isSecure){this.imageRoot=Module.IMG_ROOT_SSL;}
if(typeof el=="string"){elId=el;el=document.getElementById(el);if(!el){el=(createModuleTemplate()).cloneNode(false);el.id=elId;}}
this.element=el;if(el.id){this.id=el.id;}
child=this.element.firstChild;if(child){var fndHd=false,fndBd=false,fndFt=false;do{if(1==child.nodeType){if(!fndHd&&Dom.hasClass(child,Module.CSS_HEADER)){this.header=child;fndHd=true;}else if(!fndBd&&Dom.hasClass(child,Module.CSS_BODY)){this.body=child;fndBd=true;}else if(!fndFt&&Dom.hasClass(child,Module.CSS_FOOTER)){this.footer=child;fndFt=true;}}}while((child=child.nextSibling));}
this.initDefaultConfig();Dom.addClass(this.element,Module.CSS_MODULE);if(userConfig){this.cfg.applyConfig(userConfig,true);}
if(!Config.alreadySubscribed(this.renderEvent,this.cfg.fireQueue,this.cfg)){this.renderEvent.subscribe(this.cfg.fireQueue,this.cfg,true);}
this.initEvent.fire(Module);},initResizeMonitor:function(){var isGeckoWin=(YAHOO.env.ua.gecko&&this.platform=="windows");if(isGeckoWin){var self=this;setTimeout(function(){self._initResizeMonitor();},0);}else{this._initResizeMonitor();}},_initResizeMonitor:function(){var oDoc,oIFrame,sHTML;function fireTextResize(){Module.textResizeEvent.fire();}
if(!YAHOO.env.ua.opera){oIFrame=Dom.get("_yuiResizeMonitor");var supportsCWResize=this._supportsCWResize();if(!oIFrame){oIFrame=document.createElement("iframe");if(this.isSecure&&Module.RESIZE_MONITOR_SECURE_URL&&YAHOO.env.ua.ie){oIFrame.src=Module.RESIZE_MONITOR_SECURE_URL;}
if(!supportsCWResize){sHTML=["<html><head><script ","type=\"text/javascript\">","window.onresize=function(){window.parent.","YAHOO.widget.Module.textResizeEvent.","fire();};<","\/script></head>","<body></body></html>"].join('');oIFrame.src="data:text/html;charset=utf-8,"+encodeURIComponent(sHTML);}
oIFrame.id="_yuiResizeMonitor";oIFrame.style.position="absolute";oIFrame.style.visibility="hidden";var db=document.body,fc=db.firstChild;if(fc){db.insertBefore(oIFrame,fc);}else{db.appendChild(oIFrame);}
oIFrame.style.width="10em";oIFrame.style.height="10em";oIFrame.style.top=(-1*oIFrame.offsetHeight)+"px";oIFrame.style.left=(-1*oIFrame.offsetWidth)+"px";oIFrame.style.borderWidth="0";oIFrame.style.visibility="visible";if(YAHOO.env.ua.webkit){oDoc=oIFrame.contentWindow.document;oDoc.open();oDoc.close();}}
if(oIFrame&&oIFrame.contentWindow){Module.textResizeEvent.subscribe(this.onDomResize,this,true);if(!Module.textResizeInitialized){if(supportsCWResize){if(!Event.on(oIFrame.contentWindow,"resize",fireTextResize)){Event.on(oIFrame,"resize",fireTextResize);}}
Module.textResizeInitialized=true;}
this.resizeMonitor=oIFrame;}}},_supportsCWResize:function(){var bSupported=true;if(YAHOO.env.ua.gecko&&YAHOO.env.ua.gecko<=1.8){bSupported=false;}
return bSupported;},onDomResize:function(e,obj){var nLeft=-1*this.resizeMonitor.offsetWidth,nTop=-1*this.resizeMonitor.offsetHeight;this.resizeMonitor.style.top=nTop+"px";this.resizeMonitor.style.left=nLeft+"px";},setHeader:function(headerContent){var oHeader=this.header||(this.header=createHeader());if(headerContent.nodeName){oHeader.innerHTML="";oHeader.appendChild(headerContent);}else{oHeader.innerHTML=headerContent;}
this.changeHeaderEvent.fire(headerContent);this.changeContentEvent.fire();},appendToHeader:function(element){var oHeader=this.header||(this.header=createHeader());oHeader.appendChild(element);this.changeHeaderEvent.fire(element);this.changeContentEvent.fire();},setBody:function(bodyContent){var oBody=this.body||(this.body=createBody());if(bodyContent.nodeName){oBody.innerHTML="";oBody.appendChild(bodyContent);}else{oBody.innerHTML=bodyContent;}
this.changeBodyEvent.fire(bodyContent);this.changeContentEvent.fire();},appendToBody:function(element){var oBody=this.body||(this.body=createBody());oBody.appendChild(element);this.changeBodyEvent.fire(element);this.changeContentEvent.fire();},setFooter:function(footerContent){var oFooter=this.footer||(this.footer=createFooter());if(footerContent.nodeName){oFooter.innerHTML="";oFooter.appendChild(footerContent);}else{oFooter.innerHTML=footerContent;}
this.changeFooterEvent.fire(footerContent);this.changeContentEvent.fire();},appendToFooter:function(element){var oFooter=this.footer||(this.footer=createFooter());oFooter.appendChild(element);this.changeFooterEvent.fire(element);this.changeContentEvent.fire();},render:function(appendToNode,moduleElement){var me=this,firstChild;function appendTo(parentNode){if(typeof parentNode=="string"){parentNode=document.getElementById(parentNode);}
if(parentNode){me._addToParent(parentNode,me.element);me.appendEvent.fire();}}
this.beforeRenderEvent.fire();if(!moduleElement){moduleElement=this.element;}
if(appendToNode){appendTo(appendToNode);}else{if(!Dom.inDocument(this.element)){return false;}}
if(this.header&&!Dom.inDocument(this.header)){firstChild=moduleElement.firstChild;if(firstChild){moduleElement.insertBefore(this.header,firstChild);}else{moduleElement.appendChild(this.header);}}
if(this.body&&!Dom.inDocument(this.body)){if(this.footer&&Dom.isAncestor(this.moduleElement,this.footer)){moduleElement.insertBefore(this.body,this.footer);}else{moduleElement.appendChild(this.body);}}
if(this.footer&&!Dom.inDocument(this.footer)){moduleElement.appendChild(this.footer);}
this.renderEvent.fire();return true;},destroy:function(){var parent,e;if(this.element){Event.purgeElement(this.element,true);parent=this.element.parentNode;}
if(parent){parent.removeChild(this.element);}
this.element=null;this.header=null;this.body=null;this.footer=null;Module.textResizeEvent.unsubscribe(this.onDomResize,this);this.cfg.destroy();this.cfg=null;this.destroyEvent.fire();for(e in this){if(e instanceof CustomEvent){e.unsubscribeAll();}}},show:function(){this.cfg.setProperty("visible",true);},hide:function(){this.cfg.setProperty("visible",false);},configVisible:function(type,args,obj){var visible=args[0];if(visible){this.beforeShowEvent.fire();Dom.setStyle(this.element,"display","block");this.showEvent.fire();}else{this.beforeHideEvent.fire();Dom.setStyle(this.element,"display","none");this.hideEvent.fire();}},configMonitorResize:function(type,args,obj){var monitor=args[0];if(monitor){this.initResizeMonitor();}else{Module.textResizeEvent.unsubscribe(this.onDomResize,this,true);this.resizeMonitor=null;}},_addToParent:function(parentNode,element){if(!this.cfg.getProperty("appendtodocumentbody")&&parentNode===document.body&&parentNode.firstChild){parentNode.insertBefore(element,parentNode.firstChild);}else{parentNode.appendChild(element);}},toString:function(){return"Module "+this.id;}};YAHOO.lang.augmentProto(Module,YAHOO.util.EventProvider);}());(function(){YAHOO.widget.Overlay=function(el,userConfig){YAHOO.widget.Overlay.superclass.constructor.call(this,el,userConfig);};var Lang=YAHOO.lang,CustomEvent=YAHOO.util.CustomEvent,Module=YAHOO.widget.Module,Event=YAHOO.util.Event,Dom=YAHOO.util.Dom,Config=YAHOO.util.Config,Overlay=YAHOO.widget.Overlay,m_oIFrameTemplate,EVENT_TYPES={"BEFORE_MOVE":"beforeMove","MOVE":"move"},DEFAULT_CONFIG={"X":{key:"x",validator:Lang.isNumber,suppressEvent:true,supercedes:["iframe"]},"Y":{key:"y",validator:Lang.isNumber,suppressEvent:true,supercedes:["iframe"]},"XY":{key:"xy",suppressEvent:true,supercedes:["iframe"]},"CONTEXT":{key:"context",suppressEvent:true,supercedes:["iframe"]},"FIXED_CENTER":{key:"fixedcenter",value:false,validator:Lang.isBoolean,supercedes:["iframe","visible"]},"WIDTH":{key:"width",suppressEvent:true,supercedes:["context","fixedcenter","iframe"]},"HEIGHT":{key:"height",suppressEvent:true,supercedes:["context","fixedcenter","iframe"]},"ZINDEX":{key:"zindex",value:null},"CONSTRAIN_TO_VIEWPORT":{key:"constraintoviewport",value:false,validator:Lang.isBoolean,supercedes:["iframe","x","y","xy"]},"IFRAME":{key:"iframe",value:(YAHOO.env.ua.ie==6?true:false),validator:Lang.isBoolean,supercedes:["zindex"]}};Overlay.IFRAME_SRC="javascript:false;";Overlay.IFRAME_OFFSET=3;Overlay.VIEWPORT_OFFSET=10;Overlay.TOP_LEFT="tl";Overlay.TOP_RIGHT="tr";Overlay.BOTTOM_LEFT="bl";Overlay.BOTTOM_RIGHT="br";Overlay.CSS_OVERLAY="yui-overlay";Overlay.windowScrollEvent=new CustomEvent("windowScroll");Overlay.windowResizeEvent=new CustomEvent("windowResize");Overlay.windowScrollHandler=function(e){if(YAHOO.env.ua.ie){if(!window.scrollEnd){window.scrollEnd=-1;}
clearTimeout(window.scrollEnd);window.scrollEnd=setTimeout(function(){Overlay.windowScrollEvent.fire();},1);}else{Overlay.windowScrollEvent.fire();}};Overlay.windowResizeHandler=function(e){if(YAHOO.env.ua.ie){if(!window.resizeEnd){window.resizeEnd=-1;}
clearTimeout(window.resizeEnd);window.resizeEnd=setTimeout(function(){Overlay.windowResizeEvent.fire();},100);}else{Overlay.windowResizeEvent.fire();}};Overlay._initialized=null;if(Overlay._initialized===null){Event.on(window,"scroll",Overlay.windowScrollHandler);Event.on(window,"resize",Overlay.windowResizeHandler);Overlay._initialized=true;}
YAHOO.extend(Overlay,Module,{init:function(el,userConfig){Overlay.superclass.init.call(this,el);this.beforeInitEvent.fire(Overlay);Dom.addClass(this.element,Overlay.CSS_OVERLAY);if(userConfig){this.cfg.applyConfig(userConfig,true);}
if(this.platform=="mac"&&YAHOO.env.ua.gecko){if(!Config.alreadySubscribed(this.showEvent,this.showMacGeckoScrollbars,this)){this.showEvent.subscribe(this.showMacGeckoScrollbars,this,true);}
if(!Config.alreadySubscribed(this.hideEvent,this.hideMacGeckoScrollbars,this)){this.hideEvent.subscribe(this.hideMacGeckoScrollbars,this,true);}}
this.initEvent.fire(Overlay);},initEvents:function(){Overlay.superclass.initEvents.call(this);var SIGNATURE=CustomEvent.LIST;this.beforeMoveEvent=this.createEvent(EVENT_TYPES.BEFORE_MOVE);this.beforeMoveEvent.signature=SIGNATURE;this.moveEvent=this.createEvent(EVENT_TYPES.MOVE);this.moveEvent.signature=SIGNATURE;},initDefaultConfig:function(){Overlay.superclass.initDefaultConfig.call(this);this.cfg.addProperty(DEFAULT_CONFIG.X.key,{handler:this.configX,validator:DEFAULT_CONFIG.X.validator,suppressEvent:DEFAULT_CONFIG.X.suppressEvent,supercedes:DEFAULT_CONFIG.X.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.Y.key,{handler:this.configY,validator:DEFAULT_CONFIG.Y.validator,suppressEvent:DEFAULT_CONFIG.Y.suppressEvent,supercedes:DEFAULT_CONFIG.Y.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.XY.key,{handler:this.configXY,suppressEvent:DEFAULT_CONFIG.XY.suppressEvent,supercedes:DEFAULT_CONFIG.XY.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.CONTEXT.key,{handler:this.configContext,suppressEvent:DEFAULT_CONFIG.CONTEXT.suppressEvent,supercedes:DEFAULT_CONFIG.CONTEXT.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.FIXED_CENTER.key,{handler:this.configFixedCenter,value:DEFAULT_CONFIG.FIXED_CENTER.value,validator:DEFAULT_CONFIG.FIXED_CENTER.validator,supercedes:DEFAULT_CONFIG.FIXED_CENTER.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.WIDTH.key,{handler:this.configWidth,suppressEvent:DEFAULT_CONFIG.WIDTH.suppressEvent,supercedes:DEFAULT_CONFIG.WIDTH.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.HEIGHT.key,{handler:this.configHeight,suppressEvent:DEFAULT_CONFIG.HEIGHT.suppressEvent,supercedes:DEFAULT_CONFIG.HEIGHT.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.ZINDEX.key,{handler:this.configzIndex,value:DEFAULT_CONFIG.ZINDEX.value});this.cfg.addProperty(DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.key,{handler:this.configConstrainToViewport,value:DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.value,validator:DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.validator,supercedes:DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.IFRAME.key,{handler:this.configIframe,value:DEFAULT_CONFIG.IFRAME.value,validator:DEFAULT_CONFIG.IFRAME.validator,supercedes:DEFAULT_CONFIG.IFRAME.supercedes});},moveTo:function(x,y){this.cfg.setProperty("xy",[x,y]);},hideMacGeckoScrollbars:function(){Dom.removeClass(this.element,"show-scrollbars");Dom.addClass(this.element,"hide-scrollbars");},showMacGeckoScrollbars:function(){Dom.removeClass(this.element,"hide-scrollbars");Dom.addClass(this.element,"show-scrollbars");},configVisible:function(type,args,obj){var visible=args[0],currentVis=Dom.getStyle(this.element,"visibility"),effect=this.cfg.getProperty("effect"),effectInstances=[],isMacGecko=(this.platform=="mac"&&YAHOO.env.ua.gecko),alreadySubscribed=Config.alreadySubscribed,eff,ei,e,i,j,k,h,nEffects,nEffectInstances;if(currentVis=="inherit"){e=this.element.parentNode;while(e.nodeType!=9&&e.nodeType!=11){currentVis=Dom.getStyle(e,"visibility");if(currentVis!="inherit"){break;}
e=e.parentNode;}
if(currentVis=="inherit"){currentVis="visible";}}
if(effect){if(effect instanceof Array){nEffects=effect.length;for(i=0;i<nEffects;i++){eff=effect[i];effectInstances[effectInstances.length]=eff.effect(this,eff.duration);}}else{effectInstances[effectInstances.length]=effect.effect(this,effect.duration);}}
if(visible){if(isMacGecko){this.showMacGeckoScrollbars();}
if(effect){if(visible){if(currentVis!="visible"||currentVis===""){this.beforeShowEvent.fire();nEffectInstances=effectInstances.length;for(j=0;j<nEffectInstances;j++){ei=effectInstances[j];if(j===0&&!alreadySubscribed(ei.animateInCompleteEvent,this.showEvent.fire,this.showEvent)){ei.animateInCompleteEvent.subscribe(this.showEvent.fire,this.showEvent,true);}
ei.animateIn();}}}}else{if(currentVis!="visible"||currentVis===""){this.beforeShowEvent.fire();Dom.setStyle(this.element,"visibility","visible");this.cfg.refireEvent("iframe");this.showEvent.fire();}}}else{if(isMacGecko){this.hideMacGeckoScrollbars();}
if(effect){if(currentVis=="visible"){this.beforeHideEvent.fire();nEffectInstances=effectInstances.length;for(k=0;k<nEffectInstances;k++){h=effectInstances[k];if(k===0&&!alreadySubscribed(h.animateOutCompleteEvent,this.hideEvent.fire,this.hideEvent)){h.animateOutCompleteEvent.subscribe(this.hideEvent.fire,this.hideEvent,true);}
h.animateOut();}}else if(currentVis===""){Dom.setStyle(this.element,"visibility","hidden");}}else{if(currentVis=="visible"||currentVis===""){this.beforeHideEvent.fire();Dom.setStyle(this.element,"visibility","hidden");this.hideEvent.fire();}}}},doCenterOnDOMEvent:function(){if(this.cfg.getProperty("visible")){this.center();}},configFixedCenter:function(type,args,obj){var val=args[0],alreadySubscribed=Config.alreadySubscribed,windowResizeEvent=Overlay.windowResizeEvent,windowScrollEvent=Overlay.windowScrollEvent;if(val){this.center();if(!alreadySubscribed(this.beforeShowEvent,this.center,this)){this.beforeShowEvent.subscribe(this.center);}
if(!alreadySubscribed(windowResizeEvent,this.doCenterOnDOMEvent,this)){windowResizeEvent.subscribe(this.doCenterOnDOMEvent,this,true);}
if(!alreadySubscribed(windowScrollEvent,this.doCenterOnDOMEvent,this)){windowScrollEvent.subscribe(this.doCenterOnDOMEvent,this,true);}}else{this.beforeShowEvent.unsubscribe(this.center);windowResizeEvent.unsubscribe(this.doCenterOnDOMEvent,this);windowScrollEvent.unsubscribe(this.doCenterOnDOMEvent,this);}},configHeight:function(type,args,obj){var height=args[0],el=this.element;Dom.setStyle(el,"height",height);this.cfg.refireEvent("iframe");},configWidth:function(type,args,obj){var width=args[0],el=this.element;Dom.setStyle(el,"width",width);this.cfg.refireEvent("iframe");},configzIndex:function(type,args,obj){var zIndex=args[0],el=this.element;if(!zIndex){zIndex=Dom.getStyle(el,"zIndex");if(!zIndex||isNaN(zIndex)){zIndex=0;}}
if(this.iframe||this.cfg.getProperty("iframe")===true){if(zIndex<=0){zIndex=1;}}
Dom.setStyle(el,"zIndex",zIndex);this.cfg.setProperty("zIndex",zIndex,true);if(this.iframe){this.stackIframe();}},configXY:function(type,args,obj){var pos=args[0],x=pos[0],y=pos[1];this.cfg.setProperty("x",x);this.cfg.setProperty("y",y);this.beforeMoveEvent.fire([x,y]);x=this.cfg.getProperty("x");y=this.cfg.getProperty("y");this.cfg.refireEvent("iframe");this.moveEvent.fire([x,y]);},configX:function(type,args,obj){var x=args[0],y=this.cfg.getProperty("y");this.cfg.setProperty("x",x,true);this.cfg.setProperty("y",y,true);this.beforeMoveEvent.fire([x,y]);x=this.cfg.getProperty("x");y=this.cfg.getProperty("y");Dom.setX(this.element,x,true);this.cfg.setProperty("xy",[x,y],true);this.cfg.refireEvent("iframe");this.moveEvent.fire([x,y]);},configY:function(type,args,obj){var x=this.cfg.getProperty("x"),y=args[0];this.cfg.setProperty("x",x,true);this.cfg.setProperty("y",y,true);this.beforeMoveEvent.fire([x,y]);x=this.cfg.getProperty("x");y=this.cfg.getProperty("y");Dom.setY(this.element,y,true);this.cfg.setProperty("xy",[x,y],true);this.cfg.refireEvent("iframe");this.moveEvent.fire([x,y]);},showIframe:function(){var oIFrame=this.iframe,oParentNode;if(oIFrame){oParentNode=this.element.parentNode;if(oParentNode!=oIFrame.parentNode){this._addToParent(oParentNode,oIFrame);}
oIFrame.style.display="block";}},hideIframe:function(){if(this.iframe){this.iframe.style.display="none";}},syncIframe:function(){var oIFrame=this.iframe,oElement=this.element,nOffset=Overlay.IFRAME_OFFSET,nDimensionOffset=(nOffset*2),aXY;if(oIFrame){oIFrame.style.width=(oElement.offsetWidth+nDimensionOffset+"px");oIFrame.style.height=(oElement.offsetHeight+nDimensionOffset+"px");aXY=this.cfg.getProperty("xy");if(!Lang.isArray(aXY)||(isNaN(aXY[0])||isNaN(aXY[1]))){this.syncPosition();aXY=this.cfg.getProperty("xy");}
Dom.setXY(oIFrame,[(aXY[0]-nOffset),(aXY[1]-nOffset)]);}},stackIframe:function(){if(this.iframe){var overlayZ=Dom.getStyle(this.element,"zIndex");if(!YAHOO.lang.isUndefined(overlayZ)&&!isNaN(overlayZ)){Dom.setStyle(this.iframe,"zIndex",(overlayZ-1));}}},configIframe:function(type,args,obj){var bIFrame=args[0];function createIFrame(){var oIFrame=this.iframe,oElement=this.element,oParent;if(!oIFrame){if(!m_oIFrameTemplate){m_oIFrameTemplate=document.createElement("iframe");if(this.isSecure){m_oIFrameTemplate.src=Overlay.IFRAME_SRC;}
if(YAHOO.env.ua.ie){m_oIFrameTemplate.style.filter="alpha(opacity=0)";m_oIFrameTemplate.frameBorder=0;}
else{m_oIFrameTemplate.style.opacity="0";}
m_oIFrameTemplate.style.position="absolute";m_oIFrameTemplate.style.border="none";m_oIFrameTemplate.style.margin="0";m_oIFrameTemplate.style.padding="0";m_oIFrameTemplate.style.display="none";}
oIFrame=m_oIFrameTemplate.cloneNode(false);oParent=oElement.parentNode;var parentNode=oParent||document.body;this._addToParent(parentNode,oIFrame);this.iframe=oIFrame;}
this.showIframe();this.syncIframe();this.stackIframe();if(!this._hasIframeEventListeners){this.showEvent.subscribe(this.showIframe);this.hideEvent.subscribe(this.hideIframe);this.changeContentEvent.subscribe(this.syncIframe);this._hasIframeEventListeners=true;}}
function onBeforeShow(){createIFrame.call(this);this.beforeShowEvent.unsubscribe(onBeforeShow);this._iframeDeferred=false;}
if(bIFrame){if(this.cfg.getProperty("visible")){createIFrame.call(this);}else{if(!this._iframeDeferred){this.beforeShowEvent.subscribe(onBeforeShow);this._iframeDeferred=true;}}}else{this.hideIframe();if(this._hasIframeEventListeners){this.showEvent.unsubscribe(this.showIframe);this.hideEvent.unsubscribe(this.hideIframe);this.changeContentEvent.unsubscribe(this.syncIframe);this._hasIframeEventListeners=false;}}},_primeXYFromDOM:function(){if(YAHOO.lang.isUndefined(this.cfg.getProperty("xy"))){this.syncPosition();this.cfg.refireEvent("xy");this.beforeShowEvent.unsubscribe(this._primeXYFromDOM);}},configConstrainToViewport:function(type,args,obj){var val=args[0];if(val){if(!Config.alreadySubscribed(this.beforeMoveEvent,this.enforceConstraints,this)){this.beforeMoveEvent.subscribe(this.enforceConstraints,this,true);}
if(!Config.alreadySubscribed(this.beforeShowEvent,this._primeXYFromDOM)){this.beforeShowEvent.subscribe(this._primeXYFromDOM);}}else{this.beforeShowEvent.unsubscribe(this._primeXYFromDOM);this.beforeMoveEvent.unsubscribe(this.enforceConstraints,this);}},configContext:function(type,args,obj){var contextArgs=args[0],contextEl,elementMagnetCorner,contextMagnetCorner;if(contextArgs){contextEl=contextArgs[0];elementMagnetCorner=contextArgs[1];contextMagnetCorner=contextArgs[2];if(contextEl){if(typeof contextEl=="string"){this.cfg.setProperty("context",[document.getElementById(contextEl),elementMagnetCorner,contextMagnetCorner],true);}
if(elementMagnetCorner&&contextMagnetCorner){this.align(elementMagnetCorner,contextMagnetCorner);}}}},align:function(elementAlign,contextAlign){var contextArgs=this.cfg.getProperty("context"),me=this,context,element,contextRegion;function doAlign(v,h){switch(elementAlign){case Overlay.TOP_LEFT:me.moveTo(h,v);break;case Overlay.TOP_RIGHT:me.moveTo((h-element.offsetWidth),v);break;case Overlay.BOTTOM_LEFT:me.moveTo(h,(v-element.offsetHeight));break;case Overlay.BOTTOM_RIGHT:me.moveTo((h-element.offsetWidth),(v-element.offsetHeight));break;}}
if(contextArgs){context=contextArgs[0];element=this.element;me=this;if(!elementAlign){elementAlign=contextArgs[1];}
if(!contextAlign){contextAlign=contextArgs[2];}
if(element&&context){contextRegion=Dom.getRegion(context);switch(contextAlign){case Overlay.TOP_LEFT:doAlign(contextRegion.top,contextRegion.left);break;case Overlay.TOP_RIGHT:doAlign(contextRegion.top,contextRegion.right);break;case Overlay.BOTTOM_LEFT:doAlign(contextRegion.bottom,contextRegion.left);break;case Overlay.BOTTOM_RIGHT:doAlign(contextRegion.bottom,contextRegion.right);break;}}}},enforceConstraints:function(type,args,obj){var pos=args[0];var cXY=this.getConstrainedXY(pos[0],pos[1]);this.cfg.setProperty("x",cXY[0],true);this.cfg.setProperty("y",cXY[1],true);this.cfg.setProperty("xy",cXY,true);},getConstrainedXY:function(x,y){var nViewportOffset=Overlay.VIEWPORT_OFFSET,viewPortWidth=Dom.getViewportWidth(),viewPortHeight=Dom.getViewportHeight(),offsetHeight=this.element.offsetHeight,offsetWidth=this.element.offsetWidth,scrollX=Dom.getDocumentScrollLeft(),scrollY=Dom.getDocumentScrollTop();var xNew=x;var yNew=y;if(offsetWidth+nViewportOffset<viewPortWidth){var leftConstraint=scrollX+nViewportOffset;var rightConstraint=scrollX+viewPortWidth-offsetWidth-nViewportOffset;if(x<leftConstraint){xNew=leftConstraint;}else if(x>rightConstraint){xNew=rightConstraint;}}else{xNew=nViewportOffset+scrollX;}
if(offsetHeight+nViewportOffset<viewPortHeight){var topConstraint=scrollY+nViewportOffset;var bottomConstraint=scrollY+viewPortHeight-offsetHeight-nViewportOffset;if(y<topConstraint){yNew=topConstraint;}else if(y>bottomConstraint){yNew=bottomConstraint;}}else{yNew=nViewportOffset+scrollY;}
return[xNew,yNew];},center:function(){var nViewportOffset=Overlay.VIEWPORT_OFFSET,elementWidth=this.element.offsetWidth,elementHeight=this.element.offsetHeight,viewPortWidth=Dom.getViewportWidth(),viewPortHeight=Dom.getViewportHeight(),x,y;if(elementWidth<viewPortWidth){x=(viewPortWidth/2)-(elementWidth/2)+Dom.getDocumentScrollLeft();}else{x=nViewportOffset+Dom.getDocumentScrollLeft();}
if(elementHeight<viewPortHeight){y=(viewPortHeight/2)-(elementHeight/2)+Dom.getDocumentScrollTop();}else{y=nViewportOffset+Dom.getDocumentScrollTop();}
this.cfg.setProperty("xy",[parseInt(x,10),parseInt(y,10)]);this.cfg.refireEvent("iframe");},syncPosition:function(){var pos=Dom.getXY(this.element);this.cfg.setProperty("x",pos[0],true);this.cfg.setProperty("y",pos[1],true);this.cfg.setProperty("xy",pos,true);},onDomResize:function(e,obj){var me=this;Overlay.superclass.onDomResize.call(this,e,obj);setTimeout(function(){me.syncPosition();me.cfg.refireEvent("iframe");me.cfg.refireEvent("context");},0);},bringToTop:function(){var aOverlays=[],oElement=this.element;function compareZIndexDesc(p_oOverlay1,p_oOverlay2){var sZIndex1=Dom.getStyle(p_oOverlay1,"zIndex"),sZIndex2=Dom.getStyle(p_oOverlay2,"zIndex"),nZIndex1=(!sZIndex1||isNaN(sZIndex1))?0:parseInt(sZIndex1,10),nZIndex2=(!sZIndex2||isNaN(sZIndex2))?0:parseInt(sZIndex2,10);if(nZIndex1>nZIndex2){return-1;}else if(nZIndex1<nZIndex2){return 1;}else{return 0;}}
function isOverlayElement(p_oElement){var oOverlay=Dom.hasClass(p_oElement,Overlay.CSS_OVERLAY),Panel=YAHOO.widget.Panel;if(oOverlay&&!Dom.isAncestor(oElement,oOverlay)){if(Panel&&Dom.hasClass(p_oElement,Panel.CSS_PANEL)){aOverlays[aOverlays.length]=p_oElement.parentNode;}else{aOverlays[aOverlays.length]=p_oElement;}}}
Dom.getElementsBy(isOverlayElement,"DIV",document.body);aOverlays.sort(compareZIndexDesc);var oTopOverlay=aOverlays[0],nTopZIndex;if(oTopOverlay){nTopZIndex=Dom.getStyle(oTopOverlay,"zIndex");if(!isNaN(nTopZIndex)){var bRequiresBump=false;if(oTopOverlay!=oElement){bRequiresBump=true;}else if(aOverlays.length>1){var nNextZIndex=Dom.getStyle(aOverlays[1],"zIndex");if(!isNaN(nNextZIndex)&&(nTopZIndex==nNextZIndex)){bRequiresBump=true;}}
if(bRequiresBump){this.cfg.setProperty("zindex",(parseInt(nTopZIndex,10)+2));}}}},destroy:function(){if(this.iframe){this.iframe.parentNode.removeChild(this.iframe);}
this.iframe=null;Overlay.windowResizeEvent.unsubscribe(this.doCenterOnDOMEvent,this);Overlay.windowScrollEvent.unsubscribe(this.doCenterOnDOMEvent,this);Overlay.superclass.destroy.call(this);},toString:function(){return"Overlay "+this.id;}});}());(function(){YAHOO.widget.OverlayManager=function(userConfig){this.init(userConfig);};var Overlay=YAHOO.widget.Overlay,Event=YAHOO.util.Event,Dom=YAHOO.util.Dom,Config=YAHOO.util.Config,CustomEvent=YAHOO.util.CustomEvent,OverlayManager=YAHOO.widget.OverlayManager;OverlayManager.CSS_FOCUSED="focused";OverlayManager.prototype={constructor:OverlayManager,overlays:null,initDefaultConfig:function(){this.cfg.addProperty("overlays",{suppressEvent:true});this.cfg.addProperty("focusevent",{value:"mousedown"});},init:function(userConfig){this.cfg=new Config(this);this.initDefaultConfig();if(userConfig){this.cfg.applyConfig(userConfig,true);}
this.cfg.fireQueue();var activeOverlay=null;this.getActive=function(){return activeOverlay;};this.focus=function(overlay){var o=this.find(overlay);if(o){if(activeOverlay!=o){if(activeOverlay){activeOverlay.blur();}
this.bringToTop(o);activeOverlay=o;Dom.addClass(activeOverlay.element,OverlayManager.CSS_FOCUSED);o.focusEvent.fire();}}};this.remove=function(overlay){var o=this.find(overlay),originalZ;if(o){if(activeOverlay==o){activeOverlay=null;}
var bDestroyed=(o.element===null&&o.cfg===null)?true:false;if(!bDestroyed){originalZ=Dom.getStyle(o.element,"zIndex");o.cfg.setProperty("zIndex",-1000,true);}
this.overlays.sort(this.compareZIndexDesc);this.overlays=this.overlays.slice(0,(this.overlays.length-1));o.hideEvent.unsubscribe(o.blur);o.destroyEvent.unsubscribe(this._onOverlayDestroy,o);if(!bDestroyed){Event.removeListener(o.element,this.cfg.getProperty("focusevent"),this._onOverlayElementFocus);o.cfg.setProperty("zIndex",originalZ,true);o.cfg.setProperty("manager",null);}
o.focusEvent.unsubscribeAll();o.blurEvent.unsubscribeAll();o.focusEvent=null;o.blurEvent=null;o.focus=null;o.blur=null;}};this.blurAll=function(){var nOverlays=this.overlays.length,i;if(nOverlays>0){i=nOverlays-1;do{this.overlays[i].blur();}
while(i--);}};this._onOverlayBlur=function(p_sType,p_aArgs){activeOverlay=null;};var overlays=this.cfg.getProperty("overlays");if(!this.overlays){this.overlays=[];}
if(overlays){this.register(overlays);this.overlays.sort(this.compareZIndexDesc);}},_onOverlayElementFocus:function(p_oEvent){var oTarget=Event.getTarget(p_oEvent),oClose=this.close;if(oClose&&(oTarget==oClose||Dom.isAncestor(oClose,oTarget))){this.blur();}else{this.focus();}},_onOverlayDestroy:function(p_sType,p_aArgs,p_oOverlay){this.remove(p_oOverlay);},register:function(overlay){var mgr=this,zIndex,regcount,i,nOverlays;if(overlay instanceof Overlay){overlay.cfg.addProperty("manager",{value:this});overlay.focusEvent=overlay.createEvent("focus");overlay.focusEvent.signature=CustomEvent.LIST;overlay.blurEvent=overlay.createEvent("blur");overlay.blurEvent.signature=CustomEvent.LIST;overlay.focus=function(){mgr.focus(this);};overlay.blur=function(){if(mgr.getActive()==this){Dom.removeClass(this.element,OverlayManager.CSS_FOCUSED);this.blurEvent.fire();}};overlay.blurEvent.subscribe(mgr._onOverlayBlur);overlay.hideEvent.subscribe(overlay.blur);overlay.destroyEvent.subscribe(this._onOverlayDestroy,overlay,this);Event.on(overlay.element,this.cfg.getProperty("focusevent"),this._onOverlayElementFocus,null,overlay);zIndex=Dom.getStyle(overlay.element,"zIndex");if(!isNaN(zIndex)){overlay.cfg.setProperty("zIndex",parseInt(zIndex,10));}else{overlay.cfg.setProperty("zIndex",0);}
this.overlays.push(overlay);this.bringToTop(overlay);return true;}else if(overlay instanceof Array){regcount=0;nOverlays=overlay.length;for(i=0;i<nOverlays;i++){if(this.register(overlay[i])){regcount++;}}
if(regcount>0){return true;}}else{return false;}},bringToTop:function(p_oOverlay){var oOverlay=this.find(p_oOverlay),nTopZIndex,oTopOverlay,aOverlays;if(oOverlay){aOverlays=this.overlays;aOverlays.sort(this.compareZIndexDesc);oTopOverlay=aOverlays[0];if(oTopOverlay){nTopZIndex=Dom.getStyle(oTopOverlay.element,"zIndex");if(!isNaN(nTopZIndex)){var bRequiresBump=false;if(oTopOverlay!==oOverlay){bRequiresBump=true;}else if(aOverlays.length>1){var nNextZIndex=Dom.getStyle(aOverlays[1].element,"zIndex");if(!isNaN(nNextZIndex)&&(nTopZIndex==nNextZIndex)){bRequiresBump=true;}}
if(bRequiresBump){oOverlay.cfg.setProperty("zindex",(parseInt(nTopZIndex,10)+2));}}
aOverlays.sort(this.compareZIndexDesc);}}},find:function(overlay){var aOverlays=this.overlays,nOverlays=aOverlays.length,i;if(nOverlays>0){i=nOverlays-1;if(overlay instanceof Overlay){do{if(aOverlays[i]==overlay){return aOverlays[i];}}
while(i--);}else if(typeof overlay=="string"){do{if(aOverlays[i].id==overlay){return aOverlays[i];}}
while(i--);}
return null;}},compareZIndexDesc:function(o1,o2){var zIndex1=(o1.cfg)?o1.cfg.getProperty("zIndex"):null,zIndex2=(o2.cfg)?o2.cfg.getProperty("zIndex"):null;if(zIndex1===null&&zIndex2===null){return 0;}else if(zIndex1===null){return 1;}else if(zIndex2===null){return-1;}else if(zIndex1>zIndex2){return-1;}else if(zIndex1<zIndex2){return 1;}else{return 0;}},showAll:function(){var aOverlays=this.overlays,nOverlays=aOverlays.length,i;if(nOverlays>0){i=nOverlays-1;do{aOverlays[i].show();}
while(i--);}},hideAll:function(){var aOverlays=this.overlays,nOverlays=aOverlays.length,i;if(nOverlays>0){i=nOverlays-1;do{aOverlays[i].hide();}
while(i--);}},toString:function(){return"OverlayManager";}};}());(function(){YAHOO.widget.Tooltip=function(el,userConfig){YAHOO.widget.Tooltip.superclass.constructor.call(this,el,userConfig);};var Lang=YAHOO.lang,Event=YAHOO.util.Event,CustomEvent=YAHOO.util.CustomEvent,Dom=YAHOO.util.Dom,Tooltip=YAHOO.widget.Tooltip,m_oShadowTemplate,DEFAULT_CONFIG={"PREVENT_OVERLAP":{key:"preventoverlap",value:true,validator:Lang.isBoolean,supercedes:["x","y","xy"]},"SHOW_DELAY":{key:"showdelay",value:200,validator:Lang.isNumber},"AUTO_DISMISS_DELAY":{key:"autodismissdelay",value:5000,validator:Lang.isNumber},"HIDE_DELAY":{key:"hidedelay",value:250,validator:Lang.isNumber},"TEXT":{key:"text",suppressEvent:true},"CONTAINER":{key:"container"},"DISABLED":{key:"disabled",value:false,suppressEvent:true}},EVENT_TYPES={"CONTEXT_MOUSE_OVER":"contextMouseOver","CONTEXT_MOUSE_OUT":"contextMouseOut","CONTEXT_TRIGGER":"contextTrigger"};Tooltip.CSS_TOOLTIP="yui-tt";function restoreOriginalWidth(p_sType,p_aArgs,p_oObject){var sOriginalWidth=p_oObject[0],sNewWidth=p_oObject[1],oConfig=this.cfg,sCurrentWidth=oConfig.getProperty("width");if(sCurrentWidth==sNewWidth){oConfig.setProperty("width",sOriginalWidth);}
this.unsubscribe("hide",this._onHide,p_oObject);}
function setWidthToOffsetWidth(p_sType,p_aArgs){var oBody=document.body,oConfig=this.cfg,sOriginalWidth=oConfig.getProperty("width"),sNewWidth,oClone;if((!sOriginalWidth||sOriginalWidth=="auto")&&(oConfig.getProperty("container")!=oBody||oConfig.getProperty("x")>=Dom.getViewportWidth()||oConfig.getProperty("y")>=Dom.getViewportHeight())){oClone=this.element.cloneNode(true);oClone.style.visibility="hidden";oClone.style.top="0px";oClone.style.left="0px";oBody.appendChild(oClone);sNewWidth=(oClone.offsetWidth+"px");oBody.removeChild(oClone);oClone=null;oConfig.setProperty("width",sNewWidth);oConfig.refireEvent("xy");this.subscribe("hide",restoreOriginalWidth,[(sOriginalWidth||""),sNewWidth]);}}
function onDOMReady(p_sType,p_aArgs,p_oObject){this.render(p_oObject);}
function onInit(){Event.onDOMReady(onDOMReady,this.cfg.getProperty("container"),this);}
YAHOO.extend(Tooltip,YAHOO.widget.Overlay,{init:function(el,userConfig){Tooltip.superclass.init.call(this,el);this.beforeInitEvent.fire(Tooltip);Dom.addClass(this.element,Tooltip.CSS_TOOLTIP);if(userConfig){this.cfg.applyConfig(userConfig,true);}
this.cfg.queueProperty("visible",false);this.cfg.queueProperty("constraintoviewport",true);this.setBody("");this.subscribe("beforeShow",setWidthToOffsetWidth);this.subscribe("init",onInit);this.subscribe("render",this.onRender);this.initEvent.fire(Tooltip);},initEvents:function(){Tooltip.superclass.initEvents.call(this);var SIGNATURE=CustomEvent.LIST;this.contextMouseOverEvent=this.createEvent(EVENT_TYPES.CONTEXT_MOUSE_OVER);this.contextMouseOverEvent.signature=SIGNATURE;this.contextMouseOutEvent=this.createEvent(EVENT_TYPES.CONTEXT_MOUSE_OUT);this.contextMouseOutEvent.signature=SIGNATURE;this.contextTriggerEvent=this.createEvent(EVENT_TYPES.CONTEXT_TRIGGER);this.contextTriggerEvent.signature=SIGNATURE;},initDefaultConfig:function(){Tooltip.superclass.initDefaultConfig.call(this);this.cfg.addProperty(DEFAULT_CONFIG.PREVENT_OVERLAP.key,{value:DEFAULT_CONFIG.PREVENT_OVERLAP.value,validator:DEFAULT_CONFIG.PREVENT_OVERLAP.validator,supercedes:DEFAULT_CONFIG.PREVENT_OVERLAP.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.SHOW_DELAY.key,{handler:this.configShowDelay,value:200,validator:DEFAULT_CONFIG.SHOW_DELAY.validator});this.cfg.addProperty(DEFAULT_CONFIG.AUTO_DISMISS_DELAY.key,{handler:this.configAutoDismissDelay,value:DEFAULT_CONFIG.AUTO_DISMISS_DELAY.value,validator:DEFAULT_CONFIG.AUTO_DISMISS_DELAY.validator});this.cfg.addProperty(DEFAULT_CONFIG.HIDE_DELAY.key,{handler:this.configHideDelay,value:DEFAULT_CONFIG.HIDE_DELAY.value,validator:DEFAULT_CONFIG.HIDE_DELAY.validator});this.cfg.addProperty(DEFAULT_CONFIG.TEXT.key,{handler:this.configText,suppressEvent:DEFAULT_CONFIG.TEXT.suppressEvent});this.cfg.addProperty(DEFAULT_CONFIG.CONTAINER.key,{handler:this.configContainer,value:document.body});this.cfg.addProperty(DEFAULT_CONFIG.DISABLED.key,{handler:this.configContainer,value:DEFAULT_CONFIG.DISABLED.value,supressEvent:DEFAULT_CONFIG.DISABLED.suppressEvent});},configText:function(type,args,obj){var text=args[0];if(text){this.setBody(text);}},configContainer:function(type,args,obj){var container=args[0];if(typeof container=='string'){this.cfg.setProperty("container",document.getElementById(container),true);}},_removeEventListeners:function(){var aElements=this._context,nElements,oElement,i;if(aElements){nElements=aElements.length;if(nElements>0){i=nElements-1;do{oElement=aElements[i];Event.removeListener(oElement,"mouseover",this.onContextMouseOver);Event.removeListener(oElement,"mousemove",this.onContextMouseMove);Event.removeListener(oElement,"mouseout",this.onContextMouseOut);}
while(i--);}}},configContext:function(type,args,obj){var context=args[0],aElements,nElements,oElement,i;if(context){if(!(context instanceof Array)){if(typeof context=="string"){this.cfg.setProperty("context",[document.getElementById(context)],true);}else{this.cfg.setProperty("context",[context],true);}
context=this.cfg.getProperty("context");}
this._removeEventListeners();this._context=context;aElements=this._context;if(aElements){nElements=aElements.length;if(nElements>0){i=nElements-1;do{oElement=aElements[i];Event.on(oElement,"mouseover",this.onContextMouseOver,this);Event.on(oElement,"mousemove",this.onContextMouseMove,this);Event.on(oElement,"mouseout",this.onContextMouseOut,this);}
while(i--);}}}},onContextMouseMove:function(e,obj){obj.pageX=Event.getPageX(e);obj.pageY=Event.getPageY(e);},onContextMouseOver:function(e,obj){var context=this;if(context.title){obj._tempTitle=context.title;context.title="";}
if(obj.fireEvent("contextMouseOver",context,e)!==false&&!obj.cfg.getProperty("disabled")){if(obj.hideProcId){clearTimeout(obj.hideProcId);obj.hideProcId=null;}
Event.on(context,"mousemove",obj.onContextMouseMove,obj);obj.showProcId=obj.doShow(e,context);}},onContextMouseOut:function(e,obj){var el=this;if(obj._tempTitle){el.title=obj._tempTitle;obj._tempTitle=null;}
if(obj.showProcId){clearTimeout(obj.showProcId);obj.showProcId=null;}
if(obj.hideProcId){clearTimeout(obj.hideProcId);obj.hideProcId=null;}
obj.fireEvent("contextMouseOut",el,e);obj.hideProcId=setTimeout(function(){obj.hide();},obj.cfg.getProperty("hidedelay"));},doShow:function(e,context){var yOffset=25,me=this;if(YAHOO.env.ua.opera&&context.tagName&&context.tagName.toUpperCase()=="A"){yOffset+=12;}
return setTimeout(function(){var txt=me.cfg.getProperty("text");if(me._tempTitle&&(txt===""||YAHOO.lang.isUndefined(txt)||YAHOO.lang.isNull(txt))){me.setBody(me._tempTitle);}else{me.cfg.refireEvent("text");}
me.moveTo(me.pageX,me.pageY+yOffset);if(me.cfg.getProperty("preventoverlap")){me.preventOverlap(me.pageX,me.pageY);}
Event.removeListener(context,"mousemove",me.onContextMouseMove);me.contextTriggerEvent.fire(context);me.show();me.hideProcId=me.doHide();},this.cfg.getProperty("showdelay"));},doHide:function(){var me=this;return setTimeout(function(){me.hide();},this.cfg.getProperty("autodismissdelay"));},preventOverlap:function(pageX,pageY){var height=this.element.offsetHeight,mousePoint=new YAHOO.util.Point(pageX,pageY),elementRegion=Dom.getRegion(this.element);elementRegion.top-=5;elementRegion.left-=5;elementRegion.right+=5;elementRegion.bottom+=5;if(elementRegion.contains(mousePoint)){this.cfg.setProperty("y",(pageY-height-5));}},onRender:function(p_sType,p_aArgs){function sizeShadow(){var oElement=this.element,oShadow=this._shadow;if(oShadow){oShadow.style.width=(oElement.offsetWidth+6)+"px";oShadow.style.height=(oElement.offsetHeight+1)+"px";}}
function addShadowVisibleClass(){Dom.addClass(this._shadow,"yui-tt-shadow-visible");}
function removeShadowVisibleClass(){Dom.removeClass(this._shadow,"yui-tt-shadow-visible");}
function createShadow(){var oShadow=this._shadow,oElement,Module,nIE,me;if(!oShadow){oElement=this.element;Module=YAHOO.widget.Module;nIE=YAHOO.env.ua.ie;me=this;if(!m_oShadowTemplate){m_oShadowTemplate=document.createElement("div");m_oShadowTemplate.className="yui-tt-shadow";}
oShadow=m_oShadowTemplate.cloneNode(false);oElement.appendChild(oShadow);this._shadow=oShadow;addShadowVisibleClass.call(this);this.subscribe("beforeShow",addShadowVisibleClass);this.subscribe("beforeHide",removeShadowVisibleClass);if(nIE==6||(nIE==7&&document.compatMode=="BackCompat")){window.setTimeout(function(){sizeShadow.call(me);},0);this.cfg.subscribeToConfigEvent("width",sizeShadow);this.cfg.subscribeToConfigEvent("height",sizeShadow);this.subscribe("changeContent",sizeShadow);Module.textResizeEvent.subscribe(sizeShadow,this,true);this.subscribe("destroy",function(){Module.textResizeEvent.unsubscribe(sizeShadow,this);});}}}
function onBeforeShow(){createShadow.call(this);this.unsubscribe("beforeShow",onBeforeShow);}
if(this.cfg.getProperty("visible")){createShadow.call(this);}else{this.subscribe("beforeShow",onBeforeShow);}},destroy:function(){this._removeEventListeners();Tooltip.superclass.destroy.call(this);},toString:function(){return"Tooltip "+this.id;}});}());(function(){YAHOO.widget.Panel=function(el,userConfig){YAHOO.widget.Panel.superclass.constructor.call(this,el,userConfig);};var Lang=YAHOO.lang,DD=YAHOO.util.DD,Dom=YAHOO.util.Dom,Event=YAHOO.util.Event,Overlay=YAHOO.widget.Overlay,CustomEvent=YAHOO.util.CustomEvent,Config=YAHOO.util.Config,Panel=YAHOO.widget.Panel,m_oMaskTemplate,m_oUnderlayTemplate,m_oCloseIconTemplate,EVENT_TYPES={"SHOW_MASK":"showMask","HIDE_MASK":"hideMask","DRAG":"drag"},DEFAULT_CONFIG={"CLOSE":{key:"close",value:true,validator:Lang.isBoolean,supercedes:["visible"]},"DRAGGABLE":{key:"draggable",value:(DD?true:false),validator:Lang.isBoolean,supercedes:["visible"]},"DRAG_ONLY":{key:"dragonly",value:false,validator:Lang.isBoolean,supercedes:["draggable"]},"UNDERLAY":{key:"underlay",value:"shadow",supercedes:["visible"]},"MODAL":{key:"modal",value:false,validator:Lang.isBoolean,supercedes:["visible","zindex"]},"KEY_LISTENERS":{key:"keylisteners",suppressEvent:true,supercedes:["visible"]}};Panel.CSS_PANEL="yui-panel";Panel.CSS_PANEL_CONTAINER="yui-panel-container";Panel.FOCUSABLE=["a","button","select","textarea","input"];function createHeader(p_sType,p_aArgs){if(!this.header&&this.cfg.getProperty("draggable")){this.setHeader("&#160;");}}
function restoreOriginalWidth(p_sType,p_aArgs,p_oObject){var sOriginalWidth=p_oObject[0],sNewWidth=p_oObject[1],oConfig=this.cfg,sCurrentWidth=oConfig.getProperty("width");if(sCurrentWidth==sNewWidth){oConfig.setProperty("width",sOriginalWidth);}
this.unsubscribe("hide",restoreOriginalWidth,p_oObject);}
function setWidthToOffsetWidth(p_sType,p_aArgs){var nIE=YAHOO.env.ua.ie,oConfig,sOriginalWidth,sNewWidth;if(nIE==6||(nIE==7&&document.compatMode=="BackCompat")){oConfig=this.cfg;sOriginalWidth=oConfig.getProperty("width");if(!sOriginalWidth||sOriginalWidth=="auto"){sNewWidth=(this.element.offsetWidth+"px");oConfig.setProperty("width",sNewWidth);this.subscribe("hide",restoreOriginalWidth,[(sOriginalWidth||""),sNewWidth]);}}}
YAHOO.extend(Panel,Overlay,{init:function(el,userConfig){Panel.superclass.init.call(this,el);this.beforeInitEvent.fire(Panel);Dom.addClass(this.element,Panel.CSS_PANEL);this.buildWrapper();if(userConfig){this.cfg.applyConfig(userConfig,true);}
this.subscribe("showMask",this._addFocusHandlers);this.subscribe("hideMask",this._removeFocusHandlers);this.subscribe("beforeRender",createHeader);this.initEvent.fire(Panel);},_onElementFocus:function(e){this.blur();},_addFocusHandlers:function(p_sType,p_aArgs){var me=this,focus="focus",hidden="hidden";function isFocusable(el){if(el.type!==hidden&&!Dom.isAncestor(me.element,el)){Event.on(el,focus,me._onElementFocus);return true;}
return false;}
var focusable=Panel.FOCUSABLE,l=focusable.length,arr=[];for(var i=0;i<l;i++){arr=arr.concat(Dom.getElementsBy(isFocusable,focusable[i]));}
this.focusableElements=arr;},_removeFocusHandlers:function(p_sType,p_aArgs){var aElements=this.focusableElements,nElements=aElements.length,focus="focus";if(aElements){for(var i=0;i<nElements;i++){Event.removeListener(aElements[i],focus,this._onElementFocus);}}},initEvents:function(){Panel.superclass.initEvents.call(this);var SIGNATURE=CustomEvent.LIST;this.showMaskEvent=this.createEvent(EVENT_TYPES.SHOW_MASK);this.showMaskEvent.signature=SIGNATURE;this.hideMaskEvent=this.createEvent(EVENT_TYPES.HIDE_MASK);this.hideMaskEvent.signature=SIGNATURE;this.dragEvent=this.createEvent(EVENT_TYPES.DRAG);this.dragEvent.signature=SIGNATURE;},initDefaultConfig:function(){Panel.superclass.initDefaultConfig.call(this);this.cfg.addProperty(DEFAULT_CONFIG.CLOSE.key,{handler:this.configClose,value:DEFAULT_CONFIG.CLOSE.value,validator:DEFAULT_CONFIG.CLOSE.validator,supercedes:DEFAULT_CONFIG.CLOSE.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.DRAGGABLE.key,{handler:this.configDraggable,value:DEFAULT_CONFIG.DRAGGABLE.value,validator:DEFAULT_CONFIG.DRAGGABLE.validator,supercedes:DEFAULT_CONFIG.DRAGGABLE.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.DRAG_ONLY.key,{value:DEFAULT_CONFIG.DRAG_ONLY.value,validator:DEFAULT_CONFIG.DRAG_ONLY.validator,supercedes:DEFAULT_CONFIG.DRAG_ONLY.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.UNDERLAY.key,{handler:this.configUnderlay,value:DEFAULT_CONFIG.UNDERLAY.value,supercedes:DEFAULT_CONFIG.UNDERLAY.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.MODAL.key,{handler:this.configModal,value:DEFAULT_CONFIG.MODAL.value,validator:DEFAULT_CONFIG.MODAL.validator,supercedes:DEFAULT_CONFIG.MODAL.supercedes});this.cfg.addProperty(DEFAULT_CONFIG.KEY_LISTENERS.key,{handler:this.configKeyListeners,suppressEvent:DEFAULT_CONFIG.KEY_LISTENERS.suppressEvent,supercedes:DEFAULT_CONFIG.KEY_LISTENERS.supercedes});},configClose:function(type,args,obj){var val=args[0],oClose=this.close;function doHide(e,obj){obj.hide();}
if(val){if(!oClose){if(!m_oCloseIconTemplate){m_oCloseIconTemplate=document.createElement("span");m_oCloseIconTemplate.innerHTML="&#160;";m_oCloseIconTemplate.className="container-close";}
oClose=m_oCloseIconTemplate.cloneNode(true);this.innerElement.appendChild(oClose);Event.on(oClose,"click",doHide,this);this.close=oClose;}else{oClose.style.display="block";}}else{if(oClose){oClose.style.display="none";}}},configDraggable:function(type,args,obj){var val=args[0];if(val){if(!DD){this.cfg.setProperty("draggable",false);return;}
if(this.header){Dom.setStyle(this.header,"cursor","move");this.registerDragDrop();}
this.subscribe("beforeShow",setWidthToOffsetWidth);}else{if(this.dd){this.dd.unreg();}
if(this.header){Dom.setStyle(this.header,"cursor","auto");}
this.unsubscribe("beforeShow",setWidthToOffsetWidth);}},configUnderlay:function(type,args,obj){var UA=YAHOO.env.ua,bMacGecko=(this.platform=="mac"&&UA.gecko),bIEQuirks=(UA.ie==6||(UA.ie==7&&document.compatMode=="BackCompat")),sUnderlay=args[0].toLowerCase(),oUnderlay=this.underlay,oElement=this.element;function fixWebkitUnderlay(){var u=this.underlay;Dom.addClass(u,"yui-force-redraw");window.setTimeout(function(){Dom.removeClass(u,"yui-force-redraw");},0);}
function createUnderlay(){var bNew=false;if(!oUnderlay){if(!m_oUnderlayTemplate){m_oUnderlayTemplate=document.createElement("div");m_oUnderlayTemplate.className="underlay";}
oUnderlay=m_oUnderlayTemplate.cloneNode(false);this.element.appendChild(oUnderlay);this.underlay=oUnderlay;if(bIEQuirks){this.sizeUnderlay();this.cfg.subscribeToConfigEvent("width",this.sizeUnderlay);this.cfg.subscribeToConfigEvent("height",this.sizeUnderlay);this.changeContentEvent.subscribe(this.sizeUnderlay);YAHOO.widget.Module.textResizeEvent.subscribe(this.sizeUnderlay,this,true);}
if(UA.webkit&&UA.webkit<420){this.changeContentEvent.subscribe(fixWebkitUnderlay);}
bNew=true;}}
function onBeforeShow(){var bNew=createUnderlay.call(this);if(!bNew&&bIEQuirks){this.sizeUnderlay();}
this._underlayDeferred=false;this.beforeShowEvent.unsubscribe(onBeforeShow);}
function destroyUnderlay(){if(this._underlayDeferred){this.beforeShowEvent.unsubscribe(onBeforeShow);this._underlayDeferred=false;}
if(oUnderlay){this.cfg.unsubscribeFromConfigEvent("width",this.sizeUnderlay);this.cfg.unsubscribeFromConfigEvent("height",this.sizeUnderlay);this.changeContentEvent.unsubscribe(this.sizeUnderlay);this.changeContentEvent.unsubscribe(fixWebkitUnderlay);YAHOO.widget.Module.textResizeEvent.unsubscribe(this.sizeUnderlay,this,true);this.element.removeChild(oUnderlay);this.underlay=null;}}
switch(sUnderlay){case"shadow":Dom.removeClass(oElement,"matte");Dom.addClass(oElement,"shadow");break;case"matte":if(!bMacGecko){destroyUnderlay.call(this);}
Dom.removeClass(oElement,"shadow");Dom.addClass(oElement,"matte");break;default:if(!bMacGecko){destroyUnderlay.call(this);}
Dom.removeClass(oElement,"shadow");Dom.removeClass(oElement,"matte");break;}
if((sUnderlay=="shadow")||(bMacGecko&&!oUnderlay)){if(this.cfg.getProperty("visible")){var bNew=createUnderlay.call(this);if(!bNew&&bIEQuirks){this.sizeUnderlay();}}else{if(!this._underlayDeferred){this.beforeShowEvent.subscribe(onBeforeShow);this._underlayDeferred=true;}}}},configModal:function(type,args,obj){var modal=args[0];if(modal){if(!this._hasModalityEventListeners){this.subscribe("beforeShow",this.buildMask);this.subscribe("beforeShow",this.bringToTop);this.subscribe("beforeShow",this.showMask);this.subscribe("hide",this.hideMask);Overlay.windowResizeEvent.subscribe(this.sizeMask,this,true);this._hasModalityEventListeners=true;}}else{if(this._hasModalityEventListeners){if(this.cfg.getProperty("visible")){this.hideMask();this.removeMask();}
this.unsubscribe("beforeShow",this.buildMask);this.unsubscribe("beforeShow",this.bringToTop);this.unsubscribe("beforeShow",this.showMask);this.unsubscribe("hide",this.hideMask);Overlay.windowResizeEvent.unsubscribe(this.sizeMask,this);this._hasModalityEventListeners=false;}}},removeMask:function(){var oMask=this.mask,oParentNode;if(oMask){this.hideMask();oParentNode=oMask.parentNode;if(oParentNode){oParentNode.removeChild(oMask);}
this.mask=null;}},configKeyListeners:function(type,args,obj){var listeners=args[0],listener,nListeners,i;if(listeners){if(listeners instanceof Array){nListeners=listeners.length;for(i=0;i<nListeners;i++){listener=listeners[i];if(!Config.alreadySubscribed(this.showEvent,listener.enable,listener)){this.showEvent.subscribe(listener.enable,listener,true);}
if(!Config.alreadySubscribed(this.hideEvent,listener.disable,listener)){this.hideEvent.subscribe(listener.disable,listener,true);this.destroyEvent.subscribe(listener.disable,listener,true);}}}else{if(!Config.alreadySubscribed(this.showEvent,listeners.enable,listeners)){this.showEvent.subscribe(listeners.enable,listeners,true);}
if(!Config.alreadySubscribed(this.hideEvent,listeners.disable,listeners)){this.hideEvent.subscribe(listeners.disable,listeners,true);this.destroyEvent.subscribe(listeners.disable,listeners,true);}}}},configHeight:function(type,args,obj){var height=args[0],el=this.innerElement;Dom.setStyle(el,"height",height);this.cfg.refireEvent("iframe");},configWidth:function(type,args,obj){var width=args[0],el=this.innerElement;Dom.setStyle(el,"width",width);this.cfg.refireEvent("iframe");},configzIndex:function(type,args,obj){Panel.superclass.configzIndex.call(this,type,args,obj);if(this.mask||this.cfg.getProperty("modal")===true){var panelZ=Dom.getStyle(this.element,"zIndex");if(!panelZ||isNaN(panelZ)){panelZ=0;}
if(panelZ===0){this.cfg.setProperty("zIndex",1);}else{this.stackMask();}}},buildWrapper:function(){var elementParent=this.element.parentNode,originalElement=this.element,wrapper=document.createElement("div");wrapper.className=Panel.CSS_PANEL_CONTAINER;wrapper.id=originalElement.id+"_c";if(elementParent){elementParent.insertBefore(wrapper,originalElement);}
wrapper.appendChild(originalElement);this.element=wrapper;this.innerElement=originalElement;Dom.setStyle(this.innerElement,"visibility","inherit");},sizeUnderlay:function(){var oUnderlay=this.underlay,oElement;if(oUnderlay){oElement=this.element;oUnderlay.style.width=oElement.offsetWidth+"px";oUnderlay.style.height=oElement.offsetHeight+"px";}},registerDragDrop:function(){var me=this;if(this.header){if(!DD){return;}
var bDragOnly=(this.cfg.getProperty("dragonly")===true);this.dd=new DD(this.element.id,this.id,{dragOnly:bDragOnly});if(!this.header.id){this.header.id=this.id+"_h";}
this.dd.startDrag=function(){var offsetHeight,offsetWidth,viewPortWidth,viewPortHeight,scrollX,scrollY;if(YAHOO.env.ua.ie==6){Dom.addClass(me.element,"drag");}
if(me.cfg.getProperty("constraintoviewport")){var nViewportOffset=Overlay.VIEWPORT_OFFSET;offsetHeight=me.element.offsetHeight;offsetWidth=me.element.offsetWidth;viewPortWidth=Dom.getViewportWidth();viewPortHeight=Dom.getViewportHeight();scrollX=Dom.getDocumentScrollLeft();scrollY=Dom.getDocumentScrollTop();if(offsetHeight+nViewportOffset<viewPortHeight){this.minY=scrollY+nViewportOffset;this.maxY=scrollY+viewPortHeight-offsetHeight-nViewportOffset;}else{this.minY=scrollY+nViewportOffset;this.maxY=scrollY+nViewportOffset;}
if(offsetWidth+nViewportOffset<viewPortWidth){this.minX=scrollX+nViewportOffset;this.maxX=scrollX+viewPortWidth-offsetWidth-nViewportOffset;}else{this.minX=scrollX+nViewportOffset;this.maxX=scrollX+nViewportOffset;}
this.constrainX=true;this.constrainY=true;}else{this.constrainX=false;this.constrainY=false;}
me.dragEvent.fire("startDrag",arguments);};this.dd.onDrag=function(){me.syncPosition();me.cfg.refireEvent("iframe");if(this.platform=="mac"&&YAHOO.env.ua.gecko){this.showMacGeckoScrollbars();}
me.dragEvent.fire("onDrag",arguments);};this.dd.endDrag=function(){if(YAHOO.env.ua.ie==6){Dom.removeClass(me.element,"drag");}
me.dragEvent.fire("endDrag",arguments);me.moveEvent.fire(me.cfg.getProperty("xy"));};this.dd.setHandleElId(this.header.id);this.dd.addInvalidHandleType("INPUT");this.dd.addInvalidHandleType("SELECT");this.dd.addInvalidHandleType("TEXTAREA");}},buildMask:function(){var oMask=this.mask;if(!oMask){if(!m_oMaskTemplate){m_oMaskTemplate=document.createElement("div");m_oMaskTemplate.className="mask";m_oMaskTemplate.innerHTML="&#160;";}
oMask=m_oMaskTemplate.cloneNode(true);oMask.id=this.id+"_mask";document.body.insertBefore(oMask,document.body.firstChild);this.mask=oMask;if(YAHOO.env.ua.gecko&&this.platform=="mac"){Dom.addClass(this.mask,"block-scrollbars");}
this.stackMask();}},hideMask:function(){if(this.cfg.getProperty("modal")&&this.mask){this.mask.style.display="none";this.hideMaskEvent.fire();Dom.removeClass(document.body,"masked");}},showMask:function(){if(this.cfg.getProperty("modal")&&this.mask){Dom.addClass(document.body,"masked");this.sizeMask();this.mask.style.display="block";this.showMaskEvent.fire();}},sizeMask:function(){if(this.mask){this.mask.style.height=Dom.getDocumentHeight()+"px";this.mask.style.width=Dom.getDocumentWidth()+"px";}},stackMask:function(){if(this.mask){var panelZ=Dom.getStyle(this.element,"zIndex");if(!YAHOO.lang.isUndefined(panelZ)&&!isNaN(panelZ)){Dom.setStyle(this.mask,"zIndex",panelZ-1);}}},render:function(appendToNode){return Panel.superclass.render.call(this,appendToNode,this.innerElement);},destroy:function(){Overlay.windowResizeEvent.unsubscribe(this.sizeMask,this);this.removeMask();if(this.close){Event.purgeElement(this.close);}
Panel.superclass.destroy.call(this);},toString:function(){return"Panel "+this.id;}});}());(function(){YAHOO.widget.Dialog=function(el,userConfig){YAHOO.widget.Dialog.superclass.constructor.call(this,el,userConfig);};var Event=YAHOO.util.Event,CustomEvent=YAHOO.util.CustomEvent,Dom=YAHOO.util.Dom,KeyListener=YAHOO.util.KeyListener,Connect=YAHOO.util.Connect,Dialog=YAHOO.widget.Dialog,Lang=YAHOO.lang,EVENT_TYPES={"BEFORE_SUBMIT":"beforeSubmit","SUBMIT":"submit","MANUAL_SUBMIT":"manualSubmit","ASYNC_SUBMIT":"asyncSubmit","FORM_SUBMIT":"formSubmit","CANCEL":"cancel"},DEFAULT_CONFIG={"POST_METHOD":{key:"postmethod",value:"async"},"BUTTONS":{key:"buttons",value:"none"},"HIDEAFTERSUBMIT":{key:"hideaftersubmit",value:true}};Dialog.CSS_DIALOG="yui-dialog";function removeButtonEventHandlers(){var aButtons=this._aButtons,nButtons,oButton,i;if(Lang.isArray(aButtons)){nButtons=aButtons.length;if(nButtons>0){i=nButtons-1;do{oButton=aButtons[i];if(YAHOO.widget.Button&&oButton instanceof YAHOO.widget.Button){oButton.destroy();}
else if(oButton.tagName.toUpperCase()=="BUTTON"){Event.purgeElement(oButton);Event.purgeElement(oButton,false);}}
while(i--);}}}
YAHOO.extend(Dialog,YAHOO.widget.Panel,{form:null,initDefaultConfig:function(){Dialog.superclass.initDefaultConfig.call(this);this.callback={success:null,failure:null,argument:null};this.cfg.addProperty(DEFAULT_CONFIG.POST_METHOD.key,{handler:this.configPostMethod,value:DEFAULT_CONFIG.POST_METHOD.value,validator:function(val){if(val!="form"&&val!="async"&&val!="none"&&val!="manual"){return false;}else{return true;}}});this.cfg.addProperty(DEFAULT_CONFIG.HIDEAFTERSUBMIT.key,{value:DEFAULT_CONFIG.HIDEAFTERSUBMIT.value});this.cfg.addProperty(DEFAULT_CONFIG.BUTTONS.key,{handler:this.configButtons,value:DEFAULT_CONFIG.BUTTONS.value});},initEvents:function(){Dialog.superclass.initEvents.call(this);var SIGNATURE=CustomEvent.LIST;this.beforeSubmitEvent=this.createEvent(EVENT_TYPES.BEFORE_SUBMIT);this.beforeSubmitEvent.signature=SIGNATURE;this.submitEvent=this.createEvent(EVENT_TYPES.SUBMIT);this.submitEvent.signature=SIGNATURE;this.manualSubmitEvent=this.createEvent(EVENT_TYPES.MANUAL_SUBMIT);this.manualSubmitEvent.signature=SIGNATURE;this.asyncSubmitEvent=this.createEvent(EVENT_TYPES.ASYNC_SUBMIT);this.asyncSubmitEvent.signature=SIGNATURE;this.formSubmitEvent=this.createEvent(EVENT_TYPES.FORM_SUBMIT);this.formSubmitEvent.signature=SIGNATURE;this.cancelEvent=this.createEvent(EVENT_TYPES.CANCEL);this.cancelEvent.signature=SIGNATURE;},init:function(el,userConfig){Dialog.superclass.init.call(this,el);this.beforeInitEvent.fire(Dialog);Dom.addClass(this.element,Dialog.CSS_DIALOG);this.cfg.setProperty("visible",false);if(userConfig){this.cfg.applyConfig(userConfig,true);}
this.showEvent.subscribe(this.focusFirst,this,true);this.beforeHideEvent.subscribe(this.blurButtons,this,true);this.subscribe("changeBody",this.registerForm);this.initEvent.fire(Dialog);},doSubmit:function(){var oForm=this.form,bUseFileUpload=false,bUseSecureFileUpload=false,aElements,nElements,i,sMethod;switch(this.cfg.getProperty("postmethod")){case"async":aElements=oForm.elements;nElements=aElements.length;if(nElements>0){i=nElements-1;do{if(aElements[i].type=="file"){bUseFileUpload=true;break;}}
while(i--);}
if(bUseFileUpload&&YAHOO.env.ua.ie&&this.isSecure){bUseSecureFileUpload=true;}
sMethod=(oForm.getAttribute("method")||"POST").toUpperCase();Connect.setForm(oForm,bUseFileUpload,bUseSecureFileUpload);Connect.asyncRequest(sMethod,oForm.getAttribute("action"),this.callback);this.asyncSubmitEvent.fire();break;case"form":oForm.submit();this.formSubmitEvent.fire();break;case"none":case"manual":this.manualSubmitEvent.fire();break;}},registerForm:function(){var form=this.element.getElementsByTagName("form")[0],me=this,firstElement,lastElement;if(this.form){if(this.form==form&&Dom.isAncestor(this.element,this.form)){return;}else{Event.purgeElement(this.form);this.form=null;}}
if(!form){form=document.createElement("form");form.name="frm_"+this.id;this.body.appendChild(form);}
if(form){this.form=form;Event.on(form,"submit",function(e){Event.stopEvent(e);this.submit();this.form.blur();},this,true);this.firstFormElement=function(){var f,el,nElements=form.elements.length;for(f=0;f<nElements;f++){el=form.elements[f];if(el.focus&&!el.disabled&&el.type!="hidden"){return el;}}
return null;}();this.lastFormElement=function(){var f,el,nElements=form.elements.length;for(f=nElements-1;f>=0;f--){el=form.elements[f];if(el.focus&&!el.disabled&&el.type!="hidden"){return el;}}
return null;}();if(this.cfg.getProperty("modal")){firstElement=this.firstFormElement||this.firstButton;if(firstElement){this.preventBackTab=new KeyListener(firstElement,{shift:true,keys:9},{fn:me.focusLast,scope:me,correctScope:true});this.showEvent.subscribe(this.preventBackTab.enable,this.preventBackTab,true);this.hideEvent.subscribe(this.preventBackTab.disable,this.preventBackTab,true);}
lastElement=this.lastButton||this.lastFormElement;if(lastElement){this.preventTabOut=new KeyListener(lastElement,{shift:false,keys:9},{fn:me.focusFirst,scope:me,correctScope:true});this.showEvent.subscribe(this.preventTabOut.enable,this.preventTabOut,true);this.hideEvent.subscribe(this.preventTabOut.disable,this.preventTabOut,true);}}}},configClose:function(type,args,obj){var val=args[0];function doCancel(e,obj){obj.cancel();}
if(val){if(!this.close){this.close=document.createElement("div");Dom.addClass(this.close,"container-close");this.close.innerHTML="&#160;";this.innerElement.appendChild(this.close);Event.on(this.close,"click",doCancel,this);}else{this.close.style.display="block";}}else{if(this.close){this.close.style.display="none";}}},configButtons:function(type,args,obj){var Button=YAHOO.widget.Button,aButtons=args[0],oInnerElement=this.innerElement,oButton,oButtonEl,oYUIButton,nButtons,oSpan,oFooter,i;removeButtonEventHandlers.call(this);this._aButtons=null;if(Lang.isArray(aButtons)){oSpan=document.createElement("span");oSpan.className="button-group";nButtons=aButtons.length;this._aButtons=[];for(i=0;i<nButtons;i++){oButton=aButtons[i];if(Button){oYUIButton=new Button({label:oButton.text,container:oSpan});oButtonEl=oYUIButton.get("element");if(oButton.isDefault){oYUIButton.addClass("default");this.defaultHtmlButton=oButtonEl;}
if(Lang.isFunction(oButton.handler)){oYUIButton.set("onclick",{fn:oButton.handler,obj:this,scope:this});}
else if(Lang.isObject(oButton.handler)&&Lang.isFunction(oButton.handler.fn)){oYUIButton.set("onclick",{fn:oButton.handler.fn,obj:((!Lang.isUndefined(oButton.handler.obj))?oButton.handler.obj:this),scope:(oButton.handler.scope||this)});}
this._aButtons[this._aButtons.length]=oYUIButton;}
else{oButtonEl=document.createElement("button");oButtonEl.setAttribute("type","button");if(oButton.isDefault){oButtonEl.className="default";this.defaultHtmlButton=oButtonEl;}
oButtonEl.innerHTML=oButton.text;if(Lang.isFunction(oButton.handler)){Event.on(oButtonEl,"click",oButton.handler,this,true);}
else if(Lang.isObject(oButton.handler)&&Lang.isFunction(oButton.handler.fn)){Event.on(oButtonEl,"click",oButton.handler.fn,((!Lang.isUndefined(oButton.handler.obj))?oButton.handler.obj:this),(oButton.handler.scope||this));}
oSpan.appendChild(oButtonEl);this._aButtons[this._aButtons.length]=oButtonEl;}
oButton.htmlButton=oButtonEl;if(i===0){this.firstButton=oButtonEl;}
if(i==(nButtons-1)){this.lastButton=oButtonEl;}}
this.setFooter(oSpan);oFooter=this.footer;if(Dom.inDocument(this.element)&&!Dom.isAncestor(oInnerElement,oFooter)){oInnerElement.appendChild(oFooter);}
this.buttonSpan=oSpan;}else{oSpan=this.buttonSpan;oFooter=this.footer;if(oSpan&&oFooter){oFooter.removeChild(oSpan);this.buttonSpan=null;this.firstButton=null;this.lastButton=null;this.defaultHtmlButton=null;}}
this.cfg.refireEvent("iframe");this.cfg.refireEvent("underlay");},getButtons:function(){var aButtons=this._aButtons;if(aButtons){return aButtons;}},focusFirst:function(type,args,obj){var oElement=this.firstFormElement,oEvent;if(args){oEvent=args[1];if(oEvent){Event.stopEvent(oEvent);}}
if(oElement){try{oElement.focus();}
catch(oException){}}else{this.focusDefaultButton();}},focusLast:function(type,args,obj){var aButtons=this.cfg.getProperty("buttons"),oElement=this.lastFormElement,oEvent;if(args){oEvent=args[1];if(oEvent){Event.stopEvent(oEvent);}}
if(aButtons&&Lang.isArray(aButtons)){this.focusLastButton();}else{if(oElement){try{oElement.focus();}catch(oException){}}}},focusDefaultButton:function(){var oElement=this.defaultHtmlButton;if(oElement){try{oElement.focus();}catch(oException){}}},blurButtons:function(){var aButtons=this.cfg.getProperty("buttons"),nButtons,oButton,oElement,i;if(aButtons&&Lang.isArray(aButtons)){nButtons=aButtons.length;if(nButtons>0){i=(nButtons-1);do{oButton=aButtons[i];if(oButton){oElement=oButton.htmlButton;if(oElement){try{oElement.blur();}catch(oException){}}}}while(i--);}}},focusFirstButton:function(){var aButtons=this.cfg.getProperty("buttons"),oButton,oElement;if(aButtons&&Lang.isArray(aButtons)){oButton=aButtons[0];if(oButton){oElement=oButton.htmlButton;if(oElement){try{oElement.focus();}
catch(oException){}}}}},focusLastButton:function(){var aButtons=this.cfg.getProperty("buttons"),nButtons,oButton,oElement;if(aButtons&&Lang.isArray(aButtons)){nButtons=aButtons.length;if(nButtons>0){oButton=aButtons[(nButtons-1)];if(oButton){oElement=oButton.htmlButton;if(oElement){try{oElement.focus();}catch(oException){}}}}}},configPostMethod:function(type,args,obj){this.registerForm();},validate:function(){return true;},submit:function(){if(this.validate()){this.beforeSubmitEvent.fire();this.doSubmit();this.submitEvent.fire();if(this.cfg.getProperty("hideaftersubmit")){this.hide();}
return true;}else{return false;}},cancel:function(){this.cancelEvent.fire();this.hide();},getData:function(){var oForm=this.form,aElements,nTotalElements,oData,sName,oElement,nElements,sType,sTagName,aOptions,nOptions,aValues,oOption,sValue,oRadio,oCheckbox,i,n;function isFormElement(p_oElement){var sTag=p_oElement.tagName.toUpperCase();return((sTag=="INPUT"||sTag=="TEXTAREA"||sTag=="SELECT")&&p_oElement.name==sName);}
if(oForm){aElements=oForm.elements;nTotalElements=aElements.length;oData={};for(i=0;i<nTotalElements;i++){sName=aElements[i].name;oElement=Dom.getElementsBy(isFormElement,"*",oForm);nElements=oElement.length;if(nElements>0){if(nElements==1){oElement=oElement[0];sType=oElement.type;sTagName=oElement.tagName.toUpperCase();switch(sTagName){case"INPUT":if(sType=="checkbox"){oData[sName]=oElement.checked;}
else if(sType!="radio"){oData[sName]=oElement.value;}
break;case"TEXTAREA":oData[sName]=oElement.value;break;case"SELECT":aOptions=oElement.options;nOptions=aOptions.length;aValues=[];for(n=0;n<nOptions;n++){oOption=aOptions[n];if(oOption.selected){sValue=oOption.value;if(!sValue||sValue===""){sValue=oOption.text;}
aValues[aValues.length]=sValue;}}
oData[sName]=aValues;break;}}
else{sType=oElement[0].type;switch(sType){case"radio":for(n=0;n<nElements;n++){oRadio=oElement[n];if(oRadio.checked){oData[sName]=oRadio.value;break;}}
break;case"checkbox":aValues=[];for(n=0;n<nElements;n++){oCheckbox=oElement[n];if(oCheckbox.checked){aValues[aValues.length]=oCheckbox.value;}}
oData[sName]=aValues;break;}}}}}
return oData;},destroy:function(){removeButtonEventHandlers.call(this);this._aButtons=null;var aForms=this.element.getElementsByTagName("form"),oForm;if(aForms.length>0){oForm=aForms[0];if(oForm){Event.purgeElement(oForm);if(oForm.parentNode){oForm.parentNode.removeChild(oForm);}
this.form=null;}}
Dialog.superclass.destroy.call(this);},toString:function(){return"Dialog "+this.id;}});}());(function(){YAHOO.widget.SimpleDialog=function(el,userConfig){YAHOO.widget.SimpleDialog.superclass.constructor.call(this,el,userConfig);};var Dom=YAHOO.util.Dom,SimpleDialog=YAHOO.widget.SimpleDialog,DEFAULT_CONFIG={"ICON":{key:"icon",value:"none",suppressEvent:true},"TEXT":{key:"text",value:"",suppressEvent:true,supercedes:["icon"]}};SimpleDialog.ICON_BLOCK="blckicon";SimpleDialog.ICON_ALARM="alrticon";SimpleDialog.ICON_HELP="hlpicon";SimpleDialog.ICON_INFO="infoicon";SimpleDialog.ICON_WARN="warnicon";SimpleDialog.ICON_TIP="tipicon";SimpleDialog.ICON_CSS_CLASSNAME="yui-icon";SimpleDialog.CSS_SIMPLEDIALOG="yui-simple-dialog";YAHOO.extend(SimpleDialog,YAHOO.widget.Dialog,{initDefaultConfig:function(){SimpleDialog.superclass.initDefaultConfig.call(this);this.cfg.addProperty(DEFAULT_CONFIG.ICON.key,{handler:this.configIcon,value:DEFAULT_CONFIG.ICON.value,suppressEvent:DEFAULT_CONFIG.ICON.suppressEvent});this.cfg.addProperty(DEFAULT_CONFIG.TEXT.key,{handler:this.configText,value:DEFAULT_CONFIG.TEXT.value,suppressEvent:DEFAULT_CONFIG.TEXT.suppressEvent,supercedes:DEFAULT_CONFIG.TEXT.supercedes});},init:function(el,userConfig){SimpleDialog.superclass.init.call(this,el);this.beforeInitEvent.fire(SimpleDialog);Dom.addClass(this.element,SimpleDialog.CSS_SIMPLEDIALOG);this.cfg.queueProperty("postmethod","manual");if(userConfig){this.cfg.applyConfig(userConfig,true);}
this.beforeRenderEvent.subscribe(function(){if(!this.body){this.setBody("");}},this,true);this.initEvent.fire(SimpleDialog);},registerForm:function(){SimpleDialog.superclass.registerForm.call(this);this.form.innerHTML+="<input type=\"hidden\" name=\""+
this.id+"\" value=\"\"/>";},configIcon:function(type,args,obj){var sIcon=args[0],oBody=this.body,sCSSClass=SimpleDialog.ICON_CSS_CLASSNAME,oIcon,oIconParent;if(sIcon&&sIcon!="none"){oIcon=Dom.getElementsByClassName(sCSSClass,"*",oBody);if(oIcon){oIconParent=oIcon.parentNode;if(oIconParent){oIconParent.removeChild(oIcon);oIcon=null;}}
if(sIcon.indexOf(".")==-1){oIcon=document.createElement("span");oIcon.className=(sCSSClass+" "+sIcon);oIcon.innerHTML="&#160;";}else{oIcon=document.createElement("img");oIcon.src=(this.imageRoot+sIcon);oIcon.className=sCSSClass;}
if(oIcon){oBody.insertBefore(oIcon,oBody.firstChild);}}},configText:function(type,args,obj){var text=args[0];if(text){this.setBody(text);this.cfg.refireEvent("icon");}},toString:function(){return"SimpleDialog "+this.id;}});}());(function(){YAHOO.widget.ContainerEffect=function(overlay,attrIn,attrOut,targetElement,animClass){if(!animClass){animClass=YAHOO.util.Anim;}
this.overlay=overlay;this.attrIn=attrIn;this.attrOut=attrOut;this.targetElement=targetElement||overlay.element;this.animClass=animClass;};var Dom=YAHOO.util.Dom,CustomEvent=YAHOO.util.CustomEvent,Easing=YAHOO.util.Easing,ContainerEffect=YAHOO.widget.ContainerEffect;ContainerEffect.FADE=function(overlay,dur){var fin={attributes:{opacity:{from:0,to:1}},duration:dur,method:Easing.easeIn};var fout={attributes:{opacity:{to:0}},duration:dur,method:Easing.easeOut};var fade=new ContainerEffect(overlay,fin,fout,overlay.element);fade.handleUnderlayStart=function(){var underlay=this.overlay.underlay;if(underlay&&YAHOO.env.ua.ie){var hasFilters=(underlay.filters&&underlay.filters.length>0);if(hasFilters){Dom.addClass(overlay.element,"yui-effect-fade");}}};fade.handleUnderlayComplete=function(){var underlay=this.overlay.underlay;if(underlay&&YAHOO.env.ua.ie){Dom.removeClass(overlay.element,"yui-effect-fade");}};fade.handleStartAnimateIn=function(type,args,obj){Dom.addClass(obj.overlay.element,"hide-select");if(!obj.overlay.underlay){obj.overlay.cfg.refireEvent("underlay");}
obj.handleUnderlayStart();Dom.setStyle(obj.overlay.element,"visibility","visible");Dom.setStyle(obj.overlay.element,"opacity",0);};fade.handleCompleteAnimateIn=function(type,args,obj){Dom.removeClass(obj.overlay.element,"hide-select");if(obj.overlay.element.style.filter){obj.overlay.element.style.filter=null;}
obj.handleUnderlayComplete();obj.overlay.cfg.refireEvent("iframe");obj.animateInCompleteEvent.fire();};fade.handleStartAnimateOut=function(type,args,obj){Dom.addClass(obj.overlay.element,"hide-select");obj.handleUnderlayStart();};fade.handleCompleteAnimateOut=function(type,args,obj){Dom.removeClass(obj.overlay.element,"hide-select");if(obj.overlay.element.style.filter){obj.overlay.element.style.filter=null;}
Dom.setStyle(obj.overlay.element,"visibility","hidden");Dom.setStyle(obj.overlay.element,"opacity",1);obj.handleUnderlayComplete();obj.overlay.cfg.refireEvent("iframe");obj.animateOutCompleteEvent.fire();};fade.init();return fade;};ContainerEffect.SLIDE=function(overlay,dur){var x=overlay.cfg.getProperty("x")||Dom.getX(overlay.element),y=overlay.cfg.getProperty("y")||Dom.getY(overlay.element),clientWidth=Dom.getClientWidth(),offsetWidth=overlay.element.offsetWidth,slide=new ContainerEffect(overlay,{attributes:{points:{to:[x,y]}},duration:dur,method:Easing.easeIn},{attributes:{points:{to:[(clientWidth+25),y]}},duration:dur,method:Easing.easeOut},overlay.element,YAHOO.util.Motion);slide.handleStartAnimateIn=function(type,args,obj){obj.overlay.element.style.left=((-25)-offsetWidth)+"px";obj.overlay.element.style.top=y+"px";};slide.handleTweenAnimateIn=function(type,args,obj){var pos=Dom.getXY(obj.overlay.element),currentX=pos[0],currentY=pos[1];if(Dom.getStyle(obj.overlay.element,"visibility")=="hidden"&&currentX<x){Dom.setStyle(obj.overlay.element,"visibility","visible");}
obj.overlay.cfg.setProperty("xy",[currentX,currentY],true);obj.overlay.cfg.refireEvent("iframe");};slide.handleCompleteAnimateIn=function(type,args,obj){obj.overlay.cfg.setProperty("xy",[x,y],true);obj.startX=x;obj.startY=y;obj.overlay.cfg.refireEvent("iframe");obj.animateInCompleteEvent.fire();};slide.handleStartAnimateOut=function(type,args,obj){var vw=Dom.getViewportWidth(),pos=Dom.getXY(obj.overlay.element),yso=pos[1];obj.animOut.attributes.points.to=[(vw+25),yso];};slide.handleTweenAnimateOut=function(type,args,obj){var pos=Dom.getXY(obj.overlay.element),xto=pos[0],yto=pos[1];obj.overlay.cfg.setProperty("xy",[xto,yto],true);obj.overlay.cfg.refireEvent("iframe");};slide.handleCompleteAnimateOut=function(type,args,obj){Dom.setStyle(obj.overlay.element,"visibility","hidden");obj.overlay.cfg.setProperty("xy",[x,y]);obj.animateOutCompleteEvent.fire();};slide.init();return slide;};ContainerEffect.prototype={init:function(){this.beforeAnimateInEvent=this.createEvent("beforeAnimateIn");this.beforeAnimateInEvent.signature=CustomEvent.LIST;this.beforeAnimateOutEvent=this.createEvent("beforeAnimateOut");this.beforeAnimateOutEvent.signature=CustomEvent.LIST;this.animateInCompleteEvent=this.createEvent("animateInComplete");this.animateInCompleteEvent.signature=CustomEvent.LIST;this.animateOutCompleteEvent=this.createEvent("animateOutComplete");this.animateOutCompleteEvent.signature=CustomEvent.LIST;this.animIn=new this.animClass(this.targetElement,this.attrIn.attributes,this.attrIn.duration,this.attrIn.method);this.animIn.onStart.subscribe(this.handleStartAnimateIn,this);this.animIn.onTween.subscribe(this.handleTweenAnimateIn,this);this.animIn.onComplete.subscribe(this.handleCompleteAnimateIn,this);this.animOut=new this.animClass(this.targetElement,this.attrOut.attributes,this.attrOut.duration,this.attrOut.method);this.animOut.onStart.subscribe(this.handleStartAnimateOut,this);this.animOut.onTween.subscribe(this.handleTweenAnimateOut,this);this.animOut.onComplete.subscribe(this.handleCompleteAnimateOut,this);},animateIn:function(){this.beforeAnimateInEvent.fire();this.animIn.animate();},animateOut:function(){this.beforeAnimateOutEvent.fire();this.animOut.animate();},handleStartAnimateIn:function(type,args,obj){},handleTweenAnimateIn:function(type,args,obj){},handleCompleteAnimateIn:function(type,args,obj){},handleStartAnimateOut:function(type,args,obj){},handleTweenAnimateOut:function(type,args,obj){},handleCompleteAnimateOut:function(type,args,obj){},toString:function(){var output="ContainerEffect";if(this.overlay){output+=" ["+this.overlay.toString()+"]";}
return output;}};YAHOO.lang.augmentProto(ContainerEffect,YAHOO.util.EventProvider);})();YAHOO.register("container",YAHOO.widget.Module,{version:"2.5.2",build:"1076"});

(function(){var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event;YAHOO.widget.MenuManager=function(){var m_bInitializedEventHandlers=false,m_oMenus={},m_oVisibleMenus={},m_oItems={},m_oEventTypes={"click":"clickEvent","mousedown":"mouseDownEvent","mouseup":"mouseUpEvent","mouseover":"mouseOverEvent","mouseout":"mouseOutEvent","keydown":"keyDownEvent","keyup":"keyUpEvent","keypress":"keyPressEvent"},m_oFocusedMenuItem=null;function getMenuRootElement(p_oElement){var oParentNode;if(p_oElement&&p_oElement.tagName){switch(p_oElement.tagName.toUpperCase()){case"DIV":oParentNode=p_oElement.parentNode;if((Dom.hasClass(p_oElement,"hd")||Dom.hasClass(p_oElement,"bd")||Dom.hasClass(p_oElement,"ft"))&&oParentNode&&oParentNode.tagName&&oParentNode.tagName.toUpperCase()=="DIV")
{return oParentNode;}
else{return p_oElement;}
break;case"LI":return p_oElement;default:oParentNode=p_oElement.parentNode;if(oParentNode){return getMenuRootElement(oParentNode);}
break;}}}
function onDOMEvent(p_oEvent){var oTarget=Event.getTarget(p_oEvent),oElement=getMenuRootElement(oTarget),sCustomEventType,sTagName,sId,oMenuItem,oMenu;if(oElement){sTagName=oElement.tagName.toUpperCase();if(sTagName=="LI"){sId=oElement.id;if(sId&&m_oItems[sId]){oMenuItem=m_oItems[sId];oMenu=oMenuItem.parent;}}
else if(sTagName=="DIV"){if(oElement.id){oMenu=m_oMenus[oElement.id];}}}
if(oMenu){sCustomEventType=m_oEventTypes[p_oEvent.type];if(oMenuItem&&!oMenuItem.cfg.getProperty("disabled")){oMenuItem[sCustomEventType].fire(p_oEvent);if(p_oEvent.type=="keyup"||p_oEvent.type=="mousedown")
{if(m_oFocusedMenuItem!=oMenuItem){if(m_oFocusedMenuItem){m_oFocusedMenuItem.blurEvent.fire();}
oMenuItem.focusEvent.fire();}}}
oMenu[sCustomEventType].fire(p_oEvent,oMenuItem);}
else if(p_oEvent.type=="mousedown"){if(m_oFocusedMenuItem){m_oFocusedMenuItem.blurEvent.fire();m_oFocusedMenuItem=null;}
for(var i in m_oVisibleMenus){if(YAHOO.lang.hasOwnProperty(m_oVisibleMenus,i)){oMenu=m_oVisibleMenus[i];if(oMenu.cfg.getProperty("clicktohide")&&!(oMenu instanceof YAHOO.widget.MenuBar)&&oMenu.cfg.getProperty("position")=="dynamic"){oMenu.hide();}
else{if(oMenu.cfg.getProperty("showdelay")>0){oMenu._cancelShowDelay();}
if(oMenu.activeItem){oMenu.activeItem.blur();oMenu.activeItem.cfg.setProperty("selected",false);oMenu.activeItem=null;}}}}}
else if(p_oEvent.type=="keyup"){if(m_oFocusedMenuItem){m_oFocusedMenuItem.blurEvent.fire();m_oFocusedMenuItem=null;}}}
function onMenuDestroy(p_sType,p_aArgs,p_oMenu){if(m_oMenus[p_oMenu.id]){this.removeMenu(p_oMenu);}}
function onMenuFocus(p_sType,p_aArgs){var oItem=p_aArgs[0];if(oItem){m_oFocusedMenuItem=oItem;}}
function onMenuBlur(p_sType,p_aArgs){m_oFocusedMenuItem=null;}
function onMenuVisibleConfigChange(p_sType,p_aArgs){var bVisible=p_aArgs[0],sId=this.id;if(bVisible){m_oVisibleMenus[sId]=this;}
else if(m_oVisibleMenus[sId]){delete m_oVisibleMenus[sId];}}
function onItemDestroy(p_sType,p_aArgs){removeItem(this);}
function removeItem(p_oMenuItem){var sId=p_oMenuItem.id;if(sId&&m_oItems[sId]){if(m_oFocusedMenuItem==p_oMenuItem){m_oFocusedMenuItem=null;}
delete m_oItems[sId];p_oMenuItem.destroyEvent.unsubscribe(onItemDestroy);}}
function onItemAdded(p_sType,p_aArgs){var oItem=p_aArgs[0],sId;if(oItem instanceof YAHOO.widget.MenuItem){sId=oItem.id;if(!m_oItems[sId]){m_oItems[sId]=oItem;oItem.destroyEvent.subscribe(onItemDestroy);}}}
return{addMenu:function(p_oMenu){var oDoc;if(p_oMenu instanceof YAHOO.widget.Menu&&p_oMenu.id&&!m_oMenus[p_oMenu.id]){m_oMenus[p_oMenu.id]=p_oMenu;if(!m_bInitializedEventHandlers){oDoc=document;Event.on(oDoc,"mouseover",onDOMEvent,this,true);Event.on(oDoc,"mouseout",onDOMEvent,this,true);Event.on(oDoc,"mousedown",onDOMEvent,this,true);Event.on(oDoc,"mouseup",onDOMEvent,this,true);Event.on(oDoc,"click",onDOMEvent,this,true);Event.on(oDoc,"keydown",onDOMEvent,this,true);Event.on(oDoc,"keyup",onDOMEvent,this,true);Event.on(oDoc,"keypress",onDOMEvent,this,true);m_bInitializedEventHandlers=true;}
p_oMenu.cfg.subscribeToConfigEvent("visible",onMenuVisibleConfigChange);p_oMenu.destroyEvent.subscribe(onMenuDestroy,p_oMenu,this);p_oMenu.itemAddedEvent.subscribe(onItemAdded);p_oMenu.focusEvent.subscribe(onMenuFocus);p_oMenu.blurEvent.subscribe(onMenuBlur);}},removeMenu:function(p_oMenu){var sId,aItems,i;if(p_oMenu){sId=p_oMenu.id;if(m_oMenus[sId]==p_oMenu){aItems=p_oMenu.getItems();if(aItems&&aItems.length>0){i=aItems.length-1;do{removeItem(aItems[i]);}
while(i--);}
delete m_oMenus[sId];if(m_oVisibleMenus[sId]==p_oMenu){delete m_oVisibleMenus[sId];}
if(p_oMenu.cfg){p_oMenu.cfg.unsubscribeFromConfigEvent("visible",onMenuVisibleConfigChange);}
p_oMenu.destroyEvent.unsubscribe(onMenuDestroy,p_oMenu);p_oMenu.itemAddedEvent.unsubscribe(onItemAdded);p_oMenu.focusEvent.unsubscribe(onMenuFocus);p_oMenu.blurEvent.unsubscribe(onMenuBlur);}}},hideVisible:function(){var oMenu;for(var i in m_oVisibleMenus){if(YAHOO.lang.hasOwnProperty(m_oVisibleMenus,i)){oMenu=m_oVisibleMenus[i];if(!(oMenu instanceof YAHOO.widget.MenuBar)&&oMenu.cfg.getProperty("position")=="dynamic"){oMenu.hide();}}}},getVisible:function(){return m_oVisibleMenus;},getMenus:function(){return m_oMenus;},getMenu:function(p_sId){var oMenu=m_oMenus[p_sId];if(oMenu){return oMenu;}},getMenuItem:function(p_sId){var oItem=m_oItems[p_sId];if(oItem){return oItem;}},getMenuItemGroup:function(p_sId){var oUL=Dom.get(p_sId),aItems,oNode,oItem,sId;if(oUL&&oUL.tagName&&oUL.tagName.toUpperCase()=="UL"){oNode=oUL.firstChild;if(oNode){aItems=[];do{sId=oNode.id;if(sId){oItem=this.getMenuItem(sId);if(oItem){aItems[aItems.length]=oItem;}}}
while((oNode=oNode.nextSibling));if(aItems.length>0){return aItems;}}}},getFocusedMenuItem:function(){return m_oFocusedMenuItem;},getFocusedMenu:function(){if(m_oFocusedMenuItem){return(m_oFocusedMenuItem.parent.getRoot());}},toString:function(){return"MenuManager";}};}();})();(function(){YAHOO.widget.Menu=function(p_oElement,p_oConfig){if(p_oConfig){this.parent=p_oConfig.parent;this.lazyLoad=p_oConfig.lazyLoad||p_oConfig.lazyload;this.itemData=p_oConfig.itemData||p_oConfig.itemdata;}
YAHOO.widget.Menu.superclass.constructor.call(this,p_oElement,p_oConfig);};function checkPosition(p_sPosition){if(typeof p_sPosition=="string"){return("dynamic,static".indexOf((p_sPosition.toLowerCase()))!=-1);}}
var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event,Module=YAHOO.widget.Module,Overlay=YAHOO.widget.Overlay,Menu=YAHOO.widget.Menu,MenuManager=YAHOO.widget.MenuManager,CustomEvent=YAHOO.util.CustomEvent,Lang=YAHOO.lang,UA=YAHOO.env.ua,m_oShadowTemplate,EVENT_TYPES={"MOUSE_OVER":"mouseover","MOUSE_OUT":"mouseout","MOUSE_DOWN":"mousedown","MOUSE_UP":"mouseup","CLICK":"click","KEY_PRESS":"keypress","KEY_DOWN":"keydown","KEY_UP":"keyup","FOCUS":"focus","BLUR":"blur","ITEM_ADDED":"itemAdded","ITEM_REMOVED":"itemRemoved"},DEFAULT_CONFIG={"VISIBLE":{key:"visible",value:false,validator:Lang.isBoolean},"CONSTRAIN_TO_VIEWPORT":{key:"constraintoviewport",value:true,validator:Lang.isBoolean,supercedes:["iframe","x","y","xy"]},"POSITION":{key:"position",value:"dynamic",validator:checkPosition,supercedes:["visible","iframe"]},"SUBMENU_ALIGNMENT":{key:"submenualignment",value:["tl","tr"],suppressEvent:true},"AUTO_SUBMENU_DISPLAY":{key:"autosubmenudisplay",value:true,validator:Lang.isBoolean,suppressEvent:true},"SHOW_DELAY":{key:"showdelay",value:250,validator:Lang.isNumber,suppressEvent:true},"HIDE_DELAY":{key:"hidedelay",value:0,validator:Lang.isNumber,suppressEvent:true},"SUBMENU_HIDE_DELAY":{key:"submenuhidedelay",value:250,validator:Lang.isNumber,suppressEvent:true},"CLICK_TO_HIDE":{key:"clicktohide",value:true,validator:Lang.isBoolean,suppressEvent:true},"CONTAINER":{key:"container",suppressEvent:true},"SCROLL_INCREMENT":{key:"scrollincrement",value:1,validator:Lang.isNumber,supercedes:["maxheight"],suppressEvent:true},"MIN_SCROLL_HEIGHT":{key:"minscrollheight",value:90,validator:Lang.isNumber,supercedes:["maxheight"],suppressEvent:true},"MAX_HEIGHT":{key:"maxheight",value:0,validator:Lang.isNumber,supercedes:["iframe"],suppressEvent:true},"CLASS_NAME":{key:"classname",value:null,validator:Lang.isString,suppressEvent:true},"DISABLED":{key:"disabled",value:false,validator:Lang.isBoolean,suppressEvent:true}};YAHOO.lang.extend(Menu,Overlay,{CSS_CLASS_NAME:"yuimenu",ITEM_TYPE:null,GROUP_TITLE_TAG_NAME:"h6",OFF_SCREEN_POSITION:[-10000,-10000],_nHideDelayId:null,_nShowDelayId:null,_nSubmenuHideDelayId:null,_nBodyScrollId:null,_bHideDelayEventHandlersAssigned:false,_bHandledMouseOverEvent:false,_bHandledMouseOutEvent:false,_aGroupTitleElements:null,_aItemGroups:null,_aListElements:null,_nCurrentMouseX:0,_bStopMouseEventHandlers:false,_sClassName:null,lazyLoad:false,itemData:null,activeItem:null,parent:null,srcElement:null,mouseOverEvent:null,mouseOutEvent:null,mouseDownEvent:null,mouseUpEvent:null,clickEvent:null,keyPressEvent:null,keyDownEvent:null,keyUpEvent:null,itemAddedEvent:null,itemRemovedEvent:null,init:function(p_oElement,p_oConfig){this._aItemGroups=[];this._aListElements=[];this._aGroupTitleElements=[];if(!this.ITEM_TYPE){this.ITEM_TYPE=YAHOO.widget.MenuItem;}
var oElement;if(typeof p_oElement=="string"){oElement=document.getElementById(p_oElement);}
else if(p_oElement.tagName){oElement=p_oElement;}
if(oElement&&oElement.tagName){switch(oElement.tagName.toUpperCase()){case"DIV":this.srcElement=oElement;if(!oElement.id){oElement.setAttribute("id",Dom.generateId());}
Menu.superclass.init.call(this,oElement);this.beforeInitEvent.fire(Menu);break;case"SELECT":this.srcElement=oElement;Menu.superclass.init.call(this,Dom.generateId());this.beforeInitEvent.fire(Menu);break;}}
else{Menu.superclass.init.call(this,p_oElement);this.beforeInitEvent.fire(Menu);}
if(this.element){Dom.addClass(this.element,this.CSS_CLASS_NAME);this.initEvent.subscribe(this._onInit);this.beforeRenderEvent.subscribe(this._onBeforeRender);this.renderEvent.subscribe(this._onRender);this.renderEvent.subscribe(this.onRender);this.beforeShowEvent.subscribe(this._onBeforeShow);this.hideEvent.subscribe(this.positionOffScreen);this.showEvent.subscribe(this._onShow);this.beforeHideEvent.subscribe(this._onBeforeHide);this.mouseOverEvent.subscribe(this._onMouseOver);this.mouseOutEvent.subscribe(this._onMouseOut);this.clickEvent.subscribe(this._onClick);this.keyDownEvent.subscribe(this._onKeyDown);this.keyPressEvent.subscribe(this._onKeyPress);if(UA.gecko||UA.webkit){this.cfg.subscribeToConfigEvent("y",this._onYChange);}
if(p_oConfig){this.cfg.applyConfig(p_oConfig,true);}
MenuManager.addMenu(this);this.initEvent.fire(Menu);}},_initSubTree:function(){var oSrcElement=this.srcElement,sSrcElementTagName,nGroup,sGroupTitleTagName,oNode,aListElements,nListElements,i;if(oSrcElement){sSrcElementTagName=(oSrcElement.tagName&&oSrcElement.tagName.toUpperCase());if(sSrcElementTagName=="DIV"){oNode=this.body.firstChild;if(oNode){nGroup=0;sGroupTitleTagName=this.GROUP_TITLE_TAG_NAME.toUpperCase();do{if(oNode&&oNode.tagName){switch(oNode.tagName.toUpperCase()){case sGroupTitleTagName:this._aGroupTitleElements[nGroup]=oNode;break;case"UL":this._aListElements[nGroup]=oNode;this._aItemGroups[nGroup]=[];nGroup++;break;}}}
while((oNode=oNode.nextSibling));if(this._aListElements[0]){Dom.addClass(this._aListElements[0],"first-of-type");}}}
oNode=null;if(sSrcElementTagName){switch(sSrcElementTagName){case"DIV":aListElements=this._aListElements;nListElements=aListElements.length;if(nListElements>0){i=nListElements-1;do{oNode=aListElements[i].firstChild;if(oNode){do{if(oNode&&oNode.tagName&&oNode.tagName.toUpperCase()=="LI"){this.addItem(new this.ITEM_TYPE(oNode,{parent:this}),i);}}
while((oNode=oNode.nextSibling));}}
while(i--);}
break;case"SELECT":oNode=oSrcElement.firstChild;do{if(oNode&&oNode.tagName){switch(oNode.tagName.toUpperCase()){case"OPTGROUP":case"OPTION":this.addItem(new this.ITEM_TYPE(oNode,{parent:this}));break;}}}
while((oNode=oNode.nextSibling));break;}}}},_getFirstEnabledItem:function(){var aItems=this.getItems(),nItems=aItems.length,oItem;for(var i=0;i<nItems;i++){oItem=aItems[i];if(oItem&&!oItem.cfg.getProperty("disabled")&&oItem.element.style.display!="none"){return oItem;}}},_addItemToGroup:function(p_nGroupIndex,p_oItem,p_nItemIndex){var oItem,nGroupIndex,aGroup,oGroupItem,bAppend,oNextItemSibling,nItemIndex;function getNextItemSibling(p_aArray,p_nStartIndex){return(p_aArray[p_nStartIndex]||getNextItemSibling(p_aArray,(p_nStartIndex+1)));}
if(p_oItem instanceof this.ITEM_TYPE){oItem=p_oItem;oItem.parent=this;}
else if(typeof p_oItem=="string"){oItem=new this.ITEM_TYPE(p_oItem,{parent:this});}
else if(typeof p_oItem=="object"){p_oItem.parent=this;oItem=new this.ITEM_TYPE(p_oItem.text,p_oItem);}
if(oItem){if(oItem.cfg.getProperty("selected")){this.activeItem=oItem;}
nGroupIndex=typeof p_nGroupIndex=="number"?p_nGroupIndex:0;aGroup=this._getItemGroup(nGroupIndex);if(!aGroup){aGroup=this._createItemGroup(nGroupIndex);}
if(typeof p_nItemIndex=="number"){bAppend=(p_nItemIndex>=aGroup.length);if(aGroup[p_nItemIndex]){aGroup.splice(p_nItemIndex,0,oItem);}
else{aGroup[p_nItemIndex]=oItem;}
oGroupItem=aGroup[p_nItemIndex];if(oGroupItem){if(bAppend&&(!oGroupItem.element.parentNode||oGroupItem.element.parentNode.nodeType==11)){this._aListElements[nGroupIndex].appendChild(oGroupItem.element);}
else{oNextItemSibling=getNextItemSibling(aGroup,(p_nItemIndex+1));if(oNextItemSibling&&(!oGroupItem.element.parentNode||oGroupItem.element.parentNode.nodeType==11)){this._aListElements[nGroupIndex].insertBefore(oGroupItem.element,oNextItemSibling.element);}}
oGroupItem.parent=this;this._subscribeToItemEvents(oGroupItem);this._configureSubmenu(oGroupItem);this._updateItemProperties(nGroupIndex);this.itemAddedEvent.fire(oGroupItem);this.changeContentEvent.fire();return oGroupItem;}}
else{nItemIndex=aGroup.length;aGroup[nItemIndex]=oItem;oGroupItem=aGroup[nItemIndex];if(oGroupItem){if(!Dom.isAncestor(this._aListElements[nGroupIndex],oGroupItem.element)){this._aListElements[nGroupIndex].appendChild(oGroupItem.element);}
oGroupItem.element.setAttribute("groupindex",nGroupIndex);oGroupItem.element.setAttribute("index",nItemIndex);oGroupItem.parent=this;oGroupItem.index=nItemIndex;oGroupItem.groupIndex=nGroupIndex;this._subscribeToItemEvents(oGroupItem);this._configureSubmenu(oGroupItem);if(nItemIndex===0){Dom.addClass(oGroupItem.element,"first-of-type");}
this.itemAddedEvent.fire(oGroupItem);this.changeContentEvent.fire();return oGroupItem;}}}},_removeItemFromGroupByIndex:function(p_nGroupIndex,p_nItemIndex){var nGroupIndex=typeof p_nGroupIndex=="number"?p_nGroupIndex:0,aGroup=this._getItemGroup(nGroupIndex),aArray,oItem,oUL;if(aGroup){aArray=aGroup.splice(p_nItemIndex,1);oItem=aArray[0];if(oItem){this._updateItemProperties(nGroupIndex);if(aGroup.length===0){oUL=this._aListElements[nGroupIndex];if(this.body&&oUL){this.body.removeChild(oUL);}
this._aItemGroups.splice(nGroupIndex,1);this._aListElements.splice(nGroupIndex,1);oUL=this._aListElements[0];if(oUL){Dom.addClass(oUL,"first-of-type");}}
this.itemRemovedEvent.fire(oItem);this.changeContentEvent.fire();return oItem;}}},_removeItemFromGroupByValue:function(p_nGroupIndex,p_oItem){var aGroup=this._getItemGroup(p_nGroupIndex),nItems,nItemIndex,i;if(aGroup){nItems=aGroup.length;nItemIndex=-1;if(nItems>0){i=nItems-1;do{if(aGroup[i]==p_oItem){nItemIndex=i;break;}}
while(i--);if(nItemIndex>-1){return(this._removeItemFromGroupByIndex(p_nGroupIndex,nItemIndex));}}}},_updateItemProperties:function(p_nGroupIndex){var aGroup=this._getItemGroup(p_nGroupIndex),nItems=aGroup.length,oItem,oLI,i;if(nItems>0){i=nItems-1;do{oItem=aGroup[i];if(oItem){oLI=oItem.element;oItem.index=i;oItem.groupIndex=p_nGroupIndex;oLI.setAttribute("groupindex",p_nGroupIndex);oLI.setAttribute("index",i);Dom.removeClass(oLI,"first-of-type");}}
while(i--);if(oLI){Dom.addClass(oLI,"first-of-type");}}},_createItemGroup:function(p_nIndex){var oUL;if(!this._aItemGroups[p_nIndex]){this._aItemGroups[p_nIndex]=[];oUL=document.createElement("ul");this._aListElements[p_nIndex]=oUL;return this._aItemGroups[p_nIndex];}},_getItemGroup:function(p_nIndex){var nIndex=((typeof p_nIndex=="number")?p_nIndex:0);return this._aItemGroups[nIndex];},_configureSubmenu:function(p_oItem){var oSubmenu=p_oItem.cfg.getProperty("submenu");if(oSubmenu){this.cfg.configChangedEvent.subscribe(this._onParentMenuConfigChange,oSubmenu,true);this.renderEvent.subscribe(this._onParentMenuRender,oSubmenu,true);oSubmenu.beforeShowEvent.subscribe(this._onSubmenuBeforeShow);}},_subscribeToItemEvents:function(p_oItem){p_oItem.focusEvent.subscribe(this._onMenuItemFocus);p_oItem.blurEvent.subscribe(this._onMenuItemBlur);p_oItem.destroyEvent.subscribe(this._onMenuItemDestroy,p_oItem,this);p_oItem.cfg.configChangedEvent.subscribe(this._onMenuItemConfigChange,p_oItem,this);},_onVisibleChange:function(p_sType,p_aArgs){var bVisible=p_aArgs[0];if(bVisible){Dom.addClass(this.element,"visible");}
else{Dom.removeClass(this.element,"visible");}},_cancelHideDelay:function(){var oRoot=this.getRoot();if(oRoot._nHideDelayId){window.clearTimeout(oRoot._nHideDelayId);}},_execHideDelay:function(){this._cancelHideDelay();var oRoot=this.getRoot(),me=this;function hideMenu(){if(oRoot.activeItem){oRoot.clearActiveItem();}
if(oRoot==me&&!(me instanceof YAHOO.widget.MenuBar)&&me.cfg.getProperty("position")=="dynamic"){me.hide();}}
oRoot._nHideDelayId=window.setTimeout(hideMenu,oRoot.cfg.getProperty("hidedelay"));},_cancelShowDelay:function(){var oRoot=this.getRoot();if(oRoot._nShowDelayId){window.clearTimeout(oRoot._nShowDelayId);}},_execShowDelay:function(p_oMenu){var oRoot=this.getRoot();function showMenu(){if(p_oMenu.parent.cfg.getProperty("selected")){p_oMenu.show();}}
oRoot._nShowDelayId=window.setTimeout(showMenu,oRoot.cfg.getProperty("showdelay"));},_execSubmenuHideDelay:function(p_oSubmenu,p_nMouseX,p_nHideDelay){var me=this;p_oSubmenu._nSubmenuHideDelayId=window.setTimeout(function(){if(me._nCurrentMouseX>(p_nMouseX+10)){p_oSubmenu._nSubmenuHideDelayId=window.setTimeout(function(){p_oSubmenu.hide();},p_nHideDelay);}
else{p_oSubmenu.hide();}},50);},_disableScrollHeader:function(){if(!this._bHeaderDisabled){Dom.addClass(this.header,"topscrollbar_disabled");this._bHeaderDisabled=true;}},_disableScrollFooter:function(){if(!this._bFooterDisabled){Dom.addClass(this.footer,"bottomscrollbar_disabled");this._bFooterDisabled=true;}},_enableScrollHeader:function(){if(this._bHeaderDisabled){Dom.removeClass(this.header,"topscrollbar_disabled");this._bHeaderDisabled=false;}},_enableScrollFooter:function(){if(this._bFooterDisabled){Dom.removeClass(this.footer,"bottomscrollbar_disabled");this._bFooterDisabled=false;}},_onMouseOver:function(p_sType,p_aArgs){if(this._bStopMouseEventHandlers){return false;}
var oEvent=p_aArgs[0],oItem=p_aArgs[1],oTarget=Event.getTarget(oEvent),oParentMenu,nShowDelay,bShowDelay,oActiveItem,oItemCfg,oSubmenu;if(!this._bHandledMouseOverEvent&&(oTarget==this.element||Dom.isAncestor(this.element,oTarget))){this._nCurrentMouseX=0;Event.on(this.element,"mousemove",this._onMouseMove,this,true);this.clearActiveItem();if(this.parent&&this._nSubmenuHideDelayId){window.clearTimeout(this._nSubmenuHideDelayId);this.parent.cfg.setProperty("selected",true);oParentMenu=this.parent.parent;oParentMenu._bHandledMouseOutEvent=true;oParentMenu._bHandledMouseOverEvent=false;}
this._bHandledMouseOverEvent=true;this._bHandledMouseOutEvent=false;}
if(oItem&&!oItem.handledMouseOverEvent&&!oItem.cfg.getProperty("disabled")&&(oTarget==oItem.element||Dom.isAncestor(oItem.element,oTarget))){nShowDelay=this.cfg.getProperty("showdelay");bShowDelay=(nShowDelay>0);if(bShowDelay){this._cancelShowDelay();}
oActiveItem=this.activeItem;if(oActiveItem){oActiveItem.cfg.setProperty("selected",false);}
oItemCfg=oItem.cfg;oItemCfg.setProperty("selected",true);if(this.hasFocus()){oItem.focus();}
if(this.cfg.getProperty("autosubmenudisplay")){oSubmenu=oItemCfg.getProperty("submenu");if(oSubmenu){if(bShowDelay){this._execShowDelay(oSubmenu);}
else{oSubmenu.show();}}}
oItem.handledMouseOverEvent=true;oItem.handledMouseOutEvent=false;}},_onMouseOut:function(p_sType,p_aArgs){if(this._bStopMouseEventHandlers){return false;}
var oEvent=p_aArgs[0],oItem=p_aArgs[1],oRelatedTarget=Event.getRelatedTarget(oEvent),bMovingToSubmenu=false,oItemCfg,oSubmenu,nSubmenuHideDelay,nShowDelay;if(oItem&&!oItem.cfg.getProperty("disabled")){oItemCfg=oItem.cfg;oSubmenu=oItemCfg.getProperty("submenu");if(oSubmenu&&(oRelatedTarget==oSubmenu.element||Dom.isAncestor(oSubmenu.element,oRelatedTarget))){bMovingToSubmenu=true;}
if(!oItem.handledMouseOutEvent&&((oRelatedTarget!=oItem.element&&!Dom.isAncestor(oItem.element,oRelatedTarget))||bMovingToSubmenu)){if(!bMovingToSubmenu){oItem.cfg.setProperty("selected",false);if(oSubmenu){nSubmenuHideDelay=this.cfg.getProperty("submenuhidedelay");nShowDelay=this.cfg.getProperty("showdelay");if(!(this instanceof YAHOO.widget.MenuBar)&&nSubmenuHideDelay>0&&nShowDelay>=nSubmenuHideDelay){this._execSubmenuHideDelay(oSubmenu,Event.getPageX(oEvent),nSubmenuHideDelay);}
else{oSubmenu.hide();}}}
oItem.handledMouseOutEvent=true;oItem.handledMouseOverEvent=false;}}
if(!this._bHandledMouseOutEvent&&((oRelatedTarget!=this.element&&!Dom.isAncestor(this.element,oRelatedTarget))||bMovingToSubmenu)){Event.removeListener(this.element,"mousemove",this._onMouseMove);this._nCurrentMouseX=Event.getPageX(oEvent);this._bHandledMouseOutEvent=true;this._bHandledMouseOverEvent=false;}},_onMouseMove:function(p_oEvent,p_oMenu){if(this._bStopMouseEventHandlers){return false;}
this._nCurrentMouseX=Event.getPageX(p_oEvent);},_onClick:function(p_sType,p_aArgs){var oEvent=p_aArgs[0],oItem=p_aArgs[1],bInMenuAnchor=false,oSubmenu,oRoot,sId,sURL,nHashPos,nLen;if(oItem){if(oItem.cfg.getProperty("disabled")){Event.preventDefault(oEvent);}
else{oSubmenu=oItem.cfg.getProperty("submenu");sURL=oItem.cfg.getProperty("url");if(sURL){nHashPos=sURL.indexOf("#");nLen=sURL.length;if(nHashPos!=-1){sURL=sURL.substr(nHashPos,nLen);nLen=sURL.length;if(nLen>1){sId=sURL.substr(1,nLen);bInMenuAnchor=Dom.isAncestor(this.element,sId);}
else if(nLen===1){bInMenuAnchor=true;}}}
if(bInMenuAnchor&&!oItem.cfg.getProperty("target")){Event.preventDefault(oEvent);if(UA.webkit){oItem.focus();}
else{oItem.focusEvent.fire();}}
if(!oSubmenu){if((UA.gecko&&this.platform=="windows")&&oEvent.button>0){return;}
oRoot=this.getRoot();if(oRoot instanceof YAHOO.widget.MenuBar||oRoot.cfg.getProperty("position")=="static"){oRoot.clearActiveItem();}
else{oRoot.hide();}}}}},_onKeyDown:function(p_sType,p_aArgs){var oEvent=p_aArgs[0],oItem=p_aArgs[1],me=this,oSubmenu,oItemCfg,oParentItem,oRoot,oNextItem,oBody,nBodyScrollTop,nBodyOffsetHeight,aItems,nItems,nNextItemOffsetTop,nScrollTarget,oParentMenu;function stopMouseEventHandlers(){me._bStopMouseEventHandlers=true;window.setTimeout(function(){me._bStopMouseEventHandlers=false;},10);}
if(oItem&&!oItem.cfg.getProperty("disabled")){oItemCfg=oItem.cfg;oParentItem=this.parent;switch(oEvent.keyCode){case 38:case 40:oNextItem=(oEvent.keyCode==38)?oItem.getPreviousEnabledSibling():oItem.getNextEnabledSibling();if(oNextItem){this.clearActiveItem();oNextItem.cfg.setProperty("selected",true);oNextItem.focus();if(this.cfg.getProperty("maxheight")>0){oBody=this.body;nBodyScrollTop=oBody.scrollTop;nBodyOffsetHeight=oBody.offsetHeight;aItems=this.getItems();nItems=aItems.length-1;nNextItemOffsetTop=oNextItem.element.offsetTop;if(oEvent.keyCode==40){if(nNextItemOffsetTop>=(nBodyOffsetHeight+nBodyScrollTop)){oBody.scrollTop=nNextItemOffsetTop-nBodyOffsetHeight;}
else if(nNextItemOffsetTop<=nBodyScrollTop){oBody.scrollTop=0;}
if(oNextItem==aItems[nItems]){oBody.scrollTop=oNextItem.element.offsetTop;}}
else{if(nNextItemOffsetTop<=nBodyScrollTop){oBody.scrollTop=nNextItemOffsetTop-oNextItem.element.offsetHeight;}
else if(nNextItemOffsetTop>=(nBodyScrollTop+nBodyOffsetHeight)){oBody.scrollTop=nNextItemOffsetTop;}
if(oNextItem==aItems[0]){oBody.scrollTop=0;}}
nBodyScrollTop=oBody.scrollTop;nScrollTarget=oBody.scrollHeight-oBody.offsetHeight;if(nBodyScrollTop===0){this._disableScrollHeader();this._enableScrollFooter();}
else if(nBodyScrollTop==nScrollTarget){this._enableScrollHeader();this._disableScrollFooter();}
else{this._enableScrollHeader();this._enableScrollFooter();}}}
Event.preventDefault(oEvent);stopMouseEventHandlers();break;case 39:oSubmenu=oItemCfg.getProperty("submenu");if(oSubmenu){if(!oItemCfg.getProperty("selected")){oItemCfg.setProperty("selected",true);}
oSubmenu.show();oSubmenu.setInitialFocus();oSubmenu.setInitialSelection();}
else{oRoot=this.getRoot();if(oRoot instanceof YAHOO.widget.MenuBar){oNextItem=oRoot.activeItem.getNextEnabledSibling();if(oNextItem){oRoot.clearActiveItem();oNextItem.cfg.setProperty("selected",true);oSubmenu=oNextItem.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.show();}
oNextItem.focus();}}}
Event.preventDefault(oEvent);stopMouseEventHandlers();break;case 37:if(oParentItem){oParentMenu=oParentItem.parent;if(oParentMenu instanceof YAHOO.widget.MenuBar){oNextItem=oParentMenu.activeItem.getPreviousEnabledSibling();if(oNextItem){oParentMenu.clearActiveItem();oNextItem.cfg.setProperty("selected",true);oSubmenu=oNextItem.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.show();}
oNextItem.focus();}}
else{this.hide();oParentItem.focus();}}
Event.preventDefault(oEvent);stopMouseEventHandlers();break;}}
if(oEvent.keyCode==27){if(this.cfg.getProperty("position")=="dynamic"){this.hide();if(this.parent){this.parent.focus();}}
else if(this.activeItem){oSubmenu=this.activeItem.cfg.getProperty("submenu");if(oSubmenu&&oSubmenu.cfg.getProperty("visible")){oSubmenu.hide();this.activeItem.focus();}
else{this.activeItem.blur();this.activeItem.cfg.setProperty("selected",false);}}
Event.preventDefault(oEvent);}},_onKeyPress:function(p_sType,p_aArgs){var oEvent=p_aArgs[0];if(oEvent.keyCode==40||oEvent.keyCode==38){Event.preventDefault(oEvent);}},_onYChange:function(p_sType,p_aArgs){var oParent=this.parent,nScrollTop,oIFrame,nY;if(oParent){nScrollTop=oParent.parent.body.scrollTop;if(nScrollTop>0){nY=(this.cfg.getProperty("y")-nScrollTop);Dom.setY(this.element,nY);oIFrame=this.iframe;if(oIFrame){Dom.setY(oIFrame,nY);}
this.cfg.setProperty("y",nY,true);}}},_onScrollTargetMouseOver:function(p_oEvent,p_oMenu){this._cancelHideDelay();var oTarget=Event.getTarget(p_oEvent),oBody=this.body,me=this,nScrollIncrement=this.cfg.getProperty("scrollincrement"),nScrollTarget,fnScrollFunction;function scrollBodyDown(){var nScrollTop=oBody.scrollTop;if(nScrollTop<nScrollTarget){oBody.scrollTop=(nScrollTop+nScrollIncrement);me._enableScrollHeader();}
else{oBody.scrollTop=nScrollTarget;window.clearInterval(me._nBodyScrollId);me._disableScrollFooter();}}
function scrollBodyUp(){var nScrollTop=oBody.scrollTop;if(nScrollTop>0){oBody.scrollTop=(nScrollTop-nScrollIncrement);me._enableScrollFooter();}
else{oBody.scrollTop=0;window.clearInterval(me._nBodyScrollId);me._disableScrollHeader();}}
if(Dom.hasClass(oTarget,"hd")){fnScrollFunction=scrollBodyUp;}
else{nScrollTarget=oBody.scrollHeight-oBody.offsetHeight;fnScrollFunction=scrollBodyDown;}
this._nBodyScrollId=window.setInterval(fnScrollFunction,10);},_onScrollTargetMouseOut:function(p_oEvent,p_oMenu){window.clearInterval(this._nBodyScrollId);this._cancelHideDelay();},_onInit:function(p_sType,p_aArgs){this.cfg.subscribeToConfigEvent("visible",this._onVisibleChange);var bRootMenu=!this.parent,bLazyLoad=this.lazyLoad;if(((bRootMenu&&!bLazyLoad)||(bRootMenu&&(this.cfg.getProperty("visible")||this.cfg.getProperty("position")=="static"))||(!bRootMenu&&!bLazyLoad))&&this.getItemGroups().length===0){if(this.srcElement){this._initSubTree();}
if(this.itemData){this.addItems(this.itemData);}}
else if(bLazyLoad){this.cfg.fireQueue();}},_onBeforeRender:function(p_sType,p_aArgs){var oEl=this.element,nListElements=this._aListElements.length,bFirstList=true,i=0,oUL,oGroupTitle;if(nListElements>0){do{oUL=this._aListElements[i];if(oUL){if(bFirstList){Dom.addClass(oUL,"first-of-type");bFirstList=false;}
if(!Dom.isAncestor(oEl,oUL)){this.appendToBody(oUL);}
oGroupTitle=this._aGroupTitleElements[i];if(oGroupTitle){if(!Dom.isAncestor(oEl,oGroupTitle)){oUL.parentNode.insertBefore(oGroupTitle,oUL);}
Dom.addClass(oUL,"hastitle");}}
i++;}
while(i<nListElements);}},_onRender:function(p_sType,p_aArgs){if(this.cfg.getProperty("position")=="dynamic"){if(!this.cfg.getProperty("visible")){this.positionOffScreen();}}},_onBeforeShow:function(p_sType,p_aArgs){var nOptions,n,nViewportHeight,oRegion,oSrcElement;if(this.lazyLoad&&this.getItemGroups().length===0){if(this.srcElement){this._initSubTree();}
if(this.itemData){if(this.parent&&this.parent.parent&&this.parent.parent.srcElement&&this.parent.parent.srcElement.tagName.toUpperCase()=="SELECT"){nOptions=this.itemData.length;for(n=0;n<nOptions;n++){if(this.itemData[n].tagName){this.addItem((new this.ITEM_TYPE(this.itemData[n])));}}}
else{this.addItems(this.itemData);}}
oSrcElement=this.srcElement;if(oSrcElement){if(oSrcElement.tagName.toUpperCase()=="SELECT"){if(Dom.inDocument(oSrcElement)){this.render(oSrcElement.parentNode);}
else{this.render(this.cfg.getProperty("container"));}}
else{this.render();}}
else{if(this.parent){this.render(this.parent.element);}
else{this.render(this.cfg.getProperty("container"));}}}
var nMaxHeight=this.cfg.getProperty("maxheight"),nMinScrollHeight=this.cfg.getProperty("minscrollheight"),bDynamicPos=this.cfg.getProperty("position")=="dynamic";if(!this.parent&&bDynamicPos){this.cfg.refireEvent("xy");}
function clearMaxHeight(){this.cfg.setProperty("maxheight",0);this.hideEvent.unsubscribe(clearMaxHeight);}
if(!(this instanceof YAHOO.widget.MenuBar)&&bDynamicPos){if(nMaxHeight===0){nViewportHeight=Dom.getViewportHeight();if(this.parent&&this.parent.parent instanceof YAHOO.widget.MenuBar){oRegion=YAHOO.util.Region.getRegion(this.parent.element);nViewportHeight=(nViewportHeight-oRegion.bottom);}
if(this.element.offsetHeight>=nViewportHeight){nMaxHeight=(nViewportHeight-(Overlay.VIEWPORT_OFFSET*2));if(nMaxHeight<nMinScrollHeight){nMaxHeight=nMinScrollHeight;}
this.cfg.setProperty("maxheight",nMaxHeight);this.hideEvent.subscribe(clearMaxHeight);}}}},_onShow:function(p_sType,p_aArgs){var oParent=this.parent,oParentMenu,aParentAlignment,aAlignment;function disableAutoSubmenuDisplay(p_oEvent){var oTarget;if(p_oEvent.type=="mousedown"||(p_oEvent.type=="keydown"&&p_oEvent.keyCode==27)){oTarget=Event.getTarget(p_oEvent);if(oTarget!=oParentMenu.element||!Dom.isAncestor(oParentMenu.element,oTarget)){oParentMenu.cfg.setProperty("autosubmenudisplay",false);Event.removeListener(document,"mousedown",disableAutoSubmenuDisplay);Event.removeListener(document,"keydown",disableAutoSubmenuDisplay);}}}
if(oParent){oParentMenu=oParent.parent;aParentAlignment=oParentMenu.cfg.getProperty("submenualignment");aAlignment=this.cfg.getProperty("submenualignment");if((aParentAlignment[0]!=aAlignment[0])&&(aParentAlignment[1]!=aAlignment[1])){this.cfg.setProperty("submenualignment",[aParentAlignment[0],aParentAlignment[1]]);}
if(!oParentMenu.cfg.getProperty("autosubmenudisplay")&&(oParentMenu instanceof YAHOO.widget.MenuBar||oParentMenu.cfg.getProperty("position")=="static")){oParentMenu.cfg.setProperty("autosubmenudisplay",true);Event.on(document,"mousedown",disableAutoSubmenuDisplay);Event.on(document,"keydown",disableAutoSubmenuDisplay);}}},_onBeforeHide:function(p_sType,p_aArgs){var oActiveItem=this.activeItem,oConfig,oSubmenu;if(oActiveItem){oConfig=oActiveItem.cfg;oConfig.setProperty("selected",false);oSubmenu=oConfig.getProperty("submenu");if(oSubmenu){oSubmenu.hide();}}
if(this.getRoot()==this){this.blur();}},_onParentMenuConfigChange:function(p_sType,p_aArgs,p_oSubmenu){var sPropertyName=p_aArgs[0][0],oPropertyValue=p_aArgs[0][1];switch(sPropertyName){case"iframe":case"constraintoviewport":case"hidedelay":case"showdelay":case"submenuhidedelay":case"clicktohide":case"effect":case"classname":case"scrollincrement":case"minscrollheight":p_oSubmenu.cfg.setProperty(sPropertyName,oPropertyValue);break;}},_onParentMenuRender:function(p_sType,p_aArgs,p_oSubmenu){var oParentCfg=p_oSubmenu.parent.parent.cfg,oConfig={constraintoviewport:oParentCfg.getProperty("constraintoviewport"),xy:[0,0],clicktohide:oParentCfg.getProperty("clicktohide"),effect:oParentCfg.getProperty("effect"),showdelay:oParentCfg.getProperty("showdelay"),hidedelay:oParentCfg.getProperty("hidedelay"),submenuhidedelay:oParentCfg.getProperty("submenuhidedelay"),classname:oParentCfg.getProperty("classname"),scrollincrement:oParentCfg.getProperty("scrollincrement"),minscrollheight:oParentCfg.getProperty("minscrollheight"),iframe:oParentCfg.getProperty("iframe")},oLI;p_oSubmenu.cfg.applyConfig(oConfig);if(!this.lazyLoad){oLI=this.parent.element;if(this.element.parentNode==oLI){this.render();}
else{this.render(oLI);}}},_onSubmenuBeforeShow:function(p_sType,p_aArgs){var oParent=this.parent,aAlignment=oParent.parent.cfg.getProperty("submenualignment");if(!this.cfg.getProperty("context")){this.cfg.setProperty("context",[oParent.element,aAlignment[0],aAlignment[1]]);}
else{this.align();}},_onMenuItemFocus:function(p_sType,p_aArgs){this.parent.focusEvent.fire(this);},_onMenuItemBlur:function(p_sType,p_aArgs){this.parent.blurEvent.fire(this);},_onMenuItemDestroy:function(p_sType,p_aArgs,p_oItem){this._removeItemFromGroupByValue(p_oItem.groupIndex,p_oItem);},_onMenuItemConfigChange:function(p_sType,p_aArgs,p_oItem){var sPropertyName=p_aArgs[0][0],oPropertyValue=p_aArgs[0][1],oSubmenu;switch(sPropertyName){case"selected":if(oPropertyValue===true){this.activeItem=p_oItem;}
break;case"submenu":oSubmenu=p_aArgs[0][1];if(oSubmenu){this._configureSubmenu(p_oItem);}
break;}},enforceConstraints:function(type,args,obj){YAHOO.widget.Menu.superclass.enforceConstraints.apply(this,arguments);var oParent=this.parent,oParentMenu,nParentMenuX,nNewX,nX;if(oParent){oParentMenu=oParent.parent;if(!(oParentMenu instanceof YAHOO.widget.MenuBar)){nParentMenuX=oParentMenu.cfg.getProperty("x");nX=this.cfg.getProperty("x");if(nX<(nParentMenuX+oParent.element.offsetWidth)){nNewX=(nParentMenuX-this.element.offsetWidth);this.cfg.setProperty("x",nNewX,true);this.cfg.setProperty("xy",[nNewX,(this.cfg.getProperty("y"))],true);}}}},configVisible:function(p_sType,p_aArgs,p_oMenu){var bVisible,sDisplay;if(this.cfg.getProperty("position")=="dynamic"){Menu.superclass.configVisible.call(this,p_sType,p_aArgs,p_oMenu);}
else{bVisible=p_aArgs[0];sDisplay=Dom.getStyle(this.element,"display");Dom.setStyle(this.element,"visibility","visible");if(bVisible){if(sDisplay!="block"){this.beforeShowEvent.fire();Dom.setStyle(this.element,"display","block");this.showEvent.fire();}}
else{if(sDisplay=="block"){this.beforeHideEvent.fire();Dom.setStyle(this.element,"display","none");this.hideEvent.fire();}}}},configPosition:function(p_sType,p_aArgs,p_oMenu){var oElement=this.element,sCSSPosition=p_aArgs[0]=="static"?"static":"absolute",oCfg=this.cfg,nZIndex;Dom.setStyle(oElement,"position",sCSSPosition);if(sCSSPosition=="static"){Dom.setStyle(oElement,"display","block");oCfg.setProperty("visible",true);}
else{Dom.setStyle(oElement,"visibility","hidden");}
if(sCSSPosition=="absolute"){nZIndex=oCfg.getProperty("zindex");if(!nZIndex||nZIndex===0){nZIndex=this.parent?(this.parent.parent.cfg.getProperty("zindex")+1):1;oCfg.setProperty("zindex",nZIndex);}}},configIframe:function(p_sType,p_aArgs,p_oMenu){if(this.cfg.getProperty("position")=="dynamic"){Menu.superclass.configIframe.call(this,p_sType,p_aArgs,p_oMenu);}},configHideDelay:function(p_sType,p_aArgs,p_oMenu){var nHideDelay=p_aArgs[0],oMouseOutEvent=this.mouseOutEvent,oMouseOverEvent=this.mouseOverEvent,oKeyDownEvent=this.keyDownEvent;if(nHideDelay>0){if(!this._bHideDelayEventHandlersAssigned){oMouseOutEvent.subscribe(this._execHideDelay);oMouseOverEvent.subscribe(this._cancelHideDelay);oKeyDownEvent.subscribe(this._cancelHideDelay);this._bHideDelayEventHandlersAssigned=true;}}
else{oMouseOutEvent.unsubscribe(this._execHideDelay);oMouseOverEvent.unsubscribe(this._cancelHideDelay);oKeyDownEvent.unsubscribe(this._cancelHideDelay);this._bHideDelayEventHandlersAssigned=false;}},configContainer:function(p_sType,p_aArgs,p_oMenu){var oElement=p_aArgs[0];if(typeof oElement=='string'){this.cfg.setProperty("container",document.getElementById(oElement),true);}},_setMaxHeight:function(p_sType,p_aArgs,p_nMaxHeight){this.cfg.setProperty("maxheight",p_nMaxHeight);this.renderEvent.unsubscribe(this._setMaxHeight);},configMaxHeight:function(p_sType,p_aArgs,p_oMenu){var nMaxHeight=p_aArgs[0],oElement=this.element,oBody=this.body,oHeader=this.header,oFooter=this.footer,fnMouseOver=this._onScrollTargetMouseOver,fnMouseOut=this._onScrollTargetMouseOut,nMinScrollHeight=this.cfg.getProperty("minscrollheight"),nHeight,nOffsetWidth,sWidth;if(nMaxHeight!==0&&nMaxHeight<nMinScrollHeight){nMaxHeight=nMinScrollHeight;}
if(this.lazyLoad&&!oBody){this.renderEvent.unsubscribe(this._setMaxHeight);if(nMaxHeight>0){this.renderEvent.subscribe(this._setMaxHeight,nMaxHeight,this);}
return;}
Dom.setStyle(oBody,"height","");Dom.removeClass(oBody,"yui-menu-body-scrolled");var bSetWidth=((UA.gecko&&this.parent&&this.parent.parent&&this.parent.parent.cfg.getProperty("position")=="dynamic")||UA.ie);if(bSetWidth){if(!this.cfg.getProperty("width")){nOffsetWidth=oElement.offsetWidth;oElement.style.width=nOffsetWidth+"px";sWidth=(nOffsetWidth-(oElement.offsetWidth-nOffsetWidth))+"px";this.cfg.setProperty("width",sWidth);}}
if(!oHeader&&!oFooter){this.setHeader("&#32;");this.setFooter("&#32;");oHeader=this.header;oFooter=this.footer;Dom.addClass(oHeader,"topscrollbar");Dom.addClass(oFooter,"bottomscrollbar");oElement.insertBefore(oHeader,oBody);oElement.appendChild(oFooter);}
nHeight=(nMaxHeight-(oHeader.offsetHeight+oHeader.offsetHeight));if(nHeight>0&&(oBody.offsetHeight>nMaxHeight)){Dom.addClass(oBody,"yui-menu-body-scrolled");Dom.setStyle(oBody,"height",(nHeight+"px"));Event.on(oHeader,"mouseover",fnMouseOver,this,true);Event.on(oHeader,"mouseout",fnMouseOut,this,true);Event.on(oFooter,"mouseover",fnMouseOver,this,true);Event.on(oFooter,"mouseout",fnMouseOut,this,true);this._disableScrollHeader();this._enableScrollFooter();}
else if(oHeader&&oFooter){if(bSetWidth){this.cfg.setProperty("width","");}
this._enableScrollHeader();this._enableScrollFooter();Event.removeListener(oHeader,"mouseover",fnMouseOver);Event.removeListener(oHeader,"mouseout",fnMouseOut);Event.removeListener(oFooter,"mouseover",fnMouseOver);Event.removeListener(oFooter,"mouseout",fnMouseOut);oElement.removeChild(oHeader);oElement.removeChild(oFooter);this.header=null;this.footer=null;}
this.cfg.refireEvent("iframe");},configClassName:function(p_sType,p_aArgs,p_oMenu){var sClassName=p_aArgs[0];if(this._sClassName){Dom.removeClass(this.element,this._sClassName);}
Dom.addClass(this.element,sClassName);this._sClassName=sClassName;},_onItemAdded:function(p_sType,p_aArgs){var oItem=p_aArgs[0];if(oItem){oItem.cfg.setProperty("disabled",true);}},configDisabled:function(p_sType,p_aArgs,p_oMenu){var bDisabled=p_aArgs[0],aItems=this.getItems(),nItems,i;if(Lang.isArray(aItems)){nItems=aItems.length;if(nItems>0){i=nItems-1;do{aItems[i].cfg.setProperty("disabled",bDisabled);}
while(i--);}
if(bDisabled){this.clearActiveItem(true);Dom.addClass(this.element,"disabled");this.itemAddedEvent.subscribe(this._onItemAdded);}
else{Dom.removeClass(this.element,"disabled");this.itemAddedEvent.unsubscribe(this._onItemAdded);}}},onRender:function(p_sType,p_aArgs){function sizeShadow(){var oElement=this.element,oShadow=this._shadow;if(oShadow&&oElement){if(oShadow.style.width&&oShadow.style.height){oShadow.style.width="";oShadow.style.height="";}
oShadow.style.width=(oElement.offsetWidth+6)+"px";oShadow.style.height=(oElement.offsetHeight+1)+"px";}}
function replaceShadow(){this.element.appendChild(this._shadow);}
function addShadowVisibleClass(){Dom.addClass(this._shadow,"yui-menu-shadow-visible");}
function removeShadowVisibleClass(){Dom.removeClass(this._shadow,"yui-menu-shadow-visible");}
function createShadow(){var oShadow=this._shadow,oElement,me;if(!oShadow){oElement=this.element;me=this;if(!m_oShadowTemplate){m_oShadowTemplate=document.createElement("div");m_oShadowTemplate.className="yui-menu-shadow yui-menu-shadow-visible";}
oShadow=m_oShadowTemplate.cloneNode(false);oElement.appendChild(oShadow);this._shadow=oShadow;this.beforeShowEvent.subscribe(addShadowVisibleClass);this.beforeHideEvent.subscribe(removeShadowVisibleClass);if(UA.ie){window.setTimeout(function(){sizeShadow.call(me);me.syncIframe();},0);this.cfg.subscribeToConfigEvent("width",sizeShadow);this.cfg.subscribeToConfigEvent("height",sizeShadow);this.cfg.subscribeToConfigEvent("maxheight",sizeShadow);this.changeContentEvent.subscribe(sizeShadow);Module.textResizeEvent.subscribe(sizeShadow,me,true);this.destroyEvent.subscribe(function(){Module.textResizeEvent.unsubscribe(sizeShadow,me);});}
this.cfg.subscribeToConfigEvent("maxheight",replaceShadow);}}
function onBeforeShow(){createShadow.call(this);this.beforeShowEvent.unsubscribe(onBeforeShow);}
if(this.cfg.getProperty("position")=="dynamic"){if(this.cfg.getProperty("visible")){createShadow.call(this);}
else{this.beforeShowEvent.subscribe(onBeforeShow);}}},initEvents:function(){Menu.superclass.initEvents.call(this);var SIGNATURE=CustomEvent.LIST;this.mouseOverEvent=this.createEvent(EVENT_TYPES.MOUSE_OVER);this.mouseOverEvent.signature=SIGNATURE;this.mouseOutEvent=this.createEvent(EVENT_TYPES.MOUSE_OUT);this.mouseOutEvent.signature=SIGNATURE;this.mouseDownEvent=this.createEvent(EVENT_TYPES.MOUSE_DOWN);this.mouseDownEvent.signature=SIGNATURE;this.mouseUpEvent=this.createEvent(EVENT_TYPES.MOUSE_UP);this.mouseUpEvent.signature=SIGNATURE;this.clickEvent=this.createEvent(EVENT_TYPES.CLICK);this.clickEvent.signature=SIGNATURE;this.keyPressEvent=this.createEvent(EVENT_TYPES.KEY_PRESS);this.keyPressEvent.signature=SIGNATURE;this.keyDownEvent=this.createEvent(EVENT_TYPES.KEY_DOWN);this.keyDownEvent.signature=SIGNATURE;this.keyUpEvent=this.createEvent(EVENT_TYPES.KEY_UP);this.keyUpEvent.signature=SIGNATURE;this.focusEvent=this.createEvent(EVENT_TYPES.FOCUS);this.focusEvent.signature=SIGNATURE;this.blurEvent=this.createEvent(EVENT_TYPES.BLUR);this.blurEvent.signature=SIGNATURE;this.itemAddedEvent=this.createEvent(EVENT_TYPES.ITEM_ADDED);this.itemAddedEvent.signature=SIGNATURE;this.itemRemovedEvent=this.createEvent(EVENT_TYPES.ITEM_REMOVED);this.itemRemovedEvent.signature=SIGNATURE;},positionOffScreen:function(){var oIFrame=this.iframe,aPos=this.OFF_SCREEN_POSITION;Dom.setXY(this.element,aPos);if(oIFrame){Dom.setXY(oIFrame,aPos);}},getRoot:function(){var oItem=this.parent,oParentMenu;if(oItem){oParentMenu=oItem.parent;return oParentMenu?oParentMenu.getRoot():this;}
else{return this;}},toString:function(){var sReturnVal="Menu",sId=this.id;if(sId){sReturnVal+=(" "+sId);}
return sReturnVal;},setItemGroupTitle:function(p_sGroupTitle,p_nGroupIndex){var nGroupIndex,oTitle,i,nFirstIndex;if(typeof p_sGroupTitle=="string"&&p_sGroupTitle.length>0){nGroupIndex=typeof p_nGroupIndex=="number"?p_nGroupIndex:0;oTitle=this._aGroupTitleElements[nGroupIndex];if(oTitle){oTitle.innerHTML=p_sGroupTitle;}
else{oTitle=document.createElement(this.GROUP_TITLE_TAG_NAME);oTitle.innerHTML=p_sGroupTitle;this._aGroupTitleElements[nGroupIndex]=oTitle;}
i=this._aGroupTitleElements.length-1;do{if(this._aGroupTitleElements[i]){Dom.removeClass(this._aGroupTitleElements[i],"first-of-type");nFirstIndex=i;}}
while(i--);if(nFirstIndex!==null){Dom.addClass(this._aGroupTitleElements[nFirstIndex],"first-of-type");}
this.changeContentEvent.fire();}},addItem:function(p_oItem,p_nGroupIndex){if(p_oItem){return this._addItemToGroup(p_nGroupIndex,p_oItem);}},addItems:function(p_aItems,p_nGroupIndex){var nItems,aItems,oItem,i;if(Lang.isArray(p_aItems)){nItems=p_aItems.length;aItems=[];for(i=0;i<nItems;i++){oItem=p_aItems[i];if(oItem){if(Lang.isArray(oItem)){aItems[aItems.length]=this.addItems(oItem,i);}
else{aItems[aItems.length]=this._addItemToGroup(p_nGroupIndex,oItem);}}}
if(aItems.length){return aItems;}}},insertItem:function(p_oItem,p_nItemIndex,p_nGroupIndex){if(p_oItem){return this._addItemToGroup(p_nGroupIndex,p_oItem,p_nItemIndex);}},removeItem:function(p_oObject,p_nGroupIndex){var oItem;if(typeof p_oObject!="undefined"){if(p_oObject instanceof YAHOO.widget.MenuItem){oItem=this._removeItemFromGroupByValue(p_nGroupIndex,p_oObject);}
else if(typeof p_oObject=="number"){oItem=this._removeItemFromGroupByIndex(p_nGroupIndex,p_oObject);}
if(oItem){oItem.destroy();return oItem;}}},getItems:function(){var aGroups=this._aItemGroups,nGroups,aItems=[];if(Lang.isArray(aGroups)){nGroups=aGroups.length;return((nGroups==1)?aGroups[0]:(Array.prototype.concat.apply(aItems,aGroups)));}},getItemGroups:function(){return this._aItemGroups;},getItem:function(p_nItemIndex,p_nGroupIndex){var aGroup;if(typeof p_nItemIndex=="number"){aGroup=this._getItemGroup(p_nGroupIndex);if(aGroup){return aGroup[p_nItemIndex];}}},getSubmenus:function(){var aItems=this.getItems(),nItems=aItems.length,aSubmenus,oSubmenu,oItem,i;if(nItems>0){aSubmenus=[];for(i=0;i<nItems;i++){oItem=aItems[i];if(oItem){oSubmenu=oItem.cfg.getProperty("submenu");if(oSubmenu){aSubmenus[aSubmenus.length]=oSubmenu;}}}}
return aSubmenus;},clearContent:function(){var aItems=this.getItems(),nItems=aItems.length,oElement=this.element,oBody=this.body,oHeader=this.header,oFooter=this.footer,oItem,oSubmenu,i;if(nItems>0){i=nItems-1;do{oItem=aItems[i];if(oItem){oSubmenu=oItem.cfg.getProperty("submenu");if(oSubmenu){this.cfg.configChangedEvent.unsubscribe(this._onParentMenuConfigChange,oSubmenu);this.renderEvent.unsubscribe(this._onParentMenuRender,oSubmenu);}
this.removeItem(oItem);}}
while(i--);}
if(oHeader){Event.purgeElement(oHeader);oElement.removeChild(oHeader);}
if(oFooter){Event.purgeElement(oFooter);oElement.removeChild(oFooter);}
if(oBody){Event.purgeElement(oBody);oBody.innerHTML="";}
this.activeItem=null;this._aItemGroups=[];this._aListElements=[];this._aGroupTitleElements=[];this.cfg.setProperty("width",null);},destroy:function(){this.clearContent();this._aItemGroups=null;this._aListElements=null;this._aGroupTitleElements=null;Menu.superclass.destroy.call(this);},setInitialFocus:function(){var oItem=this._getFirstEnabledItem();if(oItem){oItem.focus();}},setInitialSelection:function(){var oItem=this._getFirstEnabledItem();if(oItem){oItem.cfg.setProperty("selected",true);}},clearActiveItem:function(p_bBlur){if(this.cfg.getProperty("showdelay")>0){this._cancelShowDelay();}
var oActiveItem=this.activeItem,oConfig,oSubmenu;if(oActiveItem){oConfig=oActiveItem.cfg;if(p_bBlur){oActiveItem.blur();}
oConfig.setProperty("selected",false);oSubmenu=oConfig.getProperty("submenu");if(oSubmenu){oSubmenu.hide();}
this.activeItem=null;}},focus:function(){if(!this.hasFocus()){this.setInitialFocus();}},blur:function(){var oItem;if(this.hasFocus()){oItem=MenuManager.getFocusedMenuItem();if(oItem){oItem.blur();}}},hasFocus:function(){return(MenuManager.getFocusedMenu()==this.getRoot());},subscribe:function(){function onItemAdded(p_sType,p_aArgs,p_oObject){var oItem=p_aArgs[0],oSubmenu=oItem.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.subscribe.apply(oSubmenu,p_oObject);}}
function onSubmenuAdded(p_sType,p_aArgs,p_oObject){var oSubmenu=this.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.subscribe.apply(oSubmenu,p_oObject);}}
Menu.superclass.subscribe.apply(this,arguments);Menu.superclass.subscribe.call(this,"itemAdded",onItemAdded,arguments);var aItems=this.getItems(),nItems,oItem,oSubmenu,i;if(aItems){nItems=aItems.length;if(nItems>0){i=nItems-1;do{oItem=aItems[i];oSubmenu=oItem.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.subscribe.apply(oSubmenu,arguments);}
else{oItem.cfg.subscribeToConfigEvent("submenu",onSubmenuAdded,arguments);}}
while(i--);}}},initDefaultConfig:function(){Menu.superclass.initDefaultConfig.call(this);var oConfig=this.cfg;oConfig.addProperty(DEFAULT_CONFIG.VISIBLE.key,{handler:this.configVisible,value:DEFAULT_CONFIG.VISIBLE.value,validator:DEFAULT_CONFIG.VISIBLE.validator});oConfig.addProperty(DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.key,{handler:this.configConstrainToViewport,value:DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.value,validator:DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.validator,supercedes:DEFAULT_CONFIG.CONSTRAIN_TO_VIEWPORT.supercedes});oConfig.addProperty(DEFAULT_CONFIG.POSITION.key,{handler:this.configPosition,value:DEFAULT_CONFIG.POSITION.value,validator:DEFAULT_CONFIG.POSITION.validator,supercedes:DEFAULT_CONFIG.POSITION.supercedes});oConfig.addProperty(DEFAULT_CONFIG.SUBMENU_ALIGNMENT.key,{value:DEFAULT_CONFIG.SUBMENU_ALIGNMENT.value,suppressEvent:DEFAULT_CONFIG.SUBMENU_ALIGNMENT.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.key,{value:DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.value,validator:DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.validator,suppressEvent:DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.SHOW_DELAY.key,{value:DEFAULT_CONFIG.SHOW_DELAY.value,validator:DEFAULT_CONFIG.SHOW_DELAY.validator,suppressEvent:DEFAULT_CONFIG.SHOW_DELAY.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.HIDE_DELAY.key,{handler:this.configHideDelay,value:DEFAULT_CONFIG.HIDE_DELAY.value,validator:DEFAULT_CONFIG.HIDE_DELAY.validator,suppressEvent:DEFAULT_CONFIG.HIDE_DELAY.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.SUBMENU_HIDE_DELAY.key,{value:DEFAULT_CONFIG.SUBMENU_HIDE_DELAY.value,validator:DEFAULT_CONFIG.SUBMENU_HIDE_DELAY.validator,suppressEvent:DEFAULT_CONFIG.SUBMENU_HIDE_DELAY.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.CLICK_TO_HIDE.key,{value:DEFAULT_CONFIG.CLICK_TO_HIDE.value,validator:DEFAULT_CONFIG.CLICK_TO_HIDE.validator,suppressEvent:DEFAULT_CONFIG.CLICK_TO_HIDE.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.CONTAINER.key,{handler:this.configContainer,value:document.body,suppressEvent:DEFAULT_CONFIG.CONTAINER.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.SCROLL_INCREMENT.key,{value:DEFAULT_CONFIG.SCROLL_INCREMENT.value,validator:DEFAULT_CONFIG.SCROLL_INCREMENT.validator,supercedes:DEFAULT_CONFIG.SCROLL_INCREMENT.supercedes,suppressEvent:DEFAULT_CONFIG.SCROLL_INCREMENT.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.MIN_SCROLL_HEIGHT.key,{value:DEFAULT_CONFIG.MIN_SCROLL_HEIGHT.value,validator:DEFAULT_CONFIG.MIN_SCROLL_HEIGHT.validator,supercedes:DEFAULT_CONFIG.MIN_SCROLL_HEIGHT.supercedes,suppressEvent:DEFAULT_CONFIG.MIN_SCROLL_HEIGHT.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.MAX_HEIGHT.key,{handler:this.configMaxHeight,value:DEFAULT_CONFIG.MAX_HEIGHT.value,validator:DEFAULT_CONFIG.MAX_HEIGHT.validator,suppressEvent:DEFAULT_CONFIG.MAX_HEIGHT.suppressEvent,supercedes:DEFAULT_CONFIG.MAX_HEIGHT.supercedes});oConfig.addProperty(DEFAULT_CONFIG.CLASS_NAME.key,{handler:this.configClassName,value:DEFAULT_CONFIG.CLASS_NAME.value,validator:DEFAULT_CONFIG.CLASS_NAME.validator,supercedes:DEFAULT_CONFIG.CLASS_NAME.supercedes});oConfig.addProperty(DEFAULT_CONFIG.DISABLED.key,{handler:this.configDisabled,value:DEFAULT_CONFIG.DISABLED.value,validator:DEFAULT_CONFIG.DISABLED.validator,suppressEvent:DEFAULT_CONFIG.DISABLED.suppressEvent});}});})();(function(){YAHOO.widget.MenuItem=function(p_oObject,p_oConfig){if(p_oObject){if(p_oConfig){this.parent=p_oConfig.parent;this.value=p_oConfig.value;this.id=p_oConfig.id;}
this.init(p_oObject,p_oConfig);}};var Dom=YAHOO.util.Dom,Module=YAHOO.widget.Module,Menu=YAHOO.widget.Menu,MenuItem=YAHOO.widget.MenuItem,CustomEvent=YAHOO.util.CustomEvent,Lang=YAHOO.lang,m_oMenuItemTemplate,EVENT_TYPES={"MOUSE_OVER":"mouseover","MOUSE_OUT":"mouseout","MOUSE_DOWN":"mousedown","MOUSE_UP":"mouseup","CLICK":"click","KEY_PRESS":"keypress","KEY_DOWN":"keydown","KEY_UP":"keyup","ITEM_ADDED":"itemAdded","ITEM_REMOVED":"itemRemoved","FOCUS":"focus","BLUR":"blur","DESTROY":"destroy"},DEFAULT_CONFIG={"TEXT":{key:"text",value:"",validator:Lang.isString,suppressEvent:true},"HELP_TEXT":{key:"helptext",supercedes:["text"],suppressEvent:true},"URL":{key:"url",value:"#",suppressEvent:true},"TARGET":{key:"target",suppressEvent:true},"EMPHASIS":{key:"emphasis",value:false,validator:Lang.isBoolean,suppressEvent:true,supercedes:["text"]},"STRONG_EMPHASIS":{key:"strongemphasis",value:false,validator:Lang.isBoolean,suppressEvent:true,supercedes:["text"]},"CHECKED":{key:"checked",value:false,validator:Lang.isBoolean,suppressEvent:true,supercedes:["disabled","selected"]},"SUBMENU":{key:"submenu",suppressEvent:true,supercedes:["disabled","selected"]},"DISABLED":{key:"disabled",value:false,validator:Lang.isBoolean,suppressEvent:true,supercedes:["text","selected"]},"SELECTED":{key:"selected",value:false,validator:Lang.isBoolean,suppressEvent:true},"ONCLICK":{key:"onclick",suppressEvent:true},"CLASS_NAME":{key:"classname",value:null,validator:Lang.isString,suppressEvent:true}};MenuItem.prototype={CSS_CLASS_NAME:"yuimenuitem",CSS_LABEL_CLASS_NAME:"yuimenuitemlabel",SUBMENU_TYPE:null,_oAnchor:null,_oHelpTextEM:null,_oSubmenu:null,_oOnclickAttributeValue:null,_sClassName:null,constructor:MenuItem,index:null,groupIndex:null,parent:null,element:null,srcElement:null,value:null,browser:Module.prototype.browser,id:null,destroyEvent:null,mouseOverEvent:null,mouseOutEvent:null,mouseDownEvent:null,mouseUpEvent:null,clickEvent:null,keyPressEvent:null,keyDownEvent:null,keyUpEvent:null,focusEvent:null,blurEvent:null,init:function(p_oObject,p_oConfig){if(!this.SUBMENU_TYPE){this.SUBMENU_TYPE=Menu;}
this.cfg=new YAHOO.util.Config(this);this.initDefaultConfig();var SIGNATURE=CustomEvent.LIST,oConfig=this.cfg,sURL="#",oAnchor,sTarget,sText,sId;if(Lang.isString(p_oObject)){this._createRootNodeStructure();oConfig.queueProperty("text",p_oObject);}
else if(p_oObject&&p_oObject.tagName){switch(p_oObject.tagName.toUpperCase()){case"OPTION":this._createRootNodeStructure();oConfig.queueProperty("text",p_oObject.text);oConfig.queueProperty("disabled",p_oObject.disabled);this.value=p_oObject.value;this.srcElement=p_oObject;break;case"OPTGROUP":this._createRootNodeStructure();oConfig.queueProperty("text",p_oObject.label);oConfig.queueProperty("disabled",p_oObject.disabled);this.srcElement=p_oObject;this._initSubTree();break;case"LI":oAnchor=Dom.getFirstChild(p_oObject);if(oAnchor){sURL=oAnchor.getAttribute("href",2);sTarget=oAnchor.getAttribute("target");sText=oAnchor.innerHTML;}
this.srcElement=p_oObject;this.element=p_oObject;this._oAnchor=oAnchor;oConfig.setProperty("text",sText,true);oConfig.setProperty("url",sURL,true);oConfig.setProperty("target",sTarget,true);this._initSubTree();break;}}
if(this.element){sId=(this.srcElement||this.element).id;if(!sId){sId=this.id||Dom.generateId();this.element.id=sId;}
this.id=sId;Dom.addClass(this.element,this.CSS_CLASS_NAME);Dom.addClass(this._oAnchor,this.CSS_LABEL_CLASS_NAME);this.mouseOverEvent=this.createEvent(EVENT_TYPES.MOUSE_OVER);this.mouseOverEvent.signature=SIGNATURE;this.mouseOutEvent=this.createEvent(EVENT_TYPES.MOUSE_OUT);this.mouseOutEvent.signature=SIGNATURE;this.mouseDownEvent=this.createEvent(EVENT_TYPES.MOUSE_DOWN);this.mouseDownEvent.signature=SIGNATURE;this.mouseUpEvent=this.createEvent(EVENT_TYPES.MOUSE_UP);this.mouseUpEvent.signature=SIGNATURE;this.clickEvent=this.createEvent(EVENT_TYPES.CLICK);this.clickEvent.signature=SIGNATURE;this.keyPressEvent=this.createEvent(EVENT_TYPES.KEY_PRESS);this.keyPressEvent.signature=SIGNATURE;this.keyDownEvent=this.createEvent(EVENT_TYPES.KEY_DOWN);this.keyDownEvent.signature=SIGNATURE;this.keyUpEvent=this.createEvent(EVENT_TYPES.KEY_UP);this.keyUpEvent.signature=SIGNATURE;this.focusEvent=this.createEvent(EVENT_TYPES.FOCUS);this.focusEvent.signature=SIGNATURE;this.blurEvent=this.createEvent(EVENT_TYPES.BLUR);this.blurEvent.signature=SIGNATURE;this.destroyEvent=this.createEvent(EVENT_TYPES.DESTROY);this.destroyEvent.signature=SIGNATURE;if(p_oConfig){oConfig.applyConfig(p_oConfig);}
oConfig.fireQueue();}},_createRootNodeStructure:function(){var oElement,oAnchor;
if(!m_oMenuItemTemplate){m_oMenuItemTemplate=document.createElement("li");m_oMenuItemTemplate.innerHTML="<a href=\"#\"></a>";}
oElement=m_oMenuItemTemplate.cloneNode(true);
oElement.className=this.CSS_CLASS_NAME;oAnchor=oElement.firstChild;oAnchor.className=this.CSS_LABEL_CLASS_NAME;this.element=oElement;this._oAnchor=oAnchor;},
_initSubTree:function(){var oSrcEl=this.srcElement,oConfig=this.cfg,oNode,aOptions,nOptions,oMenu,n;if(oSrcEl.childNodes.length>0){if(this.parent.lazyLoad&&this.parent.srcElement&&this.parent.srcElement.tagName.toUpperCase()=="SELECT"){oConfig.setProperty("submenu",{id:Dom.generateId(),itemdata:oSrcEl.childNodes});}
else{oNode=oSrcEl.firstChild;aOptions=[];do{if(oNode&&oNode.tagName){switch(oNode.tagName.toUpperCase()){case"DIV":oConfig.setProperty("submenu",oNode);break;case"OPTION":aOptions[aOptions.length]=oNode;break;}}}
while((oNode=oNode.nextSibling));nOptions=aOptions.length;if(nOptions>0){oMenu=new this.SUBMENU_TYPE(Dom.generateId());oConfig.setProperty("submenu",oMenu);for(n=0;n<nOptions;n++){oMenu.addItem((new oMenu.ITEM_TYPE(aOptions[n])));}}}}},configText:function(p_sType,p_aArgs,p_oItem){var sText=p_aArgs[0],oConfig=this.cfg,oAnchor=this._oAnchor,sHelpText=oConfig.getProperty("helptext"),sHelpTextHTML="",sEmphasisStartTag="",sEmphasisEndTag="";if(sText){if(sHelpText){sHelpTextHTML="<em class=\"helptext\">"+sHelpText+"</em>";}
if(oConfig.getProperty("emphasis")){sEmphasisStartTag="<em>";sEmphasisEndTag="</em>";}
if(oConfig.getProperty("strongemphasis")){sEmphasisStartTag="<strong>";sEmphasisEndTag="</strong>";}
oAnchor.innerHTML=(sEmphasisStartTag+sText+
sEmphasisEndTag+sHelpTextHTML);}},configHelpText:function(p_sType,p_aArgs,p_oItem){this.cfg.refireEvent("text");},configURL:function(p_sType,p_aArgs,p_oItem){var sURL=p_aArgs[0];if(!sURL){sURL="#";}
var oAnchor=this._oAnchor;if(YAHOO.env.ua.opera){oAnchor.removeAttribute("href");}
oAnchor.setAttribute("href",sURL);},configTarget:function(p_sType,p_aArgs,p_oItem){var sTarget=p_aArgs[0],oAnchor=this._oAnchor;if(sTarget&&sTarget.length>0){oAnchor.setAttribute("target",sTarget);}
else{oAnchor.removeAttribute("target");}},configEmphasis:function(p_sType,p_aArgs,p_oItem){var bEmphasis=p_aArgs[0],oConfig=this.cfg;if(bEmphasis&&oConfig.getProperty("strongemphasis")){oConfig.setProperty("strongemphasis",false);}
oConfig.refireEvent("text");},configStrongEmphasis:function(p_sType,p_aArgs,p_oItem){var bStrongEmphasis=p_aArgs[0],oConfig=this.cfg;if(bStrongEmphasis&&oConfig.getProperty("emphasis")){oConfig.setProperty("emphasis",false);}
oConfig.refireEvent("text");},configChecked:function(p_sType,p_aArgs,p_oItem){var bChecked=p_aArgs[0],oElement=this.element,oAnchor=this._oAnchor,oConfig=this.cfg,sState="-checked",sClassName=this.CSS_CLASS_NAME+sState,sLabelClassName=this.CSS_LABEL_CLASS_NAME+sState;if(bChecked){Dom.addClass(oElement,sClassName);Dom.addClass(oAnchor,sLabelClassName);}
else{Dom.removeClass(oElement,sClassName);Dom.removeClass(oAnchor,sLabelClassName);}
oConfig.refireEvent("text");if(oConfig.getProperty("disabled")){oConfig.refireEvent("disabled");}
if(oConfig.getProperty("selected")){oConfig.refireEvent("selected");}},configDisabled:function(p_sType,p_aArgs,p_oItem){var bDisabled=p_aArgs[0],oConfig=this.cfg,oSubmenu=oConfig.getProperty("submenu"),bChecked=oConfig.getProperty("checked"),oElement=this.element,oAnchor=this._oAnchor,sState="-disabled",sCheckedState="-checked"+sState,sSubmenuState="-hassubmenu"+sState,sClassName=this.CSS_CLASS_NAME+sState,sLabelClassName=this.CSS_LABEL_CLASS_NAME+sState,sCheckedClassName=this.CSS_CLASS_NAME+sCheckedState,sLabelCheckedClassName=this.CSS_LABEL_CLASS_NAME+sCheckedState,sSubmenuClassName=this.CSS_CLASS_NAME+sSubmenuState,sLabelSubmenuClassName=this.CSS_LABEL_CLASS_NAME+sSubmenuState;if(bDisabled){if(oConfig.getProperty("selected")){oConfig.setProperty("selected",false);}
Dom.addClass(oElement,sClassName);Dom.addClass(oAnchor,sLabelClassName);if(oSubmenu){Dom.addClass(oElement,sSubmenuClassName);Dom.addClass(oAnchor,sLabelSubmenuClassName);}
if(bChecked){Dom.addClass(oElement,sCheckedClassName);Dom.addClass(oAnchor,sLabelCheckedClassName);}}
else{Dom.removeClass(oElement,sClassName);Dom.removeClass(oAnchor,sLabelClassName);if(oSubmenu){Dom.removeClass(oElement,sSubmenuClassName);Dom.removeClass(oAnchor,sLabelSubmenuClassName);}
if(bChecked){Dom.removeClass(oElement,sCheckedClassName);Dom.removeClass(oAnchor,sLabelCheckedClassName);}}},configSelected:function(p_sType,p_aArgs,p_oItem){var oConfig=this.cfg,bSelected=p_aArgs[0],oElement=this.element,oAnchor=this._oAnchor,bChecked=oConfig.getProperty("checked"),oSubmenu=oConfig.getProperty("submenu"),sState="-selected",sCheckedState="-checked"+sState,sSubmenuState="-hassubmenu"+sState,sClassName=this.CSS_CLASS_NAME+sState,sLabelClassName=this.CSS_LABEL_CLASS_NAME+sState,sCheckedClassName=this.CSS_CLASS_NAME+sCheckedState,sLabelCheckedClassName=this.CSS_LABEL_CLASS_NAME+sCheckedState,sSubmenuClassName=this.CSS_CLASS_NAME+sSubmenuState,sLabelSubmenuClassName=this.CSS_LABEL_CLASS_NAME+sSubmenuState;if(YAHOO.env.ua.opera){oAnchor.blur();}
if(bSelected&&!oConfig.getProperty("disabled")){Dom.addClass(oElement,sClassName);Dom.addClass(oAnchor,sLabelClassName);if(oSubmenu){Dom.addClass(oElement,sSubmenuClassName);Dom.addClass(oAnchor,sLabelSubmenuClassName);}
if(bChecked){Dom.addClass(oElement,sCheckedClassName);Dom.addClass(oAnchor,sLabelCheckedClassName);}}
else{Dom.removeClass(oElement,sClassName);Dom.removeClass(oAnchor,sLabelClassName);if(oSubmenu){Dom.removeClass(oElement,sSubmenuClassName);Dom.removeClass(oAnchor,sLabelSubmenuClassName);}
if(bChecked){Dom.removeClass(oElement,sCheckedClassName);Dom.removeClass(oAnchor,sLabelCheckedClassName);}}
if(this.hasFocus()&&YAHOO.env.ua.opera){oAnchor.focus();}},_onSubmenuBeforeHide:function(p_sType,p_aArgs){var oItem=this.parent,oMenu;function onHide(){oItem._oAnchor.blur();oMenu.beforeHideEvent.unsubscribe(onHide);}
if(oItem.hasFocus()){oMenu=oItem.parent;oMenu.beforeHideEvent.subscribe(onHide);}},configSubmenu:function(p_sType,p_aArgs,p_oItem){var oSubmenu=p_aArgs[0],oConfig=this.cfg,oElement=this.element,oAnchor=this._oAnchor,bLazyLoad=this.parent&&this.parent.lazyLoad,sState="-hassubmenu",sClassName=this.CSS_CLASS_NAME+sState,sLabelClassName=this.CSS_LABEL_CLASS_NAME+sState,oMenu,sSubmenuId,oSubmenuConfig;if(oSubmenu){if(oSubmenu instanceof Menu){oMenu=oSubmenu;oMenu.parent=this;oMenu.lazyLoad=bLazyLoad;}
else if(typeof oSubmenu=="object"&&oSubmenu.id&&!oSubmenu.nodeType){sSubmenuId=oSubmenu.id;oSubmenuConfig=oSubmenu;oSubmenuConfig.lazyload=bLazyLoad;oSubmenuConfig.parent=this;oMenu=new this.SUBMENU_TYPE(sSubmenuId,oSubmenuConfig);oConfig.setProperty("submenu",oMenu,true);}
else{oMenu=new this.SUBMENU_TYPE(oSubmenu,{lazyload:bLazyLoad,parent:this});oConfig.setProperty("submenu",oMenu,true);}
if(oMenu){Dom.addClass(oElement,sClassName);Dom.addClass(oAnchor,sLabelClassName);this._oSubmenu=oMenu;if(YAHOO.env.ua.opera){oMenu.beforeHideEvent.subscribe(this._onSubmenuBeforeHide);}}}
else{Dom.removeClass(oElement,sClassName);Dom.removeClass(oAnchor,sLabelClassName);if(this._oSubmenu){this._oSubmenu.destroy();}}
if(oConfig.getProperty("disabled")){oConfig.refireEvent("disabled");}
if(oConfig.getProperty("selected")){oConfig.refireEvent("selected");}},configOnClick:function(p_sType,p_aArgs,p_oItem){var oObject=p_aArgs[0];if(this._oOnclickAttributeValue&&(this._oOnclickAttributeValue!=oObject)){this.clickEvent.unsubscribe(this._oOnclickAttributeValue.fn,this._oOnclickAttributeValue.obj);this._oOnclickAttributeValue=null;}
if(!this._oOnclickAttributeValue&&typeof oObject=="object"&&typeof oObject.fn=="function"){this.clickEvent.subscribe(oObject.fn,((!YAHOO.lang.isUndefined(oObject.obj))?oObject.obj:this),oObject.scope);this._oOnclickAttributeValue=oObject;}},configClassName:function(p_sType,p_aArgs,p_oItem){var sClassName=p_aArgs[0];if(this._sClassName){Dom.removeClass(this.element,this._sClassName);}
Dom.addClass(this.element,sClassName);this._sClassName=sClassName;},initDefaultConfig:function(){var oConfig=this.cfg;oConfig.addProperty(DEFAULT_CONFIG.TEXT.key,{handler:this.configText,value:DEFAULT_CONFIG.TEXT.value,validator:DEFAULT_CONFIG.TEXT.validator,suppressEvent:DEFAULT_CONFIG.TEXT.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.HELP_TEXT.key,{handler:this.configHelpText,supercedes:DEFAULT_CONFIG.HELP_TEXT.supercedes,suppressEvent:DEFAULT_CONFIG.HELP_TEXT.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.URL.key,{handler:this.configURL,value:DEFAULT_CONFIG.URL.value,suppressEvent:DEFAULT_CONFIG.URL.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.TARGET.key,{handler:this.configTarget,suppressEvent:DEFAULT_CONFIG.TARGET.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.EMPHASIS.key,{handler:this.configEmphasis,value:DEFAULT_CONFIG.EMPHASIS.value,validator:DEFAULT_CONFIG.EMPHASIS.validator,suppressEvent:DEFAULT_CONFIG.EMPHASIS.suppressEvent,supercedes:DEFAULT_CONFIG.EMPHASIS.supercedes});oConfig.addProperty(DEFAULT_CONFIG.STRONG_EMPHASIS.key,{handler:this.configStrongEmphasis,value:DEFAULT_CONFIG.STRONG_EMPHASIS.value,validator:DEFAULT_CONFIG.STRONG_EMPHASIS.validator,suppressEvent:DEFAULT_CONFIG.STRONG_EMPHASIS.suppressEvent,supercedes:DEFAULT_CONFIG.STRONG_EMPHASIS.supercedes});oConfig.addProperty(DEFAULT_CONFIG.CHECKED.key,{handler:this.configChecked,value:DEFAULT_CONFIG.CHECKED.value,validator:DEFAULT_CONFIG.CHECKED.validator,suppressEvent:DEFAULT_CONFIG.CHECKED.suppressEvent,supercedes:DEFAULT_CONFIG.CHECKED.supercedes});oConfig.addProperty(DEFAULT_CONFIG.DISABLED.key,{handler:this.configDisabled,value:DEFAULT_CONFIG.DISABLED.value,validator:DEFAULT_CONFIG.DISABLED.validator,suppressEvent:DEFAULT_CONFIG.DISABLED.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.SELECTED.key,{handler:this.configSelected,value:DEFAULT_CONFIG.SELECTED.value,validator:DEFAULT_CONFIG.SELECTED.validator,suppressEvent:DEFAULT_CONFIG.SELECTED.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.SUBMENU.key,{handler:this.configSubmenu,supercedes:DEFAULT_CONFIG.SUBMENU.supercedes,suppressEvent:DEFAULT_CONFIG.SUBMENU.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.ONCLICK.key,{handler:this.configOnClick,suppressEvent:DEFAULT_CONFIG.ONCLICK.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.CLASS_NAME.key,{handler:this.configClassName,value:DEFAULT_CONFIG.CLASS_NAME.value,validator:DEFAULT_CONFIG.CLASS_NAME.validator,suppressEvent:DEFAULT_CONFIG.CLASS_NAME.suppressEvent});},getNextEnabledSibling:function(){var nGroupIndex,aItemGroups,oNextItem,nNextGroupIndex,aNextGroup;function getNextArrayItem(p_aArray,p_nStartIndex){return p_aArray[p_nStartIndex]||getNextArrayItem(p_aArray,(p_nStartIndex+1));}
if(this.parent instanceof Menu){nGroupIndex=this.groupIndex;aItemGroups=this.parent.getItemGroups();if(this.index<(aItemGroups[nGroupIndex].length-1)){oNextItem=getNextArrayItem(aItemGroups[nGroupIndex],(this.index+1));}
else{if(nGroupIndex<(aItemGroups.length-1)){nNextGroupIndex=nGroupIndex+1;}
else{nNextGroupIndex=0;}
aNextGroup=getNextArrayItem(aItemGroups,nNextGroupIndex);oNextItem=getNextArrayItem(aNextGroup,0);}
return(oNextItem.cfg.getProperty("disabled")||oNextItem.element.style.display=="none")?oNextItem.getNextEnabledSibling():oNextItem;}},getPreviousEnabledSibling:function(){var nGroupIndex,aItemGroups,oPreviousItem,nPreviousGroupIndex,aPreviousGroup;function getPreviousArrayItem(p_aArray,p_nStartIndex){return p_aArray[p_nStartIndex]||getPreviousArrayItem(p_aArray,(p_nStartIndex-1));}
function getFirstItemIndex(p_aArray,p_nStartIndex){return p_aArray[p_nStartIndex]?p_nStartIndex:getFirstItemIndex(p_aArray,(p_nStartIndex+1));}
if(this.parent instanceof Menu){nGroupIndex=this.groupIndex;aItemGroups=this.parent.getItemGroups();if(this.index>getFirstItemIndex(aItemGroups[nGroupIndex],0)){oPreviousItem=getPreviousArrayItem(aItemGroups[nGroupIndex],(this.index-1));}
else{if(nGroupIndex>getFirstItemIndex(aItemGroups,0)){nPreviousGroupIndex=nGroupIndex-1;}
else{nPreviousGroupIndex=aItemGroups.length-1;}
aPreviousGroup=getPreviousArrayItem(aItemGroups,nPreviousGroupIndex);oPreviousItem=getPreviousArrayItem(aPreviousGroup,(aPreviousGroup.length-1));}
return(oPreviousItem.cfg.getProperty("disabled")||oPreviousItem.element.style.display=="none")?oPreviousItem.getPreviousEnabledSibling():oPreviousItem;}},focus:function(){var oParent=this.parent,oAnchor=this._oAnchor,oActiveItem=oParent.activeItem,me=this;function setFocus(){try{if(YAHOO.env.ua.ie&&!document.hasFocus()){return;}
if(oActiveItem){oActiveItem.blurEvent.fire();}
oAnchor.focus();me.focusEvent.fire();}
catch(e){}}
if(!this.cfg.getProperty("disabled")&&oParent&&oParent.cfg.getProperty("visible")&&this.element.style.display!="none"){window.setTimeout(setFocus,0);}},blur:function(){var oParent=this.parent;if(!this.cfg.getProperty("disabled")&&oParent&&oParent.cfg.getProperty("visible")){var me=this;window.setTimeout(function(){try{me._oAnchor.blur();me.blurEvent.fire();}
catch(e){}},0);}},hasFocus:function(){return(YAHOO.widget.MenuManager.getFocusedMenuItem()==this);},destroy:function(){var oEl=this.element,oSubmenu,oParentNode;if(oEl){oSubmenu=this.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.destroy();}
this.mouseOverEvent.unsubscribeAll();this.mouseOutEvent.unsubscribeAll();this.mouseDownEvent.unsubscribeAll();this.mouseUpEvent.unsubscribeAll();this.clickEvent.unsubscribeAll();this.keyPressEvent.unsubscribeAll();this.keyDownEvent.unsubscribeAll();this.keyUpEvent.unsubscribeAll();this.focusEvent.unsubscribeAll();this.blurEvent.unsubscribeAll();this.cfg.configChangedEvent.unsubscribeAll();oParentNode=oEl.parentNode;if(oParentNode){oParentNode.removeChild(oEl);this.destroyEvent.fire();}
this.destroyEvent.unsubscribeAll();}},toString:function(){var sReturnVal="MenuItem",sId=this.id;if(sId){sReturnVal+=(" "+sId);}
return sReturnVal;}};Lang.augmentProto(MenuItem,YAHOO.util.EventProvider);})();(function(){YAHOO.widget.ContextMenu=function(p_oElement,p_oConfig){YAHOO.widget.ContextMenu.superclass.constructor.call(this,p_oElement,p_oConfig);};var Event=YAHOO.util.Event,ContextMenu=YAHOO.widget.ContextMenu,EVENT_TYPES={"TRIGGER_CONTEXT_MENU":"triggerContextMenu","CONTEXT_MENU":(YAHOO.env.ua.opera?"mousedown":"contextmenu"),"CLICK":"click"},DEFAULT_CONFIG={"TRIGGER":{key:"trigger",suppressEvent:true}};function position(p_sType,p_aArgs,p_aPos){this.cfg.setProperty("xy",p_aPos);this.beforeShowEvent.unsubscribe(position,p_aPos);}
YAHOO.lang.extend(ContextMenu,YAHOO.widget.Menu,{_oTrigger:null,_bCancelled:false,contextEventTarget:null,triggerContextMenuEvent:null,init:function(p_oElement,p_oConfig){ContextMenu.superclass.init.call(this,p_oElement);this.beforeInitEvent.fire(ContextMenu);if(p_oConfig){this.cfg.applyConfig(p_oConfig,true);}
this.initEvent.fire(ContextMenu);},initEvents:function(){ContextMenu.superclass.initEvents.call(this);this.triggerContextMenuEvent=this.createEvent(EVENT_TYPES.TRIGGER_CONTEXT_MENU);this.triggerContextMenuEvent.signature=YAHOO.util.CustomEvent.LIST;},cancel:function(){this._bCancelled=true;},_removeEventHandlers:function(){var oTrigger=this._oTrigger;if(oTrigger){Event.removeListener(oTrigger,EVENT_TYPES.CONTEXT_MENU,this._onTriggerContextMenu);if(YAHOO.env.ua.opera){Event.removeListener(oTrigger,EVENT_TYPES.CLICK,this._onTriggerClick);}}},_onTriggerClick:function(p_oEvent,p_oMenu){if(p_oEvent.ctrlKey){Event.stopEvent(p_oEvent);}},_onTriggerContextMenu:function(p_oEvent,p_oMenu){if(p_oEvent.type=="mousedown"&&!p_oEvent.ctrlKey){return;}
var aXY;Event.stopEvent(p_oEvent);this.contextEventTarget=Event.getTarget(p_oEvent);this.triggerContextMenuEvent.fire(p_oEvent);YAHOO.widget.MenuManager.hideVisible();if(!this._bCancelled){aXY=Event.getXY(p_oEvent);if(!YAHOO.util.Dom.inDocument(this.element)){this.beforeShowEvent.subscribe(position,aXY);}
else{this.cfg.setProperty("xy",aXY);}
this.show();}
this._bCancelled=false;},toString:function(){var sReturnVal="ContextMenu",sId=this.id;if(sId){sReturnVal+=(" "+sId);}
return sReturnVal;},initDefaultConfig:function(){ContextMenu.superclass.initDefaultConfig.call(this);this.cfg.addProperty(DEFAULT_CONFIG.TRIGGER.key,{handler:this.configTrigger,suppressEvent:DEFAULT_CONFIG.TRIGGER.suppressEvent});},destroy:function(){this._removeEventHandlers();ContextMenu.superclass.destroy.call(this);},configTrigger:function(p_sType,p_aArgs,p_oMenu){var oTrigger=p_aArgs[0];if(oTrigger){if(this._oTrigger){this._removeEventHandlers();}
this._oTrigger=oTrigger;Event.on(oTrigger,EVENT_TYPES.CONTEXT_MENU,this._onTriggerContextMenu,this,true);if(YAHOO.env.ua.opera){Event.on(oTrigger,EVENT_TYPES.CLICK,this._onTriggerClick,this,true);}}
else{this._removeEventHandlers();}}});}());YAHOO.widget.ContextMenuItem=YAHOO.widget.MenuItem;(function(){YAHOO.widget.MenuBar=function(p_oElement,p_oConfig){YAHOO.widget.MenuBar.superclass.constructor.call(this,p_oElement,p_oConfig);};function checkPosition(p_sPosition){if(typeof p_sPosition=="string"){return("dynamic,static".indexOf((p_sPosition.toLowerCase()))!=-1);}}
var Event=YAHOO.util.Event,MenuBar=YAHOO.widget.MenuBar,DEFAULT_CONFIG={"POSITION":{key:"position",value:"static",validator:checkPosition,supercedes:["visible"]},"SUBMENU_ALIGNMENT":{key:"submenualignment",value:["tl","bl"],suppressEvent:true},"AUTO_SUBMENU_DISPLAY":{key:"autosubmenudisplay",value:false,validator:YAHOO.lang.isBoolean,suppressEvent:true}};YAHOO.lang.extend(MenuBar,YAHOO.widget.Menu,{init:function(p_oElement,p_oConfig){if(!this.ITEM_TYPE){this.ITEM_TYPE=YAHOO.widget.MenuBarItem;}
MenuBar.superclass.init.call(this,p_oElement);this.beforeInitEvent.fire(MenuBar);if(p_oConfig){this.cfg.applyConfig(p_oConfig,true);}
this.initEvent.fire(MenuBar);},CSS_CLASS_NAME:"yuimenubar",_onKeyDown:function(p_sType,p_aArgs,p_oMenuBar){var oEvent=p_aArgs[0],oItem=p_aArgs[1],oSubmenu,oItemCfg,oNextItem;if(oItem&&!oItem.cfg.getProperty("disabled")){oItemCfg=oItem.cfg;switch(oEvent.keyCode){case 37:case 39:if(oItem==this.activeItem&&!oItemCfg.getProperty("selected")){oItemCfg.setProperty("selected",true);}
else{oNextItem=(oEvent.keyCode==37)?oItem.getPreviousEnabledSibling():oItem.getNextEnabledSibling();if(oNextItem){this.clearActiveItem();oNextItem.cfg.setProperty("selected",true);if(this.cfg.getProperty("autosubmenudisplay")){oSubmenu=oNextItem.cfg.getProperty("submenu");if(oSubmenu){oSubmenu.show();}}
oNextItem.focus();}}
Event.preventDefault(oEvent);break;case 40:if(this.activeItem!=oItem){this.clearActiveItem();oItemCfg.setProperty("selected",true);oItem.focus();}
oSubmenu=oItemCfg.getProperty("submenu");if(oSubmenu){if(oSubmenu.cfg.getProperty("visible")){oSubmenu.setInitialSelection();oSubmenu.setInitialFocus();}
else{oSubmenu.show();}}
Event.preventDefault(oEvent);break;}}
if(oEvent.keyCode==27&&this.activeItem){oSubmenu=this.activeItem.cfg.getProperty("submenu");if(oSubmenu&&oSubmenu.cfg.getProperty("visible")){oSubmenu.hide();this.activeItem.focus();}
else{this.activeItem.cfg.setProperty("selected",false);this.activeItem.blur();}
Event.preventDefault(oEvent);}},_onClick:function(p_sType,p_aArgs,p_oMenuBar){MenuBar.superclass._onClick.call(this,p_sType,p_aArgs,p_oMenuBar);var oItem=p_aArgs[1],oEvent,oTarget,oActiveItem,oConfig,oSubmenu;if(oItem&&!oItem.cfg.getProperty("disabled")){oEvent=p_aArgs[0];oTarget=Event.getTarget(oEvent);oActiveItem=this.activeItem;oConfig=this.cfg;if(oActiveItem&&oActiveItem!=oItem){this.clearActiveItem();}
oItem.cfg.setProperty("selected",true);oSubmenu=oItem.cfg.getProperty("submenu");if(oSubmenu){if(oSubmenu.cfg.getProperty("visible")){oSubmenu.hide();}
else{oSubmenu.show();}}}},toString:function(){var sReturnVal="MenuBar",sId=this.id;if(sId){sReturnVal+=(" "+sId);}
return sReturnVal;},initDefaultConfig:function(){MenuBar.superclass.initDefaultConfig.call(this);var oConfig=this.cfg;oConfig.addProperty(DEFAULT_CONFIG.POSITION.key,{handler:this.configPosition,value:DEFAULT_CONFIG.POSITION.value,validator:DEFAULT_CONFIG.POSITION.validator,supercedes:DEFAULT_CONFIG.POSITION.supercedes});oConfig.addProperty(DEFAULT_CONFIG.SUBMENU_ALIGNMENT.key,{value:DEFAULT_CONFIG.SUBMENU_ALIGNMENT.value,suppressEvent:DEFAULT_CONFIG.SUBMENU_ALIGNMENT.suppressEvent});oConfig.addProperty(DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.key,{value:DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.value,validator:DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.validator,suppressEvent:DEFAULT_CONFIG.AUTO_SUBMENU_DISPLAY.suppressEvent});}});}());YAHOO.widget.MenuBarItem=function(p_oObject,p_oConfig){YAHOO.widget.MenuBarItem.superclass.constructor.call(this,p_oObject,p_oConfig);};YAHOO.lang.extend(YAHOO.widget.MenuBarItem,YAHOO.widget.MenuItem,{init:function(p_oObject,p_oConfig){if(!this.SUBMENU_TYPE){this.SUBMENU_TYPE=YAHOO.widget.Menu;}
YAHOO.widget.MenuBarItem.superclass.init.call(this,p_oObject);var oConfig=this.cfg;if(p_oConfig){oConfig.applyConfig(p_oConfig,true);}
oConfig.fireQueue();},CSS_CLASS_NAME:"yuimenubaritem",CSS_LABEL_CLASS_NAME:"yuimenubaritemlabel",toString:function(){var sReturnVal="MenuBarItem";if(this.cfg&&this.cfg.getProperty("text")){sReturnVal+=(": "+this.cfg.getProperty("text"));}
return sReturnVal;}});YAHOO.register("menu",YAHOO.widget.Menu,{version:"2.5.2",build:"1076"});

YAHOO.util.Connect={_msxml_progid:['Microsoft.XMLHTTP','MSXML2.XMLHTTP.3.0','MSXML2.XMLHTTP'],_http_headers:{},_has_http_headers:false,_use_default_post_header:true,_default_post_header:'application/x-www-form-urlencoded; charset=UTF-8',_default_form_header:'application/x-www-form-urlencoded',_use_default_xhr_header:true,_default_xhr_header:'XMLHttpRequest',_has_default_headers:true,_default_headers:{},_isFormSubmit:false,_isFileUpload:false,_formNode:null,_sFormData:null,_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,_submitElementValue:null,_hasSubmitListener:(function()
{if(YAHOO.util.Event){YAHOO.util.Event.addListener(document,'click',function(e){var obj=YAHOO.util.Event.getTarget(e);if(obj.nodeName.toLowerCase()=='input'&&(obj.type&&obj.type.toLowerCase()=='submit')){YAHOO.util.Connect._submitElementValue=encodeURIComponent(obj.name)+"="+encodeURIComponent(obj.value);}});return true;}
return false;})(),startEvent:new YAHOO.util.CustomEvent('start'),completeEvent:new YAHOO.util.CustomEvent('complete'),successEvent:new YAHOO.util.CustomEvent('success'),failureEvent:new YAHOO.util.CustomEvent('failure'),uploadEvent:new YAHOO.util.CustomEvent('upload'),abortEvent:new YAHOO.util.CustomEvent('abort'),_customEvents:{onStart:['startEvent','start'],onComplete:['completeEvent','complete'],onSuccess:['successEvent','success'],onFailure:['failureEvent','failure'],onUpload:['uploadEvent','upload'],onAbort:['abortEvent','abort']},setProgId:function(id)
{this._msxml_progid.unshift(id);},setDefaultPostHeader:function(b)
{if(typeof b=='string'){this._default_post_header=b;}
else if(typeof b=='boolean'){this._use_default_post_header=b;}},setDefaultXhrHeader:function(b)
{if(typeof b=='string'){this._default_xhr_header=b;}
else{this._use_default_xhr_header=b;}},setPollingInterval:function(i)
{if(typeof i=='number'&&isFinite(i)){this._polling_interval=i;}},createXhrObject:function(transactionId)
{var obj,http;try
{http=new XMLHttpRequest();obj={conn:http,tId:transactionId};}
catch(e)
{for(var i=0;i<this._msxml_progid.length;++i){try
{http=new ActiveXObject(this._msxml_progid[i]);obj={conn:http,tId:transactionId};break;}
catch(e){}}}
finally
{return obj;}},getConnectionObject:function(isFileUpload)
{var o;var tId=this._transaction_id;try
{if(!isFileUpload){o=this.createXhrObject(tId);}
else{o={};o.tId=tId;o.isUpload=true;}
if(o){this._transaction_id++;}}
catch(e){}
finally
{return o;}},asyncRequest:function(method,uri,callback,postData)
{var o=(this._isFileUpload)?this.getConnectionObject(true):this.getConnectionObject();var args=(callback&&callback.argument)?callback.argument:null;if(!o){return null;}
else{if(callback&&callback.customevents){this.initCustomEvents(o,callback);}
if(this._isFormSubmit){if(this._isFileUpload){this.uploadFile(o,callback,uri,postData);return o;}
if(method.toUpperCase()=='GET'){if(this._sFormData.length!==0){uri+=((uri.indexOf('?')==-1)?'?':'&')+this._sFormData;}}
else if(method.toUpperCase()=='POST'){postData=postData?this._sFormData+"&"+postData:this._sFormData;}}
if(method.toUpperCase()=='GET'&&(callback&&callback.cache===false)){uri+=((uri.indexOf('?')==-1)?'?':'&')+"rnd="+new Date().valueOf().toString();}
o.conn.open(method,uri,true);if(this._use_default_xhr_header){if(!this._default_headers['X-Requested-With']){this.initHeader('X-Requested-With',this._default_xhr_header,true);}}
if((method.toUpperCase()=='POST'&&this._use_default_post_header)&&this._isFormSubmit===false){this.initHeader('Content-Type',this._default_post_header);}
if(this._has_default_headers||this._has_http_headers){this.setHeader(o);}
this.handleReadyState(o,callback);o.conn.send(postData||'');if(this._isFormSubmit===true){this.resetFormState();}
this.startEvent.fire(o,args);if(o.startEvent){o.startEvent.fire(o,args);}
return o;}},initCustomEvents:function(o,callback)
{for(var prop in callback.customevents){if(this._customEvents[prop][0]){o[this._customEvents[prop][0]]=new YAHOO.util.CustomEvent(this._customEvents[prop][1],(callback.scope)?callback.scope:null);o[this._customEvents[prop][0]].subscribe(callback.customevents[prop]);}}},handleReadyState:function(o,callback)
{var oConn=this;var args=(callback&&callback.argument)?callback.argument:null;if(callback&&callback.timeout){this._timeOut[o.tId]=window.setTimeout(function(){oConn.abort(o,callback,true);},callback.timeout);}
this._poll[o.tId]=window.setInterval(function(){if(o.conn&&o.conn.readyState===4){window.clearInterval(oConn._poll[o.tId]);delete oConn._poll[o.tId];if(callback&&callback.timeout){window.clearTimeout(oConn._timeOut[o.tId]);delete oConn._timeOut[o.tId];}
oConn.completeEvent.fire(o,args);if(o.completeEvent){o.completeEvent.fire(o,args);}
oConn.handleTransactionResponse(o,callback);}},this._polling_interval);},handleTransactionResponse:function(o,callback,isAbort)
{var httpStatus,responseObject;var args=(callback&&callback.argument)?callback.argument:null;try
{if(o.conn.status!==undefined&&o.conn.status!==0){httpStatus=o.conn.status;}
else{httpStatus=13030;}}
catch(e){httpStatus=13030;}
if(httpStatus>=200&&httpStatus<300||httpStatus===1223){responseObject=this.createResponseObject(o,args);if(callback&&callback.success){if(!callback.scope){callback.success(responseObject);}
else{callback.success.apply(callback.scope,[responseObject]);}}
this.successEvent.fire(responseObject);if(o.successEvent){o.successEvent.fire(responseObject);}}
else{switch(httpStatus){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:responseObject=this.createExceptionObject(o.tId,args,(isAbort?isAbort:false));if(callback&&callback.failure){if(!callback.scope){callback.failure(responseObject);}
else{callback.failure.apply(callback.scope,[responseObject]);}}
break;default:responseObject=this.createResponseObject(o,args);if(callback&&callback.failure){if(!callback.scope){callback.failure(responseObject);}
else{callback.failure.apply(callback.scope,[responseObject]);}}}
this.failureEvent.fire(responseObject);if(o.failureEvent){o.failureEvent.fire(responseObject);}}
this.releaseObject(o);responseObject=null;},createResponseObject:function(o,callbackArg)
{var obj={};var headerObj={};try
{var headerStr=o.conn.getAllResponseHeaders();var header=headerStr.split('\n');for(var i=0;i<header.length;i++){var delimitPos=header[i].indexOf(':');if(delimitPos!=-1){headerObj[header[i].substring(0,delimitPos)]=header[i].substring(delimitPos+2);}}}
catch(e){}
obj.tId=o.tId;obj.status=(o.conn.status==1223)?204:o.conn.status;obj.statusText=(o.conn.status==1223)?"No Content":o.conn.statusText;obj.getResponseHeader=headerObj;obj.getAllResponseHeaders=headerStr;obj.responseText=o.conn.responseText;obj.responseXML=o.conn.responseXML;if(callbackArg){obj.argument=callbackArg;}
return obj;},createExceptionObject:function(tId,callbackArg,isAbort)
{var COMM_CODE=0;var COMM_ERROR='communication failure';var ABORT_CODE=-1;var ABORT_ERROR='transaction aborted';var obj={};obj.tId=tId;if(isAbort){obj.status=ABORT_CODE;obj.statusText=ABORT_ERROR;}
else{obj.status=COMM_CODE;obj.statusText=COMM_ERROR;}
if(callbackArg){obj.argument=callbackArg;}
return obj;},initHeader:function(label,value,isDefault)
{var headerObj=(isDefault)?this._default_headers:this._http_headers;headerObj[label]=value;if(isDefault){this._has_default_headers=true;}
else{this._has_http_headers=true;}},setHeader:function(o)
{if(this._has_default_headers){for(var prop in this._default_headers){if(YAHOO.lang.hasOwnProperty(this._default_headers,prop)){o.conn.setRequestHeader(prop,this._default_headers[prop]);}}}
if(this._has_http_headers){for(var prop in this._http_headers){if(YAHOO.lang.hasOwnProperty(this._http_headers,prop)){o.conn.setRequestHeader(prop,this._http_headers[prop]);}}
delete this._http_headers;this._http_headers={};this._has_http_headers=false;}},resetDefaultHeaders:function(){delete this._default_headers;this._default_headers={};this._has_default_headers=false;},setForm:function(formId,isUpload,secureUri)
{this.resetFormState();var oForm;if(typeof formId=='string'){oForm=(document.getElementById(formId)||document.forms[formId]);}
else if(typeof formId=='object'){oForm=formId;}
else{return;}
if(isUpload){var io=this.createFrame((window.location.href.toLowerCase().indexOf("https")===0||secureUri)?true:false);this._isFormSubmit=true;this._isFileUpload=true;this._formNode=oForm;return;}
var oElement,oName,oValue,oDisabled;var hasSubmit=false;for(var i=0;i<oForm.elements.length;i++){oElement=oForm.elements[i];oDisabled=oElement.disabled;oName=oElement.name;oValue=oElement.value;if(!oDisabled&&oName)
{switch(oElement.type)
{case'select-one':case'select-multiple':for(var j=0;j<oElement.options.length;j++){if(oElement.options[j].selected){if(window.ActiveXObject){this._sFormData+=encodeURIComponent(oName)+'='+encodeURIComponent(oElement.options[j].attributes['value'].specified?oElement.options[j].value:oElement.options[j].text)+'&';}
else{this._sFormData+=encodeURIComponent(oName)+'='+encodeURIComponent(oElement.options[j].hasAttribute('value')?oElement.options[j].value:oElement.options[j].text)+'&';}}}
break;case'radio':case'checkbox':if(oElement.checked){this._sFormData+=encodeURIComponent(oName)+'='+encodeURIComponent(oValue)+'&';}
break;case'file':case undefined:case'reset':case'button':break;case'submit':if(hasSubmit===false){if(this._hasSubmitListener&&this._submitElementValue){this._sFormData+=this._submitElementValue+'&';}
else{this._sFormData+=encodeURIComponent(oName)+'='+encodeURIComponent(oValue)+'&';}
hasSubmit=true;}
break;default:this._sFormData+=encodeURIComponent(oName)+'='+encodeURIComponent(oValue)+'&';}}}
this._isFormSubmit=true;this._sFormData=this._sFormData.substr(0,this._sFormData.length-1);this.initHeader('Content-Type',this._default_form_header);return this._sFormData;},resetFormState:function(){this._isFormSubmit=false;this._isFileUpload=false;this._formNode=null;this._sFormData="";},createFrame:function(secureUri){var frameId='yuiIO'+this._transaction_id;var io;if(window.ActiveXObject){io=document.createElement('<iframe id="'+frameId+'" name="'+frameId+'" />');if(typeof secureUri=='boolean'){io.src='javascript:false';}}
else{io=document.createElement('iframe');io.id=frameId;io.name=frameId;}
io.style.position='absolute';io.style.top='-1000px';io.style.left='-1000px';document.body.appendChild(io);},appendPostData:function(postData)
{var formElements=[];var postMessage=postData.split('&');for(var i=0;i<postMessage.length;i++){var delimitPos=postMessage[i].indexOf('=');if(delimitPos!=-1){formElements[i]=document.createElement('input');formElements[i].type='hidden';formElements[i].name=postMessage[i].substring(0,delimitPos);formElements[i].value=postMessage[i].substring(delimitPos+1);this._formNode.appendChild(formElements[i]);}}
return formElements;},uploadFile:function(o,callback,uri,postData){var oConn=this;var frameId='yuiIO'+o.tId;var uploadEncoding='multipart/form-data';var io=document.getElementById(frameId);var args=(callback&&callback.argument)?callback.argument:null;var rawFormAttributes={action:this._formNode.getAttribute('action'),method:this._formNode.getAttribute('method'),target:this._formNode.getAttribute('target')};this._formNode.setAttribute('action',uri);this._formNode.setAttribute('method','POST');this._formNode.setAttribute('target',frameId);if(YAHOO.env.ua.ie){this._formNode.setAttribute('encoding',uploadEncoding);}
else{this._formNode.setAttribute('enctype',uploadEncoding);}
if(postData){var oElements=this.appendPostData(postData);}
this._formNode.submit();this.startEvent.fire(o,args);if(o.startEvent){o.startEvent.fire(o,args);}
if(callback&&callback.timeout){this._timeOut[o.tId]=window.setTimeout(function(){oConn.abort(o,callback,true);},callback.timeout);}
if(oElements&&oElements.length>0){for(var i=0;i<oElements.length;i++){this._formNode.removeChild(oElements[i]);}}
for(var prop in rawFormAttributes){if(YAHOO.lang.hasOwnProperty(rawFormAttributes,prop)){if(rawFormAttributes[prop]){this._formNode.setAttribute(prop,rawFormAttributes[prop]);}
else{this._formNode.removeAttribute(prop);}}}
this.resetFormState();var uploadCallback=function()
{if(callback&&callback.timeout){window.clearTimeout(oConn._timeOut[o.tId]);delete oConn._timeOut[o.tId];}
oConn.completeEvent.fire(o,args);if(o.completeEvent){o.completeEvent.fire(o,args);}
var obj={};obj.tId=o.tId;obj.argument=callback.argument;try
{obj.responseText=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:io.contentWindow.document.documentElement.textContent;obj.responseXML=io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document;}
catch(e){}
if(callback&&callback.upload){if(!callback.scope){callback.upload(obj);}
else{callback.upload.apply(callback.scope,[obj]);}}
oConn.uploadEvent.fire(obj);if(o.uploadEvent){o.uploadEvent.fire(obj);}
YAHOO.util.Event.removeListener(io,"load",uploadCallback);setTimeout(function(){document.body.removeChild(io);oConn.releaseObject(o);},100);};YAHOO.util.Event.addListener(io,"load",uploadCallback);},abort:function(o,callback,isTimeout)
{var abortStatus;var args=(callback&&callback.argument)?callback.argument:null;if(o&&o.conn){if(this.isCallInProgress(o)){o.conn.abort();window.clearInterval(this._poll[o.tId]);delete this._poll[o.tId];if(isTimeout){window.clearTimeout(this._timeOut[o.tId]);delete this._timeOut[o.tId];}
abortStatus=true;}}
else if(o&&o.isUpload===true){var frameId='yuiIO'+o.tId;var io=document.getElementById(frameId);if(io){YAHOO.util.Event.removeListener(io,"load");document.body.removeChild(io);if(isTimeout){window.clearTimeout(this._timeOut[o.tId]);delete this._timeOut[o.tId];}
abortStatus=true;}}
else{abortStatus=false;}
if(abortStatus===true){this.abortEvent.fire(o,args);if(o.abortEvent){o.abortEvent.fire(o,args);}
this.handleTransactionResponse(o,callback,true);}
return abortStatus;},isCallInProgress:function(o)
{if(o&&o.conn){return o.conn.readyState!==4&&o.conn.readyState!==0;}
else if(o&&o.isUpload===true){var frameId='yuiIO'+o.tId;return document.getElementById(frameId)?true:false;}
else{return false;}},releaseObject:function(o)
{if(o&&o.conn){o.conn=null;o=null;}}};YAHOO.register("connection",YAHOO.util.Connect,{version:"2.5.2",build:"1076"});

(function(){var Y=YAHOO.util;var Anim=function(el,attributes,duration,method){if(!el){}
this.init(el,attributes,duration,method);};Anim.NAME='Anim';Anim.prototype={toString:function(){var el=this.getEl()||{};var id=el.id||el.tagName;return(this.constructor.NAME+': '+id);},patterns:{noNegatives:/width|height|opacity|padding/i,offsetAttribute:/^((width|height)|(top|left))$/,defaultUnit:/width|height|top$|bottom$|left$|right$/i,offsetUnit:/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i},doMethod:function(attr,start,end){return this.method(this.currentFrame,start,end-start,this.totalFrames);},setAttribute:function(attr,val,unit){if(this.patterns.noNegatives.test(attr)){val=(val>0)?val:0;}
Y.Dom.setStyle(this.getEl(),attr,val+unit);},getAttribute:function(attr){var el=this.getEl();var val=Y.Dom.getStyle(el,attr);if(val!=='auto'&&!this.patterns.offsetUnit.test(val)){return parseFloat(val);}
var a=this.patterns.offsetAttribute.exec(attr)||[];var pos=!!(a[3]);var box=!!(a[2]);if(box||(Y.Dom.getStyle(el,'position')=='absolute'&&pos)){val=el['offset'+a[0].charAt(0).toUpperCase()+a[0].substr(1)];}else{val=0;}
return val;},getDefaultUnit:function(attr){if(this.patterns.defaultUnit.test(attr)){return'px';}
return'';},setRuntimeAttribute:function(attr){var start;var end;var attributes=this.attributes;this.runtimeAttributes[attr]={};var isset=function(prop){return(typeof prop!=='undefined');};if(!isset(attributes[attr]['to'])&&!isset(attributes[attr]['by'])){return false;}
start=(isset(attributes[attr]['from']))?attributes[attr]['from']:this.getAttribute(attr);if(isset(attributes[attr]['to'])){end=attributes[attr]['to'];}else if(isset(attributes[attr]['by'])){if(start.constructor==Array){end=[];for(var i=0,len=start.length;i<len;++i){end[i]=start[i]+attributes[attr]['by'][i]*1;}}else{end=start+attributes[attr]['by']*1;}}
this.runtimeAttributes[attr].start=start;this.runtimeAttributes[attr].end=end;this.runtimeAttributes[attr].unit=(isset(attributes[attr].unit))?attributes[attr]['unit']:this.getDefaultUnit(attr);return true;},init:function(el,attributes,duration,method){var isAnimated=false;var startTime=null;var actualFrames=0;el=Y.Dom.get(el);this.attributes=attributes||{};this.duration=!YAHOO.lang.isUndefined(duration)?duration:1;this.method=method||Y.Easing.easeNone;this.useSeconds=true;this.currentFrame=0;this.totalFrames=Y.AnimMgr.fps;this.setEl=function(element){el=Y.Dom.get(element);};this.getEl=function(){return el;};this.isAnimated=function(){return isAnimated;};this.getStartTime=function(){return startTime;};this.runtimeAttributes={};this.animate=function(){if(this.isAnimated()){return false;}
this.currentFrame=0;this.totalFrames=(this.useSeconds)?Math.ceil(Y.AnimMgr.fps*this.duration):this.duration;if(this.duration===0&&this.useSeconds){this.totalFrames=1;}
Y.AnimMgr.registerElement(this);return true;};this.stop=function(finish){if(!this.isAnimated()){return false;}
if(finish){this.currentFrame=this.totalFrames;this._onTween.fire();}
Y.AnimMgr.stop(this);};var onStart=function(){this.onStart.fire();this.runtimeAttributes={};for(var attr in this.attributes){this.setRuntimeAttribute(attr);}
isAnimated=true;actualFrames=0;startTime=new Date();};var onTween=function(){var data={duration:new Date()-this.getStartTime(),currentFrame:this.currentFrame};data.toString=function(){return('duration: '+data.duration+', currentFrame: '+data.currentFrame);};this.onTween.fire(data);var runtimeAttributes=this.runtimeAttributes;for(var attr in runtimeAttributes){this.setAttribute(attr,this.doMethod(attr,runtimeAttributes[attr].start,runtimeAttributes[attr].end),runtimeAttributes[attr].unit);}
actualFrames+=1;};var onComplete=function(){var actual_duration=(new Date()-startTime)/1000;var data={duration:actual_duration,frames:actualFrames,fps:actualFrames/actual_duration};data.toString=function(){return('duration: '+data.duration+', frames: '+data.frames+', fps: '+data.fps);};isAnimated=false;actualFrames=0;this.onComplete.fire(data);};this._onStart=new Y.CustomEvent('_start',this,true);this.onStart=new Y.CustomEvent('start',this);this.onTween=new Y.CustomEvent('tween',this);this._onTween=new Y.CustomEvent('_tween',this,true);this.onComplete=new Y.CustomEvent('complete',this);this._onComplete=new Y.CustomEvent('_complete',this,true);this._onStart.subscribe(onStart);this._onTween.subscribe(onTween);this._onComplete.subscribe(onComplete);}};Y.Anim=Anim;})();YAHOO.util.AnimMgr=new function(){var thread=null;var queue=[];var tweenCount=0;this.fps=1000;this.delay=1;this.registerElement=function(tween){queue[queue.length]=tween;tweenCount+=1;tween._onStart.fire();this.start();};this.unRegister=function(tween,index){index=index||getIndex(tween);if(!tween.isAnimated()||index==-1){return false;}
tween._onComplete.fire();queue.splice(index,1);tweenCount-=1;if(tweenCount<=0){this.stop();}
return true;};this.start=function(){if(thread===null){thread=setInterval(this.run,this.delay);}};this.stop=function(tween){if(!tween){clearInterval(thread);for(var i=0,len=queue.length;i<len;++i){this.unRegister(queue[0],0);}
queue=[];thread=null;tweenCount=0;}
else{this.unRegister(tween);}};this.run=function(){for(var i=0,len=queue.length;i<len;++i){var tween=queue[i];if(!tween||!tween.isAnimated()){continue;}
if(tween.currentFrame<tween.totalFrames||tween.totalFrames===null)
{tween.currentFrame+=1;if(tween.useSeconds){correctFrame(tween);}
tween._onTween.fire();}
else{YAHOO.util.AnimMgr.stop(tween,i);}}};var getIndex=function(anim){for(var i=0,len=queue.length;i<len;++i){if(queue[i]==anim){return i;}}
return-1;};var correctFrame=function(tween){var frames=tween.totalFrames;var frame=tween.currentFrame;var expected=(tween.currentFrame*tween.duration*1000/tween.totalFrames);var elapsed=(new Date()-tween.getStartTime());var tweak=0;if(elapsed<tween.duration*1000){tweak=Math.round((elapsed/expected-1)*tween.currentFrame);}else{tweak=frames-(frame+1);}
if(tweak>0&&isFinite(tweak)){if(tween.currentFrame+tweak>=frames){tweak=frames-(frame+1);}
tween.currentFrame+=tweak;}};};YAHOO.util.Bezier=new function(){this.getPosition=function(points,t){var n=points.length;var tmp=[];for(var i=0;i<n;++i){tmp[i]=[points[i][0],points[i][1]];}
for(var j=1;j<n;++j){for(i=0;i<n-j;++i){tmp[i][0]=(1-t)*tmp[i][0]+t*tmp[parseInt(i+1,10)][0];tmp[i][1]=(1-t)*tmp[i][1]+t*tmp[parseInt(i+1,10)][1];}}
return[tmp[0][0],tmp[0][1]];};};(function(){var ColorAnim=function(el,attributes,duration,method){ColorAnim.superclass.constructor.call(this,el,attributes,duration,method);};ColorAnim.NAME='ColorAnim';var Y=YAHOO.util;YAHOO.extend(ColorAnim,Y.Anim);var superclass=ColorAnim.superclass;var proto=ColorAnim.prototype;proto.patterns.color=/color$/i;proto.patterns.rgb=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i;proto.patterns.hex=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i;proto.patterns.hex3=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i;proto.patterns.transparent=/^transparent|rgba\(0, 0, 0, 0\)$/;proto.parseColor=function(s){if(s.length==3){return s;}
var c=this.patterns.hex.exec(s);if(c&&c.length==4){return[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)];}
c=this.patterns.rgb.exec(s);if(c&&c.length==4){return[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)];}
c=this.patterns.hex3.exec(s);if(c&&c.length==4){return[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)];}
return null;};proto.getAttribute=function(attr){var el=this.getEl();if(this.patterns.color.test(attr)){var val=YAHOO.util.Dom.getStyle(el,attr);if(this.patterns.transparent.test(val)){var parent=el.parentNode;val=Y.Dom.getStyle(parent,attr);while(parent&&this.patterns.transparent.test(val)){parent=parent.parentNode;val=Y.Dom.getStyle(parent,attr);if(parent.tagName.toUpperCase()=='HTML'){val='#fff';}}}}else{val=superclass.getAttribute.call(this,attr);}
return val;};proto.doMethod=function(attr,start,end){var val;if(this.patterns.color.test(attr)){val=[];for(var i=0,len=start.length;i<len;++i){val[i]=superclass.doMethod.call(this,attr,start[i],end[i]);}
val='rgb('+Math.floor(val[0])+','+Math.floor(val[1])+','+Math.floor(val[2])+')';}
else{val=superclass.doMethod.call(this,attr,start,end);}
return val;};proto.setRuntimeAttribute=function(attr){superclass.setRuntimeAttribute.call(this,attr);if(this.patterns.color.test(attr)){var attributes=this.attributes;var start=this.parseColor(this.runtimeAttributes[attr].start);var end=this.parseColor(this.runtimeAttributes[attr].end);if(typeof attributes[attr]['to']==='undefined'&&typeof attributes[attr]['by']!=='undefined'){end=this.parseColor(attributes[attr].by);for(var i=0,len=start.length;i<len;++i){end[i]=start[i]+end[i];}}
this.runtimeAttributes[attr].start=start;this.runtimeAttributes[attr].end=end;}};Y.ColorAnim=ColorAnim;})();YAHOO.util.Easing={easeNone:function(t,b,c,d){return c*t/d+b;},easeIn:function(t,b,c,d){return c*(t/=d)*t+b;},easeOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeBoth:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b;}
return-c/2*((--t)*(t-2)-1)+b;},easeInStrong:function(t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutStrong:function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeBothStrong:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t+b;}
return-c/2*((t-=2)*t*t*t-2)+b;},elasticIn:function(t,b,c,d,a,p){if(t==0){return b;}
if((t/=d)==1){return b+c;}
if(!p){p=d*.3;}
if(!a||a<Math.abs(c)){a=c;var s=p/4;}
else{var s=p/(2*Math.PI)*Math.asin(c/a);}
return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},elasticOut:function(t,b,c,d,a,p){if(t==0){return b;}
if((t/=d)==1){return b+c;}
if(!p){p=d*.3;}
if(!a||a<Math.abs(c)){a=c;var s=p/4;}
else{var s=p/(2*Math.PI)*Math.asin(c/a);}
return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},elasticBoth:function(t,b,c,d,a,p){if(t==0){return b;}
if((t/=d/2)==2){return b+c;}
if(!p){p=d*(.3*1.5);}
if(!a||a<Math.abs(c)){a=c;var s=p/4;}
else{var s=p/(2*Math.PI)*Math.asin(c/a);}
if(t<1){return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;}
return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},backIn:function(t,b,c,d,s){if(typeof s=='undefined'){s=1.70158;}
return c*(t/=d)*t*((s+1)*t-s)+b;},backOut:function(t,b,c,d,s){if(typeof s=='undefined'){s=1.70158;}
return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},backBoth:function(t,b,c,d,s){if(typeof s=='undefined'){s=1.70158;}
if((t/=d/2)<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;}
return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},bounceIn:function(t,b,c,d){return c-YAHOO.util.Easing.bounceOut(d-t,0,c,d)+b;},bounceOut:function(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}
return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;},bounceBoth:function(t,b,c,d){if(t<d/2){return YAHOO.util.Easing.bounceIn(t*2,0,c,d)*.5+b;}
return YAHOO.util.Easing.bounceOut(t*2-d,0,c,d)*.5+c*.5+b;}};(function(){var Motion=function(el,attributes,duration,method){if(el){Motion.superclass.constructor.call(this,el,attributes,duration,method);}};Motion.NAME='Motion';var Y=YAHOO.util;YAHOO.extend(Motion,Y.ColorAnim);var superclass=Motion.superclass;var proto=Motion.prototype;proto.patterns.points=/^points$/i;proto.setAttribute=function(attr,val,unit){if(this.patterns.points.test(attr)){unit=unit||'px';superclass.setAttribute.call(this,'left',val[0],unit);superclass.setAttribute.call(this,'top',val[1],unit);}else{superclass.setAttribute.call(this,attr,val,unit);}};proto.getAttribute=function(attr){if(this.patterns.points.test(attr)){var val=[superclass.getAttribute.call(this,'left'),superclass.getAttribute.call(this,'top')];}else{val=superclass.getAttribute.call(this,attr);}
return val;};proto.doMethod=function(attr,start,end){var val=null;if(this.patterns.points.test(attr)){var t=this.method(this.currentFrame,0,100,this.totalFrames)/100;val=Y.Bezier.getPosition(this.runtimeAttributes[attr],t);}else{val=superclass.doMethod.call(this,attr,start,end);}
return val;};proto.setRuntimeAttribute=function(attr){if(this.patterns.points.test(attr)){var el=this.getEl();var attributes=this.attributes;var start;var control=attributes['points']['control']||[];var end;var i,len;if(control.length>0&&!(control[0]instanceof Array)){control=[control];}else{var tmp=[];for(i=0,len=control.length;i<len;++i){tmp[i]=control[i];}
control=tmp;}
if(Y.Dom.getStyle(el,'position')=='static'){Y.Dom.setStyle(el,'position','relative');}
if(isset(attributes['points']['from'])){Y.Dom.setXY(el,attributes['points']['from']);}
else{Y.Dom.setXY(el,Y.Dom.getXY(el));}
start=this.getAttribute('points');if(isset(attributes['points']['to'])){end=translateValues.call(this,attributes['points']['to'],start);var pageXY=Y.Dom.getXY(this.getEl());for(i=0,len=control.length;i<len;++i){control[i]=translateValues.call(this,control[i],start);}}else if(isset(attributes['points']['by'])){end=[start[0]+attributes['points']['by'][0],start[1]+attributes['points']['by'][1]];for(i=0,len=control.length;i<len;++i){control[i]=[start[0]+control[i][0],start[1]+control[i][1]];}}
this.runtimeAttributes[attr]=[start];if(control.length>0){this.runtimeAttributes[attr]=this.runtimeAttributes[attr].concat(control);}
this.runtimeAttributes[attr][this.runtimeAttributes[attr].length]=end;}
else{superclass.setRuntimeAttribute.call(this,attr);}};var translateValues=function(val,start){var pageXY=Y.Dom.getXY(this.getEl());val=[val[0]-pageXY[0]+start[0],val[1]-pageXY[1]+start[1]];return val;};var isset=function(prop){return(typeof prop!=='undefined');};Y.Motion=Motion;})();(function(){var Scroll=function(el,attributes,duration,method){if(el){Scroll.superclass.constructor.call(this,el,attributes,duration,method);}};Scroll.NAME='Scroll';var Y=YAHOO.util;YAHOO.extend(Scroll,Y.ColorAnim);var superclass=Scroll.superclass;var proto=Scroll.prototype;proto.doMethod=function(attr,start,end){var val=null;if(attr=='scroll'){val=[this.method(this.currentFrame,start[0],end[0]-start[0],this.totalFrames),this.method(this.currentFrame,start[1],end[1]-start[1],this.totalFrames)];}else{val=superclass.doMethod.call(this,attr,start,end);}
return val;};proto.getAttribute=function(attr){var val=null;var el=this.getEl();if(attr=='scroll'){val=[el.scrollLeft,el.scrollTop];}else{val=superclass.getAttribute.call(this,attr);}
return val;};proto.setAttribute=function(attr,val,unit){var el=this.getEl();if(attr=='scroll'){el.scrollLeft=val[0];el.scrollTop=val[1];}else{superclass.setAttribute.call(this,attr,val,unit);}};Y.Scroll=Scroll;})();YAHOO.register("animation",YAHOO.util.Anim,{version:"2.5.2",build:"1076"});

YAHOO.widget.AutoComplete=function(elInput,elContainer,oDataSource,oConfigs){if(elInput&&elContainer&&oDataSource){if(oDataSource instanceof YAHOO.widget.DataSource){this.dataSource=oDataSource;}
else{return;}
if(YAHOO.util.Dom.inDocument(elInput)){if(YAHOO.lang.isString(elInput)){this._sName="instance"+YAHOO.widget.AutoComplete._nIndex+" "+elInput;this._elTextbox=document.getElementById(elInput);}
else{this._sName=(elInput.id)?"instance"+YAHOO.widget.AutoComplete._nIndex+" "+elInput.id:"instance"+YAHOO.widget.AutoComplete._nIndex;this._elTextbox=elInput;}
YAHOO.util.Dom.addClass(this._elTextbox,"yui-ac-input");}
else{return;}
if(YAHOO.util.Dom.inDocument(elContainer)){if(YAHOO.lang.isString(elContainer)){this._elContainer=document.getElementById(elContainer);}
else{this._elContainer=elContainer;}
if(this._elContainer.style.display=="none"){}
var elParent=this._elContainer.parentNode;var elTag=elParent.tagName.toLowerCase();if(elTag=="div"){YAHOO.util.Dom.addClass(elParent,"yui-ac");}
else{}}
else{return;}
if(oConfigs&&(oConfigs.constructor==Object)){for(var sConfig in oConfigs){if(sConfig){this[sConfig]=oConfigs[sConfig];}}}
this._initContainer();this._initProps();this._initList();this._initContainerHelpers();var oSelf=this;var elTextbox=this._elTextbox;var elContent=this._elContent;YAHOO.util.Event.addListener(elTextbox,"keyup",oSelf._onTextboxKeyUp,oSelf);YAHOO.util.Event.addListener(elTextbox,"keydown",oSelf._onTextboxKeyDown,oSelf);YAHOO.util.Event.addListener(elTextbox,"focus",oSelf._onTextboxFocus,oSelf);YAHOO.util.Event.addListener(elTextbox,"blur",oSelf._onTextboxBlur,oSelf);YAHOO.util.Event.addListener(elContent,"mouseover",oSelf._onContainerMouseover,oSelf);YAHOO.util.Event.addListener(elContent,"mouseout",oSelf._onContainerMouseout,oSelf);YAHOO.util.Event.addListener(elContent,"scroll",oSelf._onContainerScroll,oSelf);YAHOO.util.Event.addListener(elContent,"resize",oSelf._onContainerResize,oSelf);YAHOO.util.Event.addListener(elTextbox,"keypress",oSelf._onTextboxKeyPress,oSelf);YAHOO.util.Event.addListener(window,"unload",oSelf._onWindowUnload,oSelf);this.textboxFocusEvent=new YAHOO.util.CustomEvent("textboxFocus",this);this.textboxKeyEvent=new YAHOO.util.CustomEvent("textboxKey",this);this.dataRequestEvent=new YAHOO.util.CustomEvent("dataRequest",this);this.dataReturnEvent=new YAHOO.util.CustomEvent("dataReturn",this);this.dataErrorEvent=new YAHOO.util.CustomEvent("dataError",this);this.containerExpandEvent=new YAHOO.util.CustomEvent("containerExpand",this);this.typeAheadEvent=new YAHOO.util.CustomEvent("typeAhead",this);this.itemMouseOverEvent=new YAHOO.util.CustomEvent("itemMouseOver",this);this.itemMouseOutEvent=new YAHOO.util.CustomEvent("itemMouseOut",this);this.itemArrowToEvent=new YAHOO.util.CustomEvent("itemArrowTo",this);this.itemArrowFromEvent=new YAHOO.util.CustomEvent("itemArrowFrom",this);this.itemSelectEvent=new YAHOO.util.CustomEvent("itemSelect",this);this.unmatchedItemSelectEvent=new YAHOO.util.CustomEvent("unmatchedItemSelect",this);this.selectionEnforceEvent=new YAHOO.util.CustomEvent("selectionEnforce",this);this.containerCollapseEvent=new YAHOO.util.CustomEvent("containerCollapse",this);this.textboxBlurEvent=new YAHOO.util.CustomEvent("textboxBlur",this);elTextbox.setAttribute("autocomplete","off");YAHOO.widget.AutoComplete._nIndex++;}
else{}};YAHOO.widget.AutoComplete.prototype.dataSource=null;YAHOO.widget.AutoComplete.prototype.minQueryLength=1;YAHOO.widget.AutoComplete.prototype.maxResultsDisplayed=10;YAHOO.widget.AutoComplete.prototype.queryDelay=0.2;YAHOO.widget.AutoComplete.prototype.highlightClassName="yui-ac-highlight";YAHOO.widget.AutoComplete.prototype.prehighlightClassName=null;YAHOO.widget.AutoComplete.prototype.delimChar=null;YAHOO.widget.AutoComplete.prototype.autoHighlight=true;YAHOO.widget.AutoComplete.prototype.typeAhead=false;YAHOO.widget.AutoComplete.prototype.animHoriz=false;YAHOO.widget.AutoComplete.prototype.animVert=true;YAHOO.widget.AutoComplete.prototype.animSpeed=0.3;YAHOO.widget.AutoComplete.prototype.forceSelection=false;YAHOO.widget.AutoComplete.prototype.allowBrowserAutocomplete=true;YAHOO.widget.AutoComplete.prototype.alwaysShowContainer=false;YAHOO.widget.AutoComplete.prototype.useIFrame=false;YAHOO.widget.AutoComplete.prototype.useShadow=false;YAHOO.widget.AutoComplete.prototype.toString=function(){return"AutoComplete "+this._sName;};YAHOO.widget.AutoComplete.prototype.isContainerOpen=function(){return this._bContainerOpen;};YAHOO.widget.AutoComplete.prototype.getListItems=function(){return this._aListItems;};YAHOO.widget.AutoComplete.prototype.getListItemData=function(oListItem){if(oListItem._oResultData){return oListItem._oResultData;}
else{return false;}};YAHOO.widget.AutoComplete.prototype.setHeader=function(sHeader){if(this._elHeader){var elHeader=this._elHeader;if(sHeader){elHeader.innerHTML=sHeader;elHeader.style.display="block";}
else{elHeader.innerHTML="";elHeader.style.display="none";}}};YAHOO.widget.AutoComplete.prototype.setFooter=function(sFooter){if(this._elFooter){var elFooter=this._elFooter;if(sFooter){elFooter.innerHTML=sFooter;elFooter.style.display="block";}
else{elFooter.innerHTML="";elFooter.style.display="none";}}};YAHOO.widget.AutoComplete.prototype.setBody=function(sBody){if(this._elBody){var elBody=this._elBody;if(sBody){elBody.innerHTML=sBody;elBody.style.display="block";elBody.style.display="block";}
else{elBody.innerHTML="";elBody.style.display="none";}
this._maxResultsDisplayed=0;}};YAHOO.widget.AutoComplete.prototype.formatResult=function(oResultItem,sQuery){var sResult=oResultItem[0];if(sResult){return sResult;}
else{return"";}};YAHOO.widget.AutoComplete.prototype.doBeforeExpandContainer=function(elTextbox,elContainer,sQuery,aResults){return true;};YAHOO.widget.AutoComplete.prototype.sendQuery=function(sQuery){this._sendQuery(sQuery);};YAHOO.widget.AutoComplete.prototype.doBeforeSendQuery=function(sQuery){return sQuery;};YAHOO.widget.AutoComplete.prototype.destroy=function(){var instanceName=this.toString();var elInput=this._elTextbox;var elContainer=this._elContainer;this.textboxFocusEvent.unsubscribeAll();this.textboxKeyEvent.unsubscribeAll();this.dataRequestEvent.unsubscribeAll();this.dataReturnEvent.unsubscribeAll();this.dataErrorEvent.unsubscribeAll();this.containerExpandEvent.unsubscribeAll();this.typeAheadEvent.unsubscribeAll();this.itemMouseOverEvent.unsubscribeAll();this.itemMouseOutEvent.unsubscribeAll();this.itemArrowToEvent.unsubscribeAll();this.itemArrowFromEvent.unsubscribeAll();this.itemSelectEvent.unsubscribeAll();this.unmatchedItemSelectEvent.unsubscribeAll();this.selectionEnforceEvent.unsubscribeAll();this.containerCollapseEvent.unsubscribeAll();this.textboxBlurEvent.unsubscribeAll();YAHOO.util.Event.purgeElement(elInput,true);YAHOO.util.Event.purgeElement(elContainer,true);elContainer.innerHTML="";for(var key in this){if(YAHOO.lang.hasOwnProperty(this,key)){this[key]=null;}}};YAHOO.widget.AutoComplete.prototype.textboxFocusEvent=null;YAHOO.widget.AutoComplete.prototype.textboxKeyEvent=null;YAHOO.widget.AutoComplete.prototype.dataRequestEvent=null;YAHOO.widget.AutoComplete.prototype.dataReturnEvent=null;YAHOO.widget.AutoComplete.prototype.dataErrorEvent=null;YAHOO.widget.AutoComplete.prototype.containerExpandEvent=null;YAHOO.widget.AutoComplete.prototype.typeAheadEvent=null;YAHOO.widget.AutoComplete.prototype.itemMouseOverEvent=null;YAHOO.widget.AutoComplete.prototype.itemMouseOutEvent=null;YAHOO.widget.AutoComplete.prototype.itemArrowToEvent=null;YAHOO.widget.AutoComplete.prototype.itemArrowFromEvent=null;YAHOO.widget.AutoComplete.prototype.itemSelectEvent=null;YAHOO.widget.AutoComplete.prototype.unmatchedItemSelectEvent=null;YAHOO.widget.AutoComplete.prototype.selectionEnforceEvent=null;YAHOO.widget.AutoComplete.prototype.containerCollapseEvent=null;YAHOO.widget.AutoComplete.prototype.textboxBlurEvent=null;YAHOO.widget.AutoComplete._nIndex=0;YAHOO.widget.AutoComplete.prototype._sName=null;YAHOO.widget.AutoComplete.prototype._elTextbox=null;YAHOO.widget.AutoComplete.prototype._elContainer=null;YAHOO.widget.AutoComplete.prototype._elContent=null;YAHOO.widget.AutoComplete.prototype._elHeader=null;YAHOO.widget.AutoComplete.prototype._elBody=null;YAHOO.widget.AutoComplete.prototype._elFooter=null;YAHOO.widget.AutoComplete.prototype._elShadow=null;YAHOO.widget.AutoComplete.prototype._elIFrame=null;YAHOO.widget.AutoComplete.prototype._bFocused=true;YAHOO.widget.AutoComplete.prototype._oAnim=null;YAHOO.widget.AutoComplete.prototype._bContainerOpen=false;YAHOO.widget.AutoComplete.prototype._bOverContainer=false;YAHOO.widget.AutoComplete.prototype._aListItems=null;YAHOO.widget.AutoComplete.prototype._nDisplayedItems=0;YAHOO.widget.AutoComplete.prototype._maxResultsDisplayed=0;YAHOO.widget.AutoComplete.prototype._sCurQuery=null;YAHOO.widget.AutoComplete.prototype._sSavedQuery=null;YAHOO.widget.AutoComplete.prototype._oCurItem=null;YAHOO.widget.AutoComplete.prototype._bItemSelected=false;YAHOO.widget.AutoComplete.prototype._nKeyCode=null;YAHOO.widget.AutoComplete.prototype._nDelayID=-1;YAHOO.widget.AutoComplete.prototype._iFrameSrc="javascript:false;";YAHOO.widget.AutoComplete.prototype._queryInterval=null;YAHOO.widget.AutoComplete.prototype._sLastTextboxValue=null;YAHOO.widget.AutoComplete.prototype._initProps=function(){var minQueryLength=this.minQueryLength;if(!YAHOO.lang.isNumber(minQueryLength)){this.minQueryLength=1;}
var maxResultsDisplayed=this.maxResultsDisplayed;if(!YAHOO.lang.isNumber(maxResultsDisplayed)||(maxResultsDisplayed<1)){this.maxResultsDisplayed=10;}
var queryDelay=this.queryDelay;if(!YAHOO.lang.isNumber(queryDelay)||(queryDelay<0)){this.queryDelay=0.2;}
var delimChar=this.delimChar;if(YAHOO.lang.isString(delimChar)&&(delimChar.length>0)){this.delimChar=[delimChar];}
else if(!YAHOO.lang.isArray(delimChar)){this.delimChar=null;}
var animSpeed=this.animSpeed;if((this.animHoriz||this.animVert)&&YAHOO.util.Anim){if(!YAHOO.lang.isNumber(animSpeed)||(animSpeed<0)){this.animSpeed=0.3;}
if(!this._oAnim){this._oAnim=new YAHOO.util.Anim(this._elContent,{},this.animSpeed);}
else{this._oAnim.duration=this.animSpeed;}}
if(this.forceSelection&&delimChar){}};YAHOO.widget.AutoComplete.prototype._initContainerHelpers=function(){if(this.useShadow&&!this._elShadow){var elShadow=document.createElement("div");elShadow.className="yui-ac-shadow";this._elShadow=this._elContainer.appendChild(elShadow);}
if(this.useIFrame&&!this._elIFrame){var elIFrame=document.createElement("iframe");elIFrame.src=this._iFrameSrc;elIFrame.frameBorder=0;elIFrame.scrolling="no";elIFrame.style.position="absolute";elIFrame.style.width="100%";elIFrame.style.height="100%";elIFrame.tabIndex=-1;this._elIFrame=this._elContainer.appendChild(elIFrame);}};YAHOO.widget.AutoComplete.prototype._initContainer=function(){YAHOO.util.Dom.addClass(this._elContainer,"yui-ac-container");if(!this._elContent){var elContent=document.createElement("div");elContent.className="yui-ac-content";elContent.style.display="none";this._elContent=this._elContainer.appendChild(elContent);var elHeader=document.createElement("div");elHeader.className="yui-ac-hd";elHeader.style.display="none";this._elHeader=this._elContent.appendChild(elHeader);var elBody=document.createElement("div");elBody.className="yui-ac-bd";this._elBody=this._elContent.appendChild(elBody);var elFooter=document.createElement("div");elFooter.className="yui-ac-ft";elFooter.style.display="none";this._elFooter=this._elContent.appendChild(elFooter);}
else{}};YAHOO.widget.AutoComplete.prototype._initList=function(){this._aListItems=[];while(this._elBody.hasChildNodes()){var oldListItems=this.getListItems();
if(oldListItems){for(var oldi=oldListItems.length-1;
oldi>=0;
oldi--){
oldListItems[oldi]=null;}}
this._elBody.innerHTML="";}
var oList=document.createElement("ul");
oList=this._elBody.appendChild(oList);

for(var i=0;i<this.maxResultsDisplayed;i++){
  var oItem=document.createElement("li");
  oItem=oList.appendChild(oItem);
  this._aListItems[i]=oItem;
  this._initListItem(oItem,i);
}
this._maxResultsDisplayed=this.maxResultsDisplayed;};YAHOO.widget.AutoComplete.prototype._initListItem=function(oItem,nItemIndex){
var oSelf=this;
oItem.style.display="none";
oItem._nItemIndex=nItemIndex;
oItem.mouseover=oItem.mouseout=oItem.onclick=null;
YAHOO.util.Event.addListener(oItem,"mouseover",oSelf._onItemMouseover,oSelf);
YAHOO.util.Event.addListener(oItem,"mouseout",oSelf._onItemMouseout,oSelf);
YAHOO.util.Event.addListener(oItem,"click",oSelf._onItemMouseclick,oSelf);};
YAHOO.widget.AutoComplete.prototype._onIMEDetected=function(oSelf){oSelf._enableIntervalDetection();};YAHOO.widget.AutoComplete.prototype._enableIntervalDetection=function(){var currValue=this._elTextbox.value;var lastValue=this._sLastTextboxValue;if(currValue!=lastValue){this._sLastTextboxValue=currValue;this._sendQuery(currValue);}};YAHOO.widget.AutoComplete.prototype._cancelIntervalDetection=function(oSelf){if(oSelf._queryInterval){clearInterval(oSelf._queryInterval);}};YAHOO.widget.AutoComplete.prototype._isIgnoreKey=function(nKeyCode){if((nKeyCode==9)||(nKeyCode==13)||(nKeyCode==16)||(nKeyCode==17)||(nKeyCode>=18&&nKeyCode<=20)||(nKeyCode==27)||(nKeyCode>=33&&nKeyCode<=35)||(nKeyCode>=36&&nKeyCode<=40)||(nKeyCode>=44&&nKeyCode<=45)){return true;}
return false;};YAHOO.widget.AutoComplete.prototype._sendQuery=function(sQuery){if(this.minQueryLength==-1){this._toggleContainer(false);return;}
var aDelimChar=(this.delimChar)?this.delimChar:null;if(aDelimChar){var nDelimIndex=-1;for(var i=aDelimChar.length-1;i>=0;i--){var nNewIndex=sQuery.lastIndexOf(aDelimChar[i]);if(nNewIndex>nDelimIndex){nDelimIndex=nNewIndex;}}
if(aDelimChar[i]==" "){for(var j=aDelimChar.length-1;j>=0;j--){if(sQuery[nDelimIndex-1]==aDelimChar[j]){nDelimIndex--;break;}}}
if(nDelimIndex>-1){var nQueryStart=nDelimIndex+1;while(sQuery.charAt(nQueryStart)==" "){nQueryStart+=1;}
this._sSavedQuery=sQuery.substring(0,nQueryStart);sQuery=sQuery.substr(nQueryStart);}
else if(sQuery.indexOf(this._sSavedQuery)<0){this._sSavedQuery=null;}}
if((sQuery&&(sQuery.length<this.minQueryLength))||(!sQuery&&this.minQueryLength>0)){if(this._nDelayID!=-1){clearTimeout(this._nDelayID);}
this._toggleContainer(false);return;}
sQuery=encodeURIComponent(sQuery);this._nDelayID=-1;sQuery=this.doBeforeSendQuery(sQuery);this.dataRequestEvent.fire(this,sQuery);this.dataSource.getResults(this._populateList,sQuery,this);};YAHOO.widget.AutoComplete.prototype._populateList=function(sQuery,aResults,oSelf){if(aResults===null){oSelf.dataErrorEvent.fire(oSelf,sQuery);}
if(!oSelf._bFocused||!aResults){return;}
var isOpera=(navigator.userAgent.toLowerCase().indexOf("opera")!=-1);var contentStyle=oSelf._elContent.style;contentStyle.width=(!isOpera)?null:"";contentStyle.height=(!isOpera)?null:"";var sCurQuery=decodeURIComponent(sQuery);oSelf._sCurQuery=sCurQuery;oSelf._bItemSelected=false;if(oSelf._maxResultsDisplayed!=oSelf.maxResultsDisplayed){oSelf._initList();}
var nItems=Math.min(aResults.length,oSelf.maxResultsDisplayed);oSelf._nDisplayedItems=nItems;if(nItems>0){oSelf._initContainerHelpers();var aItems=oSelf._aListItems;for(var i=nItems-1;i>=0;i--){var oItemi=aItems[i];var oResultItemi=aResults[i];oItemi.innerHTML=oSelf.formatResult(oResultItemi,sCurQuery);oItemi.style.display="list-item";
oItemi._sResultKey=oResultItemi[0];oItemi._oResultData=oResultItemi;}
for(var j=aItems.length-1;j>=nItems;j--){
var oItemj=aItems[j];
oItemj.innerHTML=null;
oItemj.style.display="none";
oItemj._sResultKey=null;
oItemj._oResultData=null;}
var ok=oSelf.doBeforeExpandContainer(oSelf._elTextbox,oSelf._elContainer,sQuery,aResults);oSelf._toggleContainer(ok);if(oSelf.autoHighlight){var oFirstItem=aItems[0];oSelf._toggleHighlight(oFirstItem,"to");oSelf.itemArrowToEvent.fire(oSelf,oFirstItem);oSelf._typeAhead(oFirstItem,sQuery);}
else{oSelf._oCurItem=null;}}
else{oSelf._toggleContainer(false);}
oSelf.dataReturnEvent.fire(oSelf,sQuery,aResults);};YAHOO.widget.AutoComplete.prototype._clearSelection=function(){var sValue=this._elTextbox.value;var sChar=(this.delimChar)?this.delimChar[0]:null;var nIndex=(sChar)?sValue.lastIndexOf(sChar,sValue.length-2):-1;if(nIndex>-1){this._elTextbox.value=sValue.substring(0,nIndex);}
else{this._elTextbox.value="";}
this._sSavedQuery=this._elTextbox.value;this.selectionEnforceEvent.fire(this);};YAHOO.widget.AutoComplete.prototype._textMatchesOption=function(){var foundMatch=null;for(var i=this._nDisplayedItems-1;i>=0;i--){var oItem=this._aListItems[i];var sMatch=oItem._sResultKey.toLowerCase();if(sMatch==this._sCurQuery.toLowerCase()){foundMatch=oItem;break;}}
return(foundMatch);};YAHOO.widget.AutoComplete.prototype._typeAhead=function(oItem,sQuery){if(!this.typeAhead||(this._nKeyCode==8)){return;}
var elTextbox=this._elTextbox;var sValue=this._elTextbox.value;if(!elTextbox.setSelectionRange&&!elTextbox.createTextRange){return;}
var nStart=sValue.length;this._updateValue(oItem);var nEnd=elTextbox.value.length;this._selectText(elTextbox,nStart,nEnd);var sPrefill=elTextbox.value.substr(nStart,nEnd);this.typeAheadEvent.fire(this,sQuery,sPrefill);};YAHOO.widget.AutoComplete.prototype._selectText=function(elTextbox,nStart,nEnd){if(elTextbox.setSelectionRange){elTextbox.setSelectionRange(nStart,nEnd);}
else if(elTextbox.createTextRange){var oTextRange=elTextbox.createTextRange();oTextRange.moveStart("character",nStart);oTextRange.moveEnd("character",nEnd-elTextbox.value.length);oTextRange.select();}
else{elTextbox.select();}};YAHOO.widget.AutoComplete.prototype._toggleContainerHelpers=function(bShow){var bFireEvent=false;var width=this._elContent.offsetWidth+"px";var height=this._elContent.offsetHeight+"px";if(this.useIFrame&&this._elIFrame){bFireEvent=true;if(bShow){this._elIFrame.style.width=width;this._elIFrame.style.height=height;}
else{this._elIFrame.style.width=0;this._elIFrame.style.height=0;}}
if(this.useShadow&&this._elShadow){bFireEvent=true;if(bShow){this._elShadow.style.width=width;this._elShadow.style.height=height;}
else{this._elShadow.style.width=0;this._elShadow.style.height=0;}}};YAHOO.widget.AutoComplete.prototype._toggleContainer=function(bShow){var elContainer=this._elContainer;if(this.alwaysShowContainer&&this._bContainerOpen){return;}
if(!bShow){this._elContent.scrollTop=0;var aItems=this._aListItems;if(aItems&&(aItems.length>0)){for(var i=aItems.length-1;i>=0;i--){aItems[i].style.display="none";}}
if(this._oCurItem){this._toggleHighlight(this._oCurItem,"from");}
this._oCurItem=null;this._nDisplayedItems=0;this._sCurQuery=null;}
if(!bShow&&!this._bContainerOpen){this._elContent.style.display="none";return;}
var oAnim=this._oAnim;if(oAnim&&oAnim.getEl()&&(this.animHoriz||this.animVert)){if(!bShow){this._toggleContainerHelpers(bShow);}
if(oAnim.isAnimated()){oAnim.stop();}
var oClone=this._elContent.cloneNode(true);elContainer.appendChild(oClone);oClone.style.top="-9000px";oClone.style.display="block";var wExp=oClone.offsetWidth;var hExp=oClone.offsetHeight;var wColl=(this.animHoriz)?0:wExp;var hColl=(this.animVert)?0:hExp;oAnim.attributes=(bShow)?{width:{to:wExp},height:{to:hExp}}:{width:{to:wColl},height:{to:hColl}};if(bShow&&!this._bContainerOpen){this._elContent.style.width=wColl+"px";this._elContent.style.height=hColl+"px";}
else{this._elContent.style.width=wExp+"px";this._elContent.style.height=hExp+"px";}
elContainer.removeChild(oClone);oClone=null;var oSelf=this;var onAnimComplete=function(){oAnim.onComplete.unsubscribeAll();if(bShow){oSelf.containerExpandEvent.fire(oSelf);}
else{oSelf._elContent.style.display="none";oSelf.containerCollapseEvent.fire(oSelf);}
oSelf._toggleContainerHelpers(bShow);};this._elContent.style.display="block";oAnim.onComplete.subscribe(onAnimComplete);oAnim.animate();this._bContainerOpen=bShow;}
else{if(bShow){this._elContent.style.display="block";this.containerExpandEvent.fire(this);}
else{this._elContent.style.display="none";this.containerCollapseEvent.fire(this);}
this._toggleContainerHelpers(bShow);this._bContainerOpen=bShow;}};YAHOO.widget.AutoComplete.prototype._toggleHighlight=function(oNewItem,sType){var sHighlight=this.highlightClassName;if(this._oCurItem){YAHOO.util.Dom.removeClass(this._oCurItem,sHighlight);}
if((sType=="to")&&sHighlight){YAHOO.util.Dom.addClass(oNewItem,sHighlight);this._oCurItem=oNewItem;}};YAHOO.widget.AutoComplete.prototype._togglePrehighlight=function(oNewItem,sType){if(oNewItem==this._oCurItem){return;}
var sPrehighlight=this.prehighlightClassName;if((sType=="mouseover")&&sPrehighlight){YAHOO.util.Dom.addClass(oNewItem,sPrehighlight);}
else{YAHOO.util.Dom.removeClass(oNewItem,sPrehighlight);}};YAHOO.widget.AutoComplete.prototype._updateValue=function(oItem){var elTextbox=this._elTextbox;var sDelimChar=(this.delimChar)?(this.delimChar[0]||this.delimChar):null;var sSavedQuery=this._sSavedQuery;var sResultKey=oItem._sResultKey;elTextbox.focus();elTextbox.value="";if(sDelimChar){if(sSavedQuery){elTextbox.value=sSavedQuery;}
elTextbox.value+=sResultKey+sDelimChar;if(sDelimChar!=" "){elTextbox.value+=" ";}}
else{elTextbox.value=sResultKey;}
if(elTextbox.type=="textarea"){elTextbox.scrollTop=elTextbox.scrollHeight;}
var end=elTextbox.value.length;this._selectText(elTextbox,end,end);this._oCurItem=oItem;};YAHOO.widget.AutoComplete.prototype._selectItem=function(oItem){this._bItemSelected=true;this._updateValue(oItem);this._cancelIntervalDetection(this);this.itemSelectEvent.fire(this,oItem,oItem._oResultData);this._toggleContainer(false);};YAHOO.widget.AutoComplete.prototype._jumpSelection=function(){if(this._oCurItem){this._selectItem(this._oCurItem);}
else{this._toggleContainer(false);}};YAHOO.widget.AutoComplete.prototype._moveSelection=function(nKeyCode){if(this._bContainerOpen){var oCurItem=this._oCurItem;var nCurItemIndex=-1;if(oCurItem){nCurItemIndex=oCurItem._nItemIndex;}
var nNewItemIndex=(nKeyCode==40)?(nCurItemIndex+1):(nCurItemIndex-1);if(nNewItemIndex<-2||nNewItemIndex>=this._nDisplayedItems){return;}
if(oCurItem){this._toggleHighlight(oCurItem,"from");this.itemArrowFromEvent.fire(this,oCurItem);}
if(nNewItemIndex==-1){if(this.delimChar&&this._sSavedQuery){if(!this._textMatchesOption()){this._elTextbox.value=this._sSavedQuery;}
else{this._elTextbox.value=this._sSavedQuery+this._sCurQuery;}}
else{this._elTextbox.value=this._sCurQuery;}
this._oCurItem=null;return;}
if(nNewItemIndex==-2){this._toggleContainer(false);return;}
var oNewItem=this._aListItems[nNewItemIndex];var elContent=this._elContent;var scrollOn=((YAHOO.util.Dom.getStyle(elContent,"overflow")=="auto")||(YAHOO.util.Dom.getStyle(elContent,"overflowY")=="auto"));if(scrollOn&&(nNewItemIndex>-1)&&(nNewItemIndex<this._nDisplayedItems)){if(nKeyCode==40){if((oNewItem.offsetTop+oNewItem.offsetHeight)>(elContent.scrollTop+elContent.offsetHeight)){elContent.scrollTop=(oNewItem.offsetTop+oNewItem.offsetHeight)-elContent.offsetHeight;}
else if((oNewItem.offsetTop+oNewItem.offsetHeight)<elContent.scrollTop){elContent.scrollTop=oNewItem.offsetTop;}}
else{if(oNewItem.offsetTop<elContent.scrollTop){this._elContent.scrollTop=oNewItem.offsetTop;}
else if(oNewItem.offsetTop>(elContent.scrollTop+elContent.offsetHeight)){this._elContent.scrollTop=(oNewItem.offsetTop+oNewItem.offsetHeight)-elContent.offsetHeight;}}}
this._toggleHighlight(oNewItem,"to");this.itemArrowToEvent.fire(this,oNewItem);if(this.typeAhead){this._updateValue(oNewItem);}}};YAHOO.widget.AutoComplete.prototype._onItemMouseover=function(v,oSelf){if(oSelf.prehighlightClassName){oSelf._togglePrehighlight(this,"mouseover");}
else{oSelf._toggleHighlight(this,"to");}
oSelf.itemMouseOverEvent.fire(oSelf,this);};YAHOO.widget.AutoComplete.prototype._onItemMouseout=function(v,oSelf){if(oSelf.prehighlightClassName){oSelf._togglePrehighlight(this,"mouseout");}
else{oSelf._toggleHighlight(this,"from");}
oSelf.itemMouseOutEvent.fire(oSelf,this);};YAHOO.widget.AutoComplete.prototype._onItemMouseclick=function(v,oSelf){oSelf._toggleHighlight(this,"to");oSelf._selectItem(this);};YAHOO.widget.AutoComplete.prototype._onContainerMouseover=function(v,oSelf){oSelf._bOverContainer=true;};YAHOO.widget.AutoComplete.prototype._onContainerMouseout=function(v,oSelf){oSelf._bOverContainer=false;if(oSelf._oCurItem){oSelf._toggleHighlight(oSelf._oCurItem,"to");}};YAHOO.widget.AutoComplete.prototype._onContainerScroll=function(v,oSelf){oSelf._elTextbox.focus();};YAHOO.widget.AutoComplete.prototype._onContainerResize=function(v,oSelf){oSelf._toggleContainerHelpers(oSelf._bContainerOpen);};YAHOO.widget.AutoComplete.prototype._onTextboxKeyDown=function(v,oSelf){var nKeyCode=v.keyCode;switch(nKeyCode){case 9:if((navigator.userAgent.toLowerCase().indexOf("mac")==-1)){if(oSelf._oCurItem){if(oSelf.delimChar&&(oSelf._nKeyCode!=nKeyCode)){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
oSelf._selectItem(oSelf._oCurItem);}
else{oSelf._toggleContainer(false);}}
break;case 13:if((navigator.userAgent.toLowerCase().indexOf("mac")==-1)){if(oSelf._oCurItem){if(oSelf._nKeyCode!=nKeyCode){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
oSelf._selectItem(oSelf._oCurItem);}
else{oSelf._toggleContainer(false);}}
break;case 27:oSelf._toggleContainer(false);return;case 39:oSelf._jumpSelection();break;case 38:YAHOO.util.Event.stopEvent(v);oSelf._moveSelection(nKeyCode);break;case 40:YAHOO.util.Event.stopEvent(v);oSelf._moveSelection(nKeyCode);break;default:break;}};YAHOO.widget.AutoComplete.prototype._onTextboxKeyPress=function(v,oSelf){var nKeyCode=v.keyCode;if((navigator.userAgent.toLowerCase().indexOf("mac")!=-1)){switch(nKeyCode){case 9:if(oSelf._oCurItem){if(oSelf.delimChar&&(oSelf._nKeyCode!=nKeyCode)){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
oSelf._selectItem(oSelf._oCurItem);}
else{oSelf._toggleContainer(false);}
break;case 13:if(oSelf._oCurItem){if(oSelf._nKeyCode!=nKeyCode){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
oSelf._selectItem(oSelf._oCurItem);}
else{oSelf._toggleContainer(false);}
break;default:break;}}
else if(nKeyCode==229){oSelf._queryInterval=setInterval(function(){oSelf._onIMEDetected(oSelf);},500);}};YAHOO.widget.AutoComplete.prototype._onTextboxKeyUp=function(v,oSelf){oSelf._initProps();var nKeyCode=v.keyCode;oSelf._nKeyCode=nKeyCode;var sText=this.value;if(oSelf._isIgnoreKey(nKeyCode)||(sText.toLowerCase()==oSelf._sCurQuery)){return;}
else{oSelf._bItemSelected=false;YAHOO.util.Dom.removeClass(oSelf._oCurItem,oSelf.highlightClassName);oSelf._oCurItem=null;oSelf.textboxKeyEvent.fire(oSelf,nKeyCode);}
if(oSelf.queryDelay>0){var nDelayID=setTimeout(function(){oSelf._sendQuery(sText);},(oSelf.queryDelay*1000));if(oSelf._nDelayID!=-1){clearTimeout(oSelf._nDelayID);}
oSelf._nDelayID=nDelayID;}
else{oSelf._sendQuery(sText);}};YAHOO.widget.AutoComplete.prototype._onTextboxFocus=function(v,oSelf){oSelf._elTextbox.setAttribute("autocomplete","off");oSelf._bFocused=true;if(!oSelf._bItemSelected){oSelf.textboxFocusEvent.fire(oSelf);}};YAHOO.widget.AutoComplete.prototype._onTextboxBlur=function(v,oSelf){if(!oSelf._bOverContainer||(oSelf._nKeyCode==9)){if(!oSelf._bItemSelected){var oMatch=oSelf._textMatchesOption();if(!oSelf._bContainerOpen||(oSelf._bContainerOpen&&(oMatch===null))){if(oSelf.forceSelection){oSelf._clearSelection();}
else{oSelf.unmatchedItemSelectEvent.fire(oSelf);}}
else{if(oSelf.forceSelection){oSelf._selectItem(oMatch);}}}
if(oSelf._bContainerOpen){oSelf._toggleContainer(false);}
oSelf._cancelIntervalDetection(oSelf);oSelf._bFocused=false;oSelf.textboxBlurEvent.fire(oSelf);}};YAHOO.widget.AutoComplete.prototype._onWindowUnload=function(v,oSelf){if(oSelf&&oSelf._elTextbox&&oSelf.allowBrowserAutocomplete){oSelf._elTextbox.setAttribute("autocomplete","on");}};YAHOO.widget.DataSource=function(){};YAHOO.widget.DataSource.ERROR_DATANULL="Response data was null";YAHOO.widget.DataSource.ERROR_DATAPARSE="Response data could not be parsed";YAHOO.widget.DataSource.prototype.maxCacheEntries=15;YAHOO.widget.DataSource.prototype.queryMatchContains=false;YAHOO.widget.DataSource.prototype.queryMatchSubset=false;YAHOO.widget.DataSource.prototype.queryMatchCase=false;YAHOO.widget.DataSource.prototype.toString=function(){return"DataSource "+this._sName;};YAHOO.widget.DataSource.prototype.getResults=function(oCallbackFn,sQuery,oParent){var aResults=this._doQueryCache(oCallbackFn,sQuery,oParent);if(aResults.length===0){this.queryEvent.fire(this,oParent,sQuery);this.doQuery(oCallbackFn,sQuery,oParent);}};YAHOO.widget.DataSource.prototype.doQuery=function(oCallbackFn,sQuery,oParent){};YAHOO.widget.DataSource.prototype.flushCache=function(){if(this._aCache){this._aCache=[];}
if(this._aCacheHelper){this._aCacheHelper=[];}
this.cacheFlushEvent.fire(this);};YAHOO.widget.DataSource.prototype.queryEvent=null;YAHOO.widget.DataSource.prototype.cacheQueryEvent=null;YAHOO.widget.DataSource.prototype.getResultsEvent=null;YAHOO.widget.DataSource.prototype.getCachedResultsEvent=null;YAHOO.widget.DataSource.prototype.dataErrorEvent=null;YAHOO.widget.DataSource.prototype.cacheFlushEvent=null;YAHOO.widget.DataSource._nIndex=0;YAHOO.widget.DataSource.prototype._sName=null;YAHOO.widget.DataSource.prototype._aCache=null;YAHOO.widget.DataSource.prototype._init=function(){var maxCacheEntries=this.maxCacheEntries;if(!YAHOO.lang.isNumber(maxCacheEntries)||(maxCacheEntries<0)){maxCacheEntries=0;}
if(maxCacheEntries>0&&!this._aCache){this._aCache=[];}
this._sName="instance"+YAHOO.widget.DataSource._nIndex;YAHOO.widget.DataSource._nIndex++;this.queryEvent=new YAHOO.util.CustomEvent("query",this);this.cacheQueryEvent=new YAHOO.util.CustomEvent("cacheQuery",this);this.getResultsEvent=new YAHOO.util.CustomEvent("getResults",this);this.getCachedResultsEvent=new YAHOO.util.CustomEvent("getCachedResults",this);this.dataErrorEvent=new YAHOO.util.CustomEvent("dataError",this);this.cacheFlushEvent=new YAHOO.util.CustomEvent("cacheFlush",this);};YAHOO.widget.DataSource.prototype._addCacheElem=function(oResult){var aCache=this._aCache;if(!aCache||!oResult||!oResult.query||!oResult.results){return;}
if(aCache.length>=this.maxCacheEntries){aCache.shift();}
aCache.push(oResult);};YAHOO.widget.DataSource.prototype._doQueryCache=function(oCallbackFn,sQuery,oParent){var aResults=[];var bMatchFound=false;var aCache=this._aCache;var nCacheLength=(aCache)?aCache.length:0;var bMatchContains=this.queryMatchContains;var sOrigQuery;if((this.maxCacheEntries>0)&&aCache&&(nCacheLength>0)){this.cacheQueryEvent.fire(this,oParent,sQuery);if(!this.queryMatchCase){sOrigQuery=sQuery;sQuery=sQuery.toLowerCase();}
for(var i=nCacheLength-1;i>=0;i--){var resultObj=aCache[i];var aAllResultItems=resultObj.results;var matchKey=(!this.queryMatchCase)?encodeURIComponent(resultObj.query).toLowerCase():encodeURIComponent(resultObj.query);if(matchKey==sQuery){bMatchFound=true;aResults=aAllResultItems;if(i!=nCacheLength-1){aCache.splice(i,1);this._addCacheElem(resultObj);}
break;}
else if(this.queryMatchSubset){for(var j=sQuery.length-1;j>=0;j--){var subQuery=sQuery.substr(0,j);if(matchKey==subQuery){bMatchFound=true;for(var k=aAllResultItems.length-1;k>=0;k--){var aRecord=aAllResultItems[k];var sKeyIndex=(this.queryMatchCase)?encodeURIComponent(aRecord[0]).indexOf(sQuery):encodeURIComponent(aRecord[0]).toLowerCase().indexOf(sQuery);if((!bMatchContains&&(sKeyIndex===0))||(bMatchContains&&(sKeyIndex>-1))){aResults.unshift(aRecord);}}
resultObj={};resultObj.query=sQuery;resultObj.results=aResults;this._addCacheElem(resultObj);break;}}
if(bMatchFound){break;}}}
if(bMatchFound){this.getCachedResultsEvent.fire(this,oParent,sOrigQuery,aResults);oCallbackFn(sOrigQuery,aResults,oParent);}}
return aResults;};YAHOO.widget.DS_XHR=function(sScriptURI,aSchema,oConfigs){if(oConfigs&&(oConfigs.constructor==Object)){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!YAHOO.lang.isArray(aSchema)||!YAHOO.lang.isString(sScriptURI)){return;}
this.schema=aSchema;this.scriptURI=sScriptURI;this._init();};YAHOO.widget.DS_XHR.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_XHR.TYPE_JSON=0;YAHOO.widget.DS_XHR.TYPE_XML=1;YAHOO.widget.DS_XHR.TYPE_FLAT=2;YAHOO.widget.DS_XHR.ERROR_DATAXHR="XHR response failed";YAHOO.widget.DS_XHR.prototype.connMgr=YAHOO.util.Connect;YAHOO.widget.DS_XHR.prototype.connTimeout=0;YAHOO.widget.DS_XHR.prototype.scriptURI=null;YAHOO.widget.DS_XHR.prototype.scriptQueryParam="query";YAHOO.widget.DS_XHR.prototype.scriptQueryAppend="";YAHOO.widget.DS_XHR.prototype.responseType=YAHOO.widget.DS_XHR.TYPE_JSON;YAHOO.widget.DS_XHR.prototype.responseStripAfter="\n<!-";YAHOO.widget.DS_XHR.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var isXML=(this.responseType==YAHOO.widget.DS_XHR.TYPE_XML);var sUri=this.scriptURI+"?"+this.scriptQueryParam+"="+sQuery;if(this.scriptQueryAppend.length>0){sUri+="&"+this.scriptQueryAppend;}
var oResponse=null;var oSelf=this;var responseSuccess=function(oResp){if(!oSelf._oConn||(oResp.tId!=oSelf._oConn.tId)){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATANULL);return;}
for(var foo in oResp){}
if(!isXML){oResp=oResp.responseText;}
else{oResp=oResp.responseXML;}
if(oResp===null){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATANULL);return;}
var aResults=oSelf.parseResponse(sQuery,oResp,oParent);var resultObj={};resultObj.query=decodeURIComponent(sQuery);resultObj.results=aResults;if(aResults===null){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATAPARSE);aResults=[];}
else{oSelf.getResultsEvent.fire(oSelf,oParent,sQuery,aResults);oSelf._addCacheElem(resultObj);}
oCallbackFn(sQuery,aResults,oParent);};var responseFailure=function(oResp){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DS_XHR.ERROR_DATAXHR);return;};var oCallback={success:responseSuccess,failure:responseFailure};if(YAHOO.lang.isNumber(this.connTimeout)&&(this.connTimeout>0)){oCallback.timeout=this.connTimeout;}
if(this._oConn){this.connMgr.abort(this._oConn);}
oSelf._oConn=this.connMgr.asyncRequest("GET",sUri,oCallback,null);};YAHOO.widget.DS_XHR.prototype.parseResponse=function(sQuery,oResponse,oParent){var aSchema=this.schema;var aResults=[];var bError=false;var nEnd=((this.responseStripAfter!=="")&&(oResponse.indexOf))?oResponse.indexOf(this.responseStripAfter):-1;if(nEnd!=-1){oResponse=oResponse.substring(0,nEnd);}
switch(this.responseType){case YAHOO.widget.DS_XHR.TYPE_JSON:var jsonList,jsonObjParsed;
if(YAHOO.lang.JSON){
  jsonObjParsed=YAHOO.lang.JSON.parse(oResponse);
  if(!jsonObjParsed){bError=true;break;}
  else{
    try{jsonList=eval("jsonObjParsed."+aSchema[0]);}
    catch(e){bError=true;break;}
  }
}else if(oResponse.parseJSON){
  jsonObjParsed=oResponse.parseJSON();
  if(!jsonObjParsed){bError=true;}
  else{
    try{jsonList=eval("jsonObjParsed."+aSchema[0]);}
    catch(e){bError=true;break;}
    }
}
else if(window.JSON){
  jsonObjParsed=JSON.parse(oResponse);
  if(!jsonObjParsed){bError=true;break;}
  else{try{jsonList=eval("jsonObjParsed."+aSchema[0]);}
  catch(e){bError=true;break;}
  }
}
else{try{while(oResponse.substring(0,1)==" "){oResponse=oResponse.substring(1,oResponse.length);}
if(oResponse.indexOf("{")<0){bError=true;break;}
if(oResponse.indexOf("{}")===0){break;}
var jsonObjRaw=eval("("+oResponse+")");if(!jsonObjRaw){bError=true;break;}
jsonList=eval("(jsonObjRaw."+aSchema[0]+")");}
catch(e){bError=true;break;}}
if(!jsonList){bError=true;break;}
if(!YAHOO.lang.isArray(jsonList)){jsonList=[jsonList];}
for(var i=jsonList.length-1;i>=0;i--){var aResultItem=[];var jsonResult=jsonList[i];for(var j=aSchema.length-1;j>=1;j--){var dataFieldValue=jsonResult[aSchema[j]];if(!dataFieldValue){dataFieldValue="";}
aResultItem.unshift(dataFieldValue);}
if(aResultItem.length==1){aResultItem.push(jsonResult);}
aResults.unshift(aResultItem);}
break;case YAHOO.widget.DS_XHR.TYPE_XML:var xmlList=oResponse.getElementsByTagName(aSchema[0]);if(!xmlList){bError=true;break;}
for(var k=xmlList.length-1;k>=0;k--){var result=xmlList.item(k);var aFieldSet=[];for(var m=aSchema.length-1;m>=1;m--){var sValue=null;var xmlAttr=result.attributes.getNamedItem(aSchema[m]);if(xmlAttr){sValue=xmlAttr.value;}
else{var xmlNode=result.getElementsByTagName(aSchema[m]);if(xmlNode&&xmlNode.item(0)&&xmlNode.item(0).firstChild){sValue=xmlNode.item(0).firstChild.nodeValue;}
else{sValue="";}}
aFieldSet.unshift(sValue);}
aResults.unshift(aFieldSet);}
break;case YAHOO.widget.DS_XHR.TYPE_FLAT:if(oResponse.length>0){var newLength=oResponse.length-aSchema[0].length;if(oResponse.substr(newLength)==aSchema[0]){oResponse=oResponse.substr(0,newLength);}
if(oResponse.length>0){var aRecords=oResponse.split(aSchema[0]);for(var n=aRecords.length-1;n>=0;n--){if(aRecords[n].length>0){aResults[n]=aRecords[n].split(aSchema[1]);}}}}
break;default:break;}
sQuery=null;oResponse=null;oParent=null;if(bError){return null;}
else{return aResults;}};YAHOO.widget.DS_XHR.prototype._oConn=null;YAHOO.widget.DS_ScriptNode=function(sUri,aSchema,oConfigs){if(oConfigs&&(oConfigs.constructor==Object)){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!YAHOO.lang.isArray(aSchema)||!YAHOO.lang.isString(sUri)){return;}
this.schema=aSchema;this.scriptURI=sUri;this._init();};YAHOO.widget.DS_ScriptNode.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_ScriptNode.prototype.getUtility=YAHOO.util.Get;YAHOO.widget.DS_ScriptNode.prototype.scriptURI=null;YAHOO.widget.DS_ScriptNode.prototype.scriptQueryParam="query";YAHOO.widget.DS_ScriptNode.prototype.asyncMode="allowAll";YAHOO.widget.DS_ScriptNode.prototype.scriptCallbackParam="callback";YAHOO.widget.DS_ScriptNode.callbacks=[];YAHOO.widget.DS_ScriptNode._nId=0;YAHOO.widget.DS_ScriptNode._nPending=0;YAHOO.widget.DS_ScriptNode.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var oSelf=this;if(YAHOO.widget.DS_ScriptNode._nPending===0){YAHOO.widget.DS_ScriptNode.callbacks=[];YAHOO.widget.DS_ScriptNode._nId=0;}
var id=YAHOO.widget.DS_ScriptNode._nId;YAHOO.widget.DS_ScriptNode._nId++;YAHOO.widget.DS_ScriptNode.callbacks[id]=function(oResponse){if((oSelf.asyncMode!=="ignoreStaleResponses")||(id===YAHOO.widget.DS_ScriptNode.callbacks.length-1)){oSelf.handleResponse(oResponse,oCallbackFn,sQuery,oParent);}
else{}
delete YAHOO.widget.DS_ScriptNode.callbacks[id];};YAHOO.widget.DS_ScriptNode._nPending++;var sUri=this.scriptURI+"&"+this.scriptQueryParam+"="+sQuery+"&"+
this.scriptCallbackParam+"=YAHOO.widget.DS_ScriptNode.callbacks["+id+"]";this.getUtility.script(sUri,{autopurge:true,onsuccess:YAHOO.widget.DS_ScriptNode._bumpPendingDown,onfail:YAHOO.widget.DS_ScriptNode._bumpPendingDown});};YAHOO.widget.DS_ScriptNode.prototype.handleResponse=function(oResponse,oCallbackFn,sQuery,oParent){var aSchema=this.schema;var aResults=[];var bError=false;var jsonList,jsonObjParsed;try{jsonList=eval("(oResponse."+aSchema[0]+")");}
catch(e){bError=true;}
if(!jsonList){bError=true;jsonList=[];}
else if(!YAHOO.lang.isArray(jsonList)){jsonList=[jsonList];}
for(var i=jsonList.length-1;i>=0;i--){var aResultItem=[];var jsonResult=jsonList[i];for(var j=aSchema.length-1;j>=1;j--){var dataFieldValue=jsonResult[aSchema[j]];if(!dataFieldValue){dataFieldValue="";}
aResultItem.unshift(dataFieldValue);}
if(aResultItem.length==1){aResultItem.push(jsonResult);}
aResults.unshift(aResultItem);}
if(bError){aResults=null;}
if(aResults===null){this.dataErrorEvent.fire(this,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATAPARSE);aResults=[];}
else{var resultObj={};resultObj.query=decodeURIComponent(sQuery);resultObj.results=aResults;this._addCacheElem(resultObj);this.getResultsEvent.fire(this,oParent,sQuery,aResults);}
oCallbackFn(sQuery,aResults,oParent);};YAHOO.widget.DS_ScriptNode._bumpPendingDown=function(){YAHOO.widget.DS_ScriptNode._nPending--;};YAHOO.widget.DS_JSFunction=function(oFunction,oConfigs){if(oConfigs&&(oConfigs.constructor==Object)){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!YAHOO.lang.isFunction(oFunction)){return;}
else{this.dataFunction=oFunction;this._init();}};YAHOO.widget.DS_JSFunction.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_JSFunction.prototype.dataFunction=null;YAHOO.widget.DS_JSFunction.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var oFunction=this.dataFunction;var aResults=[];aResults=oFunction(sQuery);if(aResults===null){this.dataErrorEvent.fire(this,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATANULL);return;}
var resultObj={};resultObj.query=decodeURIComponent(sQuery);resultObj.results=aResults;this._addCacheElem(resultObj);this.getResultsEvent.fire(this,oParent,sQuery,aResults);oCallbackFn(sQuery,aResults,oParent);return;};YAHOO.widget.DS_JSArray=function(aData,oConfigs){if(oConfigs&&(oConfigs.constructor==Object)){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!YAHOO.lang.isArray(aData)){return;}
else{this.data=aData;this._init();}};YAHOO.widget.DS_JSArray.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_JSArray.prototype.data=null;YAHOO.widget.DS_JSArray.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var i;var aData=this.data;var aResults=[];var bMatchFound=false;var bMatchContains=this.queryMatchContains;if(sQuery){if(!this.queryMatchCase){sQuery=sQuery.toLowerCase();}
for(i=aData.length-1;i>=0;i--){var aDataset=[];if(YAHOO.lang.isString(aData[i])){aDataset[0]=aData[i];}
else if(YAHOO.lang.isArray(aData[i])){aDataset=aData[i];}
if(YAHOO.lang.isString(aDataset[0])){var sKeyIndex=(this.queryMatchCase)?encodeURIComponent(aDataset[0]).indexOf(sQuery):encodeURIComponent(aDataset[0]).toLowerCase().indexOf(sQuery);if((!bMatchContains&&(sKeyIndex===0))||(bMatchContains&&(sKeyIndex>-1))){aResults.unshift(aDataset);}}}}
else{for(i=aData.length-1;i>=0;i--){if(YAHOO.lang.isString(aData[i])){aResults.unshift([aData[i]]);}
else if(YAHOO.lang.isArray(aData[i])){aResults.unshift(aData[i]);}}}
this.getResultsEvent.fire(this,oParent,sQuery,aResults);oCallbackFn(sQuery,aResults,oParent);};YAHOO.register("autocomplete",YAHOO.widget.AutoComplete,{version:"2.5.2",build:"1076"});

YAHOO.widget.MultiAutoComplete=function(elInput,elContainer,oDataSources,oConfigs){if(elInput&&elContainer&&oDataSources){if(oDataSources)
{for(var i=0;i<oDataSources.length;i++)
{if(!(oDataSources[i]instanceof YAHOO.widget.DataSource))
{return;}}
this.dataSources=oDataSources;}
else{return;}
if(YAHOO.util.Dom.inDocument(elInput)){if(typeof elInput=="string"){this._sName="instance"+YAHOO.widget.MultiAutoComplete._nIndex+" "+elInput;this._oTextbox=document.getElementById(elInput);}
else{this._sName=(elInput.id)?"instance"+YAHOO.widget.MultiAutoComplete._nIndex+" "+elInput.id:"instance"+YAHOO.widget.MultiAutoComplete._nIndex;this._oTextbox=elInput;}}
else{return;}
if(YAHOO.util.Dom.inDocument(elContainer)){if(typeof elContainer=="string"){this._oContainer=document.getElementById(elContainer);}
else{this._oContainer=elContainer;}
if(this._oContainer.style.display=="none"){}}
else{return;}
if(typeof oConfigs=="object"){for(var sConfig in oConfigs){if(sConfig){this[sConfig]=oConfigs[sConfig];}}}
this._initContainer();this._initProps();this._initList();this._initContainerHelpers();var oSelf=this;var oTextbox=this._oTextbox;var oContent=this._oContainer._oContent;YAHOO.util.Event.addListener(oTextbox,"keyup",oSelf._onTextboxKeyUp,oSelf);YAHOO.util.Event.addListener(oTextbox,"keydown",oSelf._onTextboxKeyDown,oSelf);YAHOO.util.Event.addListener(oTextbox,"focus",oSelf._onTextboxFocus,oSelf);YAHOO.util.Event.addListener(oTextbox,"blur",oSelf._onTextboxBlur,oSelf);YAHOO.util.Event.addListener(oContent,"mouseover",oSelf._onContainerMouseover,oSelf);YAHOO.util.Event.addListener(oContent,"mouseout",oSelf._onContainerMouseout,oSelf);YAHOO.util.Event.addListener(oContent,"scroll",oSelf._onContainerScroll,oSelf);YAHOO.util.Event.addListener(oContent,"resize",oSelf._onContainerResize,oSelf);if(oTextbox.form){YAHOO.util.Event.addListener(oTextbox.form,"submit",oSelf._onFormSubmit,oSelf);}
YAHOO.util.Event.addListener(oTextbox,"keypress",oSelf._onTextboxKeyPress,oSelf);this.textboxFocusEvent=new YAHOO.util.CustomEvent("textboxFocus",this);this.textboxKeyEvent=new YAHOO.util.CustomEvent("textboxKey",this);this.dataRequestEvent=new YAHOO.util.CustomEvent("dataRequest",this);this.dataReturnEvent=new YAHOO.util.CustomEvent("dataReturn",this);this.dataErrorEvent=new YAHOO.util.CustomEvent("dataError",this);this.containerExpandEvent=new YAHOO.util.CustomEvent("containerExpand",this);this.typeAheadEvent=new YAHOO.util.CustomEvent("typeAhead",this);this.itemMouseOverEvent=new YAHOO.util.CustomEvent("itemMouseOver",this);this.itemMouseOutEvent=new YAHOO.util.CustomEvent("itemMouseOut",this);this.itemArrowToEvent=new YAHOO.util.CustomEvent("itemArrowTo",this);this.itemArrowFromEvent=new YAHOO.util.CustomEvent("itemArrowFrom",this);this.itemSelectEvent=new YAHOO.util.CustomEvent("itemSelect",this);this.unmatchedItemSelectEvent=new YAHOO.util.CustomEvent("unmatchedItemSelect",this);this.selectionEnforceEvent=new YAHOO.util.CustomEvent("selectionEnforce",this);this.containerCollapseEvent=new YAHOO.util.CustomEvent("containerCollapse",this);this.textboxBlurEvent=new YAHOO.util.CustomEvent("textboxBlur",this);oTextbox.setAttribute("autocomplete","off");YAHOO.widget.MultiAutoComplete._nIndex++;}
else{}};YAHOO.widget.MultiAutoComplete.prototype.dataSources=null;YAHOO.widget.MultiAutoComplete.prototype.minQueryLength=1;YAHOO.widget.MultiAutoComplete.prototype.maxResultsDisplayed=10;YAHOO.widget.MultiAutoComplete.prototype.queryDelay=0.5;YAHOO.widget.MultiAutoComplete.prototype.highlightClassName="yui-ac-highlight";YAHOO.widget.MultiAutoComplete.prototype.prehighlightClassName=null;YAHOO.widget.MultiAutoComplete.prototype.delimChar=null;YAHOO.widget.MultiAutoComplete.prototype.autoHighlight=true;YAHOO.widget.MultiAutoComplete.prototype.typeAhead=false;YAHOO.widget.MultiAutoComplete.prototype.animHoriz=false;YAHOO.widget.MultiAutoComplete.prototype.animVert=true;YAHOO.widget.MultiAutoComplete.prototype.animSpeed=0.3;YAHOO.widget.MultiAutoComplete.prototype.forceSelection=false;YAHOO.widget.MultiAutoComplete.prototype.allowBrowserAutocomplete=true;YAHOO.widget.MultiAutoComplete.prototype.alwaysShowContainer=false;YAHOO.widget.MultiAutoComplete.prototype.useIFrame=false;YAHOO.widget.MultiAutoComplete.prototype.useShadow=false;YAHOO.widget.MultiAutoComplete.prototype.toString=function(){return"AutoComplete "+this._sName;};YAHOO.widget.MultiAutoComplete.prototype.isContainerOpen=function(){return this._bContainerOpen;};YAHOO.widget.MultiAutoComplete.prototype.getListItems=function(){return this._aListItems;};YAHOO.widget.MultiAutoComplete.prototype.getListItemData=function(oListItem){if(oListItem._oResultData){return oListItem._oResultData;}
else{return false;}};YAHOO.widget.MultiAutoComplete.prototype.setHeader=function(sHeader){if(sHeader){if(this._oContainer._oContent._oHeader){this._oContainer._oContent._oHeader.innerHTML=sHeader;this._oContainer._oContent._oHeader.style.display="block";}}
else{this._oContainer._oContent._oHeader.innerHTML="";this._oContainer._oContent._oHeader.style.display="none";}};YAHOO.widget.MultiAutoComplete.prototype.setSubHeader=function(sHeader,index){if(sHeader){if(this._oContainer._oContent._oSubHeaders[index]){this._oContainer._oContent._oSubHeaders[index].innerHTML=sHeader;this._oContainer._oContent._oSubHeaders[index].style.display="block";}}
else{if(this._oContainer._oContent._oSubHeaders[index]){this._oContainer._oContent._oSubHeaders[index].innerHTML="";this._oContainer._oContent._oSubHeaders[index].style.display="none";}}};YAHOO.widget.MultiAutoComplete.prototype.setFooter=function(sFooter){if(sFooter){if(this._oContainer._oContent._oFooter){this._oContainer._oContent._oFooter.innerHTML=sFooter;this._oContainer._oContent._oFooter.style.display="block";}}
else{this._oContainer._oContent._oFooter.innerHTML="";this._oContainer._oContent._oFooter.style.display="none";}};YAHOO.widget.MultiAutoComplete.prototype.setSubFooter=function(sFooter,index){if(sFooter){if(this._oContainer._oContent._oSubFooters[index]){this._oContainer._oContent._oSubFooters[index].innerHTML=sFooter;this._oContainer._oContent._oSubFooters[index].style.display="block";}}
else{if(this._oContainer._oContent._oSubFooters[index]){this._oContainer._oContent._oSubFooters[index].innerHTML="";this._oContainer._oContent._oSubFooters[index].style.display="none";}}};YAHOO.widget.MultiAutoComplete.prototype.toggleSubHeader=function(show,index)
{if(this._oContainer._oContent._oSubHeaders[index])
{if(show===true){this._oContainer._oContent._oSubHeaders[index].style.display="block";} else {this._oContainer._oContent._oSubHeaders[index].style.display="none";}}};YAHOO.widget.MultiAutoComplete.prototype.setBody=function(sBody){if(sBody){if(this._oContainer._oContent._oBody){this._oContainer._oContent._oBody.innerHTML=sBody;this._oContainer._oContent._oBody.style.display="block";this._oContainer._oContent.style.display="block";}}
else{this._oContainer._oContent._oBody.innerHTML="";this._oContainer._oContent.style.display="none";}
this._maxResultsDisplayed=0;};YAHOO.widget.MultiAutoComplete.prototype.formatResult=function(oResultItem,sQuery){var sResult=oResultItem[0];if(sResult){return sResult;}
else{return"";}};YAHOO.widget.MultiAutoComplete.prototype.doBeforeExpandContainer=function(oResultItem,sQuery){return true;};YAHOO.widget.MultiAutoComplete.prototype.sendQuery=function(sQuery){this._sendQuery(sQuery);};YAHOO.widget.MultiAutoComplete.prototype.textboxFocusEvent=null;YAHOO.widget.MultiAutoComplete.prototype.textboxKeyEvent=null;YAHOO.widget.MultiAutoComplete.prototype.dataRequestEvent=null;YAHOO.widget.MultiAutoComplete.prototype.dataReturnEvent=null;YAHOO.widget.MultiAutoComplete.prototype.dataErrorEvent=null;YAHOO.widget.MultiAutoComplete.prototype.containerExpandEvent=null;YAHOO.widget.MultiAutoComplete.prototype.typeAheadEvent=null;YAHOO.widget.MultiAutoComplete.prototype.itemMouseOverEvent=null;YAHOO.widget.MultiAutoComplete.prototype.itemMouseOutEvent=null;YAHOO.widget.MultiAutoComplete.prototype.itemArrowToEvent=null;YAHOO.widget.MultiAutoComplete.prototype.itemArrowFromEvent=null;YAHOO.widget.MultiAutoComplete.prototype.itemSelectEvent=null;YAHOO.widget.MultiAutoComplete.prototype.unmatchedItemSelectEvent=null;YAHOO.widget.MultiAutoComplete.prototype.selectionEnforceEvent=null;YAHOO.widget.MultiAutoComplete.prototype.containerCollapseEvent=null;YAHOO.widget.MultiAutoComplete.prototype.textboxBlurEvent=null;YAHOO.widget.MultiAutoComplete._nIndex=0;YAHOO.widget.MultiAutoComplete.prototype._sName=null;YAHOO.widget.MultiAutoComplete.prototype._oTextbox=null;YAHOO.widget.MultiAutoComplete.prototype._bFocused=true;YAHOO.widget.MultiAutoComplete.prototype._oAnim=null;YAHOO.widget.MultiAutoComplete.prototype._oContainer=null;YAHOO.widget.MultiAutoComplete.prototype._bContainerOpen=false;YAHOO.widget.MultiAutoComplete.prototype._bOverContainer=false;YAHOO.widget.MultiAutoComplete.prototype._aListItems=null;YAHOO.widget.MultiAutoComplete.prototype._nDisplayedItems=0;YAHOO.widget.MultiAutoComplete.prototype._maxResultsDisplayed=0;YAHOO.widget.MultiAutoComplete.prototype._sCurQuery=null;YAHOO.widget.MultiAutoComplete.prototype._sSavedQuery=null;YAHOO.widget.MultiAutoComplete.prototype._oCurItem=null;YAHOO.widget.MultiAutoComplete.prototype._bItemSelected=false;YAHOO.widget.MultiAutoComplete.prototype._nKeyCode=null;YAHOO.widget.MultiAutoComplete.prototype._nDelayID=-1;YAHOO.widget.MultiAutoComplete.prototype._iFrameSrc="javascript:false;";YAHOO.widget.MultiAutoComplete.prototype._queryInterval=null;YAHOO.widget.MultiAutoComplete.prototype._sLastTextboxValue=null;YAHOO.widget.MultiAutoComplete.prototype._initProps=function(){var minQueryLength=this.minQueryLength;if(isNaN(minQueryLength)||(minQueryLength<1)){minQueryLength=1;}
var maxResultsDisplayed=this.maxResultsDisplayed;if(isNaN(this.maxResultsDisplayed)||(this.maxResultsDisplayed<1)){this.maxResultsDisplayed=10;}
var queryDelay=this.queryDelay;if(isNaN(this.queryDelay)||(this.queryDelay<0)){this.queryDelay=0.5;}
var aDelimChar=(this.delimChar)?this.delimChar:null;if(aDelimChar){if(typeof aDelimChar=="string"){this.delimChar=[aDelimChar];}
else if(aDelimChar.constructor!=Array){this.delimChar=null;}}
var animSpeed=this.animSpeed;if((this.animHoriz||this.animVert)&&YAHOO.util.Anim){if(isNaN(animSpeed)||(animSpeed<0)){animSpeed=0.3;}
if(!this._oAnim){oAnim=new YAHOO.util.Anim(this._oContainer._oContent,{},this.animSpeed);this._oAnim=oAnim;}
else{this._oAnim.duration=animSpeed;}}
if(this.forceSelection&&this.delimChar){}};YAHOO.widget.MultiAutoComplete.prototype._initContainerHelpers=function(){if(this.useShadow&&!this._oContainer._oShadow){var oShadow=document.createElement("div");oShadow.className="yui-ac-shadow";this._oContainer._oShadow=this._oContainer.appendChild(oShadow);}
if(this.useIFrame&&!this._oContainer._oIFrame){var oIFrame=document.createElement("iframe");oIFrame.src=this._iFrameSrc;oIFrame.frameBorder=0;oIFrame.scrolling="no";oIFrame.style.position="absolute";oIFrame.style.width="100%";oIFrame.style.height="100%";oIFrame.tabIndex=-1;this._oContainer._oIFrame=this._oContainer.appendChild(oIFrame);}};YAHOO.widget.MultiAutoComplete.prototype._initContainer=function(){if(!this._oContainer._oContent){var oContent=document.createElement("div");oContent.className="yui-ac-content";oContent.style.display="none";this._oContainer._oContent=this._oContainer.appendChild(oContent);var oHeader=document.createElement("div");oHeader.className="yui-ac-hd";oHeader.style.display="none";this._oContainer._oContent._oHeader=this._oContainer._oContent.appendChild(oHeader);this._oContainer._oContent._oSubHeaders=new Array();this._oContainer._oContent._oBodys=new Array();this._oContainer._oContent._oSubFooters=new Array();for(var i=0;i<this.dataSources.length;i++)
{var oSubHeader=document.createElement("div");oSubHeader.className="yui-ac-hd-sub";oSubHeader.style.display="none";this._oContainer._oContent._oSubHeaders.push(this._oContainer._oContent.appendChild(oSubHeader));var oBody=document.createElement("div");oBody.className="yui-ac-bd";this._oContainer._oContent._oBodys.push(this._oContainer._oContent.appendChild(oBody));var oSubFooter=document.createElement("div");oSubFooter.className="yui-ac-ft-sub";oSubFooter.style.display="none";this._oContainer._oContent._oSubFooters.push(this._oContainer._oContent.appendChild(oSubFooter));}
var oFooter=document.createElement("div");oFooter.className="yui-ac-ft";oFooter.style.display="none";this._oContainer._oContent._oFooter=this._oContainer._oContent.appendChild(oFooter);}
else{}};YAHOO.widget.MultiAutoComplete.prototype._initList=function(){this._aListItems=[];for(var i=0;i<this._oContainer._oContent._oBodys.length;i++)
{while(this._oContainer._oContent._oBodys[i].hasChildNodes()){var oldListItems=this.getListItems()[i];if(oldListItems){for(var oldi=oldListItems.length-1;oldi>=0;oldi--){oldListItems[oldi]=null;}}
this._oContainer._oContent._oBodys[i].innerHTML="";}}
for(var i=0;i<this._oContainer._oContent._oBodys.length;i++)
{this._aListItems[i]=[]
var oList=document.createElement("ul");oList=this._oContainer._oContent._oBodys[i].appendChild(oList);for(var j=0;j<this.maxResultsDisplayed;j++){var oItem=document.createElement("li");oItem=oList.appendChild(oItem);this._aListItems[i][j]=oItem;this._initListItem(oItem,j,i);}}
this._maxResultsDisplayed=this.maxResultsDisplayed;};YAHOO.widget.MultiAutoComplete.prototype._initSubList=function(iIndex){while(this._oContainer._oContent._oBodys[iIndex].hasChildNodes()){var oldListItems=this.getListItems()[iIndex];if(oldListItems){for(var oldi=oldListItems.length-1;oldi>=0;oldi--){oldListItems[oldi]=null;}}
this._oContainer._oContent._oBodys[iIndex].innerHTML="";}
this._aListItems[iIndex]=[]
var oList=document.createElement("ul");oList=this._oContainer._oContent._oBodys[iIndex].appendChild(oList);for(var j=0;j<this.maxResultsDisplayed;j++){var oItem=document.createElement("li");oItem=oList.appendChild(oItem);this._aListItems[iIndex][j]=oItem;
this._initListItem(oItem,j,iIndex);}};
YAHOO.widget.MultiAutoComplete.prototype._initListItem=function(oItem,nItemIndex,nDataSourceIndex){
var oSelf=this;oItem.style.display="none";
oItem._nItemIndex=nItemIndex;
oItem._nDataSourceIndex=nDataSourceIndex;
oItem.mouseover=oItem.mouseout=oItem.onclick=null;
YAHOO.util.Event.addListener(oItem,"mouseover",oSelf._onItemMouseover,oSelf);
YAHOO.util.Event.addListener(oItem,"mouseout",oSelf._onItemMouseout,oSelf);
YAHOO.util.Event.addListener(oItem,"click",oSelf._onItemMouseclick,oSelf);};
YAHOO.widget.MultiAutoComplete.prototype._onIMEDetected=function(oSelf){oSelf._enableIntervalDetection();};
YAHOO.widget.MultiAutoComplete.prototype._enableIntervalDetection=function(){var currValue=this._oTextbox.value;var lastValue=this._sLastTextboxValue;if(currValue!=lastValue){this._sLastTextboxValue=currValue;this._sendQuery(currValue);}};YAHOO.widget.MultiAutoComplete.prototype._cancelIntervalDetection=function(oSelf){if(oSelf._queryInterval){clearInterval(oSelf._queryInterval);}};YAHOO.widget.MultiAutoComplete.prototype._isIgnoreKey=function(nKeyCode){if((nKeyCode==9)||(nKeyCode==13)||(nKeyCode==16)||(nKeyCode==17)||(nKeyCode>=18&&nKeyCode<=20)||(nKeyCode==27)||(nKeyCode>=33&&nKeyCode<=35)||(nKeyCode>=36&&nKeyCode<=38)||(nKeyCode==40)||(nKeyCode>=44&&nKeyCode<=45)){return true;}
return false;};YAHOO.widget.MultiAutoComplete.prototype._sendQuery=function(sQuery){if(this.minQueryLength==-1){this._toggleContainer(false);return;}
var aDelimChar=(this.delimChar)?this.delimChar:null;if(aDelimChar){var nDelimIndex=-1;for(var i=aDelimChar.length-1;i>=0;i--){var nNewIndex=sQuery.lastIndexOf(aDelimChar[i]);if(nNewIndex>nDelimIndex){nDelimIndex=nNewIndex;}}
if(aDelimChar[i]==" "){for(var j=aDelimChar.length-1;j>=0;j--){if(sQuery[nDelimIndex-1]==aDelimChar[j]){nDelimIndex--;break;}}}
if(nDelimIndex>-1){var nQueryStart=nDelimIndex+1;while(sQuery.charAt(nQueryStart)==" "){nQueryStart+=1;}
this._sSavedQuery=sQuery.substring(0,nQueryStart);sQuery=sQuery.substr(nQueryStart);}
else if(sQuery.indexOf(this._sSavedQuery)<0){this._sSavedQuery=null;}}
if(sQuery&&(sQuery.length<this.minQueryLength)||(!sQuery&&this.minQueryLength>0)){if(this._nDelayID!=-1){clearTimeout(this._nDelayID);}
this._toggleContainer(false);return;}
sQuery=encodeURIComponent(sQuery);this._nDelayID=-1;this.dataRequestEvent.fire(this,sQuery);this._waitingToPopulate=new Array();this._nDisplayedItems=0;for(var i=0;i<this.dataSources.length;i++)
{this.dataSources[i].getResults(this._populateStaging,sQuery,this);}};YAHOO.widget.MultiAutoComplete.prototype._waitingToPopulate=new Array();
YAHOO.widget.MultiAutoComplete.prototype._populateStaging=function(sQuery,aResults,oSelf,iIndex){
if(oSelf._waitingToPopulate.length==oSelf.dataSources.length-1){for(var i=0;i<oSelf._waitingToPopulate.length;i++){
if(oSelf._waitingToPopulate[i]!=null){oSelf._populateList(oSelf._waitingToPopulate[i].query,oSelf._waitingToPopulate[i].results,oSelf._waitingToPopulate[i].self,oSelf._waitingToPopulate[i].index);}
}
if(aResults!=null){oSelf._populateList(sQuery,aResults,oSelf,iIndex);}}
else{if(aResults==null){oSelf._waitingToPopulate.push(null);}else
{oSelf._waitingToPopulate.push({query:sQuery,results:aResults,self:oSelf,index:iIndex});}}}
YAHOO.widget.MultiAutoComplete.prototype._populateList=function(sQuery,aResults,oSelf,iIndex){if(aResults===null){oSelf.dataErrorEvent.fire(oSelf,sQuery);}
if(!oSelf._bFocused||!aResults){return;}
var isOpera=(navigator.userAgent.toLowerCase().indexOf("opera")!=-1);var contentStyle=oSelf._oContainer._oContent.style;contentStyle.width=(!isOpera)?null:"";contentStyle.height=(!isOpera)?null:"";var sCurQuery=decodeURIComponent(sQuery);oSelf._sCurQuery=sCurQuery;oSelf._bItemSelected=false;if(oSelf._maxResultsDisplayed!=oSelf.maxResultsDisplayed){oSelf._initList();}
var nItems=Math.min(aResults.length,oSelf.maxResultsDisplayed);oSelf._nDisplayedItems+=nItems;if(nItems>0){oSelf._initContainerHelpers();oSelf.toggleSubHeader(true,iIndex);var aItems=oSelf._aListItems[iIndex];for(var i=nItems-1;i>=0;i--){var oItemi=aItems[i];var oResultItemi=aResults[i];
oItemi.innerHTML=oSelf.formatResult(oResultItemi,sCurQuery,iIndex);
oItemi.style.display="list-item";
oItemi._sResultKey=oResultItemi[0];
oItemi._oResultData=oResultItemi;}
for(var j=aItems.length-1;j>=nItems;j--){var oItemj=aItems[j];oItemj.innerHTML=null;
oItemj.style.display="none";
oItemj._sResultKey=null;
oItemj._oResultData=null;}
if(oSelf.autoHighlight){var oFirstItem=aItems[0];oSelf._toggleHighlight(oFirstItem,"to");oSelf.itemArrowToEvent.fire(oSelf,oFirstItem);oSelf._typeAhead(oFirstItem,sQuery);}
else{this._toggleHighlight();
oSelf._oCurItem=null;}
if(!this._bContainerOpen)
{var ok=oSelf.doBeforeExpandContainer(oSelf._oTextbox,oSelf._oContainer,sQuery,aResults);oSelf._toggleContainer(ok);}}
else if(nItems==0)
{oSelf.toggleSubHeader(false,iIndex);
oSelf._initSubList(iIndex);}
if(oSelf._nDisplayedItems==0){oSelf._toggleContainer(false);}
oSelf.dataReturnEvent.fire(oSelf,sQuery,aResults,iIndex);};YAHOO.widget.MultiAutoComplete.prototype._clearSelection=function(){var sValue=this._oTextbox.value;var sChar=(this.delimChar)?this.delimChar[0]:null;var nIndex=(sChar)?sValue.lastIndexOf(sChar,sValue.length-2):-1;
if(nIndex>-1){this._oTextbox.value=sValue.substring(0,nIndex);}
else{this._oTextbox.value="";}
this._sSavedQuery=this._oTextbox.value;this.selectionEnforceEvent.fire(this);};
YAHOO.widget.MultiAutoComplete.prototype._textMatchesOption=function(){var foundMatch=false;for(var j=0;j<this._aListItems.length;j++)
{for(var i=this._nDisplayedItems-1;i>=0;i--){var oItem=this._aListItems[j][i];if(oItem==null||oItem._sResultKey==null) {
  continue;
}var sMatch=oItem._sResultKey.toLowerCase();if(sMatch==this._sCurQuery.toLowerCase()){foundMatch=true;break;}}}
return(foundMatch);};
YAHOO.widget.MultiAutoComplete.prototype._typeAhead=function(oItem,sQuery){if(!this.typeAhead||(this._nKeyCode==8)){return;}
var oTextbox=this._oTextbox;
var sValue=this._oTextbox.value;if(!oTextbox.setSelectionRange&&!oTextbox.createTextRange){return;}
var nStart=sValue.length;this._updateValue(oItem);var nEnd=oTextbox.value.length;this._selectText(oTextbox,nStart,nEnd);var sPrefill=oTextbox.value.substr(nStart,nEnd);this.typeAheadEvent.fire(this,sQuery,sPrefill);};
YAHOO.widget.MultiAutoComplete.prototype._selectText=function(oTextbox,nStart,nEnd){if(oTextbox.setSelectionRange){oTextbox.setSelectionRange(nStart,nEnd);}
else if(oTextbox.createTextRange){var oTextRange=oTextbox.createTextRange();oTextRange.moveStart("character",nStart);oTextRange.moveEnd("character",nEnd-oTextbox.value.length);oTextRange.select();}
else{oTextbox.select();}};
YAHOO.widget.MultiAutoComplete.prototype._toggleContainerHelpers=function(bShow){var bFireEvent=false;var width=this._oContainer._oContent.offsetWidth+"px";var height=this._oContainer._oContent.offsetHeight+"px";if(this.useIFrame&&this._oContainer._oIFrame){bFireEvent=true;if(bShow){this._oContainer._oIFrame.style.width=width;this._oContainer._oIFrame.style.height=height;}
else{this._oContainer._oIFrame.style.width=0;this._oContainer._oIFrame.style.height=0;}}
if(this.useShadow&&this._oContainer._oShadow){bFireEvent=true;if(bShow){this._oContainer._oShadow.style.width=width;this._oContainer._oShadow.style.height=height;}
else{this._oContainer._oShadow.style.width=0;this._oContainer._oShadow.style.height=0;}}};
YAHOO.widget.MultiAutoComplete.prototype._toggleContainer=function(bShow){var oContainer=this._oContainer;if(this.alwaysShowContainer&&this._bContainerOpen){return;}
if(!bShow){this._oContainer._oContent.scrollTop=0;for(var i=0;i<this._aListItems.length;i++)
{var aItems=this._aListItems[i];if(aItems&&(aItems.length>0)){for(var j=aItems.length-1;j>=0;j--){aItems[j].style.display="none";}}
if(this._oCurItem){this._toggleHighlight(this._oCurItem,"from");}
this._oCurItem=null;this._nDisplayedItems=0;this._sCurQuery=null;}}
if(!bShow&&!this._bContainerOpen){oContainer._oContent.style.display="none";return;}
var oAnim=this._oAnim;if(oAnim&&oAnim.getEl()&&(this.animHoriz||this.animVert)){if(!bShow){this._toggleContainerHelpers(bShow);}
if(oAnim.isAnimated()){oAnim.stop();}
var oClone=oContainer._oContent.cloneNode(true);oContainer.appendChild(oClone);oClone.style.top="-9000px";oClone.style.display="block";var wExp=oClone.offsetWidth;var hExp=oClone.offsetHeight;var wColl=(this.animHoriz)?0:wExp;var hColl=(this.animVert)?0:hExp;oAnim.attributes=(bShow)?{width:{to:wExp},height:{to:hExp}}:{width:{to:wColl},height:{to:hColl}};if(bShow&&!this._bContainerOpen){oContainer._oContent.style.width=wColl+"px";oContainer._oContent.style.height=hColl+"px";}
else{oContainer._oContent.style.width=wExp+"px";oContainer._oContent.style.height=hExp+"px";}
oContainer.removeChild(oClone);oClone=null;var oSelf=this;var onAnimComplete=function(){oAnim.onComplete.unsubscribeAll();if(bShow){oSelf.containerExpandEvent.fire(oSelf);}
else{oContainer._oContent.style.display="none";oSelf.containerCollapseEvent.fire(oSelf);}
oSelf._toggleContainerHelpers(bShow);};oContainer._oContent.style.display="block";oAnim.onComplete.subscribe(onAnimComplete);oAnim.animate();this._bContainerOpen=bShow;}
else{if(bShow){oContainer._oContent.style.display="block";this.containerExpandEvent.fire(this);}
else{oContainer._oContent.style.display="none";this.containerCollapseEvent.fire(this);}
this._toggleContainerHelpers(bShow);this._bContainerOpen=bShow;}};YAHOO.widget.MultiAutoComplete.prototype._toggleHighlight=function(oNewItem,sType){var sHighlight=this.highlightClassName;if(this._oCurItem){YAHOO.util.Dom.removeClass(this._oCurItem,sHighlight);}
if((sType=="to")&&sHighlight){YAHOO.util.Dom.addClass(oNewItem,sHighlight);this._oCurItem=oNewItem;}};YAHOO.widget.MultiAutoComplete.prototype._togglePrehighlight=function(oNewItem,sType){if(oNewItem==this._oCurItem){return;}
var sPrehighlight=this.prehighlightClassName;if((sType=="mouseover")&&sPrehighlight){YAHOO.util.Dom.addClass(oNewItem,sPrehighlight);}
else{YAHOO.util.Dom.removeClass(oNewItem,sPrehighlight);}};YAHOO.widget.MultiAutoComplete.prototype._updateValue=function(oItem){var oTextbox=this._oTextbox;var sDelimChar=(this.delimChar)?(this.delimChar[0]||this.delimChar):null;var sSavedQuery=this._sSavedQuery;var sResultKey=oItem._sResultKey;oTextbox.focus();oTextbox.value="";if(sDelimChar){if(sSavedQuery){oTextbox.value=sSavedQuery;}
oTextbox.value+=sResultKey+sDelimChar;if(sDelimChar!=" "){oTextbox.value+=" ";}}
else{oTextbox.value=sResultKey;}
if(oTextbox.type=="textarea"){oTextbox.scrollTop=oTextbox.scrollHeight;}
var end=oTextbox.value.length;this._selectText(oTextbox,end,end);this._oCurItem=oItem;};YAHOO.widget.MultiAutoComplete.prototype._selectItem=function(oItem){this._bItemSelected=true;this._updateValue(oItem);this._cancelIntervalDetection(this);this.itemSelectEvent.fire(this,oItem,oItem._oResultData);this._toggleContainer(false);};YAHOO.widget.MultiAutoComplete.prototype._jumpSelection=function(){if(!this.typeAhead){return;}
else{this._toggleContainer(false);}};YAHOO.widget.MultiAutoComplete.prototype._moveSelection=function(nKeyCode){if(this._bContainerOpen){var oCurItem=this._oCurItem;var nCurItemIndex=-1;if(oCurItem){if(oCurItem._nDataSourceIndex==0){nCurItemIndex=oCurItem._nItemIndex;}
else{var step=this.maxResultsDisplayed;for(var i=this._aListItems[oCurItem._nDataSourceIndex-1].length-1;i>=0;i--)
{if(this._aListItems[oCurItem._nDataSourceIndex-1][i]._oResultData!=null) {
  break;
}step--;}
nCurItemIndex=oCurItem._nItemIndex+step;}}
var nNewItemIndex=(nKeyCode==40)?(nCurItemIndex+1):(nCurItemIndex-1);if(nNewItemIndex<-2||nNewItemIndex>=this._nDisplayedItems){return;}
if(oCurItem){this._toggleHighlight(oCurItem,"from");this.itemArrowFromEvent.fire(this,oCurItem);}
if(nNewItemIndex==-1){if(this.delimChar&&this._sSavedQuery){if(!this._textMatchesOption()){this._oTextbox.value=this._sSavedQuery;}
else{this._oTextbox.value=this._sSavedQuery+this._sCurQuery;}}
else{this._oTextbox.value=this._sCurQuery;}
this._oCurItem=null;return;}
if(nNewItemIndex==-2){this._toggleContainer(false);return;}
var merged=new Array();for(var i=0;i<this._aListItems.length;i++)
{for(var j=0;j<this._aListItems[i].length;j++)
{if(this._aListItems[i][j]._oResultData==null) {
  break;
}merged.push(this._aListItems[i][j]);}}
var oNewItem=merged[nNewItemIndex];var oContent=this._oContainer._oContent;var scrollOn=((YAHOO.util.Dom.getStyle(oContent,"overflow")=="auto")||(YAHOO.util.Dom.getStyle(oContent,"overflowY")=="auto"));if(scrollOn&&(nNewItemIndex>-1)&&(nNewItemIndex<this._nDisplayedItems)){if(nKeyCode==40){if((oNewItem.offsetTop+oNewItem.offsetHeight)>(oContent.scrollTop+oContent.offsetHeight)){oContent.scrollTop=(oNewItem.offsetTop+oNewItem.offsetHeight)-oContent.offsetHeight;}
else if((oNewItem.offsetTop+oNewItem.offsetHeight)<oContent.scrollTop){oContent.scrollTop=oNewItem.offsetTop;}}
else{if(oNewItem.offsetTop<oContent.scrollTop){this._oContainer._oContent.scrollTop=oNewItem.offsetTop;}
else if(oNewItem.offsetTop>(oContent.scrollTop+oContent.offsetHeight)){this._oContainer._oContent.scrollTop=(oNewItem.offsetTop+oNewItem.offsetHeight)-oContent.offsetHeight;}}}
this._toggleHighlight(oNewItem,"to");this.itemArrowToEvent.fire(this,oNewItem);if(this.typeAhead){this._updateValue(oNewItem);}}};YAHOO.widget.MultiAutoComplete.prototype._onItemMouseover=function(v,oSelf){if(oSelf.prehighlightClassName){oSelf._togglePrehighlight(this,"mouseover");}
else{oSelf._toggleHighlight(this,"to");}
oSelf.itemMouseOverEvent.fire(oSelf,this);};YAHOO.widget.MultiAutoComplete.prototype._onItemMouseout=function(v,oSelf){if(oSelf.prehighlightClassName){oSelf._togglePrehighlight(this,"mouseout");}
else{oSelf._toggleHighlight(this,"from");}
oSelf.itemMouseOutEvent.fire(oSelf,this);};YAHOO.widget.MultiAutoComplete.prototype._onItemMouseclick=function(v,oSelf){oSelf._toggleHighlight(this,"to");oSelf._selectItem(this);};YAHOO.widget.MultiAutoComplete.prototype._onContainerMouseover=function(v,oSelf){oSelf._bOverContainer=true;};YAHOO.widget.MultiAutoComplete.prototype._onContainerMouseout=function(v,oSelf){oSelf._bOverContainer=false;if(oSelf._oCurItem){oSelf._toggleHighlight(oSelf._oCurItem,"to");}};YAHOO.widget.MultiAutoComplete.prototype._onContainerScroll=function(v,oSelf){oSelf._oTextbox.focus();};YAHOO.widget.MultiAutoComplete.prototype._onContainerResize=function(v,oSelf){oSelf._toggleContainerHelpers(oSelf._bContainerOpen);};YAHOO.widget.MultiAutoComplete.prototype._onTextboxKeyDown=function(v,oSelf){var nKeyCode=v.keyCode;switch(nKeyCode){case 9:if(oSelf.delimChar&&(oSelf._nKeyCode!=nKeyCode)){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
if(oSelf._oCurItem){oSelf._selectItem(oSelf._oCurItem);}
else{oSelf._toggleContainer(false);}
break;case 13:if(oSelf._nKeyCode!=nKeyCode){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
if(oSelf._oCurItem){oSelf._selectItem(oSelf._oCurItem);}
else{oSelf._toggleContainer(false);}
break;case 27:oSelf._toggleContainer(false);return;case 39:oSelf._jumpSelection();break;case 38:YAHOO.util.Event.stopEvent(v);oSelf._moveSelection(nKeyCode);break;case 40:YAHOO.util.Event.stopEvent(v);oSelf._moveSelection(nKeyCode);break;default:break;}};YAHOO.widget.MultiAutoComplete.prototype._onTextboxKeyPress=function(v,oSelf){var nKeyCode=v.keyCode;var isMac=(navigator.userAgent.toLowerCase().indexOf("mac")!=-1);if(isMac){switch(nKeyCode){case 9:if(oSelf.delimChar&&(oSelf._nKeyCode!=nKeyCode)){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
break;case 13:if(oSelf._nKeyCode!=nKeyCode){if(oSelf._bContainerOpen){YAHOO.util.Event.stopEvent(v);}}
break;case 38:case 40:YAHOO.util.Event.stopEvent(v);break;default:break;}}
else if(nKeyCode==229){oSelf._queryInterval=setInterval(function(){oSelf._onIMEDetected(oSelf);},500);}};YAHOO.widget.MultiAutoComplete.prototype._onTextboxKeyUp=function(v,oSelf){oSelf._initProps();var nKeyCode=v.keyCode;oSelf._nKeyCode=nKeyCode;var sText=this.value;if(oSelf._isIgnoreKey(nKeyCode)||(sText.toLowerCase()==oSelf._sCurQuery)){return;}
else{oSelf.textboxKeyEvent.fire(oSelf,nKeyCode);}
if(oSelf.queryDelay>0){var nDelayID=setTimeout(function(){oSelf._sendQuery(sText);},(oSelf.queryDelay*1000));if(oSelf._nDelayID!=-1){clearTimeout(oSelf._nDelayID);}
oSelf._nDelayID=nDelayID;}
else{oSelf._sendQuery(sText);}};YAHOO.widget.MultiAutoComplete.prototype._onTextboxFocus=function(v,oSelf){oSelf._oTextbox.setAttribute("autocomplete","off");oSelf._bFocused=true;oSelf.textboxFocusEvent.fire(oSelf);};YAHOO.widget.MultiAutoComplete.prototype._onTextboxBlur=function(v,oSelf){if(!oSelf._bOverContainer||(oSelf._nKeyCode==9)){if(!oSelf._bItemSelected){if(!oSelf._bContainerOpen||(oSelf._bContainerOpen&&!oSelf._textMatchesOption())){if(oSelf.forceSelection){oSelf._clearSelection();}
else{oSelf.unmatchedItemSelectEvent.fire(oSelf,oSelf._sCurQuery);}}}
if(oSelf._bContainerOpen){oSelf._toggleContainer(false);}
oSelf._cancelIntervalDetection(oSelf);oSelf._bFocused=false;oSelf.textboxBlurEvent.fire(oSelf);}};YAHOO.widget.MultiAutoComplete.prototype._onFormSubmit=function(v,oSelf){if(oSelf.allowBrowserAutocomplete){oSelf._oTextbox.setAttribute("autocomplete","on");}
else{oSelf._oTextbox.setAttribute("autocomplete","off");}};YAHOO.widget.DataSource=function(){};YAHOO.widget.DataSource.ERROR_DATANULL="Response data was null";YAHOO.widget.DataSource.ERROR_DATAPARSE="Response data could not be parsed";YAHOO.widget.DataSource.prototype.maxCacheEntries=15;YAHOO.widget.DataSource.prototype.queryMatchContains=false;YAHOO.widget.DataSource.prototype.queryMatchSubset=false;YAHOO.widget.DataSource.prototype.queryMatchCase=false;YAHOO.widget.DataSource.prototype.index=-1;YAHOO.widget.DataSource.prototype.toString=function(){return"DataSource "+this._sName;};YAHOO.widget.DataSource.prototype.getResults=function(oCallbackFn,sQuery,oParent){var aResults=this._doQueryCache(oCallbackFn,sQuery,oParent);if(aResults.length===0){this.queryEvent.fire(this,oParent,sQuery);this.doQuery(oCallbackFn,sQuery,oParent);}};YAHOO.widget.DataSource.prototype.doQuery=function(oCallbackFn,sQuery,oParent){};YAHOO.widget.DataSource.prototype.flushCache=function(){if(this._aCache){this._aCache=[];}
if(this._aCacheHelper){this._aCacheHelper=[];}
this.cacheFlushEvent.fire(this);};YAHOO.widget.DataSource.prototype.queryEvent=null;YAHOO.widget.DataSource.prototype.cacheQueryEvent=null;YAHOO.widget.DataSource.prototype.getResultsEvent=null;YAHOO.widget.DataSource.prototype.getCachedResultsEvent=null;YAHOO.widget.DataSource.prototype.dataErrorEvent=null;YAHOO.widget.DataSource.prototype.cacheFlushEvent=null;YAHOO.widget.DataSource._nIndex=0;YAHOO.widget.DataSource.prototype._sName=null;YAHOO.widget.DataSource.prototype._aCache=null;YAHOO.widget.DataSource.prototype._init=function(){var maxCacheEntries=this.maxCacheEntries;if(isNaN(maxCacheEntries)||(maxCacheEntries<0)){maxCacheEntries=0;}
if(maxCacheEntries>0&&!this._aCache){this._aCache=[];}
this._sName="instance"+YAHOO.widget.DataSource._nIndex;YAHOO.widget.DataSource._nIndex++;this.queryEvent=new YAHOO.util.CustomEvent("query",this);this.cacheQueryEvent=new YAHOO.util.CustomEvent("cacheQuery",this);this.getResultsEvent=new YAHOO.util.CustomEvent("getResults",this);this.getCachedResultsEvent=new YAHOO.util.CustomEvent("getCachedResults",this);this.dataErrorEvent=new YAHOO.util.CustomEvent("dataError"+this.index,this);this.cacheFlushEvent=new YAHOO.util.CustomEvent("cacheFlush",this);};YAHOO.widget.DataSource.prototype._addCacheElem=function(oResult){var aCache=this._aCache;if(!aCache||!oResult||!oResult.query||!oResult.results){return;}
if(aCache.length>=this.maxCacheEntries){aCache.shift();}
aCache.push(oResult);};YAHOO.widget.DataSource.prototype._doQueryCache=function(oCallbackFn,sQuery,oParent){var aResults=[];var bMatchFound=false;var aCache=this._aCache;var nCacheLength=(aCache)?aCache.length:0;var bMatchContains=this.queryMatchContains;if((this.maxCacheEntries>0)&&aCache&&(nCacheLength>0)){this.cacheQueryEvent.fire(this,oParent,sQuery);if(!this.queryMatchCase){var sOrigQuery=sQuery;sQuery=sQuery.toLowerCase();}
for(var i=nCacheLength-1;i>=0;i--){var resultObj=aCache[i];var aAllResultItems=resultObj.results;var matchKey=(!this.queryMatchCase)?encodeURIComponent(resultObj.query).toLowerCase():encodeURIComponent(resultObj.query);if(matchKey==sQuery){bMatchFound=true;aResults=aAllResultItems;if(i!=nCacheLength-1){aCache.splice(i,1);this._addCacheElem(resultObj);}
break;}
else if(this.queryMatchSubset){for(var j=sQuery.length-1;j>=0;j--){var subQuery=sQuery.substr(0,j);if(matchKey==subQuery){bMatchFound=true;for(var k=aAllResultItems.length-1;k>=0;k--){var aRecord=aAllResultItems[k];var sKeyIndex=(this.queryMatchCase)?encodeURIComponent(aRecord[0]).indexOf(sQuery):encodeURIComponent(aRecord[0]).toLowerCase().indexOf(sQuery);if((!bMatchContains&&(sKeyIndex===0))||(bMatchContains&&(sKeyIndex>-1))){aResults.unshift(aRecord);}}
resultObj={};resultObj.query=sQuery;resultObj.results=aResults;this._addCacheElem(resultObj);break;}}
if(bMatchFound){break;}}}
if(bMatchFound){this.getCachedResultsEvent.fire(this,oParent,sOrigQuery,aResults);oCallbackFn(sOrigQuery,aResults,oParent,this.index);}}
return aResults;};YAHOO.widget.DS_XHR=function(sScriptURI,aSchema,oConfigs){if(typeof oConfigs=="object"){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!aSchema||(aSchema.constructor!=Array)){return;}
else{this.schema=aSchema;}
this.scriptURI=sScriptURI;this._init();};YAHOO.widget.DS_XHR.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_XHR.TYPE_JSON=0;YAHOO.widget.DS_XHR.TYPE_XML=1;YAHOO.widget.DS_XHR.TYPE_FLAT=2;YAHOO.widget.DS_XHR.ERROR_DATAXHR="XHR response failed";YAHOO.widget.DS_XHR.prototype.connMgr=YAHOO.util.Connect;YAHOO.widget.DS_XHR.prototype.connTimeout=0;YAHOO.widget.DS_XHR.prototype.scriptURI=null;YAHOO.widget.DS_XHR.prototype.scriptQueryParam="query";YAHOO.widget.DS_XHR.prototype.scriptQueryAppend="";YAHOO.widget.DS_XHR.prototype.responseType=YAHOO.widget.DS_XHR.TYPE_JSON;YAHOO.widget.DS_XHR.prototype.responseStripAfter="\n<!-";YAHOO.widget.DS_XHR.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var isXML=(this.responseType==YAHOO.widget.DS_XHR.TYPE_XML);var sUri=this.scriptURI+"?"+this.scriptQueryParam+"="+sQuery;if(this.scriptQueryAppend.length>0){sUri+="&"+this.scriptQueryAppend;}
var oResponse=null;var oSelf=this;var responseSuccess=function(oResp){if(!oSelf._oConn||(oResp.tId!=oSelf._oConn.tId)){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATANULL);return;}
for(var foo in oResp){}
if(!isXML){oResp=oResp.responseText;}
else{oResp=oResp.responseXML;}
if(oResp===null){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATANULL);return;}
var aResults=oSelf.parseResponse(sQuery,oResp,oParent);var resultObj={};resultObj.query=decodeURIComponent(sQuery);resultObj.results=aResults;if(aResults===null){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATAPARSE);aResults=[];}
else{oSelf.getResultsEvent.fire(oSelf,oParent,sQuery,aResults);oSelf._addCacheElem(resultObj);}
oCallbackFn(sQuery,aResults,oParent,this.argument[0]);};var responseFailure=function(oResp){oSelf.dataErrorEvent.fire(oSelf,oParent,sQuery,YAHOO.widget.DS_XHR.ERROR_DATAXHR);return;};var oCallback={success:responseSuccess,failure:responseFailure,argument:[this.index]};if(!isNaN(this.connTimeout)&&this.connTimeout>0){oCallback.timeout=this.connTimeout;}
if(this._oConn){this.connMgr.abort(this._oConn);}
oSelf._oConn=this.connMgr.asyncRequest("GET",sUri,oCallback,null);};YAHOO.widget.DS_XHR.prototype.parseResponse=function(sQuery,oResponse,oParent){var aSchema=this.schema;var aResults=[];var bError=false;var nEnd=((this.responseStripAfter!=="")&&(oResponse.indexOf))?oResponse.indexOf(this.responseStripAfter):-1;if(nEnd!=-1){oResponse=oResponse.substring(0,nEnd);}
switch(this.responseType){
  case YAHOO.widget.DS_XHR.TYPE_JSON:var jsonList;
  if(window.JSON&&(navigator.userAgent.toLowerCase().indexOf('khtml')==-1)){
    oResponse = oResponse.replace(/\\'/g,"'");
    var jsonObjParsed=JSON.parse(oResponse);
    if(!jsonObjParsed){bError=true;break;}
    else{try{jsonList=eval("jsonObjParsed."+aSchema[0]);}
    catch(e){bError=true;break;}
    }
  }else{try{while(oResponse.substring(0,1)==" "){oResponse=oResponse.substring(1,oResponse.length);}

if(oResponse.indexOf("{")<0){bError=true;break;}
if(oResponse.indexOf("{}")===0){break;}
var jsonObjRaw=eval("("+oResponse+")");if(!jsonObjRaw){bError=true;break;}
jsonList=eval("(jsonObjRaw."+aSchema[0]+")");}
catch(e){bError=true;break;}}
if(!jsonList){bError=true;break;}
if(jsonList.constructor!=Array){jsonList=[jsonList];}
for(var i=jsonList.length-1;i>=0;i--){var aResultItem=[];var jsonResult=jsonList[i];for(var j=aSchema.length-1;j>=1;j--){var dataFieldValue=jsonResult[aSchema[j]];if(!dataFieldValue){dataFieldValue="";}
aResultItem.unshift(dataFieldValue);}
if(aResultItem.length==1){aResultItem.push(jsonResult);}
aResults.unshift(aResultItem);}
break;case YAHOO.widget.DS_XHR.TYPE_XML:var xmlList=oResponse.getElementsByTagName(aSchema[0]);if(!xmlList){bError=true;break;}
for(var k=xmlList.length-1;k>=0;k--){var result=xmlList.item(k);var aFieldSet=[];for(var m=aSchema.length-1;m>=1;m--){var sValue=null;var xmlAttr=result.attributes.getNamedItem(aSchema[m]);if(xmlAttr){sValue=xmlAttr.value;}
else{var xmlNode=result.getElementsByTagName(aSchema[m]);if(xmlNode&&xmlNode.item(0)&&xmlNode.item(0).firstChild){sValue=xmlNode.item(0).firstChild.nodeValue;}
else{sValue="";}}
aFieldSet.unshift(sValue);}
aResults.unshift(aFieldSet);}
break;case YAHOO.widget.DS_XHR.TYPE_FLAT:if(oResponse.length>0){var newLength=oResponse.length-aSchema[0].length;if(oResponse.substr(newLength)==aSchema[0]){oResponse=oResponse.substr(0,newLength);}
var aRecords=oResponse.split(aSchema[0]);for(var n=aRecords.length-1;n>=0;n--){aResults[n]=aRecords[n].split(aSchema[1]);}}
break;default:break;}
sQuery=null;oResponse=null;oParent=null;if(bError){return null;}
else{return aResults;}};YAHOO.widget.DS_XHR.prototype._oConn=null;YAHOO.widget.DS_JSFunction=function(oFunction,oConfigs){if(typeof oConfigs=="object"){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!oFunction||(oFunction.constructor!=Function)){return;}
else{this.dataFunction=oFunction;this._init();}};YAHOO.widget.DS_JSFunction.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_JSFunction.prototype.dataFunction=null;YAHOO.widget.DS_JSFunction.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var oFunction=this.dataFunction;var aResults=[];aResults=oFunction(sQuery);if(aResults===null){this.dataErrorEvent.fire(this,oParent,sQuery,YAHOO.widget.DataSource.ERROR_DATANULL);return;}
var resultObj={};resultObj.query=decodeURIComponent(sQuery);resultObj.results=aResults;this._addCacheElem(resultObj);this.getResultsEvent.fire(this,oParent,sQuery,aResults);oCallbackFn(sQuery,aResults,oParent,this.index);return;};YAHOO.widget.DS_JSArray=function(aData,oConfigs){if(typeof oConfigs=="object"){for(var sConfig in oConfigs){this[sConfig]=oConfigs[sConfig];}}
if(!aData||(aData.constructor!=Array)){return;}
else{this.data=aData;this._init();}};YAHOO.widget.DS_JSArray.prototype=new YAHOO.widget.DataSource();YAHOO.widget.DS_JSArray.prototype.data=null;YAHOO.widget.DS_JSArray.prototype.doQuery=function(oCallbackFn,sQuery,oParent){var aData=this.data;var aResults=[];var bMatchFound=false;var bMatchContains=this.queryMatchContains;if(sQuery){if(!this.queryMatchCase){sQuery=sQuery.toLowerCase();}
for(var i=aData.length-1;i>=0;i--){var aDataset=[];if(aData[i]){if(aData[i].constructor==String){aDataset[0]=aData[i];}
else if(aData[i].constructor==Array){aDataset=aData[i];}}
if(aDataset[0]&&(aDataset[0].constructor==String)){var sKeyIndex=(this.queryMatchCase)?encodeURIComponent(aDataset[0]).indexOf(sQuery):encodeURIComponent(aDataset[0]).toLowerCase().indexOf(sQuery);if((!bMatchContains&&(sKeyIndex===0))||(bMatchContains&&(sKeyIndex>-1))){aResults.unshift(aDataset);}}}}
this.getResultsEvent.fire(this,oParent,sQuery,aResults);oCallbackFn(sQuery,aResults,oParent,this.index);};
dojo.provide("clickability.w-button");
dojo.require("dj.util.Cookie");


/* Copyright 2000-2004 Clickability Inc.  */
/* Clickability ButtonServer v4.01        */

/*Functions*/
function getRegionpartnerID(TrackType)
{
  var regionCookie = dj.util.Cookie.getCookie('wsjregion');
  var defaultETRegion = 398944;
  var defaultPVRegion = 399154;

  if (typeof regionCookie !== "string" || regionCookie.length === 0)
  {
    return ((TrackType == "ET") ? defaultETRegion : defaultPVRegion);
  }
  var regionid = regionCookie.split(',');
  var ET = {};
  var PV = {};

  if (TrackType == 'ET')
  {
    ET.na = defaultETRegion;
    ET.europe = 398949;
    ET.asia = 398954;
  ET.india = 398959;
    //  console.log(ET[regionid[0]]);
  if(typeof regionid[1]!== "string")
  {
  return ET[regionid[0]];
  }
  else
  {
   return ((regionid[1].toLowerCase()=="india") ? ET[regionid[1]] : ET[regionid[0]]);
  }
  }
  else
  {
   PV.na = defaultPVRegion;
   PV.europe = 399159;
   PV.asia = 399164;
   PV.india = 399169;
   //  console.log(PV[regionid[0]]);
   if(typeof regionid[1]!== "string")
  {
    return PV[regionid[0]];
  }
  else
  {
     return ((regionid[1].toLowerCase()=="india") ? PV[regionid[1]] : PV[regionid[0]]);
    }
  }
}


function ST () {
  window.open('http://www.savethis.clickability.com/st/saveThisApp?clickMap=saveThis'+commonLoc(),'click',popWin);
  return false;
}

function STMouseOver () {
  window.status='SAVE THIS';
  return true;
}

function STMouseOut () {
  window.status='';
  return true;
}

function ET (mod) {
      var _c=new Image();
      var _qc='http://s.clickability.com/s?';
      _qc+="&7="+regionpartnerID;
      _qc+="&8="+escape(getEmailURL());
      _qc+="&10="+escape(getClickTitle());
      _qc+="&19=40003";
      _qc+="&21=1";
      _qc+="&18="+Math.random();
      _c.src=_qc;

  window.open('http://www.emailthis.clickability.com/et/emailThis?clickMap=create'+commonLoc(mod),'click',popWin);
  return false;
}

function ETMouseOver () {
  window.status='EMAIL THIS';
  return true;
}

function ETMouseOut () {
  window.status='';
  return true;
}

function MP () {
  window.open('http://at.wsj.com/mostpopular','click',popWin);
  return false;
}

function MPMouseOver () {
  window.status='MOST POPULAR';
  return true;
}

function MPMouseOut () {
  window.status='';
  return true;
}

function getClickURL() {
        if (self.clickURL) {
          return clickURL;
        }
        return document.location.href;
}

function getEmailURL() {
  if (typeof AT_VARS!=="undefined" && AT_VARS.articleEmailUrl && AT_VARS.articleUrl) {
    var emailUrl = AT_VARS.articleUrl;
    if(dj.context.article && dj.context.article.fullArticle){
        emailUrl = AT_VARS.articleEmailUrl;
    }
    return emailUrl;
  }
  return getClickURL();
}

function getClickTitle() {
  if (typeof AT_VARS!=="undefined" && AT_VARS.clickTitle) {
    return AT_VARS.clickTitle;
  }
  return document.title;
}
function getClickExpire() {
  if (self.clickExpire) {
    return clickExpire;
  }
  return "";
}

//document.write('<script language="JavaScript"> \n');
//document.write('window.onerror=function(){clickURL=document.location.href;return true;} \n');
//document.write('if(!self.clickURL) clickURL=parent.location.href; \n');
//document.write('<\/script> \n');

try {
    if (!self.clickURL) {
      clickURL=parent.location.href;
    }
  } catch (e) {
    console.error("Clickability. Cannot access parent.location.");
  }

/* WSJ.com Clickability Default Section Id/PV Id */
var PVpartnerID="59941",partnerID="150";
var regionpartnerID  = getRegionpartnerID('ET');
var PVregionpartnerID = getRegionpartnerID('PV');
/* WSJ.com Clickbility Section Id and PV Id mapping */

/* Barrons partnerID*/
if(dj.context.authorization.role.subscriber == 'BARRONS') {
  partnerID="3820";
}

var section_pv = new Array(20);

section_pv["Technology"]="110636";
section_pv["Tech"]="110636";
section_pv["Markets"]="110641";
section_pv["Market News"]="110641";
section_pv["Personal Journal"]="110651";
section_pv["Personal Finance"]="110651";
section_pv["Opinion"]="110646";
section_pv["Leisure/Weekend"]="110656";
section_pv["Lifestyle"]="110656";
section_pv["Life & Style"]="110656";
section_pv["Life &amp; Style"]="110656";
section_pv["Health"]="110676";
section_pv["Media"]="110671";

var section = new Array(20);

section["Technology"]="110591";
section["Tech"]="110591";
section["Markets"]="110596";
section["Market News"]="110596";
section["Personal Journal"]="110606";
section["Personal Finance"]="110606";
section["Opinion"]="110601";
section["Leisure/Weekend"]="110611";
section["Lifestyle"]="110611";
section["Life & Style"]="110611";
section["Life &amp; Style"]="110611";
section["Health"]="110631";
section["Media"]="110626";

try {
  if(window.mpsection){
    if(section_pv[mpsection]){
      PVpartnerID = section_pv[mpsection];
    }
    if(section[mpsection]){
      partnerID = section[mpsection];
    }
  }
}catch(err){
  txt="ERROR.\n\n"
  txt+="Error description: " + err.description + "\n\n"
  txt+="Click OK to continue.\n\n"
  console.error(txt);
}

var popWin="width=510,height=480,resizable=1,scrollbars=1";
var commonLoc=function(mod){return "&fb=Y&url="+escape(getEmailURL()+"?mod="+mod)+"&title="+escape(getClickTitle())+"&random="+Math.random()+"&partnerID="+partnerID+"&expire="+escape(getClickExpire())};

var inpop  = ( (document.domain.indexOf("printthis.clickability.com")>-1)?true:false);
var _a=new Image();
var _b=new Image();
var clickRan=Math.random();
var clickFac = 10;
if(clickFac==0){clickFac=1;}
if(!inpop && clickRan>(1-(1/clickFac))){
var _ti=900;
    var _qa="";
    var _qb="";


    // PAGE VIEW TRACKING
    var _qa='http://s.clickability.com/s?';
    _qa+="&7="+PVpartnerID;
    _qa+="&8="+escape(getClickURL());
    _qa+="&10="+escape(getClickTitle());
    _qa+="&19="+_ti;
    _qa+="&21="+clickFac;
    _qa+="&18="+Math.random();
    _a.src=_qa;
    // ET PAGEVIEW TRACKING
     var _qb='http://s.clickability.com/s?';
    _qb+="&7="+partnerID;
    _qb+="&8="+escape(getEmailURL());
    _qb+="&10="+escape(getClickTitle());
    _qb+="&19="+_ti;
    _qb+="&21="+clickFac;
    _qb+="&18="+Math.random();
    _b.src=_qb;


   // PAGE VIEW REGION TRACKING
    var _qa='http://s.clickability.com/s?';
    _qa+="&7="+PVregionpartnerID;
    _qa+="&8="+escape(getClickURL());
    _qa+="&10="+escape(getClickTitle());
    _qa+="&19="+_ti;
    _qa+="&21="+clickFac;
    _qa+="&18="+Math.random();
    _a.src=_qa;


    // ET PAGEVIEW REGION TRACKING
     var _qb='http://s.clickability.com/s?';
    _qb+="&7="+regionpartnerID;
    _qb+="&8="+escape(getEmailURL());
    _qb+="&10="+escape(getClickTitle());
    _qb+="&19="+_ti;
    _qb+="&21="+clickFac;
    _qb+="&18="+Math.random();
    _b.src=_qb;
}

// TODO: is this necessary?  This was written between 2000 and 2004, and this may be a Netscape 4 or IE 5 hack
// TODO:  intercepting window.onresize seems to be generally a bad idea.
window.onresize = function () {
    for (var i=0; i<document.links.length; i++) {
        document.links[i].onclick = document.links[i].onclick;
    }
};
dojo.provide("gravity.beacon");
dojo.require("dj.util.User");
dojo.require("dj.util.Cookie");

gravity.beacon = {
	init: function() {

		dj.util.User.getUserId(function(_u){
			var _cookieVal = '';
			if(_u !== ""){ 
				_cookieVal = _u;
			}else{
				var _anonymous = dj.util.Cookie.getCookie("djcs_route");
				if(_anonymous !== null){
					_cookieVal = _anonymous;
				}
			}
		
			if(dj.util.Cookie.getCookie("grvinsights") === null){
				if(_cookieVal !== ''){
					dj.util.Cookie.setCookie("grvinsights", _cookieVal);
					console.log("GARVITY COOKIE SET - "+_cookieVal);
				}
			}
		
			/* Gravity provided JS - Start */
			
			if(_u !== ""){ 
				var gravityInsightsParams = {type:'content', site_guid:'18f3b45caef80572d421f68a979bd6dc', user_id: _u};
			}else{
				var gravityInsightsParams = {type:'content', site_guid:'18f3b45caef80572d421f68a979bd6dc'};
			}
		
			var GravityInsights=function(b){
		
				function h(a,d){var c,f=d||"beacon";c=document.getElementsByTagName("title")[0]===void 0?"":encodeURIComponent(document.getElementsByTagName("title")[0].innerHTML);var g=new Date,g=g.getMilliseconds()+"-"+g.getSeconds();c=["cbust="+g,"site_guid="+b.site_guid,"action="+f,"user_guid="+a,"referrer="+e(document.referrer),"browser_useragent="+e(navigator.userAgent),"OS="+e(j()),"href="+e(location.href),"url="+k(),b.thread_id!==void 0?"thread_id="+b.thread_id:"",b.post_id!== void 0?"post_id="+b.post_id:"",b.forum_id!==void 0?"forum_id="+b.forum_id:"",b.user_id!==void 0?"user_id="+b.user_id:"",b.username!==void 0?"user_name="+e(b.username):"",b.post_title!==void 0?"post_title="+e(b.post_title):"",b.thread_title!==void 0?"thread_title="+e(b.thread_title):"",b.forum_title!==void 0?"forum_title="+e(b.forum_title):"",c!==void 0?"article_title="+c:"",b.external_user_id!==void 0?"external_user_id="+b.external_user_id:"",b.article_id!==void 0?"article_id="+b.article_id:"",b.type!== void 0?"type="+b.type:"",b.board!==void 0?"board="+encodeURIComponent(b.board):""].join("&");f=document.createElement("script");f.src=i+"/log?"+c;f.type="text/javascript";c=document.getElementsByTagName("head")[0]||document.documentElement;c.insertBefore(f,c.firstChild)}
		
				function e(a){return window.encodeURIComponent?encodeURIComponent(a):escape(a)}
		
				function j(){var a="Unknown OS";navigator.appVersion.indexOf("Win")!==-1&&(a="Windows");navigator.appVersion.indexOf("Mac")!==-1&&(a="MacOS");navigator.appVersion.indexOf("X11")!== -1&&(a="UNIX");navigator.appVersion.indexOf("Linux")!==-1&&(a="Linux");return a}
		
				function k(){var a=document.getElementsByTagName("link"),b=a.length,c="";for(x=0;x<b;x++)if((c=a[x].getAttribute("rel"))&&c.indexOf("canonical")===0)return encodeURIComponent(a[x].getAttribute("href"));else if(x===b)break;return encodeURIComponent(location.href)}
		
				var i="http://rma-api.gravity.com/v1/beacons";
				(function(){var a;a=document.cookie;var d=a.indexOf("grvinsights");if(d===-1)a=" ";else{var c=a.indexOf(";",d);if(c=== -1)c=a.length;a=unescape(a.substring(d+11+1,c))}if(a===" "||a==="")d="?u="+b.user_id+"&sg="+b.site_guid,a=document.createElement("script"),a.src=i+"/initialize"+d,a.type="text/javascript",d=document.getElementsByTagName("head")[0]||document.documentElement,d.insertBefore(a,d.firstChild),a=!1;a!==void 0&&a&&h(a,"beacon")})();
		
				return{cc:function(a,b){if(a!==""){var c=new Date;c.setTime(c.getTime()+432E8);c="; expires="+c.toGMTString();document.cookie=a+"="+b+c+"; path=/";h(b,"beacon")}}}
		
			}(gravityInsightsParams);
			
			/* Gravity provided JS - End */
		
		});
	}
};
/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  URL: https://github.com/twitter/hogan.js
 */

dojo.provide("hogan");
dojo.require("hogan._compiler");
dojo.require("hogan.Template");
hogan.template = hogan.Template;
dojo.provide("dj.util.AddressParser");
dj.util.AddressParser={clearAndNormalize:function(a){a=a.replace(/,/g," ");a=a.replace(/[^a-zA-Z 0-9]+/g,"");return a=a.toLowerCase()},parseZipCode:function(a){a=dojo.trim(a);if(this.pattern)this.pattern.compile(/\d{1,5}/gi);else this.pattern=/\d{1,5}/gi;return(this.matches=this.pattern.exec(a))?{zipCode:dojo.trim(this.matches[this.matches.length-1]),index:this.matches.index}:{zipCode:"",index:a.length}},parseAbbreviatedState:function(a){a=dojo.trim(a);var b=a.split(" ");b=b[b.length-1];var c=a.length;
if(b.length==2){c=a.lastIndexOf(b);if(b.match("al|ak|az|ar|ca|co|ct|de|dc|fl|ga|hi|id|il|in|ia|ks|ky|la|me|md|ma|mi|mn|ms|mo|mt|ne|nv|nh|nj|nm|ny|nc|nd|oh|ok|or|pa|ri|sc|sd|tn|tx|ut|vt|va|wa|wv|wi|wy"))return{state:b,index:c}}return{state:"",index:c}},abbreviateState:function(a){for(var b=["al","ak","az","ar","ca","co","ct","de","dc","fl","ga","hi","id","il","in","ia","ks","ky","la","me","md","ma","mi","mn","ms","mo","mt","ne","nv","nh","nj","nm","ny","nc","nd","oh","ok","or","pa","ri","sc","sd",
"tn","tx","ut","vt","va","wa","wv","wi","wy"],c=["alabama","alaska","arizona","arkansas","california","colorado","connecticut","delaware","district of columbia","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","maine","maryland","massachusetts","michigan","minnesota","mississippi","missouri","montana","nebraska","nevada","new hampshire","new jersey","new mexico","new york","north carolina","north dakota","ohio","oklahoma","oregon","pennsylvania","rhode island",
"south carolina","south dakota","tennessee","texas","utah","vermont","virginia","washington","west virginia","wisconsin","wyoming"],e=c.length-1;e>=0;e--)if(c[e]==a)return b[e];return a},parseState:function(a,b){a=dojo.trim(a);var c=this.parseAbbreviatedState(a);if(c.state!=="")return c;else{a=a.substring(0,c.index);c=a.split(" ");var e=c.length>1?c.length-2:0;if(e>=0){if(c[e]=="of"&&e>=0)e-=1;c=c[e].match("new|north|south|west|rhode|district")?c[e]=="district"&&c[e+2]?c[e]+" "+c[e+1]+" "+c[e+2]:
c[e]+" "+c[e+1]:c[c.length==1?0:e+1];if(e=c.match("alabama|alaska|arizona|arkansas|california|colorado|connecticut|delaware|district of columbia|florida|georgia|hawaii|idaho|illinois|indiana|iowa|kansas|kentucky|louisiana|maine|maryland|massachusetts|michigan|minnesota|mississippi|missouri|montana|nebraska|nevada|new hampshire|new jersey|new mexico|new york|north carolina|north dakota|ohio|oklahoma|oregon|pennsylvania|rhode island|south carolina|south dakota|tennessee|texas|utah|vermont|virginia|washington|west virginia|wisconsin|wyoming")){if(b)c=
this.abbreviateState(c);return{state:c,index:a.lastIndexOf(e[0])}}}return{state:"",index:a.length}}},parseCity:function(a){a=a.toLowerCase().replace(".","");var b=a.match(/^mt |^st |^ft |^pt |^pointe |^n |^s |^e |^w /),c={"mt ":"mount ","ft ":"fort ","st ":"saint ","pt ":"point ","pointe ":"point ","n ":"north ","s ":"south ","e ":"east ","w ":"west "};if(b)a=a.replace(b,c[b]);return a},parse:function(a,b){a=this.clearAndNormalize(a);var c=this.parseZipCode(a),e=this.parseState(a.substring(0,c.index),
b);return{city:this.parseCity(dojo.trim(a.substring(0,e.index))),state:e.state,zipCode:c.zipCode}}};
dojo.provide("dj.util.animation");
dj.util.animation={crossFadeInsert:function(a,b,c){var e=new dojo.Deferred,f=0,g,h,j,k;h=dojo.byId(b);b=dojo.delegate({height:500,fadeOut:800,fadeIn:1200},c);c=dojo.contentBox(h);dojo.style(h,{position:"relative",height:c.h+"px"});if(!dojo.isIE||dojo.isIE&&!dojo.isQuirks&&dojo.isIE>7)dojo.style(h,{minHeight:"inherit"});j=dojo.create("div",{innerHTML:h.innerHTML,style:{position:"absolute",top:dojo.style(h,"paddingTop")+"px",left:dojo.style(h,"paddingLeft")+"px"}});dojo.place(j,h,"only");k=dojo.create("div",
{style:{overflow:"hidden",opacity:0,height:0}},h);a=typeof a==="object"?dojo.place(a,k):dojo.create("div",{innerHTML:a},k);a=dojo.marginBox(a);g=function(){++f===3&&e.callback()};a=dojo.animateProperty({node:h,duration:b.height,properties:{height:{start:c.h,end:a.h}},onEnd:function(){dojo.style(k,{overflow:"visible"});g()}});c=dojo.fadeOut({node:j,duration:b.fadeIn,onEnd:function(){dojo.destroy(j);dojo.style(h,{position:""});dojo.attr(k,"style","");g()}});b=dojo.fadeIn({node:k,duration:b.fadeIn,onEnd:function(){g()}});
a.play();c.play();b.play();return e}};
dojo.provide("dj.util.Compatibility");function OpenG(a){dj.util.Url.openWin(a,"",980,707,"off",true,40,10)}function OpenWin(){dj.util.Url.openWin.apply(null,arguments)}function launchAudio(a){var b=a.split("/");OpenG("http://s.wsj.net/public/resources/documents/WSJ_audioPlayer08.html?audioFile="+a+"&trackName="+b[b.length-1])};
dojo.provide("dj.util.Form");
dj.util.Form={submitOnEvent:function(a,b,c){c=c||"onclick";a=dojo.byId(a);var e=document[b];if(typeof a==="undefined"||a===null||typeof e==="undefined"||e===null)console.warn("{dj.util.Form} element and/or form not found");else return dojo.connect(a,c,function(f){dojo.stopEvent(f);e.submit()})},clearOrDefaultValue:function(a){a=dojo.byId(a);dojo.connect(a,"onfocus",this,function(b){b=b.srcElement||b.target;if(b.value===b.defaultValue)b.value=""});dojo.connect(a,"onblur",this,function(b){b=b.srcElement||
b.target;if(b.value==="")b.value=b.defaultValue})},clearValue:function(a,b){var c=[],e=dojo.byId(a);if(e===null)throw Error("{dj.util.Form} element not found");var f=dojo.trim(e.value);if(typeof b=="undefined")e.value=" ";else if(dojo.isArray(b))c=b;else c.push(b);for(var g=0,h=c.length;g<h;g++)if(c[g]==f)e.value=""},checkEmpty:function(a){a=dojo.byId(a);if(a===null)throw Error("{dj.util.Form} element not found");return dojo.trim(a.value)===""},validateEmailAddresses:function(a){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(a)},
hasValidContent:function(a,b){if(b!=="")return a.test(b);return false}};
dojo.provide("dj.util.PollingConditionChecker");dojo.declare("dj.util.PollingConditionChecker",[],{check:function(a,b,c,e){var f=new dojo.Deferred,g=0,h;h=function(){if(g>=c)f.errback(e);else if(a())f.callback();else{g++;setTimeout(h,b)}};setTimeout(h,b);return f}});
dojo.provide("dj.util.user.Environment");dojo.declare("dj.util.user.Environment",[],{constructor:function(a,b,c){this.region=a;this.product=b;this.subType=c},toString:function(){return this.region+"_"+this.product+"_"+this.subType}});
dojo.provide("dj.util.Template");dojo.require("trimpath.TrimPath");dj.util.Template={processDOMTemplate:function(a,b){return TrimPath.processDOMTemplate(a,b)},parseTemplate:function(a,b,c){return TrimPath.parseTemplate(a,b,c)}};
dojo.provide("dj.util.Config");dojo.require("dj.util.Observer");
dojo.declare("dj.util.Config",null,{constructor:function(a){this.setOwner(a);this.cfg={};this.obs={};this.hasFired={}},getOwner:function(){return this.owner},setOwner:function(a){this.owner=a},addProperty:function(a,b){a=a.toLowerCase();if(typeof b=="undefined")throw Error("Config {key: '_', value: '_'} must be set for key '"+a+"'.");else if(typeof b.value=="undefined")throw Error("Config value must be defined for key '"+a+"'.");else if(typeof b.handler=="undefined"){this.setProperty(a,b.value,true);
return}var c=new dj.util.Observer,e=this.getOwner();c.subscribe(b.handler,e);this.obs[a]=c;this.setProperty(a,b.value,true)},getProperty:function(a){a=a.toLowerCase();return this.cfg[a]},setProperty:function(a,b,c){a=a.toLowerCase();this.cfg[a]=b;var e=null;if(!c){e=this.obs[a];e.fire(b)}},applyConfig:function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b],true)},fireQueue:function(a){a=typeof a=="undefined"?false:a;var b=null,c;for(c in this.cfg)if(this.cfg.hasOwnProperty(c)){var e=
this.cfg[c];if(!a&&this.hasFired[c])break;b=this.obs[c];if(typeof b=="undefined")break;b.fire(e);this.hasFired[c]=true}}});
dojo.provide("dj.util.History");dojo.require("dj.util.Observer");
dj.util.History=function(){function a(){var h=window.location.hash;if(h.charAt(0)=="#")h=h.substring(1);return dojo.isMozilla?h:decodeURIComponent(h)}function b(h){h||(h="");window.location.hash=encodeURIComponent(h);historyCounter=history.length}function c(){var h=a();g=new dj.util.Observer;e=dojo.queryToObject(h);dojo.back.init();dojo.back.setInitialState({changeUrl:h,back:function(){g.fireByName("_init",null)},forward:function(){g.fireByName("_init",null)}})}var e=null,f=false,g=null;return{init:function(){if(!f){f=
true;c()}},get:function(h){return e[h]},set:function(h,j,k){e[h]=j;var m=dojo.objectToQuery(e);(typeof k==="boolean"?k:false)===false?dojo.back.addToHistory({changeUrl:m,back:function(){g.fireByName(h,j)},forward:function(){g.fireByName(h,j)}}):b(m)},subscribe:function(h,j,k){g.subscribeByName(h,j,k)}}}();
dojo.provide("dj.util.user.EnvironmentDao");dojo.require("dj.util.user.Environment");
dojo.declare("dj.util.user.EnvironmentDao",[],{constructor:function(a,b){this.region=a;this.user=b},getEnvironment:function(){var a=new dojo.Deferred,b=new dj.util.user.Environment;b.region=this.getRegion();this.getProduct().then(dojo.hitch(this,function(c){b.product=c;return this.user.getSubscriptionType()})).then(dojo.hitch(this,function(c){b.subType=c;a.callback(b)}));return a},getRegion:function(){return(this.region.getViewByRegion().split(",")[0]||"NA").toUpperCase()},getProduct:function(){var a=
new dojo.Deferred;this.user.hasRole("WSJ-PRO",dojo.hitch(this,function(b){b?a.callback("PRO"):this.user.hasRole("WSJ-ENT",function(c){c?a.callback("PRO"):a.callback("WSJ")})}));return a}});
dojo.provide("dj.util.io.script");dojo.require("dj.util.string");dojo.require("dj.util.io");
dj.util.io.script={get:function(a){var b=new dojo.Deferred,c="dj.util.io.script._jsonp"+ ++this.__ctr+"._jsonpCallback";a=dojo.mixin({jsonp:"c",jsonpCallback:c,content:{},timeout:5E3},a);var e,f=false;dj.util.string.toFunction(a.jsonpCallback,function(g){f=true;b.callback(g)});a.content[a.jsonp]=a.jsonpCallback;c=dojo.objectToQuery(a.content);e=a.url+"?"+c;dj.util.io.insertScriptAsync(e);setTimeout(function(){f||b.errback("[io.script] url timed out: '"+e+"'")},a.timeout);return b},__ctr:0};
dojo.provide("dj.util.onVisible");dojo.require("dj.util.Element");dojo.require("dojo.window");
dj.util.onVisible={_cfg:{defaultScrollProximity:70,pollingInterval:50},scan:function(){if(!this.__isScanning){this.__isScanning=true;this._getModules();this._initOnScroll()}},addModule:function(a,b){this._getModules().push({query:a,nodeList:dojo.query(a),cb:b})},refreshModules:function(){dojo.forEach(this._getModules(),function(a){var b=dojo.query(a.query);a.nodeList=a.nodeList.concat(b)});this._handleOnScroll()},isInitialized:function(a){if(a==null){console.error("{isInitialized} domNode="+a);return true}return dj.util.Element.getData(a,
"isInitialized")=="true"},markAsInitialized:function(a){if(a==null){console.error("{markAsInitialized} domNode="+a);return true}dj.util.Element.setData(a,"isInitialized","true")},getDatasetFromWidget:function(a){a=dj.util.Element.getDataset(a);delete a.djWidget;return a},_getModules:function(){if(!this.modules)this.modules=[];return this.modules},_initOnScroll:function(){if(!this._onScrollAdded){this._onScrollAdded=true;this._interval=window.setInterval(dojo.hitch(this,this._handleOnScroll),this._cfg.pollingInterval)}if(!this._lastTick)this._lastTick=
(new Date).getTime()-1;if(!this._lastBox){this._lastBox=dojo.window.getBox();this._lastBox.t++}this._canScroll=this._isOnScrollPossible()},_handleOnScroll:function(){var a=dojo.window.getBox(),b=(new Date).getTime();if(!(a.t===this._lastBox.t&&a.h===this._lastBox.h&&b-this._lastTick<1E3)){this._lastTick=b;this._lastBox=a;dojo.forEach(this.modules,function(c){c.nodeList.forEach(function(e){if(!this.isInitialized(e)){var f=this.getDatasetFromWidget(e);if(!this._canScroll||this._isNodeVisible(e,f)){this.markAsInitialized(e);
try{c.cb(e,f)}catch(g){console.error("{util.onVisible} failed to load module: %o, error: %o",e,g)}}}},this)},this)}},_isNodeVisible:function(a,b){var c=dojo.position(a,true);if(!this._isNodeDisplayed(a))return false;var e=(this.getDatasetFromWidget(a)||b).djScrollProximity||this._cfg.defaultScrollProximity;e=new Number(e);var f=dojo.window.getBox();return this._isInProximity(c,f,e)},_isNodeDisplayed:function(a){if(a===null)return true;var b=a.tagName.toLowerCase();if(b==="body")return true;var c=
dojo.style(a,"display");return b=="script"||c!=="none"?this._isNodeDisplayed(a.parentNode):false},_isInProximity:function(a,b,c){var e=b.t-c<a.y+a.h,f=b.t+b.h+c>a.y;return b.t-c>a.y&&b.t+b.h+c<a.y+a.h||e&&f},_isOnScrollPossible:function(){var a=navigator.userAgent.toLowerCase(),b=a.indexOf("iphone")>-1;a=a.indexOf("ipad")>-1;return dojo.isBrowser&&!(b||a)}};
dojo.provide("dj.util.onVisibleWidget");dojo.require("dj.util.onVisible");dojo.require("dj.util.Template");
dj.util.onVisibleWidget={scan:function(){this.onv=dj.util.onVisible;this.onv.addModule("[data-dj-widget=onvisible.module]",dojo.hitch(this,this.loadModule));this.onv.addModule("[data-dj-widget=onvisible.template]",dojo.hitch(this,this.loadTemplate));this.onv.scan()},loadModule:function(a,b){var c=b.djModule,e=b.djModuleInit||"init";console.info("{loadModule} deferred load, module="+c+"."+e);if(c=dojo.getObject(c))if(typeof c[e]==="function"){delete b.djWidget;delete b.djModule;delete b.djModuleInit;
delete b.djScrollProximity;c[e].call(c,b,a)}else throw Error("{_loadModule} data-module-init %s is not a function",e);},loadTemplate:function(a,b){console.info("{loadTemplate} deferred load, template id="+(a.id?a.id:""));delete b.djWidget;this._handleTemplate(a,b);this.onv.refreshModules()},getDatasetFromWidget:function(a){this.onv.getDatasetFromWidget(a)},_handleTemplate:function(a,b){var c=this._getTemplateFromWidget(a);this._renderTemplate(a,c,b)},_getTemplateFromWidget:function(a){var b=dojo.query("textarea",
a)[0];if(!b)throw Error("{util.onVisibleWidget} no template domNode found in %o",a);return this._stripCdataTags(b.value)},_renderTemplate:function(a,b,c){b=dj.util.Template.parseTemplate(b).process(c);a.innerHTML=b},_stripCdataTags:function(a){a=a.replace(/\s*<!\[CDATA\[\s*/,"");return a=a.replace(/\s*\]\]>\s*/,"")}};
dojo.provide("dj.util.liveWidget");dojo.require("dj.lang");dojo.require("dj.util.Element");
dj.util.liveWidget={register:function(a,b,c){if(typeof a!=="string"||!a||typeof b!=="function")throw Error("{liveWidget.register} widgetName must be a non-empty string, and callback -- a function");var e=this;this._widgetEvents[a]=dj.lang.addLiveEvent("div[data-dj-live-widget="+a+"]","click",function(f){if(!e._isInitialized(this)){e._markAsInitialized(this);var g=dj.util.Element.getDataset(this);delete g.djLiveWidget;f={domNode:this,event:f};try{b.call(c,f,g)}catch(h){console.error("{liveWidget} '%s': %o threw: %o",
a,this,h.message)}}})},unregister:function(a){if(typeof a!=="string"||!a)throw Error("{liveWidget.unregister} widgetName must be a non-empty string");(a=this._widgetEvents[a])&&dj.lang.removeLiveEvent(a)},_isInitialized:function(a){return dj.util.Element.getData(a,"isInitialized")=="true"},_markAsInitialized:function(a){dj.util.Element.setData(a,"isInitialized","true")},_widgetEvents:[]};
dojo.provide("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.dao.FileServiceDao",[],{DEFAULT_CONFIG:{TTL:"24h"},constructor:function(a,b,c){this.script=a;this.coreContext=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c)},getFragment:function(a){if(!a||!a.id)throw Error("FileServiceDao: fragment must have an id");this._useDataId(a.id);var b=new dojo.Deferred,c;c=a.getAbsolutePaths();c=this.script.get({url:this._getFileServiceUrl(),content:{absolutePath:c,TTL:this.cfg.TTL},jsonp:"c",jsonpCallback:"dj.module._fileServiceDao."+
a.id,timeout:25E3});c.addCallback(this,function(d){var e,f,g;f=0;for(g=d.files.length;f<g;f++){e=d.files[f];if(e.statusCode!==200){b.errback(Error("FileServiceDao: unsuccessful status code: "+e.statusCode+" for url: "+e.absolutePath));return}}b.callback(this._populateFragmentWithFiles(a,d.files))});c.addErrback(function(d){b.errback(Error("FileServiceDao: service error: "+d))});return b},__dataIds:{},_useDataId:function(a){this.__dataIds[a]=true},_getFileServiceUrl:function(){return this.coreContext.customCacheCdnPrefix+
"/cdssvco/file/v2/Files"},_populateFragmentWithFiles:function(a,b){if(dojo.isArray(a.cssFiles))for(var c=0,d=a.cssFiles.length;c<d;c++){var e=a.cssFiles[c];e.data=this._getDataByPath(b,e.absolutePath)}if(a.jsFile)a.jsFile.data=this._getDataByPath(b,a.jsFile.absolutePath);if(a.htmlFile)a.htmlFile.data=this._getDataByPath(b,a.htmlFile.absolutePath);if(a.jsonFile)a.jsonFile.data=this._getDataByPath(b,a.jsonFile.absolutePath);return a},_getDataByPath:function(a,b){var c,d,e;c=0;for(d=a.length;c<d;c++){e=
a[c];if(e.absolutePath===b)return e.data}throw"FileServiceDao: path is not in the files";}});
dojo.provide("dj.widget.fragmentloader.File");dojo.declare("dj.widget.fragmentloader.File",[],{constructor:function(a,b){this.absolutePath=a;this.data=b}});
dojo.provide("dj.widget.fragmentloader.Fragment");dojo.declare("dj.widget.fragmentloader.Fragment",[],{constructor:function(a,b,c,d){this.id=a;this.cssFiles=b;this.jsFile=c;this.htmlFile=d},getAbsolutePaths:function(){var a=[],b,c;if(dojo.isArray(this.cssFiles)){b=0;for(c=this.cssFiles.length;b<c;b++)a.push(this.cssFiles[b].absolutePath)}this.jsFile&&a.push(this.jsFile.absolutePath);this.htmlFile&&a.push(this.htmlFile.absolutePath);return a}});
dojo.provide("dj.widget.fragmentloader.JSONFragment");dojo.declare("dj.widget.fragmentloader.JSONFragment",[],{constructor:function(a){this.jsonFile=a;this.id="x"},getAbsolutePaths:function(){var a=[];this.jsonFile&&a.push(this.jsonFile.absolutePath);return a}});
dojo.provide("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.util.string");
dojo.declare("dj.widget.fragmentloader.renderer.FileRenderer",[],{constructor:function(a,b){this.animation=a;this.checker=b},renderCss:function(a){var b,c,d,e,f=dojo.doc.head||dojo.query("head")[0];b=0;for(c=a.length;b<c;b++){e=a[b];d=dojo.create("style",{type:"text/css","data-absolutePath":e.absolutePath});cssStr=e.data;if(d.styleSheet)d.styleSheet.cssText=cssStr;else d.appendChild(dojo.doc.createTextNode(cssStr));dojo.place(d,f,"last")}},renderHtml:function(a,b,c){c=typeof c=="undefined"?true:c;
var d=new this.checker.check(function(){return dojo.byId(b)},25,40,"Retriever: exceded num of retries for HTML");if(c)return dojo.when(d,dojo.hitch(this.animation,"crossFadeInsert",a.data,b));else{dojo.place(a.data,b,"only");def=new dojo.Deferred;def.resolve();return def}},renderJs:function(a){var b=dojo.create("script",{type:"text/javascript"});if(dojo.isIE)b.text=a.data;else b.appendChild(dojo.doc.createTextNode(a.data));a=dojo.doc.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)},
renderInlineJs:function(a){dj.util.string.evalScripts(a.data,a.absolutePath)}});
dojo.provide("dj.widget.fragmentloader.bo.FragmentBo");dojo.require("dj.widget.fragmentloader.File");dojo.require("dj.widget.fragmentloader.Fragment");
dojo.declare("dj.widget.fragmentloader.bo.FragmentBo",[],{DEFAULT_CONFIG:{js:{providedUnits:"j_global_slim"},css:{},html:{}},constructor:function(a,b,c){this.dao=a;this.userEnv=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c);this.assetPaths=dj.context.core.assetPaths},getFragment:function(a,b){return dojo.when(this.userEnv,dojo.hitch(this,function(c){var d="fragment_"+c.toString()+"_"+a;d=new dj.widget.fragmentloader.Fragment(d);d.cssFiles=this.cfg.isLoadCss?this._getCssFiles(c,a,b):undefined;d.jsFile=
this.cfg.isLoadJs?this._getJsFile(c,a,b):undefined;d.htmlFile=this.cfg.isLoadHtml?this._getHtmlFile(c,a,b):undefined;return this.dao.getFragment(d)}))},_getCssFiles:function(a,b,c){var d=this._getCssFileList(dojo.isIE),e=Array(d.length);i=0;for(len=d.length;i<len;i++)e[i]=new dj.widget.fragmentloader.File(this.assetPaths.style+"/"+d[i]+"/"+a+"/"+b+"-"+c+".css");return e},_getJsFile:function(a,b,c){return new dj.widget.fragmentloader.File(this.assetPaths.script+"/bucket/"+a+"/page/"+b+"/provided/"+
this.cfg.js.providedUnits+"/version/"+c+".js")},_getHtmlFile:function(a,b,c){var d=this._getHtmlChipStr();return new dj.widget.fragmentloader.File("/public"+this.assetPaths.page+"/"+a+":"+b+"-"+d+c+".html")},_getHtmlChipStr:function(){return dojo.isArray(this.cfg.html.chips)?this.cfg.html.chips.join("-")+"-":""},_getCssFileList:function(a){var b=["2/std","3/std","4/std"];if(typeof a!=="undefined")if(a<7)b.push("1/ie6");else if(a==7)b.push("1/ie7");else if(a==8)b.push("1/ie8");else a==9&&b.push("1/ie9");
return b}});
dojo.provide("dj.widget.fragmentloader.bo.FragmentJSONBo");dojo.require("dj.widget.fragmentloader.File");dojo.require("dj.widget.fragmentloader.JSONFragment");
dojo.declare("dj.widget.fragmentloader.bo.FragmentJSONBo",dj.widget.fragmentloader.bo.FragmentBo,{DEFAULT_CONFIG:{},constructor:function(a,b,c){this.dao=a;this.userEnv=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c)},getFragment:function(a,b){return dojo.when(this.userEnv,dojo.hitch(this,function(c){frag=new dj.widget.fragmentloader.JSONFragment;frag.jsonFile=this.cfg.isLoadJson?this._getJsonFile(c,b):undefined;return this.dao.getFragment(frag)}))},_getJsonFile:function(a,b){var c=a;c+=a.indexOf("?")==
-1?"?v="+b:"&v="+b;return new dj.widget.fragmentloader.File(c)}});
dojo.provide("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.PollingConditionChecker");dojo.require("dj.util.animation");dojo.require("dj.util.io.script");dojo.require("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.widget.fragmentloader.bo.FragmentBo");dojo.require("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.FragmentLoader",[],{DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,isLoadInlineJs:false,isDataCallback:false,isAnimated:true},constructor:function(a,b,c,d,e){this.userEnv=a;this.mstPageId=b;this.domNodeId=d;this.version=c;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,e);this._initRenderers()},load:function(){return dojo.when(this.fragmentBo.getFragment(this.mstPageId,this.version),dojo.hitch(this,function(a){this.cfg.isDataCallback&&this.onDataCallback(a);
if(this.cfg.isLoadCss){this.fileRenderer.renderCss(a.cssFiles);this.onCssLoad()}if(this.cfg.isLoadHtml)this.fileRenderer.renderHtml(a.htmlFile,this.domNodeId,this.cfg.isAnimated).then(dojo.hitch(this,function(){this.onHtmlLoad();if(this.cfg.isLoadJs){this.fileRenderer.renderJs(a.jsFile);this.onJsLoad()}if(this.cfg.isLoadInlineJs){this.fileRenderer.renderInlineJs(a.htmlFile);this.onInlineJsLoad()}}));else if(this.cfg.isLoadJs){this.fileRenderer.renderJs(a.jsFile);this.onJsLoad()}}))},onCssLoad:function(){},
onJsLoad:function(){},onHtmlLoad:function(){},onInlineJsLoad:function(){},onDataCallback:function(){},_initRenderers:function(){var a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,dj.context.core),b=new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentBo(a,this.userEnv,this.cfg);this.fileRenderer=new dj.widget.fragmentloader.renderer.FileRenderer(dj.util.animation,b)}});
dojo.provide("dj.widget.fragmentloader.FragmentJSONLoader");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.PollingConditionChecker");dojo.require("dj.util.animation");dojo.require("dj.util.io.script");dojo.require("dj.widget.fragmentloader.renderer.FileRenderer");dojo.require("dj.widget.fragmentloader.bo.FragmentJSONBo");dojo.require("dj.widget.fragmentloader.dao.FileServiceDao");
dojo.declare("dj.widget.fragmentloader.FragmentJSONLoader",dj.widget.fragmentloader.FragmentLoader,{DEFAULT_CONFIG:{isLoadJson:true,TTL:"24h"},constructor:function(a,b,c){this.url=a;this.version=b;this.cfg=dojo.delegate(this.DEFAULT_CONFIG,c);this._initRenderers()},load:function(){return dojo.when(this.fragmentBo.getFragment(this.mstPageId,this.version),dojo.hitch(this,function(a){this.cfg.isLoadJson&&this.onLoadJson(a)}))},onLoadJson:function(){},_initRenderers:function(){var a=dojo.clone(dj.context.core);
a.customCacheCdnPrefix=dj.context.core.cdnPrefix;a=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,a,this.cfg);new dj.util.PollingConditionChecker;this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentJSONBo(a,this.url,this.cfg)}});

dojo.provide("dj.util.bluegrass");dj.util.bluegrass=function(){var Connection=function(runtime,endpoint,callback){var _runtime=runtime;var _endpoint=endpoint;var _callbacks=[];_callbacks.push(callback);var _channels={};var _impl=null;var _reconnectTimer=null;var thunk=this;var _callback=function(connection,type){dojo.forEach(_callbacks,function(callbck){try{callbck(connection,type);}
catch(err){if(typeof(console)!="undefined"&&console.warn)
{console.warn("Error in connection callback: "+err.message);}}});};var _channelTrigger=function(message,channel){if(message.h.a=="unsubscribe"){if(_channels[channel.getChannelName()]!==null)
{delete _channels[channel.getChannelName()];}}
_impl.send(message);};var _systemCallback=function(message){if(message.h.a==="process"&&message.b){if(message.b.reconnect&&_reconnectTimer===null){_impl.setPickupInterval(5000);_reconnectTimer=setTimeout(function(){_reconnect();},2000);}
else if(message.b.pickupInterval&&_impl!==null){_impl.setPickupInterval(message.b.pickupInterval);}
else if(message.b.channelState){_setChannelState(message.b.channelState);}}
else if(message.h.a==="inform"){if(message.h.t==="/system/channelinfo"){_setChannelInfo(message.b);}}};var _reconnect=function(){var channels=[];try{for(var channelKey in _channels){if(channelKey)
{var tempChannel=_channels[channelKey];if(tempChannel)
{tempChannel.clearTimers();channels.push({c:tempChannel.getChannelName(),b:tempChannel.getCallbacks(),n:tempChannel.getLastMessageNumber()});}}}}
catch(e){}
_channels={};var type="reconnect";if(!_impl||!_impl.isOpen()){type="connect";}
var callback=function(){_callback(thunk,type);dojo.forEach(channels,function(channel){channel=thunk.subscribe(channel.c,channel.b[0],{sequence:null,number:channel.n});if(typeof channel.b!=='undefined'&&channel.b.length>1){for(var i=1;i<channel.b.length;i++){channel.addCallback(channel.b[i]);}}});};_implInitialize(callback);_reconnectTimer=null;};var _setChannelInfo=function(channelInfo){if(channelInfo&&channelInfo.channelName){var tempChannel=_channels[channelInfo.channelName];if(tempChannel){if(tempChannel.getChannelName()==channelInfo.channelName){if(channelInfo.deliveryType){tempChannel.setDeliveryType(channelInfo.deliveryType);}}}}};var _setChannelState=function(channelState){var channel=_channels[channelState.channelName];if(channel!==null){if(!channelState.enabled){channel.resetState();}}};var _implInitialize=function(callback){_implTerminate();var connectCallback=function(){_callback(thunk,"connect");};if(callback){connectCallback=callback;}
_impl=new ConnectionImpl(connectCallback,function(message){_systemCallback(message);});_impl.initialize(_endpoint,function(impl,messages){_implCallback(impl,messages);});};var _implTerminate=function(){if(_impl!==null){_impl.terminate();_impl=null;}};var _implCallback=function(impl,messages){if(impl!=_impl){impl.terminate();return;}
if(!messages){return;}
for(var i=0;i<messages.length;i++){var mess=messages[i];var channel=_channels[mess.h.t];if(channel){channel.deliver(mess);}}};this.subscribe=function(channelName,callback,options){var channel;if(_channels[channelName]===null||typeof(_channels[channelName])==='undefined'){channel=new Channel(channelName,callback,options,_channelTrigger);_channels[channelName]=channel;}
else{channel=_channels[channelName];channel.addCallback(callback);}
return channel;};this.unsubscribe=function(channelName,callback,options){var channel;if(_channels[channelName]!==null||typeof(_channels[channelName])!=='undefined'){console.log(channelName);channel=_channels[channelName];channel.removeCallback(callback);channel.unsubscribe();}
return channel;};this.getChannel=function(channelName){return _channels[channelName];};this.close=function(){_callbacks=[];_channels={};_implTerminate();};this.reconnect=function(){if(_reconnectTimer===null){_reconnectTimer=setTimeout(function(){_reconnect();},100);}};this.isOpen=function(){if(_impl!==null){return _impl.isOpen();}
else{return false;}};this.isDisabled=function(){if(_impl!==null){return _impl.isDisabled();}
else{return false;}};this.addCallback=function(callback){_callbacks.push(callback);};this.setTransmitHook=function(hook){_impl.setTransmitHook(hook);};this.setReceiveHook=function(hook){_impl.setReceiveHook(hook);};this.scrambleClientId=function(){_impl.scrambleClientId();};this.getChannelCount=function(){var size=0;for(var key in _channels){if(_channels.hasOwnProperty(key)){size++;}}
return size;};_implInitialize();};var ConnectionImpl=(function(){return function(connectCallback,systemCallback){var _callback,_endpoint;var _clientInfo,_protocolInfo;var _transmitHookCallback=null;var _receiveHookCallback=null;var _outgoing=[];var _connectFailCount=0;var _failCount=0;var _inProgress=0;var _timer,_connectTimer;var _isOpen=false,_isDisabled=false;var _sendTimer=null;var _connectCallback=connectCallback;var _systemCallback=systemCallback;var thunk=this;var _pumpMessages=function(){if(!_isOpen){return;}
_sendTimer=null;var shouldSend=false;if(_inProgress<1){shouldSend=true;}
else if(_inProgress<2&&_outgoing.length>0){shouldSend=true;}
if(shouldSend){var immediate=_outgoing.length>0;for(var i=0,l=_outgoing.length;i<l;i++){var o=_outgoing[i];if(o.b&&('0'===o.b.number)&&(''===o.b.sequence)){delete o.b;}}
var payload={c:dojo.toJson(_clientInfo),m:dojo.toJson(_outgoing.splice(0,15))};if(typeof(_protocolInfo.pickupInterval)==='number'&&_protocolInfo.pickupInterval>0&&_failCount===0&&!immediate){_timer=setTimeout(function(){_messageRequest(payload);},_protocolInfo.pickupInterval);}
else if(_failCount>0){_timer=setTimeout(function(){_messageRequest(payload);},1000*Math.min(900,Math.pow(2,_failCount)));}
else{clearTimeout(_timer);_messageRequest(payload);if(_outgoing.length>0){_sendTimer=setTimeout(_pumpMessages,100);}}}};var _connectFail=function(xhr,status,error,message){_connectFailCount++;_connectTimer=setTimeout(function(){_connectRequest();},1000*Math.min(900,Math.pow(2,_connectFailCount)));};var _connectResponse=function(request,response){_clientInfo=response.clientInfo;_protocolInfo=response.protocolInfo;_inProgress=0;if(response.status.disabled){_isOpen=false;_isDisabled=true;}
else{_isOpen=true;_pumpMessages();if(dojo.isFunction(_connectCallback)){_connectCallback();}}};var _connectRequest=function(){var url=_endpoint.to;if(_endpoint.via){url=_endpoint.via+"?to="+url;}
dojo.xhrGet({url:url,preventCache:true,failOk:true,headers:{"X-Requested-With":""},handleAs:"json",load:function(responseObject,xhr){_connectResponse(xhr,responseObject);},error:function(error,ioArgs){_connectFail(ioArgs,ioArgs.xhr.status,error,request);}});};var _messageRequest=function(request){var url=_protocolInfo.pickupUrl;var currentDomain='http://'+document.location.toString().split(/\/+/g)[1];if(_endpoint.altPickupUrl){url=_endpoint.altPickupUrl;}else if(_endpoint.via){url=_endpoint.via+"?to="+url;}else{var tmpUrl=url;if(tmpUrl.indexOf("com")!==-1){tmpUrl=tmpUrl.substring(tmpUrl.indexOf("com")+3,tmpUrl.length);url=currentDomain+tmpUrl;}
else{url=tmpUrl.replace(tmpUrl.split(/\/+/g)[1],document.location.toString().split(/\/+/g)[1]);}}
_inProgress++;if(_transmitHookCallback!==null){dojo.forEach(eval(request.m),function(rm){_transmitHookCallback(rm,_clientInfo);});}
dojo.xhrGet({url:url,content:request,preventCache:true,failOk:true,headers:{"X-Requested-With":""},handleAs:"json",load:function(responseObject,xhr){_messageResponse(responseObject);},error:function(error,ioArgs){_messageFail(ioArgs,ioArgs.xhr.status,error,request);}});};var _messageResponse=function(response){_inProgress--;_failCount=0;if(response!==null&&response.length>0){if(_receiveHookCallback!==null){dojo.forEach(response,function(res){_receiveHookCallback(res);});}
dojo.forEach(response,function(res){if(res.h&&res.h.t&&res.h.t.indexOf("\/system\/")===0){_systemCallback(res);}});}
_callback(thunk,response);_pumpMessages();};var _messageFail=function(xhr,status,error,message){_inProgress--;_failCount++;var originalMessage=unescape(message.data);originalMessage="{\""+originalMessage.replace(new RegExp("\\+","g"),"").replace(new RegExp("=","g"),"\":").replace(new RegExp("&amp;","g"),",\"")+"}";var messageData=dojo.toJson(originalMessage);if(messageData&&messageData.m&&messageData.m.length>0){for(var i=0;i<messageData.m.length;i++){_outgoing.push(messageData.m[i]);}}
_pumpMessages();};this.initialize=function(endpoint,callback){_endpoint=endpoint;_callback=callback;_connectRequest();};this.terminate=function(){_isOpen=false;if(_timer){clearInterval(_timer);}
if(_connectTimer)
{clearInterval(_connectTimer);}};this.setPickupInterval=function(interval){_protocolInfo.pickupInterval=interval;};this.scrambleClientId=function(){_clientInfo.c="Boom!";};this.setTransmitHook=function(hook){_transmitHookCallback=hook;};this.setReceiveHook=function(hook){_receiveHookCallback=hook;};this.send=function(messages){if(!_isOpen){return;}
_outgoing.splice(_outgoing.length,0,messages);if(_sendTimer===null){_sendTimer=setTimeout(_pumpMessages,100);}};this.isOpen=function(){return _isOpen;};this.isDisabled=function(){return _isDisabled;};};})();var Channel=function(channelName,callback,options,trigger){var _channelName=channelName;var _callbacks=[];var _currentSequence="";var _firstMessageNumber="0";var _trigger=trigger;_callbacks.push(callback);var _callback=function(message){for(var i=0;i<_callbacks.length;i++){try{var callbck=_callbacks[i];callbck(message);}
catch(err){if(typeof(console)!="undefined"&&console.warn)
{console.warn("Error delivering message on \""+_channelName+"\": "+err.message);}}}};var _deliveryType="";if(options&&options.sequence)
{_currentSequence=options.sequence;}
if(options&&options.number)
{_firstMessageNumber=options.number;}
var _lastMessageNumber=_firstMessageNumber;var _ackTimer=null;var _acksSent=0;var _bypassQueue=[];var _bypassTimer=null;if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"subscribe"},b:{sequence:_currentSequence,number:_firstMessageNumber}};_trigger(message,this);}
var thunk=this;var _scanBypassQueue=function(){if(_bypassQueue&&_bypassQueue.length>0){_bypassQueue.sort(function(a,b){return a.h.n-b.h.n;});var index=0;for(var i=0;i<_bypassQueue.length;i++){var bypassQ=_bypassQueue[i];if(bypassQ.h.n==_lastMessageNumber+1){_callback(bypassQ);_lastMessageNumber=bypassQ.h.n;index=i+1;}
else{break;}}
if(_bypassQueue.length>index)
{_bypassQueue=_bypassQueue.slice(index);}
else{_bypassQueue=[];}
if(_bypassQueue.length>0){_bypassTimer=setTimeout(function(){_scanBypassQueue();},1000);}
else{clearTimeout(_ackTimer);_bypassTimer=null;_acksSent=0;_bypassQueue=[];}}};var _sendAck=function(){if(_acksSent>=10){_ackTimer=setTimeout(function(){thunk.unsubscribe();},1000);return;}
var numbers=1+"-"+_lastMessageNumber;var numbersInQueue="";var last=0;var next="";_bypassQueue.sort(function(a,b){return a.h.n-b.h.n;});if(typeof(_bypassQueue!='undefined')){for(var i=0;i<_bypassQueue.length;i++){var m=_bypassQueue[i];if(last===0){numbersInQueue=m.h.n;}
else if(m.h.n==last+1){next="-"+m.h.n;}
else{if(next.length>0){numbersInQueue+=next+","+m.h.n;next="";}
else{numbersInQueue+=","+m.h.n;}}
last=m.h.n;}
numbersInQueue+=next;}
if(numbersInQueue.length>0||numbersInQueue>0)
{numbers+=","+numbersInQueue;}
if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"acknowledge"},b:{sequence:_currentSequence,numbers:numbers}};_trigger(message,thunk);}
_acksSent++;_ackTimer=setTimeout(function(){_sendAck();},1000*Math.min(32,Math.pow(2,_acksSent)));};this.getChannelName=function(){return _channelName;};this.getDeliveryType=function(){return _deliveryType;};this.setDeliveryType=function(deliveryType){_deliveryType=deliveryType;};this.getCallbacks=function(){return _callbacks;};this.clearTimers=function(){if(_ackTimer)
{clearTimeout(_ackTimer);}
if(_bypassTimer)
{clearTimeout(_bypassTimer);}};this.unsubscribe=function(){if(dojo.isFunction(_trigger)){var message={h:{t:_channelName,a:"unsubscribe"}};_trigger(message,this);}};this.deliver=function(message){if(_callback&&message&&message.h&&(message.h.t==_channelName)){if(message.h.a=="retransmit"){var inQueue=false;for(var i=0;i<_bypassQueue.length;i++){var bpQueue=_bypassQueue[i];if(bpQueue.h.n==message.h.n){inQueue=true;break;}}
if(!inQueue){_bypassQueue.push(message);}
if(_bypassTimer===null){_bypassTimer=setTimeout(function(){_scanBypassQueue();},1000);}}
else if(message.h.a=="broadcast"){if(message.h.s!=_currentSequence){_currentSequence=message.h.s;_firstMessageNumber=message.h.n;_bypassQueue=[];clearTimeout(_ackTimer);_acksSent=0;}
var messageOk=false;if((_deliveryType=="Lossy"&&message.h.n>_lastMessageNumber)||_deliveryType=="BestEffort"){messageOk=true;}
else if(_deliveryType=="Guaranteed"){if(_lastMessageNumber+1==message.h.n||message.h.n==_firstMessageNumber){messageOk=true;}
else{var count=_bypassQueue.push(message);if(count==1){_ackTimer=setTimeout(function(){_sendAck();},1000);}
else if(count>=50){this.resetState();this.deliver(message);}}}
if(messageOk){_lastMessageNumber=message.h.n;_callback(message,_channelName);}}}};this.resetState=function(){_currentSequence="";_bypassQueue=[];clearTimeout(_ackTimer);_acksSent=0;};this.addCallback=function(callback){if(dojo.indexOf(_callbacks,callback)==-1){_callbacks.push(callback);}};this.removeCallback=function(callback){var index=-1;if(_callbacks.length==1&&_callbacks[0]==callback){this.unsubscribe();return;}
for(var i=0;i<_callbacks.length;i++){var callBck=_callbacks[i];if(callBck==callback){index=i;}}
if(index>=0){_callbacks=BlueGrass.Utility.arrayRemove(_callbacks,index);}};this.getLastMessageNumber=function(){return _lastMessageNumber;};};var _connection=null;var _userOffset=new Date().getTimezoneOffset()/60;var _reconTimer=null;var _isConnecting=false;return{Runtime:{openConnection:function(endpoint,callback){if(!endpoint)
{endpoint={to:"/bg/api/Connect.ashx"};}
else if(!endpoint.to)
{endpoint.to="/bg/api/Connect.ashx";}
if((document.domain=="localhost"||document.domain=="localhost.marketwatch.com")&&typeof(_bgProxyUrl)!="undefined"){endpoint.via=_bgProxyUrl;if(endpoint.to.substr(0,5)!="http:")
{endpoint.to="http://mw5.marketwatch.com"+endpoint.to;}}
if(_connection===null){if(_isConnecting){setTimeout(function(){BlueGrass.Runtime.openConnection(endpoint,callback);},100);}
else{_isConnecting=true;_connection=new Connection(this,endpoint,callback);var checkConn=function(){if(_connection.isOpen())
{_isConnecting=false;}
else
{setTimeout(checkConn,1000);}};checkConn();}}
else{_connection.addCallback(callback);if(_connection.isOpen()){callback(_connection,"connect");}
else if(!_isConnecting){if(_reconTimer===null){_reconTimer=setTimeout(function(){if(!_connection.isOpen()&&!_connection.isDisabled())
{_connection.reconnect();}
_reconTimer=null;},1000);}}}},getConnection:function(){return _connection;}},Utility:{arrayRemove:function(array,from,to){var rest=array.slice((to||from)+1||array.length);array.length=from<0?array.length+from:from;return array.push.apply(array,rest);},convertToExchangeTime:function(utcDateString,offset){if(!utcDateString){return;}
if(typeof(offset)!='undefined'){offset=offset+_userOffset;}else{offset=0;}
var converted=parseInt(utcDateString,10);if(isNaN(converted)){if(utcDateString.indexOf("-")>=0||utcDateString.indexOf("+")>=0){utcDateString=utcDateString.substring(6,utcDateString.length-7);}
else{utcDateString=utcDateString.substring(6,utcDateString.length-2);}
converted=parseInt(utcDateString,10);}
converted+=3600000*offset;var dateTime=new Date(converted);return dateTime;},prettyDate:function(date,offset){if(typeof(date)!="object"){date=this.convertToExchangeTime(date,offset);}
var time_formats=[[60,'Just Now'],[90,'1 Minute'],[3600,'Minutes',60],[5400,'1 Hour'],[86400,'Hours',3600],[129600,'1 Day'],[604800,'Days',86400],[907200,'1 Week'],[2628000,'Weeks',604800],[3942000,'1 Month'],[31536000,'Months',2628000],[47304000,'1 Year'],[3153600000,'Years',31536000],[4730400000,'1 Century']];var dt=new Date(),seconds=(dt-date)/1000,token=' Ago',format;if(seconds<0){seconds=Math.abs(seconds);token='';}
for(var i=0,l=time_formats.length;i<l;i++){format=time_formats[i];if(seconds<format[0]){if(format.length==2){return format[1]+(i>1?token:'');}else{return Math.round(seconds/format[2])+' '+format[1]+(i>1?token:'');}}}
if(seconds>4730400000){return Math.round(seconds/4730400000)+' Centuries'+token;}
return date;}}};}();
dojo.provide("dj.service.livenews.BluegrassProvider");dojo.require("dj.lang");dojo.require("dj.util.bluegrass");dojo.declare("dj.service.livenews.BluegrassProvider",null,{channels:[],_cfg:{},DEFAULT_CONFIG:{toURL:'/bg/api/connect.ashx',viaURL:null},constructor:function(cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);},subscribeToChannel:function(channel,theView,option){this.channels.push({channelName:channel,view:theView,options:option});},subscribeToChannels:function(channels,theView,option){var that=this;dojo.forEach(channels,function(channel){that.subscribeToChannel(channel,theView,option);});},connectCallback:function(backendConnection,type){if(type=="connect"){connection=backendConnection;var channelsArray=this.channelList;dojo.forEach(channelsArray,function(channel){if(typeof channel.view.render=="function"){var callback=dojo.hitch(channel.view,channel.view.render);channel=connection.subscribe(channel.channelName,callback,channel.options);}else{console.log("View object for channel %s does not have a render method",channelName);}});}},connect:function(){var channelObject={channelList:this.channels};var callback=dojo.hitch(channelObject,this.connectCallback);dj.util.bluegrass.Runtime.openConnection({to:'/bg/api/connect.ashx',via:this._cfg.viaURL},callback);}});
dojo.provide("dj.widget.Slider");dojo.declare("dj.widget.Slider",null,{constructor:function(handle,track,options){this._eventConnectHandles=[];var slider=this;if(dojo.isArray(handle)){this.handles=[];for(var count=0,max=handle.length;count<max;count++){this.handles.push(dojo.byId(handle[count]));}}else{this.handles=[dojo.byId(handle)];}
this.track=dojo.byId(track);this.options=options||{};this.axis=this.options.axis||'horizontal';this.increment=this.options.increment||1;this.step=parseInt(this.options.step||'1',10);this.range=this.options.range||{start:0,end:1};this.value=0;this.values=[];dojo.forEach(this.handles,dojo.hitch(this,function(){this.values.push(0);}));this.spans=this.options.spans?dojo.forEach(this.options.spans,function(s){return dojo.byId(s);}):false;this.options.startSpan=dojo.byId(this.options.startSpan||null);this.options.endSpan=dojo.byId(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||'0',10);this.alignY=parseInt(this.options.alignY||'0',10);this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!==0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!==0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled();}
this.allowedValues=this.options.values?this.options.values.sort():false;if(this.allowedValues){this.minimum=(this.allowedValues.length>0)?this.allowedValues[0]:0;this.maximum=(this.allowedValues.length>0)?this.allowedValues[this.allowedValues.length-1]:0;}
this.eventMouseDown=dojo.hitch(this,this.startDrag);this.eventMouseUp=dojo.hitch(this,this.endDrag);this.eventMouseMove=dojo.hitch(this,this.update);dojo.forEach(this.handles,function(h,i){i=slider.handles.length-1-i;slider.setValue(parseFloat((dojo.isArray(slider.options.sliderValue)?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i);if(h.style.position&&h.style.position==='static'){h.style.position='relative';if(dojo.isOpera){h.style.top=0;h.style.left=0;}}
slider._eventConnectHandles.push(dojo.connect(h,'onmousedown',slider.eventMouseDown));});this._eventConnectHandles.push(dojo.connect(this.track,'onmousedown',this.eventMouseDown));this._eventConnectHandles.push(dojo.connect(document,'onmouseup',this.eventMouseUp));this._eventConnectHandles.push(dojo.connect(document,'onmousemove',this.eventMouseMove));this.initialized=true;},dispose:function(){dojo.forEach(this._eventConnectHandles,dojo.disconnect);},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(value){if(this.allowedValues){var max=(this.allowedValues.length>0)?this.allowedValues[this.allowedValues.length-1]:0;if(value>=max){return(max);}
var min=(this.allowedValues.length>0)?this.allowedValues[0]:0;if(value<=min){return(min);}
var offset=Math.abs(this.allowedValues[0]-value);var newValue=this.allowedValues[0];dojo.forEach(this.allowedValues,function(v){var currentOffset=Math.abs(v-value);if(currentOffset<=offset){newValue=v;offset=currentOffset;}});return newValue;}
if(value>this.range.end){return this.range.end;}
if(value<this.range.start){return this.range.start;}
return value;},setValue:function(sliderValue,handleIdx){if(!this.active){this.activeHandleIdx=handleIdx||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}
handleIdx=handleIdx||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((handleIdx>0)&&(sliderValue<this.values[handleIdx-1])){sliderValue=this.values[handleIdx-1];}
if((handleIdx<(this.handles.length-1))&&(sliderValue>this.values[handleIdx+1])){sliderValue=this.values[handleIdx+1];}}
sliderValue=this.getNearestValue(sliderValue);this.values[handleIdx]=sliderValue;this.value=this.values[0];this.handles[handleIdx].style[this.isVertical()?'top':'left']=this.translateToPx(sliderValue);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished();}},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0);},translateToPx:function(value){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(value-this.range.start))+"px";},translateToValue:function(offset){return((offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(range){var v=this.values.sort();range=range||0;return{start:v[range],end:v[range+1]};},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!==0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!==0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return(this.axis=='vertical');},drawSpans:function(){var slider=this;if(this.spans){for(var count=0,max=this.spans.length-1;count<=max;count++){slider.setSpan(slider.spans[count],slider.getRange(count));}}
if(this.options.startSpan){this.setSpan(this.options.startSpan,{start:0,end:this.values.length>1?this.getRange(0).start:this.value});}
if(this.options.endSpan){this.setSpan(this.options.endSpan,{start:this.values.length>1?this.getRange(this.spans.length-1).end:this.value,end:this.maximum});}},setSpan:function(span,range){if(this.isVertical()){span.style.top=this.translateToPx(range.start);span.style.height=this.translateToPx(range.end-range.start+this.range.start);}else{span.style.left=this.translateToPx(range.start);span.style.width=this.translateToPx(range.end-range.start+this.range.start);}},updateStyles:function(){dojo.forEach(this.handles,function(h){dojo.removeClass(h,'selected');});dojo.addClass(this.activeHandle,'selected');},startDrag:function(event){if(dojo.mouseButtons.isLeft(event)){if(!this.disabled){this.active=true;var handle=event.target;var pointer=[event.clientX,event.clientY];var track=handle;if(track==this.track){var trackPosition=dojo.position(this.track);this.event=event;this.setValue(this.translateToValue((this.isVertical()?pointer[1]-trackPosition.y:pointer[0]-trackPosition.x)-(this.handleLength/2)));var handlePosition=dojo.position(this.activeHandle);this.offsetX=(pointer[0]-handlePosition.x);this.offsetY=(pointer[1]-handlePosition.y);}else{while((dojo.indexOf(this.handles,handle)==-1)&&handle.parentNode){handle=handle.parentNode;}
if(dojo.indexOf(this.handles,handle)!=-1){this.activeHandle=handle;this.activeHandleIdx=dojo.indexOf(this.handles,this.activeHandle);this.updateStyles();var activeHandlePosition=dojo.position(this.activeHandle);this.offsetX=(pointer[0]-activeHandlePosition.x);this.offsetY=(pointer[1]-activeHandlePosition.y);}}}
dojo.stopEvent(event);}},update:function(event){if(this.active){if(!this.dragging){this.dragging=true;}
this.draw(event);if(dojo.isWebKit){window.scrollBy(0,0);}
dojo.stopEvent(event);}},draw:function(event){var pointer=[event.clientX,event.clientY];var trackPosition=dojo.position(this.track);pointer[0]-=this.offsetX+trackPosition.x;pointer[1]-=this.offsetY+trackPosition.y;this.event=event;this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this);}},endDrag:function(event){if(this.active&&this.dragging){this.finishDrag(event,true);dojo.stopEvent(event);}
this.active=false;this.dragging=false;},finishDrag:function(event,success){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this);}
this.event=null;}});
dojo.provide("dj.widget.panels.PanelDTO");dojo.declare("dj.widget.panels.PanelDTO",null,{constructor:function(id,position){this._id=null;this._position=null;if(typeof id!=="undefined"){this.setId(id);}
if(typeof position!=="undefined"){this.setPosition(position);}},getId:function(){return this._id;},setId:function(id){if(typeof id==="undefined"){throw new Error("ID must be defined.");}
this._id=id;},getPosition:function(){return this._position;},setPosition:function(position){if(typeof position!=="number"){throw new TypeError("Position must be a number.");}
this._position=position;}});dojo.provide("dj.widget.panels.view.Pagination");dojo.declare("dj.widget.panels.view.Pagination",null,{constructor:function(model,pagCnt,config){this._model=model;this._pagCnt=pagCnt;this.panelIncrement=config.panelIncrement;this.paginationDivider=config.paginationDivider;},displayActiveSuccess:function(){var ap=this._model.getActive();var num=this._model.getNumberOfPanels();var start=Math.ceil(ap.getPosition()/this.panelIncrement)+(ap.getPosition()%this.panelIncrement>1?1:0);this._pagCnt.innerHTML=start+" "+this.paginationDivider+" "+Math.ceil(num/this.panelIncrement);}});dojo.provide("dj.widget.panels.controller.History");dojo.require("dj.util.History");dojo.declare("dj.widget.panels.controller.History",null,{constructor:function(model,cfg){this._isEnabled=false;this._model=model;this._cfg=(cfg||{});this._container=cfg.container;this._cfg.doSetActive=(typeof this._cfg.doSetActive==="boolean")?this._cfg.doSetActive:true;},isEnabled:function(){return this._isEnabled;},addEvents:function(){if(this._isEnabled){console.warn("{Panels} browser-history has already been enabled for \""+this._container+"\"");return;}else{console.info("{Panels} browser-history enabled for \""+this._container+"\"");this._isEnabled=true;}
var hist=dj.util.History;hist.init();var model=this._model;var pid=hist.get(this._container);var panelId="";if((typeof pid==="string")&&model.hasId(pid)){panelId=pid;}else if(model.hasPosition(1)){panelId=model.getByPosition(1).getId();}else{console.warn("{Panels} browser-history failed. No panels found.");return;}
if(this._cfg.doSetActive){model.setActiveById(panelId);}
var fromHist=false;hist.subscribe("_init",function(){fromHist=true;model.setActiveById(panelId);});hist.subscribe(this._container,function(tid){fromHist=true;model.setActiveById(tid);});var that=this;model.addChangeListener(function(panel){if(fromHist){fromHist=false;return;}
hist.set(that._container,panel.getId());});}});dojo.provide("dj.widget.panels.controller.NavArrows");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.NavArrows",null,{DEFAULT_CONFIG:{panelIncrement:1,doStopEvent:true,tabletSwipe:false,thresholdRatio:(1/2),swipeStartId:"imageSlide",hasLastSlideScrim:false},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;this._procs=[];this.connectHandles=[];},setLastActive:function(){var mdl=this._model;if(mdl.isLocked()){this._enqueueProc(this.setNextActive);return;}
mdl.setActiveByPosition(mdl.getNumberOfPanels()-mdl.getViewArea()+1);},setFirstActive:function(){if(this._model.isLocked()){this._enqueueProc(this.setPreviousActive);return;}
this._model.setDirection(this._model.DIRECTION.PREVIOUS);this._model.setActiveByPosition(1);},setPreviousActive:function(){if(this._model.isLocked()){this._enqueueProc(this.setPreviousActive);return;}
this._model.setDirection(this._model.DIRECTION.PREVIOUS);this._model.setActiveByPosition(this._model.getActive().getPosition()-this._cfg.panelIncrement);},setNextActive:function(){var mdl=this._model;if(mdl.isLocked()){this._enqueueProc(this.setNextActive);return;}
var tryNextPosition=(this._model.getActive().getPosition()+this._cfg.panelIncrement);var nxt=mdl.getByPosition(tryNextPosition);if(mdl.getRotationType()==mdl.ROTATION_TYPE.LINEAR){var hasMore=(((mdl.getNumberOfPanels()-(mdl.getViewArea()||0))-mdl.getActive().getPosition())>=0);if(hasMore===false){mdl._activePanelObserver.fireByName("failure",tryNextPosition);if(this._cfg.hasLastSlideScrim){this.ignoreActions=true;}
return;}}
mdl.setDirection(mdl.DIRECTION.NEXT);mdl.setActiveByPosition(tryNextPosition);},addEvents:function(){if(this._nav.prevButton){this._addEventForType(this._nav.prevButton,"prev");}
if(this._nav.nextButton){this._addEventForType(this._nav.nextButton,"next");}
if(this._nav.firstButton){this._addEventForType(this._nav.firstButton,"first");}
if(this._nav.lastButton){this._addEventForType(this._nav.lastButton,"last");}
if(this._cfg.tabletSwipe){this._addSwipeEventHandlers();}},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}},_enqueueProc:function(proc){this._procs.push(proc);this._model.addLockListener(function(){var pr=this._procs.shift();if(pr){pr.call(this);}},this);},_addEventForType:function(oBtn,btnType,doRemoveEvent){this.connectHandles.push(dojo.connect(oBtn,"onclick",this,this._stopEventBridge));this.connectHandles.push(dojo.connect(oBtn,'onmousedown',this,function(ev){this._stopEventBridge(ev);this._setActiveByTypeOrBeginInterval(btnType);}));this.connectHandles.push(dojo.connect(oBtn,'onmouseup',this,this._endEventBridge));this.connectHandles.push(dojo.connect(oBtn,'onmouseout',this,this._endEventBridge));},_stopEventBridge:function(ev){if(this._cfg.doStopEvent===true){dojo.stopEvent(ev);}},_setActiveByTypeOrBeginInterval:function(type){if(!this._nextInterval||this._nextInterval===null){this._setActiveByType(type);}
if(!this._cfg.disableInterval){this._nextInterval=setInterval(dojo.hitch(this,function(){this._setActiveByType(type);}),400);}},_endEventBridge:function(){clearInterval(this._nextInterval);this._nextInterval=null;},_setActiveByType:function(type){if(this.ignoreActions){return;}
var proc;switch(type){case"prev":proc=this.setPreviousActive;break;case"first":proc=this.setFirstActive;break;case"last":proc=this.setLastActive;break;case"next":proc=dojo.hitch(this,"setNextActive",type);break;default:var panelPosition=(isNaN(parseInt(type,10))?0:parseInt(type,10));if(panelPosition>0){this._model.setViewArea(panelPosition);proc=dojo.hitch(this._model,"setActiveByPosition",panelPosition);}
break;}
proc.call(this);},_addSwipeEventHandlers:function(){var that=this,_oUl=dojo.byId(this._cfg.swipeStartId);dojo.query("li img",_oUl).forEach(function(ele){that.connectHandles.push(dojo.connect(ele,'touchstart',that,that._swipeHandleStart));});},_swipeHandleStart:function(ev){var touch=ev.touches[0],_b=dojo.body(),_dc=dojo.connect,_pnls=this._model.views.panels;_pnls._doSetup();this.oSwipe={clientX:touch.clientX,clientY:touch.clientY,oUL:_pnls.getPanelByPosition(1).getElement().parentNode,mouseUpHandle:_dc(_b,"touchend",this,this._swipeHandleStop),mouseMoveHandle:_dc(_b,"touchmove",this,this._swipeHandleMouseMove)};},_swipeHandleStop:function(ev){if(typeof this.oSwipe.lastPosition!=="undefined"){var begin=this.oSwipe,end=begin.lastPosition,bx=begin.clientX,by=begin.clientY,ex=end.clientX,ey=end.clientY,_pnls=this._model.views.panels,_model=this._model.model,numOfPanels=_model.getNumberOfPanels(),panelWidth=_pnls._panelWidth;var finalDistance=(ex-bx),slidesToMove=Math.floor(Math.abs(finalDistance)/panelWidth),remainder=Math.abs(finalDistance%panelWidth),direction=(finalDistance>0?-1:(finalDistance===0?0:1)),threshold=panelWidth*this._cfg.thresholdRatio;var lastSlide=_model.getActive()._position;if(remainder>threshold){slidesToMove++;}
var newSlide=lastSlide+(slidesToMove*direction);if(newSlide<1){newSlide=1;}
else if(newSlide>numOfPanels){newSlide=numOfPanels;}
_model.setActiveByPosition(newSlide);}
dojo.disconnect(this.oSwipe.mouseUpHandle);dojo.disconnect(this.oSwipe.mouseMoveHandle);delete this.oSwipe;},_swipeHandleMouseMove:function(ev){var touch=ev.touches[0],_pnls=this._model.views.panels,_hasLast=(typeof this.oSwipe.lastPosition!=="undefined"),_oLast=(_hasLast?this.oSwipe.lastPosition:this.oSwipe),oUL=this.oSwipe.oUL,left=oUL.style.left;this.oSwipe.lastPosition={clientX:touch.clientX,clientY:touch.clientY};var distanceX=touch.clientX-_oLast.clientX,distanceY=touch.clientY-_oLast.clientY;if(Math.abs(distanceX)>Math.abs(distanceY)){dojo.stopEvent(ev);}
else{return;}
if(left===""){left=0;}
else{left=parseInt(left.replace("px",""),10);}
oUL.style.left=(left+distanceX)+"px";},disableLastSlideScrim:function(){this.ignoreActions=false;}});dojo.provide("dj.widget.panels.controller.NavTabs");dojo.require("dj.lang");dojo.declare("dj.widget.panels.controller.NavTabs",null,{DEFAULT_CONFIG:{activeEvent:"onclick",doStopEvent:true},constructor:function(model,tabs,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this.model=model;this.tabs=tabs;this.connectHandles=[];},setActive:function(tid){this.model.setActiveById(tid);},addEvents:function(doRemoveEvents){for(var tid in this.tabs){if(this.tabs.hasOwnProperty(tid)){this._addEventForTab(this.tabs[tid]);}}},removeEvents:function(){for(var i=0,len=this.connectHandles.length;i<len;i++){dojo.disconnect(this.connectHandles[i]);}},_addEventForTab:function(tab){this.connectHandles.push(dojo.connect(tab.getElement(),this._cfg.activeEvent,dojo.hitch(this,function(ev){if(this._cfg.doStopEvent===true){dojo.stopEvent(ev);}
this.setActive(tab.getId());})));}});dojo.provide("dj.widget.panels.PanelModel");dojo.require("dj.util.Observer");dojo.declare("dj.widget.panels.PanelModel",null,{ROTATION_TYPE:{LINEAR:0,CIRCULAR:1},DIRECTION:{PREVIOUS:0,NEXT:1},DEFAULT_CONFIG:{rotationType:0},constructor:function(panels,cfg){this._cfg=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),cfg);this._hPanels={};this._panelIds=[];this._prevInHistory=null;this._lastPosition=1;this._activePanel=null;this._activePanelObserver=new dj.util.Observer();this._direction=this.DIRECTION.NEXT;this._isLocked=false;this._lockObserver=new dj.util.Observer();this._rotationState=1;if(panels){this.addPanels(panels);}},updatePanels:function(panels){this._hPanels={};this._panelIds=[];var i=1;for(var pid in panels){if(panels.hasOwnProperty(pid)){var panel=panels[pid],panelId=panel.getId();this._panelIds[i++]=panelId;this._hPanels[panelId]=panel;}}},addPanel:function(panelId){var panel=new dj.widget.panels.Panel(panelId,this._lastPosition);this._panelIds[this._lastPosition]=panel.getId();this._hPanels[panelId]=panel;this._lastPosition++;},addPanels:function(panels){for(var pid in panels){if(panels.hasOwnProperty(pid)){var panel=panels[pid],panelId=panel.getId();this._panelIds[this._lastPosition]=panelId;this._hPanels[panelId]=panel;this._lastPosition++;}}},hasId:function(panelId){return(typeof this._hPanels[panelId]!=="undefined");},hasPosition:function(panelPosition){return((panelPosition>0)&&(panelPosition<this._panelIds.length));},getById:function(panelId){if(!this.hasId(panelId)){throw new Error("NoSuchElementException");}
return this._hPanels[panelId];},getByPosition:function(panelPosition){if(!this.hasPosition(panelPosition)){if(this._cfg.rotationType===this.ROTATION_TYPE.CIRCULAR){var numOfPan=this.getNumberOfPanels();panelPosition=(panelPosition%numOfPan);panelPosition=(panelPosition===0)?numOfPan:panelPosition;}else{return;}}
var pid=this._panelIds[panelPosition];return this._hPanels[pid];},getActive:function(){return this._activePanel;},getPrevInHistory:function(){return this._prevInHistory;},getAll:function(){var values=[];for(var value in this._hPanels){if(this._hPanels.hasOwnProperty(value)){values.push(this._hPanels[value]);}}
return values;},getNumberOfPanels:function(){return(this._panelIds.length-1);},getRotationState:function(){return this._rotationState;},getRotationType:function(){return this._cfg.rotationType;},getDirection:function(){return this._direction;},setRotationState:function(state){if(state<0||state>1){this._activePanelObserver.fireByName("rotationStateFailure",state);}
this._rotationState=state;this._activePanelObserver.fireByName("rotationStateSuccess",state);},setDirection:function(dir){if(dir<0||dir>1){throw new Error("IndexOutOfBoundsException");}
this._direction=dir;},setActive:function(panel){if(panel&&panel.getId){this.setActiveById(panel.getId());}},setActiveById:function(panelId){if(!this.hasId(panelId)){this._activePanelObserver.fireByName("failure",panelId);return;}
var panel=this.getById(panelId);this._prevInHistory=this._activePanel;this._activePanel=panel;this._activePanelObserver.fireByName("success",panel);for(var controller in this.controllers){if(this.controllers[controller].panelChangedHook){this.controllers[controller].panelChangedHook(panelId);}}},setActiveByPosition:function(panelPosition){if(!this.hasPosition(panelPosition)){if(this._cfg.rotationType===this.ROTATION_TYPE.CIRCULAR){var numOfPan=this.getNumberOfPanels();panelPosition=(panelPosition%numOfPan);panelPosition=(panelPosition===0)?numOfPan:panelPosition;}else{this._activePanelObserver.fireByName("failure",panelPosition);return;}}
var pid=this._panelIds[panelPosition];this.setActiveById(pid);},addChangeListener:function(event,listener,context){if(arguments.length<3&&(typeof event==="function")){context=listener;listener=event;event="success";}
context=(typeof context!=="undefined")?context:this;this._activePanelObserver.subscribeByName(event,listener,context);},isLocked:function(){return this._isLocked;},addLockListener:function(cb,context){this._lockObserver.subscribe(cb,context);},doLock:function(){this._isLocked=true;},releaseLock:function(){this._isLocked=false;this._lockObserver.fire();},runAfterLockReleased:function(cb,ctx){if(this._isLocked){this.addLockListener(cb,ctx);}else{cb.call(ctx);}},getViewArea:function(){return this._viewArea;},setViewArea:function(va){this._viewArea=va;},getActivePanel:function(){return this.getActive().getId();},setActivePanel:function(pid){var meth=(typeof pid=="string")?this.setActiveById:this.setActiveByPosition;return meth.call(this,pid);},hasPanel:function(panel){var pid=(panel.getId)?panel.getId():panel;return this.hasId(pid);},observePanels:function(callback){this.addChangeListener(function(panel){callback.apply(this,[panel.getId(),panel.getId()]);},this);}});dojo.provide("dj.widget.panels.view.BasePanel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.BasePanel",null,{DEFAULT_CONFIG:{animationDuration:0.3,animationType:"slide",orientation:"horizontal"},enableLazyImages:function(model,panelGroup){var a=model.getActivePanel();var v=model.getViewArea();var ulCount=dojo.query('ul.newsItem',panelGroup.parentNode).length;for(j=0;j<ulCount;j++){for(i=a;i<a+(2*v);i++){var ULs=dojo.query('ul.newsItem',panelGroup.parentNode);var image=dojo.query('img',ULs[j])[i];if(!image){break;}
if(image.getAttribute('data-src')){image.setAttribute('src',image.getAttribute('data-src'));}}}}});dojo.provide("dj.widget.panels.view.NavArrows");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.NavArrows",null,{DEFAULT_CONFIG:{prevButtonEnabledStyle:"enabledPrev",nextButtonEnabledStyle:"enabledNext",firstButtonEnabledStyle:"enabledFirst",lastButtonEnabledStyle:"enabledLast",panelIncrement:1},constructor:function(model,nav,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._nav=nav;},displayActiveSuccess:function(panel){this._updatePrevious();this._updateNext();},_updatePrevious:function(){var mod=this._model,pp=mod.getByPosition(mod.getActive().getPosition()-this._cfg.panelIncrement);if(!pp){dojo.removeClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);if(this._nav.firstButton){dojo.removeClass(this._nav.firstButton,this._cfg.firstButtonEnabledStyle);}}else{dojo.addClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);if(this._nav.firstButton){dojo.addClass(this._nav.firstButton,this._cfg.firstButtonEnabledStyle);}}},_updateNext:function(){var mod=this._model,np=mod.getByPosition(mod.getActive().getPosition()+mod.getViewArea());if(!np){dojo.removeClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);if(this._nav.lastButton){dojo.removeClass(this._nav.lastButton,this._cfg.lastButtonEnabledStyle);}}else{dojo.addClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);if(this._nav.lastButton){dojo.addClass(this._nav.lastButton,this._cfg.lastButtonEnabledStyle);}}},displayLastSlideScrim:function(){dojo.removeClass(this._nav.nextButton,this._cfg.nextButtonEnabledStyle);dojo.removeClass(this._nav.prevButton,this._cfg.prevButtonEnabledStyle);}});dojo.provide("dj.widget.panels.view.Panel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.Panel",null,{DEFAULT_CONFIG:{selectedClass:"",deselectedClass:"hidden"},constructor:function(model,panels,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._model=model;this._oPanels=panels;},displayActiveSuccess:function(panel){this._deselectAllExcept(panel);this._select(panel);},getContainer:function(){if(this._oCnt){return this._oCnt;}
if(this._cfg.container&&this._cfg.container!==""){this._oCnt=dojo.byId(this._cfg.container);return this._oCnt;}
if(this._oPanelGroup){this._oCnt=this._oPanelGroup.parentNode;return this._oCnt;}
var ap=this._model.getByPosition(1);var el=this._oPanels[ap.getId()];if(!el.parentNode||!el.parentNode.parentNode){return null;}
var grp=el.parentNode;this._oCnt=grp.parentNode;return this._oCnt;},getPanelByPosition:function(pos){return this._oPanels[pos];},_deselectAllExcept:function(panelNotToHide){var panel=null;for(var pid in this._oPanels){if(this._oPanels.hasOwnProperty(pid)){panel=this._oPanels[pid];if(panelNotToHide.getId()==pid){continue;}
dojo.removeClass(panel.getElement(),this._cfg.selectedClass);dojo.addClass(panel.getElement(),this._cfg.deselectedClass);}}},_select:function(panel){var pid=panel.getId();var oPan=this._oPanels[pid];if(!oPan){return;}
dojo.removeClass(oPan.getElement(),this._cfg.deselectedClass);dojo.addClass(oPan.getElement(),this._cfg.selectedClass);}});dojo.provide("dj.widget.panels.Panel");dojo.require("dj.widget.panels.PanelDTO");dojo.declare("dj.widget.panels.Panel",dj.widget.panels.PanelDTO,{constructor:function(id,position,element){this._element=null;if(typeof element!=="undefined"){this.setElement(element);}},getElement:function(){return this._element;},setElement:function(element){if(typeof element!=="object"){throw new TypeError("Element must be an object.");}
this._element=element;}});dojo.provide("dj.widget.panels.view.SlidePanel");dojo.require("dj.widget.panels.view.BasePanel");dojo.require("dj.lang");dojo.declare("dj.widget.panels.view.SlidePanel",dj.widget.panels.view.BasePanel,{DEFAULT_CONFIG:{animationDuration:0.3,animationType:"slide",orientation:"horizontal",cacheVector:true,tabletSwipe:false},constructor:function(model,panels,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._isOrientVert=(this._cfg.orientation=="vertical");this._isOrientHoriz=(this._cfg.orientation=="horizontal");this._model=model;this._panels=panels;this._isSetupDone=false;this._animation=null;this._vectorMap={};this._oCnt=this._cfg.container;this._enableLazyImages=this._cfg.enableLazyImages;this._isPanelsUpdated=false;},updatePanels:function(panels){this._panels=panels;this._isPanelsUpdated=true;},displayActiveSuccess:function(activePanel){this._model.doLock();this._doSetup();if(this._isPanelGroupLargerThanAllPanels()){return;}
if(this._isRotationCircular){this._doCircularActiveSuccess(activePanel);}else{this._doLinearActiveSuccess(activePanel);}},_doCircularActiveSuccess:function(activePanel){var prevPanel=this._model.getPrevInHistory(),prvPos=prevPanel.getPosition(),avePos=activePanel.getPosition(),that=this,isIncreasing=(this._model.getDirection()==this._model.DIRECTION.NEXT),delta=0;var isIncFlip=false;var isDecrFlip=false;if(isIncreasing&&(prvPos==this._numberOfPanels)&&(avePos==1)){isIncFlip=true;delta=(that._isOrientVert)?-this._panelHeight:-this._panelWidth;}else if(!isIncreasing&&(prvPos==1)&&(avePos==this._numberOfPanels)){isDecrFlip=true;delta=(that._isOrientVert)?this._panelHeight:this._panelWidth;}else{delta=this._getVector(prevPanel,activePanel);}
afterFin=function(){if(this._enableLazyImages){this.enableLazyImages(this._model,this._oPanelGroup);}
if(isIncFlip){var offsetType=(that._isOrientVert)?"top":"left";that._oPanelGroup.style[offsetType]="0px";}
that._model.setViewArea(that.getViewArea());that._model.releaseLock();};beforeStr=function(){if(isDecrFlip){var mv,offsetTopOrLeft,offsetHeightOrWidth;if(that._isOrientVert){offsetTopOrLeft="top";offsetHeightOrWidth="_panelHeight";}else if(that._isOrientHoriz){offsetTopOrLeft="left";offsetHeightOrWidth="_panelWidth";}
mv=that._getVector(prevPanel,activePanel)-that[offsetHeightOrWidth];this.properties.left=(mv+this.properties.xD);dojo.style(that._oPanelGroup,offsetTopOrLeft,mv+"px");}};this._doScrollAnimation(delta,beforeStr,afterFin);},_doLinearActiveSuccess:function(activePanel){var prevPanel=this._model.getPrevInHistory(),afterFin=dojo.hitch(this,function(){if(this._enableLazyImages){this.enableLazyImages(this._model,this._oPanelGroup);}
this._model.setViewArea(this.getViewArea());this._model.releaseLock();}),beforeStr=function(){};var delta=this._getVector(prevPanel,activePanel);this._doScrollAnimation(delta,beforeStr,afterFin);},_doSetup:function(){if(this._isSetupDone){return;}
this._isSetupDone=true;this._setCoreValues();this._resetStyle();if(this._isRotationCircular&&!this._isPanelGroupLargerThanAllPanels()){this._circularLoopSetup();}},_doScrollAnimation:function(delta,beforeStr,afterFin){var xD,yD;if(this._isOrientVert){xD=0;yD=delta;}else if(this._isOrientHoriz){xD=delta;yD=0;}
var newLeft=(dojo.style(this._oPanelGroup,"left")+xD),newTop=(dojo.style(this._oPanelGroup,"top")+yD),animationDurationInMillis=(this._cfg.animationDuration*1000);var animCfg={node:this._oPanelGroup,duration:animationDurationInMillis,beforeBegin:beforeStr,onEnd:afterFin,properties:{"xD":xD,"yD":yD,left:newLeft,top:newTop}};this._animation=dojo.animateProperty(animCfg);this._animation.play();},getContainer:function(){if(this._oCnt){return this._oCnt;}
if(this._cfg.container&&this._cfg.container!==""){this._oCnt=dojo.byId(this._cfg.container);return this._oCnt;}
if(this._oPanelGroup){this._oCnt=this._oPanelGroup.parentNode;return this._oCnt;}
var ap=this._panels[this._model.getByPosition(1).getId()];var el=ap.getElement();if(!el.parentNode||!el.parentNode.parentNode){return null;}
var grp=el.parentNode;this._oCnt=grp.parentNode;return this._oCnt;},getPanelByPosition:function(pos){var el=this._model.getByPosition(pos);return this._panels[el.getId()];},destroy:function(){this._resetStyle();},getViewArea:function(){var viewArea=0;if(typeof this._cfg.viewArea=="number"){viewArea=this._cfg.viewArea;}else if(this._isRotationCircular||this._isFixedSizePanels()){viewArea=this._getFixedSizeViewArea();}else{viewArea=this._getDynamicSizeViewArea();}
this._model.setViewArea(viewArea);return viewArea;},_getFixedSizeViewArea:function(){var el=(this._panels[this._model.getByPosition(1).getId()]).getElement(),cnt=el.parentNode.parentNode,hOrW=(this._isOrientVert)?"h":"w",viewArea=Math.round(dojo.position(cnt)[hOrW]/dojo.position(el)[hOrW]);return viewArea;},_getDynamicSizeViewArea:function(){var viewArea=0,activePanel=this._panels[this._model.getActive().getId()],cnt=activePanel.getElement().parentNode.parentNode,numOfPanels=this._model.getNumberOfPanels(),hOrW=(this._isOrientVert)?"h":"w",cntWidthOrHeight=dojo.position(cnt)[hOrW],totalWidthOrHeight=0;for(var i=activePanel.getPosition();i<=numOfPanels;i++){var panel=this._panels[this._model.getByPosition(i).getId()];totalWidthOrHeight+=dojo.position(panel.getElement())[hOrW];if(totalWidthOrHeight>cntWidthOrHeight){break;}
viewArea++;}
return viewArea;},_isFixedSizePanels:function(){if(typeof this.__isFixedLengthPanels==="undefined"){this.__isFixedLengthPanels=true;var hOrW=(this._isOrientVert)?"h":"w",prevLen=Math.round(dojo.position(this.getPanelByPosition(1).getElement())[hOrW]);for(var i=2;i<=this._model.getNumberOfPanels();i++){var len=Math.round(dojo.position(this.getPanelByPosition(i).getElement())[hOrW]);if(prevLen!==len){this.__isFixedLengthPanels=false;break;}
prevLen=len;}}
return this.__isFixedLengthPanels;},_getWidthOrHeightOfPanels:function(){if(typeof this._widthOrHeightOfPanels=="undefined"||this._isPanelsUpdated){var lastPanel=this.getPanelByPosition(this._model.getNumberOfPanels()),lastPanelBox=dojo.marginBox(lastPanel.getElement());this._widthOrHeightOfPanels=(this._isOrientVert)?(lastPanel.getElement().offsetTop+lastPanelBox.h):(lastPanel.getElement().offsetLeft+lastPanelBox.w);}
return this._widthOrHeightOfPanels;},_getVector:function(prevPanel,currPanel){var existingVector=this._getExistingVector(prevPanel,currPanel);if(existingVector&&this._cfg.cacheVector){return existingVector;}
currPanel=this._panels[currPanel.getId()];var offsetType=(this._isOrientVert)?"offsetTop":"offsetLeft",topOrLeft=(this._isOrientVert)?"t":"l",heightOrWidth=(this._isOrientVert)?"h":"w",yOrx=(this._isOrientVert)?"y":"x",panelsHeightOrWidth=this._getWidthOrHeightOfPanels();var panelGroupBox=dojo.marginBox(this._oPanelGroup),panelGroupOffset=this._oPanelGroup[offsetType],prevOffset=Math.abs(panelGroupBox[topOrLeft]),currPanelBox=dojo.marginBox(currPanel.getElement()),currOffset=Math.abs(currPanel.getElement()[offsetType]);var currPanelPos=currPanel.getPosition(),prevPanelPos=prevPanel.getPosition(),lastPanelPos=this._getPanelsCount(),panelDiff=currPanelPos-prevPanelPos,samePanel=(panelDiff===0),isInc=panelDiff>0;if(!isInc&&(currOffset>prevOffset)){if(!samePanel||!this._cfg.tabletSwipe){return 0;}
else{isInc=true;}}
var delta=Math.abs(currOffset-prevOffset);vector=((isInc)?(delta*-1):delta);if(this._cfg.tabletSwipe){if(samePanel){if(currPanelPos===1&&panelGroupOffset>0){vector*=-1;}}}
if(!this._isRotationCircular&&(!this._isFixedSizePanels()||!this._hasSufficientPanelsAtEnd(currPanel))){var panelGroupPos=dojo.position(this._oPanelGroup.parentNode),newPos=(panelGroupBox[topOrLeft]+vector),maxPos=(panelGroupPos[heightOrWidth]-panelsHeightOrWidth),diff=(maxPos-newPos);if(isInc&&(diff>0)){vector+=diff;}}
if(this._cfg.cacheVector){this._setExistingVector(prevPanel,currPanel,vector);}
return vector;},_hasSufficientPanelsAtEnd:function(currPanel){var delta=this._model.getNumberOfPanels()-(currPanel.getPosition()-1+this.getViewArea());if(delta>=0){return true;}else{return false;}},_getExistingVector:function(panel1,panel2){return this._vectorMap[panel1.getId()+"_"+panel2.getId()];},_setExistingVector:function(panel1,panel2,vector){this._vectorMap[panel1.getId()+"_"+panel2.getId()]=vector;},_isPanelGroupLargerThanAllPanels:function(){var heightOrWidth=(this._isOrientVert)?"h":"w",panelsHeightOrWidth=this._getWidthOrHeightOfPanels(),panelGroupPos=dojo.position(this._oPanelGroup.parentNode);return(panelGroupPos[heightOrWidth]>panelsHeightOrWidth);},_setCoreValues:function(){if(this._isCoreValuesSet){return;}
var model=this._model,ap=this._panels[model.getByPosition(1).getId()];this._oPanelGroup=dojo.query(this._cfg.panelGroup,this.getContainer())[0];this._numberOfPanels=model.getNumberOfPanels();this._isRotationCircular=(model.getRotationType()==model.ROTATION_TYPE.CIRCULAR);if(this._isOrientVert){this._panelHeight=dojo.position(ap.getElement()).h;}else if(this._isOrientHoriz){this._panelWidth=dojo.position(ap.getElement()).w;}
this._isCoreValuesSet=true;},_resetStyle:function(){if(typeof this._oPanelGroup==="object"){dojo.style(this._oPanelGroup,{left:0,top:0});}},_circularLoopSetup:function(){for(var i=1,element=null,clone=null,len=this.getViewArea();i<=len;i++){element=this._panels[this._model.getByPosition(i).getId()].getElement();clone=element.cloneNode(true);this._oPanelGroup.appendChild(clone);}},_getPanelsCount:function(){if(typeof this.panelsCount==="undefined"){var _pnls=this._panels,lastPanelPos=-1;for(var i in _pnls){if(_pnls.hasOwnProperty(i)){var pos=_pnls[i].getPosition();if(pos>lastPanelPos){lastPanelPos=pos;}}}
this.panelsCount=lastPanelPos;}
return this.panelsCount;}});dojo.provide("dj.widget.panels.PanelsFactory");dojo.require("dj.lang");dojo.require("dj.widget.panels.PanelDTO");dojo.require("dj.widget.panels.Panel");dojo.require("dj.widget.panels.PanelModel");dj.widget.panels.PanelsFactory={_CONFIG:{core:{panelGroup:".newsItem",panel:"> li",panelPrefix:"panelsPanel_",panels:undefined,panelToggleStyle:"hidden",activePanel:1,disabledPanels:undefined,panelIncrement:1,viewArea:undefined,paginationDivider:"/",paginationContainer:".pagination",controller:undefined,enableBrowserHistory:false,animationDuration:0.3},tabs:{tabPrefix:"panelsTab_",tabGroup:".newsItem",tab:"> li",navContainer:".nav-inline",prevButton:".prev",nextButton:".next",navButtonEnabledStyle:"enabled",tabOnEvent:"click",tabOnStyle:"active",tabOffStyle:"deselected"},carousel:{orientation:"horizontal",navContainer:".nav-inline",pagination:{container:false,linkClass:"prevnext_page",selectedClass:"prevnext_page-current",label:false,labelClass:"prevnext_pagelabel",prevNextDisableClass:'prevnext_prev-disabled'},disableInterval:false,prevButton:".prev",nextButton:".next",prevButtonEnabledStyle:"enabledPrev",nextButtonEnabledStyle:"enabledNext"},rotator:{rotateTime:8,rotateIterations:3,pauseOnMouseOver:false,pauseButton:".nav-inline .pause",pauseButtonEnabledStyle:"enabledPause",progressBar:".progressbarBox"}},_panelsType:{NONE:0,SLIDE:1,SWITCH:2},_paginationType:{SIMPLE:0,RANGE:1},_lookupType:{NONE:0,SELECTOR:1,PREFIX:2},create:function(container,cfg,doIgnoreOptCache){if(!container||(typeof cfg!=="object")){console.warn("{Panels} no container or config specified.");return;}
container=dojo.byId(container);if(container&&!doIgnoreOptCache){if(this._isReinitializedAndSetCache(container,cfg)){console.warn("{Panels} prevented attempt to reinitialize \""+container.id+"\".");return;}}
try{var mvc=this._setupMvc(container,cfg);this._addCompatibilityMethods(mvc,container,cfg);return mvc.model;}catch(ex){console.info(ex.message);}},_isReinitializedAndSetCache:function(container,cfg){var optCache=['{',container.id,': ',dj.lang.objectToString(cfg,true),'}'].join(''),cntOpt=container.getAttribute("djw_optcache");if(cntOpt){var opts=cntOpt.split("_");for(var i=0,len=opts.length;i<len;i++){if(opts[i]==optCache){return true;}}}
if(cntOpt){container.setAttribute("djw_optcache",[optCache,cntOpt].join("_"));}else{container.setAttribute("djw_optcache",optCache);}
return false;},createPanels:function(userCfg){var djwp=dj.widget.panels,_lookupType=this._lookupType,_panType=this._panelsType,_d=dojo,model=null,views={},controllers={};var config=dojo.clone(this._CONFIG.core);config.container="";config.doAddChangeListeners=true;config.panelsType=_panType.SWITCH;config.panelsLookupType=_lookupType.SELECTOR;dojo.mixin(config,userCfg);var panels=null;switch(config.panelsLookupType){case _lookupType.PREFIX:panels=this.lookupByPrefix(config.panelPrefix,config.panels);break;case _lookupType.SELECTOR:panels=this.lookupBySelector(config.container,config.panelGroup,config.panel);break;default:return;}
var rotType=(((config.type==djwp.PanelModel.prototype.ROTATION_TYPE.CIRCULAR)||(config.type=="circular"))?djwp.PanelModel.prototype.ROTATION_TYPE.CIRCULAR:djwp.PanelModel.prototype.ROTATION_TYPE.LINEAR);model=new djwp.PanelModel(this.panelsToPanelsDTO(panels),{rotationType:rotType});model.setActiveByPosition(config.activePanel);var view=null,viewPanelConfig,viewPanelType;switch(config.panelsType){case _panType.SLIDE:_d.require("dj.widget.panels.view.SlidePanel");viewPanelType="SlidePanel";viewPanelConfig={animationDuration:config.animationDuration,viewArea:config.viewArea,orientation:config.orientation,panelGroup:config.panelGroup,container:config.container,enableLazyImages:config.enableLazyImages};if(typeof config.cacheVector!=="undefined"){viewPanelConfig.cacheVector=config.cacheVector;}
if(typeof config.tabletSwipe!=="undefined"){viewPanelConfig.tabletSwipe=config.tabletSwipe;}
break;case _panType.SWITCH:_d.require("dj.widget.panels.view.Panel");viewPanelType="Panel";viewPanelConfig={selectedClass:config.selectedPanelClass,deselectedClass:config.deselectedPanelClass};break;}
view=new djwp.view[viewPanelType](model,panels,viewPanelConfig);views.panels=view;if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}
return{"model":model,"views":views,"controllers":controllers};},addModuleNavArrows:function(mvc,userCfg){var _lookupType=this._lookupType,model=mvc.model,views=mvc.views,controllers=mvc.controllers,_d=dojo;var config=_d.clone(this._CONFIG.carousel);config.container="";config.doAddEvents=true;config.doAddChangeListeners=true;config.doHide=false;dj.lang.mixin(config,userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var navArrowsLookupType=_lookupType.NONE;if(!config.lookupType){navArrowsLookupType=(config)?_lookupType.SELECTOR:navArrowsLookupType;}else{navArrowsLookupType=config.lookupType;}
var navArrows={};if(navArrowsLookupType==_lookupType.SELECTOR){navArrows.navContainer=_d.query(config.navContainer,config.container)[0];if(navArrows.navContainer){navArrows.prevButton=_d.query(config.prevButton,navArrows.navContainer)[0];navArrows.nextButton=_d.query(config.nextButton,navArrows.navContainer)[0];navArrows.lastButton=(config.lastButton)?_d.query(config.lastButton,navArrows.navContainer)[0]:null;navArrows.firstButton=(config.firstButton)?_d.query(config.firstButton,navArrows.navContainer)[0]:null;}else{return;}}else{return;}
if(config.doHide){navArrows.navContainer.style.visibility="hidden";return;}else if(navArrows.navContainer.style.visibility==="hidden"){navArrows.navContainer.style.visibility="";}
var controller;if(config.pagination.container){_d.require("dj.widget.panels.controller.NavArrowsPagination");controller=new dj.widget.panels.controller.NavArrowsPagination(model,navArrows,config);}else{_d.require("dj.widget.panels.controller.NavArrows");controller=new dj.widget.panels.controller.NavArrows(model,navArrows,config);}
controllers.navArrows=controller;_d.require("dj.widget.panels.view.NavArrows");var view=new dj.widget.panels.view.NavArrows(model,navArrows,config);view.displayActiveSuccess();views.navArrows=view;if(config.doAddEvents){controller.addEvents();}
if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModuleNavTabs:function(mvc,userCfg){var _lookupType=this._lookupType,model=mvc.model,views=mvc.views,controllers=mvc.controllers,_d=dojo;var config=dojo.clone(this._CONFIG.tabs);config.container="";config.panels=this._CONFIG.core.panels;config.doAddEvents=true;config.doAddChangeListeners=true;dj.lang.mixin(config,userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var navTabsLookupType=_lookupType.NONE;if(!config.lookupType){navTabsLookupType=(userCfg)?_lookupType.SELECTOR:navTabsLookupType;navTabsLookupType=(userCfg&&userCfg.tabPrefix)?_lookupType.PREFIX:navTabsLookupType;}else{navTabsLookupType=config.lookupType;}
var navTabs=null;switch(navTabsLookupType){case _lookupType.PREFIX:navTabs=this.lookupByPrefix(config.tabPrefix,config.panels);break;case _lookupType.SELECTOR:navTabs=this.lookupBySelector(config.container,config.tabGroup,config.tab);break;default:return;}
_d.require("dj.widget.panels.view.Panel");var view=new dj.widget.panels.view.Panel(model,navTabs,{selectedClass:config.tabOnStyle,deselectedClass:config.tabOffStyle});_d.require("dj.widget.panels.controller.NavTabs");var controller=new dj.widget.panels.controller.NavTabs(model,navTabs,{activeEvent:config.tabOnEvent});views.navTabs=view;controllers.navTabs=controller;if(config.doAddEvents){controller.addEvents();}
if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModulePagination:function(mvc,userCfg){var config={},_d=dojo;var model=mvc.model,views=mvc.views;dj.lang.mixin((config={container:"",doAddChangeListeners:true,paginationContainer:this._CONFIG.core.paginationContainer,doHide:false}),userCfg);if(!config.container&&views.panels&&views.panels.getContainer){config.container=views.panels.getContainer();}
var oPaginationCnt=_d.query(config.paginationContainer,config.container)[0];if(!oPaginationCnt){return;}
if(config.doHide){oPaginationCnt.style.visibility="hidden";return;}
var view,isTypeRangePagination=(config.type&&config.type==this._paginationType.RANGE),requireClassName=(isTypeRangePagination)?"RangePagination":"Pagination";if(isTypeRangePagination){var ototalResultsCnt=_d.query(config.totalResultsContainer,config.container)[0];var totalCnt=ototalResultsCnt.innerHTML;_d.require("dj.widget.panels.view.RangePagination");view=new dj.widget.panels.view.RangePagination(model,oPaginationCnt,totalCnt,ototalResultsCnt,config.pageSize);model.setViewArea(1);model.setActiveByPosition(1);}else{_d.require("dj.widget.panels.view.Pagination");view=new dj.widget.panels.view.Pagination(model,oPaginationCnt,config);}
view.displayActiveSuccess();views.pagination=view;if(config.doAddChangeListeners){model.addChangeListener("success",view.displayActiveSuccess,view);}},addModuleTimer:function(mvc,userCfg){var _d=dojo,config=_d.clone(this._CONFIG.rotator);config.container="";config.doAddEvents=true;config.doAddChangeListeners=true;dj.lang.mixin(config,userCfg);var controllers=mvc.controllers;_d.require("dj.widget.panels.controller.Timer");controllers.timer=new dj.widget.panels.controller.Timer(mvc.model,config);var oPause=_d.query(config.pauseButton,config.container)[0];if(oPause){_d.require("dj.widget.panels.view.Timer");var view=new dj.widget.panels.view.Timer(mvc.model,{pauseButton:oPause},userCfg);if(config.doAddChangeListeners){mvc.model.addChangeListener("rotationStateSuccess",view.rotationStateSuccess,view);}}
if(config.doAddEvents){controllers.timer.addEvents();}},addModuleBrowserHistory:function(mvc,userCfg){var config={},_d=dojo;dj.lang.mixin((config={doAddEvents:true}),userCfg);_d.require("dj.widget.panels.controller.History");mvc.controllers.browserHistory=new dj.widget.panels.controller.History(mvc.model,config);if(config.doAddEvents){controllers.browserHistory.addEvents();}},addController:function(mvc,cMvc){if(!cMvc||!cMvc.model||!cMvc.model.addChangeListener||!mvc||!mvc.model){throw new Error("{Panels.addController} mvc and/or controller is invalid.");}
var model=mvc.model,controllerModel=cMvc.model;controllerModel.addChangeListener("success",function(panel){model.setActive(panel);});},_setupMvc:function(container,userConfig){var oCnt=dojo.byId(container);container=(oCnt.id||container);var config=dj.lang.cloneMixin(this._CONFIG,userConfig),typeCfg=this._getPanelsTypeConfig(userConfig,config);var panelsCfg={container:oCnt,doAddChangeListeners:false,panelsType:typeCfg.panelsType,panelsLookupType:typeCfg.panelsLookupType};dj.lang.mixin(panelsCfg,config.core);if(typeCfg.panelsType==this._panelsType.SWITCH){dj.lang.mixin(panelsCfg,config.tabs);}else if(typeCfg.panelsType==this._panelsType.SLIDE){dj.lang.mixin(panelsCfg,config.carousel);}
var mvc=this.createPanels(panelsCfg);if(mvc.model.getNumberOfPanels()==-1){throw new Error("{Panels} container \""+container+"\" has no panels.");}
var model=mvc.model,views=mvc.views,controllers=mvc.controllers;if(typeCfg.hasNavTabs){var navTabCfg=config.tabs;navTabCfg.container=oCnt;navTabCfg.panels=config.core.panels;navTabCfg.doAddEvents=false;navTabCfg.doAddChangeListeners=false;navTabCfg.lookupType=typeCfg.navTabsLookupType;this.addModuleNavTabs(mvc,navTabCfg);}
if(typeCfg.hasNavArrows){var navArrCfg=config.carousel;navArrCfg.container=oCnt;navArrCfg.doAddEvents=false;navArrCfg.doAddChangeListeners=false;navArrCfg.lookupType=typeCfg.navArrowsLookupType;navArrCfg.panelIncrement=config.core.panelIncrement;navArrCfg.doHide=((typeCfg.panelsType==this._panelsType.SLIDE)&&(views.panels.getViewArea()>=model.getNumberOfPanels())&&!config.carousel.showNavButtons);this.addModuleNavArrows(mvc,navArrCfg);}
var enablePagination=config.core.enablePagination;if((typeCfg.panelsType==this._panelsType.SLIDE&&(views.panels.getViewArea()<=1))||enablePagination){var paginCfg={container:oCnt,paginationContainer:config.core.paginationContainer,panelIncrement:config.core.panelIncrement,paginationDivider:config.core.paginationDivider,doAddEvents:false,doAddChangeListeners:false,doHide:(views.panels.getViewArea()==1&&enablePagination)};this.addModulePagination(mvc,paginCfg);}
if(typeCfg.hasTimer){var timerCfg=config.rotator;timerCfg.container=oCnt;timerCfg.doAddEvents=false;this.addModuleTimer(mvc,timerCfg);}
if(typeCfg.hasBrowserHistory){var histConf={container:(typeCfg.panelsLookupType==this._lookupType.SELECTOR)?oCnt.id:container,doAddEvents:false};this.addModuleBrowserHistory(mvc,histConf);}
if(typeCfg.hasController){this.addController(mvc,config.core.controller);}
this._addViewChangeListenersToModel(model,views);this._addEventsToControllers(controllers);if(!typeCfg.hasBrowserHistory&&typeCfg.panelsType==this._panelsType.SWITCH){model.setActiveByPosition(panelsCfg.activePanel);}
return mvc;},_getPanelsTypeConfig:function(userConfig,config){var _panType=this._panelsType;var _lookType=this._lookupType;var typeCfg={};typeCfg.panelsType=_panType.NONE;typeCfg.panelsType=(userConfig.core)?_panType.SWITCH:typeCfg.panelsType;typeCfg.panelsType=(userConfig.carousel)?_panType.SLIDE:typeCfg.panelsType;typeCfg.panelsLookupType=_lookType.SELECTOR;typeCfg.panelsLookupType=(userConfig.core&&userConfig.core.panelPrefix)?_lookType.PREFIX:typeCfg.panelsLookupType;typeCfg.navTabsLookupType=_lookType.NONE;typeCfg.navTabsLookupType=(userConfig.tabs)?_lookType.SELECTOR:typeCfg.navTabsLookupType;typeCfg.navTabsLookupType=(userConfig.tabs&&userConfig.tabs.tabPrefix)?_lookType.PREFIX:typeCfg.navTabsLookupType;typeCfg.navArrowsLookupType=_lookType.NONE;typeCfg.navArrowsLookupType=(userConfig.carousel)?_lookType.SELECTOR:typeCfg.navArrowsLookupType;typeCfg.navArrowsLookupType=(userConfig.tab&&userConfig.tab.navContainer)?_lookType.SELECTOR:typeCfg.navArrowsLookupType;typeCfg.hasController=(userConfig.core&&(typeof userConfig.core.controller=="object"));typeCfg.hasNavArrows=(typeCfg.navArrowsLookupType!==_lookType.NONE);typeCfg.hasNavTabs=(typeCfg.navTabsLookupType!==_lookType.NONE);typeCfg.hasTimer=(typeof userConfig.rotator=="object"&&userConfig.rotator.rotateTime>0);typeCfg.hasBrowserHistory=(config.core.enableBrowserHistory);return typeCfg;},_addViewChangeListenersToModel:function(model,views){var view=null;for(var viewName in views){if(views.hasOwnProperty(viewName)){view=views[viewName];if(view.displayActiveSuccess){model.addChangeListener("success",view.displayActiveSuccess,view);}
if(view.displayActiveFailure){model.addChangeListener("failure",view.displayActiveFailure,view);}}}},_addEventsToControllers:function(controllers){var controller=null;for(var controllerName in controllers){if(controllers.hasOwnProperty(controllerName)){controller=controllers[controllerName];controller.addEvents();}}},_addCompatibilityMethods:function(mvc,container,config){var that=this;if(typeof mvc.model.update==="undefined"){mvc.model.update=function(){that.destroy(mvc);mvc=that.create((container.id||container),config,true);return mvc;};}
if(typeof mvc.model.destroy==="undefined"){mvc.model.destroy=function(){that.destroy(mvc);};}
if(mvc.controllers&&mvc.controllers.navTabs){var tabs=mvc.controllers.navTabs.tabs,_d=dojo;mvc.model.observeTabs=function(callback,eventType){eventType=(eventType||"onclick");var _addEvForTab=function(tab){_d.connect(tab.getElement(),eventType,function(ev){var tid=tab.getId();if(mvc.controllers.navTabs._cfg.doStopEvent===true){_d.stopEvent(ev);}
tid=(isNaN(parseInt(tid,10)))?tid:(mvc.model.getById(tid).getPosition()+"");callback.call(null,tid,mvc.model);});};for(var tid in tabs){if(tabs.hasOwnProperty(tid)){_addEvForTab(tabs[tid]);}}};}
if(typeof mvc.model.updateNewPanels==="undefined"){mvc.model.updateNewPanels=function(container,group,node){var panels=that.lookupBySelector(container,group,node);mvc.model.updatePanels(that.panelsToPanelsDTO(panels));mvc.views.panels.updatePanels(panels);};}
mvc.model.model=mvc.model;mvc.model.views=mvc.views;mvc.model.controllers=mvc.controllers;},destroy:function(mvc){for(var controller in mvc.controllers){if(mvc.controllers.hasOwnProperty(controller)){mvc.controllers[controller].removeEvents();delete mvc.controllers[controller];}}
for(var viewName in mvc.views){if(mvc.views.hasOwnProperty(viewName)){var view=mvc.views[viewName];if(typeof view.destroy=="function"){view.destroy();}
delete mvc.views[viewName];}}},panelsToPanelsDTO:function(panels){var elms={};for(var panId in panels){if(panels.hasOwnProperty(panId)){var pan=panels[panId];elms[panId]=new dj.widget.panels.PanelDTO(pan.getId(),pan.getPosition());}}
return elms;},lookupByPrefix:function(prefix,names){var elms={};for(var i=0,len=names.length,id=null,el=null,pos=1;i<len;i++){id=names[i];el=dojo.byId(prefix+id);if((typeof el==="undefined")||el===null||el.firstChild===null){continue;}
elms[id]=new dj.widget.panels.Panel(id,pos++,el);}
return elms;},lookupBySelector:function(container,group,node){if(!container||container===null){throw new Error('{dj.util.Panels} container for group: "'+group+'" is undefined.');}
var oCnt=dojo.byId(container);var oPanels=dojo.query((group+' '+node),oCnt);var elms={};for(var i=0,len=oPanels.length,el=null,pos=1;i<len;i++){el=oPanels[i];if(el===null||(el.tagName!=="IMG"&&el.firstChild===null)){continue;}
elms[pos-1]=new dj.widget.panels.Panel(pos-1,pos++,el);}
return elms;}};dojo.provide("dj.widget.panels.prebuilt.Slideshow");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.view.Pagination");dojo.declare("dj.widget.panels.prebuilt.Slideshow",null,{STATE_CLASS:{NORMAL:"sl_inline-norm",OVER:"sl_inline-over",END:"sl_inline-end"},constructor:function(id){this._domContainer=dojo.byId(id);this._isCaptionsEnabled=true;this._isLastFrameEnabled=true;this._createPanels(this._domContainer);this._connectCaptionEvents();this._connectLastFrameEvents();},getPanels:function(){return this._panels;},nextSlide:function(){this._panels.controllers.navArrows.setNextActive();},previousSlide:function(){this._panels.controllers.navArrows.setPreviousActive();},showCaption:function(){if(!this._isCaptionsEnabled){return;}
dojo.removeClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.addClass(this._domContainer,this.STATE_CLASS.OVER);var caption=this._getCurrentCaption(),captionHeight=dojo.position(caption).h;dojo.anim(caption,{top:{end:-captionHeight}});},hideCaption:function(){if(!this._isCaptionsEnabled){return;}
var caption=this._getCurrentCaption(),an=dojo.anim(caption,{top:{end:0}});dojo.connect(an,"onEnd",this,function(){dojo.addClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.removeClass(this._domContainer,this.STATE_CLASS.OVER);});},_createPanels:function(domNode){this._panels=dj.widget.panels.PanelsFactory.create(domNode,{core:{panelGroup:".sl_c",panel:".sl_i"},carousel:{navContainer:".box-arrows",prevButton:".prev",nextButton:".next"}});},_connectCaptionEvents:function(){var captions=dojo.query(".cap_c",this._domContainer);if(captions.length===0){this._isCaptionsEnabled=false;return;}
captions.connect("onclick",dojo.hitch(this,function(event){dojo.stopEvent(event);this.showCaption();}));dojo.connect(dojo.doc,"onclick",this,this.hideCaption);this._panels.addChangeListener("success",this.hideCaption,this);},_connectLastFrameEvents:function(){var lastFrame=dojo.query(".sl_end",this._domContainer);if(lastFrame.length===0){this._isLastFrameEnabled=false;return;}
this._panels.addChangeListener("success",this._hideLastFrame,this);this._panels.addChangeListener("failure",this._showLastFrame,this);},_getCurrentCaption:function(){var activePanelModel=this._panels.model.getActive(),activePanel=this._panels.views.panels.getPanelByPosition(activePanelModel.getPosition());return dojo.query(".cap_l",activePanel.getElement())[0];},_showLastFrame:function(){dojo.removeClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.addClass(this._domContainer,this.STATE_CLASS.END);},_hideLastFrame:function(){if(dojo.hasClass(this._domContainer,this.STATE_CLASS.END)){dojo.addClass(this._domContainer,this.STATE_CLASS.NORMAL);dojo.removeClass(this._domContainer,this.STATE_CLASS.END);}}});dojo.provide("dj.widget.panels.virtual.History");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.controller.History");dojo.provide("dj.module.panels.liveSlideshow");dojo.require("dj.util.liveWidget");dojo.require("dj.util.Element");dojo.require("dj.widget.panels.prebuilt.Slideshow");dj.module.panels.liveSlideshow={init:function(type){if(this._isInit){return;}
this._isInit=true;this.type=type;this._setupLiveWidget();},destroy:function(){dj.util.liveWidget.unregister("panels.Slideshow");},_setupLiveWidget:function(){dj.util.liveWidget.register("panels.Slideshow",function(liveWidget,dataset){dojo.stopEvent(liveWidget.event);this._initWidget(liveWidget,dataset);},this);},_initWidget:function(liveWidget,dataset){var id=dj.util.Element.identify(liveWidget.domNode),slideshow;if(this.type&&this.type==="Article"){slideshow=new dj.widget.panels.prebuilt.ArticleSlideshow(id);}else{slideshow=new dj.widget.panels.prebuilt.Slideshow(id);}
var target=liveWidget.event.target;this._tryPossibleInitEvents(target,slideshow);},_tryPossibleInitEvents:function(target,slideshow){var is=dj.util.Element.isOrIsChildOf;if(is(target,".cap_s")){slideshow.showCaption();}
if(is(target,".next")){slideshow.nextSlide();}
if(is(target,".prev")){slideshow.previousSlide();}}};dojo.provide("dj.widget.panels.virtual.Tabs");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.controller.NavTabs");dojo.require("dj.widget.panels.view.Panel");dojo.provide("dj.widget.panels.virtual.Carousel");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.widget.panels.view.SlidePanel");dojo.require("dj.widget.panels.view.NavArrows");dojo.require("dj.widget.panels.controller.NavArrows");
dojo.provide("dj.widget.panel.LiveModalPanel");dojo.require("dj.util.Element");(function(djl){(dj.widget.panel.LiveModalPanel=function(cfg){this.cfg=djl.cloneMixin(this.DEFAULT_CONFIG,cfg);this._setupEvents();}).prototype={DEFAULT_CONFIG:{container:".linklist_dropdown .mn_dropdown_container",containerInd:".linklist_dropdown .mn_dropdown_container",dropdownContent:".mn_dropdownPanel > .mn_dropdownContent",actionEvent:"click",stateContainer:".mn_dropdownTree",stateCollapsed:"mn_ddState-collapsed",stateExpanded:"mn_ddState-expanded",navContainer:".pmMainNav",stateHover:"mndd_ddState-hover ",queryUpClass:"mn_dropdownTree",addMouseEvents:false},prevActivePanel:undefined,navOpened:false,_setupEvents:function(){var that=this;if(this.cfg.addMouseEvents){djl.addLiveEvent(this.cfg.container,"mouseover",function(ev){that.mouseOverOut(this,ev);});}
djl.addLiveEvent(this.cfg.containerInd,this.cfg.actionEvent,function(ev){var node=that._queryUpForClassName(this,that.cfg.queryUpClass);that.togglePanel(node,ev);});if(this.cfg.addMouseEvents){djl.addLiveEvent(this.cfg.container,"mouseout",function(ev){that.mouseOverOut(this,ev);});}
this.oDropdownContainer=dojo.query(this.cfg.navContainer)[0];dojo.connect(document,'onclick',function(ev){if(ev.target.nodeName=="A"){return true;}
if(that.prevActivePanel!==undefined&&that.navOpened===true){var dropd=dojo.query(that.cfg.dropdownContent,that.prevActivePanel)[0];if(dropd!==undefined&&!dj.util.Element.contains(dropd,ev.clientX,ev.clientY)){that.togglePanel(dropd,ev);that.navOpened=false;}}});},_queryUpForClassName:function(node,cn){if(node.className.indexOf(cn)==-1){while((typeof node!=="object")||(null===node.className)||!node.className||(node.className.indexOf(cn)!==0)){node=node.parentNode;}}
return node;},togglePanel:function(dropd,event){var cfg=this.cfg;if(dojo.hasClass(dropd,cfg.stateCollapsed)){dojo.removeClass(dropd,cfg.stateCollapsed);dojo.addClass(dropd,cfg.stateExpanded);this.navOpened=true;}else{dojo.removeClass(dropd,cfg.stateExpanded);dojo.addClass(dropd,cfg.stateCollapsed);this.navOpened=false;}
if(this.prevActivePanel!==undefined&&this.prevActivePanel!=dropd){dojo.removeClass(this.prevActivePanel,cfg.stateExpanded);dojo.addClass(this.prevActivePanel,cfg.stateCollapsed);}
this.prevActivePanel=dropd;dojo.stopEvent(event);},mouseOverOut:function(elm,ev){var cfg=this.cfg,dropd=dojo.query(cfg.stateContainer,elm)[0];if(dropd!==undefined){if(ev.type=="mouseover"){dojo.addClass(dropd,cfg.stateHover);}else if(ev.type=="mouseout"){dojo.removeClass(dropd,cfg.stateHover);}}}};}(dj.lang));dojo.provide("dj.widget.panel.Tooltip");dojo.require("dj.lang");dojo.require("dj.util.Query");dojo.declare("dj.widget.panel.Tooltip",null,{constructor:function(containerClass,tipTargetBox,tipTarget,tooltipBox,container,hideDelayInMillis){this._delayedMouseOver(tipTarget,dojo.hitch(this,function(node){this.init(containerClass,{elementsContainerClass:tipTargetBox,targetClass:tipTarget,tooltipClass:tooltipBox,container:container,hideTooltipDelay:hideDelayInMillis});this.isInitialized=true;var ttb=dj.util.Query.up(node,tipTargetBox),tb=dojo.query(tooltipBox,ttb)[0];this.showTooltip(tb);}),200);},_delayedMouseOver:function(containerClass,func,time){var doInit=false,initDelay;var outEvent=dj.lang.addLiveEvent(containerClass,"mouseout",function(){doInit=false;});var overEvent=dj.lang.addLiveEvent(containerClass,"mouseover",function(){if(initDelay){clearTimeout(initDelay);}
doInit=true;var elm=this;initDelay=setTimeout(function(){if(!doInit){return;}
dj.lang.removeLiveEvent(overEvent);dj.lang.removeLiveEvent(outEvent);func.call(null,elm);},time);});},DEFAULT_CONFIG:{hideTooltipDelay:100},init:function(containerClass,config){this.eventPointerList=[];this.containerClass=containerClass;this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,config);this._setupTooltips();},_setupTooltips:function(){this.oContainer=(this.cfg.container?dojo.byId(this.cfg.container):this.cfg.container);this.oTooltipContainers=((typeof this.oContainer!=='undefined')&&(this.oContainer!==null))?dojo.query(this.containerClass,this.oContainer):dojo.query(this.containerClass);this.oTooltipContainers.forEach(dojo.hitch(this,function(oTooltipContainer){var oTooltipElementsContainer=dojo.query(this.cfg.elementsContainerClass,oTooltipContainer)[0],oTooltipTarget=dojo.query(this.cfg.targetClass,oTooltipContainer)[0],oTooltip=dojo.query(this.cfg.tooltipClass,oTooltipContainer)[0];if(!((typeof oTooltipElementsContainer!=='undefined')&&(oTooltipElementsContainer!==null)&&(typeof oTooltipTarget!=='undefined')&&(oTooltipTarget!==null)&&(typeof oTooltip!=='undefined')&&(oTooltip!==null))){console.log("{Tooltip} oTooltipTarget or oTooltip is not defined for tooltip container");return;}
var tipTarget=dojo.query(this.cfg.targetClass,oTooltipElementsContainer)[0];if((typeof tipTarget==='undefined')||(tipTarget===null)){dojo.place(oTooltipElementsContainer,oTooltipTarget,"before");dojo.place(oTooltipTarget,oTooltip,"after");}
var tooltipVisibleFlag=false;var showTooltipListener=function(){tooltipVisibleFlag=true;this.showTooltip(oTooltip);};var hideTooltipListener=function(){tooltipVisibleFlag=false;setTimeout(dojo.hitch(this,function(){if(tooltipVisibleFlag===false){this.hideTooltip(oTooltip);}}),this.cfg.hideTooltipDelay);};this.eventPointerList.push(dojo.connect(oTooltipTarget,"onmouseover",dojo.hitch(this,showTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltipTarget,"onmouseout",dojo.hitch(this,hideTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltip,"onmouseover",dojo.hitch(this,showTooltipListener)));this.eventPointerList.push(dojo.connect(oTooltip,"onmouseout",dojo.hitch(this,hideTooltipListener)));}));},showTooltip:function(oTooltip){dojo.style(oTooltip,{display:"block"});},hideTooltip:function(oTooltip){dojo.style(oTooltip,{display:"none"});},destructor:function(){if(!this.isInitialized){console.warn("{dj.widget.panel.Tooltip} has not been initialized yet");return;}
this.oContainer=null;this.oTooltipContainers=null;for(var i=0,len=this.eventPointerList.length;i<len;i++){dojo.disconnect(this.eventPointerList[i]);delete this.eventPointerList[i];}},refreshTooltips:function(container){if(!this.isInitialized){return;}
this.destructor();this._setupTooltips();}});dojo.provide("dj.widget.panel.ModalPanel");dojo.require("dj.util.Config");dojo.require("dj.util.Element");dojo.require("dj.util.Observer");(dj.widget.panel.ModalPanel=function(modalId,modalContainer,config){this.oModalId=dojo.byId(modalId);if(!this.oModalId){throw new Error("{dj.widget.panel.ModalPanel} modal-id is null or undefined");}
this.oModalContainer=dojo.byId(modalContainer);if(!this.oModalContainer){throw new Error("{dj.widget.panel.ModalPanel} modal-container is null or undefined");}
this.observeOpenModalPanel=new dj.util.Observer();this.observeCloseModalPanel=new dj.util.Observer();this.cfg=new dj.util.Config(this);this._setupConfig();if(config){this.cfg.applyConfig(config,true);}
this.cfg.fireQueue();if(this.oModalId===null){this._setupTargetlessModalPanel(this.oModalContainer);}else{this._setupModalPanel(this.oModalId,this.oModalContainer);}}).prototype={DEFAULT_CONFIG:{OPEN_MODAL_PANEL_EVENT_OPTION:{key:"openModalPanelEvent",value:"mouseover"},CLOSE_MODAL_PANEL_EVENT_OPTION:{key:"closeModalPanelEvent",value:"mouseout"},CLOSE_MODAL_PANEL_BUTTON_SELECTOR:{key:"closeModalPanelButtonSelector",value:null},CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR:{key:"closeModalPanelEventForButtonSelector",value:null}},_setupModalPanel:function(oModalId,oModalContainer){dojo.style(oModalContainer,{visibility:"hidden"});var modalOpenEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.OPEN_MODAL_PANEL_EVENT_OPTION.key);var modalCloseEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_OPTION.key);var that=this;dojo.connect(oModalId,"on"+modalOpenEvent,this,function(event){dojo.stopEvent(event);this.openModalPanel();});var closeModalPanelSelector=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key);if(closeModalPanelSelector!==null){var closeModalPanelButtons=dojo.query(closeModalPanelSelector,oModalContainer);var modalCloseEventForButtonSelector=(this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key)!==null)?this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key):modalCloseEvent;closeModalPanelButtons.forEach(function(oCloseModalPanelButton){dojo.connect(oCloseModalPanelButton,"on"+modalCloseEventForButtonSelector,this,function(event){dojo.stopEvent(event);this.closeModalPanel();});},this);}else{dojo.connect(oModalContainer,"onmouseover",this,this.openModalPanel);dojo.connect(oModalContainer,"on"+modalCloseEvent,this,this.closeModalPanel);}
if(modalCloseEvent=='blur'){dojo.connect(document,"onclick",this,function(event){var isMousePointerinModalContainer=dj.util.Element.contains(oModalContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer===false){this.closeModalPanel();}});}},_setupTargetlessModalPanel:function(oModalContainer){var modalCloseEvent=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_EVENT_OPTION.key);var closeModalPanelSelector=this.cfg.getProperty(this.DEFAULT_CONFIG.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key);this.openModalPanel();var that=this;if(closeModalPanelSelector!==null){var closeModalPanelButtons=dojo.query(closeModalPanelSelector,oModalContainer).each(function(oCloseModalPanelButton){dojo.connect(oCloseModalPanelButton,"on"+modalCloseEvent,this,function(event){dojo.stopEvent(event);this.closeModalPanel();});});}else{dojo.connect(oCloseModalPanelButton,"on"+modalCloseEvent,this,this.closeModalPanel);}},openModalPanel:function(){dojo.style(this.oModalContainer,{visibility:"visible"});},closeModalPanel:function(){dojo.style(this.oModalContainer,{visibility:"hidden"});},_setupConfig:function(config){var cfg=this.cfg;var defCfg=this.DEFAULT_CONFIG;cfg.addProperty(defCfg.OPEN_MODAL_PANEL_EVENT_OPTION.key,{value:defCfg.OPEN_MODAL_PANEL_EVENT_OPTION.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_EVENT_OPTION.key,{value:defCfg.CLOSE_MODAL_PANEL_EVENT_OPTION.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.key,{value:defCfg.CLOSE_MODAL_PANEL_BUTTON_SELECTOR.value});cfg.addProperty(defCfg.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.key,{value:defCfg.CLOSE_MODAL_PANEL_EVENT_FOR_BUTTON_SELECTOR.value});}};dojo.provide("dj.widget.panel.SelectDropdownPanel");dojo.require("dj.util.Element");dojo.require("dj.lang");dojo.declare("dj.widget.panel.SelectDropdownPanel",null,{DEFAULT_CONFIG:{scrollContainerClass:".scroll_container",scrollBarClass:".scrollbar",scrollTrackClass:".scrollbar_container",scrollValuesContainerClass:".scroll_values_container",dropdownCollapsedClassName:"dropdown_collapsed",dropdownExpandedClassName:"dropdown_open",scrollContainerCollapsedClassName:"collapsed",scrollContainerExpandedClassName:"expanded",selectedClassName:".selected",scrollTrackContainerClassName:".scroll_track",dropdownScrollUpArrow:".scroll_up",dropdownScrollDownArrow:".scroll_down",scrollTrackHeight:"154",scrollValuesDisplayHeight:"190",scrollBarArrowShiftValue:"2"},constructor:function(selectDropdownContainer,config){this.cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,config);var scrollBarClass=this.cfg.scrollBarClass;var scrollTrackClass=this.cfg.scrollTrackClass;var scrollContainerClass=this.cfg.scrollContainerClass;var scrollValuesContainerClass=this.cfg.scrollValuesContainerClass;this.oSelectDropDownContainer=dojo.byId(selectDropdownContainer);if(this.oSelectDropDownContainer){this.oScrollBar=dojo.query(scrollBarClass,this.oSelectDropDownContainer)[0];this.oScrollTrack=dojo.query(scrollTrackClass,this.oSelectDropDownContainer)[0];this.oScrollContainer=dojo.query(scrollContainerClass,this.oSelectDropDownContainer)[0];this.oScrollValuesContainer=dojo.query(scrollValuesContainerClass,this.oSelectDropDownContainer)[0];this._setupSelectDropdown(this.oSelectDropDownContainer,this.oScrollContainer,this.oScrollValuesContainer,this.oScrollBar,this.oScrollTrack);}},_setupSelectDropdown:function(oSelectDropdownContainer,oScrollContainer,oScrollValuesContainer,oScrollBar,oScrollTrack){var selectDropdownCollapsedClassName=this.cfg.dropdownCollapsedClassName;var selectDropdownExpandedClassName=this.cfg.dropdownExpandedClassName;var scrollContainerCollapsedClassName=this.cfg.scrollContainerCollapsedClassName;var scrollContainerExpandedClassName=this.cfg.scrollContainerExpandedClassName;var selectedClassName=this.cfg.selectedClassName;this.oSelected=dojo.query(selectedClassName,oSelectDropdownContainer)[0];var toggleDropdownClass=function(){if(dojo.hasClass(oSelectDropdownContainer,selectDropdownCollapsedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownExpandedClassName);}else
if(dojo.hasClass(oSelectDropdownContainer,selectDropdownExpandedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownExpandedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);}
if(dojo.hasClass(oScrollContainer,scrollContainerCollapsedClassName)){dojo.removeClass(oScrollContainer,scrollContainerCollapsedClassName);dojo.addClass(oScrollContainer,scrollContainerExpandedClassName);}else
if(dojo.hasClass(oScrollContainer,scrollContainerExpandedClassName)){dojo.removeClass(oScrollContainer,scrollContainerExpandedClassName);dojo.addClass(oScrollContainer,scrollContainerCollapsedClassName);}};dojo.connect(this.oSelected,"onclick",toggleDropdownClass);dojo.connect(oScrollValuesContainer,"onclick",toggleDropdownClass);dojo.connect(document,"onclick",function(event){var isMousePointerinModalContainer=dj.util.Element.contains(oScrollContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer===false){if(dojo.hasClass(oSelectDropdownContainer,selectDropdownExpandedClassName)){dojo.removeClass(oSelectDropdownContainer,selectDropdownExpandedClassName);dojo.addClass(oSelectDropdownContainer,selectDropdownCollapsedClassName);}
if(dojo.hasClass(oScrollContainer,scrollContainerExpandedClassName)){dojo.removeClass(oScrollContainer,scrollContainerExpandedClassName);dojo.addClass(oScrollContainer,scrollContainerCollapsedClassName);}}});if(oScrollBar&&oScrollBar!==null&&oScrollTrack&&oScrollTrack!==null){dojo.require("dj.widget.Slider");var noOfValues=oScrollValuesContainer.children.length;var scrollTrackHeight=parseInt(this.cfg.scrollTrackHeight,10);var scrollValuesDisplayHeight=parseInt(this.cfg.scrollValuesDisplayHeight,10);var scrollBarHeight=parseInt((scrollTrackHeight/(noOfValues/10)),10);dojo.style(oScrollBar,{height:scrollBarHeight+"px"});var scrollValuesTopShiftFactor=(scrollValuesDisplayHeight/scrollTrackHeight)*(noOfValues/10);var moveDropDown=function(value){var sliderPx=slider.translateToPx(value);var sliderPxValue=sliderPx.replace("px","");dojo.style(oScrollValuesContainer,{top:"-"+sliderPxValue*scrollValuesTopShiftFactor+"px"});};var slider=new dj.widget.Slider(oScrollBar,oScrollTrack,{onSlide:moveDropDown,onChange:moveDropDown,axis:'vertical'});var scrollTrackContainerClass=this.cfg.scrollTrackContainerClassName;this.oScrollTrackContainer=dojo.query(scrollTrackContainerClass,oSelectDropdownContainer)[0];var scrollUpArrowClass=this.cfg.dropdownScrollUpArrow;var scrollDownArrowClass=this.cfg.dropdownScrollDownArrow;this.oScrollUpArrow=dojo.query(scrollUpArrowClass,this.oScrollTrackContainer)[0];this.oScrollDownArrow=dojo.query(scrollDownArrowClass,this.oScrollTrackContainer)[0];var scrollArrowShiftValue=parseInt(this.cfg.scrollBarArrowShiftValue,10);var scrollBarTopPx,scrollBarTop,sliderValue;dojo.connect(this.oScrollUpArrow,"onclick",function(event){scrollBarTop=dojo.style(oScrollBar,"top");sliderValue=slider.translateToValue(scrollBarTop-scrollArrowShiftValue);if(scrollBarTop>0){slider.setValue(sliderValue);}});dojo.connect(this.oScrollDownArrow,"onclick",function(event){scrollBarTop=dojo.style(oScrollBar,"top");sliderValue=slider.translateToValue(scrollBarTop+scrollArrowShiftValue);if(scrollBarTop<(scrollTrackHeight-scrollBarHeight)){slider.setValue(sliderValue);}});}}});
dojo.provide("dj.widget.flash.Flash");dojo.require("dj.util.Cookie");dojo.require("dj.util.Observer");dojo.require("dj.util.Element");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.flash.Flash",null,{constructor:function(idOrDomNode,p,s,params){this.parent=dojo.byId(idOrDomNode);if(this._isWidgetAlreadyHandled()){return;}
dj.util.Element.identify(this.parent);params=dojo.mixin({noload:false,getSettings:true,swfsettings:undefined},params);this.config={};this.config.myMovie='/public/resources/documents/info-flash08-preloader.swf';this.p=p;this.s=s;this.swfsettings=params.swfsettings;this.getSettings=params.getSettings;this.swfPrefix='info-';this.params=params;this._swfFlashvars={};this._swfParams={};this._swfAttributes={};this.settingsObserver=new dj.util.Observer();if(p&&!params.noload){this.load(p,s);}},_isWidgetAlreadyHandled:function(){var isWidgetAlreadyHandled=((typeof dojo.query("div[data-dj-live-widget]",this.parent)[0]==="object")||(typeof dojo.query("div[data-dj-widget]",this.parent)[0]==="object"));if(isWidgetAlreadyHandled){console.info("{Flash} %o will be handled by the util.template.",this.parent.id);return true;}
return false;},load:function(p,s){this.newId();this.settingsObserver.subscribe(this.create,this);this.loadsettings(p,s);if(this.swfsettings){this.create(p,s);}},newId:function(){this.flid="flashdiv_"+Math.floor(Math.random()*999999);},loadsettings:function(p,s){this.p=p;this.s=s;if(!this.getSettings){this.swfsettings={};return;}
this.settingfile='/public/resources/documents/'+this.swfPrefix+p+'-settings.js';if(!this.swfsettings){this.swfsettings=null;var that=this;var deferred=dojo.xhrGet({url:this.settingfile,load:function(data,ioargs){if(!data){return;}
var jso=that._normalizeJsonToObject(data);that.swfsettings=jso.swfsettings;that.settingsObserver.fire(that.p,that.s);},error:function(response,ioargs){console.error("{Flash} HTTP status code: %s, response: %o",ioargs.xhr.status,response);}});}},create:function(p,s){this.createwrapper();this.createflash();this.settingsObserver.unsubscribe(this.create);},createwrapper:function(){this.newId();this.div=document.createElement('div');this.div.setAttribute('id',this.flid);this.parent.appendChild(this.div);},createflash:function(){if(this.so){return;}
this.myMovie=(this.swfsettings.requiredSettings.preloader)?('/public/resources/documents/'+this.swfsettings.requiredSettings.preloader):(this.config.myMovie);this._setSwfParams();this._setSwfFlashvars();this._setSwfAttributes();try{swfobject.embedSWF(this.myMovie,this.flid,this.swfsettings.requiredSettings.swfwidth,this.swfsettings.requiredSettings.swfheight,"9.0.0","",this._swfFlashvars,this._swfParams,this._swfAttributes);}catch(e){console.error("{Flash} threw the following error: %o",e.message);}},_setSwfParams:function(){this._swfParams=dojo.mixin(this._swfParams,{allowScriptAccess:"always",wmode:"opaque",base:"/public/resources/documents",menu:"false",bgcolor:"#FFFFFF",allowfullscreen:"true",height:this.swfsettings.requiredSettings.swfheight});},_setSwfFlashvars:function(){if(this.swfsettings&&this.swfsettings.optionalSettings){for(var setting in this.swfsettings.optionalSettings){if(this.swfsettings.optionalSettings.hasOwnProperty(setting)){this._swfFlashvars[setting]=this.swfsettings.optionalSettings[setting];}}}
if(this.params&&this.params.flashVars){for(var flashVar in this.params.flashvars){if(this.params.flashvars.hasOwnProperty(flashVar)){this._swfFlashvars[flashVar]=this.params.flashvars[flashVar];}}}
this._swfFlashvars.SlugName=this.p;this._swfFlashvars.placement="tab";this.preload='info-'+this.p+'-preload.xml';this._swfFlashvars.PreloaderURL=this.preload;this._swfFlashvars.MovieWidth=this.swfsettings.requiredSettings.swfwidth;this._swfFlashvars.MovieHeight=this.swfsettings.requiredSettings.swfheight;this._swfFlashvars.asub=dj.util.Cookie.getCookie("user_type");this._swfFlashvars.basePath='/public/resources/documents';this._swfFlashvars.cdnDomain=dj.context.core.cdnPrefix;this._swfFlashvars.serverDomain=dj.context.core.urlPrefix;this._swfFlashvars.id=this.s;this._swfFlashvars.PLAYER_ID=this.p;try{console.log("parent.id*************** "+parent.id+" ******************");this._swfFlashvars.containermodule=this.parent.id;}catch(exp){console.error("Error while getting parent.id in Flash.js");}},_setSwfAttributes:function(){this._swfAttributes=dojo.mixin(this._swfAttributes,{id:this.p});},_normalizeJsonToObject:function(response){var json_start=response.indexOf('{');var json_end=response.lastIndexOf('}');if(json_start>-1){response=response.substring(json_start,json_end+1);}
return dojo.fromJson(response);}});dojo.declare("dj.widget.flash.SlideshowFlash",dj.widget.flash.Flash,{constructor:function(id,p,s,noload){this.config.myMovie='/public/resources/documents/info-slideshow08-preloader.swf';window.getContent=this.getContent;},getContent:function(){return null;}});dojo.provide("dj.widget.flash.IssuuFlash");dojo.require("dj.util.Observer");dojo.require("dj.widget.flash.Flash");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.flash.IssuuFlash",dj.widget.flash.Flash,{constructor:function(idOrDomNode,p,s,params){this.omniture={};this.omniture.saveVars=["pageName","section","subsection","aheadline","abasedocid","author","atype","csource","ctype","apage","basesection"];this.omniture.saveValues=[];},hasValidFlashVersion:function(){return(swfobject.getFlashPlayerVersion().major>=9);},nonSupportingFlashPlayer:function(divId){var imagePath=dj.context.core.cdnPrefix+"/img/PDF_screen.jpg";dojo.byId(divId).innerHTML="<div class=\"noFlash-PDF\"><img src=\""+imagePath+"\" alt=\"PDF document available (click to view)\" /></div>";},createIssuuFlash:function(){dj.util.Flash.subscribe("pageChange",this.handlePageChange,this);this._setSwfParams();this._setSwfFlashvars(docId,docName);this._setSwfAttributes();try{swfobject.embedSWF(this.swfsettings.requiredSettings.preloader,this.flid,this.swfsettings.requiredSettings.swfwidth,this.swfsettings.requiredSettings.swfheight,"9.0.0","",this._swfFlashvars,this._swfParams,this._swfAttributes);this.omniturefirepixel("load");}catch(e){console.error("{Flash} threw the following error: %o",e.message);}},createflash:function(){docId='';docName='';pageNum='';if(this.hasValidFlashVersion()){if(this.s!==''){var alternateTxtArr=this.s.split('|');if(alternateTxtArr!==undefined){if(alternateTxtArr[0]!==undefined){docId=alternateTxtArr[0].substr((alternateTxtArr[0].indexOf('=')+1),alternateTxtArr[0].length);}
if(alternateTxtArr[1]!==undefined){docName=alternateTxtArr[1].substr((alternateTxtArr[1].indexOf('=')+1),alternateTxtArr[1].length);if(docName.indexOf(".pdf")===-1){docName=docName+".pdf";}}
if(alternateTxtArr[2]!==undefined){pageNum=alternateTxtArr[2].substr((alternateTxtArr[2].indexOf('=')+1),alternateTxtArr[2].length);}}}
var that=this;var url="/issuuSearch/api/2_0/document?documentId="+docId;dojo.xhrGet({url:url,handleAs:"json",timeout:4000,load:function(response){var docFound=response.response.numFound;if(docFound==="undefined"||docFound===null||docFound===0){window.location="/public/resources/documents/"+docName;}else if(docFound===1){that.createIssuuFlash();}},error:function(error){window.location="/public/resources/documents/"+docName;}});}else{this.nonSupportingFlashPlayer(this.div);}},_setSwfParams:function(){this._swfParams.allowScriptAccess="always";this._swfParams.allowfullscreen="true";this._swfParams.wmode="opaque";this._swfParams.menu=this.swfsettings.optionalSettings.menu;},_setSwfFlashvars:function(docId,docName){this._swfFlashvars.jsAPIClientDomain=this.swfsettings.optionalSettings.jsAPIClientDomain;this._swfFlashvars.placement='tab';this._swfFlashvars.mode='embed';this._swfFlashvars.wmode='opaque';this._swfFlashvars.viewMode=this.swfsettings.optionalSettings.viewMode;this._swfFlashvars.layout=this.swfsettings.optionalSettings.layout;this._swfFlashvars.showFlipBtn='false';this._swfFlashvars.jsAPIInitCallback='addEventHandler';this._swfFlashvars.documentId=docId;this._swfFlashvars.docName=docName;this._swfFlashvars.pageNumber=pageNum;this._swfFlashvars.username=this.swfsettings.optionalSettings.username;this._swfFlashvars.loadingInfoText=this.swfsettings.optionalSettings.loadingInfoText;this._swfFlashvars.et='1251461518896';this._swfFlashvars.er='26';},_setSwfAttributes:function(){this._swfAttributes.id='issuuViewer';},handlePageChange:function(documentId){this.omniturefirepixel("change");},omnituresavepixel:function(){var svlen=this.omniture.saveVars.length;for(var f=0;f<svlen;f++){this.omniture.saveValues[f]=this.omniture.pixel.getMetaData(this.omniture.saveVars[f]);}},omniturerestorepixel:function(){var svlen=this.omniture.saveVars.length;for(var f=0;f<svlen;f++){this.omniture.pixel.setMetaData(this.omniture.saveVars[f],this.omniture.saveValues[f]);}},omniturefirepixel:function(event){var viewer=document.getElementById('issuuViewer');var pageNumber=pageNum;if(pageNumber===0||pageNumber===""){pageNumber=1;}
var pageCount=0;if(viewer!==null&&event==="change"){pageNumber=viewer.getPageNumber();pageCount=viewer.getPageCount();}
pageName='WSJ_PDF_'+docId+'_pdf_'+pageNumber+' of '+pageCount;if(!this.omniture.pixel){this.omniture.pixel=dj.util.Tracking.omniture;}
var wsjPrefix='WSJ_';this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData('section',"Multimedia");this.omniture.pixel.setMetaData('pageName',pageName);this.omniture.pixel.setMetaData('atype','WSJ_Multimedia_PDFs');var subsection=s.prop2;var section=subsection;if(subsection!=="undefined"&&subsection.indexOf(wsjPrefix)!==-1){section=subsection.substring(wsjPrefix.length,subsection.length);if(subsection==="WSJ_Infographic"){this.omniture.pixel.setMetaData('basesection',"WSJ_PDFs");}else{this.omniture.pixel.setMetaData('basesection',this.omniture.basesection);}}
this.omniture.pixel.setMetaData('aheadline','WSJ_pdf_'+section+"_"+s.prop4);this.omniture.pixel.setMetaData('csource','DJ PDFs');this.omniture.pixel.setMetaData('ctype','pdfs');this.omniture.pixel.setMetaData('caccess','free');this.omniture.pixel.setMetaData('abasedocid',"pdf_"+docId);this.omniture.pixel.setMetaData('apage',"WSJ_Multimedia_PDFs");this.omniture.pixel.firePixel(true);this.omniturerestorepixel();}});function addEventHandler(){try{var viewer=document.getElementById('issuuViewer');document.getElementById("issuuViewer").addEventListener("change","dj.util.Flash.pageChange");}catch(err){console.info(" error calling callback function by Issuu "+err);}}
(function(){var dju=dj.util,obs=new dju.Observer(dj.util.Video);dj.util.Flash={subscribe:function(flashEventName,callback,context){obs.subscribeByName(flashEventName,callback,context);},pageChange:function(documentId){obs.fireByName("pageChange",documentId);}};}());dojo.provide("dj.util.flash.template");dojo.require("dj.util.Element");dojo.require("dj.util.Template");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.flash.Flash");dj.util.flash.template={scan:function(){var that=this;dojo.query("div[data-dj-widget=flash.Template]").forEach(function(domNode){try{if(that._isInitialized(domNode)){return;}
that._markAsInitialized(domNode);var dataset=that._getDatasetFromWidget(domNode);if(that._hasValidFlashVersion()){that._handleFlash(domNode,dataset);}else if(dataset.djHideIfNoFlash=="true"){that._destroyWidget(domNode);}else{that._setMagicDatapoints(dataset);that._handleTemplate(domNode,dataset);}}catch(e){console.error("{flash.Template} threw the following error: %s",e.message);}});dojo.query("div[data-dj-live-widget=slideshow.nonflash]").forEach(function(domNode){try{if(that._isInitialized(domNode)){return;}
that._markAsInitialized(domNode);var dataset=that._getDatasetFromWidget(domNode);if(dataset.djWidgetType=="largeSlideshow"){dj.widget.article.slideshow.nonflashSlideshow.init({containerId:"slideContainer",adRefreshCounter:dataset.djWidgetAdrefreshcounter});var a=new dj.util.Ads().loadAds("slideshow");if(dojo.getObject("dj.util.onVisibleWidget",true).scan){dj.util.onVisibleWidget.scan();}}else if(dataset.djWidgetType=="slideshow.explore"){dj.widget.article.slideshow.nonflashSlideshow.initExplore();}}catch(e){console.error("{flash.Template} threw the following error: %s",e.message);}});},_isInitialized:function(domNode){return(dj.util.Element.getData(domNode,"isInitialized")=="true");},_markAsInitialized:function(domNode){dj.util.Element.setData(domNode,"isInitialized","true");},_hasValidFlashVersion:function(){return(swfobject.getFlashPlayerVersion().major>=9);},_handleFlash:function(domNode,dataset){var hasFlashSettings=dataset.flashSettings;var options=hasFlashSettings?{noload:true,swfsettings:dojo.fromJson(dataset.flashSettings).swfsettings}:{};var fl=new dj.widget.flash.Flash(domNode,dataset.flashProject,dataset.flashSecondParam,options);if(hasFlashSettings){fl.create(dataset.flashProject,dataset.flashSecondParam);}},_destroyWidget:function(domNode){var parent=domNode.parentNode;dojo.destroy(domNode);var textarea=dojo.query("textarea",parent)[0];if(textarea){dojo.destroy(textarea);}
this._recursivelyDestroyEmptyParents(parent);},_recursivelyDestroyEmptyParents:function(parent){var numOfChildren=dojo.query("*",parent).length;if(numOfChildren===0){var itsParent=parent.parentNode;dojo.destroy(parent);this._recursivelyDestroyEmptyParents(itsParent);}},_setMagicDatapoints:function(dataset){dataset.djIsFlashPossible=this._isFlashPossible();},_handleTemplate:function(domNode,dataset){var template=this._getTemplateFromWidget(domNode);this._renderTemplate(domNode,template,dataset);},_getTemplateFromWidget:function(domNode){var template=dojo.query("textarea",domNode)[0];if(!template){throw new Error("{flash.Template} no template domNode found in %o",domNode);}
return this._stripCdataTags(template.value);},_getDatasetFromWidget:function(domNode){var dataset=dj.util.Element.getDataset(domNode);delete dataset.djWidget;return dataset;},_renderTemplate:function(domNode,template,dataset){domNode.innerHTML=dj.util.Template.parseTemplate(template).process(dataset);},_stripCdataTags:function(string){string=string.replace(/\s*<!\[CDATA\[\s*/,"");string=string.replace(/\s*\]\]>\s*/,"");return string;},_isFlashPossible:function(){var userAgentString=navigator.userAgent.toLowerCase(),isIphone=(userAgentString.indexOf("iphone")>-1),isIpad=(userAgentString.indexOf("ipad")>-1);return(dojo.isBrowser&&!(isIphone||isIpad));}};
dojo.provide("dj.util.account");dojo.require("dj.lang");dj.util.account={getAccountData:function(url,params){params.responseType=(!params.responseType)?"application/json":params.responseType;var isResponseJson=(params.responseType.indexOf("json")>-1);this._sendXhrRequest(url,params,{requestMethod:"GET",handleAs:(isResponseJson)?"json":"text",requestHeaders:{"Accept":params.responseType}});},postAccountData:function(url,postData,params){params.requestType=(!params.requestType)?"application/json":params.requestType;this._sendXhrRequest(url,params,{requestMethod:"POST",content:postData,requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":params.requestType}});},putAccountData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"PUT",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"}});},_sendXhrRequest:function(requestUrl,userParams,requestOptions){var params=dj.lang.cloneMixin({callback:function(){}},userParams);var options=dj.lang.cloneMixin({requestHeaders:{"Accept":"application/json"},handleAs:"json"},requestOptions);var xhrReq=this._getRequestByMethod(options.requestMethod);var deferred=xhrReq({url:requestUrl,headers:options.requestHeaders,handleAs:options.handleAs,postData:options.content,timeout:dj.context.account.serviceTimeOut,load:function(data,ioargs){params.callback.apply(params.context,[data,ioargs.xhr,params]);},error:function(data,ioargs){console.error("HTTP status code: %s, response: %o",ioargs.xhr.status,data);if(typeof params.errorCallback!=="undefined"){params.errorCallback.apply(params.context,[data.status,ioargs.xhr,params]);}else{params.callback.apply(params.context,[data.status,ioargs.xhr,params]);}}});return deferred;},_getRequestByMethod:function(requestMethod){return(requestMethod=="GET")?dojo.xhrGet:dojo.xhrPost;}};dojo.provide("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.user.EnvironmentDao");dojo.require("dj.util.Url");dojo.declare("dj.widget.loader.LoadPageFragment",null,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.getGreyBckgroundCSSDiv="getGreyBckgroundCSSDiv";this.scrimManagerFile=dj.context.account.scrimManagerFilePath;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:5.9},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(ev){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this);});},initScrim:function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this);},getScrimContents:function(domNodeId,mstPageId,callback,context){var dao=new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User);var userEnv=dao.getEnvironment();var loader=new dj.widget.fragmentloader.FragmentLoader(userEnv,mstPageId,this._cfg.version,domNodeId,this._cfg);loader.load();dojo.connect(loader,"onJsLoad",this,function(){if(typeof callback!="undefined"&&typeof callback==='function'){callback.call(context);}});},initLoader:function(domNodeId,mstPageId,callback,context){var domNodeDiv=dojo.byId(domNodeId);if(domNodeDiv!=null&&dj.lang.trim(domNodeDiv.innerHTML)!=""){if(dojo.hasClass(domNodeDiv,"initialLoad")){dojo.removeClass(domNodeDiv,"initialLoad");context.scrimCallback(true);}else{context.showScrim(domNodeId);}}else{if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles();}
dojo.destroy("overlayDiv");dojo.create("div",{id:domNodeId},this.getGreyBckgroundCSSDiv,"last");this.getScrimContents(domNodeId,mstPageId,callback,context);}},initIframeLoader:function(height,width){this._cfg.domNodeId="overlayDiv";if(dojo.byId(this._cfg.domNodeId)==null||dj.lang.trim(dojo.byId(this._cfg.domNodeId).innerHTML)==""){if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles();}
if(dojo.byId("loginScrimLoader")==null){dojo.create("div",{id:"loginScrimLoader","class":"login_scrim_loader"},this.getGreyBckgroundCSSDiv,"last");dojo.byId("loginScrimLoader").innerHTML='<h4>'+dj.context.account.loading+'</h4>';}
dojo.create("div",{id:this._cfg.domNodeId,"class":"login_scrim_wrapper hidden"},this.getGreyBckgroundCSSDiv,"last");dojo.create("div",{id:"inner","class":"login_scrim_inner"},this._cfg.domNodeId,"last");dojo.create("div",{id:"module","class":"login_scrim_module"},"inner","last");dojo.create("div",{id:"iframe_headerStrap","class":"headerStrap"},"module","last");dojo.byId("iframe_headerStrap").innerHTML='<a href="#" class="closeBtn iframeOverlayCloseBtn">'+dj.context.account.closeText+'</a>';this.addListnerForCloseButton();}else{dojo.addClass(this._cfg.domNodeId,"hidden");if(typeof this.userdata!="undefined"&&(typeof this.userdata.screenName!="undefined"||typeof this.userdata.confScreenName!="undefined")){if(this.userdata.screenName=="LoginVerifyEmail"||this.userdata.confScreenName=="LoginVerifyEmail"||this.userdata.screenName=="UnverifiedFreeReg"||this.userdata.confScreenName=="UnverifiedFreeReg"){this.addListnerForCloseButton();}}}
var iframeId="module"+"iframe";if(dojo.byId(iframeId)==null||dj.lang.trim(dojo.byId(iframeId)).innerHTML==""){this.disableIPadScroll();this.initIFrame("module",height,width);}else{this.fadeScrim(iframeId,300);dojo.removeClass(dojo.byId("module"),"hidden");}},addListnerForCloseButton:function(){dojo.query(".iframeOverlayCloseBtn").connect("click",this,function(ev){dojo.stopEvent(ev);this.enableIPadScroll();dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId(this.getGreyBckgroundCSSDiv));this.destroyAccountInstanceArr();if(typeof this.userdata!="undefined"&&(typeof this.userdata.screenName!="undefined"||typeof this.userdata.confScreenName!="undefined")){if(this.userdata.screenName=="LoginVerifyEmail"||this.userdata.confScreenName=="LoginVerifyEmail"){parent.location=decodeURIComponent(this.userdata.refreshPageUrlForUnverifiedSub);}else if(this.userdata.screenName=="UnverifiedFreeReg"||this.userdata.confScreenName=="UnverifiedFreeReg"){this.initIFrameForLogout();}}});},enableIPadScroll:function(){document.ontouchmove=function(e){return true;}},disableIPadScroll:function(){document.ontouchmove=function(e){return false;}},initIFrameForLogout:function(){var logoutDomNodeId="unverifiedFreeReglogout";if(dojo.byId(logoutDomNodeId)==null){dojo.create("div",{id:logoutDomNodeId,"class":"hidden"},dojo.body(),"last");}
var url="http://"+document.domain+"/logout";if(window.console)console.log("url for logout "+url);var options={"src":url,"class":"hidden"};setTimeout(this.isUserLoggedout,10000);dj.util.Url.createSimpleIframe(options,logoutDomNodeId,this.testLogoutIframeLoaded,this);},testLogoutIframeLoaded:function(){this.userLoggedOut=true;dojo.destroy("unverifiedFreeReglogout");},isUserLoggedout:function(){if(!this.userLoggedOut){if(window.console)console.warn(" unverified free reg user couldn't be logged out ");}},initIFrame:function(domNodeId,height,width){url=dj.context.account.idDomainToHostScrims+this._cfg.mstPageId+".html?successFileUrl="+
encodeURIComponent("http://"+document.domain+this.scrimManagerFile)+"&currentPageUrl="+encodeURIComponent(this.getPageUrl())
+"&region="+encodeURIComponent(dj.util.Region.getViewByRegion());if(typeof this.userdata!="undefined"){if(typeof this.userdata.refreshPageUrlForUnverifiedSub!="undefined"){var urlValue=this.userdata.refreshPageUrlForUnverifiedSub;this.userdata.refreshPageUrlForUnverifiedSub=encodeURIComponent(urlValue);}
url+="&userdata="+dojo.toJson(this.userdata);}
var options={"src":url,"class":"login_scrim_framed","style":{"height":height,"width":width},"allowTransparency":"true"};dj.util.Url.createSimpleIframe(options,domNodeId,this.iframeLoaded,this);},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},iframeLoaded:function(){if(dojo.hasClass(this._cfg.domNodeId,"hidden")){this.fadeScrim(this._cfg.domNodeId,300);if(dojo.byId(this._cfg.domNodeId)!=null){dojo.removeClass(dojo.byId(this._cfg.domNodeId),"hidden");}}},getDomain:function(){var concatURL="";if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){concatURL="http://"+gcDomain;}else{concatURL="http://"+document.domain;}
return concatURL;},getPageUrl:function(){var nonSubscriberHomepagePid=this._cfg.NONSUBSCRIBER_HOMEPAGE_PID;var nonSubscriberSearchPagePid=this._cfg.NONSUBSCRIBER_SEARCH_PAGE_PID;var nonSubNewslettersAlertsPagePid=this._cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID;var mdcPagePid=this._cfg.MDC_PAGE_PID;var concatURL;concatURL=this.getDomain();var oCurrentUrl;if(dojo.isIE){oCurrentUrl=window.location.href;}else{oCurrentUrl=document.location.href;}
var url_value=oCurrentUrl;if(typeof pID!=="undefined"){if(pID===nonSubscriberHomepagePid){url_value=concatURL+this._cfg.HOMEPAGE_SUBSCRIBER_URL;}else if(pID===nonSubNewslettersAlertsPagePid){url_value=concatURL+"/email";}else if(pID===nonSubscriberSearchPagePid){url_value=concatURL+this._cfg.SEARCH_PAGE_SUBSCRIBER_URL;}else if(pID===mdcPagePid){url_value=concatURL+this._cfg.MDC_LINK_URL;}else{url_value=oCurrentUrl;}
var cachebuster=(url_value.indexOf("?")!=-1)?"&":"?";if(typeof cachebuster!==undefined){cachebuster=cachebuster+"_nocache="+new Date().getTime();if(url_value.indexOf("#")!=-1){url_value=url_value.replace("#",cachebuster);}else{url_value=url_value+cachebuster;}}}
return url_value;},initHiddenScrim:function(domNodeId,mstPageId,callback,context){if(typeof mstPageId=="undefined"){mstPageId=this._cfg.mstPageId;}
if(typeof domNodeId=="undefined"){domNodeId=this._cfg.domNodeId;}
if(dojo.byId(domNodeId)==null||dj.lang.trim(dojo.byId(domNodeId).innerHTML)==""){if(dojo.byId(domNodeId)==null){if(dojo.byId(this.getGreyBckgroundCSSDiv)==null){dojo.create("div",{id:this.getGreyBckgroundCSSDiv,"class":"login_overlay"},dojo.body(),"last");this.addclassForArticles();}
dojo.create("div",{id:domNodeId,"class":"hidden initialLoad"},this.getGreyBckgroundCSSDiv,"last");}else{dojo.addClass(dojo.byId(domNodeId),"hidden");}
this.getScrimContents(domNodeId,mstPageId,callback,context);}},fadeScrim:function(domId,fadeDuration){var d=new Date();var _fadeDuration=1000;if(fadeDuration){_fadeDuration=fadeDuration;}
dojo.style(domId,"opacity","0");var fadeArgs={node:domId,duration:_fadeDuration};dojo.fadeIn(fadeArgs).play();},addclassForArticles:function(){if(this.getPageUrl().indexOf("/article/")>0){dojo.addClass(dojo.byId(this.getGreyBckgroundCSSDiv),"article_LIFP");}},setUserdata:function(userdata){this.userdata=userdata;},addToAccountInstanceArr:function(instance){if(typeof dj.module.loader.accountInstanceArr=="undefined"){dj.module.loader.accountInstanceArr=new Array();}
dj.module.loader.accountInstanceArr.push(instance);},addToAccountWidgetInstanceArr:function(instance){},destroyAccountInstanceArr:function(){if(typeof dj.module.loader!="undefined"&&typeof dj.module.loader.accountInstanceArr!="undefined"){while(dj.module.loader.accountInstanceArr.length!=0){var entry=dj.module.loader.accountInstanceArr.pop();if(typeof entry!="undefined"&&typeof entry.destroyObject!="undefined"&&typeof entry.destroyObject=="function"){entry.destroyObject();}}
if(dj.module.loader.accountInstanceArr.length==0){dj.module.loader.accountInstanceArr={};dj.module.loader={};}}}});dojo.provide("dj.widget.loader.FBInitLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FBInitLoader",[],{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.loadpageFragObj=new dj.widget.loader.LoadPageFragment({version:this._cfg.version});},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbInitPageId,domNodeId:"fbInitDivId"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(ev){this.initScrim();});},initScrim:function(){this.isShow=true;if(typeof this.loadStatus!="undefined"){if(this.loadStatus=="loaded"){this.showScrim();}}else{this.loadpageFragObj.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this);}},initHiddenScrim:function(){if(typeof this.isShow=="undefined"&&typeof this.loadStatus=="undefined"){this.isShow=false;this.loadStatus="loading";this.loadpageFragObj.initHiddenScrim(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this);}else{this.isShow=false;}},initScrimFromIframe:function(){this.isShow=true;if(typeof this.loadStatus!="undefined"){if(this.loadStatus=="loaded"){this.showScrim();}}else{this.loadpageFragObj.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this);}},scrimCallback:function(isFadingRequired){this.loadStatus="loaded";if(typeof this.fbInitdWidget!="undefined"&&this.fbInitdWidget!=null){this.fbInitdWidget.init(this._cfg.domNodeId,isFadingRequired,this.isShow);}else{this.fbInitdWidget=new dj.widget.accountscrim.FBInit(this._cfg);this.fbInitdWidget.init(this._cfg.domNodeId,isFadingRequired,this.isShow);this.loadpageFragObj.addToAccountWidgetInstanceArr(this.fbInitdWidget);}},showScrim:function(){if(typeof this.fbInitdWidget!="undefined"&&this.fbInitdWidget!=null){this.fbInitdWidget.showScrim(this._cfg.domNodeId,true);}else{this.fbInitdWidget=new dj.widget.accountscrim.FBInit(this._cfg);this.fbInitdWidget.showScrim(this._cfg.domNodeId,true);this.loadpageFragObj.addToAccountWidgetInstanceArr(this.fbInitdWidget);}},destroyObject:function(){delete this.fbInitdWidget;}});dojo.provide("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._cfg.domNodeId=this.getDomNodeId(userdata);this._cfg.mstPageId=this.getMstPageId(userdata);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"370px",width:"678px"},scrimCallback:function(isFadingRequired){if(typeof this.fbLoginOrWSJPswdConfWidget!="undefined"&&this.fbLoginOrWSJPswdConfWidget!=null){this.fbLoginOrWSJPswdConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.fbLoginOrWSJPswdConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.fbLoginOrWSJPswdConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.fbLoginOrWSJPswdConfWidget);}},showScrim:function(){if(typeof this.fbLoginOrWSJPswdConfWidget!="undefined"&&this.fbLoginOrWSJPswdConfWidget!=null){this.fbLoginOrWSJPswdConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.fbLoginOrWSJPswdConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.fbLoginOrWSJPswdConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.fbLoginOrWSJPswdConfWidget);}},getDomNodeId:function(userdata){return userdata.screenName+"ConfirmationDivId";},getMstPageId:function(userdata){return dj.context.account.fbLoginOrWSJPswdConfPageId;},destroyObject:function(){delete this.fbLoginOrWSJPswdConfWidget;}});dojo.provide("dj.widget.loader.FbLoginOrWSJPswdLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.FbLoginOrWSJPswdLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"fbLoginOrWSJPswdDivId",mstPageId:dj.context.account.fbLoginOrWSJPswdPageId,height:"370px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},destroyObject:function(){delete this.fbLoginOrWSJPswdWidget;}});dojo.provide("dj.widget.loader.ForgotPasswordConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotPasswordConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._cfg.domNodeId=this.getDomNodeId(userdata);this._cfg.mstPageId=this.getMstPageId(userdata);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"340px",width:"678px"},scrimCallback:function(isFadingRequired){if(typeof this.forgotPasswordConfWidget!="undefined"&&this.forgotPasswordConfWidget!=null){this.forgotPasswordConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.forgotPasswordConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotPasswordConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.forgotPasswordConfWidget);}},showScrim:function(){if(typeof this.forgotPasswordConfWidget!="undefined"&&this.forgotPasswordConfWidget!=null){this.forgotPasswordConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.forgotPasswordConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotPasswordConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.forgotPasswordConfWidget);}},getDomNodeId:function(userdata){return userdata.screenName+"ConfirmationDivId";},getMstPageId:function(userdata){return dj.context.account.forgotPasswordConfPageId;},destroyObject:function(){delete this.forgotPasswordConfWidget;}});dojo.provide("dj.widget.loader.ForgotPasswordLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotPasswordLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata={};},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.4,initNodeClass:".forgotPasswordClass",mstPageId:dj.context.account.forgotPasswordPageId,domNodeId:"forgotPasswordDivId",height:"370px",width:"678px"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(ev){this.initIframeLoader(this._cfg.height,this._cfg.width);});},destroyObject:function(){delete this.forgotPasswordWidget;}});dojo.provide("dj.widget.loader.ForgotUsernameConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotUsernameConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._cfg.domNodeId=this.getDomNodeId(userdata);this._cfg.mstPageId=this.getMstPageId(userdata);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"370px",width:"678px"},scrimCallback:function(isFadingRequired){if(typeof this.forgotUsernameConfWidget!="undefined"&&this.forgotUsernameConfWidget!=null){this.forgotUsernameConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.forgotUsernameConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotUsernameConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.forgotUsernameConfWidget);}},showScrim:function(){if(typeof this.forgotUsernameConfWidget!="undefined"&&this.forgotUsernameConfWidget!=null){this.forgotUsernameConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.forgotUsernameConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.forgotUsernameConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.forgotUsernameConfWidget);}},getDomNodeId:function(userdata){return userdata.screenName+"ConfirmationDivId";},getMstPageId:function(userdata){return dj.context.account.forgotUsernameConfPageId;},destroyObject:function(){delete this.forgotUsernameConfWidget;}});dojo.provide("dj.widget.loader.ForgotUserOrPswdLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ForgotUserOrPswdLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata={};},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.4,initNodeClass:".forgotUsernameClass",mstPageId:dj.context.account.forgotUsernamePageId,domNodeId:"forgotUsernameDivId",height:"350px",width:"678px"},init:function(){dojo.query(this._cfg.initNodeClass).connect("click",this,function(ev){this.initIframeLoader(this._cfg.height,this._cfg.width);});},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},destroyObject:function(){delete this.forgotUsernameWidget;}});dojo.provide("dj.widget.loader.LoginVerifyEmailConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.LoginVerifyEmailConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._cfg.domNodeId=this.getDomNodeId(userdata);this._cfg.mstPageId=this.getMstPageId(userdata);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"280px",width:"678px"},scrimCallback:function(isFadingRequired){if(typeof this.loginVerifyConfWidget!="undefined"&&this.loginVerifyConfWidget!=null){this.loginVerifyConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.loginVerifyConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.loginVerifyConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.loginVerifyConfWidget);}},showScrim:function(){if(typeof this.loginVerifyConfWidget!="undefined"&&this.loginVerifyConfWidget!=null){this.loginVerifyConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.loginVerifyConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.loginVerifyConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.loginVerifyConfWidget);}},getDomNodeId:function(userdata){return userdata.screenName+"ConfirmationDivId";},getMstPageId:function(userdata){return dj.context.account.loginVerifyEmailConfPageId;},destroyObject:function(){delete this.loginVerifyConfWidget;}});dojo.provide("dj.widget.loader.LoginVerifyEmailLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.LoginVerifyEmailLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata={};},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"loginVerifyEmailDivId",mstPageId:dj.context.account.loginVerifyEmailPageId,height:"400px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},scrimCallback:function(isFadingRequired){if(typeof this.loginVerifyWidget!="undefined"&&this.loginVerifyWidget!=null){this.loginVerifyWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.loginVerifyWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.loginVerifyWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.loginVerifyWidget);}},showScrim:function(){if(typeof this.loginVerifyWidget!="undefined"&&this.loginVerifyWidget!=null){this.loginVerifyWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.loginVerifyWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.loginVerifyWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.loginVerifyWidget);}},destroyObject:function(){delete this.loginVerifyWidget;}});dojo.provide("dj.widget.loader.ThankYouLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.ThankYouLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"thankYouDivId",mstPageId:dj.context.account.thankYouPageId,height:"280px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},scrimCallback:function(isFadingRequired){if(typeof this.thankYouWidget!="undefined"&&this.thankYouWidget!=null){this.thankYouWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.thankYouWidget=new dj.widget.accountscrim.ThankYou(this._cfg);this.thankYouWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.thankYouWidget);}},showScrim:function(){if(typeof this.thankYouWidget!="undefined"&&this.thankYouWidget!=null){this.thankYouWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.thankYouWidget=new dj.widget.accountscrim.ThankYou(this._cfg);this.thankYouWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.thankYouWidget);}},destroyObject:function(){delete this.thankYouWidget;}});dojo.provide("dj.widget.loader.UnverifiedFreeRegConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UnverifiedFreeRegConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._cfg.domNodeId=this.getDomNodeId(userdata);this._cfg.mstPageId=this.getMstPageId(userdata);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,height:"280px",width:"678px"},scrimCallback:function(isFadingRequired){if(typeof this.unverifiedFreeRegConfWidget!="undefined"&&this.unverifiedFreeRegConfWidget!=null){this.unverifiedFreeRegConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.unverifiedFreeRegConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.unverifiedFreeRegConfWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegConfWidget);}},showScrim:function(){if(typeof this.unverifiedFreeRegConfWidget!="undefined"&&this.unverifiedFreeRegConfWidget!=null){this.unverifiedFreeRegConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.unverifiedFreeRegConfWidget=new dj.widget.accountscrim.Confirmation(this._cfg);this.unverifiedFreeRegConfWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegConfWidget);}},getDomNodeId:function(userdata){return userdata.screenName+"ConfirmationDivId";},getMstPageId:function(userdata){return dj.context.account.unverifiedFreeRegConfPageId;},destroyObject:function(){delete this.unverifiedFreeRegConfWidget;}});dojo.provide("dj.widget.loader.UnverifiedFreeRegLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UnverifiedFreeRegLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata={};},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"unverifiedFreeRegDivId",mstPageId:dj.context.account.unverifiedFreeRegPageId,height:"400px",width:"678px"},initScrimFromIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},scrimCallback:function(isFadingRequired){if(typeof this.unverifiedFreeRegWidget!="undefined"&&this.unverifiedFreeRegWidget!=null){this.unverifiedFreeRegWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);}else{this.unverifiedFreeRegWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.unverifiedFreeRegWidget.init(this._cfg.domNodeId,this.userdata,isFadingRequired);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegWidget);}},showScrim:function(){if(typeof this.unverifiedFreeRegWidget!="undefined"&&this.unverifiedFreeRegWidget!=null){this.unverifiedFreeRegWidget.showScrim(this._cfg.domNodeId,this.userdata,true);}else{this.unverifiedFreeRegWidget=new dj.widget.accountscrim.LoginVerifyEmail(this._cfg);this.unverifiedFreeRegWidget.showScrim(this._cfg.domNodeId,this.userdata,true);this.addToAccountWidgetInstanceArr(this.unverifiedFreeRegWidget);}},destroyObject:function(){delete this.unverifiedFreeRegWidget;}});dojo.provide("dj.widget.loader.UserWithourEmailConfirmationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UserWithourEmailConfirmationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,domNodeId:"userWithoutEmailConfDivId",mstPageId:dj.context.account.userWithoutEmailConfPageId,height:"350px",width:"678px"},scrimCallback:function(isFadingRequired){var userrWithoutEmailConfObj=new dj.widget.accountscrim.UserWithoutEmailConfirmation(this._cfg);userrWithoutEmailConfObj.init(this._cfg.domNodeId,this.userdata,isFadingRequired);},showScrim:function(){var userrWithoutEmailConfObj=new dj.widget.accountscrim.UserWithoutEmailConfirmation(this._cfg);userrWithoutEmailConfObj.showScrim(this._cfg.domNodeId,this.userdata,true);}});dojo.provide("dj.widget.loader.UserWithoutEmailLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.declare("dj.widget.loader.UserWithoutEmailLoader",dj.widget.loader.LoadPageFragment,{constructor:function(userdata,cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.userdata=userdata;},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.5,mstPageId:dj.context.account.userWithoutEmailPageId,domNodeId:"changeUsernameDivId",height:"400px",width:"678px"},chkIfUserWoEmail:function(){var paramString=dojo.queryToObject(window.location.search.slice(1));if(typeof paramString.user!='undefined'&&paramString.user=="welcome"){var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){if(!djcs.UserInfo.hasRole('SEAMLESS')){if(dojo.byId("userEmailId_temp")!=null){dojo.byId("userEmailId_temp").innerHTML="";}else{dojo.create("div",{id:"userEmailId_temp"},dojo.body());}
dj.util.User.renderEmailAddress("userEmailId_temp");var userEmail=dojo.byId("userEmailId_temp").innerHTML;var verifyEmails=['dupe@wsj.com','cancel@dowjones.com','canceled@wsj.com','cancelled@wsj.com','dup@wsj.com','cancel@wsj.com','dupe@wsj.com','test@test.com','cancel@dj.com','dup@dowjones.com','duplicate@wsj.com','refused@wsj.com'];var contains=dojo.indexOf(verifyEmails,userEmail);if(typeof userEmail=="undefined"||userEmail=="undefined"||userEmail==""||contains>0){that.initIframeLoader(that._cfg.height,that._cfg.width);}}}else{}});}},scrimCallback:function(isFadingRequired){var userWithoutEmailObj=new dj.widget.accountscrim.UserWithoutEmail(this._cfg);userWithoutEmailObj.init(this._cfg.domNodeId,isFadingRequired);},showScrim:function(){var userWithoutEmailObj=new dj.widget.accountscrim.UserWithoutEmail(this._cfg);userWithoutEmailObj.showScrim(this._cfg.domNodeId,true);}});dojo.provide("dj.service.account.LoginService");dojo.require("dj.util.account");dojo.require("dj.util.Observer");dj.service.account.LoginService={loginUser:function(url,postData,loadCallback,errorCallback,context){var clientInfo={loadCallback:loadCallback,errorCallback:errorCallback,context:context};dj.util.account.postAccountData(url,postData,{callback:this.handleSuccessResp,errorCallback:this.handleErrorResp,context:this,url:url,responseType:"application/json",clientInfo:clientInfo});},handleErrorResp:function(response,xhr,params){var resp="";var errorsFromSvcArr=new Array();if(xhr.status=='404'||xhr.status=='500'){errorsFromSvcArr[0]="generalError";}else if(xhr.status=='503'||xhr.status=='403'){errorsFromSvcArr[0]="unavailableError";}else{resp=dojo.fromJson(xhr.responseText);if(typeof resp["user-status"]!="undefined"){errorsFromSvcArr[0]=resp["user-status"];}else{var errorsArr=resp.errors;dojo.forEach(errorsArr,function(entry,i){errorsFromSvcArr[i]=entry.name+entry.status;});}}
params.clientInfo.errorCallback.apply(params.clientInfo.context,[errorsFromSvcArr]);},handleSuccessResp:function(response,xhr,params){if(xhr.status=='200'){params.clientInfo.loadCallback.call(params.clientInfo.context,response);}},testLogin:function(url,postData,loadCallback,errorCallback,context){var clientInfo={loadCallback:loadCallback,errorCallback:errorCallback,context:context};dj.util.account.postAccountData(url,postData,{callback:this.handleLoginSuccess,errorCallback:this.handleLoginError,context:this,url:url,responseType:"application/json",clientInfo:clientInfo});},handleLoginSuccess:function(response,xhr,params){params.clientInfo.loadCallback.call(params.clientInfo.context,response);},handleLoginError:function(response,xhr,params){params.clientInfo.errorCallback.call(params.clientInfo.context,response);}};dojo.provide("dj.service.account.RegistrationService");dojo.require("dj.util.account");dojo.require("dj.util.Observer");dj.service.account.RegistrationService={registerUser:function(url,postData,loadCallback,errorCallback,context){var clientInfo={loadCallback:loadCallback,errorCallback:errorCallback,context:context};dj.util.account.postAccountData(url,postData,{callback:this.handleSuccessResp,errorCallback:this.handleErrorResp,context:this,url:url,responseType:"application/json",requestType:"application/x-www-form-urlencoded;charset="+document.characterSet,clientInfo:clientInfo});},handleErrorResp:function(response,xhr,params){var errorsFromSvcArr=new Array();if(xhr.status=='404'||xhr.status=='500'){errorsFromSvcArr[0]="generalError";}else if(xhr.status==412){var resp=dojo.fromJson(xhr.responseText);if(resp.status=="precondition_failed"){var errorsObj=resp.profile.errors;errorsFromSvcArr[0]=errorsObj.emailAddress;if(typeof errorsObj.emailAddress=="undefined"){errorsFromSvcArr[0]="generalError";}}}else if(xhr.status=='503'||xhr.status=='403'){errorsFromSvcArr[0]="unavailableError";}
params.clientInfo.errorCallback.apply(params.clientInfo.context,[errorsFromSvcArr]);},handleSuccessResp:function(response,xhr,params){if(xhr.status=='200'){var emailId=response.profile.emailAddress;params.clientInfo.loadCallback.call(params.clientInfo.context,emailId);}},changeUsername:function(url,postData,loadCallback,errorCallback,context){var clientInfo={loadCallback:loadCallback,errorCallback:errorCallback,context:context};dj.util.account.postAccountData(url,postData,{callback:this.handleChangeUsernameSuccessResp,errorCallback:this.handleChangeUsernameErrorResp,context:this,url:url,responseType:"application/json",requestType:"application/x-www-form-urlencoded;charset="+document.characterSet,clientInfo:clientInfo});},handleChangeUsernameErrorResp:function(response,xhr,params){var errorsFromSvcArr=new Array();if(xhr.status=='404'||xhr.status=='500'){errorsFromSvcArr[0]="generalError";}else if(xhr.status==412){var resp=dojo.fromJson(xhr.responseText);if(resp.status=="precondition_failed"){var errorsObj=resp.profile.errors;errorsFromSvcArr[0]=errorsObj.username;if(typeof errorsObj.username=="undefined"){errorsFromSvcArr[0]="generalError";}}}else if(xhr.status=='503'||xhr.status=='403'){errorsFromSvcArr[0]="unavailableError";}
params.clientInfo.errorCallback.apply(params.clientInfo.context,[errorsFromSvcArr]);},handleChangeUsernameSuccessResp:function(response,xhr,params){if(xhr.status=='200'){var uuid=response.profile.uuid;params.clientInfo.loadCallback.call(params.clientInfo.context,uuid);}},getNodeValue:function(tree,el){return tree.getElementsByTagName(el)[0].firstChild.nodeValue;},getNode:function(tree,el){return tree.getElementsByTagName(el)[0];},getAttribute:function(tree,el){return tree.getAttribute(el);}};dojo.provide("dj.widget.loader.FBConnectedLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.util.Ads");dojo.declare("dj.widget.loader.FBConnectedLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbConnectedPageId,domNodeId:"fbConnectedDivId"},initScrimFromIframe:function(){this.initLoader(this._cfg.domNodeId,this._cfg.mstPageId,this.scrimCallback,this);},scrimCallback:function(isFadingRequired){if(typeof this.fbConnectedWidget!="undefined"&&this.fbConnectedWidget!=null){this.fbConnectedWidget.init(this._cfg.domNodeId,isFadingRequired);}else{this.fbConnectedWidget=new dj.widget.accountscrim.FBConnected(this._cfg);this.fbConnectedWidget.init(this._cfg.domNodeId,isFadingRequired);this.addToAccountWidgetInstanceArr(this.fbConnectedWidget);}
new dj.util.Ads().loadAds("facebook2");},showScrim:function(){if(typeof this.fbConnectedWidget!="undefined"&&this.fbConnectedWidget!=null){this.fbConnectedWidget.showScrim(this._cfg.domNodeId,true);}else{this.fbConnectedWidget=new dj.widget.accountscrim.FBConnected(this._cfg);this.fbConnectedWidget.showScrim(this._cfg.domNodeId,true);this.addToAccountWidgetInstanceArr(this.fbConnectedWidget);}
new dj.util.Ads().loadAds("facebook2");},destroyObject:function(){delete this.fbConnectedWidget;}});dojo.provide("dj.widget.loader.LoginLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.util.Region");dojo.declare("dj.widget.loader.LoginLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".loginClass",mstPageId:dj.context.account.loginOverlayPageId,domNodeId:"loginDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:dj.context.account.loginOverlayHeight,width:dj.context.account.loginOverlayWidth,isMobile:false},init:function(){if(window.console)console.log("this._cfg.initNodeClass "+this._cfg.initNodeClass);dojo.query(this._cfg.initNodeClass).connect("click",this,function(ev){dojo.stopEvent(ev);this.redirectIfMobileUser();});},initLoginScrimInIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},isGermanyProduct:function(){if(dj.util.Region.getViewByRegion()==="germany"){return true;}
return false;},redirectIfMobileUser:function(){var that=this;if(navigator.userAgent.search(/Mobile/i)>-1&&!that.isGermanyProduct()){var deferred=dojo.xhrGet({url:'/static_html_files/mobile/mobileDevices.json',headers:{Accept:'application/json'},handleAs:"json",load:function(data){if(data.hasOwnProperty("deviceList")){var devices;for(devices in data.deviceList){device=data.deviceList[devices];if(new RegExp(device.OS,"i").test(navigator.userAgent)){that._cfg.isMobile=true;break;}}}},error:function(response,ioArgs){console.error("HTTP status code: ",ioArgs.xhr.status);}});deferred.then(function(data){if(that._cfg.isMobile){window.location=dj.context.core.secureLoginPrefix+"/content/public/page/login-mobile.html";}
else{that.initIframeLoader(that._cfg.height,that._cfg.width);}},function(error){console.log("errror"+error);});}
else
{this.initIframeLoader(this._cfg.height,this._cfg.width);}}});dojo.provide("dj.widget.loader.LoaderInstanceFactory");dj.widget.loader.LoaderInstanceFactory={intializeLoader:function(){if(dj.module.loader==null||typeof dj.module.loader=="undefined"){dj.module.loader={};}},getLoginLoaderInstance:function(cfg){this.intializeLoader();if(typeof dj.module.loader.loginLoaderObj=="undefined"||dj.module.loader.loginLoaderObj==null){var cfgObj={};if(typeof cfg!="undefined"){cfgObj={isLoadJs:cfg.isLoadJs,version:cfg.version};}
dj.module.loader.loginLoaderObj=new dj.widget.loader.LoginLoader(cfgObj);dj.module.loader.loginLoaderObj.addToAccountInstanceArr(dj.module.loader.loginLoaderObj);}
return dj.module.loader.loginLoaderObj;},getRegistrationLoaderInstance:function(){this.intializeLoader();if(typeof dj.module.loader.registrationLoaderObj=="undefined"||dj.module.loader.registrationLoaderObj==null){dj.module.loader.registrationLoaderObj=new dj.widget.loader.RegistrationLoader();dj.module.loader.registrationLoaderObj.addToAccountInstanceArr(dj.module.loader.registrationLoaderObj);}
return dj.module.loader.registrationLoaderObj;},getForgotUserOrPswdLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.forgotUserOrPswdLoaderObj=="undefined"||dj.module.loader.forgotUserOrPswdLoaderObj==null){dj.module.loader.forgotUserOrPswdLoaderObj=new dj.widget.loader.ForgotUserOrPswdLoader();dj.module.loader.forgotUserOrPswdLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotUserOrPswdLoaderObj);}
dj.module.loader.forgotUserOrPswdLoaderObj.setUserdata(userdata);return dj.module.loader.forgotUserOrPswdLoaderObj;},getForgotPasswordLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.forgotPasswordLoaderObj=="undefined"||dj.module.loader.forgotPasswordLoaderObj==null){dj.module.loader.forgotPasswordLoaderObj=new dj.widget.loader.ForgotPasswordLoader();dj.module.loader.forgotPasswordLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotPasswordLoaderObj);}
dj.module.loader.forgotPasswordLoaderObj.setUserdata(userdata);return dj.module.loader.forgotPasswordLoaderObj;},getFBInitLoaderInstance:function(cfg){this.intializeLoader();if(typeof dj.module.loader.fbInitLoaderObj=="undefined"||dj.module.loader.fbInitLoaderObj==null){dj.module.loader.fbInitLoaderObj=new dj.widget.loader.FBInitLoader();dj.module.loader.fbInitLoaderObj.loadpageFragObj.addToAccountInstanceArr(dj.module.loader.fbInitLoaderObj);}
return dj.module.loader.fbInitLoaderObj;},getLoginVerifyEmailLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.loginVerifyEmailLoaderObj=="undefined"||dj.module.loader.loginVerifyEmailLoaderObj==null){dj.module.loader.loginVerifyEmailLoaderObj=new dj.widget.loader.LoginVerifyEmailLoader();dj.module.loader.loginVerifyEmailLoaderObj.addToAccountInstanceArr(dj.module.loader.loginVerifyEmailLoaderObj);}
dj.module.loader.loginVerifyEmailLoaderObj.setUserdata(userdata);return dj.module.loader.loginVerifyEmailLoaderObj;},getUnverifiedFreeRegLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.unverifiedFreeRegLoaderObj=="undefined"||dj.module.loader.unverifiedFreeRegLoaderObj==null){dj.module.loader.unverifiedFreeRegLoaderObj=new dj.widget.loader.UnverifiedFreeRegLoader();dj.module.loader.unverifiedFreeRegLoaderObj.addToAccountInstanceArr(dj.module.loader.unverifiedFreeRegLoaderObj);}
dj.module.loader.unverifiedFreeRegLoaderObj.setUserdata(userdata);return dj.module.loader.unverifiedFreeRegLoaderObj;},getFbLoginOrWSJPswdLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.fbLoginOrWSJPswdLoaderObj=="undefined"||dj.module.loader.fbLoginOrWSJPswdLoaderObj==null){dj.module.loader.fbLoginOrWSJPswdLoaderObj=new dj.widget.loader.FbLoginOrWSJPswdLoader();dj.module.loader.fbLoginOrWSJPswdLoaderObj.addToAccountInstanceArr(dj.module.loader.fbLoginOrWSJPswdLoaderObj);}
dj.module.loader.fbLoginOrWSJPswdLoaderObj.setUserdata(userdata);return dj.module.loader.fbLoginOrWSJPswdLoaderObj;},getThankYouLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.thankYouLoaderObj=="undefined"||dj.module.loader.thankYouLoaderObj==null){dj.module.loader.thankYouLoaderObj=new dj.widget.loader.ThankYouLoader();dj.module.loader.thankYouLoaderObj.addToAccountInstanceArr(dj.module.loader.thankYouLoaderObj);}
dj.module.loader.thankYouLoaderObj.setUserdata(userdata);return dj.module.loader.thankYouLoaderObj;},getUserWithourEmailConfirmationLoaderInstance:function(userdata){this.intializeLoader();if(typeof dj.module.loader.userWithourEmailConfirmationLoaderObj=="undefined"||dj.module.loader.userWithourEmailConfirmationLoaderObj==null){dj.module.loader.userWithourEmailConfirmationLoaderObj=new dj.widget.loader.UserWithourEmailConfirmationLoader();dj.module.loader.userWithourEmailConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.userWithourEmailConfirmationLoaderObj);}
dj.module.loader.userWithourEmailConfirmationLoaderObj.setUserdata(userdata);return dj.module.loader.userWithourEmailConfirmationLoaderObj;},getFBConnectedLoaderInstance:function(cfg){this.intializeLoader();if(typeof dj.module.loader.fbConnectedLoaderObj=="undefined"||dj.module.loader.fbConnectedLoaderObj==null){dj.module.loader.fbConnectedLoaderObj=new dj.widget.loader.FBConnectedLoader({isLoadJs:cfg.isLoadJs,version:cfg.version});dj.module.loader.fbConnectedLoaderObj.addToAccountInstanceArr(dj.module.loader.fbConnectedLoaderObj);}
return dj.module.loader.fbConnectedLoaderObj;},getConfirmationLoaderInstance:function(userdata){this.intializeLoader();if(typeof userdata!="undefined"){if(userdata.confScreenName==="LoginVerifyEmail"){dojo.require("dj.widget.loader.LoginVerifyEmailConfirmationLoader");if(typeof dj.module.loader.loginVerifyEmailConfirmationLoaderObj=="undefined"||dj.module.loader.loginVerifyEmailConfirmationLoaderObj==null){dj.module.loader.loginVerifyEmailConfirmationLoaderObj=new dj.widget.loader.LoginVerifyEmailConfirmationLoader(userdata);dj.module.loader.loginVerifyEmailConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.loginVerifyEmailConfirmationLoaderObj);}
dj.module.loader.loginVerifyEmailConfirmationLoaderObj.setUserdata(userdata);return dj.module.loader.loginVerifyEmailConfirmationLoaderObj;}else if(userdata.confScreenName==="FbLoginOrWSJPswd"){dojo.require("dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader");if(typeof dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj=="undefined"||dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj==null){dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj=new dj.widget.loader.FbLoginOrWSJPswdConfirmationLoader(userdata);dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj);}
dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj.setUserdata(userdata);return dj.module.loader.fbLoginOrWSJPswdConfirmationLoaderObj;}else if(userdata.confScreenName==="ForgotUsername"){dojo.require("dj.widget.loader.ForgotUsernameConfirmationLoader");if(typeof dj.module.loader.forgotUsernameConfirmationLoaderObj=="undefined"||dj.module.loader.forgotUsernameConfirmationLoaderObj==null){dj.module.loader.forgotUsernameConfirmationLoaderObj=new dj.widget.loader.ForgotUsernameConfirmationLoader(userdata);dj.module.loader.forgotUsernameConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotUsernameConfirmationLoaderObj);}
dj.module.loader.forgotUsernameConfirmationLoaderObj.setUserdata(userdata);return dj.module.loader.forgotUsernameConfirmationLoaderObj;}else if(userdata.confScreenName==="ForgotPassword"){dojo.require("dj.widget.loader.ForgotPasswordConfirmationLoader");if(typeof dj.module.loader.forgotPasswordConfirmationLoaderObj=="undefined"||dj.module.loader.forgotPasswordConfirmationLoaderObj==null){dj.module.loader.forgotPasswordConfirmationLoaderObj=new dj.widget.loader.ForgotPasswordConfirmationLoader(userdata);dj.module.loader.forgotPasswordConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.forgotPasswordConfirmationLoaderObj);}
dj.module.loader.forgotPasswordConfirmationLoaderObj.setUserdata(userdata);return dj.module.loader.forgotPasswordConfirmationLoaderObj;}else if(userdata.confScreenName==="UnverifiedFreeReg"){dojo.require("dj.widget.loader.UnverifiedFreeRegConfirmationLoader");if(typeof dj.module.loader.unverifiedFreeRegConfirmationLoaderObj=="undefined"||dj.module.loader.unverifiedFreeRegConfirmationLoaderObj==null){dj.module.loader.unverifiedFreeRegConfirmationLoaderObj=new dj.widget.loader.UnverifiedFreeRegConfirmationLoader(userdata);dj.module.loader.unverifiedFreeRegConfirmationLoaderObj.addToAccountInstanceArr(dj.module.loader.unverifiedFreeRegConfirmationLoaderObj);}
dj.module.loader.unverifiedFreeRegConfirmationLoaderObj.setUserdata(userdata);return dj.module.loader.unverifiedFreeRegConfirmationLoaderObj;}}}};dojo.provide("dj.widget.loader.RegistrationLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.declare("dj.widget.loader.RegistrationLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:13.2,initNodeClass:".registerUserClass",mstPageId:dj.context.account.registrationOverlayPageId,domNodeId:"registrationDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:dj.context.account.registrationOverlayHeight,width:dj.context.account.registrationOverlayWidth},init:function(){if(window.console)console.log("this._cfg.initNodeClass in reg "+this._cfg.initNodeClass);dojo.query(this._cfg.initNodeClass).connect("click",this,function(ev){this.initIframeLoader(this._cfg.height,this._cfg.width);});},initRegisterScrimInIframe:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},loadRegistrationRelatedScrims:function(){dj.widget.loader.LoaderInstanceFactory.getThankYouLoaderInstance(this._cfg).initHiddenScrim();}});dojo.provide("dj.widget.loader.FBLoginLoader");dojo.require("dj.widget.loader.LoadPageFragment");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.widget.loader.FBConnectedLoader");dojo.declare("dj.widget.loader.FBLoginLoader",dj.widget.loader.LoadPageFragment,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);},DEFAULT_CONFIG:{isLoadJs:true,isLoadCss:true,isLoadHtml:true,version:4.2,initNodeClass:".connectwithfb",mstPageId:dj.context.account.fbLoginPageId,domNodeId:"fbLoginDivId",scrimManagerFile:"/static_html_files/account/accountScrimManager.html",height:"660px",width:"678px"},init:function(){this.initIframeLoader(this._cfg.height,this._cfg.width);},loadFBRegistrationRelatedScrims:function(){dj.widget.loader.LoaderInstanceFactory.getFBConnectedLoaderInstance(this._cfg).initHiddenScrim();}});dojo.provide("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.widget.loader.ForgotUserOrPswdLoader");dojo.require("dj.widget.loader.ForgotPasswordLoader");dojo.require("dj.widget.loader.FBInitLoader");dojo.require("dj.widget.loader.RegistrationLoader");dojo.require("dj.util.Url");dojo.declare("dj.widget.accountscrim.BaseScrim",null,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.PRODUCT_CD=dj.context.account.productCd;this.queryStringList={};this.getGreyBckgroundCSSDiv="getGreyBckgroundCSSDiv";this._constants=this.CONSTANTS;this.successFileUrl=this.getQueryStrParam("successFileUrl");this.currentPageUrl=this.getQueryStrParam("currentPageUrl");this.userdata=this.getQueryStrParam("userdata");this.userdata=dojo.fromJson(this.userdata);this.checkIfMobileUser();},DEFAULT_CONFIG:{},CONSTANTS:{FORGOT_USERNAME_SCREEN:"ForgotUsername",FORGOT_PASSWORD_SCREEN:"ForgotPassword",FB_LOGIN_OR_WSJ_PSWD_SCREEN:"FbLoginOrWSJPswd",UNVERIFIED_FREE_REG:"UnverifiedFreeReg",LOGIN_VERIFY_EMAIL_SCREEN:"LoginVerifyEmail",FORGOT_USERNAME_CONF_SCREEN:"ForgotUsernameConfirmation",FORGOT_PASSWORD_CONF_SCREEN:"ForgotPasswordConfirmation",FB_LOGIN_OR_WSJ_PSWD_CONF_SCREEN:"FbLoginOrWSJPswdConfirmation",UNVERIFIED_FREE_CONF_REG:"UnverifiedFreeRegConfirmation",LOGIN_VERIFY_EMAIL_CONF_SCREEN:"LoginVerifyEmailConfirmation",USER_WITHOUT_EMAIL:"UserWithoutEmail",LOGIN_SCREEN:"Login",SCRIMS_OK_CLOSE_BTN_CLASS:".accountScrimOkOrCloseBtnClass"},checkIfMobileUser:function(){if(typeof dj.context.mobile!=='undefined'){dj.context.account.forgotUserOrPswdPageUrl=dj.context.mobile.forgotUserOrPswdPageUrl;dj.context.account.forgotUsernameConfPageUrl=dj.context.mobile.forgotUsernameConfPageUrl;dj.context.account.forgotPasswordPageUrl=dj.context.mobile.forgotPasswordPageUrl;dj.context.account.forgotPasswordConfPageUrl=dj.context.mobile.forgotPasswordConfPageUrl;dj.context.account.resetPasswordPageUrl=dj.context.mobile.resetPasswordPageUrl;}},hideErrorMessages:function(domId){dojo.addClass(dojo.byId(this._nodes.errorUl),this._nodes.hiddenClass);},hideScrim:function(domId){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){if(dojo.byId(domId)!=null){dojo.addClass(dojo.byId(domId),this._nodes.hiddenClass);}}},displayScrim:function(domId,isFadingRequired){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){if(typeof isFadingRequired!="undefined"&&isFadingRequired){this.fadeScrim(domId);}
if(dojo.byId(domId)!=null){dojo.removeClass(dojo.byId(domId),this._nodes.hiddenClass);}}},showErrorMessage:function(errorDomId,errorKeyArr){var errorMessage="";if(errorKeyArr.length>0){dojo.forEach(errorKeyArr,function(entry,i){errorMessage+=dojo.byId(entry).innerHTML;},this);var errorUl=dojo.byId(errorDomId);errorUl.innerHTML=errorMessage;dojo.removeClass(errorUl,this._nodes.hiddenClass);if(typeof this._nodes.isIframe!="undefined"&&this._nodes.isIframe){dojo.removeClass(dojo.byId(this._nodes.iframeErrorOverlayDiv),this._nodes.hiddenClass);dojo.connect(dojo.byId(this._nodes.goBackToIframeFrmErr),"click",this,function(event){dojo.addClass(dojo.byId(this._nodes.iframeErrorOverlayDiv),this._nodes.hiddenClass);});}}},addErrorClass:function(fieldName){dojo.addClass(dojo.byId(fieldName),this._nodes.fieldErrorClass);},connectForgotPasswordFromIframe:function(emailAddress){dojo.query(this._nodes.gotoForgotPasswordFromIframe).connect("click",this,function(ev){dojo.stopEvent(ev);if(this._nodes.isStandalonePage){if(typeof emailAddress=="undefined"){window.location=this._nodes.pageUrls.forgotPasswordPageUrl;}else{window.location=this._nodes.pageUrls.forgotPasswordPageUrl+"?userEmailId="+emailAddress;}}else if(this.chkIfHttpsDomain()){parent.location=dj.context.account.forgotPasswordPageUrl;}else{this.initForgotPasswordFromIframe(emailAddress);}});},connectForgotUsernameFromIframe:function(emailAddress){dojo.query(this._nodes.gotoForgotUsernameFromIframe).connect("click",this,function(ev){dojo.stopEvent(ev);if(this._nodes.isStandalonePage){if(typeof emailAddress=="undefined"){window.location=this._nodes.pageUrls.forgotUserOrPswdPageUrl;}else{window.location=this._nodes.pageUrls.forgotUserOrPswdPageUrl+"?userEmailId="+emailAddress;}}else{this.initForgotUsernameFromIframe(emailAddress);}});},connectForgotUsername:function(){dojo.query(this._nodes.gotoForgotUsername).connect("click",this,function(ev){dojo.stopEvent(ev);if(this._nodes.isStandalonePage){window.location=this._nodes.pageUrls.forgotUserOrPswdPageUrl;}else{this.initForgotUserOrPswd();}});},connectForgotPassword:function(){dojo.query(this._nodes.gotoForgotPassword).connect("click",this,function(ev){dojo.stopEvent(ev);if(this._nodes.isStandalonePage){window.location=this._nodes.pageUrls.forgotPasswordPageUrl;}else{this.initForgotPassword();}});},initForgotUserOrPswd:function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getForgotUserOrPswdLoaderInstance(this._cfg).initScrim();},initForgotPassword:function(){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getForgotPasswordLoaderInstance(this._cfg).initScrim();},initConfirmation:function(userdata){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getConfirmationLoaderInstance(userdata).initScrim();},initConfirmationFromIframe:function(userdata){document.location=this.successFileUrl+"?userdata="+dojo.toJson(userdata);},initLoginScrim:function(){if(this.domNodeId!=null&&dojo.byId(this.domNodeId)!=null){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getLoginLoaderInstance(this._cfg).initLoginScrimInIframe();}},initRegistration:function(){dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance(this._cfg).initRegisterScrimInIframe();},initForgotUsernameFromIframe:function(userEmail){if(typeof userEmail=="undefined"){userEmail="";}
var userdata={"screenName":this._constants.FORGOT_USERNAME_SCREEN,"userEmail":userEmail};document.location=this.successFileUrl+"?userdata="+dojo.toJson(userdata);},initLoginFromIframe:function(){var userdata={"screenName":this._constants.LOGIN_SCREEN};document.location=this.successFileUrl+"?userdata="+dojo.toJson(userdata);},initForgotPasswordFromIframe:function(userEmail){if(typeof userEmail=="undefined"){userEmail="";}
var userdata={"screenName":this._constants.FORGOT_PASSWORD_SCREEN,"userEmail":userEmail};document.location=this.successFileUrl+"?userdata="+dojo.toJson(userdata);},initRegistrationFromIframe:function(){var userdata={"screenName":"Registration"};document.location=this.successFileUrl+"?userdata="+dojo.toJson(userdata);},moveOutOfIframe:function(userdata){if(this._nodes.isStandalonePage||this.chkIfHttpsDomain()){parent.dj.widget.loader.ScrimLoaders.callBackFromIframe(dojo.toJson(userdata));}else{if(typeof userdata.refreshPageUrl!="undefined"){parent.location=decodeURIComponent(userdata.refreshPageUrl);}else{document.location=this.successFileUrl+"?userdata="+dojo.toJson(userdata);}}},isChkEnter:function(e){var cKeyCode=e.keyCode||e.which;if(cKeyCode==dojo.keys.ENTER){return true;}
return false;},isChkBackSpace:function(e){var cKeyCode=e.keyCode||e.which;if(cKeyCode==dojo.keys.BACKSPACE){return true;}
return false;},initConnectWithFbNoIframe:function(){dojo.query(this._nodes.connectFB).connect("click",this,function(ev){this.hideScrim(this.domNodeId);dj.widget.loader.LoaderInstanceFactory.getFBInitLoaderInstance(this._cfg).initScrim();});},initConnectWithFB:function(successFileUrl){var userdata={"cfg":this._cfg,"screenName":"FBInit"};this.moveOutOfIframe(userdata);},makeFBConnections:function(successFileUrl){this.makeFBWhatsThisConnection();dojo.query(this._nodes.connectFB).connect("click",this,function(ev){this.initConnectWithFB(successFileUrl);});},makeFBConnectionsNoIframe:function(){this.makeFBWhatsThisConnection();this.initConnectWithFbNoIframe();},makeFBWhatsThisConnection:function(){dojo.query(this._nodes.whatsThisFbClass).connect("click",this,function(ev){dojo.stopEvent(ev);dojo.removeClass(dojo.query(this._nodes.fbToolTipClass)[0],this._nodes.hiddenClass);});dojo.query(this._nodes.fbToolTipCloseClass).connect("click",this,function(ev){dojo.stopEvent(ev);dojo.addClass(dojo.query(this._nodes.fbToolTipClass)[0],this._nodes.hiddenClass);});},makeCloseOrOKButtonConnection:function(domNodeId){dojo.query(this._constants.SCRIMS_OK_CLOSE_BTN_CLASS).connect("click",this,function(ev){this.closeNDestroyGreyBckground(domNodeId,ev);});},closeNDestroyGreyBckground:function(domNodeId,ev){dojo.stopEvent(ev);if(typeof domNodeId!="undefined"&&dojo.byId(domNodeId)!=null){this.hideScrim(domNodeId);}
this.destroyGreyBckground();this.destroyAccountInstanceArr();},destroyGreyBckground:function(){dojo.destroy(this.getGreyBckgroundCSSDiv);},makeCloseOrOKButtonConnectionFromIframe:function(){dojo.query(this._constants.SCRIMS_OK_CLOSE_BTN_CLASS).connect("click",this,function(ev){this.closeFromIframe();});},closeFromIframe:function(){this.destroyAccountInstanceArr();var userdata={"close":"close"};this.moveOutOfIframe(userdata);},hideErrorNPassIndGreen:function(passInd){dojo.addClass(this._nodes.errorUl,this._nodes.hiddenClass);this.updatePasswordInd(passInd,this._nodes.passIndClassGreen);},chkEmpty:function(value){if(typeof value!="undefined"){if(dj.lang.trim(value)===""){return false;}else{return true;}}
return false;},updatePasswordInd:function(spanId,value){var span=dojo.byId(spanId);span.className=value;},isValidEmailAddress:function(emailAddress){return dj.util.Form.validateEmailAddresses(emailAddress);},chkEmailAddress:function(emailAddress){if(!this.chkEmpty(emailAddress)){this.errorArr.push(this._nodes.emailIdrequired);return false;}else{if(!this.isValidEmailAddress(emailAddress)){this.errorArr.push(this._nodes.invalidemailFormat);return false;}}
return true;},chkPasswordLength:function(element1,passInd,errorDomId){if(typeof element1!="undefined"){var value=element1.value;if(typeof value!="undefined"){if(dj.lang.trim(value).length<5){if(dojo.indexOf(this.errorArr,this._nodes.passwordTooShort)<0){this.errorArr.push(this._nodes.passwordTooShort);}}else if(dj.lang.trim(value).length>15){if(dojo.indexOf(this.errorArr,this._nodes.passwordTooLong)<0){this.errorArr.push(this._nodes.passwordTooLong);}}else{this.updatePasswordInd(passInd,this._nodes.passIndClassGreen);return true;}}}
this.updatePasswordInd(passInd,this._nodes.passIndClassRed);return false;},chkPasswordMatch:function(password1,password2,errorDomId){if(typeof password1!="undefined"&&typeof password2!="undefined"){if(typeof password1.value!="undefined"&&typeof password2.value!="undefined"){if(dj.lang.trim(password1.value)===dj.lang.trim(password2.value)){this.hideErrorNPassIndGreen(this._nodes.newPassInd);this.hideErrorNPassIndGreen(this._nodes.confirmPassInd);return true;}}}
this.updatePasswordInd(this._nodes.confirmPassInd,this._nodes.passIndClassRed);this.errorArr.push(this._nodes.passwordDoNotMatch);return false;},validateNewPassword:function(){var validation=true;if(!this.chkEmpty(this.oNewPassword.value)){if(dojo.indexOf(this.errorArr,this._nodes.newPasswordRequired)<0){this.errorArr.push(this._nodes.newPasswordRequired);}
this.updatePasswordInd(this._nodes.newPassInd,this._nodes.passIndClassRed);validation=false;}else if(!this.chkPasswordLength(this.oNewPassword,this._nodes.newPassInd,this._nodes.errorUl)){validation=false;}else if(!this.chkPasswordSplChars(this.oNewPassword,this._nodes.newPassInd,this._nodes.errorUl)){validation=false;}
if(validation){this.hideErrorNPassIndGreen(this._nodes.newPassInd);}
return validation;},validateConfirmPassword:function(){var validation=true;if(!this.chkEmpty(this.oConfirmPassword.value)){if(dojo.indexOf(this.errorArr,this._nodes.confirmPasswordRequired)<0){this.errorArr.push(this._nodes.confirmPasswordRequired);}
this.updatePasswordInd(this._nodes.confirmPassInd,this._nodes.passIndClassRed);validation=false;}else if(!this.chkPasswordLength(this.oConfirmPassword,this._nodes.confirmPassInd,this._nodes.errorUl)){validation=false;}else if(!this.chkPasswordSplChars(this.oConfirmPassword,this._nodes.confirmPassInd,this._nodes.errorUl)){validation=false;}
if(validation){this.hideErrorNPassIndGreen(this._nodes.confirmPassInd);}
return validation;},initForgotPasswordPage:function(){var emailId=dojo.byId(this._nodes.userEmailId);document.location=this._nodes.pageUrls.forgotPasswordPageUrl;},getQueryStrParam:function(param,location){if(typeof this.queryStringList[param]=="undefined"){var url="";if(typeof location=="undefined"){url=window.location.toString();}else{url=location.toString();}
url.match(/\?(.+)$/);var params=RegExp.$1;var params=params.split("&");for(var i=0;i<params.length;i++){var tmp=params[i].split("=");this.queryStringList[tmp[0]]=unescape(tmp[1]);}}
return this.queryStringList[param];},hideFormFactor:function(classToHide){dojo.addClass(dojo.query(classToHide)[0],"hidden");},fadeScrim:function(domId,fadeDuration){var d=new Date();var _fadeDuration=500;if(fadeDuration){_fadeDuration=fadeDuration;}
dojo.style(domId,"opacity","0");var fadeArgs={node:domId,duration:_fadeDuration};dojo.fadeIn(fadeArgs).play();},getPageUrl:function(){var nonSubscriberHomepagePid=this._cfg.NONSUBSCRIBER_HOMEPAGE_PID;var nonSubscriberSearchPagePid=this._cfg.NONSUBSCRIBER_SEARCH_PAGE_PID;var nonSubNewslettersAlertsPagePid=this._cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID;var mdcPagePid=this._cfg.MDC_PAGE_PID;var concatURL;if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){concatURL="http://"+gcDomain;}else{concatURL="http://"+document.domain;}
var oCurrentUrl;oCurrentUrl=parent.window.location.href;var url_value=oCurrentUrl;if(typeof pID!=="undefined"){if(this._nodes.isStandalonePage){url_value=concatURL+this._cfg.HOMEPAGE_SUBSCRIBER_URL;}else{if(pID===nonSubscriberHomepagePid){url_value=concatURL+this._cfg.HOMEPAGE_SUBSCRIBER_URL;}else if(pID===nonSubNewslettersAlertsPagePid){url_value=concatURL+"/email";}else if(pID===nonSubscriberSearchPagePid){url_value=concatURL+this._cfg.SEARCH_PAGE_SUBSCRIBER_URL;}else if(pID===mdcPagePid){url_value=concatURL+this._cfg.MDC_LINK_URL;}else{url_value=oCurrentUrl;}}
var cachebuster=(url_value.indexOf("?")!=-1)?"&":"?";if(typeof cachebuster!==undefined){cachebuster=cachebuster+"_nocache="+new Date().getTime();if(url_value.indexOf("#")!=-1){url_value=url_value.replace("#",cachebuster+"#");}else{url_value=url_value+cachebuster;}}}
return url_value;},chkPasswordSplChars:function(element1,passInd,errorDomId){if(typeof element1!="undefined"){var value=element1.value;if(typeof value!="undefined"){var validate=true;var iChars="!@#$%^&*()+=-[]\\\';,./{}|\":<>?~_ ";for(var i=0;i<value.length;i++){if(iChars.indexOf(value.charAt(i))!=-1){validate=false;}}
if(!validate){if(dojo.indexOf(this.errorArr,this._nodes.invalidCharacters)<0){this.errorArr.push(this._nodes.invalidCharacters);}}else{this.updatePasswordInd(passInd,this._nodes.passIndClassGreen);return true;}}}
this.updatePasswordInd(passInd,this._nodes.passIndClassRed);return false;},resizeIframe:function(){if(dojo.byId("moduleiframe")!=null&&typeof dojo.byId("moduleiframe")!="undefined"){var divHeight=dojo.query(".loginModule")[0].clientHeight?dojo.query(".loginModule")[0].clientHeight:0;if(divHeight!=0){dojo.byId("moduleiframe").style.height=divHeight;}}},addClassToBody:function(){dojo.addClass(dojo.body(),"loginForm_content");},chkIfHttpsDomain:function(){try{if(typeof parent.window.location.href!="undefined"&&parent.window.location.href.indexOf("https://")>-1){return true;}
return false;}catch(e){return false;}},lifpOmnitureTracking:function(trackValues,events,pName){setMetaData("pagename",pName);pName=pName.replace("WSJ_","");setMetaData("apage","WSJ_Customer Resources_"+pName);setMetaData("atype","WSJ_Customer Resourcess_"+pName);setMetaData("section","Customer Resources");setMetaData("subsection","WSJ_Login");setMetaData("csource","Customer Resources");setMetaData("ctype","marketing and support");setMetaData("basesection","WSJ_Customer Resources_Login");if(typeof trackValues!="undefined"&&trackValues.length>0){for(index=0;index<trackValues.length;index++){setMetaData(trackValues[index][0],trackValues[index][1]);}}
if(typeof events!="undefined"){s.events=events;}
dj.util.Tracking.omniture.firePixel(true);},destroyIframe:function(){parent.dojo.destroy("moduleiframe");parent.dojo.destroy("overlayDiv");},destroyAccountInstanceArr:function(){if(typeof dj.module.loader!="undefined"&&typeof dj.module.loader.accountInstanceArr!="undefined"){while(dj.module.loader.accountInstanceArr.length!=0){var entry=dj.module.loader.accountInstanceArr.pop();if(typeof entry!="undefined"&&typeof entry.destroyObject!="undefined"&&typeof entry.destroyObject=="function"){entry.destroyObject();}}
if(dj.module.loader.accountInstanceArr.length==0){dj.module.loader.accountInstanceArr={};dj.module.loader={};}}},logoutTheUnverifiedFreeRegUser:function(){this.destroyAccountInstanceArr();var userdata={"logout":"logout"};this.moveOutOfIframe(userdata);}});dojo.provide("dj.widget.accountscrim.FBConnected");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.FBConnected",dj.widget.accountscrim.BaseScrim,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this.errorArr=new Array();},DEFAULT_CONFIG:{isLoadJs:true,version:4.3,NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{closeButton:".closeBtn",tryagain:".tryagian",hiddenClass:"hidden"},init:function(domNodeId,isFadingRequired){this.displayScrim(domNodeId,isFadingRequired);this.domNodeId=domNodeId;this.makeWidgetConnections();if(typeof dj.module.facebook!="undefined"&&typeof dj.module.facebook.connect!="undefined"){if(typeof FB=="undefined"){dj.module.facebook.connect.init(this.updateUserInfo);}else{this.updateUserInfo();}}else{if(window.console)console.warn(" In {FBConnected.js} dj.module.facebook.connect is not found, please make the required js file available");}},setOmnitureTracking:function(){var trackValues=new Array();var pName="";pName="WSJ_Auth_FBConnect_Thank_You_Original";dj.util.User.isSubLoggedIn(function(subLoggedIn){if(subLoggedIn){trackValues[0]=new Array("caccess","sub");}else{trackValues[0]=new Array("caccess","reg");}});this.lifpOmnitureTracking(trackValues,"event12,evenr57",pName);},showScrim:function(domNodeId,isFadingRequired){this.domNodeId=domNodeId;this.displayScrim(domNodeId,isFadingRequired);this.setOmnitureTracking();},makeWidgetConnections:function(){this.makeCloseOrOKButtonConnection(this.domNodeId);dojo.query(".login_invite").connect("click",this,function(ev){this.closeNDestroyGreyBckground(this.domNodeId,ev);FB.ui({method:'apprequests',message:'You should learn more about this awesome game.',data:'tracking information for the user'});});},updateUserInfo:function(){var that=this;if(typeof FB!="undefined"){FB.api('/me',function(response){if(!response||response.error){}else{dojo.byId("name").innerHTML=response.first_name+" "+response.last_name;}});}}});dojo.provide("dj.widget.accountscrim.Registration");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.service.account.RegistrationService");dojo.declare("dj.widget.accountscrim.Registration",dj.widget.accountscrim.BaseScrim,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this.errorArr=new Array();},DEFAULT_CONFIG:{isLoadJs:true,version:4.2},WIDGET_CONFIG:{serviceUrls:{registrationServiceUrl:"/epiton/registration/v2/profile"},closeButton:"registrationClose",firstName:"firstName",lastName:"lastName",emailToRegister:"emailToRegister",newPassword:"newPassword",confirmPassword:"confirmPassword",companySize:"companySize",registerNow:"registerNow",newPassInd:"newPassInd",confirmPassInd:"confirmPassInd",jobTitleDropDown:"jobTitleDropDown",passIndClassRed:"validate no",passIndClassGreen:"validate yes",hiddenClass:"hidden",gotoLogin:".loginClass",gotoForgotPasswordFromIframe:".forgotPasswordFromIframeClass",registrationIframeForm:"registrationIframeForm",errorUl:"registrationErrorUl",goBackToIframeFrmErr:"goBackToIframeFrmErr",fieldErrorClass:"errorState",isIframe:false,iframeErrorOverlayDiv:"iframeErrorOverlayDiv",firstNameRequired:"firstNameRequired",lastNameRequired:"lastNameRequired",invalidemailFormat:"invalidemailFormat",emailIdrequired:"emailIdrequired",newPasswordRequired:"newPasswordRequired",confirmPasswordRequired:"confirmPasswordRequired",privacyPolicyRequired:"privacyPolicyRequired",passwordTooShort:"passwordTooShort",passwordTooLong:"passwordTooLong",invalidCharacters:"invalidCharacters",passwordDoNotMatch:"passwordDoNotMatch",passwordSuggestion:".pw_suggestion",passwordSuggestionClose:".pw_tooltip",generalError:"generalError",emailAddressexists:"emailAddressexists",emailAddressinvalid:"emailAddressinvalid",connectFB:".connectwithfb",whatsThisFbClass:".whatsThisFbClass",fbToolTipClass:".fb_tooltip",fbToolTipCloseClass:".fb-close-tooltip-btn"},init:function(domNodeId){this.addClassToBody();this.successFileUrl=this.getQueryStrParam("successFileUrl");this.numOfLoginAttempts=0;this.domNodeId=domNodeId;this.makeWidgetConnections();this.makeFBConnections(this.successFileUrl);this.setOmnitureTracking();},setOmnitureTracking:function(){var trackValues=new Array();var pName="WSJ_FreeReg_Login_FreeReg_Form";trackValues[0]=new Array("basesection","WSJ_Free_Reg");trackValues[1]=new Array("subsection","WSJ_Free_Reg");trackValues[2]=new Array("caccess","free");this.lifpOmnitureTracking(trackValues,"event12",pName);},showScrim:function(domNodeId){this.domNodeId=domNodeId;this.displayScrim(domNodeId);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking();},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oFirstName=dojo.byId(this._nodes.firstName);this.oLastName=dojo.byId(this._nodes.lastName);this.oEmailToRegister=dojo.byId(this._nodes.emailToRegister);this.oNewPassword=dojo.byId(this._nodes.newPassword);this.oConfirmPassword=dojo.byId(this._nodes.confirmPassword);this.oCompanySize=dojo.byId(this._nodes.companySize);this.oRegisterNow=dojo.byId(this._nodes.registerNow);if(this.oFirstName!==null){dojo.connect(this.oFirstName,"onfocus",this,function(event){dj.util.Form.clearValue(this.oFirstName,"First Name");});dojo.connect(this.oFirstName,"onclick",this,function(event){dj.util.Form.clearValue(this.oFirstName,"First Name");});}
dojo.connect(dojo.byId("registrationIframeForm"),"onsubmit",this,function(e){dojo.stopEvent(e);this.submitForm();});dojo.connect(dojo.byId(this._nodes.closeButton),"click",this,function(ev){dojo.stopEvent(ev);dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass);});if(this.oNewPassword!==null){this.oNewPassword.type="password";}
if(this.oConfirmPassword!==null){this.oConfirmPassword.type="password";}
dojo.connect(this.oNewPassword,"keyup",this,function(e){if(this.oNewPassword.value==""&&!(this.isChkEnter(e))){dojo.removeClass(dojo.byId("newPassInd"),"validate no");dojo.removeClass(dojo.byId("newPassInd"),"validate yes");dojo.removeClass(dojo.byId("newPassword"),"errorState");}});dojo.connect(this.oConfirmPassword,"keyup",this,function(e){if(this.oConfirmPassword.value==""&&!(this.isChkEnter(e))){dojo.removeClass(dojo.byId("confirmPassInd"),"validate no");dojo.removeClass(dojo.byId("confirmPassInd"),"validate yes");dojo.removeClass(dojo.byId("confirmPassword"),"errorState");}});dojo.query(this._nodes.passwordSuggestion).connect("click",this,function(ev){dojo.removeClass(dojo.byId("pwSuggestion"),"hidden");});dojo.query(this._nodes.passwordSuggestionClose).connect("click",this,function(ev){dojo.addClass(dojo.byId("pwSuggestion"),"hidden");});dojo.query(this._nodes.gotoLogin).connect("click",this,function(ev){if(this.chkIfHttpsDomain()){var userdata={"close":"close"};this.moveOutOfIframe(userdata);}else{this.initLoginFromIframe(this.successFileUrl);}});},submitForm:function(){this.clearRedBoundaryFromFields();if(!this.validateForm()){return;}
dojo.byId(this._nodes.errorUl).innerHTML="";var jobTitle=dojo.byId(this._nodes.jobTitleDropDown);var postData="profile.firstName="+this.oFirstName.value;postData+="&profile.lastName="+this.oLastName.value;postData+="&profile.emailAddress="+this.oEmailToRegister.value;postData+="&profile.password="+this.oNewPassword.value;postData+="&profile.passwordConfirmation="+this.oConfirmPassword.value;postData+="&service.prodct=wsj-online&service.templateCode="+this.PRODUCT_CD;postData+="&service.registrationType=FREE_REGISTRATION";if(typeof jobTitle!="undefined"&&jobTitle.value!=""){postData+="&profile.demographics.questionId1=dt_job_title&profile.demographics.answer1="+jobTitle.value;}
dj.service.account.RegistrationService.registerUser(this._nodes.serviceUrls.registrationServiceUrl,postData,this.load,this.error,this);},load:function(emailId){var userdata={"screenName":"RegistrationConfirmation","emailId":encodeURIComponent(emailId),"firstName":encodeURIComponent(this.oFirstName.value),"lastName":encodeURIComponent(this.oLastName.value)}
this.moveOutOfIframe(userdata);},error:function(errorsArr){dojo.forEach(errorsArr,function(entry,i){if(entry.indexOf("-")>-1){entry=entry.replace(/-/g,"");errorsArr[i]=entry;}},this);this.showErrorMessage(this._nodes.errorUl,errorsArr);var isEmailAlreadyExistError=false;dojo.forEach(errorsArr,function(entry,i){if(entry==this._nodes.emailAddressexists||entry==this._nodes.emailAddressinvalid){this.addErrorClass(this._nodes.emailToRegister);if(entry==this._nodes.emailAddressexists){isEmailAlreadyExistError=true;}}},this);if(isEmailAlreadyExistError){var trackValues=new Array();var pName="WSJ_Auth_WSJ_Registration_Scrim Email Already Exists";this.lifpOmnitureTracking(trackValues,"event12",pName);}
this.connectForgotPasswordFromIframe();},validateForm:function(){var validation=true;if(!this.chkEmpty(this.oFirstName.value)){this.errorArr.push(this._nodes.firstNameRequired);this.addErrorClass(this._nodes.firstName);validation=false;}
if(!this.chkEmpty(this.oLastName.value)){this.errorArr.push(this._nodes.lastNameRequired);this.addErrorClass(this._nodes.lastName);validation=false;}
var emailValidation=this.chkEmailAddress(this.oEmailToRegister.value);if(!emailValidation){this.addErrorClass(this._nodes.emailToRegister);}
validation=validation?emailValidation:false;var newPassValidation=this.validateNewPassword();if(!newPassValidation){this.addErrorClass(this._nodes.newPassword);}
var confirmPassValidation=this.validateConfirmPassword();if(!confirmPassValidation){this.addErrorClass(this._nodes.confirmPassword);}
validation=validation?newPassValidation?confirmPassValidation:false:false;if(newPassValidation&&confirmPassValidation){if(!this.chkPasswordMatch(this.oNewPassword,this.oConfirmPassword,this._nodes.errorUl)){this.addErrorClass(this._nodes.confirmPassword);validation=false;}}
if(dojo.byId("privacypolicybox")){if(dojo.byId("privacypolicybox").checked==false)
{this.errorArr.push(this._nodes.privacyPolicyRequired);validation=false;}}
this.showErrorNClearArray();return validation;},showErrorNClearArray:function(){this.showErrorMessage(this._nodes.errorUl,this.errorArr);this.errorArr=new Array();},highlightTheErrorField:function(errorKeyArr){dojo.forEach(errorKeyArr,function(entry,i){if(entry==this._nodes.usernamemissing){this.addErrorClass(this._nodes.userOrEmailInput);}
if(entry==this._nodes.passwordmissing){this.addErrorClass(this._nodes.password);}},this);},clearRedBoundaryFromFields:function(){dojo.removeClass(dojo.byId(this._nodes.firstName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.lastName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.emailToRegister),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.newPassword),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.confirmPassword),this._nodes.fieldErrorClass);}});dojo.provide("dj.widget.accountscrim.BaseLogin");dojo.require("dj.widget.accountscrim.BaseScrim");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.BaseLogin",dj.widget.accountscrim.BaseScrim,{constructor:function(cfg){},submitForm:function(loginData){this.clearRedBoundaryFromFields();if(!this.validateForm(loginData)){return;}
dojo.byId(this._nodes.errorUl).innerHTML="";if(this._nodes.isStandalonePage){if(this._nodes.isAmazonOffer){this.currentPageUrl=this._nodes.shopnbuyUrl;}else if(this._nodes.loginTargetUrl){this.currentPageUrl=this._nodes.loginTargetUrl;}else{this.currentPageUrl=this.getPageUrl();}}
var url="";if(this.currentPageUrl.indexOf("?")>-1){url=encodeURIComponent(this.currentPageUrl+"&user=welcome");}else{url=encodeURIComponent(this.currentPageUrl+"?user=welcome");}
var postData={"username":dj.lang.trim(loginData.username),"password":loginData.password,"url":encodeURIComponent(dj.context.account.testLogin)+"?currentPageUrl="+url,"template":"default","realm":"default","savelogin":loginData.savelogin};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(postData),this.load,this.error,this);},setupLoginData:function(){var savelogin=dojo.byId(this._nodes.savelogin).checked+"";var loginData={"username":this.oUserName.value,"password":this.oPassword.value,"savelogin":savelogin,"errorUI":this._nodes.errorUl}
return loginData;},load:function(data){var userEmail="";if(typeof data.status!="undefined"){if(!this.isValidEmailAddress(data.username)){if(dojo.byId("userEmailIdToResendEmail")!=null){dojo.byId("userEmailIdToResendEmail").innerHTML="";}else{dojo.create("div",{id:"userEmailIdToResendEmail"},dojo.body());}
dj.util.User.renderEmailAddress("userEmailIdToResendEmail");userEmail=dojo.byId("userEmailIdToResendEmail").innerHTML;}else{userEmail=data.username;}
if(data.status==this._nodes.unverifiedsubscriber){this.isUnverifiedSubscriber=true;this.loginVerifyEmailUserdata={"screenName":this._constants.LOGIN_VERIFY_EMAIL_SCREEN,"uuid":data.uuid,"productCode":this.PRODUCT_CD,"userEmail":userEmail,"refreshPageUrlForUnverifiedSub":encodeURIComponent(this.currentPageUrl)}
if(dojo.byId("unverifiedFreeRegOrSub")==null){dojo.create("div",{id:"unverifiedFreeRegOrSub","class":"hidden"},dojo.body(),"last");}}else if(data.status==this._nodes.unverifiedfreereg){this.isUnverifiedFreeReg=true;this.unverifiedFreeRegUserdata={"screenName":this._constants.UNVERIFIED_FREE_REG,"uuid":data.uuid,"productCode":this.PRODUCT_CD,"userEmail":userEmail}
if(dojo.byId("unverifiedFreeRegOrSub")==null){dojo.create("div",{id:"unverifiedFreeRegOrSub","class":"hidden"},dojo.body(),"last");}}}
if(this._nodes.isStandalonePage&&typeof this.isUnverifiedSubscriber=="undefined"&&typeof this.isUnverifiedFreeReg=="undefined"){window.location=data.url;}else{dojo.create("div",{id:"testLoginContainer"},dojo.body(),"last");this.initIFrame("testLoginContainer",0,0,data.url);}},error:function(errorsArr){if(this._nodes.fbConnectLogin){dojo.removeClass(dojo.byId("fbconnect"),"disabled");dojo.removeClass(dojo.byId("loginSubmit"),"disabled");}
var addingNewGotoFUPLink="N";this.numOfLoginAttempts++;dojo.forEach(errorsArr,function(entry,i){if(entry.indexOf("-")>-1){entry=entry.replace(/-/g,"");errorsArr[i]=entry;if(entry===this._nodes.usernameinvalidcredentials&&this.numOfLoginAttempts>2){errorsArr[i]=this._nodes.morethan2invalidcredentials;addingNewGotoFUPLink="Y";};if(entry===this._nodes.facebookconnected){var userdata={"screenName":this._constants.FB_LOGIN_OR_WSJ_PSWD_SCREEN,"username":this.oUserName.value,"productCode":this.PRODUCT_CD}
this.moveOutOfIframe(userdata);};}},this);this.showErrorMessage(this._nodes.errorUl,errorsArr);if(errorsArr.length>0){this.clearRedBoundaryFromFields();this.focusOnError();}
if(addingNewGotoFUPLink==="Y"){this.connectForgotUsernameFromIframe();this.connectForgotPasswordFromIframe();}
var trackValues=new Array();var pName="";var trackValues=new Array();if(this._nodes.fbConnectLogin){pName="WSJ_Auth_WSJ/Barrons_Login_Page_Post_FBConnect Invalid Login Credentials";}else{if(this._nodes.isStandalonePage){pName="WSJ_Auth_WSJ_Login_Page Bad Credentials page";}else{pName="WSJ_Auth_WSJ_Login_Scrim Bad Credentials page";}}
this.lifpOmnitureTracking(trackValues,"event12",pName);},gotoSubscribePage:function(){var userdata={};if(dj.util.Region.getViewByRegion()=="asia,india")
{this._nodes.subscribeFromLoginPage=dj.context.account.india_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.india_subscribeFromLoginOverlay;}else if(dj.util.Region.getViewByRegion()=="asia")
{this._nodes.subscribeFromLoginPage=dj.context.account.asia_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.asia_subscribeFromLoginOverlay;}else if(dj.util.Region.getViewByRegion()=="europe")
{this._nodes.subscribeFromLoginPage=dj.context.account.europe_subscribeFromLoginPage;this._nodes.subscribeFromLoginOverlay=dj.context.account.europe_subscribeFromLoginOverlay;}
if(this._nodes.isStandalonePage){userdata={"refreshPageUrl":encodeURIComponent(this._nodes.subscribeFromLoginPage)};}else{userdata={"refreshPageUrl":encodeURIComponent(this._nodes.subscribeFromLoginOverlay)};}
this.moveOutOfIframe(userdata);},highlightTheErrorField:function(errorKeyArr){dojo.forEach(errorKeyArr,function(entry,i){if(entry==this._nodes.usernamemissing){this.addErrorClass(this._nodes.userOrEmailInput);}
if(entry==this._nodes.passwordmissing){this.addErrorClass(this._nodes.password);}},this);},clearRedBoundaryFromFields:function(){dojo.removeClass(dojo.byId(this._nodes.userOrEmailInput),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.password),this._nodes.fieldErrorClass);},focusOnError:function(){this.oPassword.value="";this.oUserName.focus();},validateForm:function(loginData){var validate=true;if(!this.chkEmpty(loginData.username)){this.errorArr.push(this._nodes.usernamemissing);this.addErrorClass(this._nodes.userOrEmailInput);validate=false;}
if(validate){if(!this.chkEmpty(loginData.password)){this.errorArr.push(this._nodes.passwordmissing);this.addErrorClass(this._nodes.password);validate=false;}}
this.showErrorMessage(loginData.errorUI,this.errorArr);this.errorArr=new Array();return validate;},initIFrame:function(domNodeId,height,width,url){setTimeout(this.isLoginSuccess,20000);var options={"src":url,"class":"hidden","allowTransparency":"true"};dj.util.Url.createSimpleIframe(options,domNodeId,this.testLoginIframeLoaded,this);},isLoginSuccess:function(){if(!this.isUserLoggedIn){this.errorArr=["generalError"];this.showErrorMessage(this._nodes.errorUl,this.errorArr);if(window.console)console.warn("User couldn't be logged in ");this.errorArr=new Array();this.isUserLoggedIn=false;}},testLoginIframeLoaded:function(){this.isUserLoggedIn=true;if(this.isUnverifiedSubscriber){this.moveOutOfIframe(this.loginVerifyEmailUserdata);}else if(this.isUnverifiedFreeReg){this.moveOutOfIframe(this.unverifiedFreeRegUserdata);}
dojo.destroy("unverifiedFreeRegOrSub");}});dojo.provide("dj.widget.accountscrim.Login");dojo.require("dj.widget.accountscrim.BaseLogin");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.util.User");dojo.declare("dj.widget.accountscrim.Login",dj.widget.accountscrim.BaseLogin,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._nodes=this.WIDGET_CONFIG;this._dls=dj.service.account.LoginService;this.errorArr=new Array();},DEFAULT_CONFIG:{isLoadJs:true,version:4.2,NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{serviceUrls:{loginServiceUrl:"/auth/submitlogin.json"},closeButton:"loginClose",userOrEmailInput:"loginUserOrEmail",password:"password",submitButton:"loginSubmit",hiddenClass:"hidden",gotoForgotUsernameFromIframe:".forgotUsernameFromIframeClass",gotoForgotPasswordFromIframe:".forgotPasswordFromIframeClass",gotoRegistration:".registerUserClass",gotoSubscribe:".subscribeUser",savelogin:"savelogin",loginIframeForm:"loginIframeForm",errorUl:"loginErrorUl",goBackToIframeFrmErr:"goBackToIframeFrmErr",fieldErrorClass:"errorState",isIframe:false,iframeErrorOverlayDiv:"iframeErrorOverlayDiv",usernamemissing:"usernamemissing",passwordmissing:"passwordmissing",usernameinvalidcredentials:"usernameinvalidcredentials",morethan2invalidcredentials:"morethan2invalidcredentials",cookiesDisabledMsg:"cookiesDisabledMsg",facebookconnected:"facebookconnected",unverifiedsubscriber:"unverified-subscriber",unverifiedfreereg:"unverified-freereg",generalError:"generalError",connectFB:".connectwithfb",whatsThisFbClass:".whatsThisFbClass",fbToolTipClass:".login_tooltip",fbToolTipCloseClass:".close-tooltip-btn",subscribeFromLoginOverlay:dj.context.account.subscribeFromLoginOverlay,subscribeFromLoginPage:dj.context.account.subscribeFromLoginPage},init:function(domNodeId,focusOnUsername){if(typeof this._nodes.isStandalonePage=="undefined"||!this._nodes.isStandalonePage){this.addClassToBody();this.updatePromoUrlnImage();}
this.numOfLoginAttempts=0;this.domNodeId=domNodeId;this.makeWidgetConnections();this.makeFBConnections(this.successFileUrl);var that=this;dj.lang.addLiveEvent('.login_id',"keypress",function(e){if(dojo.isIE){if(that.isChkEnter(e)){dojo.stopEvent(e);that.submitForm(that.setupLoginData());}}});dj.lang.addLiveEvent('.login_pw',"keypress",function(e){if(dojo.isIE){if(that.isChkEnter(e)){dojo.stopEvent(e);that.submitForm(that.setupLoginData());}}});if(typeof focusOnUsername=="undefined"||focusOnUsername){dojo.ready(function(){setTimeout(function(){document.loginform.loginUserOrEmail.focus();},100);});}
this.setOmnitureTracking();},chkIfCookieEnabledOnMob:function(){if(navigator.userAgent.search(/Mobile/i)>-1){var cookieEnabled=(navigator.cookieEnabled)?true:false;if(!cookieEnabled){this.showErrorMessage(this._nodes.errorUl,[this._nodes.cookiesDisabledMsg]);}}},setOmnitureTracking:function(){var trackValues=new Array();var pName="";if(this._nodes.isStandalonePage){pName="WSJ_Auth_WSJ/Barrons_Login_Page_Sub_with_Promo";}else{pName="WSJ_Auth_WSJ/Barrons_Login_Scrim_Sub_with_Promo";}
this.lifpOmnitureTracking(trackValues,"event12",pName);},showScrim:function(domNodeId){this.domNodeId=domNodeId;this.displayScrim(domNodeId);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking();},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oUserName=dojo.byId(this._nodes.userOrEmailInput);this.oPassword=dojo.byId(this._nodes.password);this.oLoginSub=dojo.byId(this._nodes.submitButton);if(this.oUserName!==null){dojo.connect(this.oUserName,"focus",this,function(event){dj.util.Form.clearValue(this.oUserName,"User Name");});dojo.connect(this.oUserName,"click",this,function(event){dj.util.Form.clearValue(this.oUserName,"User Name");});}
dojo.connect(dojo.byId("loginIframeForm"),"onsubmit",this,function(e){this.submitForm(this.setupLoginData());dojo.stopEvent(e);});dojo.connect(dojo.byId(this._nodes.closeButton),"click",this,function(ev){dojo.stopEvent(ev);dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass);});if(this.oPassword!==null){this.oPassword.type="password";dojo.connect(this.oPassword,"focus",this,function(event){dj.util.Form.clearValue(this.oPassword,"Password");});}
this.connectForgotPasswordFromIframe();this.connectForgotUsernameFromIframe();dojo.query(this._nodes.gotoRegistration).connect("click",this,function(ev){if(this._nodes.isStandalonePage){this.initRegistration();}else{this.initRegistrationFromIframe(this.successFileUrl);}});dojo.query(this._nodes.gotoSubscribe).connect("click",this,function(ev){dojo.stopEvent(ev);this.gotoSubscribePage();});},updatePromoUrlnImage:function(){var region=dj.util.Region.getViewByRegion();console.log("region "+region);if(typeof region!="undefined"&&dojo.byId("usLoginPromo")!=null){var divId="usLoginPromo";var hideDivId1="asiaLoginPromo";var hideDivId2="europeLoginPromo";if(region.toUpperCase().indexOf("US")>-1){divId="usLoginPromo";hideDivId1="asiaLoginPromo";hideDivId2="europeLoginPromo";}
else if(region.toUpperCase().indexOf("ASIA")>-1){divId="asiaLoginPromo";hideDivId1="usLoginPromo";hideDivId2="europeLoginPromo";}
else if(region.toUpperCase().indexOf("EUROPE")>-1){divId="europeLoginPromo";hideDivId1="usLoginPromo";hideDivId2="asiaLoginPromo";}
dojo.removeClass(dojo.byId(divId),"hidden");dojo.addClass(dojo.byId(hideDivId1),"hidden");dojo.addClass(dojo.byId(hideDivId2),"hidden");}}});dojo.provide("dj.widget.accountscrim.FBLogin");dojo.require("dj.widget.accountscrim.BaseLogin");dojo.require("dj.util.Form");dojo.require("dj.service.account.LoginService");dojo.require("dj.widget.accountscrim.Login");dojo.require("dj.widget.accountscrim.Registration");dojo.declare("dj.widget.accountscrim.FBLogin",dj.widget.accountscrim.BaseLogin,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this.fragmentLoaded=false;this._nodes=this.WIDGET_CONFIG;this._dls=dj.service.account.LoginService;this.errorArr=new Array();},DEFAULT_CONFIG:{isLoadJs:true,version:4.2,productCd:"WSJ_FACEBOOK",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",MDC_PAGE_PID:"2_3000",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",MDC_LINK_URL:"/mdc/page/marketsdata.html"},WIDGET_CONFIG:{serviceUrls:{loginServiceUrl:"/auth/submitlogin.json",registrationServiceUrl:"/epiton/registration/v2/profile"},closeButton:".closeBtn",userOrEmailInput:"fb_loginUserOrEmail",password:"fb_password",loginSubmit:"loginSubmit",fbSubmit:"fbconnect",hiddenClass:"hidden",gotoForgotUsernameFromIframe:".forgotUsernameFromIframeClass",loginConnect:".wsj_login_form_intro",loginForm:".wsj_login_form",savelogin:"fb_savelogin",errorUl:"fb_loginErrorUl",usernamemissing:"usernamemissing",passwordmissing:"passwordmissing",usernameinvalidcredentials:"usernameinvalidcredentials",morethan2invalidcredentials:"morethan2invalidcredentials",facebookconnected:"facebookconnected",unverifiedsubscriber:"unverified-subscriber",unverifiedfreereg:"unverified-freereg",generalError:"generalError",fieldErrorClass:"errorState",firstNameRequired:"firstNameRequired",lastNameRequired:"lastNameRequired",invalidemailFormat:"invalidemailFormat",emailIdrequired:"emailIdrequired",newPasswordRequired:"newPasswordRequired",confirmPasswordRequired:"confirmPasswordRequired",passwordTooShort:"passwordTooShort",passwordTooLong:"passwordTooLong",invalidCharacters:"invalidCharacters",passwordDoNotMatch:"passwordDoNotMatch",emailAddressexists:"emailAddressexists",firstName:"fb_firstName",lastName:"fb_lastName",emailToRegister:"fb_emailToRegister",newPassword:"fb_newPassword",confirmPassword:"fb_confirmPassword",registerErrorUl:"fb_registrationErrorUl",registerNow:"registerNow",newPassInd:"newPassInd",confirmPassInd:"confirmPassInd",passIndClassRed:"validate no",passIndClassGreen:"validate yes",passwordSuggestion:".pw_suggestion",passwordSuggestionClose:".pw_tooltip",connectFB:"connectwithfb",whatsThisFb:"whatsThisFb",fbToolTip:"fbToolTip",fbToolTipClose:"fbToolTipClose",helpTipTarget:".helpTipTarget",helpbtnclose:".btn_close"},init:function(domNodeId){this.addClassToBody();this._nodes.fbConnectLogin=true;this.successFileUrl=this.getQueryStrParam("successFileUrl");this.currentPageUrl=this.getQueryStrParam("currentPageUrl");this.fbconnectURL=this.getFBConnectURL(this.currentPageUrl);this.numOfLoginAttempts=0;this.domNodeId=domNodeId;this.makeWidgetConnections();if(typeof dj.module.facebook!="undefined"&&typeof dj.module.facebook.connect!="undefined"){if(typeof FB=="undefined"){dj.module.facebook.connect.init(this.updateUserInfo);}else{this.updateUserInfo();}}else{if(window.console)console.warn(" In {FBLogin.js} dj.module.facebook.connect is not found, please make the required js file available");}
this.setOmnitureTracking();var that=this;dj.lang.addLiveEvent('.fbloginid',"keypress",function(e){if(dojo.isIE){if(that.isChkEnter(e)){dojo.stopEvent(e);that.submitLoginForm();}}});dj.lang.addLiveEvent('.fbloginpassword',"keypress",function(e){if(dojo.isIE){if(that.isChkEnter(e)){dojo.stopEvent(e);that.submitLoginForm();}}});},showScrim:function(domNodeId){this.domNodeId=domNodeId;this.displayScrim(domNodeId);this.hideErrorMessages(this._nodes.errorUl);this.setOmnitureTracking();},setOmnitureTracking:function(){var trackValues=new Array();var pName="";pName="WSJ_Auth_WSJ_Login_Page_Post_FBConnect";this.lifpOmnitureTracking(trackValues,"event12",pName);},updateUserInfo:function(){FB.api('/me',function(response){if(!response||response.error){}else{dojo.byId("fb_firstName").value=response.first_name;dojo.byId("fb_lastName").value=response.last_name;dojo.byId("fb_emailToRegister").value=response.email;}});},showLoginForm:function(){dojo.removeClass(dojo.byId("wsj_login_box"),"wsj_login_box collapsed");dojo.addClass(dojo.byId("wsj_login_box"),"wsj_login_box expanded");this.makeLoginConnections();},setupRegistrationData:function(){var registrationData={"firstname":this.oFirstName.value,"lastname":this.oLastName.value,"email":this.oEmailToRegister.value,"password":this.oNewPassword.value,"confirmpassword":this.oConfirmPassword.value,"errorUI":this._nodes.registerErrorUl}
return registrationData;},setupLoginData:function(){var savelogin=dojo.byId(this._nodes.savelogin).checked+"";var loginData={"username":this.oUserName.value,"password":this.oPassword.value,"savelogin":savelogin,"errorUI":this._nodes.errorUl}
return loginData;},makeWidgetConnections:function(){this.fragmentLoaded=true;this.oFirstName=dojo.byId(this._nodes.firstName);this.oLastName=dojo.byId(this._nodes.lastName);this.oEmailToRegister=dojo.byId(this._nodes.emailToRegister);this.oNewPassword=dojo.byId(this._nodes.newPassword);this.oConfirmPassword=dojo.byId(this._nodes.confirmPassword);dojo.connect(dojo.byId("fbRegisterForm"),"onsubmit",this,function(e){dojo.stopEvent(e);this.submitFBForm();});dojo.query(this._nodes.closeButton).connect("click",this,function(ev){dojo.addClass(dojo.byId(this.domNodeId),this._nodes.hiddenClass);});this.connectForgotPasswordFromIframe();this.connectForgotUsernameFromIframe();dojo.query(this._nodes.loginConnect).connect("click",this,function(ev){this.showLoginForm();});dojo.query(this._nodes.helpTipTarget).connect("click",this,function(ev){dojo.removeClass(dojo.byId("helpTipTree"),"helpTipTree-collapsed");dojo.addClass(dojo.byId("helpTipTree"),"helpTipTree-expanded");});dojo.query(this._nodes.helpbtnclose).connect("click",this,function(ev){dojo.addClass(dojo.byId("helpTipTree"),"helpTipTree-collapsed");dojo.removeClass(dojo.byId("helpTipTree"),"helpTipTree-expanded");});dojo.query(this._nodes.passwordSuggestion).connect("click",this,function(ev){dojo.removeClass(dojo.byId("pwSuggestion"),"hidden");});dojo.query(this._nodes.passwordSuggestionClose).connect("click",this,function(ev){dojo.addClass(dojo.byId("pwSuggestion"),"hidden");});dojo.connect(this.oConfirmPassword,"keyup",this,function(e){if(this.oConfirmPassword.value==""&&!(this.isChkEnter(e))){dojo.removeClass(dojo.byId("confirmPassInd"),"validate no");dojo.removeClass(dojo.byId("confirmPassInd"),"validate yes");dojo.removeClass(dojo.byId("fb_confirmPassword"),"errorState");}
if(this.isChkEnter(e)){dojo.stopEvent(e);this.submitFBForm();}});dojo.connect(this.oNewPassword,"keyup",this,function(e){if(this.oNewPassword.value==""&&!(this.isChkEnter(e))){dojo.removeClass(dojo.byId("newPassInd"),"validate no");dojo.removeClass(dojo.byId("newPassInd"),"validate yes");dojo.removeClass(dojo.byId("fb_newPassword"),"errorState");}
if(this.isChkEnter(e)){dojo.stopEvent(e);this.submitFBForm();}});},makeLoginConnections:function(){this.fragmentLoaded=true;this.oUserName=dojo.byId(this._nodes.userOrEmailInput);this.oPassword=dojo.byId(this._nodes.password);this.oLoginSub=dojo.byId(this._nodes.loginSubmit);this.oFBSub=dojo.byId(this._nodes.fbSubmit);if(this.oUserName!==null){dojo.connect(this.oUserName,"focus",this,function(event){dj.util.Form.clearValue(this.oUserName,"User Name");});dojo.connect(this.oUserName,"click",this,function(event){dj.util.Form.clearValue(this.oUserName,"User Name");});}
dojo.connect(dojo.byId("fbLoginForm"),"onsubmit",this,function(e){dojo.stopEvent(e);this.submitLoginForm();});},validateLoginForm:function(loginData){this.errorArr=new Array();var validate=true;if(!this.chkEmpty(loginData.username)){this.errorArr.push(this._nodes.usernamemissing);this.addErrorClass(this._nodes.userOrEmailInput);validate=false;}
if(validate){if(!this.chkEmpty(loginData.password)){this.errorArr.push(this._nodes.passwordmissing);this.addErrorClass(this._nodes.password);validate=false;}}
this.showErrorMessage(loginData.errorUI,this.errorArr);this.errorArr=new Array();return validate;},submitLoginForm:function(){if(dojo.hasClass(dojo.byId("loginSubmit"),"disabled")){return;}
this.clearRedBoundaryFromFields("loginForm");var loginData=this.setupLoginData();if(!this.validateLoginForm(loginData)){return;}
dojo.byId(this._nodes.errorUl).innerHTML="";dojo.addClass(dojo.byId("loginSubmit"),"disabled");var postData={"username":dj.lang.trim(loginData.username),"password":loginData.password,"url":encodeURIComponent(dj.context.account.testLogin)+"?fbConnectPageUrl="+this.fbconnectURL,"template":"default","realm":"default","savelogin":loginData.savelogin};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(postData),this.load,this.error,this);},submitFBForm:function(){if(dojo.hasClass("fbconnect","disabled")){return;}
this.clearRedBoundaryFromFields("registrationForm");if(!this.validateRegistrationForm()){return;}
dojo.byId(this._nodes.registerErrorUl).innerHTML="";dojo.addClass(dojo.byId("fbconnect"),"disabled");var postData="profile.firstName="+this.oFirstName.value;postData+="&profile.lastName="+this.oLastName.value;postData+="&profile.emailAddress="+this.oEmailToRegister.value;postData+="&profile.password="+this.oNewPassword.value;postData+="&profile.passwordConfirmation="+this.oConfirmPassword.value;postData+="&profile.uuid=true";postData+="&profile.options.createCommunityProfile=";postData+="&profile.options.featureEmailOptIn=true";postData+="&profile.options.returnLink=http%3A%2F%2F"+document.domain;postData+="&service.registrationType=FREE_REGISTRATION";postData+="&profile.trackingCode=FACEBOOK_CONNECT";postData+="&profile.newsletterOptIns=";postData+="&service.templateCode="+this.PRODUCT_CD+"_FACEBOOK";postData+="&profile.registrationSource=facebook";dj.service.account.RegistrationService.registerUser(this._nodes.serviceUrls.registrationServiceUrl,postData,this.registrationLoad,this.registrationError,this);},registrationLoad:function(emailId){var postData={"username":dj.lang.trim(this.oEmailToRegister.value),"password":this.oNewPassword.value,"url":encodeURIComponent(dj.context.account.testLogin)+"?fbConnectPageUrl="+this.fbconnectURL,"template":"default","realm":"default","savelogin":"true"};dj.service.account.LoginService.loginUser(this._nodes.serviceUrls.loginServiceUrl,dojo.toJson(postData),this.load,this.error,this);},registrationError:function(errorsArr){dojo.removeClass(dojo.byId("fbconnect"),"disabled");dojo.forEach(errorsArr,function(entry,i){if(entry.indexOf("-")>-1){entry=entry.replace(/-/g,"");errorsArr[i]=entry;}},this);this.showErrorMessage(this._nodes.registerErrorUl,errorsArr);this.connectForgotPasswordFromIframe();var trackValues=new Array();var pName="";pName="WSJ_Auth_WSJ/Barrons_Login_Page_Post_FBConnect EmailAddressexists Error Page";this.lifpOmnitureTracking(trackValues,"event12",pName);},validateRegistrationForm:function(){var validation=true;if(!this.chkEmpty(this.oFirstName.value)){this.errorArr.push(this._nodes.firstNameRequired);this.addErrorClass(this._nodes.firstName);validation=false;}
if(!this.chkEmpty(this.oLastName.value)){this.errorArr.push(this._nodes.lastNameRequired);this.addErrorClass(this._nodes.lastName);validation=false;}
var emailValidation=this.chkEmailAddress(this.oEmailToRegister.value);if(!emailValidation){this.addErrorClass(this._nodes.emailToRegister);}
validation=validation?emailValidation:false;var newPassValidation=this.validateNewPassword();if(!newPassValidation){this.addErrorClass(this._nodes.newPassword);}
var confirmPassValidation=this.validateConfirmPassword();if(!confirmPassValidation){this.addErrorClass(this._nodes.confirmPassword);}
validation=validation?newPassValidation?confirmPassValidation:false:false;if(newPassValidation&&confirmPassValidation){if(!this.chkPasswordMatch(this.oNewPassword,this.oConfirmPassword,this._nodes.registerErrorUl)){validation=false;}}
this.showErrorNClearArray();return validation;},showErrorNClearArray:function(){this.showErrorMessage(this._nodes.registerErrorUl,this.errorArr);this.errorArr=new Array();},getFBConnectURL:function(currentpageURL){var query=currentpageURL.substring(currentpageURL.indexOf("?")+1,currentpageURL.length);var queryObject=dojo.queryToObject(query);var fbConnectURL="";if(typeof queryObject.url!="undefined"){if(queryObject.url.constructor.toString().indexOf("Array")==-1){var fbConnectURL=queryObject.url;}else{var fbConnectURL=queryObject.url[1];}}else{var uri=currentpageURL.substring(0,currentpageURL.indexOf("?"));fbConnectURL=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(uri);fbConnectURL=encodeURIComponent(fbConnectURL);}
fbConnectURL=fbConnectURL;return fbConnectURL;},clearRedBoundaryFromFields:function(formName){if(typeof formName=="undefined"){formName="loginForm";}
if(formName=="registrationForm"){dojo.removeClass(dojo.byId(this._nodes.firstName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.lastName),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.emailToRegister),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.newPassword),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.confirmPassword),this._nodes.fieldErrorClass);}else if(formName=="loginForm"){dojo.removeClass(dojo.byId(this._nodes.userOrEmailInput),this._nodes.fieldErrorClass);dojo.removeClass(dojo.byId(this._nodes.password),this._nodes.fieldErrorClass);}}});dojo.provide("dj.widget.loader.ScrimLoaders");dojo.require("dj.widget.loader.LoaderInstanceFactory");dojo.require("dj.util.Url");dj.widget.loader.ScrimLoaders={init:function(cfg){},callBackFromIframe:function(userdata){userdata=dojo.fromJson(userdata);if(typeof userdata!="undefined"){if(typeof userdata.logout!="undefined"){this.initIFrameForLogout();dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId("getGreyBckgroundCSSDiv"));}
if(typeof userdata.refreshPageUrl!="undefined"){window.location=decodeURIComponent(userdata.refreshPageUrl);}
if(typeof userdata.close!="undefined"){dojo.destroy(dojo.byId("moduleiframe"));dojo.destroy(dojo.byId("getGreyBckgroundCSSDiv"));}else{parent.dojo.destroy("moduleiframe");}
if(typeof userdata.screenName!="undefined"){if(userdata.screenName==="LoginVerifyEmail"){dojo.require("dj.widget.loader.LoginVerifyEmailLoader");dj.widget.loader.LoaderInstanceFactory.getLoginVerifyEmailLoaderInstance(userdata).initScrimFromIframe();}else if(userdata.screenName==="UnverifiedFreeReg"){dojo.require("dj.widget.loader.UnverifiedFreeRegLoader");dj.widget.loader.LoaderInstanceFactory.getUnverifiedFreeRegLoaderInstance(userdata).initScrimFromIframe();}else if(userdata.screenName==="FbLoginOrWSJPswd"){dojo.require("dj.widget.loader.FbLoginOrWSJPswdLoader");dj.widget.loader.LoaderInstanceFactory.getFbLoginOrWSJPswdLoaderInstance(userdata).initScrimFromIframe();}else if(userdata.screenName==="RegistrationConfirmation"){dojo.require("dj.widget.loader.ThankYouLoader");dj.widget.loader.LoaderInstanceFactory.getThankYouLoaderInstance(userdata).initScrimFromIframe();}else if(userdata.screenName==="ForgotUsername"){dojo.require("dj.widget.loader.ForgotUserOrPswdLoader");dj.widget.loader.LoaderInstanceFactory.getForgotUserOrPswdLoaderInstance(userdata).initScrimFromIframe();}else if(userdata.screenName==="ForgotPassword"){dojo.require("dj.widget.loader.ForgotPasswordLoader");dj.widget.loader.LoaderInstanceFactory.getForgotPasswordLoaderInstance(userdata).initScrimFromIframe();}else if(userdata.screenName==="Registration"){dojo.require("dj.widget.loader.RegistrationLoader");dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance().initRegisterScrimInIframe();}else if(userdata.screenName==="FBInit"){dojo.require("dj.widget.loader.FBInitLoader");dj.widget.loader.LoaderInstanceFactory.getFBInitLoaderInstance(userdata.cfg).initScrimFromIframe();}else if(userdata.screenName==="Login"){dojo.require("dj.widget.loader.LoginLoader");dj.widget.loader.LoaderInstanceFactory.getLoginLoaderInstance(userdata.cfg).initLoginScrimInIframe();}else if(userdata.screenName==="FBConnected"){dojo.require("dj.widget.loader.FBConnectedLoader");dj.widget.loader.LoaderInstanceFactory.getFBConnectedLoaderInstance(userdata.cfg).initScrimFromIframe();}else if(userdata.screenName==="UserWithoutEmail"){dojo.require("dj.widget.loader.UserWithourEmailConfirmationLoader");dj.widget.loader.LoaderInstanceFactory.getUserWithourEmailConfirmationLoaderInstance(userdata).initScrimFromIframe();}}else if(typeof userdata.confScreenName!="undefined"){dj.widget.loader.LoaderInstanceFactory.getConfirmationLoaderInstance(userdata).initScrimFromIframe();}}},callBackFromAdops:function(operation,trackCode){parent.dojo.destroy("moduleiframe");parent.dojo.destroy("overlayDiv");if(typeof operation!="undefined"){if(operation=="subscribeFromOverlay"){parent.location=dj.context.account.subscribeOfferFromLoginOverlay;}else if(operation=="subscribeFromPage"){parent.location=dj.context.account.subscribeOfferFromLoginPage;}else if(operation=="subscribeFromAmazonPage"){parent.location=dj.context.account.subscribeFromAmazonPage;}else if(operation=="subscribeFromFB"){parent.location=dj.context.account.subscribeOfferFromFBOverlay;}else if(operation=="subscribeFromRegistration"){parent.location=dj.context.account.subscribeOfferFromRegistrationOverlay;}else if(operation=="registerFromPage"||operation=="registerFromOverlay"){dojo.require("dj.widget.loader.RegistrationLoader");dj.widget.loader.LoaderInstanceFactory.getRegistrationLoaderInstance().initRegisterScrimInIframe();}}},chkIfHttpsDomain:function(){try{if(typeof parent.location.href!="undefined"&&parent.location.href.indexOf("https://")>-1){return true;}
return false;}catch(e){return false;}},initIFrameForLogout:function(){var logoutDomNodeId="unverifiedFreeReglogout";if(dojo.byId(logoutDomNodeId)==null){dojo.create("div",{id:logoutDomNodeId,"class":"hidden"},dojo.body(),"last");}
var url="http://"+document.domain+"/logout";var options={"src":url,"class":"hidden"};setTimeout(this.isUserLoggedout,10000);dj.util.Url.createSimpleIframe(options,logoutDomNodeId,this.testLogoutIframeLoaded,this);},testLogoutIframeLoaded:function(){this.userLoggedOut=true;dojo.destroy("unverifiedFreeReglogout");},isUserLoggedout:function(){if(!this.userLoggedOut){if(window.console)console.warn(" unverified free reg user couldn't be logged out ");}
this.userLoggedOut=false;}};
dojo.provide("dj.module.scrimloader.ScrimLoader");dojo.declare("dj.module.scrimloader.ScrimLoader",[],{DEFAULT_CONFIG:{scrimWrapperDiv:"genericdiv"},constructor:function(scrimConfig,callBack){if(callBack){this.preCallback=callBack.preCallBack;this.postCallback=callBack.postCallBack;this.callbackContext=callBack.context;}
this.cfg=dojo.mixin(this.DEFAULT_CONFIG,scrimConfig);},initScrim:function(){this._preCallback(this.preCallback,this.callbackContext);var d=dojo;d.require("djscript.require.dj_module_scrimloader.version.1");d.addOnLoad(this._requiredJSLoaded());},_requiredJSLoaded:function(){this._loadScrimContent();this._showScrim();},_showScrim:function(){var _scrimContentObj=new dj.widget.scrim.ShowScrim(this.cfg);this.dialog=_scrimContentObj.init();},_loadScrimContent:function(){var cnt=dojo.create("div",{"id":this.cfg.scrimWrapperDiv},dojo.body(),"last");this._scrimContent=new dj.module.scrimloader.LoadScrimContent(this.cfg,this.postCallback,this.callbackContext);this._scrimContent.init();},_preCallback:function(preCallbackFunc,context){if(typeof preCallbackFunc==='function'){return preCallbackFunc.call(context);}
return false;}});dojo.provide("dj.widget.scrim.starbucksscrim.scrimTracking");dojo.require("dj.util.Tracking");dj.widget.scrim.starbucksscrim.scrimTracking={init:function(){this.omniture={};this.omniture.saveVars=["pageName","prop2","prop3","prop4","prop8","prop20","prop26"];this.omniture.saveValues=[];},omnituresavepixel:function(){var svlen=this.omniture.saveVars.length;for(var f=0;f<svlen;f++){this.omniture.saveValues[f]=this.omniture.pixel.getMetaData(this.omniture.saveVars[f]);}},omniturerestorepixel:function(){var svlen=this.omniture.saveVars.length;for(var f=0;f<svlen;f++){this.omniture.pixel.setMetaData(this.omniture.saveVars[f],this.omniture.saveValues[f]);}},omniturefirepixel:function(){this.init();if(!this.omniture.pixel){this.omniture.pixel=dj.util.Tracking.omniture;}
this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData('pageName','WSJ_Starbucks Scrim');this.omniture.pixel.setMetaData('section','Customer Resources');this.omniture.pixel.setMetaData('subsection','WSJ_Marketing');this.omniture.pixel.setMetaData('apage','WSJ_Customer Resources_Starbucks Scrim');this.omniture.pixel.setMetaData('atype','WSJ_Customer Resources_Starbucks Scrim');this.omniture.pixel.setMetaData('aheadline','');this.omniture.pixel.setMetaData('csource','WSJ Online');this.omniture.pixel.setMetaData('abasedocid','');this.omniture.pixel.setMetaData('basesection','WSJ_Marketing');this.omniture.pixel.firePixel(true);this.omniturerestorepixel();}};dojo.provide("dj.module.starbucksscrim.StarbucksScrim");dojo.require("dj.module.scrimloader.ScrimLoader");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.widget.scrim.starbucksscrim.scrimTracking");dojo.declare("dj.module.starbucksscrim.StarbucksScrim",dj.module.scrimloader.ScrimLoader,{constructor:function(scrimConfig,callBack){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,scrimConfig);this.postCallback=this._postScrimCall;this.callbackContext={StarbucksScrimObj:this};},init:function(){this.showScrim();},hasSeenScrim:function(){return(dj.util.Cookie.getGroupCookie('DJSESSION',this.cfg.cookieName)!==null);},setScrimAsSeen:function(){dj.util.Cookie.setGroupCookie('DJSESSION',this.cfg.cookieName,"true");},showScrim:function(){if(!this.hasSeenScrim()){if(this._isIpad()){return false;}
if(this._isBlockedScreenResolution(600,800)){return false;}
this._isWsjUser();}
return false;},_isBlockedScreenResolution:function(height,width){if((screen.height<=height)&&(screen.width<=width)){return true;}
return false;},_isIpad:function(){if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/Android/i))||(navigator.userAgent.match(/iPad/i))){return true;}
return false;},_postScrimCall:function(StarbucksScrimObj){dojo.connect(dojo.query(".closeBtn")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide();});dojo.connect(dojo.query(".scrimStarbucksReadMore")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide();});dojo.connect(dojo.query(".starbucksScrimBtnNo")[0],"click",this,function(){this.StarbucksScrimObj.dialog.hide();});dojo.query(".dijit_scrim")[0].style.zIndex=1050;dj.widget.scrim.starbucksscrim.scrimTracking.omniturefirepixel();},_isWsjUser:function(){var that=this;dj.util.User.isOpenHouseUser('SDN',function(isOpenHouseUser){if(isOpenHouseUser){dj.util.User.isLoggedIn(function(isLoggedIn){if(!isLoggedIn){that.setScrimAsSeen();that.initScrim();}});}});}});dojo.provide("dj.module.facebook.connect");dojo.require("dj.lang");
dj.module.facebook.connect={init:function(a,b){window.fbAsyncInit=function(){FB.UIServer.setActiveNode=function(c,d){FB.UIServer._active[c.id]=d};FB.init({appId:dj.context.facebook.appId,status:true,cookie:false,xfbml:true,oauth:true});FB.getLoginStatus(function(){if(typeof a=="function")b?a.apply(b):a()})};(function(){var c=document.createElement("script");c.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";c.type="text/javascript";c.charset="utf-8";c.async=true;var d=dojo.byId("fb-root");
if(null==d)d=dojo.create("div",{id:"fb-root",style:{display:"none"}},dojo.body());dojo.place(c,d)})()},registerFBConnect:function(a){if(typeof a=="undefined")a=fbScrimCFG;FB.getLoginStatus(function(b){console.log("Facebook connect staus: "+b.status);if(b.status=="connected"){dojo.require("dj.widget.loader.FBLoginLoader");dojo.require("dj.widget.accountscrim.FBLogin");(new dj.widget.loader.FBLoginLoader(a)).init()}})},fbConnected:function(a){if(typeof a=="undefined")a=fbScrimCFG;dojo.require("dj.widget.loader.FBConnectedLoader");
dojo.require("dj.widget.accountscrim.FBConnected");(new dj.widget.loader.FBConnectedLoader(a)).initScrim()},fireScrimPixel:function(a){if(typeof setMetaData!="undefined"){var b=dj.util.Tracking.omniture.getMetaData("pagename"),c=dj.util.Tracking.omniture.getMetaData("ctype"),d=dj.util.Tracking.omniture.getMetaData("section"),e=dj.util.Tracking.omniture.getMetaData("subsection"),h=dj.util.Tracking.omniture.getMetaData("caccess"),g=dj.util.Tracking.omniture.getMetaData("qsymbol"),f=dj.util.Tracking.omniture.getMetaData("basesection");
setMetaData("pagename",a);setMetaData("ctype","marketing and support");setMetaData("section","WSJ_Customer Resources");setMetaData("subsection","WSJ_Customer Resources");setMetaData("caccess","free");setMetaData("basesection","WSJ_FBconnect");setMetaData("qsymbol",null);dj.util.Tracking.omniture.firePixel();setMetaData("pagename",b);setMetaData("ctype",c);setMetaData("section",d);setMetaData("subsection",e);setMetaData("caccess",h);setMetaData("basesection",f);setMetaData("qsymbol",g)}},login:function(a){typeof FB==
"undefined"?this.init(dj.module.facebook.connect.processLogin):this.processLogin(a)},processLogin:function(a,b){if(a)this.afterLoginURL=a;typeof b!="undefined"?FB.login(b,{scope:"publish_stream,email,read_stream,publish_actions"}):FB.login(dj.module.facebook.connect.afterLogin,{scope:"publish_stream,email,read_stream,publish_actions"})},afterLogin:function(a){if(a.authResponse){a=FB.JSON.stringify(a.authResponse);dj.util.Cookie.setCookie("djfbsr_"+dj.context.facebook.appId,a);if(dj.module.facebook.connect.afterLoginURL)location.href=
dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(dj.module.facebook.connect.afterLoginURL);else{oldUrlParts=location.href.split("?");location.href=dj.context.facebook.commerceFBConnectURL+"?url="+encodeURIComponent(oldUrlParts[0])}}},addConnectClick:function(a,b){var c=this;dj.lang.addLiveEvent(a,"click",function(d){dojo.stopEvent(d);c.login(b)})},displayMessage:function(a){a.url="";a.message="";typeof a.callback=="function"&&a.callback()},logout:function(a){dj.util.Cookie.deleteCookie("djfbsr_"+
dj.context.facebook.appId);FB.logout(a)},getUserID:function(){return FB.getAuthResponse()?FB.getAuthResponse().userID:null},getFBUserInfo:function(){var a;FB.api("/me",function(b){a=b});return a},checkQueryString:function(a){fbScrimCFG=a;var b=dojo.queryToObject(window.location.search.slice(1));if(typeof b.fbresult!="undefined")if(b.fbresult=="add")typeof FB=="undefined"?dj.module.facebook.connect.init(dj.module.facebook.connect.fbConnected):dj.module.facebook.connect.fbConnected(a);else if(b.fbresult==
"register")typeof FB=="undefined"?dj.module.facebook.connect.init(dj.module.facebook.connect.registerFBConnect):dj.module.facebook.connect.registerFBConnect(a)},publish:function(a,b){if(typeof FB!="undefined"){if(FB.getAuthResponse()){myObj=a;myObj.method="stream.publish";myObj.preview=1;myObj.display="popup";FB.ui(myObj,b)}}else{console.error("User is not logged in or FB in undefined");b(false)}},showModalScrim:function(){var a=dojo.byId("fbscrim"),b=dojo.byId("fbscrim_content");a.style.display=
"block";b.style.display="block";dojo.query("div#fbscrim_content a.closebtn").connect("onclick",dj.module.facebook.connect.hideModalScrim)},hideModalScrim:function(){var a=dojo.byId("fbscrim"),b=dojo.byId("fbscrim_content");a.style.display="none";b.style.display="none"},openModalMessage:function(){}};
dojo.provide("dj.module.facebook.api");dojo.require("dj.module.facebook.connect");
dj.module.facebook.api={modValue:"fbconnect_wsj",numOfWords:40,truncateWords:function(a,b){var c="",d=a.split(" ");if(d.length>b){c="...";d=d.slice(0,b)}return d.join(" ")+c},addtracking:function(a,b){parseUri=function(g){var f=parseUri.options;g=f.parser[f.strictMode?"strict":"loose"].exec(g);for(var n={},m=14;m--;)n[f.key[m]]=g[m]||"";n[f.q.name]={};n[f.key[12]].replace(f.q.parser,function(k,i,j){if(i)n[f.q.name][i]=j});return n};parseUri.options={strictMode:false,key:["source","protocol","authority",
"userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
var c=parseUri(a),d=c.protocol+"://"+c.host+c.path+"?",e=b?b:this.modValue,h;for(h in c.queryKey)if(String(h).toUpperCase()!="MOD")d+=h+"="+c.queryKey[h]+"&";d+="mod="+e;d+=c.anchor?"#"+c.anchor:"";return d},postAnswer:function(a){if(!(a.question&&a.answer&&a.questionPermalink))return false;var b=this.truncateWords(a.answer,this.numOfWords),c={name:a.question,href:this.addtracking(a.questionPermalink),caption:"WSJ.com"},d=[{text:"Answer",href:this.addtracking(a.questionPermalink)}];this.sendStream(b,
c,d,a.callbackFn,a.callbackParams)},postArticleComment:function(a){if(!(a.comment&&a.commentPermalink))return false;JSON.stringify=function(g){return dojo.toJson(g)};var b=typeof AT_VARS!="undefined"?AT_VARS.articleUrl:a.commentPermalink,c=typeof AT_VARS!="undefined"?AT_VARS.seoHeadline:"";if(typeof c=="undefined")c=AT_VARS.articleHeadline;var d=typeof AT_VARS!="undefined"?AT_VARS.imgSizeA:"http://s.wsj.net/img/WSJ_profile_lg.gif",e=typeof AT_VARS!="undefined"&&typeof AT_VARS.bodyText!="undefined"?
AT_VARS.bodyText.replace(/\+/g," "):"",h=this.truncateWords(a.comment,this.numOfWords);c={name:c,href:this.addtracking(b),description:unescape(e),caption:"WSJ.com"};if(d!=null)c.media=[{type:"image",src:d,href:this.addtracking(b)}];b=[{text:"Read the Article",href:this.addtracking(a.commentPermalink)}];this.sendStream(h,c,b,a.callbackFn,a.callbackParams)},postCreateGroup:function(a){if(!(a.groupName&&a.groupDescription&&a.groupPermalink))return false;var b={name:a.groupName,href:this.addtracking(a.groupPermalink),
description:a.groupDescription,caption:"WSJ.com"},c=[{text:"Join this Journal Group",href:this.addtracking(a.groupPermalink)}];this.sendStream("",b,c,a.callbackFn,a.callbackParams)},postJoinGroup:function(a){if(!(a.groupName&&a.groupDescription&&a.groupPermalink))return false;var b={name:a.groupName,href:this.addtracking(a.groupPermalink),description:a.groupDescription,caption:"WSJ.com"},c=[{text:"Join this Journal Group",href:this.addtracking(a.groupPermalink)}];this.sendStream("",b,c,a.callbackFn,
a.callbackParams)},postPollVote:function(a){if(!a)return null;params=dojo.fromJson(a);a="";JSON.stringify=function(c){return dojo.toJson(c)};for(var b=0;b<params.options.length;b++)a+=b+1+") "+params.options[b].value+" ";a={name:params.question,href:this.addtracking(window.location),description:a,media:[{type:"image",src:"http://s.wsj.net/img/WSJ_profile_lg.gif",href:this.addtracking(window.location)}]};b=[{text:"Related Article",href:this.addtracking(params.poll_meta.urlSrc)}];if(params.poll_meta.communityURLSrc!=
"")b=[{text:"Journal Community Group",href:this.addtracking(params.poll_meta.communityURLSrc)}];this.sendStream("voted on a Wall Street Journal poll",a,b,function(){},null)},postQuestion:function(a){if(!(a.question&&a.category&&a.questionPermalink))return false;var b=this.truncateWords(a.question,this.numOfWords),c={name:a.category,href:this.addtracking(a.questionPermalink),caption:"WSJ.com"},d=[{text:"Answer",href:this.addtracking(a.questionPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},
postTopic:function(a){if(!(a.topic&&a.topicPermalink&&a.description))return false;var b=this.truncateWords(a.topic,this.numOfWords),c={name:a.topic,href:this.addtracking(a.topicPermalink),description:a.description,caption:"WSJ.com"},d=[{text:"Join the discussion",href:this.addtracking(a.topicPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},postTopicComment:function(a){if(!(a.comment&&a.commentPermalink&&a.topicName&&a.topicDescription&&a.topicPermalink))return false;var b=this.truncateWords(a.comment,
this.numOfWords),c={name:a.topicName,href:this.addtracking(a.topicPermalink),description:a.topicDescription,caption:"WSJ.com"},d=[{text:"Join this discussion",href:this.addtracking(a.commentPermalink)}];this.sendStream(b,c,d,a.callbackFn,a.callbackParams)},sendStream:function(a,b,c,d,e){var h=-1;FB.getLoginStatus(function(g){g.session?dj.module.facebook.connect.publish({message:a,attachment:b,action_links:c},function(f){if(f){h=f.post_id;dj.module.facebook.api.omnitureEventCall("event56");d?d(e,dj.module.facebook.connect.getUserID(),
h):console.log("success: "+h)}}):dj.module.facebook.connect.processLogin(document.location,dojo.hitch(this,dj.module.facebook.api.sendStream,a,b,c,d,e))});return h},omnitureEventCall:function(){if(typeof s!="undefined"){s.linkTrackVars="events";s.linkTrackEvents="event56";s.events="event56";s.tl(this,"o","fb_activity");s.linkTrackVars="None";s.linkTrackEvents="None"}}};

dojo.provide("dj.community.Subject");dj.community.Subject=function(uri,display,href,typeName,tags,locale){this['s.uri']=uri;this['s.name']=display;this['s.href']=href;this['s.typeName']=typeName;this['s.tags']=tags;this['s.locale']=locale;};dojo.provide("dj.community.feedback");dojo.require("dj.widget.Slider");dj.community.feedback.toggleCommentByForce=function(commentEntry){var entry=dojo.byId(commentEntry);var messageSpan=dojo.query('.cToggle_message',entry)[0];var toggleLink=dojo.query('.cToggle_link a',entry)[0];if(!dojo.hasClass(entry,'cUnitType-forceshow')){dojo.addClass(entry,'cUnitType-forceshow');messageSpan.innerHTML='Nonsubscriber comment';toggleLink.innerHTML='Hide this comment <span>-</span>';}
else
{dojo.removeClass(entry,'cUnitType-forceshow');messageSpan.innerHTML='Nonsubscriber comments are set to \"Hide\"';toggleLink.innerHTML='Show this comment <span>+</span>';}};dj.community.feedback.toggleHelp=function(tooltipTrigger){var container=dojo.query('.sliderbox_tooltip_cont')[0];var trigger=dojo.query('.tooltip_trigger',container)[0];if(dojo.hasClass(container,'sliderbox_tooltip_hidden')){dojo.removeClass(container,'sliderbox_tooltip_hidden');dojo.addClass(container,'sliderbox_tooltip_visible');trigger.innerHTML=dj.community.localPrompt.closeDialog;}
else
{dojo.removeClass(container,'sliderbox_tooltip_visible');dojo.addClass(container,'sliderbox_tooltip_hidden');trigger.innerHTML=dj.community.localPrompt.whatIsIt;}};dj.community.feedback.toggleComments=function(sliderId,siteRoot){if(!dojo.byId(sliderId)||dojo.hasClass(dojo.byId(sliderId),"comment-slider")){return;}
var show=0;var fade=1;var hide=2;var sliderElement=dojo.byId(sliderId);var threadContainer=dojo.byId('threadcontainer0405091518');var hideClass='threadbox_nonsub_hide';var fadeClass='threadbox_nonsub_fade';function fadeComments(){if(dojo.hasClass(threadContainer,hideClass)){dojo.removeClass(threadContainer,hideClass);}
dojo.addClass(threadContainer,fadeClass);}
function hideComments(){if(dojo.hasClass(threadContainer,fadeClass)){dojo.removeClass(threadContainer,fadeClass);}
dojo.addClass(threadContainer,hideClass);}
function showComments(){if(dojo.hasClass(threadContainer,fadeClass)){dojo.removeClass(threadContainer,fadeClass);}
if(dojo.hasClass(threadContainer,hideClass)){dojo.removeClass(threadContainer,hideClass);}}
function toggle(value){switch(value){case fade:fadeComments();break;case hide:hideComments();break;default:showComments();break;}}
function save(value){dojo.xhrPost({url:siteRoot+'/member/updateNonSubscriberCommentTransparency.rails',postData:'value='+value});}
function getCurrentSetting(){if(dojo.hasClass(threadContainer,fadeClass)){return fade;}
else if(dojo.hasClass(threadContainer,hideClass)){return hide;}
return show;}
function changeSetting(value){if(getCurrentSetting()!=value){toggle(value);save(value);}}
var slider=new dj.widget.Slider(dojo.query('.slider_pointer',sliderElement),sliderElement,{range:{start:0,end:2},values:[0,1,2],sliderValue:getCurrentSetting(),onChange:function(value){setTimeout(function(){changeSetting(value);},0);}});dojo.addClass(sliderElement,"comment-slider");};dojo.provide("dj.module.communityUser");dojo.require("dj.widget.panel.ModalPanel");dojo.require("dj.util.Element");dojo.require("dj.util.Url");dj.module.communityUser={ajaxPost:function(postUrl,args,callback){dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(args),error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));callback(ioargs,json);}});},ajaxUpdate:function(oElement,postUrl,args,callback){dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),oElement,"only");},error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));callback(ioargs,json);}});},handleError300:function(postUrl,args,uFirstName,uLastName,callback){this.initializeCommunityUserPopup(postUrl,args,uFirstName,uLastName,300,callback);this._openCommunityUserPopup();},handleError301:function(uFirstName,uLastName){this.initializeCommunityUserPopup("","",uFirstName,uLastName,301);this._openCommunityUserPopup();},_openCommunityUserPopup:function(){var oPopupPosition=dojo.position(this.oPopup,true);dojo.style(this.oPopup,{position:"absolute",left:oPopupPosition.x+"px",top:(oPopupPosition.y+200)+"px",width:oPopupPosition.w+"px",height:oPopupPosition.h+"px"});var panel=new dj.widget.panel.ModalPanel(null,dojo.query("div.communityUserPopup")[0],{closeModalPanelEvent:"click",closeModalPanelButtonSelector:".popupClose"});},initializeCommunityUserPopup:function(postUrl,args,uFirstName,uLastName,errorCode,callback){this.oPopup=dojo.query("div.communityUserPopup")[0];this.oUnblockedUserContainer=dojo.query(".unblockedUser",this.oPopup)[0];this.oBlockedUserContainer=dojo.query(".blockedUser",this.oPopup)[0];this.oCommentsText=dojo.query(".commentsText",this.oPopup)[0];this.oAskQuestionText=dojo.query(".askQuestionText",this.oPopup)[0];this.oUserFirstName=dojo.query(".userFirstName",this.oPopup);this.oUserLastName=dojo.query(".userLastName",this.oPopup);if((postUrl!==null)&&(postUrl.indexOf('SaveQuestion')!==-1)){dj.util.Element.show(this.oAskQuestionText);dj.util.Element.hide(this.oCommentsText);}else{dj.util.Element.hide(this.oAskQuestionText);dj.util.Element.show(this.oCommentsText);}
var that=this;var isUserFirstLastNamePresent=true;if(((uFirstName===null)||(uFirstName===''))&&((uLastName===null)||(uLastName===''))){isUserFirstLastNamePresent=false;}
if(errorCode===300){this.oBlockedUserContainer.setStyle({display:"none"});this.oUnblockedUserContainer.setStyle({display:"block"});this.oPost=dojo.query(".post",this.oPopup)[0];this.oChkBox=dojo.query(".chkBox",this.oPopup)[0];this.oWhyLink=dojo.query(".whyLink",this.oPopup)[0];this.oWhyLinkPara=dojo.query(".whyLinkPara",this.oPopup)[0];this.oFirstNameText=dojo.query(".firstNameText",this.oPopup)[0];this.oLastNameText=dojo.query(".lastNameText",this.oPopup)[0];this.oUserNameInfoContainer=dojo.query(".userNameInfoContainer",this.oPopup)[0];this.oErrorMessage=dojo.query(".errorMessage",this.oPopup)[0];this.oCommunityLink=dojo.query(".communityLink",this.oPopup)[0];this.oPrivacyLink=dojo.query(".privacyLink",this.oPopup)[0];this.oTermsLink=dojo.query(".termsLink",this.oPopup)[0];if(isUserFirstLastNamePresent===false){dj.util.Element.show(this.oUserNameInfoContainer);}else{dj.util.Element.hide(this.oUserNameInfoContainer);this.oUserFirstName.forEach(function(oFirstName){oFirstName.innerHTML=", "+uFirstName;});this.oUserLastName.forEach(function(oLastName){oLastName.innerHTML=uLastName+",";});}
if(this.whyLinkListener!==null){dojo.disconnect(this.oWhyLinkClickHandle);}
if(this.communityLinkListener!==null){dojo.disconnect(this.oCommunityLinkClickHandle);}
if(this.privacyLinkListener!==null){dojo.disconnect(this.oPrivacyLinkClickHandle);}
if(this.termsLinkListener!==null){dojo.disconnect(this.oTermsLinkClickHandle);}
if(this.postListener!==null){dojo.disconnect(this.oPostClickHandle);}
this.whyLinkListener=dojo.hitch(this.oWhyLink,function(event){dj.util.Element.show(that.oWhyLinkPara);dj.util.Element.hide(that.oWhyLink);});this.communityLinkListener=dojo.hitch(this.oCommunityLink,function(event){dojo.stopEvent(event);dj.util.Url.openWin("/community");});this.privacyLinkListener=dojo.hitch(this.oPrivacyLink,function(event){dojo.stopEvent(event);dj.util.Url.openWin("/public/page/privacy_policy.html");});this.termsLinkListener=dojo.hitch(this.oTermsLink,function(event){dojo.stopEvent(event);dj.util.Url.openWin("/public/page/subscriber_agreement.html");});this.postListener=dojo.hitch(this.oPost,function(event){if(that.oChkBox.checked===true){args.mode=2;}else
if(that.oChkBox.checked===false){args.mode=1;}
if(isUserFirstLastNamePresent===false){if(((that.oFirstNameText.value===null)||(that.oFirstNameText.value===''))&&((that.oLastNameText.value===null)||(that.oLastNameText.value===''))){dojo.stopEvent(event);that.oErrorMessage.show();that._openCommunityUserPopup();}else{args.firstName=that.oFirstNameText.value;args.lastName=that.oLastNameText.value;that.ajaxPost(postUrl,args,callback);}}else{args.firstName=uFirstName;args.lastName=uLastName;that.ajaxPost(postUrl,args,callback);}});this.oWhyLinkClickHandle=dojo.connect(this.oWhyLink,"onclick",this.whyLinkListener);this.oCommunityLinkClickHandle=dojo.connect(this.oCommunityLink,"onclick",this.communityLinkListener);this.oPrivacyLinkClickHandle=dojo.connect(this.oPrivacyLink,"onclick",this.privacyLinkListener);this.oTermsLinkClickHandle=dojo.connect(this.oTermsLink,"onclick",this.termsLinkListener);this.oPostClickHandle=dojo.connect(this.oPost,"onclick",this.postListener);}else
if(errorCode===301){this.oBlockedUserContainer.setStyle({display:"block"});this.oUnblockedUserContainer.setStyle({display:"none"});if(isUserFirstLastNamePresent===true){this.oUserFirstName.forEach(function(oFirstName){oFirstName.innerHTML=uFirstName;});this.oUserLastName.forEach(function(oLastName){oLastName.innerHTML=uLastName;});}}}};dojo.provide("dj.community.communityintegration");dojo.require("dj.module.communityUser");dojo.require("dj.util.Element");dj.community.communityintegration={toggleContent:function(id){var el=dojo.byId(id);if(el.style.display==="none"){el.style.display="";}else{el.style.display="none";}},CommunityIntegration:function(siteroot,fullsiteroot){this._siteroot=siteroot;this.fullsiteroot=fullsiteroot;},postQuestion:function(siteroot,fullsiteroot){if(dojo.byId('message')){dojo.byId('message').innerHTML="";}
var sDescText=dojo.byId('AskQDescription').value;if(sDescText=='Enter your question*'){sDescText='';dojo.byId('AskQDescription').value='';}
var strimmedDesc=sDescText.replace(/^\s+|\s+$/g,'');var objErrorQstMandatory=dojo.byId('errorQstMandatory');var objErrorCatMandatory=dojo.byId('errorCatMandatory');var objErrorDefault=dojo.byId('errorDefault');var objErrorComplyPolicy=dojo.byId('errorComplyPolicy');var objDescription=dojo.byId('AskQDescription');var objErrorQuesLabel=dojo.byId('errorQuesLabel');var objCategory=dojo.byId('Category');var objSubCategoryId=dojo.byId('SubCategoryId');var objErrorSubCatMandatory=dojo.byId('errorSubCatMandatory');if(strimmedDesc.length===0&&objCategory.value=="-1"&&objSubCategoryId.value=="-1"){objErrorQuesLabel.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='block';objErrorComplyPolicy.style.display='none';objErrorQstMandatory.style.display='none';return;}
if(strimmedDesc.length===0){objErrorQstMandatory.style.display='block';objErrorCatMandatory.style.display='none';objErrorSubCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objDescription.value=strimmedDesc;objDescription.focus();return;}
if(strimmedDesc.length>2000){objErrorQuesLabel.style.display='block';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorSubCatMandatory.style.display='none';objDescription.focus();return;}
objDescription.value=strimmedDesc;if(objCategory.value=="-1"){objErrorQstMandatory.style.display='none';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objErrorCatMandatory.style.display='block';objErrorSubCatMandatory.style.display='none';objCategory.focus();return;}
if(objSubCategoryId.value=="-1"){objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorComplyPolicy.style.display='none';objErrorSubCatMandatory.style.display='block';objSubCategoryId.focus();return;}
var subCategoryvar=objSubCategoryId.value;strimmedDesc=objDescription.value;var notifyMebool=dojo.byId('chkEmail').checked;var args={mode:0,firstName:null,lastName:null,subCategory:subCategoryvar,strDescription:strimmedDesc,notifyMe:notifyMebool};dj.module.communityUser.ajaxPost(fullsiteroot+"/public/SaveQuestion.html",args,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/#identifier";}
else if(transport.xhr.status==305){objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorSubCatMandatory.style.display='none';objErrorComplyPolicy.style.display='block';return false;}
else{if(transport.xhr.status==300){dj.module.communityUser.handleError300(fullsiteroot+"/public/SaveQuestion.html",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/#identifier";}
else if(transport.xhr.status==305){objErrorQstMandatory.style.display='none';objErrorCatMandatory.style.display='none';objErrorDefault.style.display='none';objErrorSubCatMandatory.style.display='none';objErrorComplyPolicy.style.display='block';return false;}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}}});},answerQuestion:function(siteroot,fullsiteroot){var answerText=dojo.byId('AnsDescription').value;if(answerText=='Enter your answer'){answerText='';dojo.byId('AnsDescription').value='';}
answerText=answerText.replace(/^\s+|\s+$/g,'');var questionId=dojo.byId('hdnQuestionId').value;if(answerText.length===0){dj.util.Element.show("errorAnsDefault");dj.util.Element.hide("errorAnsComplyPolicy");dojo.byId('errorAnsDefault').innerHTML='Please fill out the answer field.';return;}
if(answerText.length>2000){dj.util.Element.show("errorAnsDefault");dj.util.Element.hide("errorAnsComplyPolicy");dojo.byId('errorAnsDefault').innerHTML='The Answer should not be more than 2000 characters';return;}
var args={mode:0,firstName:null,lastName:null,questionId:questionId,strDescription:answerText};dj.module.communityUser.ajaxPost(fullsiteroot+"/public/SaveSectionAnswer.html",args,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/questions/"+questionId;}
else if(transport.xhr.status==305){dj.util.Element.show("errorAnsComplyPolicy");dj.util.Element.hide("errorAnsDefault");return false;}
else{if(transport.xhr.status==300){dj.module.communityUser.handleError300(fullsiteroot+"/public/SaveSectionAnswer.html",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){document.location.href=fullsiteroot+"/answer/questions/"+questionId;}
else if(transport.xhr.status==305){dj.util.Element.show("errorAnsComplyPolicy");dj.util.Element.hide("errorAnsDefault");return false;}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}}});},fnOpenMessageBox:function(targetElement,URI,rowKey){if(dojo.byId('hdnLastShownId').value!==""){dojo.byId(dojo.byId('hdnLastShownId').value).style.display="none";}
if(targetElement==1){targetElement='dvMessage'+rowKey;}else{targetElement='dvConnect'+rowKey;}
var subject='msgsubject'+rowKey;var message='msgeditor'+rowKey;var connectMessage='txtMessage'+rowKey;dojo.byId(targetElement).style.display='block';dojo.byId('hdnMemberUri'+rowKey).value=URI;dojo.byId('hdnLastShownId').value=targetElement;dojo.byId(subject).value="Subject";dojo.byId(message).value="Type your personal message.";if(dojo.byId(connectMessage)){dojo.byId(connectMessage).value="Type your personal message.";}
var _subjectGotFocus=function subject_GotFocus(){if(dojo.byId(subject).value=="Subject"){dojo.byId(subject).value="";}};var _subjectLostFocus=function subject_LostFocus(){if(dojo.byId(subject).value===""){dojo.byId(subject).value="Subject";}};var _messageGotFocus=function message_GotFocus(){if(dojo.byId(message).value=="Type your personal message."){dojo.byId(message).value="";}};var _messageLostFocus=function message_LostFocus(){if(dojo.byId(message).value===""){dojo.byId(message).value="Type your personal message.";}};var _messageConnectGotFocus=function messageConnect_GotFocus(){if(dojo.byId(connectMessage).value=="Type your personal message."){dojo.byId(connectMessage).value="";}};var _messageConnectLostFocus=function messageConnect_LostFocus(){if(dojo.byId(connectMessage).value===""){dojo.byId(connectMessage).value="Type your personal message.";}};subjectGotFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_subjectGotFocus();};subjectLostFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_subjectLostFocus();};messageGotFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageGotFocus();};messageLostFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageLostFocus();};messageConnectGotFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageConnectGotFocus();};messageConnectLostFocus=function(){dojo.deprecated("subjectGotFocus","to be removed","1.0.0");_messageConnectLostFocus();};dojo.connect(dojo.byId(subject),'onfocus',_subjectGotFocus);dojo.connect(dojo.byId(subject),'onblur',_subjectLostFocus);dojo.connect(dojo.byId(message),'onfocus',_messageGotFocus);dojo.connect(dojo.byId(message),'onblur',_messageLostFocus);dojo.connect(dojo.byId(connectMessage),'onfocus',_messageConnectGotFocus);dojo.connect(dojo.byId(connectMessage),'onblur',_messageConnectLostFocus);},SetMostFocus:function(){if(dojo.byId('commentBody')!==null&&dojo.byId('commentBody')!==undefined){dojo.byId('commentBody').focus();dojo.byId('commentBody').blur();}},ReportTopic1:function(ajaxFunction){dojo.xhrPost({url:ajaxFunction,handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));var reported=json.reported;var alreadyreported=json.alreadyreported;if(reported){dojo.byId('reporttopic').innerHTML="Topic Reported";}
if(alreadyreported){dojo.byId('reporttopic').innerHTML="Topic is already reported";}}});},fnCloseMessage:function(Rowkey){dojo.byId('dvMessage'+Rowkey).style.display='none';},fnCloseMessageSent:function(Rowkey){dojo.byId('dvMessageSent'+Rowkey).style.display='none';},fnCloseConnectionSent:function(Rowkey){dojo.byId('dvConnectionSent'+Rowkey).style.display='none';},ReportComment:function(siteroot,CommentId){var args={commentid:CommentId,mode:0,firstName:null,lastName:null};dj.module.communityUser.ajaxPost(siteroot+"/mdcrpc/comments/report.sync",args,function(transport,json){if(transport.xhr.status==200){dojo.byId('reportcomment'+CommentId).innerHTML=transport.xhr.responseText;}
else if(transport.xhr.status==300){dj.module.communityUser.handleError300(siteroot+"/comments/report.sync",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){dojo.byId('reportcomment'+CommentId).innerHTML=transport.xhr.responseText;}});}
else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}});},fnSendMessage:function(siteroot,Rowkey){var recipients=dj.community.communityintegration.trim(dojo.byId('hdnMemberUri'+Rowkey).value);var subject=dj.community.communityintegration.trim(dojo.byId('msgsubject'+Rowkey).value);var content=dj.community.communityintegration.trim(dojo.byId('msgeditor'+Rowkey).value);if(subject.length<=0||subject=='Subject'){dojo.byId('errorMsg'+Rowkey).style.display="block";dojo.byId('errorMsg'+Rowkey).innerHTML="Please enter valid subject.";return false;}
if(content.length<=0||content=='Type your personal message.'){dojo.byId('errorMsg'+Rowkey).style.display="block";dojo.byId('errorMsg'+Rowkey).innerHTML="Please enter valid message.";return false;}
subject=dj.community.communityintegration.fnReplaceHTMLTags(subject);content=dj.community.communityintegration.fnReplaceHTMLTags(content);var targetElement='dvMessage'+Rowkey;var messageSent='dvMessageSent'+Rowkey;var args={recipients:recipients,subject:subject,content:content,mode:0,firstName:null,lastName:null};dj.module.communityUser.ajaxPost(siteroot+"/member/sendmessage.sync",args,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsg'+Rowkey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}
else if(transport.xhr.status==300){dj.module.communityUser.handleError300(siteroot+"/member/sendmessage.sync",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsg'+Rowkey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}});},fnCloseConnect:function(Rowkey){dojo.byId('dvConnect'+Rowkey).style.display='none';},fnSendInvite:function(siteroot,rowKey){var name=dj.community.communityintegration.trim(dojo.byId('hdnMemberUri'+rowKey).value);var message=dj.community.communityintegration.trim(dojo.byId('txtMessage'+rowKey).value);message=dj.community.communityintegration.fnReplaceHTMLTags(message);if(message.length<=0||message=='Type your personal message.'){dojo.byId('errorMsgInvite'+rowKey).style.display="block";dojo.byId('errorMsgInvite'+rowKey).innerHTML="Please enter valid message.";return false;}
var targetElement='dvConnect'+rowKey;var messageSent='dvConnectionSent'+rowKey;var args={name:name,message:message,mode:0,firstName:null,lastName:null};dj.module.communityUser.ajaxPost(siteroot+"/member/InviteFriend.sync",args,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsgInvite'+rowKey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}else
if(transport.xhr.status==300){dj.module.communityUser.handleError300(siteroot+"/member/InviteFriend.sync",args,json.FirstName,json.LastName,function(transport,json){if(transport.xhr.status==200){dojo.byId('errorMsgInvite'+rowKey).innerHTML=json.errorMsg;dojo.byId(targetElement).style.display='none';dojo.byId(messageSent).style.display='block';}});}else if(transport.xhr.status==301){dj.module.communityUser.handleError301(json.FirstName,json.LastName);}});},GotFocus:function Connect_GotFocus(){if(dojo.byId('txtMessage${Rowkey}').value=="Type your personal message"){dojo.byId('txtMessage${Rowkey}').value="";}},LostFocus:function Connect_LostFocus(){if(dojo.byId('txtMessage${Rowkey}').value===""){dojo.byId('txtMessage${Rowkey}').value="Type your personal message";}},fillSubCategoryJS:function(){var parentCategoryId=dojo.byId('Category').value;if(parentCategoryId=='-1'){dojo.byId('SubCategoryId').options.length=0;dojo.byId('SubCategoryId').options[0]=new Option('Sub-category','-1');return;}
var values=dojo.byId('hdnValues').value;var categories=values.split("~");dojo.byId('SubCategoryId').options.length=0;var SelectedSubCategoryId=dojo.byId('hdnSubCategoryId').value;for(i=0;i<categories.length;i++){var subCatInfo=categories[i];var subCategories=subCatInfo.split("^");var categoryId=subCategories[0];if(categoryId==parentCategoryId){for(j=1;j<subCategories.length;j++){var subCatValues=subCategories[j].split("=");var subCategoryText=subCatValues[0];var subCategoryId=subCatValues[1];dojo.byId('SubCategoryId').options[j-1]=new Option(subCategoryText,subCategoryId);if(SelectedSubCategoryId==subCategoryId){dojo.byId('SubCategoryId').options[j-1].selected=true;}}}}
if(SelectedSubCategoryId==-1){dojo.byId('SubCategoryId').options[j-1]=new Option('Sub-category','-1');dojo.byId('SubCategoryId').options[j-1].selected=true;}},setCategorySubcategory:function(categoryId,subCategoryId){var categoryDropDown=dojo.byId('Category');for(i=0;i<categoryDropDown.options.length;i++){if(categoryDropDown.options[i].value==categoryId){categoryDropDown.options[i].selected=true;}}
if(subCategoryId===null){subCategoryId=-1;}
dojo.byId('hdnSubCategoryId').value=subCategoryId;dj.community.communityintegration.fillSubCategoryJS();},SortArticleComments:function(SBNumber,siteRoot,index,sortId){dojo.byId('sortId').value=sortId;dojo.xhrPost({url:siteRoot+"/public/ArticleComments.html",postData:dojo.objectToQuery({SBNumber:SBNumber,index:index,sortIndex:sortId}),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId('Commentsblock'),"only");},error:function(exception,ioargs){console.error('Exception occured while SortArticleComments : '+exception);}});},fnReplaceHTMLTags:function(strValue){strValue=strValue.replace(/</g,'&lt;');strValue=strValue.replace(/>/g,'&gt;');return strValue;},trim:function trim(str){return str.replace(/^\s+|\s+$/,'');},ToggleLeaderboard:function(){dojo.query('#leaderboard .tabBar .tab').forEach(function(e){dojo.toggleClass(e,'selectedTab');});dojo.query('#leaderboard .tabBar span.unLinked').forEach(function(e){dj.util.Element.toggleHiddenClass(e);});dojo.query('#leaderboard .tabBar a').forEach(function(e){dj.util.Element.toggleHiddenClass(e);});dojo.query('#leaderboard ul.listItems').forEach(function(e){dj.util.Element.toggleHiddenClass(e);});}};function toggleContent(id){dojo.deprecated("toggleContent","use dj.community.communityintegration.toggleContent instead","1.0.0");dj.community.communityintegration.toggleContent(id);}
function CommunityIntegration(siteroot,fullsiteroot){dojo.deprecated("CommunityIntegration","use dj.community.communityintegration.CommunityIntegration instead","1.0.0");dj.community.communityintegration.CommunityIntegration(siteroot,fullsiteroot);}
function postQuestion(siteroot,fullsiteroot){dojo.deprecated("postQuestion","use dj.community.communityintegration.postQuestion instead","1.0.0");dj.community.communityintegration.postQuestion(siteroot,fullsiteroot);}
function answerQuestion(siteroot,fullsiteroot){dojo.deprecated("answerQuestion","use dj.community.communityintegration.answerQuestion instead","1.0.0");dj.community.communityintegration.answerQuestion(siteroot,fullsiteroot);}
function fnOpenMessageBox(targetElement,URI,rowKey){dojo.deprecated("fnOpenMessageBox","use dj.community.communityintegration.fnOpenMessageBox instead","1.0.0");dj.community.communityintegration.fnOpenMessageBox(targetElement,URI,rowKey);}
function SetMostFocus(){dojo.deprecated("SetMostFocus","use dj.community.communityintegration.SetMostFocus instead","1.0.0");dj.community.communityintegration.SetMostFocus();}
function ReportTopic1(ajaxFunction){dojo.deprecated("ReportTopic1","use dj.community.communityintegration.ReportTopic1 instead","1.0.0");dj.community.communityintegration.ReportTopic1(ajaxFunction);}
function fnCloseMessage(Rowkey){dojo.deprecated("fnCloseMessage","use dj.community.communityintegration.fnCloseMessage instead","1.0.0");dj.community.communityintegration.fnCloseMessage(Rowkey);}
function fnCloseMessageSent(Rowkey){dojo.deprecated("fnCloseMessageSent","use dj.community.communityintegration.fnCloseMessageSent instead","1.0.0");dj.community.communityintegration.fnCloseMessageSent(Rowkey);}
function fnCloseConnectionSent(Rowkey){dojo.deprecated("fnCloseConnectionSent","use dj.community.communityintegration.fnCloseConnectionSent instead","1.0.0");dj.community.communityintegration.fnCloseConnectionSent(Rowkey);}
function ReportComment(siteroot,CommentId){dojo.deprecated("ReportComment","use dj.community.communityintegration.ReportComment instead","1.0.0");dj.community.communityintegration.ReportComment(siteroot,CommentId);}
function fnSendMessage(siteroot,Rowkey){dojo.deprecated("fnSendMessage","use dj.community.communityintegration.fnSendMessage instead","1.0.0");dj.community.communityintegration.fnSendMessage(siteroot,Rowkey);}
function fnCloseConnect(Rowkey){dojo.deprecated("fnCloseConnect","use dj.community.communityintegration.fnCloseConnect instead","1.0.0");dj.community.communityintegration.fnCloseConnect(Rowkey);}
function fnSendInvite(siteroot,rowKey){dojo.deprecated("fnSendInvite","use dj.community.communityintegration.fnSendInvite instead","1.0.0");dj.community.communityintegration.fnSendInvite(siteroot,rowKey);}
function GotFocus(){dojo.deprecated("GotFocus","use dj.community.communityintegration.GotFocus instead","1.0.0");dj.community.communityintegration.GotFocus();}
function LostFocus(){dojo.deprecated("LostFocus","use dj.community.communityintegration.LostFocus instead","1.0.0");dj.community.communityintegration.LostFocus();}
function fillSubCategoryJS(){dojo.deprecated("fillSubCategoryJS","use dj.community.communityintegration.fillSubCategoryJS instead","1.0.0");dj.community.communityintegration.fillSubCategoryJS();}
function setCategorySubcategory(categoryId,subCategoryId){dojo.deprecated("setCategorySubcategory","use dj.community.communityintegration.setCategorySubcategory instead","1.0.0");dj.community.communityintegration.setCategorySubcategory(categoryId,subCategoryId);}
function SortArticleComments(SBNumber,siteRoot,index,sortId){dojo.deprecated("SortArticleComments","use dj.community.communityintegration.SortArticleComments instead","1.0.0");dj.community.communityintegration.SortArticleComments(SBNumber,siteRoot,index,sortId);}
function fnReplaceHTMLTags(strValue){dojo.deprecated("fnReplaceHTMLTags","use dj.community.communityintegration.fnReplaceHTMLTags instead","1.0.0");return dj.community.communityintegration.fnReplaceHTMLTags(strValue);}
function trim(str){dojo.deprecated("trim","use dj.community.communityintegration.trim instead","1.0.0");return dj.community.communityintegration.trim(str);}
dojo.addOnLoad(function(){if(dojo.byId('hdnValues')){dj.community.communityintegration.fillSubCategoryJS();}});dojo.provide("dj.community.Comments");dojo.require("dj.util.Element");dojo.require("dj.community.feedback");dojo.require("dj.module.facebook.api");dojo.require("dj.util.flash.template");dojo.require("dj.widget.loader.LoginLoader");dojo.require("dj.widget.loader.RegistrationLoader");dj.community.Comments=function(elt,subject,ajaxRoot,contentRoot,replyContainer,options){options=options||{post2facebook:false,locale:""};this.ShowCommentsFancily=dojo.hitch(this,dj.community.Comments.prototype.__ShowCommentsFancily);this.HelpfulComment=dojo.hitch(this,dj.community.Comments.prototype.__HelpfulComment);this._commentsList=document.createElement("div");this._locale=options.locale;this._post2facebook=options.post2facebook;this._state={};this._ajaxRoot=ajaxRoot;this._contentRoot=contentRoot;this._subject=subject;this._reply2Id=0;this._replyLevel=0;this._replyContainer=replyContainer;this._targetContainer=options.targetContainer;this._fnOnNewCommentBox=options.callbackOnNewCommentBox;this._fnOnPostComment=options.callbackOnPostComment;this._fnCommentPageChange=options.callbackOnCommentPageChange;this._ignoreProfileWizard=options.ignoreProfileWizard;};dj.community.Comments.__OnContentLoad=function(){try{dj.util.flash.template.scan();}catch(ex1){console.log("dj.util.flash.template.scan(): "+ex1);}
try{dj.widget.loader.LoginLoader({version:10.12}).init();dj.widget.loader.RegistrationLoader({version:10.12}).init();}catch(ex2){console.log("dj.widget.loader.LoginLoader: "+ex2);}};dj.community.Comments.prototype.CloseArticleCommenting=function(responcecontainer){var args=dojo.mixin({},this._subject);dojo.xhrPost({url:"/community/mdcrpc/comments/CloseArticleForCommenting.sync",postData:dojo.objectToQuery(args),handle:function(response,ioargs){responcecontainer.innerHTML=response;}});};dj.community.Comments.prototype.OpenArticleCommenting=function(responcecontainer){var args=dojo.mixin({},this._subject);dojo.xhrPost({url:"/community/mdcrpc/comments/OpenArticleForCommenting.sync",postData:dojo.objectToQuery(args),handle:function(response,ioargs){responcecontainer.innerHTML=response;}});};dj.community.Comments.prototype.InlineModulePreview=function(moduleReference,target){dojo.xhrPost({url:"/community/mdcrpc/comments/InlineModulePreview.sync",postData:dojo.objectToQuery({modulereference:moduleReference}),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),target,"only");dj.util.flash.template.scan();}});};dj.community.Comments.prototype.SetInlineModuleRef=function(moduleReference){var args=dojo.mixin({modulereference:moduleReference},this._subject);dojo.xhrPost({url:"/community/mdcrpc/comments/SetInlineModuleRef.sync",postData:dojo.objectToQuery(args),handle:function(response,ioargs){if(response){alert(response);}
else{alert("Inline Module Reference is set. Please refresh the page to verify.");}}});};dj.community.Comments.prototype.SetBottomModuleRef=function(moduleReference){dojo.xhrPost({url:"/community/mdcrpc/comments/SetBottomModuleRef.sync",postData:dojo.objectToQuery({modulereference:moduleReference,locale:this._locale}),handle:function(response,ioargs){if(response){alert(response);}
else{alert("Bottom Module Reference is set. Please refresh the page to verify.");}}});};dj.community.Comments.SetCommentFocus=function(){if(dojo.byId('commentBody')){dojo.byId('commentBody').focus();}else if(dojo.byId('topicreplyarea')){window.scrollTo(0,dojo.byId('topicreplyarea').offsetTop);}};dj.community.Comments.ShowInlineMessage=function(eltId,msg){var messageContainer=dojo.byId(eltId);if(messageContainer===null||typeof messageContainer=="undefined"){return;}
messageContainer.innerHTML=msg;if(msg!==""){messageContainer.style.visibility='visible';}else{messageContainer.style.visibility='hidden';}};dj.community.Comments.__ReplaceHtmlTags=function(strValue){strValue=strValue.replace(/</g,'&lt;');strValue=strValue.replace(/>/g,'&gt;');return strValue;};dj.community.Comments.prototype.Post=function Topic_Post(comment,trackReplies,options){options=options||{};var post2facebook=!options.post2facebook?false:options.post2facebook.checked;if(ismember=="False"||isAccountValid=="False"){dojo.byId('ProfileWizard').style.display="block";dojo.byId('hdnCommentId').value=commentEntryId;dojo.byId('hdnCalledMethod').value="ReplyComment";window.scroll(0,0);return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost","");if(comment.length===0){dj.community.Comments.ShowInlineMessage("errorOnPost",dj.community.localPrompt.emptyComment);return false;}
if(comment.length>4000){dj.community.Comments.ShowInlineMessage("errorOnPost",dj.community.localPrompt.limitYourPost+" ["+comment.length+"]");return false;}
comment=dj.community.Comments.__ReplaceHtmlTags(comment);comment=comment.replace(/\n/g,"<br />");if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
var args=dojo.mixin({},{content:comment,reply2id:this._reply2Id,trackReplies:trackReplies},this._subject);var that=this;if(this._reply2Id>1){dojo.xhrPost({url:this._ajaxRoot+"/group/postcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),that._commentsList,"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));that.ShowCommentsFancily(ioargs,json);if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}}});}
else{dojo.xhrPost({url:this._ajaxRoot+"/group/postcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId("topiccomments"),"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dojo.byId('commentBody').value=comment;dj.community.Comments.ShowInlineMessage("errorOnPost",json.errorMsg);return;}
if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}}});}
if(options.post2facebook){options.post2facebook.checked=this._post2facebook;}};dj.community.Comments.prototype.PostArticleComment=function Topic_PostArticleComment(comment,joinCommunity,trackReplies,options){options=options||{};var post2facebook=!options.post2facebook?false:options.post2facebook.checked;var errMsgElm=options.errormsgelm?options.errormsgelm:"errorOnPost";var commentBoxId=options.commentboxid;dj.community.Comments.ShowInlineMessage(errMsgElm,"");if(comment.length===0){dj.community.Comments.ShowInlineMessage(errMsgElm,dj.community.localPrompt.emptyComment);return false;}
if(comment.length>4000){dj.community.Comments.ShowInlineMessage(errMsgElm,dj.community.localPrompt.limitYourPost+" ["+comment.length+"]");return false;}
var text=dj.community.Comments.__ReplaceHtmlTags(comment).replace(/\n/g,"<br />");var args=dojo.mixin({},{content:text,reply2id:this._reply2Id,joinCommunity:joinCommunity,trackReplies:trackReplies,locale:this._locale},this._subject);var that=this;if(this._reply2Id>1){dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/postarticlecomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),that._commentsList,"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage(errMsgElm,json.errorMsg);if(dojo.byId(commentBoxId)){dojo.byId(commentBoxId).value=comment;}}
if(!json.userInfo.isSuspended){that.ShowCommentsFancily(ioargs,json);}
if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}
if(that._fnOnPostComment!==undefined){that._fnOnPostComment(json.success,json.userInfo,json.userInfo.isSuspended);}}});}
else{if(this._targetContainer){dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/postarticlecomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),that._targetContainer,"only");},handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage(errMsgElm,json.errorMsg);if(dojo.byId(commentBoxId)){dojo.byId(commentBoxId).value=comment;}}
dj.community.Comments.__OnContentLoad();if(dojo.byId('newcommentarea0')){window.scrollTo(0,dojo.byId('newcommentarea0').offsetTop-200);}
if(post2facebook){that.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}
if(that._fnOnNewCommentBox!==undefined){that._fnOnNewCommentBox();}
if(that._fnOnPostComment!==undefined){that._fnOnPostComment(json.success,json.userInfo,false,json.commentsTotalCount);}
setTimeout(function(){dj.community.feedback.toggleComments('fade_slider',that._ajaxRoot);},0);}});}
else{dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/postarticlecomment.sync",postData:dojo.objectToQuery(args),handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage(errMsgElm,json.errorMsg);if(dojo.byId(commentBoxId)){dojo.byId(commentBoxId).value=comment;}}
if(post2facebook){this.__PostArticleCommentFb(json.commentEntryId,comment,json.commentHref);}
if(this._fnOnPostComment!==undefined){this._fnOnPostComment(json.success,json.userInfo,false,json.commentsTotalCount);}})});}}
if(options.post2facebook){options.post2facebook.checked=this._post2facebook;}
return true;};dj.community.Comments.prototype.__PostArticleCommentFb=function(commentEntryId,comment,href){try{dj.module.facebook.api.postArticleComment({comment:comment,commentPermalink:href,callbackFn:dj.community.Comments.TrackFb,callbackParams:{commentEntryId:commentEntryId,ajaxRoot:this._ajaxRoot}});}catch(e){console.log("dj.module.facebook.api.postArticleComment(): "+ex);}};dj.community.Comments.TrackFb=function(params,fbUid,fbPostId){var args={commentEntryId:params.commentEntryId,fbUid:fbUid,fbPostId:fbPostId};dojo.xhrGet({url:params.ajaxRoot+"/mdcrpc/comments/TrackFb.sync",content:args});};dj.community.Comments.prototype.TrackReplies=function Topic_TrackReplies(commentEntryId){var args={commentEntryId:commentEntryId};var elt=dojo.byId('track'+commentEntryId);dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/trackreplies.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),elt,"only");}});};dj.community.Comments.prototype.TrackRepliesStop=function Topic_TrackRepliesStop(commentEntryId){var args={commentEntryId:commentEntryId};var elt=dojo.byId('track'+commentEntryId);dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/trackrepliesstop.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),elt,"only");}});};dj.community.Comments.prototype.__ShowCommentsFancily=function Comments_ShowCommentsFancily(transport,json){if(!json.success){dj.community.Comments.ShowInlineMessage("errorOnPost",json.errorMsg);}else{dojo.byId('newcommentarea'+this._reply2Id).innerHTML+=this._commentsList.innerHTML.replace('wrote:','replied:');dj.util.Element.show(dojo.byId('newcommentarea'+this._reply2Id).parentNode);if(this._replyContainer!==null){dj.util.Element.hide(this._replyContainer);}
this._replyContainer=dojo.byId('topicreplyarea');this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
dj.util.Element.show(this._replyContainer);if(this._replyLevel>0){if(dojo.byId('track'+json.commentEntryId)){dj.util.Element.hide('track'+json.commentEntryId);}}
dojo.byId('newcommenttitle').innerHTML="Add a Comment";this._reply2Id=0;this._replyLevel=0;}};dj.community.Comments.prototype.OpenReplyBox=function Topic_OpenReplyBox(targetElement,commentEntryId,reply2Name){if(isLoggedIn=="False"){RedirectToLogin();}
else if(ismember=="False"||isAccountValid=="False"){dojo.byId('ProfileWizard').style.display="block";dojo.byId('hdnCommentId').value=commentEntryId;dojo.byId('hdnCalledMethod').value="ReplyComment";window.scroll(0,0);return false;}
else{if(dojo.byId('isGroupMember').value!='Active'){dojo.byId('joinGroup'+commentEntryId).style.display='block';return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost","");this._reply2Id=commentEntryId;dj.community.Comments.prototype.ReplyBox(targetElement,commentEntryId,reply2Name);}};dj.community.Comments.prototype.ReplyBox=function Topic_ReplyBox(targetElement,commentEntryId,reply2Name,replyLevel){if(!this._ignoreProfileWizard&&(ismember=="False"||isAccountValid=="False")){dojo.byId('ProfileWizard').style.display="block";dojo.byId('hdnCommentId').value=commentEntryId;dojo.byId('hdnCalledMethod').value="ReplyComment";window.scroll(0,0);return false;}
this.CancelEditComment();dj.community.Comments.ShowInlineMessage("errorOnPost","");this._reply2Id=commentEntryId;this._replyLevel=replyLevel;this._replyContainer=dojo.byId(targetElement);this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
dj.util.Element.show(this._replyContainer);try{if(replyLevel>0){dj.util.Element.hide(dojo.query('#trackreply','newcomment')[0]);}else{dj.util.Element.show(dojo.query('#trackreply','newcomment')[0]);}}catch(e){}
if(reply2Name){dj.util.Element.hide(dojo.query('._add_a_comment','newcommenttitle')[0]);dj.util.Element.show(dojo.query('._reply_a_comment','newcommenttitle')[0]);dojo.query('._reply_a_comment ._commenter','newcommenttitle')[0].innerHTML=reply2Name;}else{dj.util.Element.show(dojo.query('._add_a_comment','newcommenttitle')[0]);dj.util.Element.hide(dojo.query('._reply_a_comment','newcommenttitle')[0]);}
if(dojo.byId('commentBody')){dojo.byId('commentBody').focus();}
else{var elementPos=dojo.position(dojo.byId('newcomment'),true);if(elementPos){window.scrollTo(0,elementPos.y);}}};dj.community.Comments.prototype.EditComment=function Topic_EditComment(commentEntryId){this.CancelEditComment();var args={commentEntryId:commentEntryId,locale:this._locale};dojo.byId('newcomment').style.display='none';var commentEntryElt=dojo.byId('commententry'+commentEntryId);var bodyElt;if(commentEntryElt){bodyElt=commentEntryElt;}
if(bodyElt){dojo.byId('editcomment'+commentEntryId).style.display='none';this._bubbleContentHeight=bodyElt.offsetHeight;dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/editcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),bodyElt,"only");}});}};dj.community.Comments.prototype.ReportComment=function(siteroot,commentId){dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/report.sync",postData:dojo.objectToQuery({commentId:commentId,locale:this._locale}),load:function(data,ioargs){dojo.byId("reportcomment"+commentId).innerHTML=data;}});};dj.community.Comments.prototype.RemoveCommentByGroupOwner=function(commentId,groupName){if(!confirm('Are you sure you wish to remove the comment?')){return;}
dojo.xhrPost({url:this._ajaxRoot+"/group/removecommentbygroupowner.sync",postData:dojo.objectToQuery({commentId:commentId,groupName:groupName}),handle:function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(json.totalcnt<=0){return;}
dojo.fadeOut({node:'comment'+commentId,duration:500,onEnd:function(){dj.util.Element.hide('comment'+commentId);}}).play();}});};dj.community.Comments.prototype.PostEditComment=function Topic_PostEditComment(comment,commentEntryId){comment=dj.community.Comments.__ReplaceHtmlTags(comment);comment=comment.replace(/\n/g,"<br />");if(comment===''){dj.community.Comments.ShowInlineMessage("errorOnEditPost",dj.community.localPrompt.emptyComment);return false;}else if(comment.length>4000){dj.community.Comments.ShowInlineMessage("errorOnEditPost",dj.community.localPrompt.limitYourPost+" ["+comment.length+"]");return false;}
var args=dojo.mixin({},{content:comment},this._subject,{commentEntryId:commentEntryId,locale:this._locale});var tempDiv=document.createElement("div");dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/posteditcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){tempDiv.innerHTML=data.replace(/^\s*/,"");},handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));if(!json.success){dj.community.Comments.ShowInlineMessage("errorOnEditPost",json.errorMsg);}else{dojo.byId('commententry'+commentEntryId).innerHTML=tempDiv.innerHTML;dojo.byId('newcomment').style.display='';if(this._replyContainer!==null){dj.util.Element.hide(this._replyContainer);}
this._replyContainer=dojo.byId('topicreplyarea');this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
dj.util.Element.show(this._replyContainer);dojo.byId('newcommenttitle').innerHTML="Add a Comment";this._reply2Id=0;}})});};dj.community.Comments.SortComments=function(groupName,topicName,index,sortId){dojo.byId('sortId').value=sortId;dojo.xhrPost({url:vw_siteroot+"/group/sortComment.sync",postData:dojo.objectToQuery({groupname:groupName,topicname:topicName,index:index,sortIndex:sortId}),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId("topiccomments"),"only");}});};dj.community.Comments.prototype.CancelEditComment=function Topic_CancelEditComment(){var prevEditcomment=dojo.byId('commentarea');if(!prevEditcomment){return;}
var commentEntryId=document.getElementById('EditcommentEntryId').value;dojo.byId('newcomment').style.display='';if(this._replyContainer!==null&&this._replyContainer!==undefined){this._replyContainer.style.display='none';}
this._replyContainer=dojo.byId('topicreplyarea');this._replyContainer.appendChild(dojo.byId('newcomment'));if(dojo.byId('commentBody')){dojo.byId('commentBody').value='';}
this._replyContainer.style.display='block';dojo.byId('newcommenttitle').innerHTML="Add a Comment";this._reply2Id=0;dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/canceleditcomment.sync",postData:dojo.objectToQuery({commentEntryId:commentEntryId,locale:this._locale}),load:function(data,ioargs){dojo.byId('commententry'+commentEntryId).innerHTML=data.replace(/^\s*/,"");}});};dj.community.Comments.prototype.__HelpfulComment=function(commentEntryId){dj.community.Comments.HelpfulComment(this._ajaxRoot,commentEntryId,this._locale);};dj.community.Comments.HelpfulComment=function(ajaxroot,commentEntryId,locale){var args={locale:locale,commentEntryId:commentEntryId};var elt=dojo.byId('numhelpful'+commentEntryId);dojo.xhrPost({url:ajaxroot+"/components/comments/helpfulcomment.sync",postData:dojo.objectToQuery(args),load:function(data,ioargs){dojo.place(data.replace(/^\s*/,""),elt,"only");}});};dj.community.Comments.prototype.GetArticlecommentsInitialPage=function Topic_GetArticleInitialPage(){this._commentId="";var results=unescape(window.location.href).match(/commentId=(\d+)/);if(results&&(results.length==2)){this._commentId=results[1];}
var args=dojo.mixin({},this._subject,{commentEntryId:this._commentId,locale:this._locale});dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/GetArticlecommentsInitialPage.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),this._targetContainer,"only");}),handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));dj.community.Comments.__OnContentLoad();if(this._fnOnNewCommentBox!==undefined){this._fnOnNewCommentBox(json.commentsTotalCount);}
setTimeout(dojo.hitch(this,function(){dj.community.feedback.toggleComments('fade_slider',this._ajaxRoot);}),0);if(this._commentId!==""){if(dojo.byId('commententry'+this._commentId)){var elementPos=dojo.position(dojo.byId('commententry'+this._commentId),true);if(elementPos){window.scrollTo(0,elementPos.y);}}
this._commentId="";}})});};dj.community.Comments.prototype.GetArticlecommentsPage=function Topic_GetArticlecommentsPage(indx,sortIndex){if(sortIndex===undefined){sortIndex=1;if(dojo.byId('sortId')){sortIndex=dojo.byId('sortId').value;}
if(sortIndex===null||sortIndex===''){sortIndex=1;}}
var args=dojo.mixin({pageNumber:indx,sortIndex:sortIndex,locale:this._locale},this._subject);dojo.xhrPost({url:this._ajaxRoot+"/mdcrpc/comments/GetArticleComments.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),this._targetContainer,"only");}),handle:dojo.hitch(this,function(response,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));window.scrollTo(0,dojo.byId('top-of-comments').offsetTop);dj.community.Comments.__OnContentLoad();if(this._fnOnNewCommentBox!==undefined){this._fnOnNewCommentBox(json.commentsTotalCount);}
try{setTimeout(dojo.hitch(this,function(){dj.community.feedback.toggleComments('fade_slider',this._ajaxRoot);}),0);}catch(e){}
if(this._fnCommentPageChange!==undefined){this._fnCommentPageChange();}})});};dj.community.Comments.prototype.ScrollToElementId=function Topic_ScrollToElementId(elementId){var element=dojo.byId(elementId);if(element===null){return;}
window.scrollTo(0,element.offsetTop);};dj.community.Comments.prototype.GoToMostRecentComment=function Topic_GoToMostRecentComment(sbnumber,indx){var siteroot=this._ajaxRoot;var sortIndex=dojo.byId('sortId').value;if(sortIndex===null||sortIndex===''){sortIndex=1;}
var iIndex=0;if(sortIndex==1){iIndex=indx;}
else if(sortIndex==2)
{iIndex=1;}
dojo.xhrPost({url:siteroot+"/public/ArticleComments.html",postData:dojo.objectToQuery({SBNumber:sbnumber,index:iIndex,sortIndex:sortIndex}),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),this._targetContainer,"only");}),handle:function(response,ioargs){if(sortIndex===1||sortIndex==='1'){var anchor_node=dojo.byId('newcommentarea0');if(anchor_node){window.scrollTo(0,anchor_node.offsetTop-200);}}}});};dojo.provide("dj.community.ArticleComments");dojo.require("dj.util.Element");dojo.require("dj.community.Subject");dojo.require("dj.community.Comments");dojo.getObject("dj.community",true);dj.community.theTopic=undefined;dj.community.localPrompt={emptyComment:"Please enter your comment and then click post.",limitYourPost:"Please limit your post to 4000 characters.",whatIsIt:"What's this?",closeDialog:"Close"};dj.community.ArticleComments=function(sbNumber,articleName,fullsiteroot,contentroot,onGetCommentsCount,onPostComment,isOpinion,onCommentPageChange,options){options=options||{istopic:false,isexpertblog:false,tags:'',href:'',forcemembership:false,locale:''};this._fullSiteRoot=fullsiteroot;this._contenRoot=contentroot;this._forceMembership=options.forcemembership;this._locale=options.locale;var subjectType="story";if(options.istopic){subjectType="grouptopic";}
else if(isOpinion){subjectType="opinion";}
else if(options.isexpertblog){subjectType="expertblog";}
this._subject=new dj.community.Subject(sbNumber,articleName,options.href,subjectType,options.tags,options.locale);this._onGetCommentsCount=onGetCommentsCount;this._onPostComment=onPostComment;this._onCommentPageChange=onCommentPageChange;this._userInfo=undefined;this._totalCommentsCount=undefined;this.__Init();};dj.community.ArticleComments.prototype.__Init=function(){var updateDiv=document.createElement("div");var args={locale:this._locale};args=dojo.mixin(args,this._subject);dojo.xhrPost({url:this._fullSiteRoot+"/mdcrpc/comments/GetArticleCommentPopupBox.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),updateDiv,"only");}),handle:dojo.hitch(this,function(response,ioargs){var json=null;var fragment=dojo.query('#_json',updateDiv);if(fragment.length==1){json=eval('('+fragment[0].innerHTML+')');}
if(!json){json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));}
this._userInfo=json.userInfo;if(json.localPrompt){dj.community.localPrompt=json.localPrompt;}
document.body.appendChild(updateDiv);if(dojo.byId('cmd0404174609')){dojo.connect(dojo.byId('cmd0404174609'),'onclick',dj.community.HideMembershipDialog);}
if(dojo.byId('cmd0406115509')){dojo.connect(dojo.byId('cmd0406115509'),'onclick',dojo.hitch(this,this.__PostAndConfirmJoin));}
if(dojo.byId('cmd0406115609')){dojo.connect(dojo.byId('cmd0406115609'),'onclick',dj.community.HideMembershipDialog);}
if(dojo.byId('cmd0406115709')){dojo.connect(dojo.byId('cmd0406115709'),'onclick',dj.community.HideMembershipDialog);}
this._totalCommentsCount=json.commentCount;if(this._onGetCommentsCount){this._onGetCommentsCount(json.commentCount);}})});dj.community.theTopic=new dj.community.Comments('synccomments',this._subject,this._fullSiteRoot,this._contenRoot,dojo.byId('topicreplyarea'),{locale:this._locale,ignoreProfileWizard:true,callbackOnNewCommentBox:dojo.hitch(this,this.__BindCommentBoxOnCommentsTab),callbackOnPostComment:dojo.hitch(this,this.__OnPostComment),callbackOnCommentPageChange:this._onCommentPageChange});dj.community.theTopic.HelpfulComment=dojo.hitch(this,dj.community.ArticleComments.prototype.__HelpfulComment);};dj.community.ArticleComments.prototype.GetCommentBox=function(targetContainer,slimversion){if(targetContainer===undefined){targetContainer=this._commentBoxDiv;}
this._commentBoxDiv=targetContainer;var args={slimversion:slimversion?true:false,locale:this._locale};args=dojo.mixin(args,this._subject);dojo.xhrPost({url:this._fullSiteRoot+"/mdcrpc/comments/GetArticleCommentBox.sync",postData:dojo.objectToQuery(args),load:dojo.hitch(this,function(data,ioargs){dojo.place(data.replace(/^\s*/,""),dojo.byId(targetContainer),"only");}),handle:dojo.hitch(this,function(data,ioargs){var json=dojo.fromJson(ioargs.xhr.getResponseHeader("X-JSON"));dj.community.Comments.__OnContentLoad();this.__OnGetCommentBox(ioargs,json);})});};dj.community.ArticleComments.prototype.GetComments=function(targetContainer){dj.community.theTopic=new dj.community.Comments('synccomments',this._subject,this._fullSiteRoot,this._contenRoot,dojo.byId('topicreplyarea'),{locale:this._locale,targetContainer:targetContainer,ignoreProfileWizard:true,callbackOnNewCommentBox:dojo.hitch(this,this.__BindCommentBoxOnCommentsTab),callbackOnPostComment:dojo.hitch(this,this.__OnPostComment),callbackOnCommentPageChange:this._onCommentPageChange});dj.community.theTopic.HelpfulComment=dojo.hitch(this,dj.community.ArticleComments.prototype.__HelpfulComment);dj.community.theTopic.GetArticlecommentsInitialPage();};dj.community.ArticleComments.prototype.__OnGetCommentBox=function(transport,json){if(dojo.byId('commentbox0817091638')&&dojo.byId('slimbox0817091645')){dj.util.Element.hide('commentbox0817091638');}
if(!dojo.byId('cmd0409091704')){return;}
dojo.connect(dojo.byId('cmd0409091704'),'onclick',dojo.hitch(this,function(){if(this._onPostComment){this._onPostComment();}}));dojo.connect(dojo.byId('clearCommentBody0'),'onclick',function(){if(!dojo.byId('commentBody0')){return;}
dojo.byId('commentBody0').value='';dojo.byId('commentBody0').focus();dj.community.Comments.ShowInlineMessage("errorOnPost0","");});dojo.connect(dojo.byId('postComment0'),'onclick',dojo.hitch(this,function(event){if(!dojo.byId('commentBody0')){return;}
dj.community.Comments.ShowInlineMessage("errorOnPost0","");if(dojo.byId('commentBody0').value.length===0){dj.community.Comments.ShowInlineMessage("errorOnPost0",dj.community.localPrompt.emptyComment);return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost0","");this._currentCommentBox=dojo.byId('commentBody0');this._currentTrackReply=dojo.byId('cbxtrackreply0');this._currentPost2Facebook=dojo.byId('cbxfb0');this.__PostArticleComment(event.target);}));};dj.community.ArticleComments.prototype.__BindCommentBoxOnCommentsTab=function(total_comments_count){if(dojo.byId('cmd0406091327')){dojo.attr("cmd0406091327","onclick","");dojo.connect(dojo.byId('cmd0406091327'),'onclick',dojo.hitch(this,function(event){dj.community.Comments.ShowInlineMessage("errorOnPost","");if(dojo.byId('commentBody').value.length===0){dj.community.Comments.ShowInlineMessage("errorOnPost",dj.community.localPrompt.emptyComment);return false;}
dj.community.Comments.ShowInlineMessage("errorOnPost","");this._currentCommentBox=dojo.byId('commentBody');this._currentTrackReply=dojo.byId('cbxtrackreply');this._currentPost2Facebook=dojo.byId('cbxfb');this.__PostArticleComment(event.target);}));}
if(total_comments_count!==undefined){this._totalCommentsCount=total_comments_count;if(this._onGetCommentsCount){this._onGetCommentsCount(this._totalCommentsCount);}}};dj.community.ArticleComments.prototype.__HelpfulComment=function(commentEntryId){if(this._userInfo.isMember){dj.community.theTopic.__HelpfulComment(commentEntryId);}
else{dj.community.ShowMembershipDialog(dojo.byId('numhelpful'+commentEntryId),true,dojo.hitch(this,function(){dj.community.theTopic.__HelpfulComment(commentEntryId);dj.community.HideMembershipDialog();this._userInfo.isMember=true;}));}};dj.community.ArticleComments.prototype.__PostArticleComment=function(clicked){if(this._userInfo.isMember){this.__CommentPost(false);}
else{var forceMembership=(this._userInfo.Status=="subscriber"&&!this._forceMembership);dj.community.ShowMembershipDialog(this._currentCommentBox,forceMembership,dojo.hitch(this,this.__PostAndJoin));}};dj.community.ShowMembershipDialog=function(relativeElement,forceMembership,callback){if(callback&&dojo.byId('cmd0404174509')){dojo.connect(dojo.byId('cmd0404174509'),'onclick',callback);}
if(!forceMembership){dj.util.Element.show("commentpopup");}
else{dj.util.Element.show("commentpopup");}};dj.community.HideMembershipDialog=function(){dj.util.Element.hide("commentpopup");};dj.community.ArticleComments.prototype.__PostAndJoin=function(){this.__CommentPost(true);};dj.community.ArticleComments.prototype.__PostAndConfirmJoin=function(){this.__CommentPost(dojo.byId("chkBecomeMember").checked);};dj.community.ArticleComments.prototype.__CommentPost=function(joinCommunity){dj.util.Element.hide("commentpopup");var errMsgElm=this._currentCommentBox.id=='commentBody0'?'errorOnPost0':null;var txt=(dojo.attr(this._currentCommentBox,'tooltip')==this._currentCommentBox.value?'':this._currentCommentBox.value);var success=dj.community.theTopic.PostArticleComment(txt,joinCommunity,(this._currentTrackReply?this._currentTrackReply.checked:false),{errormsgelm:errMsgElm,commentboxid:this._currentCommentBox.id,post2facebook:this._currentPost2Facebook});if(!success){return;}
if(!this._userInfo.isMember){this._userInfo.isMember=joinCommunity;}
this._currentCommentBox.value='';if(this._currentTrackReply){this._currentTrackReply.checked=false;}
this._currentCommentBox.focus();};dj.community.ArticleComments.prototype.__OnPostComment=function(success,userInfo,reloadComments,commentsTotalCount){if(userInfo!==undefined&&userInfo.isSuspended){this.GetCommentBox();if(reloadComments!==undefined&&reloadComments){dj.community.theTopic.GetArticlecommentsInitialPage();}
return;}
if(!success){return;}
if(commentsTotalCount===undefined){this._totalCommentsCount++;}else{this._totalCommentsCount=commentsTotalCount;}
if(this._onGetCommentsCount){this._onGetCommentsCount(this._totalCommentsCount);}
if(this._currentCommentBox.id=='commentBody0'){if(this._onPostComment){this._onPostComment(dojo.byId('newcommentarea0')?'newcommentarea0':undefined);}}};
dojo.provide("dj.module.video.taboolaVideo");dj.module.video.taboolaVideo={loaderscript:'http://cdn.taboolasyndication.com/libtrc/wsj-wsj/loader.js',count:0,init:function(mode){that=this;console.log("taboolaVideo {init} count: "+that.count);if(!that.ifEmpty(mode['loaderscript']))
{that.loaderscript=mode['loaderscript'];}
try{if(that.count==0){var script=document.createElement("script");script.type="text/javascript";script.src=that.loaderscript;if(mode['async']!=='hide'){script.async=true;}
document.body.appendChild(script);window._taboola=window._taboola||[];var taboolaEle={};if(!that.ifEmpty(mode['pagemod'])){taboolaEle[mode['pagemod']]=mode['pagetype'];}else{taboolaEle['home']=mode['pagetype'];}
if(!that.ifEmpty(mode['trackingcode'])){taboolaEle['tracking']=mode['trackingcode'];}
_taboola.push(taboolaEle);that.loadModule(mode);that.count=1;}else{that.loadModule(mode);}}catch(error){console.log("{lazyLoadTaboola} "+error);}},loadModule:function(modeObj){that=this;window._taboola=window._taboola||[];var taboolaEle={mode:modeObj['mod'],placement:modeObj['placement'],container:modeObj['taboolacontent']};if(!that.ifEmpty(modeObj['linktarget'])){taboolaEle['link_target']=modeObj['linktarget'];}
if(!that.ifEmpty(modeObj['moduletrackingcode'])){taboolaEle['tracking']=modeObj['moduletrackingcode'];}
var resp=_taboola.push(taboolaEle);console.log("{loadModule} "+resp+" : "+taboolaEle);},notifyTaboola:function(idval,trackingcode,visibleval,ovpname){that=this;try{if(!that.ifEmpty(visibleval)){visibleval='false';}
console.log(" {notifyTaboola} "+idval+" : "+trackingcode+" : "+ovpname+" : "+visibleval+" : "+that.count);if(that.count==0){var script=document.createElement("script");script.type="text/javascript";script.src=that.loaderscript;document.body.appendChild(script);that.loadVideo(idval,trackingcode,ovpname,visibleval);that.count=1;}else{that.loadVideo(idval,trackingcode,ovpname,visibleval);}}catch(error){console.log("{notifyTaboola} "+error);}},notifyDynamicLoad:function(idval,urlval,trackingcode,notifyval){that=this;window._taboola=window._taboola||[];if(!that.ifEmpty(notifyval)){notifyval='videoPlay';}
var taboolaEle={notify:notifyval,id:idval,url:urlval};if(!that.ifEmpty(trackingcode)){taboolaEle['tracking']=trackingcode;}
var response=_taboola.push(taboolaEle);console.log(" {notifyDynamicLoad} :"+response+" : "+taboolaEle);},loadLoaderJs:function(pagetype,pageload,trackingcode,visibleval,loaderscript,asynchronous){that=this;if(!that.ifEmpty(loaderscript))
{that.loaderscript=loaderscript;}
var script=document.createElement("script");script.type="text/javascript";script.src=that.loaderscript;if(asynchronous!=='hide'){script.async=true;}
document.body.appendChild(script);that.count=1;window._taboola=window._taboola||[];var taboolaEle={};if(!that.ifEmpty(pagetype)&&!ifEmpty(pageload)){taboolaEle[pagetype]=pageload;}else{taboolaEle['video']='unknown';}
if(!that.ifEmpty(visibleval)){taboolaEle[visible]=visibleval;}else{taboolaEle['visible']='false';}
if(!that.ifEmpty(trackingcode)){taboolaEle[tracking]=trackingcode;}
var response=_taboola.push(taboolaEle);console.log(" {loadLoaderJs} :"+response+" : "+taboolaEle);},loadVideo:function(idval,trackingcode,ovpname,visibleval){that=this;window._taboola=window._taboola||[];var taboolaEle={video:idval};if(!that.ifEmpty(ovpname)){taboolaEle['video_source']=ovpname;}
if(!that.ifEmpty(visibleval)){taboolaEle['visible']=visibleval;}
if(!that.ifEmpty(trackingcode)){taboolaEle['tracking']=trackingcode;}
var response=_taboola.push(taboolaEle);console.log(" loadVideo:: response: "+response+" : "+idval+" : "+taboolaEle+" : "+ovpname+" : "+visibleval);},ifEmpty:function(value){if(value!==null&&value!==undefined&&value!==""){return false;}else{return true;}}};dojo.provide("dj.widget.video.model.PlayerEvents");dj.widget.video.model.PlayerEvents={playVideo:"onPlayVideo",pauseVideo:"onPauseVideo",unpauseVideo:"onUnpauseVideo",getSeek:"onGetSeek",stopVideo:"onStopVideo",createAdvertisement:"onCreateAdvertisement",openMicroPopUpPlayer:"onOpenMicroPopUpPlayer",openPopUpPlayer:"onOpenPopUpPlayer",continueLoadVideo:"onContinueLoadVideo",playNextVideo:"onPlayNextVideo"};dojo.provide("dj.widget.video.model.PlayerTypes");(dj.widget.video.model.PlayerTypes={MicroPlayer:{width:272,height:153,swfFile:"VideoMicroPlayer.swf"},MicroPlayerHP:{width:264,height:149,swfFile:"VideoMicroPlayer.swf"},MicroPlayerE:{width:360,height:203,swfFile:"VideoMicroPlayer.swf"},MicroPlayerF:{width:512,height:288,swfFile:"VideoMicroPlayer.swf"},MainPlayer:{width:512,height:363,swfFile:"VideoPlayerMain.swf"},AdPlayer:{width:336,height:280,swfFile:"adPlayer.swf"}}).prototype={};dojo.provide("dj.widget.video.model.SWFPlayer");(dj.widget.video.model.SWFPlayer=function(){this.objName="undefined";this.id="";this.swfURL="";this.containerID="";this.width=0;this.height=0;this.videoGUID="";this.containermodule="";this.flashVersion="9.0.0";this.allowPlayerPopup=1;this.hideTools=0;this.plyMediaEnabled=1;this.host="video.wsj.com";this.allowScriptAccess="always";this.windowMode="opaque";this.configURL="";this.eventNamespace="";this.playVideo="";this.pauseVideo="";this.unpauseVideo="";this.getSeek="";this.stopVideo="";this.createAdvertisement="";this.openPopUpPlayer="";this.continueLoadVideo="";this.playNextVideo="";this.chainVideos=1;this.enableVideoModuleChaining=0;}).prototype={};dojo.provide("dj.widget.video.view.BasePlayer");dojo.declare("dj.widget.video.view.BasePlayer",null,{constructor:function(userConfiguration){this.controller=null;this.configuration={name:"",preloaderClassName:"videoObjectLoading"};dojo.mixin(this.configuration,userConfiguration);this.playerCreated=false;},init:function(controller){this.controller=controller;},render:function(){console.error("{BasePlayer} 'render' must be overritten");},openPopUpPlayer:function(){console.error("{BasePlayer} 'openPopUpPlayer' must be overritten");}});dojo.provide("dj.util.VideoUtils");dojo.require("swfobject.swfobject_2_2.swfobject");(function(){dj.util.VideoUtils={formatDuration:function(seconds){if(seconds<60){return"0:"+this.formatSeconds(seconds);}
var minutes=0;while(seconds>59){seconds-=60;minutes++;}
return minutes+":"+this.formatSeconds(seconds);},formatSeconds:function(seconds){if(seconds>9){return seconds;}else{return"0"+seconds;}},nullOrUndefined:function(obj){return(obj===null||obj=="undefined");},emptyOrNull:function(string){if(!this.nullOrUndefined(string)){return string.length===0;}
return true;},nonSupportingFlashPlayer:function(divId){dojo.byId(divId).innerHTML="<div class=\"noFlash\"><p>This content can not be displayed because your "
+"browser does not support the Adobe Flash player required to view it.</p></div>";},hasValidFlashVersion:function(){var flashVersion=swfobject.getFlashPlayerVersion();if(flashVersion){return(flashVersion.major>=9);}else{console.error("{VideoUtils} - flashVersion is undefined.")
return false;}},createSWFPlayer:function(player){if(this.hasValidFlashVersion()){var flashvars={objName:player.objName,allowPlayerPopup:player.allowPlayerPopup,hideTools:player.hideTools,plyMediaEnabled:player.plyMediaEnabled,movieWidth:player.width,movieHeight:player.height,host:player.host,PLAYER_ID:player.id,containermodule:player.containermodule,playVideo:this.addEventNamespace(player.eventNamespace,player.playVideo),pauseVideo:this.addEventNamespace(player.eventNamespace,player.pauseVideo),unpauseVideo:this.addEventNamespace(player.eventNamespace,player.unpauseVideo),getSeek:this.addEventNamespace(player.eventNamespace,player.getSeek),stopVideo:this.addEventNamespace(player.eventNamespace,player.stopVideo),createAdvertisement:this.addEventNamespace(player.eventNamespace,player.createAdvertisement),openPopUpPlayer:this.addEventNamespace(player.eventNamespace,player.openPopUpPlayer),openMicroPopUpPlayer:this.addEventNamespace(player.eventNamespace,player.openMicroPopUpPlayer),continueLoadVideo:this.addEventNamespace(player.eventNamespace,player.continueLoadVideo),playNextVideo:this.addEventNamespace(player.eventNamespace,player.playNextVideo),enableVideoModuleChaining:player.enableVideoModuleChaining};if(player.swfURL=="/media/swf/VideoMicroPlayer.swf"){player.chainVideos=1;var chainVideosFlag=dojo.getObject("dj.context.video.chainVideos");if(chainVideosFlag!=undefined&&chainVideosFlag===false){player.chainVideos=0;}
flashvars.chainVideos=player.chainVideos;}
try{swfobject.embedSWF(dj.context.core.cdnPrefix+player.swfURL,player.containerID,player.width,player.height,player.flashVersion,"",flashvars,{allowscriptaccess:player.allowScriptAccess,wmode:"opaque"},{id:player.id});}catch(e){console.error("Error on embending "+e);}}else{this.nonSupportingFlashPlayer(player.containerID);}},addEventNamespace:function(ns,event){if(event===null||event===""){return event;}
else{return ns+"."+event;}},popUpPlayer:function(parameters){var popUpPageURL="/public/page/0_0_WP_3001.html";if(dj.context.videoCenter.popUpPageURL){popUpPageURL=dj.context.videoCenter.popUpPageURL;}
if(dj.context.videoCenter.height){var popUpWindow=window.open(popUpPageURL+'?currentPlayingLocation='+parameters.playLocation+'&currentlyPlayingCollection='+escape(parameters.collection)+'&currentlyPlayingVideoId='+parameters.videoID,'popUpPlayer','height='+dj.context.videoCenter.height+',width=510,left='+((screen.width-Number(parameters.width))/2)+',top='+(screen.height-Number(parameters.height))/2+',resizable=no,scrollbars=no,toolbar=no,status=no');}
else{var popUpWindow=window.open(popUpPageURL+'?currentPlayingLocation='+parameters.playLocation+'&currentlyPlayingCollection='+escape(parameters.collection)+'&currentlyPlayingVideoId='+parameters.videoID,'popUpPlayer','height=690,width=510,left='+((screen.width-Number(parameters.width))/2)+',top='+(screen.height-Number(parameters.height))/2+',resizable=yes,scrollbars=no,toolbar=no,status=no');}},isGUID:function(guid){return guid.match(/{\w{8}-\w{4}-\w{4}-\w{4}-\w{12}}/);},normalizeGuid:function(guid){return this.isGUID(guid)?guid:"{"+guid+"}";},omnitureEncoding:function(col,subcol,type){if(col=='News'){if(subcol=='Politics'&&type=='s'){return'Politics & Campaign';}
if(this.emptyOrNull(subcol)){return'US';}}
if(col=='Management'){if(this.emptyOrNull(subcol)&&type=='c'){return'Business';}
if(this.emptyOrNull(subcol)&&type=='s'){return'Management';}
if(subcol=='Business Insight'){if(type=='c'){return'Business';}
else{return'Business Insight';}}
return'Business';}
if(col=='Lifestyle'&&type=='c'){return'Life & Style';}
if(col=='Special Packages'){if(subcol=='Journal Reports'&&type=='c'){return'Special';}
if(subcol=='Journal Reports'&&type=='s'){return'In-Depth Reports';}
if(subcol=='Journal Women'&&type=='c'){return'Careers';}
if(subcol=='Journal Women'&&type=='s'){return'Journal Women';}}
if(type=='s'&&this.emptyOrNull(subcol)){return col;}
if(type=='s'){return subcol;}
if(type=='c'){return col;}},isVideoSupported:function(){if(typeof this._isHtml5==="undefined"){var detect=(document.createElement('video')||false),mp4Cpt='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',oggCpt='video/ogg; codecs="theora, vorbis"';this._isHtml5=detect&&(typeof detect.canPlayType!=="undefined");this._isH264=this._isHtml5&&(detect.canPlayType(mp4Cpt)==="maybe"||detect.canPlayType(mp4Cpt)==="probably");this._isOgg=this._isHtml5&&(detect.canPlayType(oggCpt)==="maybe"||detect.canPlayType(oggCpt)==="probably");}
return this._isHtml5;},isOggTheoraVideoSupported:function(){return(this.isVideoSupported()&&this._isOgg);},isH264BaselineVideoSupported:function(){return(this.isVideoSupported()&&this._isH264);},callThroughDispatch:function(callback,context){var link=dojo.create('a',{"is":"false"});dojo.place(link,dojo.body());var linkId=dj.util.Element.identify(link);dojo.connect(link,"click",function(event){dojo.stopEvent(event);if(link.getAttribute("is")==="true"){return;}
else{link.setAttribute("is","true");}
callback.call(context);});setTimeout(dojo.hitch(this,function(){this._doEventDispatch(linkId);}),400);},_doEventDispatch:function(elId){var evt,el=dojo.byId(elId);if(document.createEvent){evt=document.createEvent("MouseEvents");if(evt.initMouseEvent){evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);}else{evt=false;}}
(evt)?el.dispatchEvent(evt):(el.click&&el.click());}};}());dojo.provide("dj.util.Video");dojo.require("dj.lang");dojo.require("dj.util.Cookie");dojo.require("dj.util.Observer");dojo.require("dj.util.Omniture");dojo.require("dj.util.Page");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.require("dj.util.Query");dojo.require("dj.util.Element");(function(){var dju=dj.util,djp=dj.util.Page,obs=new dju.Observer(dj.util.Video),players={};dju.Video={unpauseVideo:function(playerId,containermodule){obs.fireByName("unpauseVideo",playerId,containermodule);},pauseVideo:function(playerId,containermodule){obs.fireByName("pauseVideo",playerId,containermodule);},playVideo:function(playerId,containermodule){obs.fireByName("playVideo",playerId,containermodule);},getSeek:function(playerId,containermodule){obs.fireByName("getSeek",playerId,containermodule);},stopVideo:function(playerId,containermodule){obs.fireByName("stopVideo",playerId,containermodule);},collapsePlayer:function(playerId,containermodule){obs.fireByName("collapsePlayer",playerId,containermodule);},expandPlayer:function(playerId,containermodule){obs.fireByName("expandPlayer",playerId,containermodule);},isVideoPlayerCollapsed:function(playerId){var player=this._getOrCreatePlayer(playerId);if(player.isCollapsed){return true;}
var cookie=dju.Cookie.getGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+playerId),isPlayerCollapsed=(cookie==="yes");if(isPlayerCollapsed){this._collapsePlayerCallback(playerId);}
player.isCollapsed=isPlayerCollapsed;return player.isCollapsed;},subscribe:function(videoEventName,callback,context){obs.subscribeByName(videoEventName,callback,context);},_getOrCreatePlayer:function(playerId){if(!players[playerId]){players[playerId]={isCollapsed:false,largestHeight:25,smallestHeight:25};}
return players[playerId];},handlePageRefresh:function(){var dup=dju.Page,onCb=function(playerId){dup.enableRefresh();},offCb=function(playerId){dup.disableRefresh();};this._subOnOff(onCb,offCb);},handleModuleRefresh:function(moduleName,refreshContainerClass){refreshContainerClass=refreshContainerClass==null?"refresh":refreshContainerClass;var onCb=function(playerId,containermodule){var containerClass=null;var currentPlayer=dojo.byId(playerId);if(currentPlayer==null){try{var ieVersion=navigator.appVersion;var indexIE=ieVersion.indexOf("MSIE 7.");if(indexIE!==-1){var alldivs=dojo.query('.'+refreshContainerClass);dojo.some(alldivs,function(item){var playerIdVal=dj.util.Element.getData(item,'widget-playerid');if(playerIdVal!=null&&playerIdVal.indexOf(playerId)!==-1){currentPlayer=item;return false;}});}else{currentPlayer=dojo.query('object param[ value*= "'+playerId+'"]')[0];}}catch(e){}}
if(currentPlayer!=null){while(currentPlayer.parentNode!=null){currentPlayer=currentPlayer.parentNode;if(dojo.hasClass(currentPlayer,refreshContainerClass)){containerClass=currentPlayer;break;}}}
if(containerClass!=null){var widgetPlayerId=null;try{widgetPlayerId=dj.util.Element.getData(containerClass,'widget-playerid');}catch(e){}
if(widgetPlayerId==null||widgetPlayerId===""){djp.enableModuleRefresh(containerClass.id);if(dj.module[containerClass.id+'_updater']){dj.module[containerClass.id+'_updater'].start();}}else if(widgetPlayerId.indexOf('||||')===-1&&widgetPlayerId==="||"+playerId+"||"){dojo.attr(containerClass,'data-widget-playerid',"");djp.enableModuleRefresh(containerClass.id);if(dj.module[containerClass.id+'_updater']){dj.module[containerClass.id+'_updater'].start();}}else if(widgetPlayerId.indexOf('||||')!==-1){widgetPlayerId=widgetPlayerId.replace("||"+playerId+"||","");dojo.attr(containerClass,'data-widget-playerid',widgetPlayerId);}}else{djp.enableModuleRefresh(moduleName);if(dj.module[moduleName+'_updater']){dj.module[moduleName+'_updater'].start();}}},offCb=function(playerId,containermodule){var containerClass=null;var currentPlayer=dojo.byId(playerId);if(currentPlayer==null){try{var ieVersion=navigator.appVersion;var indexIE=ieVersion.indexOf("MSIE 7.");if(indexIE!==-1){var allParams=dojo.query('object param');dojo.some(allParams,function(item){if(item.value!=null&&item.value!=undefined){var val=item.value;if(val.indexOf(playerId)!==-1){currentPlayer=item;return false;}}});}else{currentPlayer=dojo.query('object param[ value*= "'+playerId+'"]')[0];}}catch(exp){}}
if(currentPlayer!=null){while(currentPlayer.parentNode!=null){currentPlayer=currentPlayer.parentNode;if(dojo.hasClass(currentPlayer,refreshContainerClass)){containerClass=currentPlayer;break;}}}
if(containerClass!=null){djp.disableModuleRefresh(containerClass.id);var widgetPlayerId=null;try{widgetPlayerId=dj.util.Element.getData(containerClass,'widget-playerid');}catch(e){}
if(widgetPlayerId==null||widgetPlayerId===""){dojo.attr(containerClass,'data-widget-playerid',"||"+playerId+"||");}else if(widgetPlayerId.indexOf(playerId)===-1){dojo.attr(containerClass,'data-widget-playerid',widgetPlayerId+"||"+playerId+"||");}}else{djp.disableModuleRefresh(moduleName);}};this._subOnOff(onCb,offCb);},handleVideoPlayer:function(){this.subscribe("collapsePlayer",this._collapsePlayerCallback,this);this.subscribe("expandPlayer",this._expandPlayerCallback,this);},_getPlayerAndUpdateHeights:function(playerId){var player=this._getOrCreatePlayer(playerId);player.node=dojo.byId(playerId);player.largestHeight=(player.node.height>player.largestHeight)?player.node.height:player.largestHeight;player.smallestHeight=(player.node.height<player.smallestHeight)?player.node.height:player.smallestHeight;return player;},_collapsePlayerCallback:function(playerId){var player=this._getPlayerAndUpdateHeights(playerId);if(player.isCollapsed){return;}
player.isCollapsed=true;var container=dj.util.Query.up(player.node,"div");if(container!==dojo.doc){dojo.style(container,{width:"",height:""});}
dojo.anim(player.node,{height:{end:player.smallestHeight}});dju.Cookie.setGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+playerId,"yes",(1/24));},_expandPlayerCallback:function(playerId){var player=this._getPlayerAndUpdateHeights(playerId);if(!player.isCollapsed){return;}
player.isCollapsed=false;dojo.anim(player.node,{height:{end:player.largestHeight}});dju.Cookie.deleteGroupCookie("DJCOOKIE","PLAYERCOLLAPSED_"+playerId);},handleNewsHubPageRefresh:function(){var refreshNewsHubPage=function(){location.pathname=location.pathname;};this.subscribe("stopVideo",refreshNewsHubPage,this);},_subOnOff:function(on,off){this.subscribe("unpauseVideo",off,this);this.subscribe("pauseVideo",off,this);this.subscribe("playVideo",off,this);this.subscribe("getSeek",off,this);this.subscribe("stopVideo",on,this);},formatduration:function(d){var minutes=Math.floor(d/60);var seconds=d%60;if(seconds<10){seconds='0'+seconds;}
return''+minutes+':'+seconds;},getVideoDetails:function(args){if(!args.id){return"No Id.";}
var url='/api-video/get_video_info.asp?guid='+args.id;if(args.fields){url+='&fields='+args.fields;}
else{url+='&fields=all';}
dojo.getObject("dj.util.Video.jsonData",true);var params={context:this,handleAs:"json",sync:true,responseType:"application/json",callback:function(json){dju.Video.handleGetVideoDetails(json,args.id);},errorCallback:function(){console.error("Failed while executing util.Video.getVideoDetails");}};dj.util.Video.getVideoData(url,params);return dju.Video.jsonData[args.id];},handleGetVideoDetails:function(json,id){dju.Video.jsonData[id]=json;},getVideoData:function(url,params){params.responseType=(!params.responseType)?"text/xml":params.responseType;var isResponseJson=(params.responseType.indexOf("json")>-1);this._sendXhrRequest(url,params,{requestMethod:"GET",handleAs:(isResponseJson)?"json":"xml",appendCacheBuster:true,requestHeaders:{"Accept":params.responseType},sync:(params.sync?true:false)});},postVideoData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"POST",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":"application/json"},sync:(params.sync?true:false)});},putVideoData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"PUT",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"},sync:(params.sync?true:false)});},deleteDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"POST",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"DELETE","Content-Type":"application/json"},sync:(params.sync?true:false)});},_sendXhrRequest:function(requestUrl,userParams,requestOptions){var params=dj.lang.cloneMixin({callback:function(){}},userParams);var options=dj.lang.cloneMixin({requestHeaders:{"Accept":"application/json"},handleAs:"json",appendCacheBuster:false,sync:false},requestOptions);if(options.appendCacheBuster){requestUrl=this._appendCacheBuster(requestUrl);}
var xhrReq=this._getRequestByMethod(options.requestMethod);var deferred=xhrReq({url:requestUrl,headers:options.requestHeaders,handleAs:options.handleAs,postData:options.content,sync:options.sync,load:function(data,ioargs){if(params.context){params.callback.apply(params.context,[data,ioargs.xhr,params]);}else{params.callback.apply(this,[data,ioargs.xhr,params]);}},error:function(error,ioargs){console.error("HTTP status code: %s, response: %o",ioargs.xhr.status,data);if(typeof params.errorCallback!=="undefined"){params.errorCallback.apply(params.context,[ioargs.xhr.status,ioargs.xhr,params]);}else{params.callback.apply(params.context,[ioargs.xhr.status,ioargs.xhr,params]);}}});return deferred;},_appendCacheBuster:function(requestUrl){var cb=(Math.floor(10000000*Math.random()));requestUrl+=(requestUrl.indexOf('?')>-1)?("&cb="+cb):("?cb="+cb);return requestUrl;},_getRequestByMethod:function(requestMethod){return(requestMethod=="GET")?dojo.xhrGet:dojo.xhrPost;},getUrlParam:function(srcUrl,name){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(srcUrl);if(results===null){return"";}
else{return results[1];}},nonSupportingFlashPlayer:function(divId){dojo.byId(divId).innerHTML="<p>This content can not be displayed because your "
+"browser does not support the Adobe Flash player required to view it.</p>";},omnitureEncoding:function(col,subcol,type){if(col=='News'){if(subcol=='Politics'&&type=='s'){return'Politics & Campaign';}
if((!this.isNotBlankOrNull(subcol))&&type=='c'){return'US';}
if((!this.isNotBlankOrNull(subcol))&&type=='s'){return'US';}}
if(col=='Management'){if((!this.isNotBlankOrNull(subcol))&&type=='c'){return'Business';}
if((!this.isNotBlankOrNull(subcol))&&type=='s'){return'Management';}
if(subcol=='Business Insight'&&type=='c'){return'Business';}
if(subcol=='Business Insight'&&type=='s'){return'Business Insight';}
return'Business';}
if(col=='Lifestyle'){return'Life & Style';}
if(col=='Special Packages'){if(subcol=='Journal Reports'&&type=='c'){return'Special';}
if(subcol=='Journal Reports'&&type=='s'){return'In-Depth Reports';}
if(subcol=='Journal Women'&&type=='c'){return'Careers';}
if(subcol=='Journal Women'&&type=='s'){return'Journal Women';}}
if(type=='s'&&!(this.isNotBlankOrNull(subcol))){return col;}
if(type=='s'){return subcol;}
if(type=='c'){return col;}},isNotBlankOrNull:function(strVar){return(strVar!==''&&strVar!==null&&typeof strVar!='undefined');},setupConfig:function(widget){var config={};config.emailURL='http:\u002F\u002Fwww.emailthis.clickability.com\u002Fet\u002FemailThis?clickMap=create&fb=Y&url=@VIDEO_LINK_URL&title=@VIDEO_TITLE&random=@RANDOM_NUMBER&partnerID=@EMAIL_PARTNER_ID&image=@VIDEO_STILL_URL&expire=&summary=@VIDEO_DESCRIPTION';config.domainName='wsj';config.embedConfigURL="http://wsj.vo.llnwd.net/o28/players/";config.popUpPageUrl='/public/page/0_0_WP_3001.html';if(dj.context.videoCenter.popUpPageURL){config.popUpPageUrl=dj.context.videoCenter.popUpPageURL;}
var siteFrmUrl=this.getUrlParam(window.location.href,'site');var siteFrmContxt='';try{siteFrmContxt=dj.context.videoCenter.host;}
catch(e){console.error("Error while getting site value from context. "+e.message);}
config.site=this.isNotBlankOrNull(siteFrmUrl)?siteFrmUrl:siteFrmContxt;config.msrc=this.getUrlParam(window.location.href,'msrc');config.playFromRegisteredVideos=false;config.pageSize=12;config.browsingGroup="collection";config.playingGroup="collection";config.skipCollection=true;config.prop24='';config.prop25='';config.prop27='';try{if(typeof setEdition==="function"){config.prop24=setEdition(dj.util.Region.getViewByRegion());}}
catch(e){console.error("cookie read error while fetching prop24 : "+e);}
try{config.prop25=dj.util.Cookie.getCookie('TR');}
catch(e){console.error("cookie read error while fetching prop25 : "+e);}
try{config.cookieUserType=dj.util.Cookie.getCookie("user_type");}
catch(e){console.error("cookie read error while fetching cookieUserType : "+e);}
try{dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){if(subLoggedIn){config.prop27='WSJ_sub_yes';}
else{config.prop27='WSJ_mem_yes';}});}
else{if(config.cookieUserType===null||config.cookieUserType!=="subscribed"){config.prop27='WSJ_free';}
else{config.prop27='WSJ_reg_yes';}}});}
catch(e){console.error("cookie read error while fetching prop27");}
return config;}};}());dojo.provide("dj.util.VideoTracking");dojo.require("dj.util.VideoUtils");dojo.require("dj.util.Tracking");dj.util.VideoTracking={init:function(){if(typeof this.omniture==="object"){return;}
this.omniture=dj.util.Tracking.omniture;},fire:function(videoInfoObject){try{this.init();var newData=this._getOmnitureObject(videoInfoObject);var currentData=this._getCurrentOmnitureObject(newData);this._setOmnitureData(newData);this._firePixel();this._setOmnitureData(currentData);}catch(e){console.error("{VideoTracking} ",e);}},_getOmnitureObject:function(data){var appName=data.appName.toUpperCase(),ft=function(arr){return appName+"_"+arr.join("_");};var omObj={pageName:ft(["Video",data.name]),section:"Video",subsection:ft([data.section]),atype:ft(["Video_Video",data.section]),apage:ft(["Video_Video",data.subsection]),aheadline:"video_"+data.name,basesection:ft([data.subsection]),abasedocid:data.id,ctype:data.appType,csource:data.provider+" video",caccess:"free",qsymbol:data.adZone};return omObj;},_getCurrentOmnitureObject:function(omObject){var oldObj={};for(var name in omObject){if(omObject.hasOwnProperty(name)){oldObj[name]=this.omniture.getMetaData(name);}}
return oldObj;},_setOmnitureData:function(omObject){for(var name in omObject){if(omObject.hasOwnProperty(name)){this.omniture.setMetaData(name,omObject[name]);}}},_firePixel:function(){this.omniture.firePixel(true);}};dojo.provide("dj.module.videoModule");dojo.require("dj.lang");dojo.require("dj.util.Video");dojo.require("dj.widget.panels.PanelsFactory");dj.module.videoModule={init:function(config){var djL=dj.lang;this.cfg=djL.deepMixin({videoModuleContainerId:"videoModule",autonomyVideoClassName:"autonomy_video"},config);var oVidMod=dojo.byId(this.cfg.videoModuleContainerId);if(oVidMod===null){console.log("{VideoModule} is undefined.");return;}
if(dojo.hasClass(oVidMod,this.cfg.autonomyVideoClassName)){this._setupAutonomyVideo(oVidMod);}
this._setupVideo(oVidMod);},_setupVideo:function(oVidMod){this.panels=dj.widget.panels.PanelsFactory.create(oVidMod,{core:{},carousel:{}});},_setupAutonomyVideo:function(oVidMod){var djL=dj.lang;var oVideoElements=dojo.query('.preview',oVidMod);var oVideoElId=null;for(var i=0,len=oVideoElements.length;i<len;i++){var oVideoEl=oVideoElements[i];oVideoElId=oVideoEl.id;var tempGUID=oVideoElId.split(':');var getImgGuid=tempGUID[1].replace(/_/g,'-');var guidVideoDetails=dj.util.Video.getVideoDetails({'id':getImgGuid,'fields':'thumbnailURLSmall'});if(guidVideoDetails!=="undefined"){var getSmallThumnailURL='url('+guidVideoDetails.thumbnailURLSmall+')';if(getSmallThumnailURL!==null){oVideoEl.style.backgroundImage=getSmallThumnailURL;}}else{console.log('getSmallThumnailURL is '+getSmallThumnailURL);oVideoEl.style.backgroundImage='/img/bb/BB_DBlogo.gif';}}}};dojo.provide("dj.widget.video.VideoCenter");dojo.require("dj.lang");dojo.require("dj.util.Ads");dojo.require("dj.util.Cookie");dojo.require("dj.util.Omniture");dojo.require("dj.util.Region");dojo.require("dj.util.Tracking");dojo.require("dj.util.User");dojo.require("dj.util.Video");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.getObject("dj.context.video",true);dojo.declare("dj.widget.video.VideoCenter",null,{constructor:function(args,objName){this.version="1.0.2";this.videoUtil=dj.util.Video;this.usrActnHash={'':this.handleResponse,'toBrowse':this.handleBrowsingResults,'toSearch':this.handleSearchResults,'current':this.handleCurrent,'next':this.handleNext};this.microPlayers=[];this.microPlayersObjects={};this.videoIdMicroPlayerIdMap={};this.popUpWindow='';this.flashPlayerPath=dj.context.core.cdnPrefix+"/media/swf/";this.collectionsXMLPath="/static_html_files/";this.videoCenterPageUrl="/video-center";this.popUpPageUrl='/public/page/0_0_WP_3001.html';this.objName=objName;this.videoPlayerDivId='video_player';this.sideNavUlId='video_sidenav';this.topNavUlId='video_topnav';this.nextVideoDivId='next_video';this.videoResultsDivId='video_results';this.searchDivId='video_search';this.advertisementDivId='advertisement';this.collectionsSelectId='collectionsSelectId';this.videoSummaryDivId='video_headline';this.registeredVideosDivId='registered_videos';if(this.videoUtil.isNotBlankOrNull(args)){this.videoPlayerDivId=args.videoPlayerDivId?args.videoPlayerDivId:'video_player';this.sideNavUlId=args.sideNavUlId?args.sideNavUlId:'video_sidenav';this.topNavUlId=args.topNavUlId?args.topNavUlId:'video_topnav';this.nextVideoDivId=args.nextVideoDivId?args.nextVideoDivId:'next_video';this.videoResultsDivId=args.videoResultsDivId?args.videoResultsDivId:'video_results';this.searchDivId=args.searchDivId?args.searchDivId:'video_search';this.advertisementDivId=args.advertisementDivId?args.advertisementDivId:'advertisement';this.videoSummaryDivId=args.videoSummaryDivId?args.videoSummaryDivId:'video_headline';this.registeredVideosDivId=args.registeredVideosDivId?args.registeredVideosDivId:'';}
this.xmlDoc='';this.defaultCollectionName='News';this.rssUrlsObject={};this.contentUrlsObject={};this.collectionNamesArray=[];this.subcollectionsObject={};this.urlKeysCollectionMap={};this.urlKeysSubCollectionMap={};this.currentlyPlayingVideoId='';this.currentlyPlayingVideoIds=[];this.currentlyPlayingCollection='';this.currentlyPlayingSubCollection='';this.nextVideoId='';this.visibleCollectionId='';this.visibleSubCollectionId='';this.sortOrder='relevancy';this.currentSearchText='';this.isVideoResultsInSideNav=false;this.currentPlayingJsonObject={};this.currentBrowsingJsonObject={};this.currentSearchJsonObject={};this.currentVideoDetailsJsonObject={};this.nextVideoDetailsJsonObject={};this.registeredVideos=[];this.registeredVideosIds=[];this.relatedVideosCollection='';this.userAction='';this.sourceApplicationName='';this.bookMarkedId='';this.bookMarkedLocation='';this.cookieUserType='';dj.lang.mixin(this,this.videoUtil.setupConfig());},loadVideo:function(id,sourceApplicationName,domainName){console.info("video.js v"+this.version);if(this.videoUtil.isNotBlankOrNull(domainName)){this.domainName=domainName;}
this.sourceApplicationName=sourceApplicationName;if(this.videoUtil.isNotBlankOrNull(id)){if(id.indexOf('{')==-1){this.currentlyPlayingVideoId='{'+id+'}';}
else{this.currentlyPlayingVideoId=id;}}
if(swfobject.getFlashPlayerVersion().major>=9){this.createFlashPlayer();}
else{dj.util.Video.nonSupportingFlashPlayer(this.videoPlayerDivId);}},continueLoadVideo:function(){this.loadCollectionsDoc(this,this.handleLoadVideo);},handleLoadVideo:function(data,xhr){this.xmlDoc=xhr.responseXML.documentElement;this.parseInformationFromXmlDoc();if(this.sourceApplicationName=='articlePage'){this.visibleCollectionId='';var vObj='';if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingVideoId)){vObj=this.registeredVideos[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)];this.playVideoByParam(vObj);}else{if(this.videoUtil.isNotBlankOrNull(this.bookMarkedId)){this.currentlyPlayingVideoId=this.bookMarkedId;vObj=this.registeredVideos[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)];vObj.seekTime=this.bookMarkedLocation;this.playVideoByParam(vObj);}else{vObj=this.registeredVideos[0];this.currentlyPlayingVideoId=vObj.id;this.playVideoByParam(vObj);}}
this.relatedVideosCollection=this.videoUtil.isNotBlankOrNull(this.registeredVideos[0]['wsj-section'])?this.registeredVideos[0]['wsj-section']:this.defaultCollectionName;this.currentlyPlayingCollection=this.registeredVideos[0]['wsj-section'];if(this.currentlyPlayingCollection=='Lifestyle'){this.currentlyPlayingCollection='Life & Style';}
this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+'&count=60','',this,this.finishHandleLoadVideo);}
else{if(typeof AT_VARS!='undefined'&&AT_VARS.baseDocId){this.currentlyPlayingVideoId='{'+AT_VARS.baseDocId+'}';}
if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingVideoId)){this.playVideoByVideoId(this.currentlyPlayingVideoId);this.currentlyPlayingCollection=this.currentVideoDetailsJsonObject['wsj-section'];this.currentlyPlayingSubCollection=this.currentVideoDetailsJsonObject['wsj-subsection'];if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.visibleCollectionId=this.collectionNameForSubcollection(this.currentlyPlayingSubCollection);this.currentlyPlayingCollection=this.visibleCollectionId;this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingSubCollection])+'&count=60','',this,this.finishHandleLoadVideo);}
else{if(!this.videoUtil.isNotBlankOrNull(this.currentlyPlayingCollection)){this.currentlyPlayingCollection=this.defaultCollectionName;}
this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+'&count=60','',this,this.finishHandleLoadVideo);}}
else{var browserUrl=window.location.pathname;this.currentlyPlayingCollection=this.defaultCollectionName;if(browserUrl.indexOf(".")!=-1){var urlArray=browserUrl.split(".")[0].split('/');var urlKey=urlArray.pop();if(this.urlKeysCollectionMap[urlKey]){this.currentlyPlayingCollection=this.urlKeysCollectionMap[urlKey];}
if(this.urlKeysSubCollectionMap[urlKey]){this.currentlyPlayingSubCollection=this.urlKeysSubCollectionMap[urlKey];this.visibleCollectionId=this.collectionNameForSubcollection(this.currentlyPlayingSubCollection);this.currentlyPlayingCollection=this.visibleCollectionId;}}
var getVideoCallback=dojo.hitch(this,function(){this.currentlyPlayingVideoId=this.currentPlayingJsonObject.items[0].id;this.playVideoByVideoId(this.currentlyPlayingVideoId);this.finishHandleLoadVideo();});if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingSubCollection])+'&count=60','',null,getVideoCallback);}else{this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+'&count=60','',null,getVideoCallback);}}}},finishHandleLoadVideo:function(){this.populateSideNav();this.populateTopNav();if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.updateSideNavAppearance('subcollection',this.currentlyPlayingSubCollection);this.visibleSubCollectionId=this.currentlyPlayingSubCollection;this.browsingGroup="subcollection";this.playingGroup="subcollection";}else{this.updateSideNavAppearance('collection',this.currentlyPlayingCollection);this.visibleCollectionId=this.currentlyPlayingCollection;}
this.currentBrowsingJsonObject=this.currentPlayingJsonObject;if(this.sourceApplicationName=='articlePage'&&this.registeredVideosIds.length>0){this.createRegisteredVideosThumbnails();this.updateVideoThumbnailVisual('','reg'+this.currentlyPlayingVideoId);}
this.updateTopNavAppearance('',this.currentlyPlayingCollection);this.createNextVideo();this.createSearch();this.createAdvertisementFramework();this.populateMoreVideos(1);this.loadPagination(1);this.updateRssFeed((this.visibleSubCollectionId!=='')?this.visibleSubCollectionId:this.visibleCollectionId);},validateContentUrl:function(contentUrl){if(this.videoUtil.isNotBlankOrNull(contentUrl)){return contentUrl;}else{this.currentlyPlayingCollection=this.defaultCollectionName;return this.contentUrlsObject[this.defaultCollectionName];}},createAdvertisementFramework:function(){if(this.advertisementDivId){if(swfobject.getFlashPlayerVersion().major>=9){var dim={w:"336",h:"280"};swfobject.embedSWF(this.flashPlayerPath+"adPlayer.swf",this.advertisementDivId,dim.w,dim.h,"9.0.0","",{'objName':this.getName(),'movieWidth':dim.w,'movieHeight':dim.h,'host':location.host},{allowscriptaccess:"always",wmode:"opaque"},{});}else{dj.util.Video.nonSupportingFlashPlayer(this.advertisementDivId);}}},collectionNameForSubcollection:function(subCol){for(var index=0,len=this.collectionNamesArray.length;index<len;++index){if(this.subcollectionsObject[(this.collectionNamesArray[index])].indexOf(subCol)!=-1){return this.collectionNamesArray[index];}}},pauseMicroPlayers:function(){try{for(var index=0,len=this.microPlayers.length;index<len;++index){swfobject.getObjectById(this.microPlayers[index]).pauseVideo();}}
catch(e){console.error("Error while pausing microPlayers. "+e.message);}},setBookMark:function(){try{this.bookMarkedId=this.currentlyPlayingVideoId;this.bookMarkedLocation=Math.floor(swfobject.getObjectById("flashPlayer").getSeek());swfobject.getObjectById("flashPlayer").pauseVideo();}
catch(e){console.error("Error while setting the bookmark. "+e.message);}},updateVideoThumbnailVisual:function(cleanId,applyId){if(cleanId!==''&&dojo.byId("li_"+cleanId)){dojo.byId("li_"+cleanId).className="";}
if(applyId!==''&&dojo.byId("li_"+applyId)){dojo.byId("li_"+applyId).className="nowPlaying";}},parseInformationFromXmlDoc:function(){var collectionArray=this.xmlDoc.getElementsByTagName("collection");for(var index=0,len=collectionArray.length;index<len;++index){var item=collectionArray[index];this.urlKeysCollectionMap[item.getAttribute("urlkey")]=item.getAttribute("name");this.contentUrlsObject[item.getAttribute("name")]=item.getAttribute("contenturl");this.rssUrlsObject[item.getAttribute("name")]=item.getAttribute("rssurl");this.collectionNamesArray[this.collectionNamesArray.length]=item.getAttribute("name");var subCollectionArray=item.getElementsByTagName("subcollection");var subCollectionArrayLength=subCollectionArray.length;var subCollNamesAr=[];for(var sindex=0,slen=subCollectionArray.length;sindex<slen;++sindex){var sitem=subCollectionArray[sindex];this.urlKeysSubCollectionMap[sitem.getAttribute("urlkey")]=sitem.getAttribute("name");this.contentUrlsObject[sitem.getAttribute("name")]=sitem.getAttribute("contenturl");this.rssUrlsObject[sitem.getAttribute("name")]=sitem.getAttribute("rssurl");subCollNamesAr[sindex]=sitem.getAttribute("name");}
this.subcollectionsObject[item.getAttribute("name")]=subCollNamesAr;}},createFlashPlayer:function(){if(dojo.byId(this.videoPlayerDivId)){try{var dim={w:"512",h:"363"};swfobject.embedSWF(this.flashPlayerPath+"main.swf",this.videoPlayerDivId,dim.w,dim.h,"9.0.0","",{'objName':this.getName(),'allowPlayerPopup':'1','plyMediaEnabled':'1','movieWidth':dim.w,'movieHeight':dim.h,'host':location.host},{allowscriptaccess:"always",wmode:"opaque"},{id:"flashPlayer"});}
catch(e){console.error("Error occured createFlashPlayer.."+e.message);dojo.byId(this.videoPlayerDivId).innerHTML='Couldn\'t load the flash player. \n Error message is: '+e.message;}}},convertCurrentPlayingJsonToIdsArray:function(){this.currentlyPlayingVideoIds=[];if(this.currentPlayingJsonObject.items.length>0){for(var index=0,len=this.currentPlayingJsonObject.items.length;index<len;++index){this.currentlyPlayingVideoIds[index]=this.currentPlayingJsonObject.items[index].id;}}},populateVideoSummary:function(name,description,formattedCreationDate){if(dojo.byId(this.videoSummaryDivId)){var str='';try{str+='<h2>'+name+' <small>'+formattedCreationDate.split(' ')[0]+'</small>';str+='</h2>';str+='<p>'+description+'</p>';}
catch(e){console.error("Error occured in populateVideoSummary."+e.message);str+='Couldn\'t get video summary.';}
dojo.byId(this.videoSummaryDivId).innerHTML=str;}},createAdvertisement:function(imgUrl,link){try{swfobject.getObjectById(this.advertisementDivId).loadAd(imgUrl,link);}
catch(e){console.error("Error while loading ad in createAdvertisement : "+e);}},createNextVideo:function(){var str='Loading...';try{this.nextVideoId=this.getNextVideoId();if(this.nextVideoId!==''){var url='/api-video/get_video_info.asp?guid='+this.nextVideoId+'&fields=all';this.getVideos(url,'next');}
else{str='No more videos.';}}
catch(e){console.error("Error occured while executing createNextVideo() - "+e.message);str+='Couldn\'t determine next video details.';}
if(dojo.byId(this.nextVideoDivId)){dojo.byId(this.nextVideoDivId).innerHTML=str;}},populateNextVideo:function(){var str='';try{var nameToDisplay=this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.currentlyPlayingSubCollection:this.currentlyPlayingCollection;if(this.currentlyPlayingCollection=='Search Results'){str+='<h3>Next in Video '+this.currentlyPlayingCollection+'</h3>';}
else{str+='<h3>Next in '+nameToDisplay+' Video</h3>';}
str+='<ul class="newsItem video">';str+='<li>';str+='<a href="javascript:'+this.getName()+'.nextVideoThumbnailClicked(\''+this.nextVideoDetailsJsonObject.id+'\')" style="background-image: url('+this.nextVideoDetailsJsonObject.thumbnailURL+')" class="preview"><span>&nbsp;</span></a>';str+='<h2><a href="javascript:'+this.getName()+'.nextVideoThumbnailClicked(\''+this.nextVideoDetailsJsonObject.id+'\')">'+this.nextVideoDetailsJsonObject.name+'</a></h2>';var minutes=Math.floor(this.nextVideoDetailsJsonObject.duration/60);var seconds=this.nextVideoDetailsJsonObject.duration%60;if(seconds<10){seconds='0'+seconds;}
str+='<small>'+minutes+':'+seconds+'</small>';str+='<p>'+this.nextVideoDetailsJsonObject.description+'</p>';str+='</li>';str+='</ul>';}
catch(e){console.error("Error occured while executing populateNextVideo() - "+e.message);str+='Couldn\'t populate next video details.';}
if(dojo.byId(this.nextVideoDivId)){dojo.byId(this.nextVideoDivId).innerHTML=str;}},nextVideoThumbnailClicked:function(videoId){this.userAction='';this.populateMoreVideos(1);this.loadPagination(1);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,videoId);this.currentlyPlayingVideoId=videoId;this.playVideoByVideoId(videoId);this.createNextVideo();if(this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)){this.updateSideNavAppearance('subcollection',this.currentlyPlayingSubCollection);}
else{this.updateSideNavAppearance('collection',this.currentlyPlayingCollection);}},createSearch:function(){var str='';str+='<form id="searchForm" onSubmit="javascript:'+this.getName()+'.searchButtonClicked();return false;" class="" method="post" accept-charset="utf-8">';str+='<fieldset>';str+='<legend>Search Videos</legend>';str+='<div class="ctl">';str+='<label for="frmSearchSectCtl01">Search Videos</label>';str+='<input type="text" name="frmSearchSectCtl01" value="Search Video" id="frmSearchSectCtl01" class="text" onFocus="'+this.getName()+'.searchInputBoxFocused();"/>';str+='</div>';str+='<div class="ctl">';str+='<label for="frmSearchSectSub">Search</label>';str+='<button id="searchButton" type="submit">Search</button>';str+='</div>';str+='</fieldset>';str+='</form>';if(dojo.byId(this.searchDivId)){dojo.byId(this.searchDivId).innerHTML=str;}},searchInputBoxFocused:function(){dojo.byId("frmSearchSectCtl01").value="";dojo.byId("searchForm").className="";},searchButtonClicked:function(){var searchTxt=dojo.byId("frmSearchSectCtl01").value.replace(/^\s+|\s+$/,'');if(searchTxt===''){dojo.byId("searchForm").className="search_error";dojo.byId("frmSearchSectCtl01").value="Please enter search terms";dojo.byId("searchButton").focus();return false;}
this.currentSearchText=searchTxt;this.sortOrder='relevancy';if(!this.isVideoResultsInSideNav){this.insertVideoResultsInSideNav();this.isVideoResultsInSideNav=true;}
this.updateVideoResultsInSideNav(this.currentSearchText);this.updateSideNavAppearance('collection','Search Results');var searchUrl='/api-video/find_all_videos.asp?type=wsj-fulltext&query='+searchTxt;this.performSearch(searchUrl);dojo.byId("searchButton").focus();},insertVideoResultsInSideNav:function(){var str='';str+='<li id="Search Results" class="noSubCollection">';str+='</li>';str+=dojo.byId(this.sideNavUlId).innerHTML;dojo.byId(this.sideNavUlId).innerHTML=str;},updateVideoResultsInSideNav:function(srchText){var fields='id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection';var srchContentUrl='/api-video/find_all_videos.asp?type=wsj-fulltext&query='+srchText+'&fields='+fields;this.contentUrlsObject['Search Results']=srchContentUrl;var str='';str+='<a id="a_Search Results" class="" href="javascript:'+this.getName()+'.sideNavClicked(\'collection\',\'Search Results\');">';str+='Search Results</a>';dojo.byId("Search Results").innerHTML=str;},performSearch:function(searchUrl){this.userAction='toSearch';var fields='id,name,description,duration,thumbnailURL,videoURL,formattedCreationDate,wsj-section,wsj-subsection';dojo.byId(this.videoResultsDivId).innerHTML='<p class="noResults"> Loading ... </p>';this.getVideos(searchUrl+'&fields='+fields+'&count=60',this.userAction);},loadPagination:function(pageNumber){var varToDisplay='';if(this.userAction=='toBrowse'){if(typeof this.currentBrowsingJsonObject!="undefined"){varToDisplay=this.currentBrowsingJsonObject.items;}}
else
if(this.userAction=='toSearch'){if(typeof this.currentSearchJsonObject!="undefined"){varToDisplay=this.currentSearchJsonObject.items;}}
else{varToDisplay=this.currentPlayingJsonObject.items;}
var currentPageNumber=Number(pageNumber);var flr=Math.floor(varToDisplay.length/this.pageSize);var cl=Math.ceil(varToDisplay.length/this.pageSize);var lastPageNumber=Math.max(flr,cl);var str='';if(currentPageNumber==1){str+='<li id="previous" class="listFirst"><span>Previous</span></li>';}
else{str+='<li id="previous" class="listFirst"><a href="javascript:'+this.getName()+'.paginationClicked(\''+(currentPageNumber-1)+'\')">Previous</a></li>';}
for(var index=1;index<=lastPageNumber;index++){if(currentPageNumber==index){str+='<li><span>'+index+'</span></li>';}
else{str+='<li><a href="javascript:'+this.getName()+'.paginationClicked(\''+index+'\')" >'+index+'</a></li>';}}
if(currentPageNumber>=lastPageNumber){str+='<li id="next"><span>Next</span></li>';}
else{str+='<li id="next"><a href="javascript:'+this.getName()+'.paginationClicked(\''+(currentPageNumber+1)+'\')">Next</a></li>';}
dojo.byId("pagination").innerHTML=str;},paginationClicked:function(pageNumber){this.populateMoreVideos(pageNumber);this.loadPagination(pageNumber);this.updateRssFeed((this.visibleSubCollectionId!=='')?this.visibleSubCollectionId:this.visibleCollectionId);},getVideos:function(url,userAction,context,callback,error){var localErrorCallback=dojo.hitch(this,function(err,url,userAction,context,callback){setTimeout(this.getVideos(url,userAction,context,callback,err),10000);});var that=this;var params={handleAs:"json",responseType:"application/json",callback:function(json){that.usrActnHash[userAction].apply(that,[json]);if(callback){if(context){callback.apply(context);}else{callback();}}},errorCallback:function(err){console.warn("faled to getVideos:"+err+", fetching "+url);localErrorCallback(err,url,userAction,context,callback);}};dj.util.Video.getVideoData(url,params);},handleResponse:function(json){this.currentPlayingJsonObject=json;this.convertCurrentPlayingJsonToIdsArray();},handleBrowsingResults:function(json){this.currentBrowsingJsonObject=json;this.populateMoreVideos(1);this.loadPagination(1);this.updateRssFeed((this.visibleSubCollectionId!=='')?this.visibleSubCollectionId:this.visibleCollectionId);},handleSearchResults:function(json){this.currentSearchJsonObject=json;this.populateMoreVideos(1);this.loadPagination(1);},handleCurrent:function(json){this.currentVideoDetailsJsonObject=json;this.currentlyPlayingCollection=this.currentVideoDetailsJsonObject['wsj-section'];this.currentlyPlayingSubCollection=this.currentVideoDetailsJsonObject['wsj-subsection'];this.playVideoByParam(this.currentVideoDetailsJsonObject);this.populateVideoSummary(this.currentVideoDetailsJsonObject.name,this.currentVideoDetailsJsonObject.description,this.currentVideoDetailsJsonObject.formattedCreationDate);},handleNext:function(json){this.nextVideoDetailsJsonObject=json;this.populateNextVideo();},populateSideNav:function(){var src='';var collectionArray=this.xmlDoc.getElementsByTagName("collection");for(var index=0,len=collectionArray.length;index<len;++index){var item=collectionArray[index];var subCollectionArray=item.getElementsByTagName("subcollection");var subCollectionArrayLength=subCollectionArray.length;if(subCollectionArrayLength>0){src+='<li class="expand" id="'+item.getAttribute("name")+'"><a id="a_'+item.getAttribute("name")+'" class="" href="javascript:'+this.getName()+'.sideNavClicked(\''+item.nodeName+'\',\''+item.getAttribute("name")+'\');">'+item.getAttribute("name")+'</a>';}
else{src+='<li class="noSubCollection" id="'+item.getAttribute("name")+'"><a id="a_'+item.getAttribute("name")+'" class="" href="javascript:'+this.getName()+'.sideNavClicked(\''+item.nodeName+'\',\''+item.getAttribute("name")+'\');">'+item.getAttribute("name")+'</a>';}
if(subCollectionArrayLength>0){src+='<ul id=Sub'+item.getAttribute("name")+'>';for(var sindex=0,slen=subCollectionArray.length;sindex<slen;++sindex){var sitem=subCollectionArray[sindex];src+='<li><a id="a_'+sitem.getAttribute("name")+'" class="current" href="javascript:'+this.getName()+'.sideNavClicked(\''+sitem.nodeName+'\',\''+sitem.getAttribute("name")+'\');">'+sitem.getAttribute("name")+'</a></li>';}
src+='</ul>';}
src+='</li>';}
dojo.byId(this.sideNavUlId).innerHTML=src;},populateTopNav:function(){if(dojo.byId(this.topNavUlId)){var src='';var collectionArray=this.xmlDoc.getElementsByTagName("collection");for(var index=0,len=collectionArray.length;index<len;++index){var item=collectionArray[index];var itemName=item.getAttribute("name");if((itemName!='Most Popular Today')&&(itemName!='Management')&&(itemName!='Special Packages')){var className=itemName;className='navlink_'+className.toLowerCase().replace(/\s+/g,'_');if(index=='1'){src+='<li class="listFirst">';}
else{src+='<li>';}
src+='<a class='+className+' id="a_topnav_'+itemName+'" href="javascript:'+this.getName()+'.topNavClicked(\''+item.nodeName+'\',\''+itemName+'\');">'+itemName+'</a>';src+='</li>';}}
dojo.byId(this.topNavUlId).innerHTML=src;}},topNavClicked:function(strType,strName){this.userAction='';this.updateSideNavAppearance(strType,strName);this.updateTopNavAppearance(strType,strName);this.currentlyPlayingCollection=strName;this.getVideos(this.validateContentUrl(this.contentUrlsObject[this.currentlyPlayingCollection])+'&count=60','',this,this.handleTopNavGetVideos);},handleTopNavGetVideos:function(){this.visibleCollectionId=this.currentlyPlayingCollection;this.currentBrowsingJsonObject=this.currentPlayingJsonObject;this.currentlyPlayingVideoId=this.currentPlayingJsonObject.items[0].id;this.playVideoByVideoId(this.currentlyPlayingVideoId);this.populateMoreVideos(1);this.loadPagination(1);this.browsingGroup="collection";this.playingGroup="collection";this.createNextVideo();},updateTopNavAppearance:function(strType,strName){var removeFrom=this.currentlyPlayingCollection;if(removeFrom=='Lifestyle'){removeFrom='Life & Style';}
if(dojo.byId('a_topnav_'+removeFrom)){var playingCollectionClassName=dojo.byId('a_topnav_'+removeFrom).className;var newPlayingCollectionClassName=playingCollectionClassName.replace('selected ','');dojo.byId('a_topnav_'+removeFrom).className=newPlayingCollectionClassName;}
if(dojo.byId('a_topnav_'+strName)){var classNameToApply='selected '+'navlink_'+strName.toLowerCase().replace(/\s+/g,'_');dojo.byId('a_topnav_'+strName).className=classNameToApply;}},sideNavClicked:function(strType,strName){this.userAction='';if(this.videoUtil.isNotBlankOrNull(this.contentUrlsObject[strName])){this.browsingGroup=strType;if(strName=='Search Results'){this.userAction='toSearch';this.sortOrder='relevancy';}
else
if(((strType=='subcollection')&&(strName!=this.currentlyPlayingSubCollection))||((strType=='collection')&&(strName!=this.currentlyPlayingCollection))){this.userAction='toBrowse';}
this.updateSideNavAppearance(strType,strName);dojo.byId(this.videoResultsDivId).innerHTML='<p class="noResults"> Loading ... </p>';if(this.videoUtil.isNotBlankOrNull(this.userAction)){this.getVideos(this.contentUrlsObject[strName]+'&count=60',this.userAction);}
else{this.populateMoreVideos(1);this.loadPagination(1);}}
else{this.updateSideNavAppearance(strType,strName);}},searchLinkClicked:function(searchUrl,sortParam){this.sortOrder=sortParam;this.performSearch(searchUrl);},populateMoreVideos:function(pageNumber){var varToDisplay='';if(this.userAction=='toBrowse'){if(typeof this.currentBrowsingJsonObject!="undefined"){varToDisplay=this.currentBrowsingJsonObject.items;}}
else
if(this.userAction=='toSearch'){if(typeof this.currentSearchJsonObject!="undefined"){varToDisplay=this.currentSearchJsonObject.items;}}
else{varToDisplay=this.currentPlayingJsonObject.items;}
var startIndex=(pageNumber-1)*12;var endIndex=Math.min(pageNumber*12-1,varToDisplay.length-1);var str='';if(this.userAction=='toSearch'&&varToDisplay.length>0){str+='<ul class="sort"><li class="listFirst">Sort by:</li>';var sUrl='/api-video/find_all_videos.asp?type=wsj-fulltext&query='+this.currentSearchText;if(this.sortOrder=='relevancy'){str+='<li class="selected"><span>relevance</span></li>';str+='<li class="listLast"><a href="javascript:'+this.getName()+'.searchLinkClicked(\''+sUrl+'&sort=date+desc\',\'date\')">Date</a></li>';}
else{str+='<li><a href="javascript:'+this.getName()+'.searchLinkClicked(\''+sUrl+'&sort=relevancy\',\'relevancy\')">Relevance</a></li>';str+='<li class="listLast selected"><span>Date</span></li>';}
str+='</ul>';str+='<p class="resultsLabel">'+(startIndex+1)+' - '+(endIndex+1)+' results out of '+varToDisplay.length+' for: '+this.currentSearchText+'</p>';}
if(this.userAction=='toSearch'&&varToDisplay.length===0){str+='<p class="noResults"> No content matches your search terms. Please try again. </p>';dojo.byId(this.videoResultsDivId).innerHTML=str;return false;}
str+='<ul class="newsItem video videoListMed">';for(var i=startIndex;i<endIndex+1;i++){var title=varToDisplay[i];str+='<li id="li_'+title.id+'" class="">';str+='<a href="javascript:'+this.getName()+'.videoThumbnailClicked(\''+title.id+'\')" id="'+title.id+'" style="background-image: url('+unescape(title.thumbnailURL)+');" class="preview"><span>&nbsp;</span></a>';str+='<h2><a href="javascript:'+this.getName()+'.videoThumbnailClicked(\''+title.id+'\')">'+title.name+'</a></h2>';var minutes=Math.floor(title.duration/60);var seconds=title.duration%60;if(seconds<10){seconds='0'+seconds;}
str+='<small>'+minutes+':'+seconds+'</small>';if(this.videoUtil.isNotBlankOrNull(title.formattedCreationDate)){str+='<small> '+title.formattedCreationDate.split(' ')[0]+'</small>';}
str+='</li>';if(((i+1)%4)===0){str+='<li class="rowEnd"></li>';}}
str+='</ul>';str+='<ul id="pagination" class="pagination">';str+='</ul>';if(this.userAction!='toSearch'){var nameToDisplay=this.videoUtil.isNotBlankOrNull(this.visibleSubCollectionId)?this.visibleSubCollectionId:this.visibleCollectionId;str+='<a target="_blank" id="rssFeed" class="rss" href="">'+nameToDisplay+' Video Feed</a>';}
dojo.byId(this.videoResultsDivId).innerHTML=str;if(!this.playFromRegisteredVideos){this.updateVideoThumbnailVisual('',this.currentlyPlayingVideoId);}},updateRssFeed:function(str){if(dojo.byId("rssFeed")){dojo.byId("rssFeed").href=this.rssUrlsObject[str];}},videoThumbnailClicked:function(videoId){var videoDetails='';if(this.sourceApplicationName=='articlePage'){this.playFromRegisteredVideos=false;this.updateVideoThumbnailVisual('reg'+this.currentlyPlayingVideoId,'');videoDetails=this.videoUtil.getVideoDetails({'id':videoId,'fields':'linkRelativeURL,wsj-section'});}
if(videoDetails!==''&&(this.relatedVideosCollection!=videoDetails['wsj-section']||this.visibleCollectionId=='Search Results')){window.location.href=videoDetails.linkRelativeURL+'.html';;}
else{this.playingGroup=this.browsingGroup;if(this.userAction=='toSearch'){this.currentPlayingJsonObject=this.currentSearchJsonObject;}
else
if(this.userAction=='toBrowse'){this.currentPlayingJsonObject=this.currentBrowsingJsonObject;}
this.convertCurrentPlayingJsonToIdsArray();this.updateTopNavAppearance('',this.visibleCollectionId);this.currentlyPlayingCollection=this.visibleCollectionId;this.currentlyPlayingSubCollection=this.visibleSubCollectionId;this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,videoId);this.currentlyPlayingVideoId=videoId;this.playVideoByVideoId(videoId);this.createNextVideo();}
if(dojo.byId("flashPlayer")){window.scrollTo(0,dojo.position(dojo.byId("flashPlayer"),true).y);}},playNextVideo:function(){if(this.nextVideoId!==''){this.updateVideoThumbnailVisual('reg'+this.currentlyPlayingVideoId,'reg'+this.nextVideoDetailsJsonObject.id);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,this.nextVideoDetailsJsonObject.id);this.currentlyPlayingVideoId=this.nextVideoDetailsJsonObject.id;this.playVideoByParam(this.nextVideoDetailsJsonObject);this.populateVideoSummary(this.nextVideoDetailsJsonObject.name,this.nextVideoDetailsJsonObject.description,this.nextVideoDetailsJsonObject.formattedCreationDate);this.createNextVideo();}},getNextVideoId:function(){if(this.sourceApplicationName=='articlePage'){if(this.playFromRegisteredVideos&&this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)<this.registeredVideosIds.length-1){return this.registeredVideosIds[this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)+1];}
if(this.playFromRegisteredVideos&&this.registeredVideosIds.indexOf(this.currentlyPlayingVideoId)==this.registeredVideosIds.length-1){this.playFromRegisteredVideos=false;return this.currentlyPlayingVideoIds[0];}
if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)<(this.currentlyPlayingVideoIds.length-1)){return this.currentlyPlayingVideoIds[this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)+1];}
if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==(this.currentlyPlayingVideoIds.length-1)){return'';}}
else{if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==-1){return this.currentlyPlayingVideoIds[0];}
if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)<(this.currentlyPlayingVideoIds.length-1)){return this.currentlyPlayingVideoIds[this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)+1];}
if(this.currentlyPlayingVideoIds.indexOf(this.currentlyPlayingVideoId)==(this.currentlyPlayingVideoIds.length-1)){if(this.currentlyPlayingCollection=='Search Results'){return'';}
if(this.playingGroup!==""&&this.playingGroup=='collection'){return this.getVideoIdFromNextCollection();}
if(this.playingGroup!==""&&this.playingGroup=='subcollection'){return this.getVideoIdFromNextSubCollection();}}}},getVideoIdFromNextSubCollection:function(){var subColAr=this.subcollectionsObject[this.currentlyPlayingCollection];if(subColAr.indexOf(this.currentlyPlayingSubCollection)!=subColAr.length-1){this.currentlyPlayingSubCollection=subColAr[subColAr.indexOf(this.currentlyPlayingSubCollection)+1];this.getVideos(this.contentUrlsObject[this.currentlyPlayingSubCollection]+'&count=60','',this,handleGetVideoIdFromNextSubColection);}else{this.currentlyPlayingSubCollection='';return this.getVideoIdFromNextCollection();}},handleGetVideoIdFromNextSubColection:function(){if(this.currentPlayingJsonObject.items.length===0){return this.getVideoIdFromNextSubCollection();}
else{return this.currentPlayingJsonObject.items[0].id;}},getVideoIdFromNextCollection:function(){if(this.collectionNamesArray.indexOf(this.currentlyPlayingCollection)!=this.collectionNamesArray.length-1){if(this.skipCollection){this.currentlyPlayingCollection=this.collectionNamesArray[this.collectionNamesArray.indexOf(this.currentlyPlayingCollection)+1];}
this.skipCollection=true;this.getVideos(this.contentUrlsObject[this.currentlyPlayingCollection]+'&count=60','',this,handleGetVideoIdFromNextCollection);}
else{this.currentlyPlayingCollection=this.defaultCollectionName;this.skipCollection=false;return this.getVideoIdFromNextCollection();}},handleGetVideoIdFromNextCollection:function(){if(this.currentPlayingJsonObject.items.length===0){return this.getVideoIdFromNextCollection();}
else{return this.currentPlayingJsonObject.items[0].id;}},loadCollectionsDoc:function(context,callback){var params={context:context,callback:callback,responseType:"text/xml",errorCallback:function(){console.error("Failure while loading video Collection xml.");}};dj.util.Video.getVideoData(this.collectionsXMLPath+"video-collections.xml",params);},updateSideNavAppearance:function(strType,id){if(this.visibleSubCollectionId!==''){if(dojo.byId('a_'+this.visibleSubCollectionId)){if(dojo.byId('a_'+this.visibleSubCollectionId).className=='subcollection-selected'){dojo.byId('a_'+this.visibleSubCollectionId).className='current';}}}
if(strType=='collection'){if(this.visibleCollectionId!==''){var vCol=dojo.byId(this.visibleCollectionId);var aVCol=dojo.byId('a_'+this.visibleCollectionId);if(vCol.className=='expanded'){vCol.className='expand';aVCol.className='';}else if(vCol.className=='expand'){aVCol.className='';}else{vCol.className='noSubCollection';aVCol.className='';}}
if(dojo.byId(id).className=='expand'){dojo.byId(id).className='expanded';dojo.byId('a_'+id).className='collection-selected';}
else{dojo.byId(id).className='noSubCollection-expanded';dojo.byId('a_'+id).className='selected';}
this.visibleCollectionId=id;this.visibleSubCollectionId='';}
if(strType=='subcollection'){if(this.videoUtil.isNotBlankOrNull(dojo.byId('a_'+id))){dojo.byId('a_'+id).className='subcollection-selected';}
if(this.videoUtil.isNotBlankOrNull(dojo.byId(this.visibleCollectionId))){dojo.byId(this.visibleCollectionId).className='expanded';}
if(this.videoUtil.isNotBlankOrNull(dojo.byId('a_'+this.visibleCollectionId))){dojo.byId('a_'+this.visibleCollectionId).className='';}
this.visibleSubCollectionId=id;}},getName:function(){return this.objName;},playVideoByVideoId:function(videoId){var url='/api-video/get_video_info.asp?guid='+videoId+'&fields=all';this.getVideos(url,'current');},playVideoByParam:function(params){var adZone=new dj.util.Ads().getRegisteredAdsZone('');var lineup=this.videoUtil.isNotBlankOrNull(this.currentlyPlayingSubCollection)?this.currentlyPlayingSubCollection:this.currentlyPlayingCollection;if(adZone!='default'&&adZone!=''){params.adZone=adZone;}
params.lineup=lineup;params.emailPartnerID=110626;params.site=this.site;params.msrc=this.msrc;params.adFrmt="frmt=2;";params.playerName=(this.sourceApplicationName=='articlePage')?"video_articletab":"video_videocenter";params.embedPlayerURL=this.flashPlayerPath+"main.swf";params.embedConfigURL=this.embedConfigURL;params.embedPlayerID="1000";params.embedName="flashPlayer";params.embedBaseURL=this.flashPlayerPath;params.embedHeight=363;params.embedWidth=512;params.larsID=91;params.larsAdTrackingID=1259;params.prop5=window.location.href.split('?')[0];params.prop6=window.location.href;params.prop10=this.videoUtil.getUrlParam(window.location.href,'mod');params.campaign=this.videoUtil.getUrlParam(window.location.href,'mod');params.prop11=this.videoUtil.getUrlParam(window.location.href,'reflink');params.prop19=(this.sourceApplicationName=='articlePage')?"video_tab":"video";params.prop24=this.prop24;params.prop25=this.prop25;params.prop27=this.prop27;var subSecComponent=this.videoUtil.omnitureEncoding(this.currentlyPlayingCollection,this.currentlyPlayingSubCollection,'s');var secComponent=this.videoUtil.omnitureEncoding(this.currentlyPlayingCollection,this.currentlyPlayingSubCollection,'c');params.prop2="WSJ_"+secComponent;params.prop3="WSJ_Video_Video_"+secComponent;params.prop22="WSJ_Video_Video_"+subSecComponent;params.prop26="WSJ_"+subSecComponent;params.emailURL=this.emailURL;swfobject.getObjectById("flashPlayer").playVideo(dojo.toJson(params));},openPopUpPlayer:function(){var currentPlayingLocation=Math.floor(swfobject.getObjectById("flashPlayer").getSeek());var width='512';var height='660';var currentlyPlayingCollection=this.currentlyPlayingCollection;if((currentlyPlayingCollection=='Special Packages')||(currentlyPlayingCollection=='Search Results')){currentlyPlayingCollection=this.currentVideoDetailsJsonObject['wsj-section'];}
this.popUpWindow=window.open(this.popUpPageUrl+'?currentPlayingLocation='+currentPlayingLocation+'&currentlyPlayingCollection='+escape(currentlyPlayingCollection)+'&currentlyPlayingVideoId='+this.currentlyPlayingVideoId,'popUpPlayer','height='+height+',width='+width+',left='+((screen.width-Number(width))/2)+',top='+(screen.height-Number(height))/2+',resizable=yes,scrollbars=no,toolbar=no,status=no');},focusPopUp:function(){if(this.popUpWindow){this.popUpWindow.focus();}},createRegisteredVideosThumbnails:function(){if(this.registeredVideosIds.length>0){var str='';for(var index=0,len=this.registeredVideosIds.length;index<len;++index){var title=this.registeredVideos[index];if(title){str+='<li id="li_reg'+title.id+'" class="">';str+='<a href="javascript:'+this.getName()+'.regVideoThumbnailClicked(\''+title.id+'\',\''+unescape(title.videoURL)+'\')" id="'+title.id+'" style="background-image: url('+unescape(title.thumbnailURL)+');" class="preview"><span>&nbsp;</span></a>';str+='<h2><a href="javascript:'+this.getName()+'.regVideoThumbnailClicked(\''+title.id+'\',\''+unescape(title.videoURL)+'\')">'+title.name+'</a></h2>';var minutes=Math.floor(title.duration/60);var seconds=title.duration%60;if(seconds<10){seconds='0'+seconds;}
str+='<small>'+minutes+':'+seconds+'</small>';str+='</li>';if(((index+1)%4)===0){str+='<li class="rowEnd"></li>';}}}
dojo.byId(this.registeredVideosDivId).innerHTML=str;}},regVideoThumbnailClicked:function(videoId){this.playFromRegisteredVideos=true;this.updateVideoThumbnailVisual('reg'+this.currentlyPlayingVideoId,'reg'+videoId);this.updateVideoThumbnailVisual(this.currentlyPlayingVideoId,'');this.currentlyPlayingVideoId=videoId;this.playVideoByVideoId(videoId);this.createNextVideo();},registerVideo:function(videoId){this.playFromRegisteredVideos=true;if(videoId.indexOf('{')==-1){videoId='{'+videoId+'}';}
if(dojo.indexOf(this.registeredVideosIds,videoId)==-1){this.registeredVideosIds[this.registeredVideosIds.length]=videoId;this.registeredVideos[this.registeredVideos.length]=this.videoUtil.getVideoDetails({'id':videoId,'fields':'all'});}},loadSoloVideo:function(videoId,divId){if(videoId.indexOf('{')==-1){videoId='{'+videoId+'}';}
var microPlayerId="MicroPlayer_"+Math.floor(Math.random()*1000000);this.microPlayers[this.microPlayers.length]=microPlayerId;this.videoIdMicroPlayerIdMap[videoId]=microPlayerId;if(!dj.context.video){dj.context.video={};}
if(!dj.context.video.soloVideos){dj.context.video.soloVideos=[];}
dj.context.video.soloVideos[videoId]=this;if(swfobject.getFlashPlayerVersion().major>=9){var dim={w:"272",h:"180"};swfobject.embedSWF(this.flashPlayerPath+"microPlayer.swf",divId,dim.w,dim.h,"9.0.0","",{'objName':"dummy",'videoGUID':videoId,'allowPlayerPopup':'1','plyMediaEnabled':'1','movieWidth':dim.w,'movieHeight':dim.h,'host':location.host},{allowscriptaccess:"always",wmode:"opaque"},{id:microPlayerId});}
else{dj.util.Video.nonSupportingFlashPlayer(divId);}},getJSON:function(id){var url='/api-video/get_video_info.asp?guid='+id;url+='&fields=all';var params={context:this,handleAs:"json",sync:true,responseType:"application/json",callback:this.handleGetJSON,errorCallback:function(){console.error("Failed while executing video.VideoCenter.getJSON");}};dj.util.Video.getVideoData(url,params);this.microPlayersObjects[id]=this.jsonData;return dojo.toJson(this.jsonData);},handleGetJSON:function(json){this.jsonData=json;var adZone=new dj.util.Ads().getRegisteredAdsZone('');if(adZone!='default'&&adZone!=''){this.jsonData.adZone=adZone;}
this.jsonData.emailPartnerID=110626;this.jsonData.site=this.site;this.jsonData.msrc=this.msrc;this.jsonData.adFrmt="frmt=0;";this.jsonData.playerName="video_articleembed";this.jsonData.videoCenterURL="http://"+window.location.host+"/video-center";this.jsonData.embedPlayerURL=this.flashPlayerPath+"microPlayer.swf";this.jsonData.embedConfigURL=this.embedConfigURL;this.jsonData.embedPlayerID="1000";this.jsonData.embedName="microflashPlayer";this.jsonData.embedBaseURL=this.flashPlayerPath;this.jsonData.embedHeight=180;this.jsonData.embedWidth=272;this.jsonData.larsID=91;this.jsonData.larsAdTrackingID=1259;this.jsonData.prop5=window.location.href.split('?')[0];this.jsonData.prop6=window.location.href;this.jsonData.prop10=this.videoUtil.getUrlParam(window.location.href,'mod');this.jsonData.campaign=this.videoUtil.getUrlParam(window.location.href,'mod');this.jsonData.prop11=this.videoUtil.getUrlParam(window.location.href,'reflink');this.jsonData.prop19="video_emb";this.jsonData.prop24=this.prop24;this.jsonData.prop25=this.prop25;this.jsonData.prop27=this.prop27;var subSecComponent=this.videoUtil.omnitureEncoding(this.jsonData['wsj-section'],this.jsonData['wsj-subsection'],'s');var secComponent=this.videoUtil.omnitureEncoding(this.jsonData['wsj-section'],this.jsonData['wsj-subsection'],'c');this.jsonData.prop2="WSJ_"+secComponent;this.jsonData.prop3="WSJ_Video_Video_"+secComponent;this.jsonData.prop22="WSJ_Video_Video_"+subSecComponent;this.jsonData.prop26="WSJ_"+subSecComponent;this.jsonData.emailURL=this.emailURL;var suprsAd='0';try{if(pID.indexOf('0_0_WH')!=-1){suprsAd='1';}}
catch(e){console.error("pID read error");}
this.jsonData.suppressAds=suprsAd;},updateTitle:function(){var title=dj.lang.query('#videoPlayerDescription h2')[0].innerHTML;title=title.substring(0,title.indexOf('<small>')-1);document.title=document.title.replace('Article',title);}});dojo.declare("dj.widget.video.video",dj.widget.video.VideoCenter,{constructor:function(args,objName){dojo.deprecated("dj.widget.video.video","Use dj.widget.video.VideoCenter, remove alias when MST JSEXECs updated","1.0");}});dojo.provide("dj.widget.video.Video");dojo.require("dj.lang");dojo.require("dj.util.Video");dojo.require("dj.util.Ads");dojo.require("swfobject.swfobject_1_5.swfobject");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.require("dj.widget.video.VideoCenter");dojo.require("dj.util.Element");dojo.getObject("dj.module.video",true);dojo.declare("dj.widget.video.Video",null,{config:{thumbnail:{divclass:"headlineSummary video",onclickprefix:"dj.module.articleVideoPlayer.tabplay(",onclicksuffix:");",hrefprefix:"#articleTabs_video-"},bc:{src:"http://wsj.vo.llnwd.net/o28/plymedia/SWF/BrightPLYembed.swf",flashVars:"playerId=452319854&viewerSecureGatewayURL=https://services.brightcove.com/services/amfgateway&servicesURL=http://services.brightcove.com/services&cdnURL=http://admin.brightcove.com&domain=embed&autoStart=false&showTicker=true&flashId=flashObj&videoId=",base:"http://wsj.vo.llnwd.net/o28/plymedia/SWF",bgcolor:"#000000",name:"BrightPLYembed",pluginspage:"http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash",flashversion:"8"}},constructor:function(id,v,w,h,c){if(!id){return;}
this.parent=dojo.byId(id);var isWidgetAlreadyHandled=(typeof dojo.query("div[data-dj-live-widget]",this.parent)[0]==="object");if(isWidgetAlreadyHandled){console.info("{Video} %o will be handled by the video.MicroPlayer.",id);return;}
this.microPlayers=[];this.microPlayersObjects={};this.videoIdMicroPlayerIdMap={};this.videoUtil=dj.util.Video;dj.util.Element.identify(this.parent);var overlayConfig=this.videoUtil.setupConfig();dj.lang.mixin(this,overlayConfig);this.flashPlayerPath=dj.context.core.cdnPrefix+"/media/swf/";this.parentid=id;if(!this.parent){console.log('id '+id+' not found');return;}
this.v=v;w=264;this.w=w;h=254;this.h=h;this.c=c;if(v){this.load(v,w,h,c);}},createwrapper:function(v,w,h){this.div=dojo.create("div",{"id":this.vidid});if(w&&!this.isguid(v)){this.tryw=''+w+'px';this.div.style.width=this.tryw;}
this.parent.appendChild(this.div);},createvideobc:function(v,w,h,c){dojo.deprecated("dj.widget.video.Video.createvideobc","If brightcove is not supported, remove this method","2.0");this.so=new SWFObject(this.config.bc.src,v,w,h,this.config.bc.flashversion,this.config.bc.bgcolor);this.so.setAttribute('id','video_'+this.vidid);this.so.addParam('base',this.config.bc.base);this.so.addParam("flashVars",this.config.bc.flashVars+v+'&');this.so.addParam("seamlesstabbing","false");this.so.addParam("swLiveConnect","true");this.so.addParam("name",this.config.bc.name);this.so.addParam("pluginspage",this.config.bc.pluginspage);this.so.addParam("wmode","opaque");this.so.write(this.div);if(c){var caption=dojo.create("p",{"class":"targetCaption",innerHTML:c});this.div.appendChild(caption);}},createvideoguid:function(v){this.loadSoloVideo(v,this.vidid);if(this.c){var caption=dojo.create("p",{"class":"targetCaption","innerHTML":this.c});this.parent.appendChild(caption);}},createvideo:function(v,w,h,c){if(this.isguid(v))
{this.createvideoguid(v);}else{this.createvideobc(v,w,h,c);}},load:function(v,w,h,c){if(!this.div){this.newId();this.createwrapper(v,w,h);this.createvideo(v,w,h,c);}},createthumbnail:function(playObserver){if(!this.guidvideo){console.error('no guidvideo');return;}
if(!this.guidvideo.details){console.error('no guidvideo.details');return;}
if(!playObserver){console.warn('no playObserver');}
var vtdiv=dojo.create('div',{'class':'videoTree'});this.div.appendChild(vtdiv);var vfdiv=dojo.create('div',{'class':'videoFrame'});vtdiv.appendChild(vfdiv);var aimg=dojo.create('a',{'href':"#"});var that=this;dojo.connect(aimg,"onclick",this,function(ev){playObserver.fire(this.v);dojo.stopEvent(ev);});vfdiv.appendChild(aimg);var img=dojo.create('img',{'src':this.guidvideo.details.thumbnailURLSmall,'width':'115','height':'65','alt':'video'});aimg.appendChild(img);var spannbsp=dojo.create('span',{'class':'videoBug'});spannbsp.innerHTML="&nbsp;";aimg.appendChild(spannbsp);var title=dojo.create("h3",{"class":"first"});this.div.appendChild(title);var ah3=dojo.create("a",{"href":"#",innerHTML:this.guidvideo.details.name});var that2=this;dojo.connect(ah3,"onclick",this,function(ev){playObserver.fire(this.v);dojo.stopEvent(ev);});title.appendChild(ah3);var duration=dojo.create("small",{innerHTML:this.videoUtil.formatduration(this.guidvideo.details.duration)});this.div.appendChild(duration);var desc=dojo.create("p",{"class":"targetCaption",innerHTML:this.guidvideo.details.description});this.div.appendChild(desc);},loadthumbnail:function(v,w,h,playObserver){this.v=v;if(!this.isguid(v)){console.error("cannot create tumbnail to old video");return;}
this.getvideodetails();this.newId();this.createwrapper(v,w,h);this.createthumbnail(playObserver);},getguidvideo:function(){try{if(this.guidvideo){return this.guidvideo;}else{this.guidvideo=new dj.widget.video.VideoCenter();return this.guidvideo;}}
catch(e){console.error("could not instantiate dj.widget.video.VideoCenter");}
return null;},getvideodetails:function(){if(this.getguidvideo()){this.guidvideo.details=this.videoUtil.getVideoDetails({'id':this.v,'fields':'name,id,duration,description,thumbnailURL,thumbnailURLSmall'});}},setBookMark:function(){if(this.getguidvideo()){this.guidvideo.setBookMark();}},pauseMicroPlayer:function(){if(this.getguidvideo()){this.guidvideo.pauseMicroPlayers();}},isguid:function(g){g=''+g;if(g.substring(0,1)!='{'){g='{'+g;}
if(g.substring(0,1)=='{'&&g.substring(9,10)=='-'&&g.substring(14,15)=='-'&&g.substring(19,20)=='-'){return true;}else{return false;}},newId:function(){this.vidid="videodiv_"+Math.floor(Math.random()*999999);},loadSoloVideo:function(videoId,divId){var overlayConfig=this.videoUtil.setupConfig();dj.lang.mixin(this,overlayConfig);if(videoId.indexOf('{')==-1){videoId='{'+videoId+'}';}
var microPlayerId="MicroPlayer_"+Math.floor(Math.random()*1000000);this.microPlayers[this.microPlayers.length]=microPlayerId;this.videoIdMicroPlayerIdMap[videoId]=microPlayerId;dojo.getObject("dj.context.video",true);if(!dj.context.video.soloVideos){dj.context.video.soloVideos=[];}
dj.context.video.soloVideos[videoId]=this;var chainVideos=1;var chainVideosFlag=dojo.getObject("dj.context.video.chainVideos");if(chainVideosFlag!=undefined&&chainVideosFlag===false){chainVideos=0;}
if(swfobject.getFlashPlayerVersion().major>=9){var dim={w:"272",h:"180"};swfobject.embedSWF(this.flashPlayerPath+"microPlayer.swf",divId,dim.w,dim.h,"9.0.0","",{'objName':"dummy",'videoGUID':videoId,'allowPlayerPopup':'1','plyMediaEnabled':'1','movieWidth':dim.w,'movieHeight':dim.h,'host':location.host,'chainVideos':chainVideos},{allowscriptaccess:"always",wmode:"opaque"},{id:microPlayerId});}
else{dj.util.Video.nonSupportingFlashPlayer(divId);}},openMicroPopUpPlayer:function(id){var currentPlayingLocation=Math.floor(swfobject.getObjectById(this.videoIdMicroPlayerIdMap[id]).getSeek());var currentlyPlayingCollection=this.microPlayersObjects[id]['wsj-section'];if(currentlyPlayingCollection=='Lifestyle'){currentlyPlayingCollection='Life & Style';}
var currentlyPlayingVideoId=id;var width='512';var height='660';this.popUpWindow=window.open(this.popUpPageUrl+'?currentPlayingLocation='+currentPlayingLocation+'&currentlyPlayingCollection='+escape(currentlyPlayingCollection)+'&currentlyPlayingVideoId='+currentlyPlayingVideoId,'popUpPlayer','height='+height+',width='+width+',left='+((screen.width-Number(width))/2)+',top='+(screen.height-Number(height))/2+',resizable=yes,scrollbars=no,toolbar=no,status=no');},getJSON:function(id){var url='/api-video/get_video_info.asp?guid='+id;url+='&fields=all';var params={context:this,handleAs:"json",sync:true,responseType:"application/json",callback:this.handleGetJSON,errorCallback:function(){console.error("Failed while executing video.Video.getJSON");}};dj.util.Video.getVideoData(url,params);this.microPlayersObjects[id]=this.jsonData;return dojo.toJson(this.jsonData);},handleGetJSON:function(json){this.jsonData=json;var adZone=new dj.util.Ads().getRegisteredAdsZone('');if(adZone!='default'&&adZone!=''){this.jsonData.adZone=adZone;}
this.jsonData.emailPartnerID=110626;this.jsonData.site=this.site;this.jsonData.msrc=this.msrc;this.jsonData.adFrmt="frmt=0;";this.jsonData.playerName="video_articleembed";this.jsonData.videoCenterURL="http://"+window.location.host+"/video-center";this.jsonData.embedPlayerURL=this.flashPlayerPath+"microPlayer.swf";this.jsonData.embedConfigURL=this.embedConfigURL;this.jsonData.embedPlayerID="1000";this.jsonData.embedName="microflashPlayer";this.jsonData.embedBaseURL=this.flashPlayerPath;this.jsonData.embedHeight=180;this.jsonData.embedWidth=272;this.jsonData.larsID=91;this.jsonData.larsAdTrackingID=1259;this.jsonData.prop5=window.location.href.split('?')[0];this.jsonData.prop6=window.location.href;this.jsonData.prop10=this.videoUtil.getUrlParam(window.location.href,'mod');this.jsonData.campaign=this.videoUtil.getUrlParam(window.location.href,'mod');this.jsonData.prop11=this.videoUtil.getUrlParam(window.location.href,'reflink');this.jsonData.prop19="video_emb";this.jsonData.prop24=this.prop24;this.jsonData.prop25=this.prop25;this.jsonData.prop27=this.prop27;var subSecComponent=this.videoUtil.omnitureEncoding(this.jsonData['wsj-section'],this.jsonData['wsj-subsection'],'s');var secComponent=this.videoUtil.omnitureEncoding(this.jsonData['wsj-section'],this.jsonData['wsj-subsection'],'c');this.jsonData.prop2="WSJ_"+secComponent;this.jsonData.prop3="WSJ_Video_Video_"+secComponent;this.jsonData.prop22="WSJ_Video_Video_"+subSecComponent;this.jsonData.prop26="WSJ_"+subSecComponent;this.jsonData.emailURL=this.emailURL;var suprsAd=(pID&&pID.indexOf('0_0_WH')!=-1)?'1':'0';this.jsonData.suppressAds=suprsAd;}});dojo.provide("dj.widget.video.controller.Player");dojo.require("dj.lang");dojo.require("dj.util.Observer");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.Omniture");dojo.require("dj.util.Cookie");dojo.require("dj.util.Page");dojo.require("dj.widget.video.model.PlayerTypes");dojo.require("dj.module.video.taboolaVideo");dojo.declare("dj.widget.video.controller.Player",null,{DEFAULT_CONFIG:{flashPlayerPath:"/media/swf/",playerType:dj.widget.video.model.PlayerTypes.MainPlayer,containerID:"videoPlayer",descriptionID:"videoPlayerDescription",playerID:"",videoAPIURL:"/api-video/get_video_info.asp",embedConfURL:"http://wsj.vo.llnwd.net/o28/players/",eventNamespace:"",host:location.host,applications:["video","video_popup","video_tab","video_emb","video_home"],applicationID:0,loadWaitTime:1000,loadWaitCount:10,dataset:{},adFormat:"frmt=2;",videoPageValue:'videoPlay',videotrackId:'',enableVideoModuleChaining:0},constructor:function(obs,userConfiguration){this.observer=(obs||new dj.util.Observer(dj.widget.video.VideoPlayer));this.configuration=dojo.mixin(dojo.clone(this.DEFAULT_CONFIG),userConfiguration);this.videoInformation={};this.seekTime=null;this.view=null;this.readyForEvents=false;this.playedOn=null;var siteFromUrl=dj.util.Page.getQueryParam("site");var siteFromContext="";try{siteFromContext=dj.context.videoCenter.host;}catch(e){console.error("{Player} error while getting site value from context. ",e.message);}
this.site=(siteFromUrl)?siteFromUrl:siteFromContext;this.msrc=dj.util.Page.getQueryParam("msrc");},init:function(view,videoID,seekTime,lineup){if(seekTime){this.seekTime=seekTime;}
this.view=view;if(lineup&&lineup!=''){this.playedOn=lineup;}
this.view.init(this);if(videoID){if(lineup&&lineup!=''){this.playVideo(videoID,lineup);}else{this.playVideo(videoID);}}
this.loadRetriesLeft=this.configuration.loadWaitCount;},playVideo:function(videoID,playedOn){if(playedOn){this.playedOn=playedOn;}
this.loadRetriesLeft=this.configuration.loadWaitCount;if(this.view.renderPreloader){this.view.renderPreloader();}
this.queryVideo(videoID);},queryVideo:function(videoID){var that=this;var requestURL=this.configuration.videoAPIURL+"?guid="+videoID+"&fields=all";dojo.xhrGet({url:requestURL,handleAs:"json",preventCache:true,headers:{"Accept":"application/json"},load:function(response,ioArgs){that.videoID=videoID;that.videoInformation=response;that.render();that.loadVideo();that.observer.fireByName("onVideoLoaded",videoID,response,that.playedOn);return response;},error:function(response,ioArgs){console.error("{Player} could not load video: '%s'. Response: %o",videoID,response);return response;}});},render:function(){return this.view.render();},loadVideo:function(){if(this.loadRetriesLeft==0){console.info("{Player} number of Load Retries expired");return;}
var that=this;if(this.readyForEvents){this._startPlaying();}else{this.loadRetriesLeft--;setTimeout(function(){that.loadVideo();},this.configuration.loadWaitTime);}},_startPlaying:function(){try{var canonicalURL=dj.context.core.urlPrefix+"/video/"+this.videoInformation.guid+".html";dj.module.video.taboolaVideo.notifyDynamicLoad(canonicalURL,canonicalURL,this.configuration.videotrackId,this.configuration.videoPageValue);}catch(e){console.log("Error while Taboola notification, ignore if not a taboola recommended module: "+e);}
this.view.play(this.addVideoParameters(this.videoInformation));},videoPlayed:function(){},videoPaused:function(){},videoUnPaused:function(){},videoPopUp:function(){},getCurrentVideoID:function(){return this.videoID;},getVideoData:function(data){return this.videoInformation[data];},addVideoParameters:function(params){var wsjPrefix='WSJ_';if(!params){params={};}
if(this.seekTime){params.seekTime=this.seekTime;this.seekTime=null;}
params.emailPartnerID=110626;params.site=this.site;params.msrc=this.msrc;params.adFrmt=this.configuration.adFormat;params.playerName=this.view.configuration.name;params.embedPlayerURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath+this.configuration.playerType.swfFile;params.embedConfigURL=this.configuration.embedConfURL;params.embedPlayerID="1000";params.embedName=this.configuration.playerID;params.embedBaseURL=dj.context.core.cdnPrefix+this.configuration.flashPlayerPath;params.embedHeight=this.configuration.playerType.height;params.embedWidth=this.configuration.playerType.width;params.larsID=91;params.larsAdTrackingID=1259;if(this.playedOn){params.lineupID=unescape(this.playedOn).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");}
if(typeof setEdition==="function"){params.prop24=setEdition(dj.util.Region.getViewByRegion());}
params.prop27="";try{dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){if(subLoggedIn){dj.util.User.hasRole('WSJ-PRO',function(hasRole){if(hasRole){wsjPrefix='WSJPRO_';params.prop27='WSJ_proc_sub_yes';params.prop8='WSJ Professional Enterprise';params.prop9='premium';params.prop24='Edition_US_Professional_Consumer';}else{dj.util.User.hasRole('WSJ-ENT',function(hasRole){if(hasRole){wsjPrefix='WSJPRO_';params.prop27='WSJ_proe_sub_yes';params.prop8='WSJ Professional Enterprise';params.prop9='premium';params.prop24='Edition_US_Professional';}else{params.prop27='WSJ_sub_yes';}});}});}else{params.prop27='WSJ_mem_yes';}});}
else{if(params.cookieUserType===null||params.cookieUserType!=="subscribed"){params.prop27='WSJ_free';}
else{params.prop27='WSJ_reg_yes';}}});}catch(e){console.info(e);}
var subSecComponent=dj.util.VideoUtils.omnitureEncoding(params['wsj-section'],params['wsj-subsection'],'s');var secComponent=dj.util.VideoUtils.omnitureEncoding(params['wsj-section'],params['wsj-subsection'],'c');params.appName=wsjPrefix.substring(0,wsjPrefix.length-1);params.appType=this.configuration.applications[this.configuration.applicationID];params.section=secComponent;params.subsection=subSecComponent;params.prop2=wsjPrefix+secComponent;params.prop3=wsjPrefix+"Video_Video_"+secComponent;params.prop22=wsjPrefix+"Video_Video_"+subSecComponent;params.prop26=wsjPrefix+subSecComponent;params.prop5=window.location.href.split('?')[0];;params.prop6=window.location.href;params.prop10=dj.util.Page.getQueryParam("mod");params.campaign=dj.util.Page.getQueryParam("mod");params.prop11=dj.util.Page.getQueryParam("reflink");if(params.youtubeID){params.prop19=params.appType+"_youtube";}else{params.prop19=params.appType;}
params.prop25=dj.util.Cookie.getCookie('TR');try{params.cookieUserType=dj.util.Cookie.getCookie("user_type");}catch(e){console.error("cookie read error while fetching cookieUserType : "+e);}
var suprsAd=((typeof pID==="string")&&(pID.indexOf('0_0_WH')!=-1))?'1':'0';params.suppressAds=suprsAd;return params;}});dojo.provide("dj.widget.video.controller.MicroPlayer");dojo.require("dj.widget.video.controller.Player");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.Ads");dojo.declare("dj.widget.video.controller.MicroPlayer",dj.widget.video.controller.Player,{constructor:function(obs,userConfiguration){this.configuration.applicationID=3;this._events=dj.widget.video.model.PlayerEvents;},init:function(view,videoID,seekTime,reload){this.videoInformation.id=videoID;if(!reload){this._setupFlashToJsListeners();this._setupInternalEvents();}
this.inherited(arguments);},getEventNamespace:function(){return"dj.context.video.soloVideos['"+this.videoInformation.id+"']";},subscribeByName:function(eventName,callback,context){this.observer.subscribeByName(eventName,callback,context);},addVideoParameters:function(params){params=this.inherited(arguments);var adZone=(new dj.util.Ads()).getRegisteredAdsZone('');params.adZone=((adZone!='default')&&(adZone!=''))?adZone:params.adZone;params.adFrmt="frmt=0;";params.videoCenterURL="http://"+window.location.host+"/video-center";return params;},_setupInternalEvents:function(){this.observer.subscribeByName(this._events.continueLoadVideo,function(){this.readyForEvents=true;},this);this.observer.subscribeByName(this._events.openMicroPopUpPlayer,function(){this.view.openPopUpPlayer();},this);},_setupFlashToJsListeners:function(){var obs=this.observer,events=this._events,player={};for(var evName in events){if(events.hasOwnProperty(evName)){var evValue=events[evName];(function(name,value){player[name]=function(){obs.fireByName(value);};}(evName,evValue));}}
dojo.getObject("dj.context.video.soloVideos",true);dj.context.video.soloVideos[this.videoInformation.id]=player;}});dojo.provide("dj.widget.video.view.Mp4MicroPlayer");dojo.require("dj.widget.video.view.BasePlayer");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.VideoTracking");dojo.declare("dj.widget.video.view.Mp4MicroPlayer",dj.widget.video.view.BasePlayer,{renderPreloader:function(){this.oCnt=dojo.byId(this.controller.configuration.playerID);dojo.addClass(this.oCnt,this.configuration.preloaderClassName);},render:function(){if(this.playerCreated){return;}
this.playerCreated=true;var Ev=dj.widget.video.model.PlayerEvents;this.controller.observer.fireByName(Ev.continueLoadVideo);this.controller.observer.fireByName(Ev.playVideo);this.controller.readyForEvents=true;},play:function(parameters){dj.util.VideoTracking.fire(parameters);var videoUri=parameters.video320kMP4Url;if(!videoUri){console.error("{view.MicroPlayer} no videoUri specified");return;}
setTimeout(function(){document.location=videoUri;},500);}});dojo.provide("dj.widget.video.view.SwfMicroPlayer");dojo.require("dj.widget.video.view.BasePlayer");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.model.SWFPlayer");dojo.declare("dj.widget.video.view.SwfMicroPlayer",dj.widget.video.view.BasePlayer,{renderPreloader:function(){this.oCnt=dojo.byId(this.controller.configuration.playerID);console.log("this.oCnt:"+this.oCnt);console.log("this.configuration.preloaderClassName:"+this.configuration.preloaderClassName);dojo.addClass(this.oCnt,this.configuration.preloaderClassName);},render:function(){if(this.playerCreated){return;}
this.playerCreated=true;var conf=this.controller.configuration;var swfPlayer=new dj.widget.video.model.SWFPlayer();swfPlayer.id=conf.playerID;console.log("************ conf.playerID *********** "+conf.playerID);swfPlayer.swfURL=conf.flashPlayerPath+conf.playerType.swfFile;swfPlayer.containerID=conf.containerID;swfPlayer.width=conf.playerType.width;swfPlayer.height=conf.playerType.height;swfPlayer.host=conf.host;swfPlayer.allowPlayerPopup=1;if(dj.context.videoCenter.showHideVideoTools){swfPlayer.hideTools=dj.context.videoCenter.showHideVideoTools;}
swfPlayer.eventNamespace=this.controller.getEventNamespace();var playerEvents=dj.widget.video.model.PlayerEvents;for(var evName in playerEvents){if(playerEvents.hasOwnProperty(evName)){swfPlayer[evName]=evName;}}
this._wrapPlayerInContainer();this._replacePlayerWithSwf(swfPlayer);},play:function(parameters){this._playerObject=swfobject.getObjectById(this.controller.configuration.playerID);if(this._playerObject&&typeof this._playerObject.playVideo=="function"){this._playerObject.playVideo(dojo.toJson(parameters));this._pollForVideoEvents();}else{console.error("{Player} video Player still not loaded");}},openPopUpPlayer:function(){dj.util.VideoUtils.popUpPlayer({playLocation:Math.floor(swfobject.getObjectById(this.controller.configuration.playerID).getSeek()),collection:this.controller.getVideoData("wsj-section"),videoID:this.controller.getVideoData("id"),height:this.controller.configuration.playerType.height,width:this.controller.configuration.playerType.width});},_replacePlayerWithSwf:function(swfPlayer){dj.util.VideoUtils.createSWFPlayer(swfPlayer);},_wrapPlayerInContainer:function(){var oCnt=dojo.byId(this.controller.configuration.containerID),oCntPosition=dojo.position(oCnt),wrapper=document.createElement("div");var pos=dojo.position(oCnt);dojo.style(wrapper,{width:pos.w+"px",height:pos.h+"px"});dojo.addClass(wrapper,oCnt.className);dojo.place(wrapper,oCnt,"before");dojo.place(oCnt,wrapper,"first");},_pollForVideoEvents:function(){if(!this._playerObject||(typeof this._playerObject.getSeek!=="function")){return;}
var events=dj.widget.video.model.PlayerEvents,that=this,duration=this.controller.videoInformation.duration,pos=(that._playerObject.getSeek()||0),cnt=3,isPlay=true;clearInterval(this.ival);this.ival=setInterval(function(){if(typeof that._playerObject.getSeek!=="function"){clearInterval(that.ival);return;}
var newPos=that._playerObject.getSeek(),newCnt=(newPos===pos)?(cnt+1):0;if(isPlay){isPlay=false;that.controller.observer.fireByName(events.playVideo);console.log("Playing Video");}else if((cnt>3)&&(newCnt==0)){that.controller.observer.fireByName(events.unpauseVideo);}
cnt=newCnt;pos=newPos;if(cnt==3){if((duration-pos)<=1){that.controller.observer.fireByName(events.stopVideo);clearInterval(that.ival);}else{that.controller.observer.fireByName(events.pauseVideo);}}},250);},destructor:function(){clearInterval(this.ival);}});dojo.provide("dj.widget.video.view.Html5MicroPlayer");dojo.require("dj.widget.video.view.Mp4MicroPlayer");dojo.provide("dj.widget.video.model.PlayerEvents");dojo.require("dj.util.VideoUtils");dojo.declare("dj.widget.video.view.Html5MicroPlayer",dj.widget.video.view.Mp4MicroPlayer,{play:function(parameters){var videoUri=parameters.video320kMP4Url;if(!videoUri){console.error("{view.MicroPlayer} no videoUri specified");return;}
this._createVideoObject(parameters.videoStillURL,videoUri);this._subscribeToVideoEvents();dojo.removeClass(this.oCnt,this.configuration.preloaderClassName);dojo.empty(this.oCnt);dojo.place(this._video,this.oCnt);dj.util.VideoTracking.fire(parameters);this._playing=false;dj.util.VideoUtils.callThroughDispatch(function(){this._video.play();},this);},_createVideoObject:function(videoStillURL,videoUri){var pos=dojo.position(this.oCnt);this._video=dojo.create("video",{poster:videoStillURL,src:videoUri,controls:true,width:pos.w,height:pos.h});},_subscribeToVideoEvents:function(){var ev=dj.widget.video.model.PlayerEvents,ob=this.controller.observer;dojo.connect(this._video,"onplay",function(){ob.fireByName(ev.playVideo);});dojo.connect(this._video,"onpause",function(){ob.fireByName(ev.pauseVideo);});dojo.connect(this._video,"onended",function(){ob.fireByName(ev.stopVideo);});}});dojo.provide("dj.widget.video.MicroPlayer");dojo.require("dj.widget.video.controller.MicroPlayer");dojo.require("dj.util.Video");dojo.require("dj.util.VideoUtils");dojo.require("dj.widget.video.model.PlayerEvents");dojo.require("dj.widget.video.view.SwfMicroPlayer");dojo.require("dj.widget.video.view.Mp4MicroPlayer");dojo.require("dj.widget.video.view.Html5MicroPlayer");dojo.declare("dj.widget.video.MicroPlayer",null,{constructor:function(containerId,dataset){this.containerId=containerId;this.dataset=dataset;},loadVideo:function(){this._createView();this._createController();this._connectPageAndControllerEvents();this.dataset.guid=dj.util.VideoUtils.normalizeGuid(this.dataset.guid);var seekTime=0;this.controller.init(this.view,this.dataset.guid,seekTime);},reloadVideo:function(dataset){this.dataset=dataset;this.dataset.guid=dj.util.VideoUtils.normalizeGuid(this.dataset.guid);var seekTime=0;this.controller.init(this.view,this.dataset.guid,seekTime,true);},_createView:function(){if(dj.util.VideoUtils.hasValidFlashVersion()){this.view=new dj.widget.video.view.SwfMicroPlayer();}else if(dj.util.VideoUtils.isH264BaselineVideoSupported()){this.view=new dj.widget.video.view.Html5MicroPlayer();}else{this.view=new dj.widget.video.view.Mp4MicroPlayer();}},_createController:function(){this.controller=new dj.widget.video.controller.MicroPlayer(null,{containerID:this.containerId,playerID:this.containerId,playerType:this._getPlayerType(this.dataset.videoSize),dataset:this.dataset});},_getPlayerType:function(size){if(size==='E'){playerType=dj.widget.video.model.PlayerTypes.MicroPlayerE;}else if(size==='F'){playerType=dj.widget.video.model.PlayerTypes.MicroPlayerF;}else{playerType=dj.widget.video.model.PlayerTypes.MicroPlayer;}
return playerType;},_connectPageAndControllerEvents:function(){var guid=this.dataset.guid,events=dj.widget.video.model.PlayerEvents,Video=dj.util.Video;this.controller.subscribeByName(events.playVideo,function(){Video.playVideo(guid);});this.controller.subscribeByName(events.pauseVideo,function(){Video.pauseVideo(guid);});this.controller.subscribeByName(events.stopVideo,function(){Video.stopVideo(guid);});},destructor:function(){this.view.destructor();}});dojo.provide("dj.module.video.liveMicroPlayer");dojo.require("dj.util.liveWidget");dojo.require("dj.util.Element");dojo.require("dj.widget.video.MicroPlayer");dj.module.video.liveMicroPlayer={init:function(){if(this._isInit){return;}
this._isInit=true;this._setupLiveWidget();},destroy:function(){dj.util.liveWidget.unregister("video.MicroPlayer");},_setupLiveWidget:function(){dj.util.liveWidget.register("video.MicroPlayer",function(liveWidget,dataset){dojo.stopEvent(liveWidget.event);var id=dj.util.Element.identify(liveWidget.domNode);this._initMicroPlayer(id,dataset);},this);},_initMicroPlayer:function(id,dataset){var player=new dj.widget.video.MicroPlayer(id,dataset);player.loadVideo();}};
dojo.require("dojox.data.QueryReadStore");dojo.provide("dj.module.datastore.FINSReadStore");dojo.declare("dj.module.datastore.FINSReadStore",dojox.data.QueryReadStore,{_fetchItems:function(request,fetchHandler,errorHandler){var serverQuery=request.serverQuery||request.query||{};if(!serverQuery[this.searchAttr]||serverQuery[this.searchAttr].length<3){this._xhrFetchHandler("",request,fetchHandler,errorHandler);return;}
var lastQuery=this._lastServerQuery?this._lastServerQuery[this.searchAttr].toLowerCase():null;var currQuery=serverQuery[this.searchAttr].toLowerCase();if(lastQuery&&currQuery&&currQuery.length>lastQuery.length&&currQuery.match("^"+lastQuery)==lastQuery){for(var i=0;i<this._items.length;i++){if(!this._items[i].i[this.searchAttr].toLowerCase().match("^"+currQuery)){this._items.splice(i,1);i--;}}
var numRows=this._items.length;fetchHandler(this._items,request,numRows);this._numRows=numRows;this._lastServerQuery=dojo.mixin({},serverQuery);return;}
var xhrFunc=this.requestMethod.toLowerCase()=="post"?dojo.xhrPost:dojo.xhrGet;var xhrHandler=xhrFunc({url:this.url,content:serverQuery});xhrHandler.addCallback(dojo.hitch(this,function(data){this._xhrFetchHandler(data,request,fetchHandler,errorHandler);}));xhrHandler.addErrback(function(error){errorHandler(error,request);});this.lastRequestHash=new Date().getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=dojo.mixin({},serverQuery);},_filterResponse:function(data){var collection=data.split("\n");var jsonRep="{items:[";for(var index=0;index<collection.length;index++){if(collection[index]&&typeof collection[index]=="string"){jsonRep+=(index===0?"":",")+"{"+this.searchAttr+":\""+dojo.trim(dojo.regexp.escapeString(collection[index]))+"\"}";}}
jsonRep+="]}";data=dojo.fromJson(jsonRep);return data;}});
dojo.provide("dj.module.careers.AutoComplete");dojo.require("dijit.form.ComboBox");dojo.require("dj.module.datastore.FINSReadStore");dj.module.careers.AutoComplete={onEnter:function(ev){var key=ev.keyCode;if(key===dojo.keys.ENTER){this.simpleValidate(ev);}},simpleValidate:function(ev){var sub=(ev.srcElement||ev.target);var form=sub.form;var i;for(i=0;i<form.elements.length;i++){var element=form.elements[i];if(element.id!==""&&element.type==="text"){if(element.defaultValue===element.value){element.value="";}}}
sub.form.submit();},restore:function(ev){var field=(ev.srcElement||ev.target);if(field.value===""){field.value=field.defaultValue;dojo.removeClass(field,"textBox-focus");}else{dojo.addClass(field,"textBox-focus");}},erase:function(ev){var field=(ev.srcElement||ev.target);if(field.value===field.defaultValue){field.value="";}},init:function(params){var items=params.items||[];var i;dojo.connect(dojo.byId(params.validate),"onclick",this,"simpleValidate");for(i=0;i<items.length;i++){var store=new dj.module.datastore.FINSReadStore({url:items[i].url,doClientPaging:true,searchAttr:"q"});var combo=new dijit.form.ComboBox({store:store,hasDownArrow:false,pageSize:10,queryExpr:"${0}",searchDelay:500,searchAttr:store.searchAttr,name:items[i].name||"",value:items[i].value||""},items[i].id);var ele=dojo.byId(items[i].id);ele.defaultValue=ele.value;dojo.connect(ele,"onblur",this,"restore");dojo.connect(ele,"onfocus",this,"erase");dojo.connect(ele,"onkeypress",this,"onEnter");}}};if((document.URL.indexOf("wsj")>0||document.URL.indexOf("barrons")>0||document.URL.indexOf("smart")>0)&&document.URL.indexOf("jp")==-1&&document.URL.indexOf("cn")==-1&&document.URL.indexOf("jobs.wsj.com")==-1&&document.URL.indexOf("customercenter")==-1)dojo.provide("dj.widget.networkHat.hat");
hat={init:function(){this.currId=this.getSelectedProduct();this.partyHatMoreDropdown=document.getElementById("partyhat_more_dropdown");this.oHatFBButton=document.getElementById("hat_fb_button");this.oHatTwtButton=document.getElementById("hat_twt_button");if(window.addEventListener){this.partyHatMoreDropdown.addEventListener("click",this.moredropdown,false);typeof this.oHatFBButton!=="undefined"&&this.oHatFBButton&&this.oHatFBButton.addEventListener("click",this.showFacebookOverlay,false);window.addEventListener("click",
this.hideOverlays,false);typeof this.oHatTwtButton!=="undefined"&&this.oHatTwtButton&&this.oHatTwtButton.addEventListener("click",this.showTwitterOverlay,false)}else{this.partyHatMoreDropdown.attachEvent("onclick",this.moredropdown);typeof this.oHatFBButton!=="undefined"&&this.oHatFBButton&&this.oHatFBButton.attachEvent("onclick",this.showFacebookOverlay);document.attachEvent("onclick",this.hideOverlays);typeof this.oHatTwtButton!=="undefined"&&this.oHatTwtButton&&this.oHatTwtButton.attachEvent("onclick",
this.showTwitterOverlay)}},moredropdown:function(a){hat.hideFacebookOverlay();hat.hideTwitterOverlay();var b=hat.partyHatMoreDropdown.parentNode;if(b.className.match(/hat_dd_selected/))b.className=b.className.replace("hat_dd_selected","");else b.className+=" hat_dd_selected";hat.StopEvent(a)},hideMoreDropdown:function(){var a=hat.partyHatMoreDropdown.parentNode;if(a.className.match(/hat_dd_selected/))a.className=a.className.replace("hat_dd_selected","")},showFacebookOverlay:function(a){hat.hideOverlays();
this.oHatFBLikeOverlay=document.getElementById("fb_like_overlay");this.oHatFBLikeOverlay.className="hat_overlay hat_overlay_fb";if(!window.frames.facebook_iframe){var b=hat.facebookURL().split("|");fbULEle=document.createElement("ul");for(var c=0;c<b.length;c++){if(document.URL.indexOf("wallstreetjournal.de")>0)var d=hat.createLIElement(b[c].split(",")[1]+" auf Facebook","hat_fb_icon"),e="http://www.facebook.com/plugins/like.php?href=http://www.facebook.com/"+b[c].split(",")[0]+"&action=recommend&layout=button_count&send=false&show_faces=false&width=90&locale=de_DE";
else{d=hat.createLIElement(b[c].split(",")[1]+" on Facebook","hat_fb_icon");e="http://www.facebook.com/plugins/like.php?href=http://www.facebook.com/"+b[c].split(",")[0]+"&action=recommend&layout=button_count&send=false&show_faces=false&width=90"}e=hat.createIFRAMEElement("facebook_iframe",e,200,21);d.appendChild(e);fbULEle.appendChild(d)}this.oHatFBLikeOverlay.appendChild(fbULEle)}hat.StopEvent(a)},createLIElement:function(a,b){var c=document.createElement("li");h4Ele=document.createElement("h4");
c.appendChild(h4Ele);SpanEle=document.createElement("span");SpanEle.className="icon";SpanEle.setAttribute("id",b);h4Ele.appendChild(SpanEle);strNode=document.createTextNode(a);h4Ele.appendChild(strNode);return c},createIFRAMEElement:function(a,b,c,d){var e=document.createElement("IFRAME");e.setAttribute("name",a);e.setAttribute("id",a);e.setAttribute("src",b);e.setAttribute("frameBorder",0);e.style.width=c+"px";e.setAttribute("allowtransparency","true");e.setAttribute("scrolling","no");e.style.height=
d+"px";return e},hideFacebookOverlay:function(){this.oHatFBLikeOverlay=document.getElementById("fb_like_overlay");if(typeof this.oHatFBLikeOverlay!=="undefined"&&this.oHatFBLikeOverlay)this.oHatFBLikeOverlay.className="hat_overlay hat_overlay_fb hidden"},showTwitterOverlay:function(a){hat.hideOverlays();this.oHatTwtLikeOverlay=document.getElementById("twitter_overlay");this.oHatTwtLikeOverlay.className="hat_overlay hat_overlay_twitter";if(!window.frames.twitter_iframe){var b=hat.twitterURL().split("|");
twULEle=document.createElement("ul");for(var c=0;c<b.length;c++){if(document.URL.indexOf("wallstreetjournal.de")>0)var d=hat.createLIElement(b[c].split(",")[1]+" auf Twitter","hat_twt_icon"),e="http://platform.twitter.com/widgets/follow_button.html?screen_name="+b[c].split(",")[0]+"&show_count=true&show_screen_name=true&lang=de";else{d=hat.createLIElement(b[c].split(",")[1]+" on Twitter","hat_twt_icon");e="http://platform.twitter.com/widgets/follow_button.html?screen_name="+b[c].split(",")[0]+"&show_count=true&show_screen_name=true"}var f=
hat.createIFRAMEElement("twitter_iframe",e,250,21);f.setAttribute("src",e);d.appendChild(f);twULEle.appendChild(d)}this.oHatTwtLikeOverlay.appendChild(twULEle)}hat.StopEvent(a)},hideTwitterOverlay:function(){this.oHatTwtLikeOverlay=document.getElementById("twitter_overlay");if(typeof this.oHatTwtLikeOverlay!=="undefined"&&this.oHatTwtLikeOverlay)this.oHatTwtLikeOverlay.className="hat_overlay hat_overlay_twitter hidden"},facebookURL:function(){return this.currId.match(/wsj_asia/)?"wsjasia, WSJAsia":
this.currId.match(/wsj_india/)?"wsjindia, WSJ India":this.currId.match(/wsj_gm/)?"pages/The-Wall-Street-Journal-Deutschland/111293262305204, WSJDeutschland":this.currId.match(/wsj_eu/)?"pages/The-Wall-Street-Journal-Europe/124739154250536, WSJEurope":this.currId.match(/wsjpro_eu/)?"pages/The-Wall-Street-Journal-Europe/124739154250536, WSJEurope":this.currId.match(/wsjpro_asia/)?"wsjasia, WSJAsia":this.currId.match(/wsj_classroom/)?"wsjclassroom, WSJclassroom":this.currId.match(/wsj/)?"wsj, WSJ":this.currId.match(/bol/)?
"barronsonline, Barron's":this.currId.match(/mw/)?"marketwatch, Marketwatch":this.currId.match(/sm/)?"SmartMoney, SmartMoney":this.currId.match(/atd/)?"allthingsd, AllThingsD":this.currId.match(/fins/)?"FINSfinancecareers,FINS Finance|FINStechcareers,FINS Technology|FINSsalesmarketingcareers,FINS Sales & Marketing":this.currId.match(/fact/)?"DJFactiva,Factiva":"wsj, WSJ"},twitterURL:function(){return this.currId.match(/wsj_eu/)?"wsjeurope, WSJEurope":this.currId.match(/wsj_india/)?"wsjindia, WSJ India":
this.currId.match(/wsj_gm/)?"WSJDeutschland, WSJDeutschland":this.currId.match(/wsjpro_eu/)?"wsjeurope, WSJEurope":this.currId.match(/wsjpro_asia/)?"wsjasia, WSJAsia":this.currId.match(/wsj_classroom/)?"wsjclassroom, WSJclassroom":this.currId.match(/wsj_pro/)?"wsj, WSJ":this.currId.match(/wsj_jp/)?"WSJJapan, WSJJapan":this.currId.match(/wsj_ch/)?"wsjchina, WSJChina":this.currId.match(/wsj_asia/)?"wsjasia, WSJAsia":this.currId.match(/wsj_sp/)?"WSJAmericas, WSJAmericas":this.currId.match(/wsj/)?"wsj, WSJ":
this.currId.match(/bol/)?"barronsonline, Barron's":this.currId.match(/mw/)?"MarketWatch, MarketWatch":this.currId.match(/sm/)?"SmartMoney, SmartMoney":this.currId.match(/atd/)?"allthingsd, AllThingsD":this.currId.match(/fins/)?"FINSider,FINS Finance Careers|techFINSider,FINS Technology Careers|salesFINSider,FINS Sales Careers":this.currId.match(/fact/)?"factiva,Factiva":"wsj, WSJ"},getSelectedProduct:function(){var a=document.getElementById("hattabs").children;for(i=0;i<a.length;i++)if(a[i].className.match(/current/))return a[i].id;
return"hat_tab_wsj"},StopEvent:function(a){if(!a)if(window.event)a=window.event;else return;if(a.cancelBubble!=null)a.cancelBubble=true;a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();if(window.event)a.returnValue=false;if(a.cancel!=null)a.cancel=true},hideOverlays:function(){hat.hideFacebookOverlay();hat.hideTwitterOverlay();hat.hideMoreDropdown()}};hat.init();
dojo.provide("dj.widget.networkHat.infocomplete");function InfoComplete(){this.autoComplete=this.dataSource=null;this.count=0;this.allowexchanges=this.allowsymboltypes=this.allowcountries=this.domain="";this.currentQueryHasResultMatch=false;this.lastExactResult="";this.exactMatches=[];this.keyword=this.symbol=null}function autoCompleteTrim(a){return a.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1")}
InfoComplete.prototype.Setup=function(a){var b,c;if(!(typeof a=="undefined"||a===null)){b=0;for(c=a.sections.length;b<c;b++){var d=a.sections[b].dataSource.server;if(typeof d=="undefined"||d===null||d==="")return}document.getElementsByTagName("BODY");this.count=a.count;this.dataSource=[];b=0;for(c=a.sections.length;b<c;b++){d=a.sections[b];if(d.type=="keyword")this.keyword=b;else if(d.type=="symbol")this.symbol=b;var e=new YAHOO.widget.DS_XHR(d.dataSource.server,d.dataSource.schema);e.responseType=
d.dataSource.responseType;e.scriptQueryAppend=d.dataSource.scriptQueryAppend;e.index=b;e.dataErrorEvent.subscribe(this.handleError,e);this.dataSource[b]=e}this.autoComplete=new YAHOO.widget.MultiAutoComplete(a.inputId,a.containerId,this.dataSource);this.count=a.count;this.autoComplete.autoHighlight=false;this.autoComplete.maxResultsDisplayed=a.count;this.autoComplete.queryDelay=a.delay;this.autoComplete.allowBrowserAutocomplete=false;this.autoComplete.typeAhead=true;this.autoComplete.animVert=false;
this.autoComplete.animHoriz=false;this.autoComplete.delimChar=",";this.autoComplete.setHeader('Choose a quote match or "GO" to get quote news');this.autoComplete.setFooter("Separate multiple symbols with commas (,)");this.autoComplete.formatResult=function(f,k,p){return a.sections[p].formatFunc(f,k,p,this)};this.autoComplete.dataReturnEvent.subscribe(this.checkResultsForExactMatch,this.autoComplete,this);this.autoComplete.textboxKeyEvent.subscribe(this.checkPastExactResults,this.autoComplete,this)}};
InfoComplete.prototype.getFirstDelimChar=function(){if(this.autoComplete.delimChar&&this.autoComplete.delimChar.length>0)return this.autoComplete.delimChar[0];return""};
InfoComplete.prototype.isSymbolMatch=function(){var a=this.getFirstDelimChar();if(this.currentQueryHasResultMatch===true&&this.lastExactResult.toUpperCase()==autoCompleteTrim(this.autoComplete._oTextbox.value).replace(/,$|\.,$/,"").toUpperCase())return true;a=this.autoComplete._oTextbox.value.split(a);for(var b=0;b<this.exactMatches.length;b++)for(var c=0;c<a.length;c++)if(this.exactMatches[b]==a[c])return true;return this.doesListHaveMatch(0)};
InfoComplete.prototype.handleError=function(a,b){var c=b[1];c._populateStaging&&c._populateStaging("null",null,c,b[0].index)};
InfoComplete.prototype.checkPastExactResults=function(a,b){if("function"==typeof this.getFirstDelimChar){var c=this.getFirstDelimChar();if(b[0]._oTextbox.value.length>0&&b[0]._oTextbox.value.lastIndexOf(c)==b[0]._oTextbox.value.length-1&&this.currentQueryHasResultMatch){if(this.exactMatches.length>0)for(c=0;c<this.exactMatches.length;c++)if(this.exactMatches[c]==this.lastExactResult)return;this.exactMatches.push(this.lastExactResult)}}};
InfoComplete.prototype.checkResultsForExactMatch=function(a,b){if(!(!b||b.length<4||b[3]>0)){var c=this.getFirstDelimChar(),d=b[2],e=b[0]._oTextbox.value;if(e.indexOf(c)>0){e=e.split(c);e=autoCompleteTrim(e[e.length-1])}if(d&&d.length>0)for(c=0;c<d.length;c++)if(d[c]&&d[c][0]!==null){var f=d[c][0];if(e.toUpperCase()==f.toUpperCase()){this.currentQueryHasResultMatch=true;this.lastExactResult=e;return}}this.currentQueryHasResultMatch=false}};
InfoComplete.prototype.doesListHaveMatch=function(a){var b=this.getFirstDelimChar(),c=this.autoComplete.getListItems(),d=autoCompleteTrim(this.autoComplete._oTextbox.value).replace(/,$|\.,$/,"");if(d.indexOf(b)>0){d=d.split(b);d=autoCompleteTrim(d[d.length-1])}if(a<c.length){a=c[a];for(c=0;c<a.length;c++)if(a[c]&&a[c]._oResultData)if(d.toUpperCase()==a[c]._oResultData[0].toUpperCase())return true}return false};
function param(){this.array=Array(1);this.setValue=function(a){this.array[0]=a};this.getValue=function(){return this.array[0]}}function InstallLibrary(a){a=a||window;a.symbolComplete=new InfoComplete;a.InfoComplete=new InfoComplete}InstallLibrary();
dojo.provide("dj.widget.networkHat.AutoComplete");dojo.require("dj.widget.networkHat.infocomplete");dojo.require("dj.lang");dojo.getObject("dj.context.networkHat",true);
(function(){var a=dj.widget.networkHat;(a.AutoComplete=function(){this.d=document;this.cdnDomain=dj.context.core.cdnPrefix;this.uP="";if(typeof uP!="undefined")this.uP=uP;var b=new Date;b=""+b.getFullYear()+b.getMonth()+b.getDay();this.jScript=this.d.location.host.indexOf("s.dev")!=-1||this.d.location.host.indexOf("idev")!=-1?this.uP+"/djscript/j_networkHat-"+b+".js":this.cdnDomain+"/djscript/j_networkHat-"+b+".js";this.d.getElementsByTagName("div")[0].className.indexOf("subType-subscribed");this.inputDefaultText=
"News, Quotes, Companies, Videos";if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.inputDefaultText!==undefined)this.inputDefaultText=dj.autocompletesearch.inputDefaultText;b=dojo.byId("hat_div");this.oHatInput=dojo.byId("hat_input_auto");dojo.query(".hat_select",b);if(dojo.isIE&&(this.d.domain.indexOf("ds.sat.wsj.com")!=-1||this.d.domain.indexOf("ds.wsj.com")!=-1))dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");this.onfocusLoad=dojo.connect(this.oHatInput,"onfocus",
this,this.onHatLoad);this.onmouseoverLoad=dojo.connect(this.oHatInput,"onmouseover",this,this.onHatLoad);this.onclickClear=dojo.connect(this.oHatInput,"onclick",this,this.clearField);this.onkeydownClear=dojo.connect(this.oHatInput,"onkeydown",this,this.clearField);if(this.oHatInput.value!==""&&this.oHatInput.value!=this.inputDefaultText||dj.context.networkHat.jnetworkHatJsLoaded)this.onHatLoad();this.setFieldDefault()}).prototype={setFieldDefault:function(){if(this.oHatInput.value===""){this.oHatInput.value=
this.inputDefaultText;dojo.addClass(this.oHatInput,"unUsed")}},clearField:function(){this.stopObservingClick();if(dojo.hasClass(this.oHatInput,"unUsed"))this.oHatInput.value="";dojo.removeClass(this.oHatInput,"unUsed")},stopObservingClick:function(){dojo.disconnect(this.onclickClear);dojo.disconnect(this.onkeydownClear)},onHatLoad:function(){dojo.disconnect(this.onfocusLoad);dojo.disconnect(this.onmouseoverLoad);if(dj.context.networkHat.jnetworkHatJsLoaded)this.initInfoComplete();else{var b;if(!this.d.getElementsByTagName("head")){b=
new Element("head");this.d.getElementsByTagName("body")[0].appendChild(b)}this.jsNode=this.loadAutoCompleteScript(this.jScript)}},loadAutoCompleteScript:function(b){var c=this.d.createElement("script");c.type="text/javascript";c.src=b;if(this.d.getElementsByTagName("head").length===0){b=this.d.createElement("head");this.d.getElementsByTagName("html")[0].appendChild(b)}this.d.getElementsByTagName("head")[0].appendChild(c);return c},initInfoComplete:function(){if(dojo.isIE&&(this.d.domain.indexOf("ds.sat.wsj.com")!=
-1||this.d.domain.indexOf("ds.wsj.com")!=-1))dj.util.Url.addStylesheet("http://s.wsj.net/css/hatIEPortfolio.css");typeof dj.header!="undefined"&&typeof dj.header.autocomplete!="undefined"&&dj.header.autocomplete=="NEW"?initInfoCompleteNew():initInfoComplete();this.stopObservingClick();dojo.connect(this.oHatInput,"onfocus",null,function(){this.style.backgroundImage="url('http://s.wsj.net/img/b.gif')";searchFieldOnFocus(this);setFocused(this)});dojo.connect(this.oHatInput,"onkeypress",null,function(){showHideCRDrpdwn("hide")});
dojo.connect(this.oHatInput,"onblur",null,function(){showHideCRDrpdwn("show")});var b=this.oHatInput.value;if(InfoComplete.autoComplete.dataSources&&InfoComplete.autoComplete.dataSources.length>=2)InfoComplete.autoComplete.dataSources[1].scriptQueryParam="query";b&&b!=this.inputDefaultText&&InfoComplete.autoComplete.sendQuery(b)}}})();
dojo.provide("dj.widget.networkHat.global_autocomplete");dojo.require("dj.widget.networkHat.infocomplete");dojo.require("yui.yui-2.5.2");var baseDomain=typeof window.nSP=="undefined"||nSP==null?"http://"+document.domain:nSP;
InfoCompleteConfig=function(a,b,c){this.count=8;this.delay=0.05;this.SCkey="88DF4730C6A6550285F22ED26514254A16E53C6A8725A61E0F11CFE5384904E7E6E29DBAC369DCB18FCDF8715405601FA73B9FE9CBB5D7B0DBBC636B2F74DE9D6724596AEA605596E1CFE155A5F14A962956795C2DF7D2680FE0712A193D9C0692EB8865";this.allowsymboltypes=this.allowexchanges=this.allowcountries="";this.inputId=a||"";this.containerId=b||"";this.buttonId=c||"";this.sections=[];this.initSymbol=function(d){this.sections[this.sections.length]={type:"symbol",
dataSource:{server:"/api/djSymbolComplete/GetSymbolsJSON.ashx",schema:["Results","Symbol","Name","CountryCode","Exchange","DjUrl"],responseType:YAHOO.widget.DS_XHR.TYPE_JSON,scriptQueryAppend:"count="+this.count+"&license="+this.SCkey+"&allowcountries="+this.allowcountries+"&allowexchanges="+this.allowexchanges+"&allowtypes="+this.allowsymboltypes+"&deprecateexchange=PINKSH,NNOTC,NASDBB"},formatFunc:d,subHeader:null};return this};this.initKeyword=function(d){this.sections[this.sections.length]={type:"keyword",
dataSource:{server:"/api/djKeywordcomplete/GetKeywordsJSON.ashx",schema:["Results","Word","Rank"],responseType:YAHOO.widget.DS_XHR.TYPE_JSON,scriptQueryAppend:"count="+this.count+"&license="+this.SCkey},formatFunc:d,subHeader:'<div class="subHeading">Choose a topic to search news:</div>'};return this}};
function initInfoComplete(a,b){var c=b||window.InfoComplete;if(c){var d;d=dj.autocompletesearch!==undefined&&dj.autocompletesearch.onlySymbol===true?a||(new InfoCompleteConfig(searchBoxID,resultContainerID,searchGoButtonID)).initSymbol(formatSymbolCompleteResult):a||(new InfoCompleteConfig(searchBoxID,resultContainerID,searchGoButtonID)).initSymbol(formatSymbolCompleteResult).initKeyword(formatKeywordCompleteResult);c.Setup(d);if(typeof c.autoComplete=="undefined"||c.autoComplete==null){var e=YAHOO.util.Dom.get(d.inputId),
f=YAHOO.util.Dom.get(d.buttonId);e.setAttribute("onchange","");YAHOO.util.Event.addListener(f,"click",submitSymbolOrSearch);d="keypress";if(YAHOO.util.Event.isIE)d="keydown";YAHOO.util.Event.addListener(e,d,function(q){if(q.keyCode==13)submitSymbolOrSearch(q);else window.gotSymbolReply=false})}else{if(window.JSON&&window.JSON.deserialize)window.JSON.parse=window.JSON.deserialize;e=YAHOO.util.Dom.get(d.inputId);f=YAHOO.util.Dom.get(d.buttonId);c.autoComplete.setHeader("");c.autoComplete.setFooter("");
for(var k=0,p=d.sections.length;k<p;k++)typeof d.sections[k].subHeader!="undefined"&&d.sections[k].subHeader!=null&&c.autoComplete.setSubHeader(d.sections[k].subHeader,k);c.autoComplete.dataReturnEvent.subscribe(updateSearchTerm,this);e.setAttribute("onchange","");c.autoComplete.itemSelectEvent.subscribe(function(){dojo.hasClass(e,"acExactMatch")||dojo.addClass(e,"acExactMatch")},this);dojo.connect(e,"onkeypress",null,function(q){if(q){var s;s=window.event?window.event.srcElement:q.currentTarget;
q.keyCode!==13&&dojo.removeClass(s,"acExactMatch");matchedSymbolCompInfo=[]}});c.autoComplete.itemSelectEvent.subscribe(submitSymbolOrSearch,c);YAHOO.util.Event.addListener(f,"click",function(q){submitSymbolOrSearch(q,null,c)});d="keypress";if(YAHOO.util.Event.isIE)d="keydown";YAHOO.util.Event.addListener(e,d,function(q){if(q.keyCode==13)submitSymbolOrSearch(q,null,c);else window.gotSymbolReply=false})}}}
function updateSearchTerm(){window.gotSymbolReply=true;var a=YAHOO.util.Dom.get("symbolCompleteSearchTerm");if(a)a.innerHTML=YAHOO.util.Dom.get(searchBoxID).value}function updateSearchTerm(){window.gotSymbolReply=true;var a=YAHOO.util.Dom.get("symbolCompleteSearchTerm");if(a)a.innerHTML=YAHOO.util.Dom.get(searchBoxID).value}var submittedSymbolOrSearch=false;
function doOpenWindow(a){if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.target==="_blank")window.open(a);else window.location=a}function getSubmittedSearchStatus(){if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.target==="_blank")return false;return submittedSymbolOrSearch}
function submitSymbolOrSearch(a,b,c){var d=c.autoComplete._oTextbox.id;if(typeof c.autoComplete=="undefined"||c.autoComplete==null){YAHOO.util.Event.stopEvent(a);if(!getSubmittedSearchStatus()){var e=YAHOO.util.Dom.get(d);checkUnUsed(e);if(validateQuoteSearchBox(e)){submittedSymbolOrSearch=true;if(a=isSearchOverride(e.value))doKeyWordSearch(e.value);else if(isIndex(e.value,d)){if(matchedSymbolCompInfo&&matchedSymbolCompInfo[4]){b=matchedSymbolCompInfo[4];doOpenWindow(b)}}else if(!window.gotSymbolReply&&
e.value.length<=5&&!a||isQuoteInput(e.value,c))if(e.value.length==5&&!isMutualFund(e.value))doKeyWordSearch(e.value);else b&&b[2]&&b[2][4]?doViewQuote(e.value,b[2][4]):doViewQuote(e.value);else doKeyWordSearch(e.value)}}}else{YAHOO.util.Event.stopEvent(a);if(!getSubmittedSearchStatus()){e=YAHOO.util.Dom.get(d);checkUnUsed(e);var f=false;if(c.autoComplete._bItemSelected||a&&a=="itemSelect")f=true;var k=-1;if(b&&b[1])k=b[1]._nDataSourceIndex;if(validateQuoteSearchBox(e)){submittedSymbolOrSearch=true;
a=isSearchOverride(e.value);if(k==c.symbol)b&&b[2]&&b[2][4]?doViewQuote(e.value,b[2][4]):doViewQuote(e.value);else if(k==c.keyword||a)doKeyWordSearch(b?b[2][0].toLowerCase():e.value);else if(isIndex(e.value,d)){if(matchedSymbolCompInfo&&matchedSymbolCompInfo[4]){b=matchedSymbolCompInfo[4];doOpenWindow(b)}}else if(!window.gotSymbolReply&&e.value.length<=5&&!a||f&&k==c.symbol||isQuoteInput(e.value,c))if(e.value.length==5&&!isMutualFund(e.value))doKeyWordSearch(e.value);else b&&b[2]&&b[2][4]?doViewQuote(e.value,
b[2][4]):doViewQuote(e.value);else doKeyWordSearch(e.value)}}}}function isMutualFund(a){a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.match(/[X|Y]$/);return a!=null&&a.length>0&&a[0].length>0}function isIndex(a,b){if(dojo.hasClass(b,"acExactMatch"))if(matchedSymbolCompInfo&&matchedSymbolCompInfo[0]&&matchedSymbolCompInfo[3]){var c=matchedSymbolCompInfo[0],d=c;if(c.indexOf("(")!==-1)d=c.substring(0,c.indexOf("("));if(a.toUpperCase()===d)return matchedSymbolCompInfo[3]==="INDEXES"}return false}
function isSearchOverrideold(a){a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.replace(/,+/gi,"");a=a.match(/^PUTIN$|^OBAMA$|^CHINA$|^FBI$|^CIA$|^FDA$/);return a!=null&&a.length>0&&a[0].length>0}
function isSearchOverride(a){var b=false;a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.replace(/,+/gi,"");if(typeof window.keywordException!="undefined"&&keywordException!=null&&keywordException.length>0)for(var c=keywordException.length,d=0;d<c;d++){var e=keywordException[d];e=e.replace(/^\s+|\s+$/g,"").toUpperCase();if(e==a)b=true}return b}
function doExchangeCountryMap(a){var b={};b.US="U.S.";b["SAO PAULO"]="Brazil";b.TOR="Canada: Toronto";b.CSEC="Venezuela";b.ASX="Australia";b.SHSE="China: Shanghai";b.SSE="China: Shenzhen";b.HKSE="Hong Kong";b.TSE="Japan";b.KLSE="Malaysia";b.NZSE="New Zealand";b.SES="Singapore";b.TWSE="Taiwan";b.BRUX="Belgium";b.COPN="Denmark";b.TALLINN="Estonia";b.HELS="Finland";b.PARB="France";b.FRNK="Germany: Frankfurt";b.XETRA="Germany: Xetra";b.REYKJAVIK="Iceland";b.DUBLIN="Ireland";b.MILAN="Italy";b.RIGA="Latvia";
b.LITHUANIA="Lithuania";b.AMS="Netherlands";b.OSLO="Norway";b.SIBE="Spain";b.STKM="Sweden";b.ZSE="Switzerland";b.LONDON="U.K.";b.VTX="Switzerland";b.PINKSH="U.S.: Pink Sheets";b.NNOTC="U.S.: Other OTC";b.NASDBB="U.S.: OTCBB";b.XTSX="Canada: TSX Venture";b.BOMBAY="India: Bombay";b.BSE="Hungary";b.LISBON="Portugal";b.SET="Thailand";b.VIENNA="Austria";b.JSX="Indonesia";b.JOBG="South Africa";b.PRAGUE="Czech Republic";b.ATHENS="Greece";b.PHP="Philippines";b.WSE="Poland";b.ISE="Turkey";b.SANSE="Chile";
b.HAMB="Germany: Hamburg";b.MNCH="Germany: Munich";b.DUSS="Germany: Dusseldorf";b.MXSE="Mexico";b.KSE="South Korea";return b[a]}
function doExchangeTypeMap(a){var b={};b.US="usstock usfund";b["SAO PAULO"]="brsp";b.TOR="tse";b.CSEC="vecsec";b.ASX="auasx";b.SHSE="shse";b.SSE="sse";b.HKSE="hkse";b.TSE="jptse";b.KLSE="myklse";b.NZSE="nzse";b.SES="sgses";b.TWSE="twtwse";b.BRUX="bebrux";b.COPN="copn";b.TALLINN="tallinn";b.HELS="hels";b.PARB="frparb";b.FRNK="defrnk";b.XETRA="dexetra";b.REYKJAVIK="reykjavik";b.DUBLIN="iedublin";b.MILAN="itmilan";b.RIGA="riga";b.LITHUANIA="lithuania";b.AMS="nlams";b.OSLO="nooslo";b.SIBE="escats";b.STKM=
"sestkm";b.ZSE="chzse";b.LONDON="lse";b.VTX="virtx";b.PINKSH="pinksh";b.NNOTC="nnotc";b.NASDBB="nasdbb";b.XTSX="xtsx";b.BOMBAY="xbom";b.BSE="xbud";b.LISBON="xlis";b.SET="xbkk";b.VIENNA="xwbo";b.JSX="xidx";b.JOBG="xjse";b.PRAGUE="xpra";b.ATHENS="xath";b.PHP="xphs";b.WSE="xwar";b.ISE="xist";b.SANSE="xsgo";b.HAMB="xham";b.MNCH="xmun";b.DUSS="xdus";b.MXSE="xmex";b.KSE="xkrx";return b[a]}
function doViewQuote(a,b){a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/,+/gi,",");a=a.replace(/,$|\.,$/,"");if(a.match(",")){var c=a.split(","),d="",e="";for(i=0;i<c.length;i++){tempSymb=c[i];tempEx="";if(c[i].indexOf("(")>0){tempSymb=c[i].substring(0,c[i].indexOf("("));tempEx=c[i].substring(c[i].indexOf("(")+1,c[i].length-1)}else tempEx="US";tempSymb=tempSymb.replace(/^\s+|\s+$/g,"");d=d+tempSymb+",";e=e+doExchangeTypeMap(tempEx)+","}d=d.substring(0,d.length-1);e=e.substring(0,e.length-1);d=d.replace(/\+/g,
"%2B");c=baseDomain+(loggedIn?"":"/public")+"/quotes/main.html?symbol="+d+"&type="+e+"&mod=DNH_S";if(e=="xtsx")c=dj.context.core.quotesUrlPrefix+"/ca/"+e+"/"+d+"&mod=DNH_S";else if(e=="xbom")c=dj.context.core.quotesUrlPrefix+"/in/"+e+"/"+d+"&mod=DNH_S";else if(e=="xbud")c=dj.context.core.quotesUrlPrefix+"/hu/"+e+"/"+d+"&mod=DNH_S";else if(e=="xlis")c=dj.context.core.quotesUrlPrefix+"/pt/"+e+"/"+d+"&mod=DNH_S";else if(e=="xwbo")c=dj.context.core.quotesUrlPrefix+"/at/"+e+"/"+d+"&mod=DNH_S";else if(e==
"xbkk")c=dj.context.core.quotesUrlPrefix+"/th/"+e+"/"+d+"&mod=DNH_S";else if(e=="xidx")c=dj.context.core.quotesUrlPrefix+"/id/"+e+"/"+d+"&mod=DNH_S";else if(e=="xjse")c=dj.context.core.quotesUrlPrefix+"/za/"+e+"/"+d+"&mod=DNH_S";else if(e=="xpra")c=dj.context.core.quotesUrlPrefix+"/cz/"+e+"/"+d+"&mod=DNH_S";else if(e=="xath")c=dj.context.core.quotesUrlPrefix+"/gr/"+e+"/"+d+"&mod=DNH_S";else if(e=="xphs")c=dj.context.core.quotesUrlPrefix+"/ph/"+e+"/"+d+"&mod=DNH_S";else if(e=="xwar")c=dj.context.core.quotesUrlPrefix+
"/pl/"+e+"/"+d+"&mod=DNH_S";else if(e=="xist")c=dj.context.core.quotesUrlPrefix+"/tr/"+e+"/"+d+"&mod=DNH_S";else if(e=="xsgo")c=dj.context.core.quotesUrlPrefix+"/cl/"+e+"/"+d+"&mod=DNH_S";else if(e=="xham")c=dj.context.core.quotesUrlPrefix+"/de/"+e+"/"+d+"&mod=DNH_S";else if(e=="xmun")c=dj.context.core.quotesUrlPrefix+"/de/"+e+"/"+d+"&mod=DNH_S";else if(e=="xdus")c=dj.context.core.quotesUrlPrefix+"/de/"+e+"/"+d+"&mod=DNH_S";else if(e=="xmex")c=dj.context.core.quotesUrlPrefix+"/mx/"+e+"/"+d+"&mod=DNH_S";
else if(e=="xkrx")c=dj.context.core.quotesUrlPrefix+"/kr/"+e+"/"+d+"&mod=DNH_S"}else{e="US";d=a;if(a.indexOf("(")>0){d=a.substring(0,a.indexOf("("));e=a.substring(a.indexOf("(")+1,a.length-1)}d=d.replace("+","%2B");c=baseDomain+(loggedIn?"":"/public")+"/quotes/main.html?symbol="+d+"&type="+doExchangeTypeMap(e)+"&mod=DNH_S";if(doExchangeTypeMap(e)=="xtsx")c=dj.context.core.quotesUrlPrefix+"/CA/XTSX/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xbom")c=dj.context.core.quotesUrlPrefix+"/IN/XBOM/"+
d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xbud")c=dj.context.core.quotesUrlPrefix+"/HU/XBUD/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xlis")c=dj.context.core.quotesUrlPrefix+"/PT/XLIS/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xwbo")c=dj.context.core.quotesUrlPrefix+"/AT/XWBO/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xbkk")c=dj.context.core.quotesUrlPrefix+"/TH/XBKK/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xidx")c=dj.context.core.quotesUrlPrefix+"/ID/XIDX/"+d+"&mod=DNH_S";
else if(doExchangeTypeMap(e)=="xjse")c=dj.context.core.quotesUrlPrefix+"/ZA/XJSE/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xpra")c=dj.context.core.quotesUrlPrefix+"/CZ/XPRA/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xath")c=dj.context.core.quotesUrlPrefix+"/GR/XATH/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xphs")c=dj.context.core.quotesUrlPrefix+"/PH/XPHS/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xwar")c=dj.context.core.quotesUrlPrefix+"/PL/XWAR/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)==
"xist")c=dj.context.core.quotesUrlPrefix+"/TR/XIST/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xsgo")c=dj.context.core.quotesUrlPrefix+"/CL/XSGO/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xmun")c=dj.context.core.quotesUrlPrefix+"/DE/XMUN/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xham")c=dj.context.core.quotesUrlPrefix+"/DE/XHAM/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xdus")c=dj.context.core.quotesUrlPrefix+"/DE/XDUS/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xmex")c=dj.context.core.quotesUrlPrefix+
"/MX/XMEX/"+d+"&mod=DNH_S";else if(doExchangeTypeMap(e)=="xkrx")c=dj.context.core.quotesUrlPrefix+"/KR/XKRX/"+d+"&mod=DNH_S";if(e==="INDEXES")c=b}doOpenWindow(c)}function doKeyWordSearch(a){a=a.replace(/^\s+|\s+$/g,"").replace(/,$|\.,$/,"");a=baseDomain+"/search/term.html?KEYWORDS="+escape(a)+"&mod=DNH_S";doOpenWindow(a)}
function doRedirectMDC(a){a=a.replace(/^\s+|\s+$/g,"").replace(/,$|\.,$/,"");a=a.toLowerCase();baseDomain="http://online.wsj.com";var b=false,c=a.match(/^ftse$|^dax$|^cac 40$|^jsx$/);if(c!=null&&c.length>0&&c[0].length>0)b=true;a=a.replace("util","djua");a=a.replace("tran","djta");a=a.replace("gspc","spx");a=a.replace("compq","comp");a=a.replace("nysi","nya");a=a.replace("amsi","xax");a=a.replace("sox","soxx");a=a.replace("ftse","uk:ftse100");a=a.replace("dax","dx:1876534");a=a.replace("cac 40","fr:px1");
a=a.replace("jsx","1803554");doOpenWindow(baseDomain+"/mdc/public/npage/2_3050.html?symb="+a+(b?"&page=intl":"")+"&mod=DNH_S")}function addMoreResultsLink(a,b,c){a="";c.setSubHeader('<div class="subHeading">Choose a symbol match to get quote:</div>',b)}
function formatKeywordCompleteResult(a,b){var c=RegExp("\\b("+b+")(.*)\\b","i"),d=a[0].toLowerCase();a[0]=d;if(d.length>80)d=d.substring(0,80);if(d.match(c))d=d.replace(c,'<span class="scResultTerm">$1</span>$2');return'<span class="keywordResult">'+d+"</span>"}
function formatSymbolCompleteResult(a,b,c,d){addMoreResultsLink(b,c,d);new param;c=a[1];c=c.toLowerCase();var e=a[3],f=a[2].toUpperCase();Symbol=a[0];if(Symbol.indexOf("(")>0)Symbol=Symbol.substring(0,Symbol.indexOf("("));if(f!="US")a[0]=Symbol+"("+e+")";if(e=="NNOTC"||e=="NASDBB"||e=="PINKSH")if(f=="US")a[0]=Symbol+"("+e+")";e=doExchangeCountryMap(e);b=RegExp("\\b("+b+")(.*)\\b","i");f=Symbol;if(Symbol.match(b))f=f.replace(b,"<span class=scResultTerm>$1</span>$2");else c=c.replace(b,"<span class=scResultTerm>$1</span>$2");
c=["<table class=scResultTable><tr><td class=symbolCompleteCol1>",f,"</td><td class=symbolCompleteCol2>",c,"</td><td class=symbolCompleteCol3>",e,"</td></tr></table>"];if(Symbol.toUpperCase()==d._oTextbox.value.toUpperCase()){matchedSymbolCompInfo=a;dojo.hasClass(d._oTextbox,"acExactMatch")||dojo.addClass(d._oTextbox,"acExactMatch")}return c.join("")}function validateQuoteSearchBox(a){var b=false;if(a.value==null||a.value.length==0)alert("Please Enter a Symbol or Keyword.");else b=true;return b}
function isQuoteInput(a,b){return!b||!b.autoComplete?false:b.autoComplete._bItemSelected?true:b.isSymbolMatch()}function showHideCRDrpdwn(a){if(document.all){document.getElementById("resultsContentDiv");var b=document.getElementById("wsjCRSelectDrpdwn");if(a!="show"){if(b)b.style.display="none"}else if(b)b.style.display="block"}}function setFocused(a){a=YAHOO.util.Dom.get(a);window.formElementWithFocus=a}
function setUnUsed(a){var b;switch(a.name){case "Symbol":b="Symbol(s)";break;case "KeywordSearch":b="Keyword(s)"}if(a.value==b)a.className+=" unUsed"}function checkUnUsed(a){if(a.className.indexOf("unUsed")>=0)a.value="";return true}function searchFieldOnFocus(a){var b=a.className.indexOf("unUsed");if(b>=0){a.value="";a.className=b==0?a.className.match("unUsed ")?a.className.replace("unUsed ",""):a.className.replace("unUsed",""):a.className.replace(" unUsed","")}}
function clearSearchFieldFocus(a){a=document.getElementById(a);if(typeof a!="undefined"){a.blur();a.className="unUsed"}};
dojo.provide("dj.widget.networkHat.global_autocomplete_new");dojo.require("dj.widget.networkHat.infocomplete");dojo.require("yui.yui-2.5.2");baseDomain=typeof window.nSP=="undefined"||nSP==null?"http://"+document.domain:nSP;
InfoCompleteConfigNew=function(a,b,c){this.count=8;this.delay=0.05;this.SCkey="88DF4730C6A6550285F22ED26514254A16E53C6A8725A61E0F11CFE5384904E7E6E29DBAC369DCB18FCDF8715405601FA73B9FE9CBB5D7B0DBBC636B2F74DE9D6724596AEA605596E1CFE155A5F14A962956795C2DF7D2680FE0712A193D9C0692EB8865";this.allowsymboltypes=this.allowexchanges=this.allowcountries="";this.inputId=a||"";this.containerId=b||"";this.buttonId=c||"";this.sections=[];this.initSymbolNew=function(d){YAHOO.widget.DS_XHR.prototype.scriptQueryParam=
"q";this.sections[this.sections.length]={type:"symbol",dataSource:{server:"/mwauto/autocomplete/data",schema:["symbols","ticker","company","country","exchange","exchangeIsoCode","type"],responseType:YAHOO.widget.DS_XHR.TYPE_JSON,scriptQueryParam:"q",scriptQueryAppend:"it=fund,exchangetradedfund,stock,Index"},formatFunc:d,subHeader:null};return this};this.initKeywordNew=function(d){this.sections[this.sections.length]={type:"keyword",dataSource:{server:"/api/djKeywordcomplete/GetKeywordsJSON.ashx",
schema:["Results","Word","Rank"],responseType:YAHOO.widget.DS_XHR.TYPE_JSON,scriptQueryParam:"query",scriptQueryAppend:"count="+this.count+"&license="+this.SCkey},formatFunc:d,subHeader:'<div class="subHeading">Choose a topic to search news:</div>'};return this}};
function initInfoCompleteNew(a,b){var c=b||window.InfoComplete;if(c){var d;d=dj.autocompletesearch!==undefined&&dj.autocompletesearch.onlySymbol===true?a||(new InfoCompleteConfigNew(searchBoxID,resultContainerID,searchGoButtonID)).initSymbolNew(formatSymbolCompleteResultNew):a||(new InfoCompleteConfigNew(searchBoxID,resultContainerID,searchGoButtonID)).initSymbolNew(formatSymbolCompleteResultNew).initKeywordNew(formatKeywordCompleteResultNew);c.Setup(d);if(typeof c.autoComplete=="undefined"||c.autoComplete==
null){var e=YAHOO.util.Dom.get(d.inputId),f=YAHOO.util.Dom.get(d.buttonId);e.setAttribute("onchange","");YAHOO.util.Event.addListener(f,"click",submitSymbolOrSearchNew);d="keypress";if(YAHOO.util.Event.isIE)d="keydown";YAHOO.util.Event.addListener(e,d,function(q){if(q.keyCode==13)submitSymbolOrSearchNew(q);else window.gotSymbolReply=false})}else{if(window.JSON&&window.JSON.deserialize)window.JSON.parse=window.JSON.deserialize;e=YAHOO.util.Dom.get(d.inputId);f=YAHOO.util.Dom.get(d.buttonId);c.autoComplete.setHeader("");
c.autoComplete.setFooter("");for(var k=0,p=d.sections.length;k<p;k++)typeof d.sections[k].subHeader!="undefined"&&d.sections[k].subHeader!=null&&c.autoComplete.setSubHeader(d.sections[k].subHeader,k);c.autoComplete.dataReturnEvent.subscribe(updateSearchTermNew,this);e.setAttribute("onchange","");c.autoComplete.itemSelectEvent.subscribe(function(){dojo.hasClass(e,"acExactMatch")||dojo.addClass(e,"acExactMatch")},this);dojo.connect(e,"onkeypress",null,function(q){if(q){var s;s=window.event?window.event.srcElement:
q.currentTarget;q.keyCode!==13&&dojo.removeClass(s,"acExactMatch");matchedSymbolCompInfo=[]}});c.autoComplete.itemSelectEvent.subscribe(submitSymbolOrSearchNew,c);YAHOO.util.Event.addListener(f,"click",function(q){submitSymbolOrSearchNew(q,null,c)});d="keypress";if(YAHOO.util.Event.isIE)d="keydown";YAHOO.util.Event.addListener(e,d,function(q){if(q.keyCode==13)submitSymbolOrSearchNew(q,null,c);else window.gotSymbolReply=false})}}}
function updateSearchTermNew(){window.gotSymbolReply=true;var a=YAHOO.util.Dom.get("symbolCompleteSearchTerm");if(a)a.innerHTML=YAHOO.util.Dom.get(searchBoxID).value}function updateSearchTermNew(){window.gotSymbolReply=true;var a=YAHOO.util.Dom.get("symbolCompleteSearchTerm");if(a)a.innerHTML=YAHOO.util.Dom.get(searchBoxID).value}submittedSymbolOrSearch=false;
function doOpenWindowNew(a){if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.target==="_blank")window.open(a);else window.location=a}function getSubmittedSearchStatusNew(){if(dj.autocompletesearch!==undefined&&dj.autocompletesearch.target==="_blank")return false;return submittedSymbolOrSearch}
function submitSymbolOrSearchNew(a,b,c){var d=c.autoComplete._oTextbox.id;if(typeof c.autoComplete=="undefined"||c.autoComplete==null){YAHOO.util.Event.stopEvent(a);if(!getSubmittedSearchStatusNew()){var e=YAHOO.util.Dom.get(d);checkUnUsedNew(e);if(validateQuoteSearchBoxNew(e)){submittedSymbolOrSearch=true;if(a=isSearchOverrideNew(e.value))doKeyWordSearchNew(e.value);else if(isIndexNew(e.value,d))doRedirectMDCNew(e.value);else if(!window.gotSymbolReply&&e.value.length<=5&&!a||isQuoteInputNew(e.value,
c))e.value.length==5&&!isMutualFundNew(e.value,c)?doKeyWordSearchNew(e.value):doViewQuoteNewAuto(e.value,c);else doKeyWordSearchNew(e.value)}}}else{YAHOO.util.Event.stopEvent(a);if(!getSubmittedSearchStatusNew()){e=YAHOO.util.Dom.get(d);checkUnUsedNew(e);var f=false;if(c.autoComplete._bItemSelected||a&&a=="itemSelect")f=true;var k=-1;if(b&&b[1])k=b[1]._nDataSourceIndex;if(validateQuoteSearchBoxNew(e)){submittedSymbolOrSearch=true;a=isSearchOverrideNew(e.value);if(k==c.symbol)doViewQuoteNewAuto(e.value,
c);else if(k==c.keyword||a)doKeyWordSearchNew(b?b[2][0].toLowerCase():e.value);else if(isIndexNew(e.value,d))doRedirectMDCNew(e.value);else if(!window.gotSymbolReply&&e.value.length<=5&&!a||f&&k==c.symbol||isQuoteInputNew(e.value,c))e.value.length==5&&!isMutualFundNew(e.value,c)?doKeyWordSearchNew(e.value):doViewQuoteNewAuto(e.value,c);else doKeyWordSearchNew(e.value)}}}}function isMutualFundNew(a,b){if(getMatchedRow(a,b)[5]==="Fund")return true;return false}
function isIndexNew(a,b){if(dojo.hasClass(b,"acExactMatch"))if(matchedSymbolCompInfo&&matchedSymbolCompInfo[0]&&matchedSymbolCompInfo[3]){var c=matchedSymbolCompInfo[0],d=c;if(c.indexOf("(")!==-1)d=c.substring(0,c.indexOf("("));if(a.toUpperCase()===d)return matchedSymbolCompInfo[5]==="Index"}return false}
function isSearchOverrideNewoldNew(a){a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.replace(/,+/gi,"");a=a.match(/^PUTIN$|^OBAMA$|^CHINA$|^FBI$|^CIA$|^FDA$/);return a!=null&&a.length>0&&a[0].length>0}
function isSearchOverrideNew(a){var b=["obama","putin","china","fbi","cia","fda","nano","g20","g-20","bay","egan","acme","gold","cost","gas","beer","drug","oil","dog","cpi","gdp","dna","etf","jazz","etfs","auto","fed","taxes","tax","rome","cdc"],c=false;a=a.replace(/^\s+|\s+$/g,"").toUpperCase();a=a.replace(/,+/gi,"");for(var d=b.length,e=0;e<d;e++){var f=b[e];f=f.replace(/^\s+|\s+$/g,"").toUpperCase();if(f==a)c=true}return c}
function doExchangeCountryMapNew(a){var b={};b.US="U.S.";b["SAO PAULO"]="Brazil";b.TOR="Canada: Toronto";b.CSEC="Venezuela";b.ASX="Australia";b.SHSE="China: Shanghai";b.SSE="China: Shenzhen";b.HKSE="Hong Kong";b.TSE="Japan";b.KLSE="Malaysia";b.NZSE="New Zealand";b.SES="Singapore";b.TWSE="Taiwan";b.BRUX="Belgium";b.COPN="Denmark";b.TALLINN="Estonia";b.HELS="Finland";b.PARB="France";b.FRNK="Germany: Frankfurt";b.XETRA="Germany: Xetra";b.REYKJAVIK="Iceland";b.DUBLIN="Ireland";b.MILAN="Italy";b.RIGA=
"Latvia";b.LITHUANIA="Lithuania";b.AMS="Netherlands";b.OSLO="Norway";b.SIBE="Spain";b.STKM="Sweden";b.ZSE="Switzerland";b.LONDON="U.K.";b.VTX="Switzerland";b.PINKSH="U.S.: Pink Sheets";b.NNOTC="U.S.: Other OTC";b.NASDBB="U.S.: OTCBB";b.XTSX="Canada: TSX Venture";b.BOMBAY="India: Bombay";b.BSE="Hungary";b.LISBON="Portugal";b.SET="Thailand";b.VIENNA="Austria";b.JSX="Indonesia";b.JOBG="South Africa";b.PRAGUE="Czech Republic";b.ATHENS="Greece";b.PHP="Philippines";b.WSE="Poland";b.ISE="Turkey";b.SANSE=
"Chile";b.HAMB="Germany: Hamburg";b.MNCH="Germany: Munich";b.DUSS="Germany: Dusseldorf";b.MXSE="Mexico";b.KSE="South Korea";return b[a]}
function doExchangeTypeMapNew(a){var b={};b.US="usstock usfund";b["SAO PAULO"]="brsp";b.TOR="tse";b.CSEC="vecsec";b.ASX="auasx";b.SHSE="shse";b.SSE="sse";b.HKSE="hkse";b.TSE="jptse";b.KLSE="myklse";b.NZSE="nzse";b.SES="sgses";b.TWSE="twtwse";b.BRUX="bebrux";b.COPN="copn";b.TALLINN="tallinn";b.HELS="hels";b.PARB="frparb";b.FRNK="defrnk";b.XETRA="dexetra";b.REYKJAVIK="reykjavik";b.DUBLIN="iedublin";b.MILAN="itmilan";b.RIGA="riga";b.LITHUANIA="lithuania";b.AMS="nlams";b.OSLO="nooslo";b.SIBE="escats";
b.STKM="sestkm";b.ZSE="chzse";b.LONDON="lse";b.VTX="virtx";b.PINKSH="pinksh";b.NNOTC="nnotc";b.NASDBB="nasdbb";b.XTSX="xtsx";b.BOMBAY="xbom";b.BSE="xbud";b.LISBON="xlis";b.SET="xbkk";b.VIENNA="xwbo";b.JSX="xidx";b.JOBG="xjse";b.PRAGUE="xpra";b.ATHENS="xath";b.PHP="xphs";b.WSE="xwar";b.ISE="xist";b.SANSE="xsgo";b.HAMB="xham";b.MNCH="xmun";b.DUSS="xdus";b.MXSE="xmex";b.KSE="xkrx";return b[a]}
function doViewQuoteNewAuto(a,b){a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/,+/gi,",");a=a.replace(/,$|\.,$/,"");if(a.match(","))doMultipleQuoteSearch(a);else{var c,d,e,f;e=getMatchedRow(a,b);c=a;f=e[5];d=e[2];e=e[4];c=c.substring(c.indexOf(":")+1,c.length);d=dj.context.core.quotesUrlPrefix+"/"+d;c="/"+c+"&mod=DNH_S";if(f!=="Fund")c="/"+e+c;d+=c;doOpenWindowNew(d)}}
function getMatchedRow(a,b){a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/,+/gi,",");a=a.replace(/,$|\.,$/,"");var c=0,d;if(b&&b.autoComplete&&b.autoComplete._aListItems[b.symbol]){c=b.autoComplete._aListItems[b.symbol].length;if(c>0)for(var e=[],f=0;f<c;f++){e=b.autoComplete._aListItems[b.symbol][f]._oResultData;d=e[0];if(a.toUpperCase()==d||a.toUpperCase()+"."==d)return e}}}
function doViewQuoteOld(a){a=a.replace(/^\s+|\s+$/g,"");a=a.replace(/,+/gi,",");a=a.replace(/,$|\.,$/,"");if(a.match(",")){a=a.split(",");var b="",c="";for(i=0;i<a.length;i++){tempSymb=a[i];tempEx="";if(a[i].indexOf("(")>0){tempSymb=a[i].substring(0,a[i].indexOf("("));tempEx=a[i].substring(a[i].indexOf("(")+1,a[i].length-1)}else tempEx="US";tempSymb=tempSymb.replace(/^\s+|\s+$/g,"");b=b+tempSymb+",";c=c+doExchangeTypeMapNew(tempEx)+","}b=b.substring(0,b.length-1);c=c.substring(0,c.length-1);b=b.replace(/\+/g,
"%2B");a=baseDomain+(loggedIn?"":"/public")+"/quotes/main.html?symbol="+b+"&type="+c+"&mod=DNH_S";if(c=="xtsx")a=dj.context.core.quotesUrlPrefix+"/ca/"+c+"/"+b+"&mod=DNH_S";else if(c=="xbom")a=dj.context.core.quotesUrlPrefix+"/in/"+c+"/"+b+"&mod=DNH_S";else if(c=="xbud")a=dj.context.core.quotesUrlPrefix+"/hu/"+c+"/"+b+"&mod=DNH_S";else if(c=="xlis")a=dj.context.core.quotesUrlPrefix+"/pt/"+c+"/"+b+"&mod=DNH_S";else if(c=="xwbo")a=dj.context.core.quotesUrlPrefix+"/at/"+c+"/"+b+"&mod=DNH_S";else if(c==
"xbkk")a=dj.context.core.quotesUrlPrefix+"/th/"+c+"/"+b+"&mod=DNH_S";else if(c=="xidx")a=dj.context.core.quotesUrlPrefix+"/id/"+c+"/"+b+"&mod=DNH_S";else if(c=="xjse")a=dj.context.core.quotesUrlPrefix+"/za/"+c+"/"+b+"&mod=DNH_S";else if(c=="xpra")a=dj.context.core.quotesUrlPrefix+"/cz/"+c+"/"+b+"&mod=DNH_S";else if(c=="xath")a=dj.context.core.quotesUrlPrefix+"/gr/"+c+"/"+b+"&mod=DNH_S";else if(c=="xphs")a=dj.context.core.quotesUrlPrefix+"/ph/"+c+"/"+b+"&mod=DNH_S";else if(c=="xwar")a=dj.context.core.quotesUrlPrefix+
"/pl/"+c+"/"+b+"&mod=DNH_S";else if(c=="xist")a=dj.context.core.quotesUrlPrefix+"/tr/"+c+"/"+b+"&mod=DNH_S";else if(c=="xsgo")a=dj.context.core.quotesUrlPrefix+"/cl/"+c+"/"+b+"&mod=DNH_S";else if(c=="xham")a=dj.context.core.quotesUrlPrefix+"/de/"+c+"/"+b+"&mod=DNH_S";else if(c=="xmun")a=dj.context.core.quotesUrlPrefix+"/de/"+c+"/"+b+"&mod=DNH_S";else if(c=="xdus")a=dj.context.core.quotesUrlPrefix+"/de/"+c+"/"+b+"&mod=DNH_S";else if(c=="xmex")a=dj.context.core.quotesUrlPrefix+"/mx/"+c+"/"+b+"&mod=DNH_S";
else if(c=="xkrx")a=dj.context.core.quotesUrlPrefix+"/kr/"+c+"/"+b+"&mod=DNH_S"}else{c="US";b=a;if(a.indexOf("(")>0){b=a.substring(0,a.indexOf("("));c=a.substring(a.indexOf("(")+1,a.length-1)}b=b.replace("+","%2B");a=baseDomain+(loggedIn?"":"/public")+"/quotes/main.html?symbol="+b+"&type="+doExchangeTypeMapNew(c)+"&mod=DNH_S";if(doExchangeTypeMapNew(c)=="xtsx")a=dj.context.core.quotesUrlPrefix+"/CA/XTSX/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xbom")a=dj.context.core.quotesUrlPrefix+"/IN/XBOM/"+
b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xbud")a=dj.context.core.quotesUrlPrefix+"/HU/XBUD/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xlis")a=dj.context.core.quotesUrlPrefix+"/PT/XLIS/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xwbo")a=dj.context.core.quotesUrlPrefix+"/AT/XWBO/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xbkk")a=dj.context.core.quotesUrlPrefix+"/TH/XBKK/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xidx")a=dj.context.core.quotesUrlPrefix+"/ID/XIDX/"+
b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xjse")a=dj.context.core.quotesUrlPrefix+"/ZA/XJSE/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xpra")a=dj.context.core.quotesUrlPrefix+"/CZ/XPRA/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xath")a=dj.context.core.quotesUrlPrefix+"/GR/XATH/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xphs")a=dj.context.core.quotesUrlPrefix+"/PH/XPHS/"+b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xwar")a=dj.context.core.quotesUrlPrefix+"/PL/XWAR/"+
b+"&mod=DNH_S";else if(doExchangeTypeMapNew(c)=="xist")a=dj.context.core.quotesUrlPrefix+"/TR/XIST/"+b+"&mod=DNH_S";else if(doExchangeTypeMap(c)=="xsgo")a=dj.context.core.quotesUrlPrefix+"/CL/XSGO/"+b+"&mod=DNH_S";else if(doExchangeTypeMap(c)=="xmun")a=dj.context.core.quotesUrlPrefix+"/DE/XMUN/"+b+"&mod=DNH_S";else if(doExchangeTypeMap(c)=="xham")a=dj.context.core.quotesUrlPrefix+"/DE/XHAM/"+b+"&mod=DNH_S";else if(doExchangeTypeMap(c)=="xdus")a=dj.context.core.quotesUrlPrefix+"/DE/XDUS/"+b+"&mod=DNH_S";
else if(doExchangeTypeMap(c)=="xmex")a=dj.context.core.quotesUrlPrefix+"/MX/XMEX/"+b+"&mod=DNH_S";else if(doExchangeTypeMap(c)=="xkrx")a=dj.context.core.quotesUrlPrefix+"/KR/XKRX/"+b+"&mod=DNH_S";if(c==="INDEXES")a=djUrl}doOpenWindowNew(a)}
function doMultipleQuoteSearch(a){var b=a.split(",");var c=a="";for(i=0;i<b.length;i++){tempSymb=b[i];tempEx="";if(b[i].indexOf("(")>0){tempSymb=b[i].substring(0,b[i].indexOf("("));tempEx=b[i].substring(b[i].indexOf("(")+1,b[i].length-1)}else tempEx="US";tempSymb=tempSymb.replace(/^\s+|\s+$/g,"");a=a+tempSymb+",";c=c+doExchangeTypeMapNew(tempEx)+","}a=a.substring(0,a.length-1);c=c.substring(0,c.length-1);a=a.replace(/\+/g,"%2B");b=baseDomain+(loggedIn?"":"/public")+"/quotes/main.html?symbol="+a+"&type="+
c+"&mod=DNH_S";if(c=="xtsx")b=dj.context.core.quotesUrlPrefix+"/ca/"+c+"/"+a+"&mod=DNH_S";else if(c=="xbom")b=dj.context.core.quotesUrlPrefix+"/in/"+c+"/"+a+"&mod=DNH_S";else if(c=="xbud")b=dj.context.core.quotesUrlPrefix+"/hu/"+c+"/"+a+"&mod=DNH_S";else if(c=="xlis")b=dj.context.core.quotesUrlPrefix+"/pt/"+c+"/"+a+"&mod=DNH_S";else if(c=="xwbo")b=dj.context.core.quotesUrlPrefix+"/at/"+c+"/"+a+"&mod=DNH_S";else if(c=="xbkk")b=dj.context.core.quotesUrlPrefix+"/th/"+c+"/"+a+"&mod=DNH_S";else if(c==
"xidx")b=dj.context.core.quotesUrlPrefix+"/id/"+c+"/"+a+"&mod=DNH_S";else if(c=="xjse")b=dj.context.core.quotesUrlPrefix+"/za/"+c+"/"+a+"&mod=DNH_S";else if(c=="xpra")b=dj.context.core.quotesUrlPrefix+"/cz/"+c+"/"+a+"&mod=DNH_S";else if(c=="xath")b=dj.context.core.quotesUrlPrefix+"/gr/"+c+"/"+a+"&mod=DNH_S";else if(c=="xphs")b=dj.context.core.quotesUrlPrefix+"/ph/"+c+"/"+a+"&mod=DNH_S";else if(c=="xwar")b=dj.context.core.quotesUrlPrefix+"/pl/"+c+"/"+a+"&mod=DNH_S";else if(c=="xist")b=dj.context.core.quotesUrlPrefix+
"/tr/"+c+"/"+a+"&mod=DNH_S";doOpenWindowNew(b)}function doKeyWordSearchNew(a){a=a.replace(/^\s+|\s+$/g,"").replace(/,$|\.,$/,"");a=baseDomain+"/search/term.html?KEYWORDS="+escape(a)+"&mod=DNH_S";doOpenWindowNew(a)}
function doRedirectMDCNew(a){a=a.replace(/^\s+|\s+$/g,"").replace(/,$|\.,$/,"");a=a.toLowerCase();baseDomain="http://online.wsj.com";var b=false,c=a.match(/^ftse$|^dax$|^cac 40$|^jsx$/);if(c!=null&&c.length>0&&c[0].length>0)b=true;a=a.replace("util","djua");a=a.replace("tran","djta");a=a.replace("gspc","spx");a=a.replace("compq","comp");a=a.replace("nysi","nya");a=a.replace("amsi","xax");a=a.replace("sox","soxx");a=a.replace("ftse","uk:ftse100");a=a.replace("dax","dx:1876534");a=a.replace("cac 40",
"fr:px1");a=a.replace("jsx","1803554");doOpenWindowNew(baseDomain+"/mdc/public/npage/2_3050.html?symb="+a+(b?"&page=intl":"")+"&mod=DNH_S")}function addMoreResultsLinkNew(a,b,c){a="";c.setSubHeader('<div class="subHeading">Choose a symbol match to get quote:</div>',b)}
function formatKeywordCompleteResultNew(a,b){var c=RegExp("\\b("+b+")(.*)\\b","i"),d=a[0].toLowerCase();a[0]=d;if(d.length>80)d=d.substring(0,80);if(d.match(c))d=d.replace(c,'<span class="scResultTerm">$1</span>$2');return'<span class="keywordResult">'+d+"</span>"}
function formatSymbolCompleteResultNew(a,b,c,d){addMoreResultsLinkNew(b,c,d);new param;var e=a[1];e=e.toLowerCase();var f=a[3],k=a[2].toUpperCase();c=a[0];if(c.indexOf("(")>0)c=c.substring(0,c.indexOf("("));var p=k;if("CA,CN,DE,US,IN".indexOf(dojo.trim(k))!=-1)p=f;else if(f.indexOf(":")>-1)p=f.substring(0,f.indexOf(":"));b=RegExp("\\b("+b+")(.*)\\b","i");f=c;if(c.match(b))f=f.replace(b,"<span class=scResultTerm>$1</span>$2");else e=e.replace(b,"<span class=scResultTerm>$1</span>$2");e=["<table class=scResultTable><tr><td class=symbolCompleteCol1>",
f,"</td><td class=symbolCompleteCol2>",e,"</td><td class=symbolCompleteCol3>",p,"</td></tr></table>"];if(c.toUpperCase()==d._oTextbox.value.toUpperCase()){matchedSymbolCompInfo=a;dojo.hasClass(d._oTextbox,"acExactMatch")||dojo.addClass(d._oTextbox,"acExactMatch")}return e.join("")}function validateQuoteSearchBoxNew(a){var b=false;if(a.value==null||a.value.length==0)alert("Please Enter a Symbol or Keyword.");else b=true;return b}
function isQuoteInputNew(a,b){return!b||!b.autoComplete?false:b.autoComplete._bItemSelected?true:b.isSymbolMatch()}function showHideCRDrpdwnNew(a){if(document.all){document.getElementById("resultsContentDiv");var b=document.getElementById("wsjCRSelectDrpdwn");if(a!="show"){if(b)b.style.display="none"}else if(b)b.style.display="block"}}function setFocusedNew(a){a=YAHOO.util.Dom.get(a);window.formElementWithFocus=a}
function setUnUsedNew(a){var b;switch(a.name){case "Symbol":b="Symbol(s)";break;case "KeywordSearch":b="Keyword(s)"}if(a.value==b)a.className+=" unUsed"}function checkUnUsedNew(a){if(a.className.indexOf("unUsed")>=0)a.value="";return true}function searchFieldOnFocusNew(a){var b=a.className.indexOf("unUsed");if(b>=0){a.value="";a.className=b==0?a.className.match("unUsed ")?a.className.replace("unUsed ",""):a.className.replace("unUsed",""):a.className.replace(" unUsed","")}}
function clearSearchFieldFocusNew(a){a=document.getElementById(a);if(typeof a!="undefined"){a.blur();a.className="unUsed"}};
dojo.provide("dj.widget.networkHat.FactivaLogin");dojo.require("dj.util.queryParam");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");
dj.widget.networkHat.FactivaLogin={init:function(a,b){function c(f,k){dojo.byId(f).href=k}var d=dj.util.queryParam.getQueryStrParams(),e=this.CONFIG=dojo.mixin({useridemail:function(f,k){dojo.byId(f).value=k},regurl:c,forgoturl:c,enableurl:c,loginurl:function(f,k){dojo.byId(f).action=k},getFactivaOpen:"factivaLogInGet",getFactivaClose:"factivaLogInClose",getFactivaPopout:"factivaLogInInfo",twitterAndFacebook:false,cookie:{name:"FLMD",on:"1",off:"0",ttl:365},weekend:{hideContentBucket:"#headerContentBucket",
showContentBucket:"#headerContentBucket_factiva",qualifier:"pageType-weekend"}},a);for(id in d)e[id]&&e[id](id,d[id]);dojo.connect(dojo.byId(e.getFactivaClose),"click",this,function(f){dojo.stopEvent(f);this.closeMarketingDialog()});if(e.twitterAndFacebook){dojo.require("dj.widget.networkHat.hat");hat.init()}this.isCookieSet()||this.showMarketingDialog();typeof b!=="undefined"&&b!==null&&this.inDateRange(b)&&dj.util.User.isLoggedIn(dojo.hitch(this,function(f){f&&this.switchWeekendContentBucket()}))},
showMarketingDialog:function(){dojo.removeClass(dojo.byId(this.CONFIG.getFactivaPopout),"hidden")},closeMarketingDialog:function(){dojo.addClass(dojo.byId(this.CONFIG.getFactivaPopout),"hidden");this.dropCookie()},isCookieSet:function(){var a=this.CONFIG.cookie;return dj.util.Cookie.getGroupCookie("DJCOOKIE",a.name)===a.on},dropCookie:function(){var a=this.CONFIG.cookie;dj.util.Cookie.setGroupCookie("DJCOOKIE",a.name,a.on,a.ttl)},switchWeekendContentBucket:function(){var a=this.CONFIG.weekend;dojo.query(a.hideContentBucket).forEach(function(b){dojo.addClass(b,
"hidden")});dojo.query(a.showContentBucket).forEach(function(b){dojo.removeClass(b,"hidden")})},inDateRange:function(a){if(typeof serverTime==="undefined"||serverTime===null)serverTime=new Date;var b=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][serverTime.getDay()];a=a.split(",");for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e===b)return true;else{var f=e.split("-");if(f[0]===b){e=f.length<2||f[1]===""?0:parseInt(f[1]);f=f.length<3||f[2]===""?2359:parseInt(f[2]);var k=serverTime.getHours(),p=serverTime.getMinutes();
k=parseInt("".concat(k).concat((p<10?"0":"")+p));if(k<=f&&k>=e)return true}}}return false}};
dojo.provide("dj.module.networkHat");dojo.require("dj.widget.networkHat.infocomplete");dojo.require("dj.widget.networkHat.global_autocomplete");dojo.require("dj.widget.networkHat.global_autocomplete_new");dojo.require("dj.widget.networkHat.AutoComplete");var fw=dojo.query("div.fullwide")[0],loggedIn=dojo.hasClass(fw,"subType-subscribed"),searchBoxID="hat_input_auto",resultContainerID="symbolCompleteResults",searchGoButtonID="SearchQuoteGoButton",oHat=dojo.byId("hat_div"),oHatMenu=dojo.byId("hat_more_menu");
dojo.getObject("dj.context",true);dojo.getObject("dj.module",true);dj.module.networkHatLoader&&dj.module.networkHatLoader.initInfoComplete();dojo.getObject("dj.context.networkHat",true);dj.context.networkHat.jnetworkHatJsLoaded=true;

dojo.provide("dj.module.electionEmailSignUp");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dj.module.electionEmailSignUp={init:function(){this.oContainers=dojo.query("ul#electionEmList li a.electionsBtnEmailSignup");this.oContainers.forEach(function(el){this.initializeContainer(el);},this);},initializeContainer:function(oContainer){if(oContainer!==null){this.setUpControllers(oContainer);}},setUpControllers:function(oContainer){var that=this;dojo.connect(oContainer,"onclick",this,function(ev){dojo.stopEvent(ev);this.signUp(oContainer,oContainer.id);});},signUp:function(oContainer,newsletterId){this.signUpUrl="/emailservice/email-signup";this.userLoginName="";var that=this;dj.util.User.getUserId(function(userId){that.userLoginName=userId;});this.oEmail=dojo.query(".electionsUserEmail")[0];dj.util.User.renderEmailAddress(this.oEmail);this.userEmail=this.oEmail.innerHTML;this.postBody=this.buildPostBody(newsletterId);this.request=dojo.xhrPost({url:this.signUpUrl,postData:that.postBody,handleAs:"xml",headers:{"Content-Type":"text/xml"},error:function(error,ioArgs){if(409==ioArgs.xhr.status){that.showError();}else if(ioArgs.xhr.status>500&&ioArgs.xhr.status<600){that.showContent();console.error("{emailSignUp} error %s - server error",ioArgs.xhr.status);}},load:function(data,ioArgs){that.showSuccess(newsletterId);}});},buildPostBody:function(newsletterId){var isReg=false;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){if(!subLoggedIn){isReg=true;}});}});var isEnt=false;dj.util.User.hasRole('WSJ-ENT',function(hasRole){if(hasRole){isEnt=true;}});var isCfo=false;dj.util.User.hasRole('WSJ-CFO-PRO',function(hasRole){if(hasRole){isCfo=true;}});dj.util.User.hasRole('WSJ-ENT-CFO',function(hasRole){if(hasRole){isCfo=true;}});dj.util.User.hasRole('WSJ-CFO-PRO-TRIAL',function(hasRole){if(hasRole){isCfo=true;}});var isPro=false;dj.util.User.hasRole('WSJ-PRO',function(hasRole){if(hasRole){isPro=true;}});var x=[];x[x.length]="<customer>";x[x.length]="<login-name>"+this.userLoginName+"</login-name>";x[x.length]="<contacts class=\"java.util.ArrayList\">";x[x.length]="<contact><last-modified-by>"+this.userLoginName+"</last-modified-by><contact-address>"+this.userEmail+"</contact-address><contact-status>V</contact-status>";x[x.length]="<bulk-emails class=\"java.util.ArrayList\">";x[x.length]="<bulk-email><opt-in-flag>1</opt-in-flag><email-type-id>"+newsletterId+"</email-type-id></bulk-email>";x[x.length]="</bulk-emails>";x[x.length]="</contact>";x[x.length]="</contacts>";x[x.length]="<products class=\"java.util.ArrayList\">";if(isEnt){x[x.length]="<product><id>501</id><name>WSJ ENT</name><description>WSJ Enterprise Product</description></product>";}else if(isReg){x[x.length]="<product><id>301</id><name>WSJ</name><description>WSJ Email Product</description></product>";}else if(isCfo){x[x.length]="<product><id>101</id><name>WSJ</name><description>CFO Professional Product</description></product>";}else if(isPro){x[x.length]="<product><id>821</id><name>WSJ</name><description>WSJ Professional Product</description></product>";}else{x[x.length]="<product><id>2</id><name>WSJ</name><description>WSJ Email Product</description></product>";}
x[x.length]="</products>";x[x.length]="</customer>";x=x.join('\n');return x;},showSuccess:function(newsletterId){dojo.addClass(dojo.byId(newsletterId),"hidden");dojo.removeClass(dojo.byId(newsletterId+"electionsSignedUp"),"hidden");},showError:function(){this.userEmail="";console.log("error");},showContent:function(){console.log("error - server error");}};dojo.provide("dj.module.electionToolbar");dojo.require("dj.lang");dojo.require("dj.util.Element");dojo.require("dj.util.User");dojo.require("dj.util.Region");dojo.require("dj.util.User");dj.module.electionToolbar={init:function(customConfig){this._cfg={toolBarFBButton:"#tbar_fb_button",toolBarTwtButton:"#tbar_twt_button",toolBarEmailButton:"#tbar_email_button",toolBarFBOverlay:"fbOverlay",toolBarTwtOverlay:"twtOverlay",toolBarEmailOverlay:"emailOverlay",toolBarFBShareCount:"electionShareCountFB",toolBarTwtShareCount:"electionShareCountTwt",toolBarFaceBookIframe:"facebook_iframe",toolBarTwtIframe:"twt_iframe",toolBarOverlayClose:".electionsToolbarShareClose",toolBarUSDropdown:"#electionsmnIndicator",toolBarUSDropdownMoreIn:"#electionmnMoreIn",toolBarUSDropDownContainer:"electionDropdown",toolBarUSDropdownHTMLContainer:"dropdown_result"};if(customConfig){this._cfg=dojo.mixin(this._cfg,customConfig);}
this.userLoginName="";this.addEvents();},addEvents:function(){var that=this;dj.lang.addLiveEvent(this._cfg.toolBarFBButton,"click",function(event){dojo.stopEvent(event);that.closeTwtOverlay();that.closeEmailOverlay();that.closeMoreDropDown();dojo.removeClass(dojo.byId(that._cfg.toolBarFBOverlay),"hidden");var overlay=dojo.byId(that._cfg.toolBarFBShareCount);if(!window.frames[that._cfg.toolBarFaceBookIframe]){that.createIFRAME(that._cfg.toolBarFaceBookIframe,"http://www.facebook.com/plugins/like.php?href=http://online.wsj.com/public/page/news-politics-campaign.html&layout=button_count&send=false&show_faces=false&width=90",overlay,"100px");}});dj.lang.addLiveEvent(this._cfg.toolBarTwtButton,"click",function(event){dojo.stopEvent(event);that.closeFBOverlay();that.closeEmailOverlay();that.closeMoreDropDown();dojo.removeClass(dojo.byId(that._cfg.toolBarTwtOverlay),"hidden");var overlay=dojo.byId(that._cfg.toolBarTwtShareCount);if(!window.frames[that._cfg.toolBarTwtIframe]){that.createIFRAME(that._cfg.toolBarTwtIframe,"http://platform.twitter.com/widgets/follow_button.html?screen_name=WSJPolitics&amp;show_count=true&amp;show_screen_name=true",overlay,"230px");}});dj.lang.addLiveEvent(this._cfg.toolBarEmailButton,"click",function(event){dojo.stopEvent(event);that.closeFBOverlay();that.closeTwtOverlay();that.closeMoreDropDown();dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){dojo.removeClass(dojo.byId(that._cfg.toolBarEmailOverlay),"hidden");dojo.removeClass(dojo.byId("electionEmList"),"hidden");});}else{dojo.removeClass(dojo.byId(that._cfg.toolBarEmailOverlay),"hidden");if(dojo.byId("emMsg")==null||dojo.byId("emMsg")==undefined){var overlayelement=dojo.byId("emailOverlay");var caption=dojo.create("p",{"class":"emMsg",id:"emMsg",innerHTML:"Please <a href='http://online.wsj.com/login'>LOGIN</a> or <a href='https://buy.wsj.com/shopandbuy/order/subscribe.jsp?trackCode=aaaibmyv'>SUBSCRIBE</a> to sign up for WSJ Election newsletters."});overlayelement.appendChild(caption);}}});});dj.lang.addLiveEvent(this._cfg.toolBarOverlayClose,"click",function(event){dojo.stopEvent(event);that.closeFBOverlay();that.closeTwtOverlay();that.closeEmailOverlay();});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdown,"mouseover",function(event){trimmedContainer=dojo.trim(dojo.byId(that._cfg.toolBarUSDropdownHTMLContainer).innerHTML);if(trimmedContainer.length==0){that.getUSDropdownHTML();}});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdownMoreIn,"mouseover",function(event){trimmedContainer=dojo.trim(dojo.byId(that._cfg.toolBarUSDropdownHTMLContainer).innerHTML);if(trimmedContainer.length==0){that.getUSDropdownHTML();}});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdown,"click",function(event){that.closeFBOverlay();that.closeTwtOverlay();that.closeEmailOverlay();that.updateMoreDropDownClassName();dojo.stopEvent(event);});dj.lang.addLiveEvent(this._cfg.toolBarUSDropdownMoreIn,"click",function(event){that.closeFBOverlay();that.closeTwtOverlay();that.closeEmailOverlay();that.updateMoreDropDownClassName();dojo.stopEvent(event);});dojo.connect(document,"onclick",this,function(event){var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#fbOverlay")[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(!dojo.hasClass(that._cfg.toolBarFBOverlay,"hidden")){that.closeFBOverlay();dojo.stopEvent(event);}}
var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#twtOverlay")[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(!dojo.hasClass(that._cfg.toolBarTwtOverlay,"hidden")){that.closeTwtOverlay();dojo.stopEvent(event);}}
var isPointerinModalContainer=dj.util.Element.contains(dojo.query("#emailOverlay")[0],event.clientX,event.clientY);if(isPointerinModalContainer===false){if(!dojo.hasClass(that._cfg.toolBarEmailOverlay,"hidden")){that.closeEmailOverlay();dojo.stopEvent(event);}}
var moreInDropDownContainter=dojo.query("#election2012MainNav ul li div#dropdown_result div.wsjmn_dropdownPanel div.wsjmn_dropdownContent")[0];if(typeof moreInDropDownContainter!=="undefined"&&moreInDropDownContainter){var isPointerinModalContainer=dj.util.Element.contains(moreInDropDownContainter,event.clientX,event.clientY);if(isPointerinModalContainer===false){if(dojo.hasClass(that._cfg.toolBarUSDropDownContainer,"wsjmnExt_ddState-expanded")){var selElement=dojo.byId(this._cfg.toolBarUSDropDownContainer);selElement.className=selElement.className.replace("wsjmnExt_ddState-expanded","wsjmnExt_ddState-collapsed");dojo.stopEvent(event);}}}});},createIFRAME:function(name,src,overlay,width){var ifrm=dojo.create('iframe',{"id":name,"src":src,"name":name,"height":"20px","width":width,"scrolling":"no","frameBorder":"0","allowtransparency":"true"});overlay.appendChild(ifrm);},getUSDropdownHTML:function(){dojo.xhrGet({url:"/public/page/0_0_WG_HeaderOne_Dropdown-na-us.html?path=false&business=false",headers:{Accept:'application/html'},handleAs:"text",load:function(response,ioArgs){dojo.byId("dropdown_result").innerHTML=response;dojo.query('#dropdown_result .wsjmn_dropdown_container .mn_dropdownTitlebar .mndType-more .mnText .mnLabel')[0].innerHTML="MORE IN U.S.";dojo.query('#dropdown_result .wsjmn_dropdown_container .mn_dropdownTitlebar .mndType-more .mnText .mnLabel')[0].id="electionmnMoreIn";dojo.query('#dropdown_result .wsjmn_dropdown_container .mn_dropdownTitlebar .mndType-more .mnIndicator')[0].id="electionsmnIndicator";},error:function(response,ioArgs){console.error("HTTP status code: ",ioArgs.xhr.status);}});},closeFBOverlay:function(){dojo.addClass(dojo.byId(this._cfg.toolBarFBOverlay),"hidden");},closeTwtOverlay:function(){dojo.addClass(dojo.byId(this._cfg.toolBarTwtOverlay),"hidden");},closeEmailOverlay:function(){dojo.addClass(dojo.byId(this._cfg.toolBarEmailOverlay),"hidden");},updateMoreDropDownClassName:function(){var selElement=dojo.byId(this._cfg.toolBarUSDropDownContainer);if(selElement.className.match(/wsjmnExt_ddState-expanded/)){selElement.className="wsjmn_dropdownTree wsjmnExt_ddState-collapsed wsjmn_dropdownName-us";}else if(selElement.className.match(/wsjmnExt_ddState-collapsed/)){selElement.className="wsjmn_dropdownTree wsjmnExt_ddState-expanded wsjmn_dropdownName-us";}},closeMoreDropDown:function(){var selElement=dojo.byId(this._cfg.toolBarUSDropDownContainer);if(dojo.byId(this._cfg.toolBarUSDropDownContainer).className.match(/wsjmnExt_ddState-expanded/)){selElement.className=selElement.className.replace("wsjmnExt_ddState-expanded","wsjmnExt_ddState-collapsed");}}};
dojo.provide("dj.module.browserPhaseout");dojo.declare("dj.module.browserPhaseout",null,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._duc=dj.util.Cookie;},DEFAULT_CONFIG:{djCookieName:"DJCOOKIE",djSessionName:"DJSESSION",bannerDivIdClass:"ie6banner",bannerDivId:"ie6bannerDiv",cookieName:"NoIE6Banner",phaseoutBr:"IE",brVersion:6},init:function(){if(this._cfg.phaseoutBr==="IE"){if(dojo.isIE<=this._cfg.brVersion){this.displayOrhideMessage();}}},displayOrhideMessage:function(){var sessionBlock=this._duc.getGroupCookie(this._cfg.djSessionName,this._cfg.cookieName);var permanentBlock=this._duc.getGroupCookie(this._cfg.djCookieName,this._cfg.cookieName);this.hiddenClassName=this._cfg.bannerDivIdClass+" hidden";this.upgradeDiv=dojo.byId(this._cfg.bannerDivId);if(this.upgradeDiv!==null){if(sessionBlock||permanentBlock){this.upgradeDiv.className=this.hiddenClassName;}else{this.displayBrowserImage();this.makeConnections();}}},displayBrowserImage:function(){var browserImagesArr=[];dojo.query("#bList .b_li").forEach(function(node,index,arr){browserImagesArr[index]=node.innerHTML;});var whichImage=0;var imagesLength=browserImagesArr.length;var milisecs=new Date().getMilliseconds();dojo.query("#bList .b_li").forEach(function(node,index,arr){whichImage=milisecs%imagesLength--;node.innerHTML=browserImagesArr[whichImage];browserImagesArr.splice(whichImage,1);});this.upgradeDiv.className=this._cfg.bannerDivIdClass;},makeConnections:function(){var that=this;dojo.connect(dojo.byId("actClose"),"onclick",function(ev){that.upgradeDiv.className=that.hiddenClassName;var check=dojo.byId("inputCheck");if(typeof check!="undefined"&&check.checked){dj.util.Cookie.setGroupCookie(that._cfg.djCookieName,that._cfg.cookieName,"Y",365);}else{dj.util.Cookie.setGroupCookie(that._cfg.djSessionName,that._cfg.cookieName,"Y");}});},openPopup:function(url,width,height){if(typeof width==="undefined"){width=600;}
if(typeof height==="undefined"){height=600;}
var popWin="width="+width+",height= "+height+",resizable=1,scrollbars=1,location=0,status=0";var win=window.open(url,"browserDownload",popWin);}});dojo.provide("dj.module.fbLikeButton");dj.module.fbLikeButton={init:function(setAppId,fanbox,topLike,bottomLike){window.fbAsyncInit=function(){FB.init({appId:setAppId,xfbml:true});if(dj.lang.query('.aToolType-fbLike iframe')[0]!=null&&AT_VARS.articleType.indexOf('Infogrfx')==0){dj.lang.query('.aToolType-fbLike iframe')[0].src=dj.lang.query('.aToolType-fbLike iframe')[0].src+'&colorscheme=dark';}};(function(){var e=document.createElement('script');e.async=true;e.src=document.location.protocol+'//connect.facebook.net/en_US/all.js';document.getElementById('fb-root').appendChild(e);}());}};dojo.provide("dj.module.onespot");dj.module.onespot={initISM:function(moduleName,placeholder){try{if(onespot.account==='onespot.wsj.com'){}
if(onespot.display_ism){onespot.use_console=false;onespot.logger=function(message){if(onespot.use_console){try{console.log(message);}catch(e){alert(message);}}};onespot.iframe=document.createElement('iframe');onespot.iframe.style.display='block';onespot.iframe.style.width='0';onespot.iframe.height='0';onespot.iframe.frameBorder='0';onespot.iframe.border='0';onespot.iframe.scrolling='no';if(typeof onespot=='object'){if(typeof onespot.placeholder=='string'){onespot.logger('! placeholder: '+onespot.placeholder);}else{onespot.placeholder='onespot';onespot.logger('! placeholder: using '+onespot.placeholder+' (default)');}
onespot.element=document.getElementById(onespot.placeholder);onespot.element.appendChild(onespot.iframe);onespot.page='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">'+'<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">'+'  <head>'+'    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>'+'    <title>OneSpot Integrated Story Module</title>'+'  </head>'+'  <body>'+'    <scr'+'ipt type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></scr'+'ipt>'+'    <scr'+'ipt type="text/javascript" src="http://static.onespot.com/javascripts/ism/builder.js"></scr'+'ipt>'+'  </body>'+'</html>';onespot.doc=onespot.iframe.contentWindow||onespot.iframe.contentDocument;if(onespot.doc.document){onespot.doc=onespot.doc.document;}
onespot.doc.open();onespot.doc.write(onespot.page);onespot.doc.close();}else{onespot.logger('Main settings object "onespot" is not defined. Please refer to the implementation instructions.');}}}catch(e){}}};dojo.provide("dj.module.trafficTransit");dj.module.trafficTransit={init:function(){this.startAddress=dojo.byId("startAddress");this.endAddress=dojo.byId("endAddress");this.setEvent();},setEvent:function(){var that=this;dojo.connect(this.startAddress,"onfocus",this,function(ev){var field=(ev.srcElement||ev.target);if(field.value===field.defaultValue){field.value="";dojo.removeClass(that.startAddress,"unUsed");}});dojo.connect(this.startAddress,"onblur",this,function(ev){var field=(ev.srcElement||ev.target);if(field.value===""){field.value=field.defaultValue;dojo.addClass(that.startAddress,"unUsed");}});dojo.connect(this.endAddress,"onfocus",this,function(ev){var field=(ev.srcElement||ev.target);if(field.value===field.defaultValue){field.value="";dojo.removeClass(that.endAddress,"unUsed");}});dojo.connect(this.endAddress,"onblur",this,function(ev){var field=(ev.srcElement||ev.target);if(field.value===""){field.value=field.defaultValue;dojo.addClass(that.endAddress,"unUsed");}});}};dojo.provide("dj.module.carouselSection");dojo.require("dj.widget.panels.virtual.Carousel");dojo.addOnLoad(function(){dj.module.carouselSection=dj.widget.panels.PanelsFactory.create("carouselSection",{core:{panelGroup:".newsItem",panel:"li",paginationContainer:".pagination",viewport:2},carousel:{prevButton:".nav-inline .prev",nextButton:".nav-inline .next"},rotator:{rotateTime:10}});});dojo.provide("dj.module.chartbeat");dojo.require("dj.util.io");dj.module.chartbeat={init:function()
{var canonicalUrl="";var canonicals=dojo.query('link[rel = canonical]');if(canonicals.length>0){canonicalUrl=canonicals[0].href?canonicals[0].href:"";}
var domainPrefix=dj.context.core.urlPrefix;var index=canonicalUrl.indexOf(".com")+4;var canonicalSuffix=canonicalUrl.substring(index);var domainName=domainPrefix.substring("http://".length);if(typeof s!="undefined"&&typeof s.prop2!="undefined"){var sectionName=s.prop2;if(sectionName!="undefined"){if(sectionName.indexOf("WSJ_")<0){sectionName="WSJ_"+sectionName;}}}
window._sf_async_config={uid:8900,domain:domainName,path:canonicalSuffix,sections:sectionName};window._sf_endpt=(new Date()).getTime();dj.util.io.insertScriptAsync((("https:"==document.location.protocol)?"https://s3.amazonaws.com/":"http://")+"static.chartbeat.com/js/chartbeat.js");}};dojo.provide("dj.module.loomia");dojo.require("dj.util.Page");dj.module.loomia={init:function(){window.L_VARS={publisher_key:6563391702,guid:(typeof s!='undefined')?s.prop20:"",anchor:"loomia_display",zone:10};dj.util.Page.addScript("http://widget-cache.loomia.com/js/onewidget_clix.js");}};dojo.provide("dj.module.metaWeb");dojo.require("dj.lang");dj.module.metaWeb={init:function(){var djL=dj.lang,oEl=dojo.byId("suggest-input");oEl.value="Enter title, actor or director";dojo.connect(oEl,"onmouseover",this,this.addSuggest);var ev=djL.addLiveEvent("#suggest-input","click",function(){oEl.value="";djL.removeLiveEvent(ev);},this);},addSuggest:function(){if(this.isJsAdded){return;}
var uri="http://wfilm.freebaseapps.com/freebase_suggest_v2_min_js",d=document,oHd=d.getElementsByTagName("head")[0],el=dojo.create("script",{"src":uri});oHd.appendChild(el);var jsNode=dojo.create("link",{"type":"text/css","rel":"stylesheet","href":"http://wfilm.freebaseapps.com/freebase_suggest_css"});if(d.getElementsByTagName("head").length===0){var headNode=dojo.create("head");d.getElementsByTagName("html")[0].appendChild(headNode);}
d.getElementsByTagName("head")[0].appendChild(jsNode);this.isJsAdded=true;}};dojo.provide("dj.module.mostPopularTab");dojo.require("dj.widget.panels.virtual.Tabs");dj.module.mostPopularTab={init:function(coreOptions){var _tabIds=["mostRead","mostEmailed","mostPopularVideo","mostCommented","mostSearched"];var pnlConf={core:{panelPrefix:"mostPopularTab_panel_",panels:_tabIds},tabs:{tabPrefix:"mostPopularTab_tab_",tabOnStyle:"selectedTab",tabOffStyle:"deselected"}};if(coreOptions){pnlConf.core=dojo.mixin(pnlConf.core,coreOptions);}
this.pnl=dj.widget.panels.PanelsFactory.create("mostPopularTab",pnlConf);var that=this;var pnlRssConf={core:{panelPrefix:"mostPopularTab_rssPanel_",panels:_tabIds,controller:that.pnl}};if(coreOptions){pnlRssConf.core=dojo.mixin(pnlRssConf.core,coreOptions);}
this.pnlRss=dj.widget.panels.PanelsFactory.create("mostPopularTab",pnlRssConf);}};dojo.provide("dj.module.newsTicker");dojo.require("dj.widget.panels.virtual.Carousel");dj.module.newsTicker={init:function(config){if(typeof this.ticker=="object"){this.ticker.update();}else{this.ticker=this.createTicker(config);}},createTicker:function(config){var cfg=dojo.deepMixin({container:"newsTicker",assassinContainer:"topBanner",containerClass:"headlineSummary newsTicker newsTickerBg"},config);var containerNode=dojo.byId(cfg.container);containerNode.className=cfg.containerClass;var ticker=dj.widget.panels.PanelsFactory.create(containerNode,{carousel:{type:"circular",prevButtonEnabledStyle:"",nextButtonEnabledStyle:""},rotator:{rotateTime:8}});return ticker;}};dojo.provide("dj.module.rssBlogTimes");dojo.require("dj.util.Element");dj.module.rssBlogTimes={init:function(getClasses){var timeStamps=dojo.query(getClasses);if(timeStamps.length===0){console.log("{dj.module.xslTimestamp} no timestamps found.");return;}
for(var i=0,timeStamp;timeStamp=timeStamps[i++];){timeStamp=dj.util.Element.cleanWhitespace(timeStamp);var dur=this.calculateDuration(dojo.trim(timeStamp.innerHTML));dojo.empty(timeStamp);timeStamp.innerHTML=dur;}},calculateDuration:function(getPubDate){var today=new Date();var newDate=new Date(getPubDate);var getTimeDIff=Math.ceil(today.getTime()-newDate.getTime());var one_min=1000*60;var getMins=Math.ceil(getTimeDIff/one_min);var getOutput='';if(getMins<1){getOutput="1 min ago";}else if(getMins<59){getOutput="6 mins ago";}else if(getMins>60&&getMins<240){var getHrs=newDate.getHours();var getAMPM="";if(getHrs<=12){getAMPM=" am";}else{getHrs=(getHrs-12);getAMPM=" pm";}
getOutput=newDate.getHours()+":"+newDate.getMinutes()+getAMPM;}
return(getOutput==='')?null:getOutput;}};dojo.provide("dj.module.featuredListings");dojo.require("dj.lang");dojo.require("dj.util.AddressParser");(function(){dj.module.featuredListings={init:function(cfg){this.config={mod:"WSJ_NycArea_Properties_search"};this.formEl=dojo.byId("property-search-form-01");this.submitEl=dojo.query("input",this.formEl)[1];this.addressDefaultVal="City/State/Zip";this.addressEl=dojo.query("input",this.formEl)[0];dojo.mixin(this.config,cfg);this._load();},_load:function(){this.setInputDefault(this.addressEl);this.submitForm();},getValues:function(){var addressVal=this.addressEl.value;var maxPriceVal=dojo.query("select",this.formEl)[0].value;var parsedAddress=dj.util.AddressParser.parse(addressVal,true);return{city:parsedAddress.city,state:parsedAddress.state,zip:parsedAddress.zipCode,maxPrice:maxPriceVal};},setInputDefault:function(addressEl){var that=this;dojo.connect(addressEl,"onblur",this,function(ev){var field=(ev.srcElement||ev.target);if(field.value===""){field.value=that.addressDefaultVal;}});dojo.connect(addressEl,"onfocus",this,function(ev){var field=(ev.srcElement||ev.target);if(field.value===field.defaultValue){field.value="";}});},submitForm:function(){var that=this;dojo.connect(this.submitEl,"click",function(ev){dj.lang.stopEvent(ev);var values=that.getValues();var queryString="?qTerms=sell&qSearchTab=sell&qAction=search&qCity="+values.city+"&qState="+values.state+"&qZip="+values.zip+"&qMaxPrice="+values.maxPrice+"&mod="+that.config.mod;window.location="http://realestate.wsj.com/properties/search/results.php"+queryString;});}};}());dojo.provide("dj.module.propertySearchAsia");dojo.require("dj.lang");dojo.getObject("parser",true);var _djl=dj.lang;dj.module.propertySearchAsia={init:function(cfg){var config={searchType:"property"};_djl.deepMixin(config,cfg);this.configuration=config;this.countryType=0;this.sponsorLinkPlaceHolder=dojo.byId("sponsorLink");this.errorMessagePlaceHolder=dojo.byId("errorMessage");this.priceRange=dojo.byId("rePriceRange");this.propertySearchForm=dojo.byId("property-search-form");this.submitButton=dojo.byId("reAction");this.countryField=dojo.byId("reCountry");this.minPriceField=dojo.byId("reMinPrice");this.maxPriceField=dojo.byId("reMaxPrice");this.liveResultsDiv=dojo.byId("reLiveResultsDiv");this.transactionType="sell";if(this.configuration.searchType=="commercial"){this.transactionType="FSFL";}else{this.fillPrices(this.minPriceField,"Min");this.fillPrices(this.maxPriceField,"Max");}
this.setEvent();this.getLiveResults();},setEvent:function(){_djl.addLiveEvent(".toptabs","click",function(ev){var target=(ev.srcElement||ev.target);dojo.stopEvent(ev);this.setTabSelected(target.parentNode);this.getLiveResults();},this);dojo.connect(this.minPriceField,"onchange",this,function(){this.getLiveResults();});dojo.connect(this.maxPriceField,"onchange",this,function(){this.getLiveResults();});dojo.connect(this.countryField,"onchange",this,function(){this.getLiveResults();});dojo.connect(this.submitButton,"onclick",this,function(ev){dojo.stopEvent(ev);this.submitForm();});},getLiveResults:function(){this.identifySearchProvider();if(this.countryType==1)
this.displayLiveResults();else
this.liveResultsDiv.innerHTML="";},fillPrices:function(field,label){var sellValues=["500,000","600,000","700,000","800,000","900,000","1,000,000","1,500,000","2,000,000","2,500,000","3,000,000","3,500,000","4,000,000","4,500,000","5,000,000","6,000,000","7,000,000","8,000,000","9,000,000","10,000,000+"];var rentValues=["1,000","2,000","3,000","4,000","5,000","6,000","7,000","8,000","9,000","10,000","20,000","30,000","40,000","50,000","60,000","70,000","80,000","90,000","100,000","150,000","200,000","250,000"];var values=[];if(this.transactionType=="rent"){values=rentValues;}else if(this.transactionType=="sell"){values=sellValues;}
field.options.length=0;var optValue=0;var optLable='';var tempOption=null;optValue="";optLable=" "+label+" Price ($)";tempOption=document.createElement('option');tempOption.text=optLable;tempOption.value=optValue;field.options.add(tempOption);for(var i=0;i<values.length;i++){optValue=values[i].replace(",","").replace(",","");optLable=" $"+values[i];tempOption=document.createElement('option');tempOption.text=optLable;tempOption.value=optValue;field.options.add(tempOption);}},setTabSelected:function(target){var tabs=_djl.query(".toptabs");for(var i=tabs.length-1;i>=0;i--){dojo.removeClass(tabs[i],"selected");}
dojo.addClass(target,"selected");this.errorMessagePlaceHolder.innerHTML="";this.transactionType=target.id;this.fillPrices(this.minPriceField,"Min");this.fillPrices(this.maxPriceField,"Max");if(target.id=="foreclosures"&&this.priceRange){this.priceRange.style.display="none";this.sponsorLinkPlaceHolder.style.display="none";}else if(this.priceRange){this.priceRange.style.display="block";this.sponsorLinkPlaceHolder.style.display="block";}},hasDefaultValue:function(object){return(object.value===object.defaultValue);},hasDefaultValueOrEmpty:function(object){return(this.hasDefaultValue(object)||object.value=="");},clearAndNormalize:function(value){value=value.replace(/,/g,' ');value=value.replace(/[^a-zA-Z 0-9]+/g,'');value=value.toLowerCase();return value;},buildLocationStringForProperty:function(){var zipCode,state,city;var result={url:null,error:null};var terms="sell";var reqCountry="qCountry",reqMinPrice="qMinPrice",reqMaxPrice="qMaxPrice",reqTerms="qTerms",reqSearchtab="qSearchTab";if(this.transactionType=="rent"){terms="rent";}
var destinationURL="?qTerms="+terms;if(this.countryType=="1"){reqCountry="Location";reqMinPrice="PriceMin";reqMaxPrice="PriceMax";reqSearchtab="ListType";this.transactionType=="rent"||this.transactionType=="2"?this.transactionType="2":this.transactionType=1;this.propertySearchForm.action="http://wsj.propgoluxury.com/EN/Properties/";destinationURL+="&SubLocation=0&City=&Currency=33"}
else{destinationURL+="&qAction=search";if(this.transactionType=="foreclosures"){destinationURL+="&qAuction=1";}
this.propertySearchForm.action="http://realestate.wsj.com/properties/search/results.php";}
destinationURL+="&"+reqSearchtab+"="+this.transactionType;if(!this.hasDefaultValueOrEmpty(this.countryField)){destinationURL+="&"+reqCountry+"="+this.countryValue;}
if(this.hasDefaultValueOrEmpty(this.minPriceField))
{destinationURL+="&"+reqMinPrice+"=";}
else if(this.minPriceField.value=="10000000+")
{destinationURL+="&"+reqMinPrice+"=10000000";}
else
{destinationURL+="&"+reqMinPrice+"="+this.minPriceField.value;}
if((this.hasDefaultValueOrEmpty(this.maxPriceField)||this.maxPriceField.value=="10000000+"))
{destinationURL+="&"+reqMaxPrice+"=";}
else
{destinationURL+="&"+reqMaxPrice+"="+this.maxPriceField.value;}
result.url=destinationURL;return result;},identifySearchProvider:function(){this.countryValue=this.countryField.value;if(this.countryValue=="China"||this.countryValue=="Fiji"||this.countryValue=="Hong Kong"||this.countryValue=="Indonesia"||this.countryValue=="Japan"||this.countryValue=="Malaysia"||this.countryValue=="SaintBarthelemy"||this.countryValue=="Singapore"||this.countryValue=="Thailand"||this.countryValue=="Vietnam")
{this.countryType="1";switch(this.countryValue)
{case"China":this.countryValue="1500";break;case"Fiji":this.countryValue="2500";break;case"Hong Kong":this.countryValue="9300";break;case"Indonesia":this.countryValue="3600";break;case"Japan":this.countryValue="4200";break;case"Malaysia":this.countryValue="4700";break;case"SaintBarthelemy":this.countryValue="7300";break;case"Singapore":this.countryValue="9500";break;case"Thailand":this.countryValue="7700";break;case"Vietnam":this.countryValue="8900";}}else{this.countryType=0;}},displayLiveResults:function(){var liveSearchURL="/PropGo"+(this.buildLocationStringForProperty()).url;var liveResultsDiv=this.liveResultsDiv;dojo.xhrGet({url:liveSearchURL,handleAs:"text",timeout:4500,load:function(response,ioArgs){liveResultsDiv.innerHTML="Live Results : "+response;return response;}});},submitForm:function(){this.identifySearchProvider();var destinationParameters=this.buildLocationStringForProperty();var destinationURL=this.propertySearchForm.action;if(destinationParameters.error){this.errorMessagePlaceHolder.innerHTML="<p>"+destinationParameters.error+"</p>";}else{window.location.href=destinationURL+destinationParameters.url;}}};dojo.provide("dj.module.emailSignUp");dojo.require("dj.util.Query");dojo.require("dj.util.Region");dojo.require("dj.util.User");dj.module.emailSignUp={init:function(){this.isPartner=dojo.hasClass(document.getElementsByTagName("div")[0],'subType-partner');if(this.isPartner){this.oEmailSignUpNonSub=dojo.byId('emailSignUpNonSub');this.oEmailSignUpNonSub.getElementsByTagName('a')[0].href='/pznsetup/pub/email/setup.html';}
this.oContainers=dojo.query("div.emailSignUp");this.oContainers.forEach(function(el){this.initializeContainer(el);},this);},initializeContainer:function(oContainer){if(oContainer!==null){this.setUpControllers(oContainer);dj.util.Query.down(oContainer,".userLoginName").setAttribute('id','emailFNameLName');dj.util.User.renderCallsign('emailFNameLName');this.setSpanishTexts(oContainer);}},setSpanishTexts:function(oContainer){if(dj.util.Query.down(oContainer,"h3").innerHTML.indexOf("Spanish")!==-1){dj.util.Query.down(oContainer,"h3").innerHTML="Bolet&iacute;n de Noticias WSJ Americas";dj.util.Query.down(oContainer,"p").innerHTML="Suscr&iacute;base al bolet&iacute;n de The Wall Street Journal Americas para recibir en su email una selecci&oacute;n diaria de las principales noticias, an&aacute;lisis, columnas y video en espa&ntilde;ol.";var name=dj.util.Query.down(oContainer,".successMessage p strong").innerHTML;dj.util.Query.down(oContainer,".successMessage p").innerHTML="Gracias <strong>"+name
+"!</strong><br/>Usted recibir&aacute; el "
+"<span class='displayNames'>Boletn de Noticias de WSJ Americas</span>"+"en su bandeja de entrada.";}},setUpControllers:function(oContainer){var region=dj.util.Region.getViewByRegion();this.oemailSignUpSubmit=dj.util.Query.down(oContainer,".emailSignUpSubmit");var tcontainer=dj.util.Query.up(this.oemailSignUpSubmit,"span");if(region=="germany"&&tcontainer!==dojo.doc&&dojo.hasClass(tcontainer,"visibility-onlyUnSubNotReg")){dojo.addClass(this.oemailSignUpSubmit,"registerUserClass");}else{var that=this;dojo.connect(this.oemailSignUpSubmit,"onclick",this,function(ev){dojo.stopEvent(ev);this.signUp(oContainer);});dojo.connect(dj.util.Query.down(oContainer,".txtEmail"),"onclick",null,function(ev){this.value="";});}},signUp:function(oContainer){this.oContent=dj.util.Query.down(oContainer,".mainContent");this.oContentForm=dj.util.Query.down(this.oContent,"form");this.oMessageSuccess=dj.util.Query.down(oContainer,".successMessage");this.oMessageError=dj.util.Query.down(this.oContent,".errorMessage");this.oemailSignUpSubmit=dj.util.Query.down(oContainer,".emailSignUpSubmit");this.txtEmail=dj.util.Query.down(oContainer,".txtEmail");this.hiddenClass="hidden";this.signUpUrl="/emailservice/email-signup";this.userLoginName="";var that=this;dj.util.User.getUserId(function(userId){that.userLoginName=userId;});this.oEmail=dj.util.Query.down(oContainer,".userEmail");console.info("email signup - email address div element is "+this.oEmail);dj.util.User.renderEmailAddress(this.oEmail);this.userEmail=this.oEmail.innerHTML;console.info("email signup - email address is "+this.userEmail);this.displayNames="";if(this.txtEmail.value===''||this.txtEmail.value==="Please enter your email"){this.txtEmail.value="Please enter your email";return;}
this.postBody=this.buildPostBody();if(this.displayNames===""){return;}
this.displayNames=this.displayNames+"&nbsp;";this.request=dojo.xhrPost({url:this.signUpUrl,postData:that.postBody,handleAs:"xml",headers:{"Content-Type":"text/xml"},error:function(error,ioArgs){if(409==ioArgs.xhr.status){that.showError();}else if(ioArgs.xhr.status>500&&ioArgs.xhr.status<600){that.showContent();console.error("{emailSignUp} error %s - server error",ioArgs.xhr.status);}},load:function(data,ioArgs){that.showSuccess(oContainer);}});},buildPostBody:function(){if(this.txtEmail.value!=="Enter Your Email Address"){this.userEmail=this.txtEmail.value;}
var isReg=false;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dj.util.User.isSubLoggedIn(function(subLoggedIn){if(!subLoggedIn){isReg=true;}});}});var isEnt=false;dj.util.User.hasRole('WSJ-ENT',function(hasRole){if(hasRole){isEnt=true;}});var isCfo=false;dj.util.User.hasRole('WSJ-CFO-PRO',function(hasRole){if(hasRole){isCfo=true;}});dj.util.User.hasRole('WSJ-ENT-CFO',function(hasRole){if(hasRole){isCfo=true;}});dj.util.User.hasRole('WSJ-CFO-PRO-TRIAL',function(hasRole){if(hasRole){isCfo=true;}});var isPro=false;dj.util.User.hasRole('WSJ-PRO',function(hasRole){if(hasRole){isPro=true;}});var region=dj.util.Region.getViewByRegion();var x=[];x[x.length]="<customer>";x[x.length]="<login-name>"+this.userLoginName+"</login-name>";x[x.length]="<contacts class=\"java.util.ArrayList\">";x[x.length]="<contact><last-modified-by>"+this.userLoginName+"</last-modified-by><contact-address>"
+this.userEmail+"</contact-address><contact-status>V</contact-status>";x[x.length]="<bulk-emails class=\"java.util.ArrayList\">";var oForm=dojo.formToObject(this.oContentForm);for(var el in oForm){if(oForm.hasOwnProperty(el)){if(el.indexOf("checkbox")===0){var id=oForm[el];if(oForm[el]==="88"){if(region==="europe"){id="169";}else if(region==="asia"){id="167";}else if(region==="asia,india"){id="172";}else{}}else if(oForm[el]==="89"){if(region==="europe"){id="170";}else if(region==="asia"){id="168";}else if(region==="asia,india"){id="173";}else{}}
x[x.length]="<bulk-email><opt-in-flag>1</opt-in-flag><email-type-id>"+id
+"</email-type-id></bulk-email>";var temp=oForm["displayName"+oForm[el]];if(temp){if(temp.indexOf("In Spanish")!==-1){temp="Bolet&iacute;n de Noticias de WSJ Americas";}
if(this.displayNames===""){this.displayNames=temp;}else{this.displayNames=this.displayNames+" and "+temp;}}}}}
x[x.length]="</bulk-emails>";x[x.length]="</contact>";x[x.length]="</contacts>";x[x.length]="<products class=\"java.util.ArrayList\">";if(isEnt){x[x.length]="<product><id>501</id><name>WSJ ENT</name><description>WSJ Enterprise Product</description></product>";}else if(isReg){x[x.length]="<product><id>301</id><name>WSJ</name><description>WSJ Email Product</description></product>";}else if(isCfo){x[x.length]="<product><id>101</id><name>WSJ</name><description>CFO Professional Product</description></product>";}else if(isPro){x[x.length]="<product><id>821</id><name>WSJ</name><description>WSJ Professional Product</description></product>";}else{x[x.length]="<product><id>2</id><name>WSJ</name><description>WSJ Email Product</description></product>";}
x[x.length]="</products>";x[x.length]="</customer>";x=x.join('\n');return x;},showSuccess:function(oContainer){var that=this;dojo.query(".userLoginName",oContainer).forEach(function(el){el.innerHTML=dj.util.Query.down(dojo.query("div.emailSignUp")[0],".userLoginName").innerHTML;console.info("name is "+el.innerHTML);});dojo.query(".displayNames",oContainer).forEach(function(el){el.innerHTML=this.displayNames;},this);dojo.addClass(this.oContent,this.hiddenClass);dojo.addClass(this.oMessageError,this.hiddenClass);dojo.removeClass(this.oMessageSuccess,this.hiddenClass);},showError:function(){this.userEmail="";dojo.removeClass(this.oContent,this.hiddenClass);dojo.addClass(this.oMessageSuccess,this.hiddenClass);dojo.removeClass(this.oMessageError,this.hiddenClass);},showContent:function(){dojo.addClass(this.oMessageSuccess,this.hiddenClass);dojo.addClass(this.oMessageError,this.hiddenClass);dojo.removeClass(this.oContent,this.hiddenClass);}};dojo.provide("dj.module.newsReel");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Page");dojo.require("dj.widget.panels.virtual.Carousel");dj.module.newsReel={REEL_STATE:{FULL:0,COLLAPSED:1,SMALL:2},reelState:0,reelHeight:0,isAnimation:false,cfg:{reelOpenClass:"reelState-open",reelClosedClass:"reelState-closed",btnSelectedClass:"selected",stateCookieName:"newsReel_state",currentArticleClass:"currentArticle",currentPointerClass:"current",newsReelPointerClass:".newsreelPointer",reelLoadedClass:"reelState-loaded"},oCnt:null,cntId:null,init:function(newsreelContainer,adRegisterKey){this.oCnt=dojo.byId(newsreelContainer);if(this.oCnt===null){throw new Error("{newsReel} container is not located.");}
dojo.addClass(this.oCnt,this.cfg.reelLoadedClass);this.currentArticle=null;var defState=this.REEL_STATE;this.reelState=defState.FULL;this.reel=this.initReel(this.oCnt);if(typeof adRegisterKey==='undefined'||adRegisterKey===null||adRegisterKey===''){return;}
try{this.initNewsReelAds(adRegisterKey,this.oCnt);}catch(e){console.error("{newsReel} ads error: "+e);}},setId:function(newsreelContainer){this.cntId=newsreelContainer;},update:function(){this.init(this.cntId);return this;},initReel:function(cnt){var reel=dj.widget.panels.PanelsFactory.create(cnt,{core:{panelGroup:"#newsReelContent > .reelContentTree .unitList",panel:"li",viewArea:4},carousel:{navContainer:".reelNav",prevButton:".newsreel_prev",nextButton:".newsreel_next",type:"circular"}});var vid=this._setCurrentPanelActive(cnt);if(vid===null){return reel;}
this.reelPtrCnt=dojo.query(this.cfg.newsReelPointerClass,cnt)[0];var pans=dojo.query(".newsreel_pointer_container li",this.reelPtrCnt);dojo.addClass(pans[vid],this.cfg.currentPointerClass);if(dojo.query(".unit.sponsor").children().first()[0]){var element=pans[0];var grp=element.parentNode;var clone=dojo.create(element.tagName,{"className":element.className,innerHTML:element.innerHTML});grp.appendChild(clone);}
var reelPtr=dj.widget.panels.PanelsFactory.create(this.reelPtrCnt,{core:{panelGroup:".newsreel_pointer_container",panel:"li",viewArea:4,controller:reel},carousel:{type:"circular"}});if(reel.getNumberOfPanels()>3){try{var vidPosition=reel.getById(vid).getPosition();reel.setActiveByPosition(vidPosition+1);}catch(e){console.error("{newsReel} cannot scroll to invalid panel id: "+vid);}}
return reel;},_setCurrentPanelActive:function(cnt){var artCurrent=((typeof AT_VARS==="object"&&AT_VARS.baseDocId)?AT_VARS.baseDocId:dj.util.Page.getQueryParam('baseDocId'));var vid=null;var that=this;dojo.query("#newsReelContent > .reelContentTree .unitList .unit",cnt).forEach(function(el,pos){var anch=dojo.query("a",el)[0];if((typeof anch!=='undefined')&&(anch.href!==null)&&(anch.href.indexOf(artCurrent)!==-1)){vid=pos;dojo.addClass(dojo.byId(el),that.cfg.currentPointerClass);}});return vid;},initNewsReelAds:function(adRegisterKey,newsReelContainer){var adId="";dojo.query("#newsReelContent .newsReelAd",newsReelContainer).forEach(function(el){dj.widget.ad.AdManager.loadAds(adRegisterKey,{id:el.getAttribute("id")});});}};dojo.provide("dj.module.articleFreeRegScrim");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dojo.require("dj.util.Element");dojo.require("dj.util.Query");dojo.require("dj.util.Url");dj.module.articleFreeRegScrim={init:function(){var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(!isLoggedIn){if(document.location.href.indexOf(".wsj.com/article")!==-1){that.checkReferrerSite();}}});},checkReferrerSite:function(cfg){var that=this;this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);var freeArticleCookie=dj.util.Cookie.getGroupCookie("DJSESSION","FREEREGSCRIMCOUNT");var ref=document.referrer;if(freeArticleCookie==null&&isTrial==="true"&&ref.indexOf("google")>0)
{freeArticleCookie=0;}
if(((freeArticleCookie!==""||freeArticleCookie!==null)&&freeArticleCookie=="0"&&isFree==="true"&&(isTrial==="false"&&ref.indexOf('wsj.com/article')>0))){freeArticleCookie=1;that.setupArticleFreeRegScrim();}
dj.util.Cookie.setGroupCookie("DJSESSION","FREEREGSCRIMCOUNT",freeArticleCookie);},DEFAULT_CONFIG:{y:null,z:null},setupArticleFreeRegScrim:function(){var that=this;var pos=dojo.position('article_story_body',true);var getArticleDim="";var getConfirmContent=dojo.byId('fr_confirm').innerHTML;var newConfirmContent="";if(getConfirmContent.match(/id=\"/g)){newConfirmContent=getConfirmContent.replace(/id=\"/g,'id=\"artScrim_');}else{newConfirmContent=getConfirmContent.replace(/id=/g,'id=artScrim_');}
var divContentStart='<div id="pmArticleFreereg" class="pmArticleFreereg" style="position:absolute;top:95px;left:0px;'+getArticleDim+'display:none;z-index: 1"><a id="close-btn" href="#" onclick="dj.module.articleFreeRegScrim.setupArticleCloseFreeReg(); return false">Close [x]</a><h2 id="regFormhTag">Sign up in seconds to gain <em>FREE access</em> to exclusive WSJ.com tools & features:</h2><ul id="pmArticleFreereg-bullets"  class="pmArticleFreereg-bullets"><li>Setup and manage your portfolio</li><li>Personalize your own news page</li><li>Receive and manage newsletters</li><li>Join the Journal Community</li></ul><div id="insetForm" class="inset inset-form"><div style="display: none;" name="fr_confirm" id="artScrim_fr_confirm" class="fr_content fr_confirm">'+newConfirmContent+'</div><div id="artScrim_fr_content" class="fr_content">';var divContentEnd='</div></div></div>';var articleText=dojo.byId('article_story_body').innerHTML;var registerFormHtml=dojo.query('.fr_formElements')[0].innerHTML;var newFormContent="";if(registerFormHtml.match(/id=\"/g)){newFormContent=registerFormHtml.replace(/id=\"/g,'id=\"artScrim_');}else{newFormContent=registerFormHtml.replace(/id=/g,'id=artScrim_');}
newFormContent=newFormContent.replace("<p>Please register to gain free access to WSJ tools.</p>","");newFormContent=newFormContent.replace("connectLinks-note-collapsed","connectLinks-note-collapsed hidden");dojo.byId('article_story_body').innerHTML=articleText+divContentStart+'<div class="fr_formElements">'+newFormContent+'</div>'+divContentEnd;var scrimType="artScrim_";this.displayDiv('pmArticleFreereg');this.oRegisterScrim_module=dj.lang.byId('pmArticleFreereg');this.oErrorScrimCount=0;this.http_requestScrim=false;this.oRegFieldScrimErrorMsgsValue="";this.oregFieldScrimErrorMsg=dj.lang.byId(scrimType+'oregFieldErrorMsg');this.oFr_text=dj.lang.byId('insetForm');this.oFr_confirm=dj.lang.byId(scrimType+'fr_confirm');this.oFr_content=dj.lang.byId(scrimType+'fr_content');this.oFreeRegistrationScrim_form=dj.lang.byId(scrimType+'freeRegistration_form');this.oFreeregScrimemailerrormsg=dj.lang.byId(scrimType+'freeregemailerrormsg');this.oFreeregScrimusererrormsg=dj.lang.byId(scrimType+'freeregusererrormsg');this.oFreeRegScrimServiceErrorMsg=dj.lang.byId(scrimType+'freeRegServiceErrorMsg');this.oFreeRegScrimSubButton=dj.lang.byId(scrimType+'freeRegSubButton');this.oFreeRegScrimEmail=dj.lang.byId(scrimType+'regemail');this.regScrimErrorCode=['userName-exists','userName-required','userName-invalid','firstName-required','firstName-invalid','lastName-required','lastName-invalid','emailAddress-exists','emailAddress-required','emailAddress-invalid','password-required','password-invalid','passwordConfirmation-invalid','userName-unique','emailAddress-unique','passwordConfirmation-required'];this.regErrorScrimValue=['Please enter your First Name.','Please enter your Last Name.','Please enter a valid email address.','Please create a Password.','Please confirm Password.','The email addresses do not match. Please re-enter both.','Passwords do not match.','Password must be 5-15 characters in length.','Confirm Password must be 5-15 characters in length.','','','Please Confirm Email.','First name contains invalid characters.','Last name contains invalid characters.'];this.regFieldName=[scrimType+'firstNameReg',scrimType+'lastNameReg',scrimType+'emailAddressReg',scrimType+'passwordReg',scrimType+'passwordConfirmationReg',scrimType+'emailAddressConfirmationReg',scrimType+'passwordConfirmationReg',scrimType+'passwordReg','passwordConfirmationReg',scrimType+'sendEmailsReg',scrimType+'jcommunityReg',scrimType+'emailAddressConfirmationReg',scrimType+'firstNameReg',scrimType+'lastNameReg',scrimType+'companySizeReg'];this.attachScrimEvents();this.setFreeRegScrimOmnitureCall(1);this.freeRegScrimResetForm();},setupArticleCloseFreeReg:function(){dojo.addClass(dojo.byId("pmArticleFreereg"),"hidden");},setFreeRegScrimOmnitureCall:function(numClicks){if(numClicks===undefined)
{numClicks=1;}
if(numClicks==1)
{setMetaData('pageName','WSJ_Reg_FreeRegScrimForm');setMetaData('atype','WSJ_Customer Resources_Reg_FreeRegScrimForm');}else if(numClicks==2){setMetaData('pageName','WSJ_Reg_FreeRegScrimThankYou');setMetaData('atype','WSJ_Customer Resources_Reg_FreeRegScrimThankYou');}
setMetaData('primaryproduct','Online Journal');setMetaData('ctype','marketing and support');setMetaData('qsymbol','');setMetaData('aheadline','');setMetaData('apage','WSJ_Customer Resources_Reg_FreeRegScrimForm');setMetaData('section','Customer Resources');setMetaData('subsection','WSJ Registration');setMetaData('basesection','WSJ_Customer Resources_Registration_FreeRet');setMetaData('csource','Customer Resources');setMetaData('apage','WSJ_Customer Resources_Registration_FreeRet');dj.util.Tracking.omniture.firePixel(true);},attachScrimEvents:function(){var textFields=dojo.query("input[type=text]",this.oFreeRegistrationScrim_form);var passfields=dojo.query("input[type=password]",this.oFreeRegistrationScrim_form);textFields.forEach(function(ipt){dojo.connect(ipt,"onfocus",this,function(ev){this.checkFreeRegScrimFocus(ipt.name);});},this);textFields.forEach(function(ipt){dojo.connect(ipt,"onblur",this,function(ev){this.checkFreeRegScrimFieldBlur(ipt.name);});},this);passfields.forEach(function(ipt){dojo.connect(ipt,"onfocus",this,function(ev){this.checkFreeRegScrimFocus(ipt.name);});},this);passfields.forEach(function(ipt){dojo.connect(ipt,"onblur",this,function(ev){this.checkFreeRegScrimFieldBlur(ipt.name);});},this);this.oimagefields=dojo.query("input[type=image]",this.oFreeRegistrationScrim_form);this.oimagefields.forEach(function(ipt){dojo.connect(ipt,"onclick",this,function(ev){this.submitregScrimForm();});},this);this.okButtonClicked=dojo.query("input[class=okButton]",this.oFreeRegConfirm);this.okButtonClicked.forEach(function(ipt){dojo.connect(ipt,"onclick",this,function(ev){this.setupArticleCloseFreeReg();this.closeRegScrimSuccessBlock();});},this);},displayDiv:function(scrimDiv){this.VarX=dojo.byId(scrimDiv);this.VarX.style.zIndex=1000000000;this.VarX.style.display='block';},freeRegScrimResetForm:function(){this.closeRegScrimOtherBlock(1);this.oFreeRegistrationScrim_form.reset();dj.util.Element.hide(this.oFr_confirm);dj.util.Element.hide(this.oregFieldScrimErrorMsg);this.oRegFieldScrimErrorMsgsValue="";this.oFreeRegScrimSubButton.disabled=false;dj.util.Element.hide(this.oFreeregScrimemailerrormsg);dj.util.Element.hide(this.oFreeRegScrimServiceErrorMsg);dj.util.Element.hide(this.oFreeregScrimusererrormsg);this.oFreeRegistrationScrim_form[this.regFieldName[0]].style.backgroundColor='#ffffff';this.oFreeRegistrationScrim_form[this.regFieldName[1]].style.backgroundColor='#ffffff';this.oFreeRegistrationScrim_form[this.regFieldName[2]].style.backgroundColor='#ffffff';this.oFreeRegistrationScrim_form[this.regFieldName[3]].style.backgroundColor='#ffffff';this.oFreeRegistrationScrim_form[this.regFieldName[4]].style.backgroundColor='#ffffff';this.oFreeRegistrationScrim_form[this.regFieldName[5]].style.backgroundColor='#ffffff';},closeRegScrimSuccessBlock:function(){dj.util.Element.hide('regFormhTag');dj.util.Element.hide('pmArticleFreereg-bullets');this.setFreeRegScrimOmnitureCall(2);},closeRegScrimOtherBlock:function(val){if(val===1){dj.util.Element.show(this.oRegisterScrim_module);dj.util.Element.show(this.oFr_text);dj.util.Element.hide(this.oFr_confirm);}
if(val===2){dj.util.Element.hide(this.oRegisterScrim_module);}},checkFreeRegScrimFieldBlur:function(oregFieldname){this.ofieldName=this.oFreeRegistrationScrim_form[oregFieldname];this.ofieldValue=this.ofieldName.value;if(/^\s*$/.test(this.ofieldValue)){this.oErrorScrimCount=1;this.oFreeRegScrimSubButton.disabled=false;}else{this.ofieldName.style.color='#000000';this.ofieldName.style.backgroundColor='#ffffff';this.ofieldName.value=dojo.trim(this.ofieldValue);}},checkFreeRegBlur:function(oregFieldnumber){this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[oregFieldnumber]];this.ofieldValue=this.ofieldName.value;if(/^\s*$/.test(this.ofieldValue)){this.changeFieldValue(oregFieldnumber);this.oErrorScrimCount=1;this.oFreeRegScrimSubButton.disabled=false;}else{this.ofieldName.style.color='#000000';this.ofieldName.style.backgroundColor='#ffffff';this.ofieldName.value=dojo.trim(this.ofieldValue);}},checkFreeRegScrimFocus:function(oregFieldname){this.ofieldName=this.oFreeRegistrationScrim_form[oregFieldname];this.ofieldName.style.color="#000000";this.ofieldName.style.backgroundColor="#ffffff";},compareFreeRegEmail:function(){this.oEmailfieldValue=this.oFreeRegistrationScrim_form[this.regFieldName[2]].value;this.oEmailfieldConfValue=this.oFreeRegistrationScrim_form[this.regFieldName[5]].value;if((this.oEmailfieldValue!=''&&this.oEmailfieldConfValue!='')&&(this.oEmailfieldValue!==this.oEmailfieldConfValue)){this.changeFieldValue(5);this.oFreeRegScrimSubButton.disabled=false;this.oErrorScrimCount=1;}},compareFreeRegPassword:function(){this.oPassfieldValue=this.oFreeRegistrationScrim_form[this.regFieldName[3]].value;this.oCPassfieldValue=this.oFreeRegistrationScrim_form[this.regFieldName[4]].value;if(this.oPassfieldValue!==this.oCPassfieldValue){this.changeFieldValue(6);this.oFreeRegScrimSubButton.disabled=false;this.oErrorScrimCount=1;}},changeFieldValue:function(oregFieldnumber){dj.util.Element.show(this.oregFieldScrimErrorMsg);this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[oregFieldnumber]];this.oRegFieldScrimErrorMsgsValue+=" "+this.regErrorScrimValue[oregFieldnumber];this.ofieldName.style.color='#ff0000';this.ofieldName.style.backgroundColor='#fff28d';},responseErrorData:function(responseData){var that=this;var oshow=0;var profileErrors=responseData.profile.errors;var emailAddressVal=profileErrors.emailAddress;var userNameVal=profileErrors.userName;var firstNameVal=profileErrors.firstName;var lastNameVal=profileErrors.lastName;var passwordVal=profileErrors.password;var compasswordVal=profileErrors.passwordConfirmation;if(emailAddressVal!==null&&emailAddressVal!==undefined){if(this.regScrimErrorCode[7]===emailAddressVal||this.regScrimErrorCode[14]===emailAddressVal){dj.util.Element.show(this.oFreeregScrimemailerrormsg);this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[2]];this.ofieldName.style.backgroundColor='#fff28d';}else{this.changeFieldValue(2);oshow=1;}}
if(userNameVal!==null&&userNameVal!==undefined){if(this.regScrimErrorCode[0]===userNameVal||this.regScrimErrorCode[13]===userNameVal){dj.util.Element.show(this.oFreeregScrimusererrormsg);this.ofieldName=this.oFreeRegistrationScrim_form[this.regFieldName[5]];this.ofieldName.style.backgroundColor='#fff28d';}else{this.changeFieldValue(5);oshow=1;}}
if(firstNameVal!==null&&firstNameVal!==undefined){this.changeFieldValue(0);oshow=1;}
if(lastNameVal!==null&&lastNameVal!==undefined){this.changeFieldValue(1);oshow=1;}
if(passwordVal!==null&&passwordVal!==undefined){if(passwordVal===this.regScrimErrorCode[11]){this.changeFieldValue(7);}else{this.changeFieldValue(3);}
oshow=1;}
if(compasswordVal!==null&&compasswordVal!==undefined){if(compasswordVal===this.regScrimErrorCode[12]){this.changeFieldValue(8);}else{this.changeFieldValue(4);}
oshow=1;}
if(oshow===1){dj.util.Element.show(this.oregFieldScrimErrorMsg);this.oregFieldScrimErrorMsg.innerHTML="<p>"+this.oRegFieldScrimErrorMsgsValue+"</p>";}},freeRegScrimRequest:function(){this.ofirstName=this.oFreeRegistrationScrim_form[this.regFieldName[0]].value;this.olastName=this.oFreeRegistrationScrim_form[this.regFieldName[1]].value;this.oemailName=this.oFreeRegistrationScrim_form[this.regFieldName[2]].value;this.opassName=this.oFreeRegistrationScrim_form[this.regFieldName[3]].value;this.ocpassName=this.oFreeRegistrationScrim_form[this.regFieldName[4]].value;this.oemailConfName=this.oFreeRegistrationScrim_form[this.regFieldName[5]].value;this.oFeatureEmail=true;this.oCommunityProfile=this.oFreeRegistrationScrim_form[this.regFieldName[10]].checked;this.ocompanySize=this.oFreeRegistrationScrim_form[this.regFieldName[14]].value;if(this.ocompanySize.length===0||this.ocompanySize===null){this.data={'profile.firstName':this.ofirstName,'profile.lastName':this.olastName,'profile.emailAddress':this.oemailName.toLowerCase(),'profile.password':this.opassName,'profile.passwordConfirmation':this.ocpassName,'service.templateCode':'WSJ','service.registrationType':'FREE_REGISTRATION','profile.options.returnLink':window.location.href,'profile.options.featureEmailOptIn':this.oFeatureEmail,'profile.trackingCode':'FREEREGSCRIM'};}
else{this.data={'profile.firstName':this.ofirstName,'profile.lastName':this.olastName,'profile.emailAddress':this.oemailName.toLowerCase(),'profile.password':this.opassName,'profile.passwordConfirmation':this.ocpassName,'service.templateCode':'WSJ','service.registrationType':'FREE_REGISTRATION','profile.options.returnLink':window.location.href,'profile.options.featureEmailOptIn':this.oFeatureEmail,'profile.demographics.questionId1':this.opassQuestion,'profile.demographics.answer1':this.ocompanySize,'profile.trackingCode':'FREEREGSCRIM'};}
var that=this;var request=dojo.xhrPost({url:"/epiton/registration/v2/profile",handleAs:"json",headers:{Accept:"application/json"},postData:dojo.objectToQuery(this.data),handle:function(data,ioargs){if(ioargs.xhr.status===200){that.oFreeRegScrimEmail.innerHTML=that.oemailName;dojo.addClass(dojo.byId("pmArticleFreereg"),"confirmation-page");dj.util.Element.hide('regFormhTag');dj.util.Element.hide('pmArticleFreereg-bullets');dj.util.Element.hide(that.oFr_content);dj.util.Element.show(that.oFr_confirm);}else if(ioargs.xhr.status===412){var responseData=eval('('+ioargs.xhr.responseText+')');that.oFreeRegScrimSubButton.disabled=false;that.responseErrorData(responseData);}else if(ioargs.xhr.status===500||ioargs.xhr.status===404){that.oFreeRegScrimSubButton.disabled=false;dj.util.Element.show(that.oFreeRegScrimServiceErrorMsg);}else{that.oFreeRegScrimSubButton.disabled=false;dj.util.Element.show(that.oFreeRegScrimServiceErrorMsg);}}});},submitregScrimForm:function(){this.oErrorScrimCount=0;this.oRegFieldScrimErrorMsgsValue="";dj.util.Element.hide(this.oFreeregScrimemailerrormsg);dj.util.Element.hide(this.oFreeregScrimusererrormsg);dj.util.Element.hide(this.oFreeRegScrimServiceErrorMsg);this.oFreeRegScrimSubButton.disabled=true;this.checkFreeRegBlur(0);this.checkFreeRegBlur(1);this.checkFreeRegBlur(2);this.checkFreeRegBlur(11);this.checkFreeRegBlur(3);this.checkFreeRegBlur(4);this.compareFreeRegEmail();this.compareFreeRegPassword();if(this.oErrorScrimCount===0){this.oRegFieldScrimErrorMsgsValue="";}
if(this.oErrorScrimCount>0){this.oregFieldScrimErrorMsg.innerHTML="<p>"+this.oRegFieldScrimErrorMsgsValue+"</p>";dj.util.Element.show(this.oregFieldScrimErrorMsg);this.oFreeRegScrimSubButton.disabled=false;return false;}else{this.oFreeRegScrimSubButton.disabled=true;dj.util.Element.hide(this.oregFieldScrimErrorMsg);this.oRegFieldScrimErrorMsgsValue="";this.oregFieldScrimErrorMsg.innerHTML="";this.freeRegScrimRequest();return false;}
return false;}};dojo.provide("dj.module.globalHeader");dojo.deprecated("dj.module.globalHeader","use the one in the 'header' bundle","0.7");dojo.require("dj.lang");dojo.require("dj.util.Config");dojo.require("dj.util.Cookie");dojo.require("dj.util.Date");dojo.require("dj.util.Region");dojo.require("dj.util.Element");dojo.require("dj.util.User");dj.module.globalHeader=function(){var DEFAULT_CONFIG={HEADER_CONTAINER_CLASS:".header",TIMESTAMP_CLASS:".date",WSJ_LOGO_ID:"wsjLogo",WSJ_LARGE_LOGO_CLASSNAME:"logo_large",WSJ_SMALL_LOGO_CLASSNAME:"logo_small",CURRENT_SUBSECTION_DISPLAY_CLASS:".currentSubSection",GLOBALNAV_SUBSECTION_ELEMENT_ID:"currentGlobalNavSubSection",SUBSCRIBER_LOGIN_CLASS:".login",HEADER_PROMO_CLASS:".promo",SUBSCRIBER_DETAILS_ELEMENT_ID:"subscribedUserDetailsId",COMMUNITY_FORUMS_LINK_CLASS:".communityForumsLink",TODAYS_PAPER_LINK_CLASS:".todaysPaperLink",MOJ_LINK_CLASS:".myOnlineJournalLink",MESSAGE_CENTER_LINK_CLASS:".messageCenterLink",MESSAGE_COUNT_CLASS:".messageCount",LOGIN_USERNAME_ELEMENT_ID:"login_username",LOGIN_PASSWORD_ELEMENT_ID:"login_password",LOGIN_FORM_ID:"login_form",PAGE_URL_ELEMENT_ID:"page_url",LOGOUT_LINK_ELEMENT_ID:"logoutLink",LOGIN_BUTTON_ELEMENT_ID:"login_button",USER_NAME_ELEMENT_ID:"userName",WSJ_LOGO_FADE_APPEAR_DURATION:"1.0",WSJ_LOGO_DELAY_DURATION:"2000",LOGGED_IN_COMMUNITY_URL:"/community",LOGGED_IN_TODAYS_PAPER_URL:"/itp?mod=WSJ_formfactor",MESSAGE_CENTER_POST_URL:"/community/integration/userinfo.html",LOGOUT_URL:"/static_html_files/logout_confirmation.htm",SUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001",NONSUBSCRIBER_HOMEPAGE_PID:"0_0_WH_0001_public",ASIA_PAGE_PID:"0_0_WP_2103",EUROPE_PAGE_PID:"0_0_WP_2104",NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID:"5_6007",NONSUBSCRIBER_SEARCH_PAGE_PID:"3_0466",HOMEPAGE_SUBSCRIBER_URL:"/",SEARCH_PAGE_SUBSCRIBER_URL:"/search",TODAYS_PAPER_LINK_CONTAINER_CLASS:".todaysPaperLinkContainer",VIDEO_LINK_CONTAINER_CLASS:".videoLinkContainer",COLUMNS_LINK_CONTAINER_CLASS:".columnsLinkContainer",BLOGS_LINK_CONTAINER_CLASS:".blogsLinkContainer",INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS:".interactiveGraphicsLinkContainer",TOPICS_LINK_CONTAINER_CLASS:".topicsLinkContainer",COMMUNITY_FORUMS_LINK_CONTAINER_CLASS:".communityForumsLinkContainer",TODAYS_PAPER_PID:"0_0_WP_40",TODAYS_PAPER_US_NONSUB_PID:"2_0433",TODAYS_PAPER_EUROPE_NONSUB_PID:"2_0434",TODAYS_PAPER_ASIA_NONSUB_PID:"2_0435",TODAYS_PAPER_US_PID:"2_0133",TODAYS_PAPER_EUROPE_PID:"2_0134",TODAYS_PAPER_ASIA_PID:"2_0135",TODAYS_PAPER_PAST_EDITIONS_PID:"2_0233",TODAYS_PAPER_INDEX_BIZ_PID:"2_0156",TODAYS_PAPER_INDEX_PEOPLE_PID:"2_0155",TODAYS_PAPER_CORRECTIONS_PID:"Corrections",VIDEO_PID:"0_0_WP_3000",BLOGS_PID:"8_0019",COLUMNS_PID:"2_0140",INTERACTIVE_GRAPHICS_PID:"0_0_WP_2003",TOPICS_PID:"0_0_WT_0001",NEWSLETTERS_ALERTS_SUB_PID:"5_6001",NEWSLETTERS_ALERTS_PUB_PID:"5_6003",MOJ_LINK_URL:"/page/my-journal-main.html",MDC_LINK_URL:"/mdc/page/marketsdata.html",MDC_PAGE_PID:"2_3000",COMMUNITY_HIGHLIGHT_COMPARE_URL:"/community",FORUMS_HIGHLIGHT_COMPARE_URL:"forums.wsj.com",FREE_REG_CLASS:".freereg",LOCATION_NAV_CLASS:".location_nav",LOCATION_NAV_COLLAPSED_CLASSNAME:"location_collapsed",LOCATION_NAV_EXPANDED_CLASSNAME:"location_expanded",US_EDITION_LINK_CLASS:".map_us",EU_EDITION_LINK_CLASS:".map_europe",ASIA_EDITION_LINK_CLASS:".map_asia",IN_EDITION_LINK_CLASS:".map_india",LOGGED_IN_TODAYS_PAPER_URL_ASIA:"/page/asia_in_todays_paper.html?mod=WSJ_formfactor",LOGGED_IN_TODAYS_PAPER_URL_EUROPE:"/page/europe_in_todays_paper.html?mod=WSJ_formfactor",US_EDITION_MDC_URL:"/marketsdata",EU_EDITION_MDC_URL:"/mdc/public/page/marketsdata_europe.html",ASIA_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",IN_EDITION_MDC_URL:"/mdc/public/page/marketsdata_asia.html",MDC_COMPARE_URL:"/mdc/",FOOTER_CONTAINER_CLASS:".pagefooter"};return{initialize:function(config){this.cfg=dj.lang.cloneMixin(DEFAULT_CONFIG,config);var headerContainerClass=this.cfg.HEADER_CONTAINER_CLASS;this.oHeader=dojo.query(headerContainerClass)[0];this.editionDropdownSetUp();this.displaySubSection();this.displayTimeStamp();var that=this;this.currRegion=dj.util.Region.getViewByRegion();this.concatURL='';if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){this.concatURL="http://"+gcDomain;}else{this.concatURL="http://"+document.domain;}
dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){that.displaySubscriberDetails();that.setupLogout();}else{that.setupLogin();var freeregClass=that.cfg.FREE_REG_CLASS;that.ofreereg=dojo.query(freeregClass,that.oHeader)[0];var registerModule=dojo.query("#register_module",that.ofreereg)[0];dojo.style(registerModule,{display:"none"});dojo.style(that.ofreereg,{display:"block"});var subscriberLoginClass=that.cfg.SUBSCRIBER_LOGIN_CLASS;that.oSubscriberLogin=dojo.query(subscriberLoginClass,that.oHeader)[0];var loginModule=dojo.query(".login_module",that.oSubscriberLogin)[0];dojo.style(loginModule,{display:"none"});dojo.style(that.oSubscriberLogin,{display:"block"});var headerPromoClass=that.cfg.HEADER_PROMO_CLASS;that.oHeaderPromo=dojo.query(headerPromoClass,that.oHeader)[0];dojo.style(that.oHeaderPromo,{display:"block"});}});this.highlightFormFactorLinks();var todaysPaperLinkClass=this.cfg.TODAYS_PAPER_LINK_CLASS;this.oTodaysPaperLink=dojo.query(todaysPaperLinkClass,this.oHeader)[0];var loggedInTodaysPaperUrl=this.cfg.LOGGED_IN_TODAYS_PAPER_URL;var loggedInTodaysPaperUrlAsia=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_ASIA;var loggedInTodaysPaperUrlEurope=this.cfg.LOGGED_IN_TODAYS_PAPER_URL_EUROPE;var currEdition="";if(this.currRegion=="asia"||this.currRegion=="asia,india"){loggedInTodaysPaperUrl=loggedInTodaysPaperUrlAsia;}else if(this.currRegion=="europe"){loggedInTodaysPaperUrl=loggedInTodaysPaperUrlEurope;}
if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){this.oTodaysPaperLink.href="http://"+gcDomain+loggedInTodaysPaperUrl;}else{this.oTodaysPaperLink.href=loggedInTodaysPaperUrl;}
var that=this;dj.util.User.isSubLoggedIn(function(subLoggedIn){if(!subLoggedIn){if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){that.oTodaysPaperLink.href="http://"+gcDomain+"/public"+loggedInTodaysPaperUrl;}else{that.oTodaysPaperLink.href="/public"+loggedInTodaysPaperUrl;}}});},toggleDropdownClass:function(){var selLocDrpdwnCollapsedClassName=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME;var selLocDrpdwnExpandedClassName=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;if(dojo.hasClass(this.oLocDropDownContainer,selLocDrpdwnCollapsedClassName)){dojo.removeClass(this.oLocDropDownContainer,selLocDrpdwnCollapsedClassName);dojo.addClass(this.oLocDropDownContainer,selLocDrpdwnExpandedClassName);}else if(dojo.hasClass(this.oLocDropDownContainer,selLocDrpdwnExpandedClassName)){dojo.addClass(this.oLocDropDownContainer,selLocDrpdwnCollapsedClassName);}},editionDropdownSetUp:function(){var that=this;var locationNavClass=this.cfg.LOCATION_NAV_CLASS;this.oLocationNav=dojo.query(locationNavClass,this.oHeader)[0];var selLocDrpdwnCollapsedClassName=this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME;var selLocDrpdwnExpandedClassName=this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;var usEditionLinkClassName=this.cfg.US_EDITION_LINK_CLASS;var usEditionLinkClassName=this.cfg.US_EDITION_LINK_CLASS;var euEditionLinkClassName=this.cfg.EU_EDITION_LINK_CLASS;var inEditionLinkClassName=this.cfg.IN_EDITION_LINK_CLASS;var asiaEditionLinkClassName=this.cfg.ASIA_EDITION_LINK_CLASS;this.usEditionMDCUrl=this.cfg.US_EDITION_MDC_URL;this.euEditionMDCUrl=this.cfg.EU_EDITION_MDC_URL;this.inEditionMDCUrl=this.cfg.IN_EDITION_MDC_URL;this.asiaEditionMDCUrl=this.cfg.ASIA_EDITION_MDC_URL;var mdcCompareUrl=this.cfg.MDC_COMPARE_URL;this.oCurrentEdition=dojo.byId("currentEdition");this.oUsEdition=dojo.byId("usEdition");this.oEuEdition=dojo.byId("europeEdition");this.oInEdition=dojo.byId("indiaEdition");this.oAsiaEdition=dojo.byId("asiaEdition");this.oChiEdition=dojo.byId("chiEdition");this.oSpaEdition=dojo.byId("spaEdition");this.oPorEdition=dojo.byId("porEdition");this.osectionFooterSub=dojo.byId("hrefNonSubId");this.osectionFooterNonSub=dojo.byId("hrefSubId");this.oUsEditionFooter=dojo.byId("usEditionFooter");this.currRegion=dj.util.Region.getViewByRegion();var currEdition="";if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){this.tempConcatURL="http://"+gcDomain;}else{this.tempConcatURL="http://"+document.domain;}
this.isMDCPageFlag=((document.location.href!==null)&&(document.location.href!=="")&&(document.location.href.indexOf(mdcCompareUrl)!==-1));if(this.oUsEdition!==null){dojo.connect(this.oUsEdition,"onclick",this,function(ev){dojo.stopEvent(ev);dj.util.Region.setViewByRegion('na,us');dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home-page",365);window.location=(this.isMDCPageFlag)?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEdition.href;});}
if(this.oUsEditionFooter!==null){dojo.connect(this.oUsEditionFooter,"onclick",this,function(ev){dojo.stopEvent(ev);dj.util.Region.setViewByRegion('na,us');dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/us",365);window.location=(this.isMDCPageFlag)?this.tempConcatURL+this.usEditionMDCUrl:this.oUsEditionFooter.href;});}
if(this.oEuEdition!==null){dojo.connect(this.oEuEdition,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=(this.isMDCPageFlag)?this.tempConcatURL+this.euEditionMDCUrl:this.oEuEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("europe");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/europe",365);}});}
if(this.oInEdition!==null){dojo.connect(this.oInEdition,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=(this.isMDCPageFlag)?this.tempConcatURL+this.inEditionMDCUrl:this.oInEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia,india");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/india",365);}});}
if(this.oAsiaEdition!==null){dojo.connect(this.oAsiaEdition,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=(this.isMDCPageFlag)?this.tempConcatURL+this.asiaEditionMDCUrl:this.oAsiaEdition.href;if(this.isMDCPageFlag){dj.util.Region.setViewByRegion("asia");dj.util.Cookie.setGroupCookie("DJCOOKIE","HOMEPAGE","/home/asia",365);}});}
if(this.oChiEdition!==null){dojo.connect(this.oChiEdition,"onclick",this,function(ev){dojo.stopEvent(ev);window.open(this.oChiEdition.href);});}
if(this.oSpaEdition!==null){dojo.connect(this.oSpaEdition,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=this.oSpaEdition.href;});}
if(this.oPorEdition!==null){dojo.connect(this.oPorEdition,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=this.oPorEdition.href;});}
if(this.osectionFooterSub!==null){dojo.connect(this.osectionFooterSub,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=this.osectionFooterSub.href;});}
if(this.osectionFooterNonSub!==null){dojo.connect(this.osectionFooterNonSub,"onclick",this,function(ev){dojo.stopEvent(ev);window.location=this.osectionFooterNonSub.href;});}
if(this.currRegion=="asia"){currEdition="Asia Edition";this.oSelectedEdition=dojo.query(asiaEditionLinkClassName,this.oHeader)[0];}else if(this.currRegion=="asia,india"){currEdition="Asia Edition";this.oSelectedEdition=dojo.query(inEditionLinkClassName,this.oHeader)[0];}else if(this.currRegion=="europe"){currEdition="Europe Edition";this.oSelectedEdition=dojo.query(euEditionLinkClassName,this.oHeader)[0];}else{currEdition="U.S. Edition";this.oSelectedEdition=dojo.query(usEditionLinkClassName,this.oHeader)[0];}
dojo.addClass(this.oSelectedEdition,"selected");this.oCurrentEdition.innerHTML=currEdition;this.oFormFactorContainer=dojo.byId("formFactorContainer");dojo.style(this.oFormFactorContainer,{"display":""});this.oLocDropDownContainer=dojo.byId("locNavContainer");dojo.style(this.oLocDropDownContainer,{"display":""});if(this.oLocDropDownContainer!==null){var toggleDropdownClass=function(){if(dojo.hasClass(that.oLocDropDownContainer,selLocDrpdwnCollapsedClassName)){dojo.removeClass(that.oLocDropDownContainer,selLocDrpdwnCollapsedClassName);dojo.addClass(that.oLocDropDownContainer,selLocDrpdwnExpandedClassName);}else if(dojo.hasClass(that.oLocDropDownContainer,selLocDrpdwnExpandedClassName)){dojo.removeClass(that.oLocDropDownContainer,selLocDrpdwnExpandedClassName);dojo.addClass(that.oLocDropDownContainer,selLocDrpdwnCollapsedClassName);}};dojo.connect(this.oLocationNav,"onclick",this,function(event){dojo.stopEvent(event);toggleDropdownClass();});dojo.connect(document,"onclick",this,function(event){var isMousePointerinModalContainer=dj.util.Element.contains(this.oLocDropDownContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer==false){if(dojo.hasClass(this.oLocDropDownContainer,selLocDrpdwnExpandedClassName)){dojo.removeClass(this.oLocDropDownContainer,selLocDrpdwnExpandedClassName);dojo.addClass(this.oLocDropDownContainer,selLocDrpdwnCollapsedClassName);}}});this.oSectionFooterNonSub=dojo.byId("sectionFooterNonSub");this.oSectionFooterSub=dojo.byId("sectionFooterSub");dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){dojo.style(that.oSectionFooterNonSub,{"display":"none"});dojo.style(that.oSectionFooterSub,{"display":""});}else{dojo.style(that.oSectionFooterNonSub,{"display":""});dojo.style(that.oSectionFooterSub,{"display":"none"});}});}},displayTimeStamp:function(){var timestampClass=this.cfg.TIMESTAMP_CLASS;this.oTimestamp=dojo.query(timestampClass,this.oHeader)[0];if((typeof pDate!=="undefined")&&(this.oTimestamp!==null)){if(window.pStl=="renovation"){var pubDate=dj.util.Date.displayTime(pDate,pDateinGMT);this.oTimestamp.innerHTML=pubDate;}else{this.oTimestamp.innerHTML=pDate;}}},displaySubSection:function(){this.oCurrentSubSection=dojo.query(this.cfg.CURRENT_SUBSECTION_DISPLAY_CLASS,this.oHeader)[0];if((typeof globalHeaderPageTitle!=="undefined")&&(globalHeaderPageTitle!==null)&&(globalHeaderPageTitle!=="")){this.oCurrentSubSection.innerHTML=globalHeaderPageTitle;this._delayedFadeInSubSection();}},_delayedFadeInSubSection:function(){setTimeout(dojo.hitch(this,function(){dojo.style(this.oCurrentSubSection,{"display":"inline","opacity":0});dojo.fadeIn({node:this.oCurrentSubSection,duration:(this.cfg.WSJ_LOGO_FADE_APPEAR_DURATION*1000)}).play();}),this.cfg.WSJ_LOGO_DELAY_DURATION);},displaySubscriberDetails:function(){var userNameElementId=this.cfg.USER_NAME_ELEMENT_ID;dj.util.User.renderCallsign(userNameElementId);this.setupSubscriberLinks();var messageCenterLinkClass=this.cfg.MESSAGE_CENTER_LINK_CLASS;this.oMessageCenterLink=dojo.query(messageCenterLinkClass,this.oHeader)[0];var that=this;dj.util.User.isSubLoggedIn(function(subLoggedIn){if(subLoggedIn){that.setupMessageCenter();}else{that.setUpMJLinksForReg();dojo.style(that.oMessageCenterLink,{"display":"none"});}});var subscriberDetailsElementId=this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID;this.oSubscriberDetails=dojo.byId(subscriberDetailsElementId);dojo.removeClass(this.oSubscriberDetails,"hidden");},setUpMJLinksForReg:function(){var footerContainerClass=this.cfg.FOOTER_CONTAINER_CLASS;this.oFooter=dojo.query(footerContainerClass)[0];var mojLinkUrl=this.cfg.MOJ_LINK_URL;var mojLinkClass=this.cfg.MOJ_LINK_CLASS;this.oMojLinkHeader=dojo.query(mojLinkClass,this.oHeader)[0];this.oMojLinkFooter=dojo.query(mojLinkClass,this.oFooter)[0];if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){this.oMojLinkHeader.href="http://"+gcDomain+mojLinkUrl;this.oMojLinkFooter.href="http://"+gcDomain+mojLinkUrl;}else{this.oMojLinkHeader.href=mojLinkUrl;this.oMojLinkFooter.href=mojLinkUrl;}},setupSubscriberLinks:function(){var todaysPaperLinkClass=this.cfg.TODAYS_PAPER_LINK_CLASS;this.oTodaysPaperLink=dojo.query(todaysPaperLinkClass,this.oHeader)[0];var loggedInTodaysPaperUrl=this.cfg.LOGGED_IN_TODAYS_PAPER_URL;var that=this;dj.util.User.isSubLoggedIn(function(subLoggedIn){if(subLoggedIn){if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){that.oTodaysPaperLink.href="http://"+gcDomain+loggedInTodaysPaperUrl;}else{that.oTodaysPaperLink.href=loggedInTodaysPaperUrl;}}});},setupMessageCenter:function(){var messageCenterLinkClass=this.cfg.MESSAGE_CENTER_LINK_CLASS;this.oMessageCenterLink=dojo.query(messageCenterLinkClass,this.oHeader)[0];var messageCountClass=this.cfg.MESSAGE_COUNT_CLASS;this.oMessageCount=dojo.query(messageCountClass,this.oHeader)[0];var that=this;var setupMsgCenterLink=function(noOfMessages){if(noOfMessages==='-1'){dojo.style(that.oMessageCenterLink,{"display":"none"});}else{that.oMessageCount.innerHTML=noOfMessages;}};var noOfMessages=dj.util.Cookie.getCookie("msgCount");if(noOfMessages===null){var messageCenterPostUrl=this.cfg.MESSAGE_CENTER_POST_URL;var messageCountReq=dojo.xhrPost({url:messageCenterPostUrl,load:function(data,ioargs){var jsonObj=data;noOfMessages=jsonObj.MessagesCount;var userStatus=jsonObj.Status;dj.util.Cookie.setCookie("msgCount",noOfMessages,(5/24/60));dj.util.Cookie.setCookie("userStatus",userStatus,(5/24/60));setupMsgCenterLink(noOfMessages);},error:function(transport,exception){console.error("Exception occured while posting posting Ajax Request: %s",exception);}});}else{setupMsgCenterLink(noOfMessages);}},setupLogin:function(){var loginUserElementId=this.cfg.LOGIN_USERNAME_ELEMENT_ID;this.oUserName=dojo.byId(loginUserElementId);var loginPasswordElementId=this.cfg.LOGIN_PASSWORD_ELEMENT_ID;this.oPassword=dojo.byId(loginPasswordElementId);var loginButtonImageId=this.cfg.LOGIN_BUTTON_ELEMENT_ID;this.oLoginImg=dojo.byId(loginButtonImageId);var loginFormId=this.cfg.LOGIN_FORM_ID;this.oLoginForm=dojo.byId(loginFormId);this.oLoginForm.reset();var pageUrlId=this.cfg.PAGE_URL_ELEMENT_ID;this.oPageUrl=dojo.byId(pageUrlId);var that=this;if(this.oPageUrl!==null){var nonSubscriberHomepagePid=this.cfg.NONSUBSCRIBER_HOMEPAGE_PID;var nonSubscriberSearchPagePid=this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID;var nonSubNewslettersAlertsPagePid=this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID;var mdcPagePid=this.cfg.MDC_PAGE_PID;var concatURL;if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){concatURL="http://"+gcDomain;}else{concatURL="http://"+document.domain;}
var oCurrentUrl;if(dojo.isIE){oCurrentUrl=window.location.href;}else{oCurrentUrl=document.location.href;}
var url_value=oCurrentUrl;if(typeof pID!=="undefined"){if(pID===nonSubscriberHomepagePid){url_value=concatURL+this.cfg.HOMEPAGE_SUBSCRIBER_URL;}else if(pID===nonSubNewslettersAlertsPagePid){url_value=concatURL+"/email";}else if(pID===nonSubscriberSearchPagePid){url_value=concatURL+this.cfg.SEARCH_PAGE_SUBSCRIBER_URL;}else if(pID===mdcPagePid){url_value=concatURL+this.cfg.MDC_LINK_URL;}else{url_value=oCurrentUrl;}
if(dojo.isIE){document.login_form.url.value=url_value;}else{this.oPageUrl.value=url_value;}}
if(this.oUserName!==null){dojo.connect(this.oUserName,"onfocus",this,function(event){dj.util.Form.clearValue(this.oUserName,"User Name");});dojo.connect(this.oUserName,"onclick",this,function(event){dj.util.Form.clearValue(this.oUserName,"User Name");});}
if(this.oPassword!==null){dojo.connect(this.oPassword,"onfocus",this,function(event){dj.util.Form.clearValue(that.oPassword,"Password");this.oPassword.type="password";});dojo.connect(this.oPassword,"onclick",this,function(event){dj.util.Form.clearValue(that.oPassword,"Password");});dojo.connect(this.oPassword,"onchange",this,function(event){dj.util.Form.clearValue(that.oPassword,"Password");});}
if(dojo.isIE){dojo.connect(this.oLoginImg,"onclick",this,function(e){document.login_form.url.value=oCurrentUrl;console.log("coming in to img onlick in IE"+oCurrentUrl);this.oLoginForm.submit();});}
dojo.connect(this.oPassword,"onkeypress",this,function(e){var cKeyCode=e.keyCode||e.which;if(dojo.isIE){if(cKeyCode==Event.KEY_RETURN){document.login_form.url.value=oCurrentUrl;this.oLoginForm.submit();}}});}},setupLogout:function(){var logoutLinkElementId=this.cfg.LOGOUT_LINK_ELEMENT_ID;this.oLogout=dojo.byId(logoutLinkElementId);if(this.oLogout!==null){dojo.connect(this.oLogout,"onclick",this,function(ev){dojo.stopEvent(ev);dj.util.Cookie.deleteCookie("msgCount");dj.util.Cookie.deleteCookie("HOMEPAGE",true);document.cookie="HOMEPAGE"+"="+";path=/"+";domain=.wsj.com"
+";expires=Thu, 01-Jan-1970 00:00:01 GMT";if((typeof gcDomain!=="undefined")&&(gcDomain!==null)&&(gcDomain!=="")){window.location="/logout?url=http://"+gcDomain;}else{window.location="/logout";}});}},highlightFormFactorLinks:function(){var todaysPaperLinkContainerClass=this.cfg.TODAYS_PAPER_LINK_CONTAINER_CLASS;this.oTodaysPaperLinkContainer=dojo.query(todaysPaperLinkContainerClass,this.oHeader)[0];var videoLinkContainerClass=this.cfg.VIDEO_LINK_CONTAINER_CLASS;this.oVideoLinkContainer=dojo.query(videoLinkContainerClass,this.oHeader)[0];var blogsLinkContainerClass=this.cfg.BLOGS_LINK_CONTAINER_CLASS;this.oBlogsLinkContainer=dojo.query(blogsLinkContainerClass,this.oHeader)[0];var columnsLinkContainerClass=this.cfg.COLUMNS_LINK_CONTAINER_CLASS;this.oColumnsLinkContainer=dojo.query(columnsLinkContainerClass,this.oHeader)[0];var interactiveGraphicsLinkContainerClass=this.cfg.INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS;this.oInteractiveGraphicsLinkContainer=dojo.query(interactiveGraphicsLinkContainerClass,this.oHeader)[0];var topicsLinkContainerClass=this.cfg.TOPICS_LINK_CONTAINER_CLASS;this.oTopicsLinkContainer=dojo.query(topicsLinkContainerClass,this.oHeader)[0];var communityForumsLinkContainerClass=this.cfg.COMMUNITY_FORUMS_LINK_CONTAINER_CLASS;this.oCommunityForumsLinkContainer=dojo.query(communityForumsLinkContainerClass,this.oHeader)[0];var todaysPaperPid=this.cfg.TODAYS_PAPER_PID;var todaysPaperUsNonSubPid=this.cfg.TODAYS_PAPER_US_NONSUB_PID;var todaysPaperEuropeNonSubPid=this.cfg.TODAYS_PAPER_EUROPE_NONSUB_PID;var todaysPaperAsiaNonSubPid=this.cfg.TODAYS_PAPER_ASIA_NONSUB_PID;var todaysPaperUsPid=this.cfg.TODAYS_PAPER_US_PID;var todaysPaperEuropePid=this.cfg.TODAYS_PAPER_EUROPE_PID;var todaysPaperAsiaPid=this.cfg.TODAYS_PAPER_ASIA_PID;var todaysPaperPastEditionsPid=this.cfg.TODAYS_PAPER_PAST_EDITIONS_PID;var todaysPaperIndexBizPid=this.cfg.TODAYS_PAPER_INDEX_BIZ_PID;var todaysPaperIndexPeoplePid=this.cfg.TODAYS_PAPER_INDEX_PEOPLE_PID;var todaysPaperCorrectionsPid=this.cfg.TODAYS_PAPER_CORRECTIONS_PID;var videoPid=this.cfg.VIDEO_PID;var interactiveGraphicsPid=this.cfg.INTERACTIVE_GRAPHICS_PID;var topicsPid=this.cfg.TOPICS_PID;var newslettersAlertsPubPid=this.cfg.NEWSLETTERS_ALERTS_PUB_PID;var newslettersAlertsSubPid=this.cfg.NEWSLETTERS_ALERTS_SUB_PID;var columnsPid=this.cfg.COLUMNS_PID;var blogsPid=this.cfg.BLOGS_PID;var hostUrl=document.location.host;var communityUrl=hostUrl+this.cfg.COMMUNITY_HIGHLIGHT_COMPARE_URL;var compareForumsUrl=this.cfg.FORUMS_HIGHLIGHT_COMPARE_URL;if(typeof pID!=="undefined"){if((pID.indexOf(todaysPaperPid)==0)||(pID===todaysPaperUsNonSubPid)||(pID===todaysPaperEuropeNonSubPid)||(pID===todaysPaperAsiaNonSubPid)||(pID===todaysPaperUsPid)||(pID===todaysPaperEuropePid)||(pID===todaysPaperAsiaPid)||(pID===todaysPaperPastEditionsPid)||(pID===todaysPaperIndexBizPid)||(pID===todaysPaperIndexPeoplePid)||(pID===todaysPaperCorrectionsPid)){dojo.addClass(this.oTodaysPaperLinkContainer,"selected");}else if(pID===videoPid){dojo.addClass(this.oVideoLinkContainer,"selected");}else if(pID===interactiveGraphicsPid){dojo.addClass(this.oInteractiveGraphicsLinkContainer,"selected");}else if(pID===columnsPid){dojo.addClass(this.oColumnsLinkContainer,"selected");}else if(pID===blogsPid){dojo.addClass(this.oBlogsLinkContainer,"selected");}else if(pID===topicsPid){dojo.addClass(this.oTopicsLinkContainer,"selected");}}
if((document.location.href!==null)&&(document.location.href!=="")&&(document.location.href.indexOf(communityUrl)!==-1)||(document.location.href.indexOf(compareForumsUrl)!==-1)){dojo.addClass(this.oCommunityForumsLinkContainer,"selected");}}};}();dojo.provide("dj.module.showSectionAndTicker");dojo.require("dj.module.newsTicker");dj.module.showSectionAndTicker={init:function(){this.sectPan=dj.module.carouselSection.panels;this.newsPan=dj.module.newsTicker.ticker;if(!this.sectPan||!this.newsPan){console.warn("{showSectionAndTicker} either (or both) of the carousels is not found");return;}
this.bind();},bind:function(){var ctr=0,span=this.sectPan,npan=this.newsPan,tot=span.model.getNumberOfPanels();npan.model.setRotationState(0);span.model.addChangeListener("success",function(panel){if(panel.getPosition()==tot){ctr++;}
if((panel.getPosition()==1)&&(ctr>0)){span.model.setRotationState(0);npan.model.setRotationState(1);}});span.model.addChangeListener("rotationStateSuccess",function(rstate){if(rstate==0){npan.model.setRotationState(1);}else{npan.model.setRotationState(0);}});}};
dojo.provide("dj.module.dashboard.DashboardExpletives");dj.module.dashboard.expletives=["ahole","fuck","dickface","b!tch","fatboner","hitlery","pinksock","dirtysanchez","dirty-sanchez","pink.sock","gooks","horseshit","tableofwisdom.com","fuckers","bullshit","bullshiter","a.s.s.h.o.l.e","jackasses","erwin.rommel","f.u.c.k.i.n.g.","a$$","cr\*p","a$$wipe","repuglican","s.c.r.e.w.","aarghasm","scum","fuckit","aasman","fucku","f-u-c-k","f\*uck","null","dooche","dumbass","ipenis","pussies","stfu","fucktard","shitting","s.h.i.t","shites","shite","c.u.n.t.s","pusssy","moron's","moron","morons","d\*mn","f.ucked","sht","f\*ck","fuckyou","fuc\*","p\*ssy","sh\*t","pigfucking","scumsucking","phuque","shiiiit","buttfucked","goldtradercomments.blogspot.com","milf","wtf","libtard","shat","krap","dumbocrats","obaminables","fugers","www.anoox.com/blog/real_news","www.anoox.com","obminable","fu@ked","a-s-s","obamanible","mc*w*a*r!","dumbocrat","m.i.l.f","dipshit","repugnants","fucksticks","mclame","tur.d","niggers","buttkissing","obaminable","demonrats","bullshiite","bullsh\*t","www.yousearchengine.com","retardado","gawdamn","macclame","fagots","repig","dickwad","motherfuckers","unfuckingbelievable","obamacrimes.com","dogfucking","fuckthesouth.com","phucking","a$$holes","http://www.easystockalerts.com","smegma","www.scottpodcast.com","democrap","www.stockgravity.com","www.proloanmods.com","a$$clowns","www.aaronabed.com","wingnuts","http://www.quickstubs.com","www.quickstubs.com","quickstubs.com","www.debtchallenges.com","debtchallenges.com","www.blackjfk.com","octaroon","idiot","www.saadvisory.com","seismicstocktrading.com","repukes","www.joesixpack.me","whoredog","dipsh*t","poorbrokesoul","demorat","pusified","ribono","@ss","www.dollartalk.net","www.usmegatrends.blogspot.com","aholez","alhambrainvestments.com","asses","www.swanconsultinginc.com","dumbacrats","honkeys","jagoff","http://www.places2network.com","schit","schmuck","r-tards","http://tinyurl.com/6kp4bp","http://tinyurl.com","http://www.prisonplanet.com/ex-isi-chief-gul-exposes-911-inside-job.html","goddamn","$h!t","goddamned","b@astards","b@stard","krapp","fuked","sh8","holysh8","@ssh0les","bull*hit","shi*ter","cr#p","crappy","$hit","f*cked","fag","fag1t","faget","fagg1t","faggit","faggot","fagit","fags","fagz","faig","faigs","schwartzenigger","biatchys","s-h-i-t","q-u-e-e-r","felch","f.ucking","felching","unfucking","shittibank","fucker","fuckinfuckhead","fucking","fucks","fuckstain","fucktwat","fuckwit","fuk","fukah","fuken","fuker","fukin","fukk","fukkah","fukken","fukker","fukkin","fucked","pigfart","g00k","shitheads","gayboy","gaygirl","billionairecupid.com","d-bags","dbags","h00r","h0ar","obamanation","h0re","c_r_a_p","hell","honkies","honky","hoor","hoore","democraps","phuckers","tuurds","cocksucking","jackass","jack-ass","jackoff","jack-off","jap","japs","jerkass","jerk-ass","jerk-off","jerkoff","jisim","w-e-t-b-a-c-k","jizm","cocksuckers","fvck","http://www.theoffshorebankaccount.com","clusterf*ck","knobcheese","knobz","washingfuckington","http://www.economicreality.net/money.htm","www.easystockalerts.com","easystockalerts.com","kunt","kunts","kuntz","www.mimarker.net","retardicans","repug","http://www.fakepaycheckstub.com","www.fakepaycheckstub.com","lezzian","lipshits","lipshitz","fakepaycheckstub.com","manpiss","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","fukn","bitching","a$$es","mosshead","otha-fucker","motha-fuker","motha-fukkah","motha-fukker","mother-fucker","mother-fukah","mother-fuker","mother-fukkah","mother-fukker","motherfucking","mother-fucking","mutha-fucker","mutha-fukah","mutha-fuker","mutha fukkah","mutha-fukker","n1gr","niggar","nigger","niggra","nigguh","nigur","niiger","niigr","packi","packie","packy","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","phuc","phuk","phuker","phukker","piss","polac","polack","polak","poonani","poopshoot","poop-shoot","ppopchute","pr1c","pr1ck","pr1k","prick","pussee","queer","queers","queerz","qweers","qweerz","qweir","retard","rimmer","tard","scank","schlong","semen","santorum","sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","she-male","shitchute","shit-chute","shiteater","shit-eater","shithead","shit-head","shits","shitshute","shit-shute","shitter","shitty","shity","shitz","shyt","shyte","shytty","shyty","skanck","skank","skankee","skankey","skanks","skanky","sluts","slutty","slutz","son-of-a-bitch","scumbags","bullshiit","libloons","dubmassss","f_uc-kin","shiit","c.rap","p.iss","tit","son-of-a-b.itch","titz","turd","turds","turdz","gtfo","twats","twatz","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","a.s.s.l.i.c.k.e.r.","b.a.s.t.a.r.d","scumball","pissing","w0p","wanker","wankers","wankerz","wetback","wet-back","wetbacks","wetbackz","wet-backs","wet-backz","wh00r","wh0re","dickhead","mccdong","whore","whores","whorez","libterd","whorze","demon'rats","wop","wops","wopz","http://logicstudio8.blogspot.com/","www.buymyhousebeforethebanktakesit.com.","buymyhousebeforethebanktakesit.com.","www.derivativescollapse.com","dotcom","shitload","www.palestine-info.co.uk/","pink-sock","clusterphuc","ass","fucken","libturd","www.smartstops.net","azzholes","slimebags","slimebag","dirtbag","fart","fuking","p#ss","anus","biotches","boobs","m0r0n","fuckage","h-o-n-k-y","fuckkk","c.u.n.t.","f-ing","cornholed","fuctard","mcwar","oblahblah","mcshit","http://www.debtchallenges.com","http://blog.tradingideas.in/","infotips@yahoo.com","dirtbags","azzes","goddam","bimbo","chick","doodoohead","www.themastertrader.net","monoprice.com","http://www.dollartalk.net","shlt","dumbasses","phucked","http://www.jewwatch.com/","shiti","www.yourgold.com","www.peacecorps.gov/","douche","http://www.smartstops.net","pendejo","repugnantcans","www.fakepaycheckstubs.com","truemetalprices.com","omfg","www.usbailout.com","www.insuredira.com","www.economicvesuvius.blogspot.com","anoox","reptards","jackoffs","http://www.moorelandrey.com/ml/scottckinsel","clusterfuk","putz","tirds","tird","a$$*oles","anilingus","bitchers","jewliani","jeweliani","assrammer","scumbag","b17ch","b1tch","bastard","bi7ch","buttholesurfers","beaner","a$$wipes","butt-pirate","c0ck","mfucking","cawk","repugs","chink","fuckups","horse$hit","stupidass","clits","cum","d4mn","daygo","dego","dildo","pissit","pissaway","fukking","ejackulate","fuckin","shyste","faen","phaggot","mcclame","fatass","fcuk","blowjobs","faggots","felcher","ficken","flikker","foreskin","fubar","lmfao","fux0r","shitstorm","gook","pisses","h0r","h4x0r","http://www.buymyhousebeforethebanktakesit.com.","pissed","honkey","hore","paki","http://alhambrainvestments.com/blog/","injun","jism","jizz","kawk","kike","alhambrainvestments.com/blog/","kraut","http://davronstaffing.blogspot.com/","kuk","kuksuger","www.blackfdr.com","http://freetradingquiz.com/","l3itch","a-holes","lesbo","motherfucker","mofo","nigga","nutsack","phuck","poontsee","shitt","pusse","pussy","puta","puto","shemale","slut","spic","splooge","suka","teets","tits","twat","whoar","shit","aholes","anuz","anusranger","anus-ranger","arschloch","arsez","arsewit","arsewitts","ash0le","ash0les","f.u.c.k.","asholes","ass-monkey","assbitch","assface","assfucker","assh0le","assh0lez","asshat","asshole","assholes","assholz","asslick","assmaster","assmonkey","ass-rammer","asswipe","asswipes","asswipez","asswiper","asswipers","asswiperz","azzhole","bassterds","bastards","bastardz","basterds","basterdz","biatch","bitch","bitches","blow-job","blowjob","boffing","bollocks","boll\*cks","boner","bugger","bulldyke","bumboy","bunghole","butthole","buttmuncher","buttwipe","c0cks","c0k","carpet-muncher","cawks","clit","cnts","cntz","cock","cockhead","cock-head","cocklick","cocks","cocksucker","cock-sucker","coon","crap","cumsucker","cunilingus","cunt","cuntlick","cunts","cuntz","damn","dicklick","dild0","dild0s","dildos","dilld0","dilld0s","douchebag","dyke"];dojo.provide("dj.util.dashboard");dojo.require("dj.lang");dj.util.dashboard={getDashboardData:function(url,params){params.responseType=(!params.responseType)?"application/json":params.responseType;var isResponseJson=(params.responseType.indexOf("json")>-1);this._sendXhrRequest(url,params,{requestMethod:"GET",handleAs:(isResponseJson)?"json":"text",appendCacheBuster:true,requestHeaders:{"Accept":params.responseType}});},postDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"POST",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"POST","Content-Type":"application/json"}});},putDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"PUT",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"PUT","Content-Type":"application/json"}});},deleteDashboardData:function(url,postData,params){this._sendXhrRequest(url,params,{requestMethod:"POST",content:dojo.toJson(postData),requestHeaders:{"X-HTTP-Method-Override":"DELETE","Content-Type":"application/json"}});},_sendXhrRequest:function(requestUrl,userParams,requestOptions){var params=dj.lang.cloneMixin({callback:function(){}},userParams);var options=dj.lang.cloneMixin({requestHeaders:{"Accept":"application/json"},handleAs:"json",appendCacheBuster:false},requestOptions);if(options.appendCacheBuster){requestUrl=this._appendCacheBuster(requestUrl);}
var xhrReq=this._getRequestByMethod(options.requestMethod);var deferred=xhrReq({url:requestUrl,headers:options.requestHeaders,handleAs:options.handleAs,postData:options.content,load:function(data,ioargs){params.callback.apply(params.context,[data,ioargs.xhr,params]);},error:function(data,ioargs){console.error("HTTP status code: %s, response: %o",ioargs.xhr.status,data);if(typeof params.errorCallback!=="undefined"){params.errorCallback.apply(params.context,[data.status,ioargs.xhr,params]);}else{params.callback.apply(params.context,[data.status,ioargs.xhr,params]);}}});return deferred;},_appendCacheBuster:function(requestUrl){var cb=(Math.floor(10000000*Math.random()));requestUrl+=(requestUrl.indexOf('?')>-1)?("&cb="+cb):("?cb="+cb);return requestUrl;},_getRequestByMethod:function(requestMethod){return(requestMethod=="GET")?dojo.xhrGet:dojo.xhrPost;}};dojo.provide("dj.service.dashboard.DashboardService");dojo.require("dj.util.dashboard");dojo.require("dj.util.Observer");dojo.require("dj.util.User");if(typeof dj=="undefined"){dj={};}
if(typeof dj.service=="undefined"){dj.service={};}
if(typeof dj.service.dashboard=="undefined"){dj.service.dashboard={};}
if(typeof dj.widget=="undefined"){dj.widget={};}
if(typeof dj.widget.dashboard=="undefined"){dj.widget.dashboard={};}
(function(){var _du=dj.util;var _dsd=dj.service.dashboard;var _dwd=dj.widget.dashboard;var _dud=_du.dashboard;(_dwd.DashboardService=function(cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._responses={};this._responsePending={};this._postResponses={};this._postResponsePending={};this._subscribed={};this._updateObservers={};this._updateCallbacks={};this._loaded=false;this._dataObserver=new _du.Observer();}).prototype={DEFAULT_CONFIG:{},subscribeFeed:function(name,key,callback,context){this._dataObserver.subscribeByName(this.getFeedId(name,key),callback,context);},getFeedId:function(name,key){return name+":"+key;},getFeed:function(name,key,url,criteria){this._performUuidSubstitution1(this._getFeedWithUser,this,name,key,url,criteria);},_getFeedWithUser:function(name,key,url,criteria){var feedName=name||null;var feedKey=key||null;var feedId=this.getFeedId(feedName,feedKey);if(this._responses[feedId]&&typeof criteria==="undefined"){this.fireFeed(name,key,this._responses[feedId]);return;}
var c=criteria||null;if(!this._responsePending[feedId]){var feedUrl=url;this._responses[feedId]=null;this._responsePending[feedId]=true;_dud.getDashboardData(feedUrl,{callback:this.handleFeed,context:this,feedName:feedName,feedKey:feedKey,url:feedUrl,criteria:c});}},handleFeed:function(response,ioArgs,params){this._responses[this.getFeedId(params.feedName,params.feedKey)]=response;this.fireFeed(params.feedName,params.feedKey,response,params.criteria);},fireFeed:function(name,key,response,criteria){this._responsePending[this.getFeedId(name,key)]=false;this._dataObserver.fireByName(this.getFeedId(name,key),key,response,criteria);},reloadFeed:function(name,key,url,criteria){this._performUuidSubstitution1(this._reloadFeedWithUser,this,name,key,url,criteria);},_reloadFeedWithUser:function(name,key,url,criteria){this._responses[this.getFeedId(name,key)]=null;this.getFeed(name,key,url,criteria);},doPost:function(name,key,url,postData,callback,context,methodOverride){this._performUuidSubstitution2(this._doPostWithUser,this,name,key,url,postData,callback,context,methodOverride);},_doPostWithUser:function(thisObj,name,key,url,postData,callback,context,methodOverride){var postName=name;var postKey=key||null;var method=methodOverride||"post";thisObj._postResponses[thisObj.getFeedId(name,key)]=null;thisObj._postResponsePending[thisObj.getFeedId(name,key)]=true;thisObj._subscribeUpdateObserver(name,key,callback,context);var params={callback:thisObj.handlePost,errorCallback:thisObj.handlePost,context:thisObj,postName:name,postKey:postKey,url:url};if(method=="put"){_dud.putDashboardData(url,postData,params);}else if(method=="delete"){_dud.deleteDashboardData(url,postData,params);}else{_dud.postDashboardData(url,postData,params);}},handlePost:function(response,ioArgs,params){var postName=params.postName;var postKey=params.postKey;this._postResponses[this.getFeedId(params.postName,params.postKey)]=response;this.firePost(params.postName,params.postKey,response);},handlePostError:function(response,ioArgs,params){console.error("Dashboard Service post error :"+ioArgs);},firePost:function(name,key,response){this._postResponsePending[this.getFeedId(name,key)]=false;this._fireUpdateObserver(name,key,key,response);this._unsubscribeUpdateObserver(name,key);},doPut:function(name,key,url,postData,callback,context){this._performUuidSubstitution2(this._doPutWithUser,this,name,key,url,postData,callback,context);},_doPutWithUser:function(thisObj,name,key,url,postData,callback,context,methodOverride){thisObj.doPost(name,key,url,postData,callback,context,"put");},doDelete:function(name,key,url,postData,callback,context){this._performUuidSubstitution2(this._doDeleteWithUser,this,name,key,url,postData,callback,context);},_doDeleteWithUser:function(thisObj,name,key,url,postData,callback,context,methodOverride){thisObj.doPost(name,key,url,postData,callback,context,"delete");},_subscribeUpdateObserver:function(name,key,callback,context){var feedId=this.getFeedId(name,key);var updateObserver=this._updateObservers[feedId];if(!updateObserver){updateObserver=new _du.Observer();this._updateObservers[feedId]=updateObserver;this._updateCallbacks[feedId]=callback;updateObserver.subscribe(callback,context);}},_fireUpdateObserver:function(name,key){var updateObserver=this._updateObservers[this.getFeedId(name,key)];if(updateObserver){var fireParams=[];for(var i=2,arg,len=arguments.length;i<len;i++){fireParams.push(arguments[i]);}
updateObserver.fire.apply(updateObserver,fireParams);}},_unsubscribeUpdateObserver:function(name,key){var feedId=this.getFeedId(name,key);this._updateObservers[feedId]=null;},_performUuidSubstitution1:function(callback,context,name,key,url,criteria){var that=this;if(this.uuid){callback.apply(context,[name,key,that._substituteMacros(url),criteria]);}else{var that=this;dj.util.User.getUserId(function(uuidVal){that.uuid=uuidVal;callback.apply(context,[name,key,that._substituteMacros(url),criteria]);});}},_performUuidSubstitution2:function(callback,thisObj,name,key,url,postData,callbk,context,methodOverride){var that=this;if(this.uuid){callback.apply(context,[thisObj,name,key,that._substituteMacros(url),postData,callbk,context,methodOverride]);}else{var that=this;dj.util.User.getUserId(function(uuidVal){that.uuid=uuidVal;callback.apply(context,[thisObj,name,key,that._substituteMacros(url),postData,callbk,context,methodOverride]);});}},_substituteMacros:function(url){url=url.replace('$userName$',this.uuid);return url;}};dj.service.dashboard.DashboardService=new _dwd.DashboardService();}());dojo.provide("dj.service.dashboard.DashboardPZNServiceFactory");dojo.require("dj.service.dashboard.DashboardService");dojo.require("dj.util.User");dojo.require("jkl.jkl-parsexml");(function(){var _du=dj.util;var _dsd=dj.service.dashboard;var _dwd=dj.widget.dashboard;var _dud=_du.dashboard;var _ctx=dj.context;(_dwd.DashboardPZNService=function(cfg){this._serviceWidget=null;this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._responsePending={};this._subscribed={};this._allFolders=null;this._userFolders={};this._userPortfolioQuotes={};this._mostRecentArticles={};this._globalPref={};this._email={};this._updateObservers={};this._updateCallbacks={};this._serviceWidget=_dsd.DashboardService;this._dataObserver=new _du.Observer();}).prototype={DEFAULT_CONFIG:{serviceUrls:{"mostRecentArticles":"/WSJDBFeeds/service.svc/TopArticles/$userName$/5","mostRecentPZNOverview":"/pznusersvc/view/getUserPagination/mostRecentOverview","topNewsOverview":"/pznusersvc/view/getUserPagination/topNewsArticlesOverview","companiesOverview":"/pznusersvc/view/getUserPagination/companiesArticlesOverview","industriesOverview":"/pznusersvc/view/getUserPagination/industriesArticlesOverview","sectionsOverview":"/pznusersvc/view/getUserPagination/sectionsArticlesOverview","columnsOverview":"/pznusersvc/view/getUserPagination/columnsArticlesOverview","editorsPickOverview":"/pznusersvc/view/getUserPagination/editorsPickArticlesOverview","updateUser":"/pznusersvc/update/updateUser/version/2","marketData":"/pznusersvc/view/getUser/indexes/userName","allIndustries":"/pznusersvc/view/getAll/industries","allSections":"/pznusersvc/view/getAll/sections","allColumns":"/pznusersvc/view/getAll/columnists","allTopNews":"/pznusersvc/view/getAll/topNews","allIndexes":"/pznusersvc/view/getAll/indexes","allCompanies":"/pznusersvc/view/getAll/companies","quote":"/quote/quote","globalPref":"/pznusersvc/view/getUser/defaultFolders/version/2","email":"/pznusersvc/view/getUser/EmailInfo","updatePmProfile":"/epsvcs/update/userProfile","updateEmail":"/pznusersvc/update/updateUser/EmailInfo","welcomeMsg":"/pznusersvc/view/getUser/userFlags","portfolioList":"/pznusersvc/view/getPortfolios/"},xhtmlServiceUrls:{"companies":"/fragment/0_0_WM_1034_companies_update.html","industries":"/fragment/0_0_WM_1033_industries_update.html","sections":"/fragment/0_0_WM_1031_sections_update.html","columns":"/fragment/0_0_WM_1032_columns_update.html","topNews":"/fragment/0_0_WM_1036_topNews_update.html","mostRecent":"/fragment/0_0_WM_1035_mostRecent_update.html","editorsPick":"/fragment/0_0_WM_1037_EditorPicks_update.html","mostRecentSaved":"/fragment/0_0_WM_1060_mjDockSaved.html","userSaved":"/fragment/0_0_WM_1060_mjDockSavedColl.html","mjDockSavedNav":"/fragment/0_0_WM_1060_mjDockSavedNav.html","mjDockCompany_News":"/fragment/0_0_WM_1055_mjDockCompany_News.html","mjDockIndustry_News":"/fragment/0_0_WM_1055_mjDockIndustry_News.html","mjDockTopics":"/fragment/0_0_WM_1055_mjDockTopics.html","mjDockColumns":"/fragment/0_0_WM_1055_mjDockColumns.html","mjDockTop_News":"/fragment/0_0_WM_1055_mjDockTop_News.html","mjDockMost_Recent":"/fragment/0_0_WM_1055_mjDockMost_Recent.html","mjDockEditors_Pick":"/fragment/0_0_WM_1055_mjDockEditors_Pick.html","mjDocktabCompanies":"/fragment/0_0_WM_1055_mjDocktabCompanies.html","mjDocktabIndustries":"/fragment/0_0_WM_1055_mjDocktabIndustries.html","pmDocktabCompanies":"/fragment/0_0_EM_1055_mjDocktabCompanies.html","pmDocktabIndustries":"/fragment/0_0_EM_1055_mjDocktabIndustries.html","pmDockTopics":"/fragment/0_0_EM_1055_mjDockTopics.html","pmDockColumns":"/fragment/0_0_EM_1055_mjDockColumns.html","pmDockTop_News":"/fragment/0_0_EM_1055_mjDockTop_News.html","pmDockMost_Recent":"/fragment/0_0_EM_1055_mjDockMost_Recent.html","pmDockEditors_Pick":"/fragment/0_0_EM_1055_mjDockEditors_Pick.html","mjDockMostRecentSaved":"/fragment/0_0_EM_1055_mjDocktabSaved.html","mjDockKeywordAlerts":"/fragment/0_0_EM_1055_mjDocktabKeywordAlerts.html"},pznCollectionUrl:["/page/mj-companies.html","/page/mj-industries.html","/page/mj-sections.html","/page/mj-columnists.html","/page/mj-topnews.html","/page/mj-mostrecent.html","/page/mj-editorspick.html","/page/my-journal-setup.html","/page/my-journal-main.html"],pznSingleCollectionUrl:["/page/mj-companies.html?collection=","/page/mj-industries.html?collection=","/page/mj-sections.html?collection=","/page/mj-columnists.html?collection=","/page/mj-topnews.html?collection="],pznCollectionEditUrl:["/page/mj-companies.html?editMode=yes","/page/mj-industries.html?editMode=yes","/page/mj-sections.html?editMode=yes","/page/mj-columnists.html?editMode=yes","/page/mj-topnews.html?editMode=yes","/page/mj-mostrecent.html?editMode=yes","/page/mj-editorspick.html?editMode=yes"],pznDisplayValues:["Companies","Industries","WSJ Sections","WSJ Columns","Top News from Today\'s Paper","Most Recent","Top News","Most Recent in all Collections","Editors' Picks","Markets","Portfolio"],pznCollectionDatabaseValue:["Company News","Industry News","Topics","Columns","Top News","Most Recent","Editors Pick"],pznDisplayTitle:["Companies","Industries","Sections","Columns","Top News","Most Recent","Editors Pick"],pznCommanValues:["Settings","Collapse","Sort","Save Settings","Hide Module","My Journal Preferences","Cancel","Expand"],otherDefaultVisibleFolders:"Portfolio~",pagePathValue:"/page",mjVersion:"/version/2?loc=mj"},getPznCollectionUrl:function(){return this._cfg.pznCollectionUrl;},getPagePathValue:function(){return this._cfg.pagePathValue;},getPznSingleCollectionUrl:function(){return this._cfg.pznSingleCollectionUrl;},getPznCollectionEditUrl:function(){return this._cfg.pznCollectionEditUrl;},getPznDisplayValues:function(){return this._cfg.pznDisplayValues;},getPznCollectionDatabaseValue:function(){return this._cfg.pznCollectionDatabaseValue;},getPznCommanValues:function(){return this._cfg.pznCommanValues;},getOtherDefaultVisibleFolders:function(){return this._cfg.otherDefaultVisibleFolders;},getPznDisplayTitle:function(){return this._cfg.pznDisplayTitle;},searchIndustriesArticles:function(folderId,criteria,callback,context){var name="industryArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.industriesOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchIndustryArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchIndustryArticles:function(folderId,data,criteria){var name="industryArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchCompaniesArticles:function(folderId,criteria,callback,context){var name="companyArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.companiesOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchCompaniesArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchCompaniesArticles:function(folderId,data,criteria){var name="companyArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchTopNewsArticles:function(folderId,criteria,callback,context){var name="topNewsArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.topNewsOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchTopNewsArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchTopNewsArticles:function(folderId,data,criteria){var name="topNewsArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchSectionsArticles:function(folderId,criteria,callback,context){var name="sectionArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.sectionsOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchSectionsArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchSectionsArticles:function(folderId,data,criteria){var name="sectionArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchColumnsArticles:function(folderId,criteria,callback,context){var name="columnsArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.columnsOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchColumnsArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchColumnsArticles:function(folderId,data,criteria){var name="columnsArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchRecentArticles:function(folderId,criteria,callback,context){var name="mostRecentPZNArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.mostRecentPZNOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchRecentArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchRecentArticles:function(folderId,data,criteria){var name="mostRecentPZNArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},searchEditorsPickArticles:function(folderId,criteria,callback,context){var name="editorsPickArticles";criteria.name=name;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.editorsPickOverview;url+='/'+(criteria.From||1)+'/'+(criteria.To||100)+this._cfg.mjVersion
+((criteria.Filter)?"&collection="+criteria.Filter:"");this._userFolders[name+":"+folderId]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleSearchEditorsPickArticles,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},handleSearchEditorsPickArticles:function(folderId,data,criteria){var name="editorsPickArticles";var response={"Criteria":criteria,"Results":data};this._fireUpdateObserver(criteria.name,folderId,response);this._unsubscribeUpdateObserver(criteria.name);},updateIndustries:function(industries,callback,context){if(typeof industries!="string"){var industries=industries.join("~");}
var name="UpdateIndustries";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"industries":industries};this._serviceWidget.doPost(name,industries,url,postData,this.handleUpdateIndustries,this);},handleUpdateIndustries:function(industries,data){var name="UpdateIndustries";this._fireUpdateObserver(name,industries,data);this._unsubscribeUpdateObserver(name);},updateSections:function(sections,callback,context){if(typeof sections!="string"){var sections=sections.join("~");}
var name="UpdateSections";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"topics":sections};this._serviceWidget.doPost(name,sections,url,postData,this.handleUpdateSections,this);},handleUpdateSections:function(sections,data){var name="UpdateSections";this._fireUpdateObserver(name,sections,data);this._unsubscribeUpdateObserver(name);},updateColumns:function(columns,callback,context){if(typeof columns!="string"){var columns=columns.join("~");}
var name="UpdateColumns";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"columns":columns};this._serviceWidget.doPost(name,columns,url,postData,this.handleUpdateColumns,this);},handleUpdateColumns:function(columns,data){var name="UpdateColumns";this._fireUpdateObserver(name,columns,data);this._unsubscribeUpdateObserver(name);},updateTopNews:function(topNews,callback,context){if(typeof topNews!="string"){var topNews=topNews.join("~");}
var name="UpdateTopNews";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"topNews":topNews};this._serviceWidget.doPost(name,topNews,url,postData,this.handleUpdateTopNews,this);},handleUpdateTopNews:function(topNews,data){var name="UpdateTopNews";this._fireUpdateObserver(name,topNews,data);this._unsubscribeUpdateObserver(name);},subscribeMarketData:function(callback,context){var name="marketData";var url=this._cfg.serviceUrls.marketData;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleMarketData,this);this._serviceWidget.getFeed(name,"all",url);},handleMarketData:function(key,data){var name="marketData";this._dataObserver.fireByName(name,data);},subscribeMostRecentArticles:function(callback,context){var name="mostRecentArticles";var url=this._cfg.serviceUrls.mostRecentArticles;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleMostRecentArticles,this);var criteria={"mostRecentArticles":"all"};this._serviceWidget.getFeed(name,"all",url,criteria);},handleMostRecentArticles:function(key,data,criteria){var name="mostRecentArticles";var response={"Criteria":criteria,"Results":data};this._mostRecentArticles=response;this._dataObserver.fireByName(name,response);},subscribeGlobalPref:function(callback,context){var name="globalPref";var url=this._cfg.serviceUrls.globalPref;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGlobalPref,this);var criteria={"globalPref":"all"};this._serviceWidget.getFeed(name,"all",url,criteria);},handleGlobalPref:function(key,data,criteria){var name="globalPref";var response={"Criteria":criteria,"Results":data};this._globalPref=response;this._dataObserver.fireByName(name,response);},subscribeEmail:function(callback,context){var name="email";var url=this._cfg.serviceUrls.email;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleEmail,this);var criteria={"globalPref":"all"};this._serviceWidget.getFeed(name,"all",url,criteria);},handleEmail:function(key,data,criteria){var name="email";var response={"Criteria":criteria,"Results":data};this._email=response;this._dataObserver.fireByName(name,response);},getXhtmlModule:function(params,callback,context){var name="XHTML"+params.type;if(typeof params.url!=="undefined"){var url=params.url.toString();}else{var url=this._cfg.xhtmlServiceUrls[params.type];}
this._subscribeUpdateObserver(name,callback,context);var newParams={};newParams.responseType='text/html';newParams.type=params.type;newParams.callback=this.handleXhtmlModule;newParams.errorCallback=this.handleXhtmlModule;newParams.context=this;_dud.getDashboardData(url,newParams);},handleXhtmlModule:function(response,ioArgs,params){var name="XHTML"+params.type;this._fireUpdateObserver(name,response);this._unsubscribeUpdateObserver(name);},updateShowhideFolder:function(showFolders,callback,context){if(typeof showFolders!="string"){var showFolders=showFolders.join("~");}
var name="updateShowhideFolder";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;var postData={"ShowFolder":showFolders};this._serviceWidget.doPost(name,showFolders,url,postData,this._handleUpdateShowhideFolder,this);},_handleUpdateShowhideFolder:function(showFolders,data){var name="updateShowhideFolder";this._fireUpdateObserver(name,showFolders,data);this._unsubscribeUpdateObserver(name);},updateEmail:function(delopt,callback,context){if(typeof delopt!="string"){var delopt=delopt.join("~");}
var name="updateEmail";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateEmail;var postData={"deliveryOptions":delopt};this._serviceWidget.doPost(name,delopt,url,postData,this._handleUpdateEmail,this);},_handleUpdateEmail:function(delopt,data){var name="updateEmail";this._fireUpdateObserver(name,delopt,data);this._unsubscribeUpdateObserver(name);},getQuoteData:function(symbols,callback,context){if(typeof symbols==="string"){symbols=symbols.split('~');}else if(typeof symbols==="undefined"){return;}
var name="quoteData";var url=this._cfg.serviceUrls.quote;this._subscribeUpdateObserver(name,callback,context);var symbolQS="?";for(var s=0;s<symbols.length&&(symbol=symbols[s]);s++){if(s>0){symbolQS+="&";}
symbolQS+="symbol="+symbol+"&type=usstocks";}
url+=symbolQS;var xml=new JKL.ParseXML(url);var that=this;xml.async(function(data){that.handleQuoteData(data);});xml.parse();},handleQuoteData:function(data){var name="quoteData";this._fireUpdateObserver(name,data);this._unsubscribeUpdateObserver(name);},subscribeUserPortfolioQuotes:function(portfolioId,callback,context){var name="userPortfolioQuotes:"+portfolioId;var url=this._cfg.serviceUrls.portfolioList+portfolioId;this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed("userPortfolioQuotes",portfolioId,this.handleUserPortfolioQuotes,this);this._subscribed[name]=true;}
var criteria={"p_id":portfolioId};this._serviceWidget.getFeed("userPortfolioQuotes",portfolioId,url,criteria);},handleUserPortfolioQuotes:function(portfolioId,data,criteria){var name="userPortfolioQuotes";var response={"Criteria":criteria,"Results":data};this._userPortfolioQuotes[name+":"+portfolioId]=response;this._dataObserver.fireByName(name+":"+portfolioId,portfolioId,response);},getAllIndustries:function(callback,context){var name="allIndustries";var url=this._cfg.serviceUrls.allIndustries;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllIndustries,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllIndustries:function(key,data){var name="allIndustries";this._dataObserver.fireByName(name,data);},getAllCompanies:function(callback,context){var name="allCompanies";var url=this._cfg.serviceUrls.allCompanies;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllCompanies,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllCompanies:function(key,data){var name="allCompanies";this._dataObserver.fireByName(name,data);},getAllSections:function(callback,context){var name="allSections";var url=this._cfg.serviceUrls.allSections;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllSections,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllSections:function(key,data){var name="allSections";this._dataObserver.fireByName(name,data);},getAllColumns:function(callback,context){var name="allColumns";var url=this._cfg.serviceUrls.allColumns;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllColumns,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllColumns:function(key,data){var name="allColumns";this._dataObserver.fireByName(name,data);},getAllIndexes:function(callback,context){var name="allIndexes";var url=this._cfg.serviceUrls.allIndexes;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllIndexes,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllIndexes:function(key,data){var name="allIndexes";this._dataObserver.fireByName(name,data);},getAllTopNews:function(callback,context){var name="allTopNews";var url=this._cfg.serviceUrls.allTopNews;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleGetAllTopNews,this);this._serviceWidget.getFeed(name,"all",url);},handleGetAllTopNews:function(key,data){var name="allTopNews";this._dataObserver.fireByName(name,data);},updatePZNCollection:function(postDataValues,callback,context){var name="UpdatePZNCollection";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updateUser;this._serviceWidget.doPost(name,"all",url,postDataValues,this.handlePZNCollection,this);},handlePZNCollection:function(data){var name="UpdatePZNCollection";this._fireUpdateObserver(name,"all",data);this._unsubscribeUpdateObserver(name);},updatePremium:function(postDataValues,callback,context,check){if(typeof check==='undefined'){check="all";}
var name="UpdatePremium"+check;this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.updatePmProfile;this._serviceWidget.doPost(name,check,url,postDataValues,this.handlePremium,this);},handlePremium:function(key,data){var name="UpdatePremium"+key;this._fireUpdateObserver(name,"all",data);this._unsubscribeUpdateObserver(name);},getDockWelMsg:function(callback,context){var name="DockWelMsg";var url="/epsvcs/view/personal/user/settings?profileType=dockMsg";this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleDockWelMsg,this);this._serviceWidget.getFeed(name,"all",url);},handleDockWelMsg:function(key,data){var name="DockWelMsg";this._dataObserver.fireByName(name,data);},getCIWelMsg:function(callback,context){var name="CIWelMsg";var url="/epsvcs/view/personal/user/settings?profileType=ci_msg";this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleCIWelMsg,this);this._serviceWidget.getFeed(name,"all",url);},handleCIWelMsg:function(key,data){var name="CIWelMsg";this._dataObserver.fireByName(name,data);},getWelcomeMessages:function(callback,context){var name="welcomeMessages";var url=this._cfg.serviceUrls.welcomeMsg;this._dataObserver.subscribeByName(name,callback,context);this._serviceWidget.subscribeFeed(name,"all",this.handleWelcomeMessages,this);this._serviceWidget.getFeed(name,"all",url);},handleWelcomeMessages:function(key,data){var name="welcomeMessages";this._dataObserver.fireByName(name,data);},getDisplayViewCode:function(_mjView,_saveSetting,_cancelEditing,saveButton,cancelButton,_mjViewValue,restoreCheck,restoreButton,_dockView,_dockViewValue){var _pm=false;var dockViewValue="0";if(typeof _dockView!=='undefined'){_pm=true;dockViewValue=_dockViewValue;}
var resphtml=[];if(restoreCheck=="Restore"){resphtml[resphtml.length]=['<div class="mjFilterContent restoreDefault sixColumn"><ul class="buttonBar">','<li class="button buttonType-hide"><a href="#" id="',restoreButton,'">RESTORE DEFAULTS</a></li></ul>','<p>This action will overwrite your current selections.</p></div>'].join("");}
resphtml[resphtml.length]=['<div class="mod_setDisplay"><h4>Set Display: <span>Choose how you see your content for this collection.</span>','</h4><div class="setDisplay bottomBorder">'].join("");if(_pm){resphtml[resphtml.length]=['<ul class="headline">','<li><h4>Within My News</h4></li><li class="divider"><h4>Within My Toolbar</h4></li></ul>'].join("");}else{resphtml[resphtml.length]=['<ul class="headline"><li><h4>Within My Journal</h4></li></ul>'].join("");}
resphtml[resphtml.length]=['<ul class="summaryText">'].join("");if(_mjViewValue=="1"){resphtml[resphtml.length]=['<li><input type="radio" checked="checked" value="layout" name="myJournal" id="',_mjView,'"/>','<label for="myJournalSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" value="list" name="myJournal" id="myJournalHeadline"/>','<label for="myJournalHeadline">Headlines Only</label></li>'].join("");}else{resphtml[resphtml.length]=['<li><input type="radio" value="layout" name="myJournal" id="',_mjView,'"/>','<label for="myJournalSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" value="list" checked="checked" name="myJournal" id="myJournalHeadline"/>','<label for="myJournalHeadline">Headlines Only</label></li>'].join("");}
if(_pm){if(dockViewValue=="1"){resphtml[resphtml.length]=['<li class="divider"><input type="radio" checked="checked" name="myToolbar" id="',_dockView,'"/>','<label for="myToolbarSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" name="myToolbar" />','<label for="myToolbarHeadline">Headlines Only</label></li>'].join("");}else{resphtml[resphtml.length]=['<li class="divider"><input type="radio" name="myToolbar" id="',_dockView,'"/>','<label for="myToolbarSummary">Headlines, Summaries and Images</label></li>','<li><input type="radio" name="myToolbar" checked="checked"/>','<label for="myToolbarHeadline">Headlines Only</label></li>'].join("");}}
resphtml[resphtml.length]=['</ul>'].join("");if(_pm){resphtml[resphtml.length]=['<ul class="summaryText"><li><img src="/img/icon_headlinesummary.gif" alt="Headlines only" title="Headlines Only"/></li>','<li><img src="/img/icon_headline.gif" alt="Headlines only" title="Headlines Only"/></li>','<li class="divider"><img src="/img/icon_headlinesummary.gif" alt="Headlines only" title="Headlines Only"/></li>','<li><img src="/img/icon_headline.gif" alt="Headlines only" title="Headlines Only"/></li></ul>'].join("");}else{resphtml[resphtml.length]=['<ul class="summaryText"><li><img src="/img/icon_headlinesummary.gif" alt="Headlines only" title="Headlines Only"/></li>','<li><img src="/img/icon_headline.gif" alt="Headlines only" title="Headlines Only"/></li></ul>'].join("");}
resphtml[resphtml.length]=['</div><div class="editOps"><ul class="buttonBar"><li class="button buttonType-save">','<a href="#" id="',_saveSetting,'" class="',_saveSetting,'">',saveButton,'</a></li>','<li class="nonbutton linkType-cancel"><a href="#" id="',_cancelEditing,'">',cancelButton,'</a></li></ul></div></div>'].join("");return resphtml.join("");},_subscribeUpdateObserver:function(name,callback,context){var updateObserver=this._updateObservers[name];if(!updateObserver){updateObserver=new _du.Observer();this._updateObservers[name]=updateObserver;this._updateCallbacks[name]=callback;updateObserver.subscribe(callback,context);}},_fireUpdateObserver:function(name){var updateObserver=this._updateObservers[name];if(updateObserver){var fireParams=[];for(var i=1,arg,len=arguments.length;i<len;i++){fireParams.push(arguments[i]);}
updateObserver.fire.apply(updateObserver,fireParams);}},_unsubscribeUpdateObserver:function(name){this._updateObservers[name]=null;}};_dsd.DashboardPZNServiceFactory={getPZNServiceInstance:function(callback,context){if(dj.service.dashboard.DashboardPZNService){callback.apply(context,[dj.service.dashboard.DashboardPZNService]);}else if(this.pznSvcInstanceObserver){this._subscribePznSvcInstanceObserver(callback,context);}else{this._subscribePznSvcInstanceObserver(callback,context);var that=this;dj.util.User.hasRole("WSJ-PRO",function(hasPRORole){if(hasPRORole){that.createPZNServiceInstance(hasPRORole);}else{dj.util.User.hasRole("WSJ-ENT",function(hasENTRole){that.createPZNServiceInstance(hasENTRole);});}});}},createPZNServiceInstance:function(hasENTORPRORole){if(hasENTORPRORole){dj.service.dashboard.DashboardPZNService=new _dwd.DashboardPZNService({"pznCollectionUrl":["/professional-page/mj-companies.html","/professional-page/mj-industries.html","/professional-page/mj-sections.html","/professional-page/mj-columnists.html","/professional-page/mj-topnews.html","/professional-page/mj-mostrecent.html","/professional-page/mj-editorspick.html","/professional-page/my-journal-setup.html","/professional-page/my-journal-main.shtml"],"pznSingleCollectionUrl":["/professional-page/mj-companies.html?collection=","/professional-page/mj-industries.html?collection=","/professional-page/mj-sections.html?collection=","/professional-page/mj-columnists.html?collection=","/professional-page/mj-topnews.html?collection="],"pznCollectionEditUrl":["/professional-page/mj-companies.html?editMode=yes","/professional-page/mj-industries.html?editMode=yes","/professional-page/mj-sections.html?editMode=yes","/professional-page/mj-columnists.html?editMode=yes","/professional-page/mj-topnews.html?editMode=yes","/professional-page/mj-mostrecent.html?editMode=yes","/professional-page/mj-editorspick.html?editMode=yes"],"pagePathValue":"/professional-page","mjVersion":"/version/3?loc=mj&dedupe=true",xhtmlServiceUrls:{"companies":"/professional-npage/0_0_EM_1034_companies_update.html","industries":"/professional-npage/0_0_EM_1033_industries_update.html","sections":"/professional-npage/0_0_EM_1031_sections_update.html","columns":"/professional-npage/0_0_EM_1032_columns_update.html","topNews":"/professional-npage/0_0_EM_1036_topNews_update.html","mostRecent":"/professional-npage/0_0_EM_1035_mostRecent_update.html","editorsPick":"/professional-npage/0_0_EM_1037_EditorPicks_update.html","mostRecentSaved":"/professional-npage/0_0_EM_1060_mjDockSaved.html","userSaved":"/professional-npage/0_0_EM_1060_mjDockSavedColl.html","mjDockSavedNav":"/professional-npage/0_0_EM_1060_mjDockSavedNav.html","mjDockCompany_News":"/professional-npage/0_0_EM_1055_mjDockCompany_News.html","mjDockIndustry_News":"/professional-npage/0_0_EM_1055_mjDockIndustry_News.html","mjDockTopics":"/professional-npage/0_0_EM_1055_mjDockTopics.html","mjDockColumns":"/professional-npage/0_0_EM_1055_mjDockColumns.html","mjDockTop_News":"/professional-npage/0_0_EM_1055_mjDockTop_News.html","mjDockMost_Recent":"/professional-npage/0_0_EM_1055_mjDockMost_Recent.html","mjDockEditors_Pick":"/professional-npage/0_0_EM_1055_mjDockEditors_Pick.html","mjDocktabCompanies":"/professional-npage/0_0_EM_1055_mjDocktabCompanies.html","mjDocktabIndustries":"/professional-npage/0_0_EM_1055_mjDocktabIndustries.html","pmDocktabCompanies":"/professional-npage/0_0_EM_1055_mjDocktabCompanies.html","pmDocktabIndustries":"/professional-npage/0_0_EM_1055_mjDocktabIndustries.html","mjDockMostRecentSaved":"/professional-npage/0_0_EM_1055_mjDocktabSaved.html","mjDockKeywordAlerts":"/professional-npage/0_0_EM_1055_mjDocktabKeywordAlerts.html","mjDockMarkets":"/professional-npage/0_0_EM_1055_mjDocktabMarkets.html"},serviceUrls:{"updatePmProfile":"/epsvcs/update/userProfile"}});}else{dj.service.dashboard.DashboardPZNService=new _dwd.DashboardPZNService();}
this._firePznSvcInstanceObserver();},_subscribePznSvcInstanceObserver:function(callback,context){if(!this.pznSvcInstanceObserver){this.pznSvcInstanceObserver=new _du.Observer();}
this.pznSvcInstanceObserver.subscribe(callback,context);},_firePznSvcInstanceObserver:function(){if(this.pznSvcInstanceObserver){this.pznSvcInstanceObserver.fire();}}};}());dojo.provide("dj.service.dashboard.DashboardFolderService");dojo.require("dj.service.dashboard.DashboardPZNServiceFactory");dojo.require("dj.service.dashboard.DashboardService");dojo.require("dj.module.dashboard.DashboardExpletives");if(typeof dj=="undefined"){dj={};}
if(typeof dj.widget=="undefined"){dj.widget={};}
if(typeof dj.widget.dashboard=="undefined"){dj.widget.dashboard={};}
if(typeof dj.service=="undefined"){dj.service={};}
if(typeof dj.service.dashboard=="undefined"){dj.service.dashboard={};}
(function(){var _du=dj.util;var _dsd=dj.service.dashboard;var _dwd=dj.widget.dashboard;var _dud=_du.dashboard;var _ctx=dj.context;(_dwd.DashboardFolderService=function(cfg){this._serviceWidget=null;this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._responsePending={};this._subscribed={};this._allFolders=null;this._folderContacts=null;this._allFolderContacts=null;this._allFolderFreqContacts=null;this._defaultFolder=null;this._userFolders={};this.initServices();this._updateObservers={};this._updateCallbacks={};this._dataObserver=new _du.Observer();}).prototype={DEFAULT_CONFIG:{serviceUrls:{"defaultFolders":"/pznusersvc/view/getUser/defaultFolders/version/2","userFolders":"/WSJDBFolders/service.svc/Folders/User/userName/FolderTitle","userFoldersOnCreate":"/WSJDBFolders/service.svc/Folders/User/userName/LatestFirst","userFolder":"/WSJDBFolders/service.svc/Folders/userName","folderFeed":"/pznusersvc/getFolders/userName/","folderFeedPage":"/pznusersvc/view/dash/FeedPage/version/2/","topArticlesFolder":"/pznusersvc/view/dash/TopArticlesPage/version/2","folderPrefs":"/WSJDBFolders/service.svc/FolderPrefs/userName","article":"/WSJDBFeeds/service.svc/Article","articleTypesCount":"/WSJDBFeeds/service.svc/ArticleTypesCount/userName","updateUser":"/pznusersvc/update/updateUser/userName","articles":"/WSJDBFeeds/service.svc/Articles/userName","folderContacts":"/WSJDBFolders/service.svc/Folder/","modifyFolderContacts":"/WSJDBFolders/service.svc/Folder/Contacts","allUserContacts":"/WSJDBFolders/service.svc/User/Contacts","frequentUserContacts":"/WSJDBFolders/service.svc/User/Contacts/Frequent","mostRecentSettings":"/WSJDBFolders/service.svc/UserPrefs","deleteAlertFolder":"/epsvco/profile/v1/Alert/format/xml/id/","updateAlertMjDockView":"/epsvco/profile/v1/Profile"},folderProps:['Y','User','Default','System','Quick Save'],pznFolderNames:['Companies','Industries','Sections','Columnists','Markets','Portfolio','Quick Save','Top News'],colBlankError:"Please enter a name for your new Collection.",colMaxCharError:"Please enter a name for your Collection less than 30 characters",colValidError:"Text includes invalid characters: Only use letters, numbers and . , - _",colLimitError:"Limit reached: Please remove a collection before adding another.",colDuplicateError:"Collection already exists. Please enter a new name.",inappNameError:"Please refrain from using inappropriate vocabulary."},initServices:function(){_dsd.DashboardPZNServiceFactory.getPZNServiceInstance(this.handleInitServices,this);},handleInitServices:function(_pznServiceWidget){this._serviceWidget=_dsd.DashboardService;this._pznServiceWidgetDFS=(_pznServiceWidget)?_pznServiceWidget:_dsd.DashboardPZNService;this._collVisibility=this._pznServiceWidgetDFS.getOtherDefaultVisibleFolders();},getFolderProps:function(){return this._cfg.folderProps;},getPznFolderNames:function(){return this._cfg.pznFolderNames;},getAllUserFolders:function(){return this._allFolders;},articleTimestampFormat:function(newsArticleDate){if(newsArticleDate===""){return newsArticleDate;}
newsArticleDate=newsArticleDate.replace("PM","");newsArticleDate=newsArticleDate.replace("AM","");newsArticleDate=newsArticleDate.replace("pm","");newsArticleDate=newsArticleDate.replace("am","");newsArticleDate=new Date(newsArticleDate);var todaysDate=new Date();if(todaysDate.getDate()===newsArticleDate.getDate()&&todaysDate.getMonth()===newsArticleDate.getMonth()){var newsArticleHrs=newsArticleDate.getHours();if(newsArticleHrs>=12){var amOrPmVal=" p.m.";newsArticleHrs=12-newsArticleHrs;if(newsArticleHrs<0)newsArticleHrs=-newsArticleHrs;}else{var amOrPmVal=" a.m.";}
if(newsArticleHrs===0)newsArticleHrs="12";var newsArticleMins=newsArticleDate.getMinutes();if(newsArticleMins<10){newsArticleMins="0"+newsArticleMins;}
newsArticleDate=newsArticleHrs+":"+newsArticleMins+amOrPmVal;}else{var newsArticleDay=newsArticleDate.getDate();var newsArticleMonth=newsArticleDate.getMonth()+1;newsArticleDate=newsArticleMonth+"/"+newsArticleDay;}
return newsArticleDate;},typeOfResult:function(obj){if(typeof(obj)=="object"){if(obj.length){return"array";}else{return"object";}}else{return typeof(obj);}},validateCollectionName:function(type,foldername,id,foldernames,totalUserCollection){var _djl=dj.lang;var el=dojo.byId(id);foldername=foldername.replace(/^\s+|\s+$/g,'').toLowerCase();if(typeof dj.module.dashboard.expletives!=='undefined'){var cursewords=dj.module.dashboard.expletives;var _icheck=0;var nameval=foldername.replace(/ /g,"");while(cursewords[_icheck]){var curseWord=cursewords[_icheck];if(nameval==curseWord){el.innerHTML=this._cfg.inappNameError;el.style.display="block";return false;};_icheck++;}}
if(typeof totalUserCollection!=='undefined'){if(totalUserCollection>20){el.innerHTML=this._cfg.colLimitError;el.style.display="block";return false;}}
if(typeof foldernames!=='undefined'){var _check=0;if(type==="new"){while(foldernames[_check]){if(foldername===foldernames[_check].FolderTitle.toLowerCase()){el.innerHTML=this._cfg.colDuplicateError;el.style.display="block";return false;}
_check++;}}else{var _check=0;var _folderId=type.replace("User","");while(foldernames[_check]){if(foldername==(foldernames[_check].FolderTitle.toLowerCase())&&foldernames[_check].FolderID!=_folderId){el.innerHTML=this._cfg.colDuplicateError;el.style.display="block";return false;}
_check++;}}}
if(""===foldername){el.innerHTML=this._cfg.colBlankError;el.style.display="block";return false;}
if("most recent"==foldername||"quick save"==foldername){dojo.byId(id).innerHTML=this._cfg.colDuplicateError;el.style.display="block";return false;}
if(foldername.length>30){el.innerHTML=this._cfg.colMaxCharError;el.style.display="block";return false;}
el.style.display="none";var invalidChars="~?!#$%&*()\"||<>=+;:][{}/\\";for(var count=0,len=invalidChars.length;count<len;count++){var badChar=invalidChars.charAt(count);if(foldername.indexOf(badChar,0)>-1){el.innerHTML=this._cfg.colValidError;el.style.display="block";return false;}}
return true;},subscribeUserFolders:function(callback,context,firstViewMode){var name="userFolders";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleUserFolders,this);this._subscribed[name]=true;}
if(firstViewMode){this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.userFoldersOnCreate);}else{this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.userFolders);}},handleUserFolders:function(key,data){var name="userFolders";this._allFolders=data;this._dataObserver.fireByName(name,data);},subscribeDefaultFolders:function(callback,context){var name="defaultFolders";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleDefaultFolders,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.defaultFolders);},handleDefaultFolders:function(key,data){var name="defaultFolders";this._allFolders=data;this._defaultFolder=data;var folderdata=this._defaultFolder.Folders;if((typeof folderdata!=='undefined')){var _check=0;while(folderdata[_check]){if("Y"==folderdata[_check].Visibility){this._collVisibility+=folderdata[_check].FolderTitle+"~";}
_check++;}}
this._dataObserver.fireByName(name,data);},reloadUserFolders:function(){var name="userFolders";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.userFolders);},subscribeUserFolder:function(folderId,callback,context){var name="folderArticles";var url=this._cfg.serviceUrls.folderFeed+folderId;this._dataObserver.subscribeByName(name+":"+folderId,callback,context);if(!this._subscribed["folderArticles:"+folderId]){this._serviceWidget.subscribeFeed("folderArticles",folderId,this.handleUserFolder,this);this._subscribed["folderArticles:"+folderId]=true;}
var criteria={FolderID:folderId};this._serviceWidget.getFeed("folderArticles",folderId,url,criteria);},searchUserFolder:function(folderId,criteria,callback,context){var name="folderArticles";if(folderId===""){folderId="MostRecent";}
criteria.FolderID=folderId;this._dataObserver.subscribeByName("folderArticles:"+folderId,callback,context);if(folderId==="MostRecent"){var url=this._cfg.serviceUrls.topArticlesFolder;url+='/'+(criteria.from||0)+'/'+(criteria.NoOfRecords||100)+'/'
+(criteria.fromDate||'09-01-1980')+'/'+(criteria.ContentType||'null');}else{var url=this._cfg.serviceUrls.folderFeedPage+folderId;url+='/'+(criteria.from||0)+'/'+(criteria.NoOfRecords||100)+'/'
+(criteria.OrderColumn||'DateAdded')+'/'+(criteria.OrderBy||'Desc')+'/'
+(criteria.ContentType||'null');}
this._userFolders["Folder:"+criteria.FolderID]=null;this._serviceWidget.subscribeFeed(name,folderId,this.handleUserFolder,this);this._serviceWidget.getFeed(name,folderId,url,criteria);},reloadFolder:function(folderId){var name="userFolders";this._serviceWidget.reloadFeed(name,folderId,this._cfg.serviceUrls.folderFeedPage+folderId);},handleUserFolder:function(key,data,criteria){var name="folderArticles";var response={"Criteria":criteria,"Results":data};this._userFolders[name+":"+criteria.FolderID]=response;this._dataObserver.fireByName(name+":"+criteria.FolderID,criteria.FolderID,response);},createUserFolder:function(folderName,mjView,dockView,callback,context){var name="CreateUserFolder";if(!mjView){mjView="Layout";}
if(!dockView){dockView="Layout";}
this._subscribeUpdateObserver(name+":"+folderName,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[{"FolderID":"0","FolderTitle":folderName,"MJView":mjView,"DockView":dockView,"FolderType":"User"}];this._serviceWidget.doPut(name,folderName,url,postData,this.handleCreateUserFolder,this);},handleCreateUserFolder:function(folderName,data){var name="CreateUserFolder";this._fireUpdateObserver(name+":"+folderName,folderName,data);this._unsubscribeUpdateObserver(name+":"+folderName);},renameUserFolder:function(folderId,newFolderName,callback,context){var name="RenameUserFolder";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[{"FolderID":folderId,"FolderTitle":newFolderName,"FolderType":"User"}];this._serviceWidget.doPost(name,folderId,url,postData,this.handleRenameUserFolder,this);},handleRenameUserFolder:function(folderId,data){var name="RenameUserFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},updateUserFolderInfo:function(folderId,folderObj,callback,context){var name="UpdateUserFolderInfo";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[folderObj];this._serviceWidget.doPost(name,folderId,url,postData,this.handleUpdateUserFolderInfo,this);},handleUpdateUserFolderInfo:function(folderId,data){var name="UpdateUserFolderInfo";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},updateUserAlertInfo:function(alertObj,callback,context){var name="UpdateUserAlertInfo";var alertId=alertObj.id;this._subscribeUpdateObserver(name+":"+alertId,callback,context);var url=this._cfg.serviceUrls.updateAlertMjDockView;var postData={"profileType":"alertView","profileName":alertId,"params":[{"mj":alertObj.mjView},{"dock":alertObj.dockView}]};this._serviceWidget.doPost(name,alertId,url,postData,this.handleUpdateUserAlertInfo,this);},handleUpdateUserAlertInfo:function(alertId,data){var name="UpdateUserAlertInfo";this._fireUpdateObserver(name+":"+alertId,alertId,data);this._unsubscribeUpdateObserver(name+":"+alertId);},updateUserFolderPreferences:function(folderId,newPrefs,callback,context){var name="UpdateUserFolderPrefs";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.folderPrefs;var prefInit={"FolderID":folderId};var newFolderPrefs=dj.lang.cloneMixin(prefInit,newPrefs);var postData=[newFolderPrefs];this._serviceWidget.doPost(name,folderId,url,postData,this.handleUpdateUserFolderPreferences,this);},handleUpdateUserFolderPreferences:function(folderId,data){var name="UpdateUserFolderPrefs";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteUserFolder:function(folderId,callback,context){var name="DeleteUserFolder";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.userFolder;var postData=[{"FolderID":folderId,"FolderType":"User"}];this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteUserFolder,this);},handleDeleteUserFolder:function(folderId,data){var name="DeleteUserFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteUserAlert:function(alertId,callback,context){var name="DeleteUserAlert";this._subscribeUpdateObserver(name+":"+alertId,callback,context);var url=this._cfg.serviceUrls.deleteAlertFolder+alertId;var postData={};this._serviceWidget.doDelete(name,alertId,url,postData,this.handleDeleteUserAlert,this);},handleDeleteUserAlert:function(alertId,data){var name="DeleteUserAlert";this._fireUpdateObserver(name+":"+alertId,alertId,data);this._unsubscribeUpdateObserver(name+":"+alertId);},moveFolder:function(key,fromIndex,toIndex){},addArticleToFolder:function(folderId,articleObject,callback,context){if(!articleObject){return;}
var name="AddArticleToFolder";var url=this._cfg.serviceUrls.article;this._subscribeUpdateObserver(name+":"+folderId,callback,context);articleObject.FolderItemID="0";articleObject.DateAdded="";if(!articleObject.ContentType){articleObject.ContentType="Article";}
var postData=[articleObject];this._serviceWidget.doPut(name,folderId,url,postData,this.handleAddArticleToFolder,this);},handleAddArticleToFolder:function(folderId,data){var name="AddArticleToFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteArticleFromFolder:function(folderId,folderItemId,callback,context){var name="DeleteArticleFromFolder";var url=this._cfg.serviceUrls.article;this._subscribeUpdateObserver(name+":"+folderId,callback,context);var articleObject={};articleObject.FolderID=folderId;articleObject.FolderItemID=folderItemId;var postData=[articleObject];this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteArticleFromFolder,this);},handleDeleteArticleFromFolder:function(folderId,data){var name="DeleteArticleFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},subscribeArticleTypeCounts:function(daysToInclude,callback,context){var name="ArticleTypeCounts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleArticleTypeCounts,this);this._subscribed[name]=true;}
this.getArticleTypeCounts(daysToInclude);},handleArticleTypeCounts:function(daysToInclude,data){var name="ArticleTypeCounts";this._dataObserver.fireByName(name,daysToInclude,data);},buildArticleTypeDate:function(daysToInclude){var timeframe=1;if(typeof daysToInclude!=="undefined"){timeframe=daysToInclude;}
var todaydate=new Date();var newDate=new Date(todaydate.getTime()-(timeframe*24*60*60*1000));var dateValue=(newDate.getMonth()+1)+"-"+newDate.getDate()+"-"+newDate.getFullYear();return dateValue;},getArticleTypeCounts:function(daysToInclude){var name="ArticleTypeCounts";var url=this._cfg.serviceUrls.articleTypesCount+"/"+this.buildArticleTypeDate(daysToInclude);this._serviceWidget.getFeed(name,"all",url);},reloadArticleTypeCounts:function(daysToInclude){var name="ArticleTypeCounts";var url=this._cfg.serviceUrls.articleTypesCount+"/"+this.buildArticleTypeDate(daysToInclude);this._serviceWidget.reloadFeed(name,"all",url,{daysToInclude:daysToInclude});},getFolderVisibility:function(id,check){if(check=="remove"){this._collVisibility=this._collVisibility.replace(id,"");}else{this._collVisibility=this._collVisibility.replace(id,"");this._collVisibility=this._collVisibility+id;}
if(this._collVisibility=="Portfolio~"){if(dojo.byId("allMojHidden")){dojo.removeClass(dojo.byId("allMojHidden"),"hidden");dojo.addClass(dojo.byId("sort_button"),"hidden");}}
return this._collVisibility;},updatePZNVisibility:function(folderId,check,callback,context){var name="UpdatePZNVisibility";var folderlist=this.getFolderVisibility();this._subscribeUpdateObserver(name,callback,context);if(check=="Y"){folderlist=folderlist.replace(folderId+"~","");folderlist=folderlist+(folderId+"~");}else{folderlist=folderlist.replace(folderId+"~","");}
var url=this._cfg.serviceUrls.updateUser;var postData=[{"ShowFolder":folderlist}];this._serviceWidget.doPost(name,"all",url,postData,this.handlePZNVisibility,this);},handlePZNVisibility:function(folderId,data){var name="UpdatePZNVisibility";this._fireUpdateObserver(name,folderId,data);this._unsubscribeUpdateObserver(name);},deleteAllArticleFromFolder:function(folderId,callback,context){var name="DeleteAllArticleFromFolder";var url=this._cfg.serviceUrls.articles;this._subscribeUpdateObserver(name+":"+folderId,callback,context);var postData=[{"FolderID":folderId}];this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteAllArticleFromFolder,this);},handleDeleteAllArticleFromFolder:function(folderId,data){var name="DeleteAllArticleFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},_subscribeUpdateObserver:function(name,callback,context){var updateObserver=this._updateObservers[name];if(!updateObserver){updateObserver=new _du.Observer();this._updateObservers[name]=updateObserver;this._updateCallbacks[name]=callback;updateObserver.subscribe(callback,context);}},addContactsToFolder:function(folderId,contactObject,callback,context){if(!folderId){return;}
var name="AddContactsToFolder";var url=this._cfg.serviceUrls.modifyFolderContacts;this._subscribeUpdateObserver(name+":"+folderId,callback,context);var postData=contactObject;this._serviceWidget.doPut(name,folderId,url,postData,this.handleAddContactsToFolder,this);},handleAddContactsToFolder:function(folderId,data){var name="AddContactsToFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},updateFolderContacts:function(folderId,contactObject,callback,context){var name="UpdateFolderContacts";this._subscribeUpdateObserver(name+":"+folderId,callback,context);var url=this._cfg.serviceUrls.modifyFolderContacts;contactObject.ContactID="";contactObject.FirstName="";contactObject.LastName="";var postData=[contactObject];this._serviceWidget.doPost(name,folderId,url,postData,this.handleUpdateFolderContacts,this);},handleUpdateFolderContacts:function(folderId,data){var name="UpdateFolderContacts";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteContactsFromFolder:function(folderId,contactObject,callback,context){var name="DeleteContactsFromFolder";var url=this._cfg.serviceUrls.modifyFolderContacts;this._subscribeUpdateObserver(name+":"+folderId,callback,context);contactObject.FirstName="";contactObject.LastName="";var postData=contactObject;this._serviceWidget.doDelete(name,folderId,url,postData,this.handleDeleteContactsFromFolder,this);},handleDeleteContactsFromFolder:function(folderId,data){var name="DeleteContactsFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},deleteAllContactsFromFolder:function(folderId,callback,context){var name="DeleteAllContactsFromFolder";var url=this._cfg.serviceUrls.folderContacts+folderId+'/Contacts';this._subscribeUpdateObserver(name+":"+folderId,callback,context);this._serviceWidget.doDelete(name,folderId,url,"",this.handleDeleteAllContactsFromFolder,this);},handleDeleteAllContactsFromFolder:function(folderId,data){var name="DeleteAllContactsFromFolder";this._fireUpdateObserver(name+":"+folderId,folderId,data);this._unsubscribeUpdateObserver(name+":"+folderId);},subscribeFolderContacts:function(folderId,callback,context){var name="foldersContacts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleFolderContacts,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.folderContacts+folderId+'/Contacts');},handleFolderContacts:function(folderId,data){var name="foldersContacts";this._folderContacts=data;this._dataObserver.fireByName(name,data);},reloadFolderContacts:function(folderId){var name="foldersContacts";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.folderContacts+folderId+'/Contacts');},subscribeAllUserContacts:function(callback,context){var name="allUserContacts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleAllUserContacts,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.allUserContacts);},handleAllUserContacts:function(key,data){var name="allUserContacts";this._allFolderContacts=data;this._dataObserver.fireByName(name,data);},reloadAllUserContacts:function(){var name="allUserContacts";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.allUserContacts);},subscribeFrequentUserContacts:function(callback,context){var name="frequentUserContacts";this._dataObserver.subscribeByName(name,callback,context);if(!this._subscribed[name]){this._serviceWidget.subscribeFeed(name,"all",this.handleFrequentUserContacts,this);this._subscribed[name]=true;}
this._serviceWidget.getFeed(name,"all",this._cfg.serviceUrls.frequentUserContacts);},handleFrequentUserContacts:function(key,data){var name="frequentUserContacts";this._allFolderFreqContacts=data;this._dataObserver.fireByName(name,data);},reloadFrequentUserContacts:function(){var name="frequentUserContacts";this._serviceWidget.reloadFeed(name,"all",this._cfg.serviceUrls.frequentUserContacts);},updateMostRecentView:function(mjView,dockView,callback,context){var name="UpdateMostRecentView";this._subscribeUpdateObserver(name,callback,context);var url=this._cfg.serviceUrls.mostRecentSettings;var postData={"MJView":mjView,"DockView":dockView};this._serviceWidget.doPost(name,"all",url,postData,this.handleUpdateMostRecentView,this);},handleUpdateMostRecentView:function(data){var name="UpdateMostRecentView";this._fireUpdateObserver(name,data);this._unsubscribeUpdateObserver(name);},handleSearchClick:function(eventid){var id=eventid;var firstInt=id.indexOf(":");var secInt=id.indexOf(":",firstInt+1);var lastInt=id.indexOf(":",secInt+1);var _code=id.substring(firstInt+1,secInt);var _id=id.substring(secInt+1,lastInt);var _desc=unescape(id.substring(lastInt+1));var _entityObj=new dj.module.ep.search.SearchEntity({code:_code,id:_id,description:_desc});var _contextObj=new dj.module.ep.search.SearchDataBean();_contextObj.add(_entityObj);var _service=dj.module.ep.search.searchService;_service.postQuery(_contextObj);},getWrappedFolderTitle:function(folderNameStr){var invalidChars="~?!#$%&*()\"||<>=+;:][{}/\\";for(var count=0,len=invalidChars.length;count<len;count++){var badChar=invalidChars.charAt(count);if(folderNameStr.indexOf(badChar,0)>-1){return folderNameStr;}}
var folderNameSplit=folderNameStr.split(" ");var tempStr="";for(i=0;i<folderNameSplit.length;i++){if(folderNameSplit[i].length>15){if(tempStr!=""){tempStr=tempStr+" "+folderNameSplit[i].substring(0,15)+"-<br/>"
+folderNameSplit[i].substring(15,folderNameSplit[i].length);}else{tempStr=folderNameSplit[i].substring(0,15)+"-<br/>"
+folderNameSplit[i].substring(15,folderNameSplit[i].length);}}else{if(tempStr!=""){tempStr=tempStr+" "+folderNameSplit[i];}else{tempStr=folderNameSplit[i];}}}
if(tempStr!==""){folderNameStr=tempStr;}
return folderNameStr;},_fireUpdateObserver:function(name){var updateObserver=this._updateObservers[name];if(updateObserver){var fireParams=[];for(var i=1,arg,len=arguments.length;i<len;i++){fireParams.push(arguments[i]);}
updateObserver.fire.apply(updateObserver,fireParams);}},_unsubscribeUpdateObserver:function(name){this._updateObservers[name]=null;},searchDeepDiveCompanies:function(code,id,desc,metadata,query){var _entityObj=null;if(id!=null||id!=undefined){_entityObj=this.getCompEntityObj(code,id,unescape(desc));}
var _contextObj=new dj.module.ep.search.SearchDataBean({baselineQuery:unescape(query),baselineQueryMetaData:metadata,sortbyValue:dj.module.ep.search.SearchDataBean.searchConstants.sortbyArrivalTime,searchType:dj.module.ep.search.SearchDataBean.searchConstants.deepDive,queryType:dj.module.ep.search.SearchDataBean.searchConstants.simpleTraditionalQuery});if(id!=null||id!=undefined){_contextObj.add(_entityObj);}
var _service=dj.module.ep.search.searchService;_service.postQuery(_contextObj);},getCompEntityObj:function(code,id,desc){var _entityObj=new dj.module.ep.search.SearchEntity({code:code,id:id,description:desc});return _entityObj;},setIndustryDate:function(){var that=this;var i=0;while(dojo.query('.pubTimeStamp')[i]){if(dojo.query('.pubTimeStamp')[i].style.display==="none"){dojo.query('.pubTimeStamp')[i].innerHTML=this.formatToHDate(dojo.query('.pubTimeStamp')[i].innerHTML);dojo.query('.pubTimeStamp')[i].style.display='inline';}
i++;}},formatToHDate:function(pubTimeStamp){if(!pubTimeStamp||pubTimeStamp==="")return"";var that=this;var currDate=new Date();var Y=currDate.getFullYear();var M=currDate.getMonth()+1;if(M<10)M='0'+M;var E=currDate.getDate();if(E<10)E='0'+E;var cDate=M+'/'+E+'/'+Y;var pY=pubTimeStamp.substring(0,4);var pM=pubTimeStamp.substring(5,7);var pE=pubTimeStamp.substring(8,10);var pDate=pM+'/'+pE+'/'+pY;if(cDate===pDate){var pTime=pubTimeStamp.substring(11,16);var pHr=pTime.substring(0,2);var pMi=pTime.substring(3,5);if(pHr>=12){pHr=12-pHr;if(pHr<0)pHr=-pHr;if(pHr===0)pHr="12";pTime=pHr+':'+pMi+' p.m.';}else{if(pHr.substring(0,1)==='0'){pHr=pHr.substring(1,pHr.length);}
pTime=pHr+':'+pMi+' a.m.';}
return pTime;}else{return pDate;}}};dj.service.dashboard.DashboardFolderService=new _dwd.DashboardFolderService();}());dojo.provide("dj.widget.dashboard.DashboardSaveTo");dojo.require("dj.service.dashboard.DashboardFolderService");dojo.require("dj.service.dashboard.DashboardPZNServiceFactory");dojo.require("dj.util.Element");dojo.require("dj.util.Query");dojo.require("dj.util.User");dojo.getObject("dj.module.dashboard",true);(function(){var _dwd=dj.widget.dashboard;var _dsd=dj.service.dashboard;(_dwd.DashboardSaveTo=function(id,cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this._id=null;this._serviceWidget=null;if(typeof id!=="undefined"){this.id=id;}
this.initServices();this._dud=dj.util.dashboard;}).prototype={DEFAULT_CONFIG:{mjSaveToWidgetInstance:"Article",mjSaveToWidgetArticle:"Article",mjSaveToWidgetSearch:"Search",mjSaveToWidgetMJLanding:"MyJournalLanding",mjSaveToWidgetMJDetails:"MyJournalDetails",mjLandingContBlock:"mjReorderContainer",mjDetailsContBlock:"hideArticlesDiv",mjDockBarBlock:"pmDock",mjDockBarContBlock:".cnt_DockbarClass",mjSearchPremiumContBlock:"djsResultsPanel",mjSearchContBlock:"ARTICLESEARCHRESULTS",mjAtagsLookUpBlock:"document",mjQuickSaveLookUpClass:"mjQuickSave",mjMoreLookUpClass:"mjDropdown",mjNewCollectionDefaultText:"My New Collection",mjListCollectionMode:"list",mjNewCollectionMode:"new",mjNewFolderCreatedMode:"newFolderCreated",mjSaveCollectionMode:"save",mjLoginCollectionMode:"login",mjSaveDropdownMainBlock:"mjsave_dropdown_block",mjMoreLink:"widget.mjsave_more",mjMoreSaveThisLink:"widget.mjsave_more_savethis",mjMoreSavedLink:"widget.mjsave_more_saved",mjQuickSaveLink:"widget.mjsave_quicksave",mjQuickSaveThisLink:"widget.mjsave_quicksave_savethis",mjQuickSaveSavedLink:"widget.mjsave_saved",mjItemBlock:".mjItemMain",mjItemLink:".mjLinkItem",mjItemDesc:".mjItemDesc",mjItemDate:".mjItemDate",mjItemSource:".mjItemSource",mjItemSourceCode:".mjItemSourceCode",mjSaveDropdownCollList:"mjsave_mycoll_collection_list",mjUserCollectionType:"User",mjSystemCollectionType:"System",mjSaveToPrefix:"saveToFolder#",mjSaveError:"mjsave_error",mjsaveNewCollSubmit:"mjsaveNewCollSubmit",mjsaveNewCollCancel:"mjsaveNewCollCancel",mjAddCollLink:"mjsave_addcoll_link",mjNewCollField:"new-collection",mjSaveToNewPromoText:"mjsave_promotext",mjSiteWideDock:"false"},initServices:function(){_dsd.DashboardPZNServiceFactory.getPZNServiceInstance(this.initialize,this);},initialize:function(_pznServiceWidget){this._pznServiceWidget=(_pznServiceWidget)?_pznServiceWidget:_dsd.DashboardPZNService;this._serviceWidget=_dsd.DashboardFolderService;this._pagePathValue=this._pznServiceWidget.getPagePathValue();this.initialLoad=true;this.selfReloadDone="false";if(this._cfg.mjSaveToWidgetInstance==="IntroMJ"||this._cfg.mjSaveToWidgetInstance==="IntroSaved"){var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(!isLoggedIn){that.setupLoginOrRegister(that._cfg.mjSaveToWidgetInstance);}});return;}
if(window.location.href.indexOf("/article/")!==-1){this._cfg.mjSaveToWidgetInstance=this._cfg.mjSaveToWidgetArticle;this._cfg.mjSiteWideDock="false";}else if(window.location.href.indexOf("/my-")!==-1||window.location.href.indexOf("/mj-")!==-1){this._cfg.mjSiteWideDock="false";if(window.location.href.indexOf("my-journal-main")!==-1){this._cfg.mjSaveToWidgetInstance=this._cfg.mjSaveToWidgetMJLanding;}}
if(this._cfg.mjSiteWideDock==="false"){this.setUpSaveToObservers();}else{this.setUpSaveToObservers(dojo.byId(this._cfg.mjDockBarBlock));}
var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){that.setupNewCollectionObservers();}else{that.setupLoginOrRegister();}});this.oMjSaveDropDownContainer=dojo.byId(this._cfg.mjSaveDropdownMainBlock);dojo.connect(document,"onclick",this,function(event){if(this.oMjSaveDropDownContainer.innerHTML!==""){var isMousePointerinModalContainer=dj.util.Element.contains(this.oMjSaveDropDownContainer,event.clientX,event.clientY);if(isMousePointerinModalContainer==false){this.restoreDefaultState();}}});if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){dj.module.articleTabs.panels.addChangeListener("success",function(){this.restoreDefaultState();},this);}},setUpSaveToObservers:function(containerNode){if((window.location.href.indexOf("/professional-search/")!==-1||window.location.href.indexOf("/professional-industry/")!==-1)&&containerNode!==dojo.byId(this._cfg.mjDockBarBlock)){return;}
var startPoint=eval(this._cfg.mjAtagsLookUpBlock);if(containerNode){startPoint=containerNode;}
var tdTags=dojo.query("td",startPoint);if(dojo.isIE<7){if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding){var divTags=dojo.query("div",startPoint);for(var i=0;i<divTags.length;i++){if(divTags[i].className.indexOf("newsFunc")!==-1){this.divTag=divTags[i];var divtag=dojo.byId(this.divTag);dojo.connect(divtag,"mouseover",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(dojo.byId(this._cfg.mjLandingContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else{var possibleContainers=dojo.query(this._cfg.mjItemBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOver=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOver!=="undefined"){if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}
if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed");}
dojo.addClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}});var div=dojo.byId(this.divtag);dojo.connect(div,"onmouseout",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(dojo.byId(this._cfg.mjLandingContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else{var possibleContainers=dojo.query(this._cfg.mjItemBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOut=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOut!=="undefined"){if(dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover");}
if(!dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed")){dojo.addClass(saveToObjMouseOut,"IE6ddStandardCollapsed");}}});}}}}
if(dojo.isIE<7){if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){for(var i=0;i<tdTags.length;i++){if(tdTags[i].className.indexOf("mjArticleAction")!==-1){this.tdTag=tdTags[i];if(this.tdTag&&this.tdTag.innerHTML!==""){var td=dojo.byId(this.tdTag);dojo.connect(td,"onmouseover",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJLanding){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJDetails){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDetailsContBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOver=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOver!=="undefined"){if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}
if(dojo.hasClass(saveToObjMouseOver,"IE6ddStandardCollapsed")){dojo.removeClass(saveToObjMouseOver,"IE6ddStandardCollapsed");}
dojo.addClass(saveToObjMouseOver,"IE6ddStandardCollapsed-hover");}});var td=dojo.byId(this.tdTag);dojo.connect(td,"onmouseout",this,function(event){dojo.stopEvent(event);if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJLanding){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJDetails){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDetailsContBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(srcElement,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer!==""){var saveToObjMouseOut=dojo.query(".dropdown_container",currentSavedItemContainer)[0];}
if(typeof saveToObjMouseOut!=="undefined"){if(dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover")){dojo.removeClass(saveToObjMouseOut,"IE6ddStandardCollapsed-hover");}
if(!dojo.hasClass(saveToObjMouseOut,"IE6ddStandardCollapsed")){dojo.addClass(saveToObjMouseOut,"IE6ddStandardCollapsed");}}});}}}}}
if(window.location.href.indexOf("/professional-search/")===-1&&window.location.href.indexOf("/professional-industry/")===-1){if(this.eventConnections){dojo.forEach(this.eventConnections,dojo.disconnect);}
this.eventConnections=[];var aTags=dojo.query("a",startPoint);for(var i=0;i<aTags.length;i++){if(aTags[i].className.indexOf(this._cfg.mjQuickSaveLookUpClass)!==-1){this.aTag=aTags[i];this.eventConnections.push(dojo.connect(this.aTag,"onclick",this,function(event){dojo.stopEvent(event);if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=="undefined"){dojo.addClass(sharedrpDwn,"collapsed");dojo.removeClass(sharedrpDwn,"expanded");}}
if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
var saveToObj=srcElement.offsetParent;if(dojo.isIE===7){saveToObj=srcElement.offsetParent.offsetParent.offsetParent;}
if(dojo.isIE<7||(dojo.isIE===7&&this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetSearch)){saveToObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(saveToObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(saveToObj,dojo.query(this._cfg.mjSearchPremiumContBlock)[0])){this.searchPremiumInstance=true;}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(saveToObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails||this.collectionMode===this._cfg.mjLoginCollectionMode||this.dockbarInstance)&&!this.searchPremiumInstance){if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
this.quickSaveModeBlk=false;console.log("superImposeBlock..");this.superImposeBlock(saveToObj,"false");}else{this.currQuickSaveObj=saveToObj;this.quickSaveModeBlk=true;if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}else{this.superImposeBlock(this.currQuickSaveObj,"true");}}}));}
if(aTags[i].className.indexOf(this._cfg.mjMoreLookUpClass)!==-1){this.aTag=aTags[i];this.eventConnections.push(dojo.connect(this.aTag,"onclick",this,function(event){dojo.stopEvent(event);this.quickSaveModeBlk=false;if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=='undefined'){dojo.addClass(sharedrpDwn,'collapsed');dojo.removeClass(sharedrpDwn,'expanded');}}
if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
var moreObj=srcElement.offsetParent;if(dojo.isIE===7){moreObj=srcElement.offsetParent.offsetParent.offsetParent;}
if(dojo.isIE<7||(dojo.isIE===7&&this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetSearch)){moreObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(moreObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(moreObj,this._cfg.mjSearchPremiumContBlock)){this.searchPremiumInstance=true;}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(moreObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
console.log("superImposeBlock");this.superImposeBlock(moreObj,"false");}));}}}else{dj.lang.addLiveEvent(".mjQuickSave","click",function(ev){dojo.stopEvent(ev);if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=='undefined'){dojo.addClass(sharedrpDwn,'collapsed');dojo.removeClass(sharedrpDwn,'expanded');}}
var srcElement=(ev.target||ev.srcElement);var saveToObj=srcElement.offsetParent;if(dojo.isIE===7){saveToObj=srcElement.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(saveToObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(saveToObj,this._cfg.mjSearchPremiumContBlock)){this.searchPremiumInstance=true;}
if(this.searchPremiumInstance){if(dojo.isIE<7){saveToObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(saveToObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails||this.collectionMode===this._cfg.mjLoginCollectionMode||this.dockbarInstance)&&!this.searchPremiumInstance){if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
this.quickSaveModeBlk=false;console.log("superImposeBlock.");this.superImposeBlock(saveToObj,"false");}else{this.currQuickSaveObj=saveToObj;this.quickSaveModeBlk=true;if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}else{this.superImposeBlock(this.currQuickSaveObj,"true");}}},this);dj.lang.addLiveEvent(".mjDropdown","click",function(ev){dojo.stopEvent(ev);this.quickSaveModeBlk=false;if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetArticle){var sharedrpDwn=dojo.query(".dropdownType-share")[0];if(typeof sharedrpDwn!=='undefined'){dojo.addClass(sharedrpDwn,'collapsed');dojo.removeClass(sharedrpDwn,'expanded');}}
if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.initialLoad){this.setupSaveToCollectionList();this.initialLoad=false;}}
var srcElement=(ev.target||ev.srcElement);var moreObj=srcElement.offsetParent;if(dojo.isIE===7){moreObj=srcElement.offsetParent.offsetParent.offsetParent;}
this.dockbarInstance=false;this.searchPremiumInstance=false;if((dojo.query(this._cfg.mjDockBarContBlock).length>0)&&dojo.isDescendant(moreObj,dojo.query(this._cfg.mjDockBarContBlock)[0])){this.dockbarInstance=true;}else if(dojo.byId(this._cfg.mjSearchPremiumContBlock)&&dojo.isDescendant(moreObj,dojo.byId(this._cfg.mjSearchPremiumContBlock))){this.searchPremiumInstance=true;}
if(this.searchPremiumInstance){if(dojo.isIE<7){moreObj=srcElement.offsetParent.offsetParent.offsetParent.offsetParent;}}
if((this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJLanding||this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails)&&dojo.isIE<=8){var possibleContainers=dojo.query(this._cfg.mjItemBlock);var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){currentSavedItemContainer=possibleContainers[i];if(dojo.isDescendant(moreObj,currentSavedItemContainer)){if(!dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.addClass(currentSavedItemContainer,"hasDropdown");}}else{if(dojo.hasClass(currentSavedItemContainer,"hasDropdown")){dojo.removeClass(currentSavedItemContainer,"hasDropdown");}}
++i;}}
console.log("superImposeBlock...");this.superImposeBlock(moreObj,"false");},this);}},toggleSaveToDropdown:function(saveToObj,saveToShowClass,saveToHideClass){if(saveToObj){if(dojo.hasClass(saveToObj,saveToHideClass)){dojo.removeClass(saveToObj,saveToHideClass);}
if(!dojo.hasClass(saveToObj,saveToShowClass)){dojo.addClass(saveToObj,saveToShowClass);}}},toggleSaveToPanel:function(saveToShowClass){this.saveToPanelObj=dojo.byId("saveToDropdownPanel");if(!dojo.hasClass(this.saveToPanelObj,saveToShowClass)){dojo.addClass(this.saveToPanelObj,saveToShowClass);}
if(saveToShowClass==="ddPanelState-MyCollections"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-NewCollection");dojo.removeClass(this.saveToPanelObj,"ddPanelState-SaveConfirmation");dojo.removeClass(this.saveToPanelObj,"ddPanelState-Login");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="ddPanelState-NewCollection"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-MyCollections");dojo.removeClass(this.saveToPanelObj,"ddPanelState-SaveConfirmation");dojo.removeClass(this.saveToPanelObj,"ddPanelState-Login");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="ddPanelState-SaveConfirmation"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-NewCollection");dojo.removeClass(this.saveToPanelObj,"ddPanelState-MyCollections");dojo.removeClass(this.saveToPanelObj,"ddPanelState-Login");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="ddPanelState-Login"){dojo.removeClass(this.saveToPanelObj,"ddPanelState-NewCollection");dojo.removeClass(this.saveToPanelObj,"ddPanelState-SaveConfirmation");dojo.removeClass(this.saveToPanelObj,"ddPanelState-MyCollections");dojo.removeClass(this.saveToPanelObj,"errorDisplay-On");}else if(saveToShowClass==="errorDisplay-On"){dojo.addClass(this.saveToPanelObj,saveToShowClass);}else if(saveToShowClass==="errorDisplay-Off"){dojo.removeClass(this.saveToPanelObj,saveToShowClass);}},superImposeBlock:function(parentObj,quickSaveMode){this.selfReloadDone="false";this.actualTargetObj=parentObj.parentNode;console.log("parentObj "+parentObj.innerHTML);this.currentPanelObj=dj.util.Query.next(parentObj);if(this.currentPanelObj===null||this.currentPanelObj===undefined)return;if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(quickSaveMode!=="true"){if(this.collectionMode!==this._cfg.mjLoginCollectionMode){if(this.collectionMode===this._cfg.mjNewFolderCreatedMode){this.setupSaveToCollectionList();}}
if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}}else{var qsFolderId=this.quickSaveFolderId;this.userSaveToExistingCollSave("",qsFolderId);}}
if(typeof this.mjDynamicWidgetObj==='undefined'){this.mjDynamicWidgetObj=dojo.byId(this._cfg.mjSaveDropdownMainBlock);this.prevMJObj=dojo.clone(this.mjDynamicWidgetObj);}else{if(this.mjDynamicWidgetObj.innerHTML===""){var mjSaveDiv=document.createElement('div');mjSaveDiv.id=this._cfg.mjSaveDropdownMainBlock;mjSaveDiv.className='dropdown_container dropdownType-standard expanded';mjSaveDiv.innerHTML=this.prevMJObj.innerHTML;document.body.appendChild(mjSaveDiv);this.mjDynamicWidgetObj=dojo.byId(this._cfg.mjSaveDropdownMainBlock);this.setupCollectionObservers();this.oMjSaveDropDownContainer=this.mjDynamicWidgetObj;}}
var dynamicWidgetParent=this.mjDynamicWidgetObj.parentNode;if(dynamicWidgetParent!==null){dynamicWidgetParent.removeChild(this.mjDynamicWidgetObj);}
if(this.currentPanelObj!=null&&this.mjDynamicWidgetObj.innerHTML===""){this.currentPanelObj.appendChild(mjSaveDiv);}else if(this.currentPanelObj!=null){this.currentPanelObj.appendChild(this.mjDynamicWidgetObj);}
if(this.collectionMode===this._cfg.mjLoginCollectionMode){this.toggleSaveToPanel("ddPanelState-Login");}else if(quickSaveMode==="true"){this.toggleSaveToPanel("ddPanelState-SaveConfirmation");}else{this.toggleSaveToPanel("ddPanelState-MyCollections");}
if(typeof this.lastAccessedId=='undefined'){this.lastAccessedId=this.actualTargetObj;}else if(this.lastAccessedId!==this.actualTargetObj){this.restoreDefaultState(this.lastAccessedId);this.lastAccessedId=this.actualTargetObj;}
this.toggleSaveToDropdown(this.actualTargetObj,"ddState-expanded","ddState-collapsed");var quickSaveCaseType=this._cfg.mjQuickSaveLink;var moreCaseType=this._cfg.mjMoreLink;if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetArticle||this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch||this.searchPremiumInstance){quickSaveCaseType=this._cfg.mjQuickSaveThisLink;moreCaseType=this._cfg.mjMoreSaveThisLink;if(quickSaveMode!=="true"){this.toggleSaveToBar('ddState-saveThis');}else{this.toggleSaveToBar('ddState-saved');}}else{this.toggleSaveToBar('ddState-saveTo');}
if(quickSaveMode==="true"){quickSaveCaseType=this._cfg.mjQuickSaveSavedLink;moreCaseType=this._cfg.mjMoreSavedLink;}
this.widgetQuickSaveObj=eval(document.getElementById(quickSaveCaseType));this.widgetMoreObj=eval(document.getElementById(moreCaseType));if(!this.quickSaveModeBlk){dojo.connect(this.widgetMoreObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.alreadyClosed=true;this.defaultSuperImposeAndClose();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});dojo.connect(this.widgetQuickSaveObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.alreadyClosed=true;this.defaultSuperImposeAndClose();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});}else{dojo.connect(this.widgetQuickSaveObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.restoreDefaultState();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});dojo.connect(this.widgetMoreObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.restoreDefaultState();if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails){this.closeDeletePopUps();}});}
this.currentSaveToInstance();},toggleSaveToBar:function(saveBarClass){this.saveToBarObj=dojo.byId("saveToTopBar");if(!dojo.hasClass(this.saveToBarObj,saveBarClass)){dojo.addClass(this.saveToBarObj,saveBarClass);}
if(saveBarClass==="ddState-saveTo"){dojo.removeClass(this.saveToBarObj,"ddState-saveThis");dojo.removeClass(this.saveToBarObj,"ddState-saved");}else if(saveBarClass==="ddState-saveThis"){dojo.removeClass(this.saveToBarObj,"ddState-saveTo");dojo.removeClass(this.saveToBarObj,"ddState-saved");}else if(saveBarClass==="ddState-saved"){dojo.removeClass(this.saveToBarObj,"ddState-saveTo");dojo.removeClass(this.saveToBarObj,"ddState-saveThis");}},defaultSuperImposeAndClose:function(checkClosed){if(!checkClosed||checkClosed&&!this.alreadyClosed){this.restoreDefaultState();if(checkClosed){this.alreadyClosed=true;}}},currentSaveToInstance:function(){if(this._cfg.mjSaveToWidgetInstance!==this._cfg.mjSaveToWidgetSearch){if(typeof this.saveToAdBox==='undefined'){this.saveToAdBox=dojo.byId('SaveToSponsorBox');}
if(this.saveToAdBox){if(this.saveToAdBox.innerHTML===""){}}}},closeDeletePopUps:function(){var startPoint=dojo.byId("hideArticlesDiv");if(startPoint){var divTags=dojo.query("div",startPoint);var delpop=dojo.query(".deletePopup","hideArticlesDiv")[0];if(typeof delpop!=="undefined"){this.deletePopUp=delpop.id;var _prevDeleteRow="currentRow"+this.deletePopUp;dojo.util.Element.toggleHiddenClass(this.deletePopUp);dojo.removeClass(_prevDeleteRow,"dialogShow");dojo.removeClass(this.deletePopUp,"deletePopUp");}}},setupNewCollectionObservers:function(){this.newCollLink=dojo.byId(this._cfg.mjAddCollLink);dojo.connect(this.newCollLink,"onclick",this,function(ev){dojo.stopEvent(ev);this.setupNewCollectionPopUp();});this.saveNewColl=dojo.byId(this._cfg.mjsaveNewCollSubmit);dojo.connect(this.saveNewColl,"onclick",this,function(ev){dojo.stopEvent(ev);this.userSaveToNewCollSave(ev);});this.cancelNewColl=dojo.byId(this._cfg.mjsaveNewCollCancel);dojo.connect(this.cancelNewColl,"onclick",this,function(ev){dojo.stopEvent(ev);this.userSaveToNewCollCancel(ev);});},setupNewCollectionPopUp:function(){this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");this.oFolderName=dojo.byId(this._cfg.mjNewCollField);this.oFolderName.value="";dojo.connect(this.oFolderName,"focus",this,function(ev){dojo.stopEvent(ev);dj.util.Form.clearValue(this.oFolderName,'');});dojo.connect(this.oFolderName,"onclick",this,function(ev){dojo.stopEvent(ev);dj.util.Form.clearValue(this.oFolderName,'');});dojo.connect(this.oFolderName,"onkeypress",this,function(ev){var cKeyCode=ev.keyCode||ev.which;if(dojo.isIE<7){if(cKeyCode==Event.KEY_RETURN){this.userSaveToNewCollSave(ev);}}});this.toggleSaveToPanel("ddPanelState-NewCollection");},userSaveToExistingCollSave:function(event,folderId){if(window.event){var srcElement=window.event.srcElement;}else{var srcElement=event.currentTarget;}
if(!folderId||folderId==""){var folderId=(srcElement.id).substring(srcElement.id.indexOf('#')+1,srcElement.id.length);}
var artUrl=(typeof this.currentUrl=='undefined')?"":this.currentUrl;var artTitle="";var artDesc="";var artContentID="";var artContentType="Article";var artSource="WSJ";var artSourceCode="WSJO";var artDate="";if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetArticle&&!this.dockbarInstance&&!this.searchPremiumInstance){if(typeof AT_VARS!='undefined'){artTitle=AT_VARS.articleHeadline;artDesc=unescape(AT_VARS.bodyText);artContentID=AT_VARS.baseDocId;if(typeof AT_VARS.publicationDate!=='undefined'){artDate=AT_VARS.publicationDate;}
if(typeof AT_VARS.publicationName!=='undefined'){artSource=AT_VARS.publicationName;}
if(typeof AT_VARS.articleSourceCode!=='undefined'){artSourceCode=AT_VARS.articleSourceCode;}
artUrl=window.location.href;}}else{if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetSearch){if(dojo.byId(this._cfg.mjSearchContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchContBlock);}else{var possibleContainers="";}}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJLanding){if(dojo.byId(this._cfg.mjLandingContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjLandingContBlock);}else{var possibleContainers="";}}else if(this._cfg.mjSaveToWidgetInstance==this._cfg.mjSaveToWidgetMJDetails){if(dojo.byId(this._cfg.mjDetailsContBlock)){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDetailsContBlock);}else{var possibleContainers="";}}else{var possibleContainers="";}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(this.actualTargetObj,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}
if(currentSavedItemContainer===""){if(this.dockbarInstance){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjDockBarBlock);}else if(this.searchPremiumInstance){var possibleContainers=dojo.query(this._cfg.mjItemBlock,this._cfg.mjSearchPremiumContBlock);}else{var possibleContainers=dojo.query(this._cfg.mjItemBlock);}
var currentSavedItemContainer="";var i=0;while(possibleContainers[i]){if(dojo.isDescendant(this.actualTargetObj,possibleContainers[i])){currentSavedItemContainer=possibleContainers[i];break;}
++i;}}
if(currentSavedItemContainer!==""){var savedItemSourceObj=dojo.query(this._cfg.mjItemSource,currentSavedItemContainer)[0];var savedItemSourceCodeObj=dojo.query(this._cfg.mjItemSourceCode,currentSavedItemContainer)[0];var savedItemLinkObj=dojo.query(this._cfg.mjItemLink,currentSavedItemContainer)[0];var savedItemDescObj=dojo.query(this._cfg.mjItemDesc,currentSavedItemContainer)[0];var savedItemDateObj=dojo.query(this._cfg.mjItemDate,currentSavedItemContainer)[0];artUrl=(savedItemLinkObj.href)?savedItemLinkObj.href.toString():savedItemLinkObj.innerHTML;artTitle=savedItemLinkObj.innerHTML;artDesc=(typeof savedItemDescObj!=='undefined')?savedItemDescObj.innerHTML:artTitle;artDate=(typeof savedItemDateObj!=='undefined')?savedItemDateObj.innerHTML:artDate;artSource=(typeof savedItemSourceObj!=='undefined')?savedItemSourceObj.innerHTML:artSource;artSourceCode=(typeof savedItemSourceCodeObj!=='undefined')?savedItemSourceCodeObj.innerHTML:artSourceCode;var htmlInd=artUrl.indexOf('.html');var SBInd=artUrl.indexOf('SB');artContentID=(SBInd!==-1&&htmlInd!==-1)?artUrl.substring(SBInd,htmlInd):"NA";}}
if(artUrl==""){artUrl=window.location.href;}
if(artUrl.indexOf('articleTabs')!==-1){if(artUrl.indexOf('video')!==-1){artContentType="Video";}else if(artUrl.indexOf('slideshow')!==-1){artContentType="Slideshow";}else if(artUrl.indexOf('interactive')!==-1){artContentType="Interactive Graphic";}}else{if(artUrl.indexOf('/video/')!==-1){artContentType="Video";}}
if(artSourceCode.indexOf('sc:')!==-1){artSourceCode=artSourceCode.replace("sc:","");}
artSourceCode=artSourceCode.replace(/^\s+|\s+$/g,'');artSourceCode=artSourceCode.replace(" ","");var articleObj={"FolderID":folderId,"Title":artTitle,"Desc":artDesc,"URL":artUrl,"ContentID":artContentID,"ContentType":artContentType,"ArticleSource":artSource,"ArticleSourceCode":artSourceCode,"ArticleDate":dojo.trim(artDate)};this.userSaveToExistingCollSaveAPI(folderId,articleObj,this.showSaveToCollConfirmation,this);},userSaveToExistingCollSaveAPI:function(folderId,articleObj,callback,context){this._serviceWidget.addArticleToFolder(folderId,articleObj,callback,context);},showSaveToCollConfirmation:function(key,data,criteria){try{if(!data){this.displayResetErrorMsg("display",this._cfg.mjSaveError,errorMsg);return;}
var errorMsg="NO ERROR";if((typeof this.foldertitle!=='undefined')&&this.foldertitle!==null){var folderName=this.foldertitle;this.foldertitle=null;errorMsg="Article save to "+folderName+" failed";}else{if(this.quickSaveModeBlk){var folderName="Quick Save";}else{var folderName=dojo.byId(this._cfg.mjSaveToPrefix+key).firstChild.data;}
errorMsg="Collection created! Article save to "+folderName+" failed";}
this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");this.toggleSaveToPanel("ddPanelState-SaveConfirmation");this.toggleSaveToBar('ddState-saved');this.selfReloadDone="false";var folderUrl=this._pagePathValue+"/mj-usercollection.html?folderid="+key;dojo.byId("mjsave_articlesavedtext").innerHTML='<p>Article saved to<br /> <a href="'+folderUrl+'">'
+folderName+'</a> Collection.</p>';if(this.collectionMode!==this._cfg.mjNewFolderCreatedMode){this.collectionMode=this._cfg.mjSaveCollectionMode;}
this.alreadyClosed=false;var currentFolderName=(dojo.byId('mj-userFolderName')!==null)?dojo.byId('mj-userFolderName').innerHTML.replace('<h3>','').replace('</h3>','').replace('<H3>','').replace('</H3>',''):"";if(this._cfg.mjSaveToWidgetInstance===this._cfg.mjSaveToWidgetMJDetails&&(folderName===currentFolderName||currentFolderName==='Most Recent')){var that=this;setTimeout(function(){that.defaultSuperImposeAndClose('checkClosed');if(that._cfg.mjSaveToWidgetInstance===that._cfg.mjSaveToWidgetMJDetails){that._serviceWidget.reloadUserFolders();}
if(currentFolderName==='Most Recent'){dj.module.dashboard.DashboardUserCollection.deleteHeadLineStatus();}else{dj.module.dashboard.DashboardUserCollection.deleteHeadLineStatus(key);}
that.selfReloadDone="true";},5000);}else{var that=this;setTimeout(function(){that.defaultSuperImposeAndClose('checkClosed');},5000);}}catch(e){console.error("showSaveToCollConfirmation error "+e);}},restoreDefaultState:function(prevTargetObj){if(prevTargetObj){this.toggleSaveToDropdown(prevTargetObj,"ddState-collapsed","ddState-expanded");}else if(this.actualTargetObj){if(this.selfReloadDone==="false"){this.toggleSaveToDropdown(this.actualTargetObj,"ddState-collapsed","ddState-expanded");}}},userSaveToNewCollSave:function(ev){var folderNameInput=dojo.byId(this._cfg.mjNewCollField).value;if(this._serviceWidget.validateCollectionName("new",folderNameInput,this._cfg.mjSaveError,this._response,this.userFoldersCount)){this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");folderNameInput=folderNameInput.replace(/^\s+|\s+$/g,'');this.userSaveToNewCollSaveAPI(folderNameInput,this.showSaveNewCollConfirmation,this);}else{this.displayResetErrorMsg("display",this._cfg.mjSaveError,"");}},displayResetErrorMsg:function(dispReset,whatElm,whatMsg){if(dispReset==="display"){if(whatMsg!==""){dojo.byId(whatElm).innerHTML=whatMsg;}
this.toggleSaveToPanel("errorDisplay-On");}else{dojo.byId(whatElm).innerHTML="";this.toggleSaveToPanel("errorDisplay-Off");}},userSaveToNewCollSaveAPI:function(folderName,callback,context){this._serviceWidget.createUserFolder(folderName,"Layout","Layout",callback,context);},showSaveNewCollConfirmation:function(key,data,criteria){try{if(!data){return;}
if(typeof data.Message!=='undefined'){this.displayResetErrorMsg("display",this._cfg.mjSaveError,data.Message);return;}
var folderId="";if(typeof data[0].FolderID!=='undefined'){folderId=data[0].FolderID;}else{while(this.folders[i]){var item=this.folders[i];if(item.FolderTitle===key){folderId=item.FolderID;break;}
i++;}
var maxFolderId=(this.folders[0])?this.folders[0].FolderID:"";var i=0;while(this.folders[i]){var currFolderId=this.folders[i].FolderID;if(currFolderId>maxFolderId){maxFolderId=currFolderId;}
i++;}
if(folderId===""){folderId=maxFolderId+1;}}
this.foldertitle=key;if(folderId!==""){this.collectionMode=this._cfg.mjNewFolderCreatedMode;this.userSaveToExistingCollSave("",folderId);}else{this.displayResetErrorMsg("display",this._cfg.mjSaveError,"Collection addition failed");return;}}catch(e){console.error("showSaveNewCollConfirmation error "+e);}},userSaveToNewCollCancel:function(ev){this.defaultSuperImposeAndClose();},setupSaveToCollectionList:function(){if(typeof this.folders==='undefined'){this._serviceWidget.subscribeUserFolders(this.renderSaveToCollectionList,this);}else{this._serviceWidget.reloadUserFolders();}},setupLoginOrRegister:function(mode){if(!mode){this.toggleSaveToPanel("ddPanelState-Login");this.collectionMode=this._cfg.mjLoginCollectionMode;dojo.byId('logInButton').href=dojo.byId('logInButton').href+'&url='+document.location.href
+'&mjsaveMode=quicksave';dojo.byId('regInButton').href=dojo.byId('regInButton').href+'&url='+document.location.href
+'&mjsaveMode=quicksave';}else{if(this._cfg.mjSaveToWidgetInstance==="IntroMJ"){dojo.byId('logInButton').href=dojo.byId('logInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-journal-main.html';dojo.byId('regInButton').href=dojo.byId('regInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-journal-main.html';}else{dojo.byId('logInButton').href=dojo.byId('logInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-saved-main.html';dojo.byId('regInButton').href=dojo.byId('regInButton').href+'&url='+dj.context.core.urlPrefix+'/page/my-saved-main.html';}}},setupCollectionObservers:function(){var i=0;if(typeof this.folders!=='undefined'){while(this.folders[i]){var item=this.folders[i];var folderid=item.FolderID;var folderObj=dojo.byId(this._cfg.mjSaveToPrefix+folderid);if(folderObj!==null){dojo.connect(folderObj,"onclick",this,function(ev){dojo.stopEvent(ev);this.userSaveToExistingCollSave(ev,"");});}
i++;}}},renderSaveToCollectionList:function(response){if(!response){return;}
this._response=response;this.folders=response;var folderdata="";this.quickSaveFolderId="";this.errorCondition=false;var i=0;this.userFoldersCount=0;var displayTitle="";dojo.byId(this._cfg.mjSaveDropdownCollList).innerHTML='<img height="27" width="26" border="0" alt="" src="/img/loadingAni_grey.gif" style="margin-left:60px;"/>';if(typeof response!=='undefined'){if(response.toString().length===3){this.errorCondition=true;}}
while(this.folders[i]){var item=this.folders[i];var folderid=item.FolderID;var foldertitle=item.FolderTitle;var foldertype=item.FolderType;if(typeof folderid==='undefined'){this.errorCondition=true;break;}
displayTitle=(foldertitle.length>15)?foldertitle.substring(0,14)+'...':foldertitle;if(this._cfg.mjUserCollectionType===foldertype||this._cfg.mjSystemCollectionType===foldertype){folderdata+="<li><a href='#' id='saveToFolder#"+folderid+"' >"+displayTitle+"</a></li>";++this.userFoldersCount;if(this._cfg.mjSystemCollectionType===foldertype){this.quickSaveFolderId=folderid;}}
i++;}
if(this.quickSaveModeBlk){this.superImposeBlock(this.currQuickSaveObj,"true");}
if(folderdata!==""){dojo.byId(this._cfg.mjSaveDropdownCollList).innerHTML=folderdata;this.displayResetErrorMsg("reset",this._cfg.mjSaveError,"");if(!this.quickSaveModeBlk&&this.collectionMode!==this._cfg.mjNewFolderCreatedMode&&this.collectionMode!==this._cfg.mjSaveCollectionMode){this.toggleSaveToPanel("ddPanelState-MyCollections");}
this.collectionMode=this._cfg.mjListCollectionMode;this.setupCollectionObservers();}else{this.collectionMode="";dojo.byId(this._cfg.mjSaveDropdownCollList).innerHTML="";if(this.errorCondition){if(this.collectionMode!==this._cfg.mjNewFolderCreatedMode&&this.collectionMode!==this._cfg.mjSaveCollectionMode){this.toggleSaveToPanel("ddPanelState-MyCollections");}
this.collectionMode=this._cfg.mjListCollectionMode;this.initialLoad=true;this.displayResetErrorMsg("display",this._cfg.mjSaveError,"System error occured. Please try later.");}}},getElementLeft:function(Elem){var elem=Elem;xPos=elem.offsetLeft;tempEl=elem.offsetParent;while(tempEl!=null){xPos+=tempEl.offsetLeft;tempEl=tempEl.offsetParent;}
return xPos;},getElementTop:function(Elem){var elem=Elem;yPos=elem.offsetTop;tempEl=elem.offsetParent;while(tempEl!=null){yPos+=tempEl.offsetTop;tempEl=tempEl.offsetParent;}
return yPos;},hasValidChars:function(str){str=str.replace(/^\s+|\s+$/g,'');if(!str||str===null||str===""){return false;}
var invalidChars="?!#$%&*()\"||<>=+;:][{}/\\";for(var count=0,len=invalidChars.length;count<len;count++){var badChar=invalidChars.charAt(count);if(str.indexOf(badChar,0)>-1){return false;}}
return true;}};}());
if(!document.createElement('canvas').getContext){(function(){var m=Math;var mr=m.round;var ms=m.sin;var mc=m.cos;var abs=m.abs;var sqrt=m.sqrt;var Z=10;var Z2=Z/2;function getContext(){return this.context_||(this.context_=new CanvasRenderingContext2D_(this));}
var slice=Array.prototype.slice;function bind(f,obj,var_args){var a=slice.call(arguments,2);return function(){return f.apply(obj,a.concat(slice.call(arguments)));};}
var G_vmlCanvasManager_={init:function(opt_doc){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var doc=opt_doc||document;doc.createElement('canvas');doc.attachEvent('onreadystatechange',bind(this.init_,this,doc));}},init_:function(doc){if(!doc.namespaces['g_vml_']){doc.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!doc.namespaces['g_o_']){doc.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}
if(!doc.styleSheets['ex_canvas_']){var ss=doc.createStyleSheet();ss.owningElement.id='ex_canvas_';ss.cssText='canvas{display:inline-block;overflow:hidden;'+'text-align:left;width:300px;height:150px}'+'g_vml_\\:*{behavior:url(#default#VML)}'+'g_o_\\:*{behavior:url(#default#VML)}';}
var els=doc.getElementsByTagName('canvas');for(var i=0;i<els.length;i++){this.initElement(els[i]);}},initElement:function(el,width,height){if(!el.getContext){this.width=width;this.height=height;el.getContext=getContext;el.attachEvent('onpropertychange',onPropertyChange);el.attachEvent('onresize',onResize);var attrs=el.attributes;if(attrs.width&&attrs.width.specified){el.style.width=attrs.width.nodeValue+'px';}else{el.width=el.clientWidth;}
if(attrs.height&&attrs.height.specified){el.style.height=attrs.height.nodeValue+'px';}else{el.height=el.clientHeight;}}
return el;}};function onPropertyChange(e){var el=e.srcElement;switch(e.propertyName){case'width':el.style.width=el.attributes.width.nodeValue+'px';el.getContext().clearRect();break;case'height':el.style.height=el.attributes.height.nodeValue+'px';el.getContext().clearRect();break;}}
function onResize(e){var el=e.srcElement;if(el.firstChild){el.firstChild.style.width=el.clientWidth+'px';el.firstChild.style.height=el.clientHeight+'px';}}
var dec2hex=[];for(var i=0;i<16;i++){for(var j=0;j<16;j++){dec2hex[i*16+j]=i.toString(16)+j.toString(16);}}
function createMatrixIdentity(){return[[1,0,0],[0,1,0],[0,0,1]];}
function matrixMultiply(m1,m2){var result=createMatrixIdentity();for(var x=0;x<3;x++){for(var y=0;y<3;y++){var sum=0;for(var z=0;z<3;z++){sum+=m1[x][z]*m2[z][y];}
result[x][y]=sum;}}
return result;}
function copyState(o1,o2){o2.fillStyle=o1.fillStyle;o2.lineCap=o1.lineCap;o2.lineJoin=o1.lineJoin;o2.lineWidth=o1.lineWidth;o2.miterLimit=o1.miterLimit;o2.shadowBlur=o1.shadowBlur;o2.shadowColor=o1.shadowColor;o2.shadowOffsetX=o1.shadowOffsetX;o2.shadowOffsetY=o1.shadowOffsetY;o2.strokeStyle=o1.strokeStyle;o2.globalAlpha=o1.globalAlpha;o2.arcScaleX_=o1.arcScaleX_;o2.arcScaleY_=o1.arcScaleY_;o2.lineScale_=o1.lineScale_;}
function processStyle(styleString){var str,alpha=1;styleString=String(styleString);if(styleString.substring(0,3)=='rgb'){var start=styleString.indexOf('(',3);var end=styleString.indexOf(')',start+1);var guts=styleString.substring(start+1,end).split(',');str='#';for(var i=0;i<3;i++){str+=dec2hex[Number(guts[i])];}
if(guts.length==4&&styleString.substr(3,1)=='a'){alpha=guts[3];}}else{str=styleString;}
return{color:str,alpha:alpha};}
function processLineCap(lineCap){switch(lineCap){case'butt':return'flat';case'round':return'round';case'square':default:return'square';}}
function CanvasRenderingContext2D_(surfaceElement){this.m_=createMatrixIdentity();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.strokeStyle='#000';this.fillStyle='#000';this.lineWidth=1;this.lineJoin='miter';this.lineCap='butt';this.miterLimit=Z*1;this.globalAlpha=1;this.canvas=surfaceElement;var el=surfaceElement.ownerDocument.createElement('div');el.style.width=G_vmlCanvasManager_.width;el.style.height=G_vmlCanvasManager_.height;el.style.overflow='hidden';el.style.position='absolute';surfaceElement.appendChild(el);this.element_=el;this.arcScaleX_=1;this.arcScaleY_=1;this.lineScale_=1;}
var contextPrototype=CanvasRenderingContext2D_.prototype;contextPrototype.clearRect=function(){this.element_.innerHTML='';this.currentPath_=[];};contextPrototype.beginPath=function(){this.currentPath_=[];};contextPrototype.moveTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'moveTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.lineTo=function(aX,aY){var p=this.getCoords_(aX,aY);this.currentPath_.push({type:'lineTo',x:p.x,y:p.y});this.currentX_=p.x;this.currentY_=p.y;};contextPrototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var p=this.getCoords_(aX,aY);var cp1=this.getCoords_(aCP1x,aCP1y);var cp2=this.getCoords_(aCP2x,aCP2y);bezierCurveTo(this,cp1,cp2,p);};function bezierCurveTo(self,cp1,cp2,p){self.currentPath_.push({type:'bezierCurveTo',cp1x:cp1.x,cp1y:cp1.y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y});self.currentX_=p.x;self.currentY_=p.y;}
contextPrototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var cp=this.getCoords_(aCPx,aCPy);var p=this.getCoords_(aX,aY);var cp1={x:this.currentX_+2.0/3.0*(cp.x-this.currentX_),y:this.currentY_+2.0/3.0*(cp.y-this.currentY_)};var cp2={x:cp1.x+(p.x-this.currentX_)/3.0,y:cp1.y+(p.y-this.currentY_)/3.0};bezierCurveTo(this,cp1,cp2,p);};contextPrototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){aRadius*=Z;var arcType=aClockwise?'at':'wa';var xStart=aX+mc(aStartAngle)*aRadius-Z2;var yStart=aY+ms(aStartAngle)*aRadius-Z2;var xEnd=aX+mc(aEndAngle)*aRadius-Z2;var yEnd=aY+ms(aEndAngle)*aRadius-Z2;if(xStart==xEnd&&!aClockwise){xStart+=0.125;}
var p=this.getCoords_(aX,aY);var pStart=this.getCoords_(xStart,yStart);var pEnd=this.getCoords_(xEnd,yEnd);this.currentPath_.push({type:arcType,x:p.x,y:p.y,radius:aRadius,xStart:pStart.x,yStart:pStart.y,xEnd:pEnd.x,yEnd:pEnd.y});};contextPrototype.rect=function(aX,aY,aWidth,aHeight){this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();};contextPrototype.strokeRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.stroke();this.currentPath_=[];};contextPrototype.fillRect=function(aX,aY,aWidth,aHeight){this.beginPath();this.moveTo(aX,aY);this.lineTo(aX+aWidth,aY);this.lineTo(aX+aWidth,aY+aHeight);this.lineTo(aX,aY+aHeight);this.closePath();this.fill();this.currentPath_=[];};contextPrototype.createLinearGradient=function(aX0,aY0,aX1,aY1){var gradient=new CanvasGradient_('gradient');gradient.x0_=aX0;gradient.y0_=aY0;gradient.x1_=aX1;gradient.y1_=aY1;return gradient;};contextPrototype.createRadialGradient=function(aX0,aY0,aR0,aX1,aY1,aR1){var gradient=new CanvasGradient_('gradientradial');gradient.x0_=aX0;gradient.y0_=aY0;gradient.r0_=aR0;gradient.x1_=aX1;gradient.y1_=aY1;gradient.r1_=aR1;return gradient;};contextPrototype.drawImage=function(image,var_args){var dx,dy,dw,dh,sx,sy,sw,sh;var oldRuntimeWidth=image.runtimeStyle.width;var oldRuntimeHeight=image.runtimeStyle.height;image.runtimeStyle.width='auto';image.runtimeStyle.height='auto';var w=image.width;var h=image.height;image.runtimeStyle.width=oldRuntimeWidth;image.runtimeStyle.height=oldRuntimeHeight;if(arguments.length==3){dx=arguments[1];dy=arguments[2];sx=sy=0;sw=dw=w;sh=dh=h;}else if(arguments.length==5){dx=arguments[1];dy=arguments[2];dw=arguments[3];dh=arguments[4];sx=sy=0;sw=w;sh=h;}else if(arguments.length==9){sx=arguments[1];sy=arguments[2];sw=arguments[3];sh=arguments[4];dx=arguments[5];dy=arguments[6];dw=arguments[7];dh=arguments[8];}else{throw Error('Invalid number of arguments');}
var d=this.getCoords_(dx,dy);var w2=sw/2;var h2=sh/2;var vmlStr=[];var W=10;var H=10;vmlStr.push(' <g_vml_:group',' coordsize="',Z*W,',',Z*H,'"',' coordorigin="0,0"',' style="width:',W,'px;height:',H,'px;position:absolute;');if(this.m_[0][0]!=1||this.m_[0][1]){var filter=[];filter.push('M11=',this.m_[0][0],',','M12=',this.m_[1][0],',','M21=',this.m_[0][1],',','M22=',this.m_[1][1],',','Dx=',mr(d.x/Z),',','Dy=',mr(d.y/Z),'');var max=d;var c2=this.getCoords_(dx+dw,dy);var c3=this.getCoords_(dx,dy+dh);var c4=this.getCoords_(dx+dw,dy+dh);max.x=m.max(max.x,c2.x,c3.x,c4.x);max.y=m.max(max.y,c2.y,c3.y,c4.y);vmlStr.push('padding:0 ',mr(max.x/Z),'px ',mr(max.y/Z),'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',filter.join(''),", sizingmethod='clip');")}else{vmlStr.push('top:',mr(d.y/Z),'px;left:',mr(d.x/Z),'px;');}
vmlStr.push(' ">','<g_vml_:image src="',image.src,'"',' style="width:',Z*dw,'px;',' height:',Z*dh,'px;"',' cropleft="',sx/w,'"',' croptop="',sy/h,'"',' cropright="',(w-sx-sw)/w,'"',' cropbottom="',(h-sy-sh)/h,'"',' />','</g_vml_:group>');this.element_.insertAdjacentHTML('BeforeEnd',vmlStr.join(''));};contextPrototype.stroke=function(aFill){var lineStr=[];var lineOpen=false;var a=processStyle(aFill?this.fillStyle:this.strokeStyle);var color=a.color;var opacity=a.alpha*this.globalAlpha;var W=10;var H=10;lineStr.push('<g_vml_:shape',' filled="',!!aFill,'"',' style="position:absolute;width:',W,'px;height:',H,'px;"',' coordorigin="0 0" coordsize="',Z*W,' ',Z*H,'"',' stroked="',!aFill,'"',' path="');var newSeq=false;var min={x:null,y:null};var max={x:null,y:null};for(var i=0;i<this.currentPath_.length;i++){var p=this.currentPath_[i];var c;switch(p.type){case'moveTo':c=p;lineStr.push(' m ',mr(p.x),',',mr(p.y));break;case'lineTo':lineStr.push(' l ',mr(p.x),',',mr(p.y));break;case'close':lineStr.push(' x ');p=null;break;case'bezierCurveTo':lineStr.push(' c ',mr(p.cp1x),',',mr(p.cp1y),',',mr(p.cp2x),',',mr(p.cp2y),',',mr(p.x),',',mr(p.y));break;case'at':case'wa':lineStr.push(' ',p.type,' ',mr(p.x-this.arcScaleX_*p.radius),',',mr(p.y-this.arcScaleY_*p.radius),' ',mr(p.x+this.arcScaleX_*p.radius),',',mr(p.y+this.arcScaleY_*p.radius),' ',mr(p.xStart),',',mr(p.yStart),' ',mr(p.xEnd),',',mr(p.yEnd));break;}
if(p){if(min.x==null||p.x<min.x){min.x=p.x;}
if(max.x==null||p.x>max.x){max.x=p.x;}
if(min.y==null||p.y<min.y){min.y=p.y;}
if(max.y==null||p.y>max.y){max.y=p.y;}}}
lineStr.push(' ">');if(!aFill){var lineWidth=this.lineScale_*this.lineWidth;if(lineWidth<1){opacity*=lineWidth;}
lineStr.push('<g_vml_:stroke',' opacity="',opacity,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',processLineCap(this.lineCap),'"',' weight="',lineWidth,'px"',' color="',color,'" />');}else if(typeof this.fillStyle=='object'){var fillStyle=this.fillStyle;var angle=0;var focus={x:0,y:0};var shift=0;var expansion=1;if(fillStyle.type_=='gradient'){var x0=fillStyle.x0_/this.arcScaleX_;var y0=fillStyle.y0_/this.arcScaleY_;var x1=fillStyle.x1_/this.arcScaleX_;var y1=fillStyle.y1_/this.arcScaleY_;var p0=this.getCoords_(x0,y0);var p1=this.getCoords_(x1,y1);var dx=p1.x-p0.x;var dy=p1.y-p0.y;angle=Math.atan2(dx,dy)*180/Math.PI;if(angle<0){angle+=360;}
if(angle<1e-6){angle=0;}}else{var p0=this.getCoords_(fillStyle.x0_,fillStyle.y0_);var width=max.x-min.x;var height=max.y-min.y;focus={x:(p0.x-min.x)/width,y:(p0.y-min.y)/height};width/=this.arcScaleX_*Z;height/=this.arcScaleY_*Z;var dimension=m.max(width,height);shift=2*fillStyle.r0_/dimension;expansion=2*fillStyle.r1_/dimension-shift;}
var stops=fillStyle.colors_;stops.sort(function(cs1,cs2){return cs1.offset-cs2.offset;});var length=stops.length;var color1=stops[0].color;var color2=stops[length-1].color;var opacity1=stops[0].alpha*this.globalAlpha;var opacity2=stops[length-1].alpha*this.globalAlpha;var colors=[];for(var i=0;i<length;i++){var stop=stops[i];colors.push(stop.offset*expansion+shift+' '+stop.color);}
lineStr.push('<g_vml_:fill type="',fillStyle.type_,'"',' method="none" focus="100%"',' color="',color1,'"',' color2="',color2,'"',' colors="',colors.join(','),'"',' opacity="',opacity2,'"',' g_o_:opacity2="',opacity1,'"',' angle="',angle,'"',' focusposition="',focus.x,',',focus.y,'" />');}else{lineStr.push('<g_vml_:fill color="',color,'" opacity="',opacity,'" />');}
lineStr.push('</g_vml_:shape>');this.element_.insertAdjacentHTML('beforeEnd',lineStr.join(''));};contextPrototype.fill=function(){this.stroke(true);}
contextPrototype.closePath=function(){this.currentPath_.push({type:'close'});};contextPrototype.getCoords_=function(aX,aY){var m=this.m_;return{x:Z*(aX*m[0][0]+aY*m[1][0]+m[2][0])-Z2,y:Z*(aX*m[0][1]+aY*m[1][1]+m[2][1])-Z2}};contextPrototype.save=function(){var o={};copyState(this,o);this.aStack_.push(o);this.mStack_.push(this.m_);this.m_=matrixMultiply(createMatrixIdentity(),this.m_);};contextPrototype.restore=function(){copyState(this.aStack_.pop(),this);this.m_=this.mStack_.pop();};contextPrototype.translate=function(aX,aY){var m1=[[1,0,0],[0,1,0],[aX,aY,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.rotate=function(aRot){var c=mc(aRot);var s=ms(aRot);var m1=[[c,s,0],[-s,c,0],[0,0,1]];this.m_=matrixMultiply(m1,this.m_);};contextPrototype.scale=function(aX,aY){this.arcScaleX_*=aX;this.arcScaleY_*=aY;var m1=[[aX,0,0],[0,aY,0],[0,0,1]];var m=this.m_=matrixMultiply(m1,this.m_);var det=m[0][0]*m[1][1]-m[0][1]*m[1][0];this.lineScale_=sqrt(abs(det));};contextPrototype.clip=function(){};contextPrototype.arcTo=function(){};contextPrototype.createPattern=function(){return new CanvasPattern_;};function CanvasGradient_(aType){this.type_=aType;this.x0_=0;this.y0_=0;this.r0_=0;this.x1_=0;this.y1_=0;this.r1_=0;this.colors_=[];}
CanvasGradient_.prototype.addColorStop=function(aOffset,aColor){aColor=processStyle(aColor);this.colors_.push({offset:aOffset,color:aColor.color,alpha:aColor.alpha});};function CanvasPattern_(){}
G_vmlCanvasManager=G_vmlCanvasManager_;CanvasRenderingContext2D=CanvasRenderingContext2D_;CanvasGradient=CanvasGradient_;CanvasPattern=CanvasPattern_;})();}
dojo.provide("dj.module.marketdata.marketwatch");var BlueGrass={};if(typeof(MarketWatch)=="undefined")
var MarketWatch=new(function(){this.Sample={area:"sample"};this.Section={area:"section"};this.Investing={area:"investing"};this.Story={area:"story"};this.News={area:"news"};this.Community={area:"community"};this.Community.InstrumentPicker={area:"community"};this.Community.TopPickers={area:"community"};this.Community.PickerAccordian={area:"community"};this.Community.CommenterGrid={area:"community"};this.Community.FilteredCommentTabs={area:"community"};this.Search={area:"search"};this.MarketState={component:"marketstate"};this.Member={component:"member"};this.DockingBar={component:"dockingbar"};this.DockingBar.Community={component:"dockingbar"};this.DockingBar.Community.Groups={component:"dockingbar"};this.DockingBar.Portfolio={component:"dockingbar"};this.DayParting={component:"dayparting"};this.MarketsNews={component:"marketsnews"};this.Panels={component:"panels"};this.Kiosk={component:"kiosk"};this.BreakingNews={component:"breakingnews"};this.MultiQuote={component:"multiquote"};this.Investing.AdvancedCharts={area:"investing"};this.Investing.AdvancedCharts.Cookie={area:"investing"};this.UI={component:"ui"};this.FishHawk={component:"fishhawk"};this.Video={component:"video"};this.Investing.MutualFunds={area:"investing"};var _baseUrl="";this.setBaseUrl=function(url){_baseUrl=url;};this.getBaseUrl=function(){return _baseUrl;};})();if(typeof(string)=="undefined"){var string=(new function(){return{IsNullOrEmpty:function(theString){return(typeof(theString)=="undefined"||!theString||theString.length==0);}}}());}
else{string.IsNullOrEmpty=function(theString){return(typeof(theString)=="undefined"||!theString||theString.length==0);}}
String.prototype.IndexOf=function(val){return this.indexOf(val);}
String.prototype.Substring=function(start){return this.substring(start);}
var Html=new(function(){var thunk=this;var _headlineModelLink=function(text,object,options){var area=options.area||options.Area||"story";var controller=options.controller||options.Controller||"story";var action=null;var guid=object.DocGuid;var attr=null;var queryString="guid="+object.DocGuid.Value;text=object.HeadlineText;if(options&&typeof(options.MaxLength)=="number")
text=text.substring(0,options.MaxLength);if(typeof(object.ContentType)=="number")
object.ContentType=_getContentType(object.ContentType);if(object.ContentType=="headline"){if(typeof(options.LinkDocType90)=="undefined"||options.LinkDocType90==null||options.LinkDocType90==true){if(object.Instruments&&object.Instruments.length>0&&object.Instruments[0].Ticker){if(typeof(options.LinkTickerAsHeadline)!="undefined"&&options.LinkTickerAsHeadline){return _instrumentModelLink(text,object.Instruments[0],{});}
return"["+_instrumentModelLink(object.Instruments[0].Ticker,object.Instruments[0],{})+"] "+text;}}
return text;}
else if(object.ContentType=="nofollow"){attr='rel="nofollow"';}
if(object.SeoHeadlineFragment&&object.SeoHeadlineFragment.length>0){controller=null;action=object.SeoHeadlineFragment.substr(1);queryString=null;}
return thunk.ActionLink(text,area,controller,action,queryString,attr);};var _instrumentModelLink=function(text,object,options){var area=options.area||options.Area||"investing";var controller=options.controller||options.Controller||"stock";if(!object.Ticker)
return;if(object.Type)
controller=_getInstrumentType(object.Type);if(!text||text.length==0)
text=object.Ticker
var area="investing";var action=object.Ticker+"/overview";var queryString="";if(object.CountryCode&&object.CountryCode.toLowerCase()!="us")
queryString="countrycode="+object.CountryCode;return thunk.ActionLink(text,area,controller,action,queryString,null);};var _getContentType=function(type){switch(type){case 1:return"story";case 2:return"audio";case 3:return"video";case 4:return"nofollow";case 5:return"headline";}
return"story";};var _getInstrumentType=function(instrumentType){if(typeof(instrumentType)=="number"){switch(instrumentType){case 0:return"bond";case 2:return"currency";case 1:case 3:case 4:case 7:return"fund";case 5:return"future";case 6:return"index";case 8:case 9:case 10:return"option";}}
else if(instrumentType=="bond"||instrumentType=="currency"||instrumentType=="fund"||instrumentType=="future"||instrumentType=="index"||instrumentType=="option")
return instrumentType;return"stock";}
this.ModelLink=function(textOrObject,objectOrOptions,options){var text=textOrObject;var object=objectOrOptions;if(typeof(textOrObject)!="string"){text="";object=textOrObject;options=objectOrOptions;}
if(!options)options={};if(object.HeadlineText){return _headlineModelLink(text,object,options);}
else if(object.Ticker){return _instrumentModelLink(text,object,options);}};this.ActionLink=function(text,area,controller,action,queryString,attr){var link='<a '+(attr?attr:'')+' href="'+MarketWatch.getBaseUrl()+'/'+area+(controller?'/'+controller:'')+(action?'/'+action:'')+(queryString?'?'+queryString:'')+'">'+text+'</a>';return link;};this.GetShortDateStampMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var diff=now.getTime()-date.getTime();if(diff>86400000||now.getUTCDate()!=date.getUTCDate())
return"<span>"+date.dateFormat("m/d")+"</span>";var formatted=date.dateFormat("g:ia");return"<span>"+formatted.substring(0,formatted.length-1)+"</span>";}
return"<span>&nbsp;</span>";};this.GetTimeAgoMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var nowUtc=new Date().getTime();var easternNow=BlueGrass.Utility.convertToExchangeTime(nowUtc+"",offset);var diff=easternNow.getTime()-date.getTime();var formatted=date.dateFormat("g:ia Today");if(diff>86400000||now.getUTCDate()!=date.getUTCDate())
return"<span>"+date.dateFormat("g:ia n/d/y")+"</span>";else if(diff<=3600000){var ceiling=Math.ceil(diff/60000);if(ceiling==0)
formatted="< 1 min ago"
else
formatted=ceiling+" min ago";}
return"<span class='timeAgo'><span>"+formatted+"</span>"+"<span class='invisible'>"+date.dateFormat("g:ia n/d/y")+"</span></span>";}
return"<span>&nbsp;</span>";};this.GetShortTimeAgoMarkup=function(utcTimestamp,offset){if(typeof(BlueGrass)!="undefined"&&BlueGrass.Utility){var date=BlueGrass.Utility.convertToExchangeTime(utcTimestamp,offset);var now=new Date();var nowUtc=new Date().getTime();var easternNow=BlueGrass.Utility.convertToExchangeTime(nowUtc+"",offset);var diff=easternNow.getTime()-date.getTime();var formatted=date.dateFormat("g:ia");if(easternNow.getDay()!=date.getDay())
return"<span>"+date.dateFormat("n/d/y")+"</span>";else if(diff<=3600000){var ceiling=Math.ceil(diff/60000);if(ceiling==0)
formatted="< 1 min ago"
else
formatted=ceiling+" min ago";}
return"<span class='timeAgo short'><span>"+formatted+"</span>"+"<span class='invisible'>"+date.dateFormat("g:ia n/d/y")+"</span></span>";}
return"<span>&nbsp;</span>";};})();dojo.provide("dj.module.marketdata.thunderball");var Thunderball={ChartScalingV2:{CalculateDelta2:function(preferredDivisionCount,preferMoreDivisions,allowNoGap,dMin,dMax,dStart,dFinish){if(!dMin){dMin=0;}
if(!dMax){dMax=1;}
if(preferredDivisionCount<=1||preferredDivisionCount==null||preferredDivisionCount==undefined){dStart.value=dMin;dFinish.value=dMax;return dMax-dMin;}
if(dMax<dMin){var Tmp=dMin;dMin=dMax;dMax=Tmp;}
var dMax=Math.abs(dMax);if(dMax==0)dMax=1;var Tol=5.0e-6;if((dMax-dMin)/dMax<=Tol){if(dMax<0)
dMax=0;else if(dMax==0)
dMax=1;else
dMin=0;}
var dGears=[10,5,2.5,2,1];var dBestDifference=-1;var dBestLineCount=-1;var dBestMax=0;var dBestMin=0;var dBestDelta=0;var dRange=dMax-dMin;var dRangeDivision=dRange/preferredDivisionCount;Math.log10=function(n){return this.log(n)/this.log(10);}
var dDivisionMagnitude=Math.log10(dRangeDivision);var nDivisionMultiplier=parseInt(Math.floor(dDivisionMagnitude));for(var nMagAdditive=1;nMagAdditive>-2;nMagAdditive--){for(var i=0;i<dGears.length;i++){var dTmpDelta=dGears[i]*Math.pow(10,nDivisionMultiplier+nMagAdditive);var dTmpMax=Thunderball.ChartScalingV2.Math.RoundUpToMultiple(dMax,dTmpDelta,allowNoGap);var dTmpMin=Thunderball.ChartScalingV2.Math.RoundDownToMultiple(dMin,dTmpDelta,allowNoGap);var dLineCount=Math.round((dTmpMax-dTmpMin)/dTmpDelta)+1;var dDiff=Math.abs(preferredDivisionCount-dLineCount);if((dBestDifference==-1)||(dDiff<=dBestDifference)){if(preferMoreDivisions||(dLineCount<=preferredDivisionCount)){dBestDifference=dDiff;dBestLineCount=dLineCount;dBestMax=dTmpMax;dBestMin=dTmpMin;dBestDelta=dTmpDelta;}}}}
dFinish.value=dBestMax;dStart.value=dBestMin;return dBestDelta;},Math:{RoundUpToMultiple:function(val,multiple,inclusive){var dRemainder=Math.abs(val%multiple);if((dRemainder==0)&&inclusive)
return val;if(val>0)
return val+(multiple-dRemainder);else
return val+dRemainder;},RoundDownToMultiple:function(val,multiple,inclusive){var dRemainder=Math.abs(val%multiple);if((dRemainder==0)&&inclusive)
return val;if(val>0)
return val-dRemainder;else
return val-(multiple-dRemainder);}}},Utilities:{canvas_compatible:false,Requesters:[],check_canvas:function(){try{this.canvas_compatible=!!(document.createElement('canvas').getContext('2d'));}catch(e){this.canvas_compatible=!!(document.createElement('canvas').getContext);}
return this.canvas_compatible;},DataUpdater:function(data){for(var i=0;i<Thunderball.Utilities.Requesters.length;i++){if(Thunderball.Utilities.Requesters[i].requestId==data.requestId){Thunderball.Utilities.Requesters[i].data=data;Thunderball.Utilities.Requesters[i]._didLoad();Thunderball.Utilities.Requesters.splice(i,1);}}},GetData:function(chart){var requestObject=chart.buildRequest();$.ajax({type:"POST",url:chart.url,dataType:"json",data:requestObject,success:function(data){if(data!=null&&data.length>0){var chartdata=data[0].Value;chartdata.requestId=chart.requestId;Thunderball.Utilities.DataUpdater(chartdata);data=null;}}});requestObject=null;},FormatDate:function(dateString){if(typeof dateString=="string"){var converted=0;if(dateString.indexOf("-")>=0||dateString.indexOf("+")>=0){var _userOffset=new Date().getTimezoneOffset()/60;var temp=dateString.substring(dateString.length-7,dateString.length-2);var offset=parseInt(temp.substring(2))/100;if(temp.substring(0,1)=="-"){offset=-offset;}
converted=parseInt(dateString.substring(6,dateString.length-7))+((_userOffset+offset)*3600000);}
else{converted=parseInt(dateString.substring(6,dateString.length-2));}
var dateTime=new Date(converted);return dateTime;}
else{return dateString;}},drawXaxisLines:function(chart){if(chart.style.verticalGridLineStyle){var ctx=chart.drawingContext;chart._bump=true;ctx.beginPath();var ticks=chart._timeLines;for(var i=0;i<ticks.length;i++){var x=ticks[i];ctx.moveTo(x+0.5,chart.height);ctx.lineTo(x+0.5,0);}
ctx.strokeStyle=chart.style.verticalGridLineStyle;ctx.stroke();}
if(chart.style.verticalGridLineStyle_Opaque){var ctx=chart.drawingContext;chart._bump=true;ctx.beginPath();var ticks=chart._opaqueTimeLines;for(var i=0;i<ticks.length;i++){var x=ticks[i];ctx.moveTo(x+0.5,chart.height);ctx.lineTo(x+0.5,0);}
ctx.strokeStyle=chart.style.verticalGridLineStyle_Opaque;ctx.stroke();}
chart._timeLines=[];chart._opaqueTimeLines=[];},addXAxisLabels:function(chart){var labelsToCreate=chart._xAxisLabels;var self=chart;var target=self.targetSelector;var TotalHeight=self.height;var XAxisContent="";var elmWidth=30;var elmWidthCenter;if(!self.style.xAxisLabelPadding){self.style.xAxisLabelPadding=20;}
XAxisContent="<div style='position:relative width:"+self.width+"px;'>";for(var i=0;i<labelsToCreate.length;i++){elmWidthCenter=labelsToCreate[i].x-(elmWidth/2);XAxisContent=XAxisContent+"<div style='text-align:center; position: absolute; top:"+TotalHeight+"px;left:"+elmWidthCenter+"px;width:"+elmWidth+"px' class='xValueLbl'>"+labelsToCreate[i].element+"</div>";}
XAxisContent=XAxisContent+"</div>";_djl.place(XAxisContent,target);},addTick:function(Data,Symbol,Timestamp,Price,Offset){var Sessions=Thunderball.Utilities._getSessionByTicker(Data,Symbol);if(Sessions!=null){var timestamp=BlueGrass.Utility.convertToExchangeTime(Timestamp,Offset);var where=Thunderball.Utilities._findXSession(Sessions,timestamp,Data.BarFactor);if(where&&where.x){where.Session.Trades[where.x]=Price;if(where.Session.Trades.length-2==where.x){where.Session.Trades[where.x+1]=null;}
if(where.Session.Low&&where.Session.Low.Price>Price){where.Session.Low.Price=Price;where.Session.Low.Index=where.x;}
if(where.Session.High&&where.Session.High.Price<Price){where.Session.High.Price=Price;where.Session.High.Index=where.x;}
return where;}}
return where;},_findXSession:function(Sessions,Timestamp,BarFactor){Timestamp=new Date(Timestamp);for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];var ten_days=1000*60*60*24*10;if(Session.Stop.getTime()-Session.Start.getTime()<=ten_days){if(Session.Start<=Timestamp&&Timestamp<=Session.Stop){var x=(Timestamp.getTime()-Session.Start.getTime())/BarFactor;return{x:parseInt(x),Session:Session,Historical:false};}}
else{return{x:null,Session:null,Historical:true};}}
return{x:null,Session:null,Historical:false};},_getSessionByTicker:function(ChartData,Symbol){var s=Symbol.toUpperCase();for(var i=0;i<ChartData.Data.length;i++){if(ChartData.Data[i].Key==s){return ChartData.Data[i].Value.Sessions;}}
return null;}}};dojo.provide("dj.module.marketdata.chart");dojo.require("dj.module.marketdata.thunderball");dojo.require("dj.module.marketdata.marketwatch");var _PrevClose=0;var _isDEEdition=false;var WSJIndexChartStyle={background:"#ffffff",border:"#E6E2D7",closelineStyle:"#e36825",horizontalGridLineStyle:"#f4f3f1",highIndicatorStyle:"#093c71",highlowLineStyle:"#015190",lowIndicatorStyle:"#093c71",mainLineStyle:"#557BA0",mainPriceLineFill:"rgba(85,123,160,0.15)",mainPriceLineWidth:1,maxPriceLines:4,verticalGridLineStyle:"rgba(180,201,202,0.5)",verticalGridLineStyle_Opaque:"rgba(180,201,202,1.0)",vPadding:12,YAxisLabelStyle:1,YAxisLabelHeight:12,showDecimals:1,regionStyles:{0:'#cde2e0',1:'#cde2e0',2:'rgba(51,51,51,0.06)'},comparelineStyles:{0:'#cc3333',1:'#3b8dad',2:'#c9932e',3:'#b78383',4:'#8eb3bc',5:'#dbb782'}};function LegacyChart(container,legacyQueryString,width,height){var _chartBox=dojo.byId(container);var _legacyQueryString=legacyQueryString;var _width=width;var _height=height;var _currentsymbol=null;var start=legacyQueryString.indexOf("symb=")+5;var end=legacyQueryString.indexOf("&",start);if(end==-1){_currentsymbol=legacyQueryString.substr(start).toUpperCase();}else{_currentsymbol=legacyQueryString.substr(start,end-start).toUpperCase();}
var _showChart=function(){_chartBox.innerHTML="";_djl.place('<img src="//www.marketwatch.com/charts/big.chart'+_legacyQueryString+'" />',_chartBox);};return{ShowChart:function(symbol){if(symbol!=null&&symbol!=undefined&&_currentsymbol!=symbol.toUpperCase()){_currentsymbol=symbol.toUpperCase();_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=");if(_currentsymbol.indexOf("US:CRUDE OIL - ELECTRONIC")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=3343724");}else{_legacyQueryString=_legacyQueryString+"&sid=3343724";}}else if(_currentsymbol.indexOf("US:FUTURE-US-GOLD")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=1782661");}else{_legacyQueryString=_legacyQueryString+"&sid=1782661";}}else if(_currentsymbol.indexOf("DX:DAX")>-1){_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb=");if(_legacyQueryString.indexOf("sid=")>-1){_legacyQueryString=_legacyQueryString.replace(/sid=[^&^\n]*/i,"sid=125284");}else{_legacyQueryString=_legacyQueryString+"&sid=125284";}}else{_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb="+_currentsymbol);}}
_showChart();},TickSubscribe:function(){},UpdateAllCharts:function(time,freq,startdate,enddate){this.UpdateChart(time,freq,startdate,enddate);},UpdateChart:function(time,freq,startdate,enddate){_legacyQueryString=_legacyQueryString.replace(/freq=[^&^\n]*/i,"freq="+freq);if(time==null||time==undefined){_legacyQueryString=_legacyQueryString.replace(/time=[^&^\n]*/i,"time=");}else{_legacyQueryString=_legacyQueryString.replace(/time=[^&^\n]*/i,"time="+time);}
if(startdate==null||startdate==undefined){_legacyQueryString=_legacyQueryString.replace(/startdate=[^&^\n]*/i,"startdate=");}else{if(_legacyQueryString.indexOf("startdate=")>-1){_legacyQueryString=_legacyQueryString.replace(/startdate=[^&^\n]*/i,"startdate="+startdate);}else{_legacyQueryString=_legacyQueryString+"&startdate="+startdate;}}
if(enddate==null||enddate!=undefined){_legacyQueryString=_legacyQueryString.replace(/enddate=[^&^\n]*/i,"enddate=");}else{if(_legacyQueryString.indexOf("enddate=")>-1){_legacyQueryString=_legacyQueryString.replace(/enddate=[^&^\n]*/i,"enddate="+enddate);}else{_legacyQueryString=_legacyQueryString+"&enddate="+enddate;}}
_showChart();},ChangeSymbol:function(symbol){var symbols=symbol.toUpperCase().split('|');_currentsymbol=symbols[0];_legacyQueryString=_legacyQueryString.replace(/symb=[^&^\n]*/i,"symb="+_currentsymbol);if(symbols.length>1){if(_legacyQueryString.indexOf("compidx=")>-1){_legacyQueryString=_legacyQueryString.replace(/compidx=[^&^\n]*/i,"compidx="+symbols[1]);}else{_legacyQueryString=_legacyQueryString+"&compidx="+symbols[1];}}else{_legacyQueryString=_legacyQueryString.replace(/compidx=[^&^\n]*/i,"compidx=");}
if(symbols.length>2){var comp="";for(var i=2;i<symbols.length;i++){if(comp.length>0){comp=comp+",";}
comp=comp+symbols[i];}
if(_legacyQueryString.indexOf("comp=")>-1){_legacyQueryString=_legacyQueryString.replace(/comp=[^&^\n]*/i,"comp="+comp);}else{_legacyQueryString=_legacyQueryString+"&comp="+comp;}}else{_legacyQueryString=_legacyQueryString.replace(/comp=[^&^\n]*/i,"comp=");}
_showChart();},SetChartRefresh:function(rate){setInterval(_showChart,rate);}}}
function EmbeddedChartMDM(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol,prevClose,isDEEdition){_PrevClose=0;_PrevClose=prevClose;_isDEEdition=false;_isDEEdition=isDEEdition;return new EmbeddedChart(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol);}
function EmbeddedChart(container,style,width,height,time,freq,startdate,enddate,chartdata,symbol){var _chartBox=document.getElementById(container);var _style=style;var _width=width;var _height=height;var _time=time;var _freq=freq;var _startdate=startdate;var _enddate=enddate;var _pagedata=null;var _currentsymbol=null;var _firstsymbol=symbol;var _symbolCount=0;var _chart=null;var _tick=false;var _ticktimeout=null;var _currentchannel=null;var _connection=null;var _url="/Market/ECProxy/ChartData";var _setPageData=function(data){if(data!=null&&data!=undefined&&data.length>0){if(_pagedata==null){_pagedata=[];}
for(var i=0;i<data.length;i++){if(data[i].Value!=null&&data[i].Value!=undefined&&data[i].Key!=''){_pagedata[data[i].Key]=data[i].Value;if(_pagedata[data[i].Key].Data!=null){for(var j=0;j<_pagedata[data[i].Key].Data.length;j++){for(var k=0;k<_pagedata[data[i].Key].Data[j].Value.Sessions.length;k++){var session=_pagedata[data[i].Key].Data[j].Value.Sessions[k];session.Start=new Date(Thunderball.Utilities.FormatDate(session.Start));session.Stop=new Date(Thunderball.Utilities.FormatDate(session.Stop));}}}}}}}
var _showChart=function(symbol){if(_pagedata==null){_chart=new JSChart(_chartBox,symbol.split('|'),_width,_height,_style,_freq,_time,_startdate,_enddate,undefined,MarketWatch.getBaseUrl()+_url);_currentsymbol=symbol;}else{if(symbol!=_currentsymbol){if(_chart!=null){_pagedata[_currentsymbol]=_chart.data;_chart.data=null;_chart=null;}
var symbols=symbol.split('|');_chart=new JSChart(_chartBox,symbols,_width,_height,_style,_freq,_time,_startdate,_enddate,_pagedata[symbol],MarketWatch.getBaseUrl()+_url);_currentsymbol=symbol;_symbolCount=symbols.length;}}}
_setPageData(chartdata);var _refreshPageData=function(){var symbols=[]
for(var symbol in _pagedata){symbols.push(symbol);}
_refreshData(symbols,"mo");}
var _refreshData=function(symbols,cachekey){requestObject={freq:_freq,time:_time,Symbol:symbols,StartDate:_startdate,EndDate:_enddate,Width:_width,Height:_height,CacheKey:cachekey};_djl.rawXhrPost({url:MarketWatch.getBaseUrl()+_url,postData:requestObject,handleAs:"json",load:function(response,ioArgs){if(response!=null){_setPageData(response);response=null;if(_chart!=null){_chart.data=_pagedata[_currentsymbol];_chart._didLoad();}}
return response;}});requestObject=null;}
var _reloadChart=function(){if(_chart!=null){_chart.time=_time;_chart.freq=_freq;_chart.startDate=_startdate;_chart.endDate=_enddate;_chart.reload();}}
return{ShowChart:function(symbol){if(symbol===undefined){symbol=_firstsymbol;}
symbol=symbol.toUpperCase();if(symbol!=_currentsymbol){if(_pagedata[symbol]!==null&&_pagedata[symbol]!==undefined){_showChart(symbol);return true;}else{return false;}}},TickSubscribe:function(){if(_chart!=null){_tick=true;var chartSubscribeCallback=function(message){if(_chart!=null&&_chart.data!=null&&_symbolCount==1){for(var symbol in _pagedata){for(var i=0;i<_pagedata[symbol].Data.length;i++){if(_pagedata[symbol].Data[i].Value.BlueGrassChannel!=null&&_pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase()==message.h.t){if(symbol.toUpperCase()===_currentsymbol.toUpperCase()){_chart.addTick(symbol,message.b.z,message.b.l,message.b.e);}
break;}}}}};var chartConnectionCallback=function(connection,type){if(type=="connect"){_connection=connection;if(_pagedata[_currentsymbol]!=null){_currentchannel=_connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,chartSubscribeCallback);}}};if(_currentchannel!=null){_currentchannel.removeCallback(chartSubscribeCallback);}
if(_connection!=null){if(_pagedata[_currentsymbol]!=null){_currentchannel=_connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,chartSubscribeCallback);}}else{if(BlueGrass!==null&&BlueGrass.Runtime!==null){BlueGrass.Runtime.openConnection({},chartConnectionCallback);}}}},UpdateAllCharts:function(time,freq,startdate,enddate){if(_chart!=null){this.UpdateChart(time,freq,startdate,enddate);setTimeout(_refreshPageData,5);}},UpdateChart:function(time,freq,startdate,enddate){if(_chart!=null){_time=time;_freq=freq;_startdate=startdate;_enddate=enddate;_reloadChart();}},ChangeSymbol:function(symbol){if(_chart!=null){_currentsymbol=symbol;_chart.setSymbols(symbol.split('|'));_symbolCount=_chart.symbols.length;_reloadChart();}},SetChartRefresh:function(rate){setInterval(_refreshPageData,rate);}}}
var JSChart=function(targetSelector,symbols,width,height,style,freq,time,startDate,endDate,data,url){this.targetSelector=targetSelector;if(style===undefined){this.style=LargeChartStyle;}else{this.style=style;}
if(url!==undefined){this.url=url;}
this.width=width;this.height=height;this.symbols=symbols;this.selectedSymbol=symbols[0];if(freq===undefined){this.freq="1mi";}else{this.freq=freq;}
if(time===undefined){this.time="1dy";}else{this.time=time;}
if(startDate!==undefined){this.startDate=startDate;}
if(endDate!==undefined){this.endDate=endDate;}
var self=this;if(data===undefined){$(function(){self.reload();});}else{self.preload(data);}};JSChart.prototype={freq:"1mi",time:"1dy",unit:"Minute",url:"./HistoricChartData.aspx",span:1,step:1,startDate:'',endDate:'',data:null,selectedSymbol:null,width:0,height:0,drawingContext:null,style:null,highPrice:null,highPoint:{"x":null,"y":null},lowPoint:{"x":null,"y":null},lowPrice:null,lastPoint:{"x":null,"y":null},lastPrice:null,closePrice:null,buildRequest:function(){var requestObject;var symbol="";for(var i=0;i<this.symbols.length;i++){if(i>0){symbol+="|";}
symbol+=this.symbols[i];}
requestObject={freq:this.freq,time:this.time,Symbol:symbol,StartDate:this.startDate,EndDate:this.endDate,Width:this.width};return requestObject;},lastTickPrice:0,lastTickChange:0,lastTickX:0,addTick:function(tickSymbol,Timestamp,Price,offSet){var where=Thunderball.Utilities.addTick(this.data,tickSymbol,Timestamp,Price,offSet);if(where.Historical==false){if(where.x==null){return;}else{if(Price!=this.lastTickPrice){this.lastTickChange=Price-this.lastTickPrice;this.lastTickPrice=Price;}else if(where.x==this.lastTickX){return;}
this.lastTickX=where.x;this._didLoad();}}},setSymbols:function(symbols){this.symbols=symbols;this.selectedSymbol=symbols[0];},reload:function(){this._resetState();var d=new Date();var requestId=this.symbols[0]+d.getTime();this.requestId=requestId;Thunderball.Utilities.Requesters.push(this);Thunderball.Utilities.GetData(this);},preload:function(data){this._resetState();this.data=data;this._didLoad();},_resetState:function(){this.lastTickPrice=this.lastTickChange=this.lastTickX=0;},redraw:function(){this._prepareCanvas();this._clearLabels();var ctx=this.drawingContext;ctx.clearRect(0,0,this.width,this.height);ctx.save();this._drawChartBackground();var Data=Thunderball.Utilities._getSessionByTicker(this.data,this.selectedSymbol);if(Data!=null){for(var i=0;i<Data.length;i++){this._drawRegions(Data[i]);}
if(this.style.type=='Spark'){this._drawSpark(Data[Data.length-1]);}else{this._determineTypeOfChart(Data);this._setHLC(Data);this._fillTrades(Data);this._drawPriceLines();this._createYAxisLabels(this.symbols.length);Thunderball.Utilities.addXAxisLabels(this);Thunderball.Utilities.drawXaxisLines(this);this._drawCloseLines(Data);var st=this.style;if(this.highPoint.y!=this.lowPoint.y){this._priceIndicator(this.highPoint,"",st.highIndicatorStyle,"chartPointer chartPoint-high",false);this._priceIndicator(this.lowPoint,"",st.lowIndicatorStyle,"chartPointer chartPoint-low",false);}
this._priceIndicator(this.lastPoint,"","","lastLbl",true);if(this.symbols.length>1){for(var j=1;j<this.symbols.length;j++){var Session=Thunderball.Utilities._getSessionByTicker(this.data,this.symbols[j]);if(Session!=null){var compareColor='black';if(j<=6){compareColor=this.style.comparelineStyles[j-1];}
this._strokeTrades(Session,compareColor);}}}
this._strokeTrades(Data,this.style.mainLineStyle);this._drawChartBorder();if(this.highPoint.y!=this.lowPoint.y){this._drawHorizontalLine(this.highPoint.y);this._drawHorizontalLine(this.lowPoint.y);}
this.startTime=this.overallStartTime;}}
ctx.restore();},_x:0,_xscale:0,_y:0,_yscale:0,_bump:false,_fillStyle:'black',_padding:0,_events:[],_barFactor:0,_barSize:1,_priceLines:[],_timeLines:[],_opaqueTimeLines:[],_historical:false,_customDateRange:false,_chartUnit:1,_displayUnit:1,_xAxisLabels:[],_findOpaqueGridLines:function(time){var xAxisInfo=this._xAxisLabels;var timeLines=this._timeLines;var data=this.data;var opaqueTimeLines=[];this._opaqueTimeLines=[];if(this._displayUnit===1||this._displayUnit===2){if(_isDEEdition){this._convertGridLinesForGermany(xAxisInfo,time,opaqueTimeLines);}else{for(var i=0;i<xAxisInfo.length;i++){var patt=/^M$|^T$|^W$|^F$|^S$/;if(xAxisInfo[i].element.match(patt)){opaqueTimeLines.push(xAxisInfo[i].x);}}}}else{for(var i=0;i<xAxisInfo.length;i++){var patt=/^\d{2}$/;if(xAxisInfo[i].element.match(patt)&&xAxisInfo[i].x!==(.5*timeLines[0])){opaqueTimeLines.push(xAxisInfo[i].x);}}}
if(opaqueTimeLines.length>0){for(var i=0;i<opaqueTimeLines.length;i++){this._opaqueTimeLines.push(opaqueTimeLines[i]);}}},_convertGridLinesForGermany:function(xAxisInfo,time,opaqueTimeLines){var patt=/^M$|^T$|^W$|^F$|^S$/;var pattDE=/^M$|^D$|^F$|^S$/;if(time.toString()=="1dy"){var xElement="";var length=xAxisInfo.length;for(var i=0;i<length;i++){xElement=xAxisInfo[i];if(xElement!=undefined){if(length==1&&(xElement.element.match(patt)||xElement.element.match(pattDE))){this._convertGridLinesForGermany5dy(xAxisInfo,time,opaqueTimeLines);return;}
var len=xElement.element.length;var hour=xElement.element;var ap=xElement.element.substring(len-1);if((len==2||len==3)&&(ap=="a"||ap==="p")){hour=xElement.element.substring(0,len-1);}
if(ap=="p"&&hour!="12"){hour=parseFloat(hour)+parseFloat(12);}else if(hour.length==1){hour="0"+hour;}
xElement.element=hour.toString();}}}else if(time.toString()=="5dy"){this._convertGridLinesForGermany5dy(xAxisInfo,time,opaqueTimeLines);return;}},_convertGridLinesForGermany5dy:function(xAxisInfo,time,opaqueTimeLines){var pattDE=/^M$|^D$|^F$|^S$/;var xElement="";var length=xAxisInfo.length;for(var i=0;i<length;i++){xElement=xAxisInfo[i];if(xElement!=undefined){if(xElement.element=="M"){xElement.element="M";}else if(xElement.element=="W"){xElement.element="M";}else if(xElement.element=="F"){xElement.element="F";}else if(xElement.element=="S"){xElement.element="S";}else if(xElement.element=="T"){xElement.element="D";}
if(xElement.element.match(pattDE)){opaqueTimeLines.push(xElement.x);}}}},_didLoad:function(){if(!this.data)
return;if(this.data.Error){var target=this.targetSelector;var errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>Error, the chart cannot be displayed.</div>";if(this.data.Error=="Error: Time"){errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";}
var ctx=this.drawingContext;if(ctx!=null){ctx.clearRect(0,0,this.width,this.height);this._clearLabels();_djl.place(errorMessage,target);}
return;}
var data=this.data.Data;if(data.length>1){var tradesExist=false;for(var i=0;i<data.length;i++){var value=data[i].Value;var sessions=value.Sessions;for(var j=0;j<sessions.length;j++){if(sessions[j].Trades.length>0){tradesExist=true;continue;}}}
if(!tradesExist){var target=this.targetSelector;var errorMessage="<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";var ctx=this.drawingContext;if(ctx!=null){ctx.clearRect(0,0,this.width,this.height);this._clearLabels();_djl.place(errorMessage,target);}
return;}}
this._barFactor=this.data.BarFactor;this._barSize=this.data.BarSize;this._chartUnit=this.data.xAxisLabelInfo.chartUnit;this._displayUnit=this.data.xAxisLabelInfo.displayUnit;this._timeLines=this.data.xAxisLabelsObj.timeLines;this._xAxisLabels=this.data.xAxisLabelsObj.ElementList;if(this._displayUnit===1||this._displayUnit===2||this._displayUnit===3){this._findOpaqueGridLines(this.time);}
this._customDateRange=this.data.CustomDateRange;try{for(var j=0;j<this.symbols.length;j++){var Sessions=Thunderball.Utilities._getSessionByTicker(this.data,this.symbols[j]);if(Sessions!=null){if(this.symbols.length>1){this._changeDataToPercentage(Sessions);}
_djl.forEach(Sessions,function(Session,i){if(Session.Trades===undefined){Session.Trades=[];}
if(Session.Events===undefined){Session.Events=[];}
if(Session.News===undefined){Session.News=[];}
if(Session.Weight===undefined){}
if(Session.Start===undefined){}
if(Session.Stop===undefined){}
var sessionStartFormat=Thunderball.Utilities.FormatDate(Session.Start);var sessionStopFormat=Thunderball.Utilities.FormatDate(Session.Stop);Session.Start=new Date(sessionStartFormat);Session.Stop=new Date(sessionStopFormat);});this._layoutSessions(Sessions);}}}catch(e){}
this._autoScale(this.data.Data,this.time);this.redraw();},_changeDataToPercentage:function(Sessions){var basePrice=null;for(var k=0;k<Sessions.length;k++){var trades=Sessions[k].Trades;for(var l=0;l<trades.length;l++){if(trades[l]!==null&&basePrice===null){basePrice=trades[l];break;}}
if(basePrice!==null){break;}}
if(basePrice!==null&&basePrice>0){for(var k=0;k<Sessions.length;k++){var trades=Sessions[k].Trades;for(var l=0;l<trades.length;l++){if(trades[l]!==null){trades[l]=100*((trades[l]-basePrice)/basePrice);}}
if(Sessions[k].Low!==null){Sessions[k].Low.Price=100*((Sessions[k].Low.Price-basePrice)/basePrice);}
if(Sessions[k].High!==null){Sessions[k].High.Price=100*((Sessions[k].High.Price-basePrice)/basePrice);}}}},_drawHorizontalLine:function(y){if(this.style.highlowLineStyle){var ctx=this.drawingContext;this._bump=true;ctx.beginPath();ctx.lineWidth=1;ctx.moveTo(0,y+0.5);ctx.lineTo(this.width,y+0.5);ctx.strokeStyle=this.style.highlowLineStyle;ctx.stroke();}},_priceIndicator:function(point,string,style,cssClass,lastPoint){if(point.x===null||point.y===null){return;}
if(lastPoint){if(point.x>this.width-3){point.x=this.width-3;}
var y=point.y-10;var x=point.x-2;if(this.lastTickChange<0){lastPointIcon="<div class='chartDownIndicator'></div>";}else if(this.lastTickChange>0){lastPointIcon="<div class='chartUpIndicator'></div>";}else{lastPointIcon="<div class='chartIndicator'></div>";y=point.y-3;}
return;}else{}},_createYAxisLabels:function(type){if(!this.style.maxPriceLines)
return;var decimalsToShow=2;var YAxisContent="";var displayValue="";var x,y,p;var elmHeight=this.style.YAxisLabelHeight;var excludeLabel=[];if(!this.style.yAxisLabelPadding){this.style.yAxisLabelPadding=2;}
function addCommas(nStr){nStr+='';x=nStr.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
function decimalsNeeded(lineNum,range){var Tol=5.0e-6;if(range===0||lineNum===0)
return 0;var maxDecimals=6;var division=range/lineNum;var decimals=0;while(decimals<=maxDecimals){var divtest=division*Math.pow(10,decimals);if(Math.abs(divtest-Math.round(divtest))<Tol)
break;decimals+=(decimals==0)?2:1;}
return decimals;}
if(this._priceLines.length>1){this._priceLines.sort(function(a,b){return a-b});var firstValue=this._priceLines[0];var lastValue=this._priceLines[this._priceLines.length-1];var diffValue=lastValue-firstValue;var totalNumber=this._priceLines.length-1;if(this.style.showDecimals===0){decimalsToShow=0;}else if(this.style.YAxisLabelStyle===1){if(lastValue<10)
decimalsToShow=3;else if(lastValue<100)
decimalsToShow=2;else
decimalsToShow=0;}else{decimalsToShow=decimalsNeeded(totalNumber,diffValue);}}
try{var current=false;for(var i=this._priceLines.length-1;i>=0;i--){var drawLabel=true;p=this._priceLines[i];if(this._priceLines[i]===this.lastPrice){y=(this.ty(p)-(elmHeight/2)-1);}else if(this._priceLines[i]===this.highPrice){y=(this.ty(p)-elmHeight);}else if(this._priceLines[i]===this.lowPrice){y=this.ty(p)-1;}else if(this._priceLines[i]===this.closePrice){y=(this.ty(p)-(elmHeight/2)-1);}else{y=this.ty(p)-(elmHeight/2);}
x=this.style.yAxisLabelPadding+this.width;if(this.style.YAxisLabelStyle===1){for(var j=0;j<this._priceLines.length;j++){if(this._priceLines[i]!=this.lastPrice&&j!=i&&excludeLabel[j]!=1){var cp=this._priceLines[j];if(this._priceLines[j]===this.lastPrice){cy=(this.ty(cp)-(elmHeight/2))-1;}else if(this._priceLines[j]===this.closePrice){cy=(this.ty(cp)-(elmHeight/2))-1;}else if(this._priceLines[j]===this.highPrice){cy=(this.ty(cp)-elmHeight)-1;}else if(this._priceLines[j]===this.lowPrice){cy=this.ty(cp)-1;}else{drawLabel=false;}
if(Math.abs(Math.abs(cy)-Math.abs(y))<elmHeight+1){if(this._priceLines[j]!=this.closePrice){drawLabel=false;excludeLabel[i]=1;}}}}}
if(type>1){displayValue=p.toFixed(decimalsToShow)+"%";}else{displayValue=p.toFixed(decimalsToShow);}
var labelClass="priceLbl";if(this.style.YAxisLabelStyle===1){var width=5;if(this._priceLines[i]===this.lastPrice&&(this._priceLines[i]>=this.closePrice||this.closePrice===null)&&!current){labelClass="chartPointer chartLastPoint chartPoint-pos";current=true;}else if(this._priceLines[i]===this.lastPrice&&this._priceLines[i]<this.closePrice&&!current){labelClass="chartPointer chartLastPoint chartPoint-neg";current=true;}else if(this._priceLines[i]===this.lowPrice){if(this.lowPrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-low";}else if(this._priceLines[i]===this.highPrice){if(this.highPrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-high";}else if(this.closePrice&&this._priceLines[i]===this.closePrice){if(this.closePrice===this.lastPrice&&current){drawLabel=false;}
labelClass="chartPointer chartPoint-close";}}
if(drawLabel===true&&this.style.YAxisLabelStyle===1){YAxisContent=YAxisContent+"<div style='position: absolute; top:"+y+"px;left:"+x+"px; ' class='"
+labelClass+"'>"+displayValue+"</div>";}else if(drawLabel===true){YAxisContent=YAxisContent+"<div style='position: absolute; top:"+y+"px;left:"+x+"px; ' class='"
+labelClass+"'>"+displayValue+"</div>"}}}catch(e){}
_djl.place(YAxisContent,this.targetSelector);},_determineTypeOfChart:function(Sessions){if(Sessions.length>=1&&Sessions[0].Regions.length>=1){var numberOfRegions=Sessions[0].Regions.length;if(numberOfRegions==1&&Sessions[0].Regions[0].Type!=4){this._historical=true;}else{this._historical=false;}}},_setHLC:function(Sessions){this.lastPoint.x=null;this.lastPoint.y=null;this.lowPoint.x=null;this.lowPoint.y=null;this.highPoint.x=null;this.highPoint.y=null;var MinMax=this._getMinMax(Sessions,false);var needsBump=false;if(this.data.Data[0].Value.IsIndex===1&&this._barSize===60){needsBump=true;}
if(MinMax.MinPoint!=null||MinMax.Min!=null){this.lowPoint=MinMax.MinPoint;}
if(MinMax.MaxPoint!=null||MinMax.Max!=null){this.highPoint=MinMax.MaxPoint;}
for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(Session.Trades&&Session.Trades.length!==0){var lastIndex=Session.Trades.length-1;var price=Session.Trades[lastIndex];if(price){this.lastPoint.y=this.ty(price);if(this._historical){this.lastPoint.x=this.tx(lastIndex/this._barSize);}else{if(needsBump){this.lastPoint.x=this.tx(lastIndex+0.5);}else{this.lastPoint.x=this.tx(lastIndex);}}}else{for(var j=lastIndex;j>=0;j--){price=Session.Trades[j];if(price){this.lastPoint.y=this.ty(price);if(this._historical){this.lastPoint.x=this.tx(j/this._barSize);}else{if(needsBump){this.lastPoint.x=this.tx(j+0.5);}else{this.lastPoint.x=this.tx(lastIndex);}}
break;}}}}}},_drawRoundIndicator:function(color,x,y,circleSize){if(x!==null&&y!==null){var ctx=this.drawingContext;ctx.fillStyle=color;ctx.beginPath();ctx.arc(x,y,3,0,Math.PI*2,true);ctx.fill();ctx.strokeStyle=color;ctx.beginPath();ctx.save();ctx.lineWidth=1.5;ctx.arc(x,y,circleSize,0,Math.PI*2,true);ctx.stroke();ctx.restore();}},_drawRoundDot:function(color,x,y,size){if(x!==null&&y!==null){var ctx=this.drawingContext;ctx.fillStyle=color;ctx.beginPath();ctx.arc(x,y,size,0,Math.PI*2,true);ctx.fill();}},_drawNewsOverlay:function(Sessions){this._bump=false;for(var i=0;i<Sessions.length;i++){this._setSession(Sessions[i]);var news=Sessions[i].News;for(var j=0;j<news.length;j++){var story=news[j];var x=this.tx(story.At);var p;var Trades=Sessions[i].Trades;for(var k=0;k<Trades.length&&k<story.At;k++){if(Trades[k]){p=Trades[k];}}
if(p){var newsLink=$('<a></a>').attr('href',story.Url);var icon=$('<img />').attr('border',0).attr('src',this.style.newsBackground).attr('title',story.Text).appendTo(newsLink);}}}},_drawPriceLines:function(){if(this.style.horizontalGridLineStyle){var ctx=this.drawingContext;this._bump=true;ctx.beginPath();var ticks=this._priceLines;for(var i=0;i<ticks.length;i++){var y=this.ty(ticks[i]);ctx.moveTo(0,y);ctx.lineTo(this.width,y);}
ctx.strokeStyle=this.style.horizontalGridLineStyle;ctx.stroke();}},_drawChartBorder:function(){if(this.style.border){var ctx=this.drawingContext;ctx.beginPath();ctx.strokeStyle=this.style.border;ctx.strokeRect(0,0,this.width,this.height);}},_drawChartBackground:function(){if(this.style.background){var ctx=this.drawingContext;ctx.beginPath();ctx.fillStyle=this.style.background;ctx.fillRect(0,0,this.width,this.height);}},_drawCloseLines:function(Sessions){var ctx=this.drawingContext;this._bump=true;var x=0;ctx.beginPath();for(var i=0;i<Sessions.length;i++){var session=Sessions[i];this._setSession(session);var w=session.SessionWidth;var x2=x+w;if(session.PreviousClose!==undefined&&session.PreviousClose!==null&&(this.symbols.length==1)){var y=this.ty(session.PreviousClose);ctx.moveTo(x,y);ctx.lineTo(x2,y);}
x=x2;}
ctx.strokeStyle=this.style.closelineStyle;ctx.stroke();},_drawRegions:function(session){var ctx=this.drawingContext;this._setSession(session);this._bump=false;for(var i=0;i<session.Regions.length;i++){var Region=session.Regions[i];var Color=this._regionStyles[Region.Type];if(!Color||Color==this.style.background){continue;}
var x1=this.tx(Region.Start);var x2;if(i===0&&this._barSize===60&&(Region.Stop+Region.Start>0)){x2=this.tx(Region.Stop+0.5);}else{x2=this.tx(Region.Stop);}
ctx.fillStyle=Color;ctx.fillRect(x1,0,x2-x1,this.height);}},_buildTradePath:function(Sessions){var ctx=this.drawingContext;var data=this.data;var isIndex=data.Data[0].Value.IsIndex;var first=true;var x=0;var firstx;var prev=null;var last;for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(Session.Trades){for(var j=0;j<Session.Trades.length;j++){var price=Session.Trades[j];if(price==null){if(prev==null)
continue;price=prev;}
prev=price;var y=this.ty(price);if(this._historical){x=this.tx(j/this._barSize);}else{if(isIndex===1&&this._barSize===60){x=this.tx(j+0.5);}else{x=this.tx(j);}}
if(first){firstx=x;ctx.moveTo(0,y);ctx.lineTo(firstx,y);first=false;}else{ctx.lineTo(x,y);}}}}
return{firstx:firstx,lastx:x};},_strokeFillTrades:function(Sessions,strokeStyle){var ctx=this.drawingContext;ctx.save();ctx.lineWidth=this.style.mainPriceLineWidth;ctx.strokeStyle=strokeStyle;ctx.beginPath();this._bump=true;var x=this._buildTradePath(Sessions);if(x.lastx!=undefined&&x.firstx!=undefined){ctx.stroke();ctx.lineTo(x.lastx,this.height);ctx.lineTo(0,this.height);ctx.fillStyle=this.style.mainPriceLineFill;ctx.fill();}
ctx.restore();},_strokeTrades:function(Sessions,strokeStyle){var ctx=this.drawingContext;ctx.save();ctx.miterLimit=0;ctx.lineJoin="round";ctx.lineWidth=this.style.mainPriceLineWidth;ctx.strokeStyle=strokeStyle;ctx.beginPath();this._bump=true;var x=this._buildTradePath(Sessions);ctx.stroke();ctx.restore();},_fillTrades:function(Sessions){var ctx=this.drawingContext;ctx.fillStyle=this._fillStyle;ctx.beginPath();this._bump=false;var points=this._buildTradePath(Sessions);if(points.lastx!=undefined&&points.firstx!=undefined){ctx.lineTo(points.lastx,this.height);ctx.lineTo(0,this.height);}
ctx.fill();},_precomputeStyles:function(){if(this.style.gradientFillStyle){this._fillStyle=this._makeStyle(this.style.gradientFillStyle);}
if(this.style.mainPriceLineFill){this._fillStyle=this.style.mainPriceLineFill;}
this._regionStyles={};var styles=this.style.regionStyles;for(var style in styles){this._regionStyles[style]=this._makeStyle(styles[style]);}},_prepareCanvas:function(){if(!this.drawingContext||this.drawingContext===null){var canvasWidth=this.width;var canvasHeight=this.height;this.targetSelector.innerHTML="";if(canvasWidth<=0||canvasHeight<=0){throw"Invalid dimensions - width = "+canvasWidth+", height = "+canvasHeight;}
var canvas=document.createElement('canvas');canvas.setAttribute('width',canvasWidth);canvas.setAttribute('height',canvasHeight);_djl.place(canvas,this.targetSelector);if(!Thunderball.Utilities.check_canvas()){canvas=window.G_vmlCanvasManager.initElement(canvas,canvasWidth,canvasHeight);}
this.drawingContext=canvas.getContext("2d");}
this._precomputeStyles();},orphan:function(node){node.parentNode.removeChild(node);},_clearLabels:function(){var label=dojo.query("#"+this.targetSelector.id+" > div");},_layoutSessions:function(Sessions){var TotalSessionWeight=0;_djl.forEach(Sessions,function(value,index){TotalSessionWeight+=value.Weight;});var x=0;for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];var SessionWidth;SessionWidth=Math.floor(this.width*Session.Weight/TotalSessionWeight);Session.SessionWidth=SessionWidth;Session._x=x;x+=SessionWidth;var SessionStart=Session.Start.getTime();var SessionStop=Session.Stop.getTime();var SessionTime=SessionStop-SessionStart;Session._xscale=SessionWidth*this._barFactor/(SessionTime);}},_autoScale:function(Data,time){var Min=null;var Max=null;var High=null;var Low=null;var Close=null;var self=this;var chartValueIndicators=this.style.YAxisLabelStyle;_djl.forEach(Data,function(Sessions,i){var includePreviousClose=true;if(self.symbols.length>1||Sessions.Value===undefined||Sessions.Value.Sessions===undefined||Sessions.Value.Sessions.length<1||Sessions.Value.Sessions[0].PreviousClose===undefined||Sessions.Value.Sessions[0].PreviousClose===null){includePreviousClose=false;}
var MinMax=self._getMinMax(Sessions.Value.Sessions,includePreviousClose);if(chartValueIndicators===1){self._determineLastTrade(Sessions.Value.Sessions[Sessions.Value.Sessions.length-1].Trades);Low=MinMax.Low;High=MinMax.High;if(includePreviousClose&&time=="1dy"){Close=Sessions.Value.Sessions[0].PreviousClose;self.closePrice=Close;}
else if(!includePreviousClose&&time!="1dy"){if(_PrevClose!=null&&_PrevClose>=0){Close=_PrevClose;self.closePrice=Close;}}}
if(!Min||MinMax.Min<Min){Min=MinMax.Min;}
if(!Max||MinMax.Max>Max){Max=MinMax.Max;}});function dStart(){this.value=0;}
function dFinish(){this.value=0;}
if(this.style.maxPriceLines>=1){var dFinishObj=new dFinish();var dStartObj=new dStart();var scale=Thunderball.ChartScalingV2.CalculateDelta2(this.style.maxPriceLines,false,true,Min,Max,dStartObj,dFinishObj);if(dStartObj.value<0&&self.symbols.length===1){scale=Thunderball.ChartScalingV2.CalculateDelta2(Math.round(this.style.maxPriceLines/2),false,true,Min,Max,dStartObj,dFinishObj);}
if(chartValueIndicators===1){if(High===null&&Low===null){if(close!=null){Max=Close+(Close*.01);Min=Close-(Close*.01);}else{Max=1;Min=0;}}
this._priceLines=[];var ticks=this._priceLines;if(Low!=null){ticks.push(Low);this.lowPrice=Low;}
if(this.lastPrice!=null){ticks.push(this.lastPrice);}
if((!(Close===undefined||Close===null))){ticks.push(Close);if(High!=null){ticks.push(High);this.highPrice=High;}}else{if(High!=null){ticks.push(High);this.highPrice=High;}}}else{Min=Math.min(Min,dStartObj.value);Max=Math.max(Max,dFinishObj.value);this._priceLines=[];var ticks=this._priceLines;if(scale>0){for(var p=dStartObj.value;p<=dFinishObj.value+((dFinishObj.value-dStartObj.value)*.05);p+=scale){ticks[ticks.length]=p;}}}}
var pad=this.style.vPadding;var height=this.height-2.0*pad;if(Max-Min===0){if(Max<Min){var Tmp=Min;Min=Max;Max=Tmp;}
var Max=Math.abs(Max);if(Max==0)
Max=1;if(Max<0)
Max=0;else if(Max==0)
Max=1;else
Min=0;}
this._yscale=-height/(Max-Min);this._y=height-Min*this._yscale+pad;},_setSession:function(session){this._xscale=session._xscale;this._x=session._x;},tx:function(x){if(!this._x){this._x=1;}
if(!this._xscale){this._xscale=1;}
return Math.floor(this._xscale*x+this._x)+(this._bump?0.5:0);},ty:function(y){return Math.floor(this._yscale*y+this._y)+(this._bump?0.5:0);},_makeStyle:function(spec){var steps=spec.split('-');if(steps.length==2){var gradient=this.drawingContext.createLinearGradient(0,0,0,this.height);gradient.addColorStop(0,steps[0]);gradient.addColorStop(1,steps[1]);return gradient;}else{return spec;}},_determineLastTrade:function(Trades){var latestPrice=null;for(var k=Trades.length-1;k>=0&&latestPrice===null;k--){if(Trades[k]){latestPrice=Trades[k];}}
this.lastPrice=latestPrice;},_getMinMax:function(Sessions,IncludePreviousClose){var MinPoint;var MaxPoint;var Min;var Max;var LowPrice;var HighPrice;var SessionHighPoint={Index:null,Price:null,SessionIndex:null};var SessionLowPoint={Index:null,Price:null,SessionIndex:null};if(IncludePreviousClose&&Sessions[0].PreviousClose!==null){Max=Min=Sessions[0].PreviousClose;}
var needsBump=false;if(this.data.Data[0].Value.IsIndex===1&&this._barSize===60){needsBump=true;}
for(var i=0;i<Sessions.length;i++){var Session=Sessions[i];this._setSession(Session);if(!Session.Trades){Session.Trades=[];}
var Low=Session.Low;var High=Session.High;if(Low||High){if(Low&&(!Min||Low.Price<Min)){Min=Low.Price;if(this._historical){MinPoint={x:this.tx(Low.Index/this._barSize),y:this.ty(Min)};}else{if(needsBump){MinPoint={x:this.tx(Low.Index+0.5),y:this.ty(Min)};}else{MinPoint={x:this.tx(Low.Index),y:this.ty(Min)};}}
SessionLowPoint.Index=Low.Index;SessionLowPoint.Price=Low.Price;SessionLowPoint.SessionIndex=i;}
if(High&&(!Max||High.Price>Max)){Max=High.Price;if(this._historical){MaxPoint={x:this.tx(High.Index/this._barSize),y:this.ty(Max)};}else{if(needsBump){MaxPoint={x:this.tx(High.Index+0.5),y:this.ty(Max)};}else{MaxPoint={x:this.tx(High.Index),y:this.ty(Max)};}}
SessionHighPoint.Index=High.Index;SessionHighPoint.Price=High.Price;SessionHighPoint.SessionIndex=i;}
if(Low&&(!LowPrice||Low.Price<LowPrice)){LowPrice=Low.Price;}
if(High&&(!HighPrice||High.Price>HighPrice)){HighPrice=High.Price;}}}
var UniqueHighPoint=null;var UniqueLowPoint=null;if(SessionHighPoint.Index!=null&&SessionHighPoint.Price!=null&&SessionHighPoint.SessionIndex!=null){if(SessionHighPoint.SessionIndex<Sessions.length&&SessionHighPoint.Index<Sessions[SessionHighPoint.SessionIndex].Trades.length){UniqueHighPoint=SessionHighPoint.Price;HighPrice=SessionHighPoint.Price;}}
if(SessionLowPoint.Index!=null&&SessionLowPoint.Price!=null&&SessionLowPoint.SessionIndex!=null){if(SessionLowPoint.SessionIndex<Sessions.length&&SessionLowPoint.Index<Sessions[SessionLowPoint.SessionIndex].Trades.length){UniqueLowPoint=SessionLowPoint.Price;LowPrice=SessionLowPoint.Price;}}
if(UniqueHighPoint!==null&&UniqueLowPoint!==null){if(SessionLowPoint.SessionIndex==SessionHighPoint.SessionIndex){if(SessionLowPoint.Index!==SessionHighPoint.Index){Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}}else
{Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}}else if(UniqueHighPoint!==null){Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index]=UniqueHighPoint;}else if(UniqueLowPoint!==null){Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index]=UniqueLowPoint;}
return({Min:Min,Max:Max,Low:LowPrice,High:HighPrice,MinPoint:MinPoint,MaxPoint:MaxPoint});}};
dojo.provide("dj.util.Article");dj.util.Article={getParentByNodeName:function(b,a){if(b.nodeName.toLowerCase()==a||b.parentNode===null)return b;return dj.util.Article.getParentByNodeName(b.parentNode,a)},isFloat:function(b){return/\d+\.\d+/.test(b)},shortenMe:function(){var b="http://api.bit.ly/shorten?callback=bitlyCallback&longUrl="+encodeURIComponent(longUrl)+"&version=2.0.1&login=wsjblogs&apiKey=R_4dd2ea29f00a2b806151d12d7807286b";if(document.getElementById("bitlynode")===null){var a=document.createElement("script");a.setAttribute("id","bitlynode");a.setAttribute("src",b);document.body.appendChild(a)}else window.open(bitlyTargetUrl);return false}};dojo.provide("dj.widget.article.tools.PartnerButton");dj.widget.article.tools.PartnerButton={init:function(b,a,c){dojo.forEach(dojo.query(b),function(d){dojo.connect(d,a,d,function(e){dojo.stopEvent(e);c.apply(this)})})}};dojo.provide("dj.widget.article.tools.TextBuddy");dojo.declare("dj.widget.article.tools.TextBuddy",null,{constructor:function(b,a,c,d){this.idLarge=b;this.idSmall=a;this.idMiddle=c;this.targetElements=dojo.query(".article.story p");if((b=dojo.query("div.articlePage p"))&&b.length>0)this.targetElements=dojo.query("div.articlePage p");this.initialState=[];this.refFontSize=0;this.increment=1;this.max=-1;this.min=4;this.menuButton=d;this.unit={em:0.1,px:1};return this},init:function(b){if(b){(b=dojo.byId(this.idLarge))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(true);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});(b=dojo.byId(this.idSmall))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(false);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});this.targetElements.forEach(function(a,c){var d=dojo.style(a,"fontSize");this.initialState[c]=d;if(c===0){d=d.substring(0,d.length-2);this.refFontSize=dj.util.Article.isFloat(d)?parseFloat(d):parseInt(d,10)}},this);(b=dojo.byId(this.idMiddle))&&dojo.connect(b,"onclick",this,function(a){this.clickHandlerMiddle();dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()})}else this.hideIt()},clickHandlerMiddle:function(){var b=this.initialState;this.targetElements.forEach(function(a,c){dojo.style(a,{fontSize:""+b[c]})})},makeItSo:function(b){if(this.targetElements&&this.targetElements.length>0){var a=dojo.style(this.targetElements[0],"fontSize"),c=a.substring(a.length-2),d=this.unit[c];a=a.substring(0,a.length-2);var e=dj.util.Article.isFloat(a);a=e?parseFloat(a):parseInt(a,10);a=a-this.refFontSize;if(e)a=a.toPrecision(2);if(!(b&&this.max!=-1&&a>=this.max*d||!b&&this.min!=-1&&a<=-(this.min*d))){var f=(b?this.increment:-this.increment)*d;this.targetElements.forEach(function(g){var h=dojo.style(g,"fontSize"),k=h.indexOf(c);if(k!=-1){h=h.substring(0,k);h=dj.util.Article.isFloat(h)?parseFloat(h):parseInt(h,10);dojo.style(g,{fontSize:h+f+c})}})}}},hideIt:function(){var b=dojo.byId(this.idLarge);b&&dojo.addClass(b.up(),"hidden")}});dojo.provide("dj.module.articleVisitHistory");dojo.require("dj.util.Cookie");dj.module.articleVisitHistory={_cookieName:"articleVisitHistory",_maxNumberOfIds:30,init:function(){dj.util.Cookie.deleteGroupCookie(true,this._cookieName);this._deleteCookie("DJCOOKIE")},_setCookie:function(b,a,c){var d="";if(c){d=new Date;d.setTime(d.getTime()+c*864E5);d="; expires="+d.toGMTString()}document.cookie=b+"="+a+d+"; path=/; domain=online.wsj.com"},_deleteCookie:function(b){this._setCookie(b,"",-1)}};dojo.provide("dj.module.comments.displayCommentCount");dojo.require("dj.util.Observer");dj.module.comments.displayCommentCount={init:function(){dj.context.article.commentsObserver=new dj.util.Observer;dj.context.article.commentsObserver.subscribeByName("commentsOnArticle",this.render,this)},render:function(b){console.log(b);if(isNaN(b)||b==0)dojo.query("#comment_text")[0].innerHTML="Be the first to comment";else{var a=" Comments, add yours ";if(b==1)a=" Comment, add yours ";dojo.query("#comment_text")[0].innerHTML=b+a}}};dojo.provide("dj.util.referal");dojo.require("dj.util.Page");dj.util.referal={getString:function(){var b="";if(document.referrer!=undefined&&document.referrer!=null&&document.referrer!="")b=document.referrer;else{var a=dj.util.Page.getQueryParam("fixedKeyword");if(a!="")return{engine:"DUMMY",query:a}}if(b!=""){a=b.match(/(google|bing|yahoo|aol)/);var c="q=";if(a[1]=="yahoo")c="p=";b=b.split(c);c=-1;if(b[1]!="")c=b[1].indexOf("&",0);queryString=c!=-1?b[1].substring(0,c):b[1];b=unescape(queryString).replace(/[-,+]/g," ");return b!=undefined&&b!=null?{engine:a[1],query:b}:{engine:"",query:""}}}};dojo.provide("dj.module.articlePagination");dojo.require("dj.util.History");dojo.require("dj.util.Observer");dj.module.articlePagination={init:function(){dj.util.History.init();this.oPages=dojo.query("#articleTabs_panel_article .articlePage");if(!(typeof this.oPages=="undefined"||this.oPages===null)){this.oPages.removeClass("hidden");this.panelsName="articleTabs_panel_article";var b=this.oPages.length;this.paginationModel.setNumberOfPages(b);if(!(b<2)){var a=this,c=1;dj.util.History.subscribe(a.panelsName,function(e){a.paginationModel.setCurrent(e-1)});this.paginationModel.subscribe("current",function(e){c=a.oPages[e];if(typeof c!="undefined"){a.oPages.style({display:"none"});c.setStyle({display:"block"})}});this.paginationModel.subscribe("next",function(){a.paginationModel.setCurrent(a.paginationModel.getNext())});this.paginationModel.subscribe("prev",function(){a.paginationModel.setCurrent(a.paginationModel.getPrev())});this.paginationModel.subscribe("all",function(){a.oPages.invoke("setStyle",{display:"block"})});this.insertPagination(b,"article_pagination_top","article_pagination_bottom");var d=dj.util.History.get(a.panelsName)||null;d=d!==null&&d<=b&&d>0?d:1;a.paginationModel.setCurrent(d-1);dj.util.History.set(this.panelsName,d)}}},paginationModel:function(){var b=null,a=0,c=new dj.util.Observer(this);return{getPrev:function(){return 0<=b-1?b-1:b},getNext:function(){return a>b+1?b+1:b},getCurrent:function(){return b},setNumberOfPages:function(d){a=d},getNumberOfPages:function(){return a},setCurrent:function(d,e){b=d;c.fireByName("current",d,e)},doNext:function(d){c.fireByName("next",d)},doPrev:function(d){c.fireByName("prev",d)},doAll:function(d){c.fireByName("all",d)},subscribe:function(d,e){if(arguments.length==1){e=d;d="current"}c.subscribeByName(d,e)}}}(),insertPagination:function(){var b=$A(arguments),a=b.shift(),c=this.paginationModel,d=this;b.each(function(e){e=$(e);var f=d.buildPagination(a);c.subscribe("current",function(g){if(!isNaN(g)&&typeof f.pgs[g]!=="undefined"){g===0?dojo.addClass(f.prv,"disabled"):dojo.removeClass(f.prv,"disabled");g==a-1?dojo.addClass(f.nxt,"disabled"):dojo.removeClass(f.nxt,"disabled");f.all.setStyle({display:"block"});f.pgs.invoke("removeClassName","current");f.pgs[g].addClassName("current");window.scrollTo(0,0)}});c.subscribe("all",function(){f.all.setStyle({display:"none"});f.pgs.invoke("removeClassName","current");window.scrollTo(0,0)});f.pgs.each(function(g,h){g.observe("click",function(k){k.stop();c.setCurrent(h,g);dj.util.History.set(d.panelsName,h+1)})});f.nxt.observe("click",function(g){g.stop();c.doNext(f);dj.util.History.set(d.panelsName,c.getCurrent()+1)});f.prv.observe("click",function(g){g.stop();c.doPrev(f);dj.util.History.set(d.panelsName,c.getCurrent()+1)});f.all.observe("click",function(g){g.stop();c.doAll(f)});e.insert(f.cnt)})},buildPagination:function(b){var a=new Element("div",{"class":"pagination"}),c=new Element("ul",{"class":"listPages"});a.insert(c);var d=new Element("li",{"class":"listFirst"}),e=(new Element("a",{href:"#articleTabs_panel_article=prev"})).update("&laquo; Previous");d.insert(e);c.insert(d);d=[];for(var f=null,g=1;g<=b;g++){f=new Element("li",{"class":g!==1?"page":"page current"});f.insert((new Element("a",{href:"#articleTabs_panel_article="+g})).update(g));c.insert(f);d.push(f)}f=new Element("li");b=(new Element("a",{href:"#articleTabs_panel_article=next"})).update("Next &raquo;");f.insert(b);c.insert(f);c=(new Element("a",{href:"#articleTabs_panel_article=all","class":"articleOnePage"})).update("All On One Page");a.insert(c);return{cnt:a,pgs:d,prv:e,nxt:b,all:c}}};dojo.provide("dj.module.articleTabs");dojo.require("dj.widget.panels.virtual.Tabs");dojo.require("dj.widget.panels.virtual.History");dj.module.articleTabs={init:function(){this.panels=dj.widget.panels.PanelsFactory.create("articleTabs",{core:{panelPrefix:"articleTabs_panel_",panels:["article","video","slideshow","interactive","map","document","quotes","comments","whysubscribe"],enableBrowserHistory:true},tabs:{tabPrefix:"articleTabs_tab_",tabOnStyle:"selected",tabOffStyle:"deselected"}})},getPanels:function(){return this.panels}};dojo.provide("dj.widget.article.quotes.ArticleQuotes");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Tracking");dojo.declare("dj.widget.article.quotes.ArticleQuotes",null,{constructor:function(b,a,c,d,e,f){this.tabModule=b;this.tabName="quotes";this.dataTagId="quotesContainer";this.quotesPanelUrl=null;this.chartDataReady=this.adContainersAdded=false;this.fundChartData=this.fundChartDataUrl=this.chartData=this.chartDataUrl=null;this._init=false;this.omniture={saveVars:["pageName","section","aheadline","abasedocid","author","ctype"],saveValues:[],ctype:"quotes_tab",section:"Research and Tools",abasedocid:"",aheadline:"",author:"",pageNameSuffix:"_quotes"};this.typeMap=dojo.mixin({company:"djn","mutual-fund":"usfunds"},e);this.urlConfig=dojo.mixin({symbolTablePathPrefix:"/public/npage/",chartDataPathPrefix:"/public/npage/",symbolTablePathPageId:"0_0_WA_quotes_tab",chartDataPathPageId:"0_0_WA_QuotesTabChartData"},a);this.config=dojo.mixin({symbolsPerRequest:8,firstAdPosition:4,adInterval:3,multipleAds:false,loadingImg:true,initAutoComplete:true},f);this.baseChartConfig={StartDate:"",EndDate:"",Width:135,Height:35};this.chartConfig=dojo.mixin({freq:"5mi",time:"1dy"},this.baseChartConfig);if(c&&c.chart)this.chartConfig=dojo.mixin(this.chartConfig,c.chart);this.fundChartConfig=dojo.mixin({freq:"1d",time:"5dy"},this.baseChartConfig);if(c&&c.fund)this.fundChartConfig=dojo.mixin(this.fundChartConfig,c.fund);this.WSJIndexChartStyle=dojo.mixin({background:"#ffffff",border:"#E6E2D7",closelineStyle:"#e36825",horizontalGridLineStyle:"#f4f3f1",highIndicatorStyle:"#093c71",highlowLineStyle:"#015190",lowIndicatorStyle:"#093c71",mainLineStyle:"#557BA0",mainPriceLineFill:"rgba(85,123,160,0.15)",mainPriceLineWidth:1,maxPriceLines:4,verticalGridLineStyle:"rgba(180,201,202,0.5)",verticalGridLineStyle_Opaque:"rgba(180,201,202,1.0)",vPadding:0,YAxisLabelStyle:1,YAxisLabelHeight:0,showDecimals:1,regionStyles:{0:"#cde2e0",1:"#cde2e0",2:"rgba(51,51,51,0.06)"},comparelineStyles:{0:"#cc3333",1:"#3b8dad",2:"#c9932e",3:"#b78383",4:"#8eb3bc",5:"#dbb782"}},d);this.callWhenQuotesActive(b)},init:function(){if(!this._init){this._init=true;for(var b=dj.util.Element.getDataset(dojo.byId(this.dataTagId)),a=eval(b.companySymbolCount),c="",d="",e="",f="qqs",g=this.config.symbolsPerRequest,h="",k=0;k<a;k++){var n=b["companySymbol"+k].split("@"),p=n[0].toUpperCase(),q=this.typeMap[n[1]].toUpperCase();if(q==="DJN")c=c.concat(","+p);else d=d.concat(","+p);if(k!==0&&k%g===0){h=h.concat("&"+f+Math.ceil(k/g)+"="+this.processQueryString(e));e=""}e=e.concat("&symbol="+p+"&type="+q)}if(e!=="")h=h.concat("&"+f+Math.ceil(a/g)+"="+this.processQueryString(e));var m=this.urlConfig;if(c.length>0){var o=this.chartConfig,l="";for(name in o)l=l.concat("&"+name+"="+o[name]);this.chartDataUrl=m.chartDataPathPrefix+m.chartDataPathPageId+".html?queryString="+this.processQueryString(l+"&Symbols="+c.substring(1))}if(d.length>0){var u=this.fundChartConfig;l="";for(name in u)l=l.concat("&"+name+"="+u[name]);this.fundChartDataUrl=m.chartDataPathPrefix+m.chartDataPathPageId+".html?queryString="+this.processQueryString(l+"&Symbols="+d.substring(1))}if(h.length>0)this.quotesPanelUrl=m.symbolTablePathPrefix+m.symbolTablePathPageId+".html?"+h.substring(1)}},callWhenQuotesActive:function(b){var a=false;b.addChangeListener("success",function(c){a=this.play(a,c.getId())},this);a=this.play(a,b.getActive().getId())},play:function(b,a){if(this.tabName!==a)return b||false;this.omniturefirepixel(true);if(b)this.loadAd();else{this.init();this.beginLoading();this.initSymbolLookup();this.loadQuotesTable()}return true},loadQuotesTable:function(){var b=this;console.log();var a=this.quotesPanelUrl+
this.getCurrentDateQueryString();a!==null&&a!==""&&dojo.xhrGet({url:a,load:function(c){dojo.byId(b.dataTagId).innerHTML=c;b.loadAd();b.loadCharts()}})},getCurrentDateQueryString:function(){var b=new Date,a;a=" ".concat(b.getFullYear()+"-");a=a.concat(this.addLeadingZero(b.getMonth()+1)+"-");a=a.concat(this.addLeadingZero(b.getDate())+" ");a=a.concat(this.addLeadingZero(b.getHours())+":");a=a.concat(this.addLeadingZero(b.getMinutes()));return"&ct="+this.processQueryString(a)},addLeadingZero:function(b){if(b<10)return"0"+b;return b},processQueryString:function(b){return escape(b.substring(1))},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;var b=this.omniture.pixel.getMetaData("pageName");if(b.indexOf("FreeRegScrimForm")==-1){this.omniture.pixel.resetPixel();this.omnituresavepixel();if(b.indexOf("Flash Interactive")!=-1){this.omniture.ctype="quotes_tab_interactives";s.prop21="";s.prop8="DJ Infographics"}this.omniture.pixel.setMetaData("ctype",this.omniture.ctype);this.omniture.pixel.setMetaData("section",this.omniture.section);this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);this.omniture.pixel.setMetaData("abasedocid",this.omniture.abasedocid);this.omniture.pixel.setMetaData("author",this.omniture.author);this.omniture.pixel.setMetaData("pageName",b+this.omniture.pageNameSuffix);this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}},loadAd:function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.insertAdContainers();this.ads.loadAds(this.tabName)},insertAdContainers:function(){if(!this.adContainersAdded){this.adContainersAdded=true;var b=dojo.byId("mqContainerDiv");b=dojo.query("ul.mqContainerList",b);var a=this,c=0,d=0,e=this.config.firstAdPosition-1;dojo.forEach(b,function(f){if((a.config.multipleAds||c===0)&&!dojo.hasClass(f,"hidden")){if(d===e||d>e&&(d-e)%a.config.adInterval===0)dojo.place(dojo.create("div",{id:"ad_div"+c++,"class":"adSummary ad_728_reallywide"}),f,"after");d++}});c===0&&dojo.place(dojo.create("div",{id:"ad_div"+c++,"class":"adSummary ad_728_reallywide"}),b[b.length-1],"after")}},loadCharts:function(){if(dj.lang.isIE){document.namespaces.g_vml_||document.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");document.namespaces.g_o_||document.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML")}this.getChartData(this.chartDataUrl);this.getChartData(this.fundChartDataUrl)},renderChart:function(){if(this.chartDataReady){var b=this;dojo.forEach(this.chartData,function(a){a=a.Key;var c="chartCanvas"+a,d=dojo.byId(c);if(d){b.renderChartWithContainerAndSymbol(c,a,a);if(dojo.hasAttr(d,"advancedChartUrl")){dojo.style(d,{cursor:"pointer"});dojo.connect(d,"click",d,function(){window.location=dojo.attr(d,"advancedChartUrl")})}}})}},renderChartWithContainerAndSymbol:function(b,a,c){try{(new EmbeddedChart(b,this.WSJIndexChartStyle,this.chartConfig.Width,this.chartConfig.Height,this.chartConfig.time,this.chartConfig.freq,null,null,this.chartData,a)).ShowChart()||this.showNoChartMessage(b,c)}catch(d){console.log(d)}},showNoChartMessage:function(b){dojo.byId(b)},getChartData:function(b){if(b===null)this.chartDataReady=false;else{var a=this;dj.lang.xhrGet({url:b,handleAs:"json",preventCache:true,load:function(c){a.chartData=c;a.chartDataReady=true;a.renderChart();a.doneLoading();return c},error:function(c){a.chartDataReady=false;return c}})}},initSymbolLookup:function(){if(this.config.initAutoComplete){initInfoComplete((new InfoCompleteConfig("quotesTabSymbolLookupField","quotesTabSymbolLookupResults","quotesTabSymbolLookupBtn")).initSymbol(formatSymbolCompleteResult),symbolComplete);var b=dojo.byId("quotesTabSymbolLookupField"),a=dojo.connect(b,"click",b,function(){if(this.value!=="")this.value="";dojo.disconnect(a)})}},beginLoading:function(){if(this.config.loadingImg){dojo.hasClass("quotesTabLoading","hidden")&&dojo.removeClass("quotesTabLoading","hidden");dojo.addClass("quotesPanel","hidden")}},doneLoading:function(){if(this.config.loadingImg){dojo.addClass("quotesTabLoading","hidden");dojo.removeClass("quotesPanel","hidden")}}});dojo.provide("dj.widget.article.text.ArticleText");dojo.require("dj.widget.video.Video");dojo.require("dj.widget.ad.AdManager");(function(){var b=dj.widget.article.text;(b.ArticleTabText=function(a,c,d){this.tabModule=a;this.playObserver=c;this.tabName="article";this.videos={};this.videothumbs={};this.flashes={};this.omniture={};this.omniturePrefix=d!=="undefined"?d:"";this.omniture.saveVars=["pageName","section","aheadline","abasedocid","author"];this.omniture.saveValues=[];var e=this;a.observePanels(function(f,g){if(a.hasPanel(f))if(f==e.tabName)e.play();else g==e.tabName&&e.pausevideos()})}).prototype={registervideo:function(a,c,d,e,f){this.videos[a]={v:c,w:d,h:e,c:f}},registerflash:function(a,c,d){this.flashes[a]={p:c,s:d};if(!this.fixthumbhref){(a=dojo.byId("article_story_body"))&&dojo.connect(a,"onclick",function(e){var f=e.target;typeof f.href!=="undefined"&&f.href.indexOf("#")>-1&&f.href.split("#")[1].indexOf("articleTabs_")>-1&&dojo.stopEvent(e)});this.fixthumbhref=true}},registervideothumbnail:function(a,c){this.videothumbs[a]={v:c}},playflashes:function(){for(var a in this.flashes)if(this.flashes.hasOwnProperty(a))if(!this.flashes[a].flash)this.flashes[a].flash=new dj.widget.flash.Flash(a,this.flashes[a].p,this.flashes[a].s)},playvideos:function(){for(var a in this.videos)if(this.videos.hasOwnProperty(a))if(!this.videos[a].video)this.videos[a].video=new dj.widget.video.Video(a,this.videos[a].v,this.videos[a].w,this.videos[a].h,this.videos[a].c)},playvideothumbs:function(){for(var a in this.videothumbs)if(this.videothumbs.hasOwnProperty(a))if(!this.videothumbs[a].videothumb){this.videothumbs[a].videothumb=new dj.widget.video.Video(a);this.videothumbs[a].videothumb.loadthumbnail(this.videothumbs[a].v,200,120,this.playObserver)}},pausevideos:function(){if(this.videos)for(var a in this.videos)try{this.videos[a].video.pauseMicroPlayer()}catch(c){}},play:function(a){if(!a)if((a=dojo.query("div.articleHeadlineBox"))&&a[0]){a=dojo.position(a[0],true).y;var c=dojo.getViewport().t[1];a<c&&window.scrollTo(0,a)}if((a=dojo.byId("fblikebot"))&&a.getElementsByTagName("iframe")[0]&&a.getElementsByTagName("iframe")[0].height<5)a.getElementsByTagName("iframe")[0].src=a.getElementsByTagName("iframe")[0].src;if((a=dojo.byId("related_stories_module"))&&a.getElementsByTagName("iframe")[0]&&a.getElementsByTagName("iframe")[0].height<15)a.getElementsByTagName("iframe")[0].src=a.getElementsByTagName("iframe")[0].src;if(!this.ads)this.ads=dj.widget.ad.AdManager;if(this.ads)try{this.ads.loadAds("article")}catch(d){}this.omniturefirepixel()},tabplay:function(){this.setdefault();this.tabModule.setActivePanel(this.tabName)},playbookmark:function(){this.tabModule.getActivePanel()==this.tabName&&this.play(true)},omnituresavepixel:function(){for(var a=this.omniture.saveVars.length,c=0;c<a;c++)this.omniture.saveValues[c]=this.omniture.pixel.getMetaData(this.omniture.saveVars[c])},omniturerestorepixel:function(){for(var a=this.omniture.saveVars.length,c=0;c<a;c++)this.omniture.pixel.setMetaData(this.omniture.saveVars[c],this.omniture.saveValues[c])},omniturefirepixel:function(){if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();this.omniture.pixel.setMetaData("ctype","article");this.omniture.pixel.setMetaData("section","Article");this.omniturePrefix!==""?this.omniture.pixel.firePixel(true,this.omniturePrefix):this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}}})();dojo.provide("dj.widget.article.tools.ArticleTools");dojo.require("dj.util.Url");dojo.require("clickability.w-button");dojo.getObject("dj.module.dashboard",true);dojo.getObject("dj.module.articleTools",true);var suppressReprints=0,digg_url=AT_VARS.articleUrl,clickURL=digg_url+"?mod=mostpop",digg_title=AT_VARS.clickTitle,clickTitle=digg_title,digg_bodytext=AT_VARS.bodyText,digg_topic="";longUrl=digg_url+"?mod=wsj_share_twitter";twitter_title=digg_title;if(twitter_title.length>79)twitter_title=twitter_title.substr(0,77)+"...";function bitlyCallback(b){bitlyTargetUrl=b.statusCode==="OK"&&b.results[longUrl].shortCNAMEUrl!="undefined"?"http://twitter.com/intent/tweet?text="+encodeURIComponent(twitter_title+" "+b.results[longUrl].shortCNAMEUrl):"http://twitter.com/intent/tweet?text="+encodeURIComponent(twitter_title+" "+longUrl);window.open(bitlyTargetUrl)}
function CopyrightPopUp(){var b=AT_VARS,a=[];a.push("PublisherName="+escape(b.publicationName));a.push("ContentID="+escape(b.baseDocId+b.baseDocExtension));a.push("orderReset=true");a.push("Title="+escape(b.articleHeadline));a.push("Author="+escape(b.authors));a.push("CreditLine="+escape(b.byLine||""));a.push("PublicationDate="+escape(b.publicationDate));a.push("ArticleType="+escape(b.articleType));a.push("DJType="+escape(b.djType));a.push("orderSource=wsj.com");dj.util.Url.openWin("https://s100.copyright.com/Clients/wsj_com/FairUse.jsp?"+
a.join("&"),"reprints",515,440,"scroll,resizable",true)}
dj.util.Article={getParentByNodeName:function(b,a){if(b.nodeName.toLowerCase()==a||b.parentNode===null)return b;return dj.util.Article.getParentByNodeName(b.parentNode,a)},isFloat:function(b){return/\d+\.\d+/.test(b)},shortenMe:function(){var b="http://api.bit.ly/shorten?callback=bitlyCallback&longUrl="+encodeURIComponent(longUrl)+"&version=2.0.1&login=wsjblogs&apiKey=R_4dd2ea29f00a2b806151d12d7807286b";if(document.getElementById("bitlynode")===null){var a=document.createElement("script");a.setAttribute("id","bitlynode");a.setAttribute("src",b);document.body.appendChild(a)}else window.open(bitlyTargetUrl);return false}};dojo.declare("dj.module.articleTools.Initilizer2011",null,{constructor:function(b,a,c,d){(new dj.module.articleTools.Button(b+".at.emailthis",function(){var e="wsj_share_email";if(b.indexOf("b")>0)e+="_bot";ET(e)},false)).init();(new dj.module.articleTools.Button(b+".at.print",function(){var e="".concat(document.location),f=e.indexOf("#");if(f!=-1)e=e.substring(0,f);dj.util.Url.openWin(e+"#printMode","printFriendly",800,600,"",true)},false)).init();a?(new dj.module.articleTools.TextBuddy(b+".at.tbl",b+".at.tbs",b+".at.tbm")).init(c):(new dj.module.articleTools.Button(b+".at.reprint",function(){CopyrightPopUp()},false)).init();if(d)(a=dojo.byId(b+".at.sponsor"))&&dojo.removeClass(a,"hidden")}});dojo.declare("dj.module.articleTools.Initilizer",null,{constructor:function(b,a,c,d){var e=false;(new dj.module.articleTools.Button(b+".at.emailthis",function(){var f="wsj_share_email";if(b.indexOf("b")>0)f+="_bot";ET(f)},e)).init();(new dj.module.articleTools.Button(b+".at.print",function(){var f="".concat(document.location),g=f.indexOf("#");if(g!=-1)f=f.substring(0,g);dj.util.Url.openWin(f+"#printMode","printFriendly",800,600,"",true)},e)).init();if(a){a=(new dj.module.articleTools.MenuButton(b+".share.arrow",b+".share.ddc")).init();(new dj.module.articleTools.TextBuddy(b+".at.tbl",b+".at.tbs",b+".at.tbm",a)).init(c)}else(new dj.module.articleTools.Button(b+".at.reprint",function(){CopyrightPopUp()},e)).init();(new dj.module.articleTools.ShareButton(b+".share.facebook",function(){var f="http://www.facebook.com/share.php?u="+encodeURIComponent(digg_url+"?mod=wsj_share_facebook")+"&t="+encodeURIComponent(digg_title);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.delicios",function(){var f="http://del.icio.us/post?v=4&partner=wsj&noui&jump=closeurl="+encodeURIComponent(digg_url+"?mod=wsj_share_delicios")+"&title="+encodeURIComponent(digg_title)+"&bodytext="+encodeURIComponent(digg_bodytext);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.reddit",function(){var f="http://www.reddit.com/submit?title="+encodeURIComponent(digg_title)+" &url="+encodeURIComponent(digg_url+"?mod=wsj_share_reddit");window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.stumble",function(){var f="http://www.stumbleupon.com/submit?&url="+encodeURIComponent(digg_url+"?mod=wsj_share_stumble")+"&title="+encodeURIComponent(digg_title);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.fark",function(){var f="http://www.fark.com/cgi/farkit.pl?u="+encodeURIComponent(digg_url+"?mod=wsj_share_fark")+"&h="+encodeURIComponent(digg_title);window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.linkedin",function(){var f="http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(digg_url+"?mod=wsj_share_linkedin")+"&source=WSJ";window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.twitter",function(){dj.util.Article.shortenMe()},e)).init();(new dj.module.articleTools.ShareButton(b+".share.viadio",function(){var f="http://www.viadeo.com/shareit/share/?url="+encodeURIComponent(digg_url+"?mod=wsj_share_viadeo")+"&title="+encodeURIComponent(digg_title)+"&urlaffiliate=40510";window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.orkut",function(){var f="http://promote.orkut.com/preview?nt=orkut.com&tt="+encodeURIComponent(digg_title)+"&cn="+encodeURIComponent(digg_bodytext)+"&du="+encodeURIComponent(digg_url+"?mod=wsj_share_orkut");window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.digg",function(){Digg.remoteSubmit(digg_url+"?mod=wsj_share_digg",digg_title,digg_bodytext,digg_topic)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.myspace",function(){var f="http://www.myspace.com/Modules/PostTo/Pages/?t="+encodeURIComponent(digg_title)+"&c="+encodeURIComponent(digg_bodytext)+"&u="+encodeURIComponent(digg_url+"?mod=wsj_share_myspace")+"&l=3";window.open(f)},e)).init();(new dj.module.articleTools.ShareButton(b+".share.ybuzz",function(){var f=dojo.byId(this.id);if(f)f.href+=digg_url+"?mod=wsj_share_ybuzz"},true)).init();if(d)(c=dojo.byId(b+".at.sponsor"))&&dojo.removeClass(c,"hidden")}});dojo.declare("dj.module.articleTools.Button",null,{constructor:function(b,a,c){this.id=b;if(this.clickHandler=a)this.clickHandler=dojo.hitch(this,this.clickHandler);this.isLink=c;return this},init:function(){if(this.isLink)this.clickHandler();else{var b=dojo.byId(this.id);b&&this.clickHandler&&dojo.connect(b,"onclick",this,this.clickHandler)}dojo.connect(document,"onclick",this,function(a){this.handleDocClick(a)});return this},handleDocClick:function(b){dj.util.Article.getParentByNodeName(b.target,"a").id==this.id&&!this.isLink&&dojo.stopEvent(b)}});dojo.declare("dj.module.articleTools.ShareButton",dj.module.articleTools.Button,{constructor:function(){if(this.clickHandler===null){var b=dojo.byId(this.id);b&&dojo.addClass(b.parentNode,"hidden")}}});dojo.declare("dj.module.articleTools.MenuButton",null,{constructor:function(b,a){this.id=b;this.menuItem=dojo.byId(a);return this},init:function(){var b=dojo.byId(this.id);b&&dojo.connect(b,"onclick",this,function(a){this.toggleMenu();dojo.stopEvent(a)});dojo.connect(document,"onclick",this,function(a){var c=dojo.byId(this.id);c&&a.target!=c&&this.closeMenu()});return this},toggleMenu:function(){dojo.toggleClass(this.menuItem,"collapsed");dojo.toggleClass(this.menuItem,"expanded");dj.module.dashboard.DashboardSaveTo&&dj.module.dashboard.DashboardSaveTo.restoreDefaultState()},closeMenu:function(){dojo.addClass(this.menuItem,"collapsed");dojo.removeClass(this.menuItem,"expanded");dj.module.dashboard.DashboardSaveTo&&dj.module.dashboard.DashboardSaveTo.restoreDefaultState()}});dojo.declare("dj.module.articleTools.TextBuddy",null,{constructor:function(b,a,c,d){this.idLarge=b;this.idSmall=a;this.idMiddle=c;this.targetElements=dojo.query(".article.story p");if((b=dojo.query("div.articlePage p"))&&b.length>0)this.targetElements=dojo.query("div.articlePage p");this.initialState=[];this.refFontSize=0;this.increment=1;this.max=-1;this.min=4;this.menuButton=d;this.unit={em:0.1,px:1};return this},init:function(b){if(b){(b=dojo.byId(this.idLarge))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(true);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});(b=dojo.byId(this.idSmall))&&dojo.connect(b,"onclick",this,function(a){this.makeItSo(false);dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()});this.targetElements.forEach(function(a,c){var d=dojo.style(a,"fontSize");this.initialState[c]=d;if(c===0){d=d.substring(0,d.length-2);this.refFontSize=dj.util.Article.isFloat(d)?parseFloat(d):parseInt(d,10)}},this);(b=dojo.byId(this.idMiddle))&&dojo.connect(b,"onclick",this,function(a){this.clickHandlerMiddle();dojo.stopEvent(a);this.menuButton&&this.menuButton.closeMenu()})}else this.hideIt()},clickHandlerMiddle:function(){var b=this.initialState;this.targetElements.forEach(function(a,c){dojo.style(a,{fontSize:""+b[c]})})},makeItSo:function(b){if(this.targetElements&&this.targetElements.length>0){var a=dojo.style(this.targetElements[0],"fontSize"),c=a.substring(a.length-2),d=this.unit[c];a=a.substring(0,a.length-2);var e=dj.util.Article.isFloat(a);a=e?parseFloat(a):parseInt(a,10);a=a-this.refFontSize;if(e)a=a.toPrecision(2);if(!(b&&this.max!=-1&&a>=this.max*d||!b&&this.min!=-1&&a<=-(this.min*d))){var f=(b?this.increment:-this.increment)*d;this.targetElements.forEach(function(g){var h=dojo.style(g,"fontSize"),k=h.indexOf(c);if(k!=-1){h=h.substring(0,k);h=dj.util.Article.isFloat(h)?parseFloat(h):parseInt(h,10);dojo.style(g,{fontSize:h+f+c})}})}}},hideIt:function(){var b=dojo.byId(this.idLarge);b&&dojo.addClass(b.up(),"hidden")}});dojo.provide("dj.module.comments.comments");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Tracking");dojo.require("dj.community.ArticleComments");dojo.require("dj.util.Observer");dj.module.comments.comments={sbNumber:typeof AT_VARS==="object"?AT_VARS.baseDocId:"",tabName:"comments",articleName:typeof AT_VARS==="object"?AT_VARS.articleHeadline:"",theArticleComments:null,showCommentsOnTabs:function(b,a){var c=this,d=false;b=b=="undefined"||b===null?dj.context.core.urlPrefix:document.URL.substring(0,document.URL.indexOf(".com")+4);if(s.prop2==="WSJ_Opinion"||s.prop2==="Opinion")d=true;c.theArticleComments=new dj.community.ArticleComments(c.sbNumber,c.articleName,b+"/community","/community",function(e){if("undefined"!==typeof dj.module.articleTabs&&"undefined"!==typeof dj.module.articleTabs.config&&"undefined"!==typeof dj.module.articleTabs.config.comments){var f=dj.module.articleTabs.config.comments;if("undefined"!==typeof f.commentCountDisplayText)var g=f.commentCountDisplayText;if("undefined"!==typeof f.firstCommentDisplayText)var h=f.firstCommentDisplayText;if("undefined"!==typeof f.addCommentSingularDisplayText)var k=f.addCommentSingularDisplayText;if("undefined"!==typeof f.addCommentPluralDisplayText)var n=f.addCommentPluralDisplayText}this.cElement=dojo.query("#articleTabs_tab_comments a")[0];if(!isNaN(e)&&e>0){f="Comments";if("undefined"!==typeof g)f=g;if(AT_VARS.articleType=="Portuguese"||AT_VARS.articleType=="Spanish")f="Comentarios";this.cElement.innerHTML=f+" ("+e+")"}if(g=dojo.byId("comment_text"))if(isNaN(e)||e===0){g.innerHTML="Be the first to comment";if("undefined"!==typeof h)g.innerHTML=h}else{h=" Comments, add yours ";if("undefined"!==typeof n)h=n;if(e==1){h=" Comment, add yours ";if("undefined"!==typeof k)h=k}g.innerHTML=e+h}},function(e){c.activateCommentsPanel();e=dojo.byId(e);if(e===undefined)window.scrollTo(0,0);else e!==null?window.scrollTo(0,e.offsetTop-200):console.error("Exception occured in showComments")},d,function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.ads&&this.ads.loadAds(c.tabName);dj.module.articleCommentsTab.omniturefirepixel()},a);c.theArticleComments.GetCommentBox("leaveComment");dj.module.articleTabs&&dj.module.articleTabs.panels.getActivePanel()===c.tabName&&c.theArticleComments.GetComments("discussionThreadBox")},showCommentsOnCommentTab:function(){this.theArticleComments.GetComments("discussionThreadBox")},clearComment:function(b){b.value=""},activateCommentsPanel:function(){dj.module.articleTabs&&dj.module.articleTabs.panels.getActivePanel()!==this.tabName&&dj.module.articleTabs.panels.setActivePanel(this.tabName)},replaceHTMLTags:function(b){b=b.replace(/</g,"&lt;");return b=b.replace(/>/g,"&gt;")}};dojo.mixin(dj.module.comments,dj.module.comments.comments);dojo.provide("dj.widget.article.slideshow.nonflashSlideshow");dojo.require("dj.widget.panels.PanelsFactory");dojo.require("dj.util.Ads");dojo.require("dj.util.Tracking");dojo.require("dojo.back");dojo.require("dojo.hash");ApplicationState=function(b,a,c){this.stateData=a;this.changeUrl=c||false;this.pModel=b};ApplicationState.prototype={back:function(){dj.widget.article.slideshow.slideshowHOD.historyCall(this.stateData)},forward:function(){dj.widget.article.slideshow.slideshowHOD.historyCall(this.stateData)}};dj.widget.article.slideshow.nonflashSlideshow={ACTION_SOURCE:{BOOKMARK:1,CONTROL:2,HISTORY:3,NONE:-1},init:function(b){this.config=dojo.safeMixin({containerId:"slideContainer",adRefreshCounter:3,panels:{core:{enableLazyImages:true,panelGroup:".imageSlide .newsItem",cacheVector:false,tabletSwipe:true},carousel:{hasLastSlideScrim:true}},additionalControl:["slideBox"],hashPrefix:"slide/",history:true,lastSlideScrim:{id:"lastSlideScrim",clazz:".lastSlideScrim",backToBeginning:".dSlideviewer-backToBeginning"},slideContainer:"slideBox",swipeThresholdRatio:0.5},b);this._initialize();this._initLastSlideScrim();this._initHistory();this._initializeTools();this._initializeCaptionShowHide()},_initialize:function(){var b=this.config,a=this,c=b.additionalControl,d=dj.widget.panels.PanelsFactory;this.clickCounter=0;this.omniture={};this.panelsCount=0;this.actionSource=this.ACTION_SOURCE.NONE;this.pnls=d.create(b.containerId,b.panels);this.firstNavArrows={view:this.pnls.views.navArrows,control:this.pnls.controllers.navArrows};for(var e=0,f=c.length;e<f;e++)d.addModuleNavArrows(this.pnls,{container:dojo.byId(c[e]),tabletSwipe:b.panels.core.tabletSwipe,thresholdRatio:b.swipeThresholdRatio});this.panelsCount=this.pnls.getNumberOfPanels();dojo.addLiveEvent(b.lastSlideScrim.backToBeginning,"click",function(g){dojo.stopEvent(g);this._backToBeginning()},this);this.pnls.addChangeListener("failure",function(g){if(g>this.pnls.getNumberOfPanels()){this.firstNavArrows.view.displayLastSlideScrim();this._enableLastSlideScrim()}(new dj.module.articleTools.Button("email_LastSlide",function(){ET()},false)).init()},this);this.pnls.addChangeListener("success",function(g){prevId=this.model._prevInHistory._position?this.model._prevInHistory._position:1;g=g.getPosition();if(prevId===g)prevId=1;if(g!==1)dojo.removeClass(b.slideContainer,"theFirstSlide");else g===1&&dojo.addClass(b.slideContainer,"theFirstSlide");a.updateThumbsAndPanel(prevId,g)})},_initializeCaptionShowHide:function(){dojo.addLiveEvent(".ssTxtToggle","click",function(b){dojo.stopEvent(b);var a=this.parentNode;if(a){var c=dojo.query(".caption_short",a);if(c){var d=dojo.query(".caption_full",a);if(d){c.addClass("hidden");d.removeClass("hidden");dojo.addClass(this,"hidden")}}}})},updateThumbsAndPanel:function(b,a){this.clickCounter+=1;var c=dojo.query(".imageCredit div");if(c!=undefined&&c[b-1])c[b-1].style.display="none";if(c!=undefined&&c[a-1])c[a-1].style.display="block";c=dojo.query(".slideDescription div");if(c!=undefined&&c[b-1])c[b-1].style.display="none";if(c!=undefined&&c[a-1])c[a-1].style.display="block";if(this.clickCounter%this.config.adRefreshCounter==0)try{(new dj.util.Ads).loadAds("slideshow",{ordrecalculate:1})}catch(d){}a!==1&&this.omniturefirepixel(a)},_initHistory:function(){var b=this.config;if(b.history){dojo.subscribe("/dojo/hashchange",this,function(d){if(this.actionSource!==this.ACTION_SOURCE.CONTROL&&this.actionSource!==this.ACTION_SOURCE.BOOKMARK){d=d.replace(b.hashPrefix,"");var e=this.pnls.getNumberOfPanels();if(d==="eos"){this._enableLastSlideScrim();this.actionSource=this.ACTION_SOURCE.HISTORY;this.isEos=true}else{e=parseInt(d);this.isEos&&this._disableLastSlideScrim();this.isEos=false}this.pnls.setActiveByPosition(e)}if(this.actionSource!==this.ACTION_SOURCE.HISTORY)this.actionSource=this.ACTION_SOURCE.NONE});this.pnls.addChangeListener("success",function(d){if(this.actionSource===this.ACTION_SOURCE.BOOKMARK||this.actionSource===this.ACTION_SOURCE.HISTORY)this.actionSource=this.ACTION_SOURCE.NONE;else{d=b.hashPrefix+d._position;this.actionSource=this.ACTION_SOURCE.CONTROL;dojo.hash(d)}},this);this.pnls.addChangeListener("failure",function(d){if(this.actionSource!==this.ACTION_SOURCE.BOOKMARK&&d>this.pnls.getNumberOfPanels()){d=b.hashPrefix+"eos";this.actionSource=this.ACTION_SOURCE.CONTROL;dojo.hash(d)}},this);var a=dojo.hash();this.actionSource=this.ACTION_SOURCE.BOOKMARK;if(a===""||a==="articleTabs%3Dslideshow"){if(a==="articleTabs%3Dslideshow")this.isTabbedSlideshow=true;dojo.hash(b.hashPrefix.concat(1),true);this.omniturefirepixel()}else{a=a.split("/")[1];if(a==="eos"){a=this.pnls;var c=a._activePanelObserver;this.isEos=true;c.fireByName("failure",a.getNumberOfPanels()+1);this.pnls.setActiveByPosition(this.pnls.getNumberOfPanels())}else{a=parseInt(a);if(a!==this.pnls.getActive()._position)this.pnls.setActiveByPosition(a);else{this.actionSource=this.ACTION_SOURCE.NONE;this.omniturefirepixel()}}}}},_initLastSlideScrim:function(){},_initializeTools:function(){(new dj.module.articleTools.Button("email",function(){ET()},false)).init()},_enableLastSlideScrim:function(){var b=this.config;dojo.removeClass(b.lastSlideScrim.id,"hidden");dojo.removeClass(b.slideContainer,"theFirstSlide");dojo.addClass(b.slideContainer,"theLastSlide")},_disableLastSlideScrim:function(){var b=this.config;dojo.addClass(b.lastSlideScrim.id,"hidden");dojo.removeClass(b.slideContainer,"theLastSlide");dojo.addClass(b.slideContainer,"theFirstSlide")},_backToBeginning:function(){this._disableLastSlideScrim();this.pnls.setActiveByPosition(1);this.firstNavArrows.control.disableLastSlideScrim()},historyCall:function(b){this.pnls.setHistory=false;var a=b;if(b.length>1&&b.indexOf("last")>0){a=b.split("/")[1];this.pnls.setActiveByPosition(a);dojo.byId("lastSlideScrim").style.display="block"}else this.pnls.setActiveByPosition(a);this.pnls.setHistory=true},initExplore:function(){this.initExploreSlideshows();this.initializeExplore()},initExploreSlideshows:function(){this.exploreMore=dj.widget.panels.PanelsFactory.create("exploreMoreSlideshows",{core:{panelIncrement:5,panelGroup:".carouselContainer",panel:"ul.one li",enableLazyImages:true},carousel:{},rotator:{rotateTime:0}})},initializeExplore:function(){var b=this;dojo.addLiveEvent(".baseDocId","click",function(){b.baseDocId=this.id;b.openSlideshow()})},openSlideshow:function(){document.location.href=dj.context.core.urlPrefix+"/article/"+this.baseDocId+".html"},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){isBlogs=document.domain.indexOf("blogs")==-1?false:true;this.omniture={};this.omniture.saveVars=["pageName","section","subsection","aheadline","abasedocid","author","atype","csource","ctype","apage","basesection"];this.omniture.saveValues=[];if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;this.omniture.pixel.resetPixel();this.omnituresavepixel();var b=this.omniture.pixel.getMetaData("subsection");if(typeof b=="undefined"||b==""){b="US News";setMetaData("subsection",b)}setMetaData("qsymbol","slideshow");var a=this.omniture.pixel.getMetaData("aheadline");setMetaData("aheadline","WSJ_slideshow_"+b+"_"+a);if(!isBlogs){setMetaData("section","Multimedia");setMetaData("apage","WSJ_Multimedia_Slideshow");setMetaData("atype","WSJ_Multimedia_Slideshow");setMetaData("basesection","WSJ_Slideshow");this.isTabbedSlideshow?setMetaData("ctype","photos_tab"):setMetaData("ctype","photos")}setMetaData("csource","DJ Infographics");this.omniture.pixel.getMetaData("atype");b=this.pnls.getActivePanel()+1;setMetaData("pageName","WSJ_Infogrfx Slide Show Redesigned_"+a+"_"+b+"_of_"+this.panelsCount);this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}};dojo.provide("dj.widget.article.flash.ArticleFlash");dojo.require("dj.util.History");dojo.require("dj.widget.flash.Flash");dojo.require("dj.widget.flash.IssuuFlash");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.flash.template");dojo.require("dj.widget.panels.virtual.Carousel");(function(){var b=dj.widget.article.flash;dojo.declare("dj.widget.article.flash.ArticleTabFlash",null,{constructor:function(a,c){this.parent=dojo.byId(a);this.id=a;this.tabModule=c;this.omniture={};this.omniture.ctype="flash";this.supportAjaxLoading=true;var d=this;c.observePanels(function(e,f){if(c.hasPanel(e))if(e==d.tabName)d.play();else if(f==d.tabName){dj.util.History.get("project")&&dj.util.History.set("project","",false);dj.util.History.get("s")&&dj.util.History.set("s","",false)}})},clear:function(a){if(a)a.so=null;for(;this.parent.firstChild;)this.parent.removeChild(this.parent.firstChild);this.player=null},makeid:function(a,c){if(a&&c)return a+"|"+c;if(a)return a},redraw:function(a){this.clear(this.flash);this.flash=a;this.supportAjaxLoading&&dojo.getObject("dj.util.flash.template",true).scan?this.createIframeOrFlash(a.p,a.s):this.flash.load(a.p,a.s)},createIframeOrFlash:function(a,c){var d;d=this.id.search(/interactive/i)!=-1?"interactive":this.id.search(/slideshow/i)!=-1?"slideshow":"";var e=dj.context.articleFlash.outputFilterFlashUrl,f=dj.context.articleFlash.outputFilterCacheable;if(e===undefined||e==="")e=f?"/public/page/0_0_W0_OutputFilter_DataTag_Flash_Cacheable":"/public/npage/0_0_W0_OutputFilter_DataTag_Flash.html";d=f?e+"-"+a+"-"+c+"-"+d+".html":e+"?flashProject="+a+"&alternateText="+c+"&slug="+d;var g=dojo.byId(this.id);dojo.xhrGet({url:d,handleAs:"text",load:function(h){g.innerHTML=h;dj.util.flash.template.scan()},error:function(){}})},register:function(a,c){if(!this.flashes)this.flashes={};var d={};d=this.newflash(this.id,a,c,true);d.swfPrefix=this.swfPrefix;this.flashes[this.makeid(a,c)]=d},setdefault:function(a,c){this.flash=this.findflashbyids(a,c);if(!this.flash){this.flash=this.newflash(this.id,a,c,true);this.flash.swfPrefix=this.swfPrefix;this.flashes[this.makeid(a,c)]=this.flash}},findflashbyids:function(a,c){if(!this.flashes)this.flashes={};var d=this.makeid(a,c);return this.flashes[d]?this.flashes[d]:null},playbyid:function(a,c){this.p=a;this.s=c;if(this.flash=this.findflashbyids(this.p,this.s)){this.redraw(this.flash);return true}else return false},playdefault:function(){if(this.flashes){if(!this.flash)for(var a in this.flashes)if(this.flashes.hasOwnProperty(a)){if(this.flashes[a])this.flash=this.flashes[a];break}this.redraw(this.flash)}},play:function(){var a=dojo.query("div.articleHeadlineBox");if(a&&a[0]){a=dojo.position(a[0],true).y;var c=dojo.getViewport().t;a<c&&window.scrollTo(0,a)}if(this.flash)this.playdefault();else{a=dj.util.History.get("project");c=dj.util.History.get("s");if(!c||!this.playbyid(a,c))this.playdefault()}this.reloadads()},reloadads:function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.ads&&this.ads.loadAds(this.tabName)},tabplay:function(a,c){this.setdefault(a,c);dj.util.History.set("project",a,false);c&&dj.util.History.set("s",c,false);this.tabModule.setActivePanel(this.tabName)},playbookmark:function(){this.tabModule.getActivePanel()==this.tabName&&this.play()},newflash:function(a,c,d,e){return new dj.widget.flash.Flash(a,c,d,{noload:e},this.tabName)}});dojo.declare("dj.widget.article.flash.ArticleFlashSlideshow",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="slideshow";this.omniture.ctype="slideshow_tab"},newflash:function(a,c,d,e){return new dj.widget.flash.SlideshowFlash(a,c,d,{noload:e})}});dojo.declare("dj.widget.article.flash.ArticleFlashInteractive",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="interactive";this.omniture.ctype="interactives_tab"}});dojo.declare("dj.widget.article.flash.ArticleFlashDocument",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="document";this.omniture.ctype="documents_tab";this.supportAjaxLoading=false},newflash:function(a,c,d,e){return new dj.widget.flash.IssuuFlash(a,c,d,{noload:e})}});dojo.declare("dj.widget.article.flash.ArticleFlashMap",dj.widget.article.flash.ArticleTabFlash,{constructor:function(){this.swfPrefix="info-";this.tabName="map";this.omniture.ctype="maps_tab"}})})();dojo.provide("dj.module.article.articleKeywordBased");dojo.require("dj.util.referal");dj.module.article.articleKeywordBased={init:function(b){try{var a=dj.util.referal.getString();defaultArgs={moduleType:"",moduleURL:""};dojo.mixin(defaultArgs,b);if(typeof defaultArgs.moduleType!="undefined"&&defaultArgs.moduleType!=""&&defaultArgs.URL!=""&&typeof a!="undefined"&&a.query!=""){var c=dojo.byId(defaultArgs.moduleType);!(dojo.hasClass(c,"hidden")&&(c.style.display=="none"||c.style.display==""))&&this.getText(c,a,defaultArgs.moduleType,defaultArgs.moduleURL)}}catch(d){console.log("Displaying the Keywordbased Content");console.log(d)}},getText:function(b,a,c,d){coUrl=d+a.query+"-"+c+".html";dj.lang.xhrGet({url:coUrl,preventCache:true,handleAs:"text",load:function(e){b.innerHTML=e;console.log(" load response")},error:function(){console.log("error response");b.innerHTML=""}})}};dojo.provide("dj.widget.article.video.ArticleVideo");dojo.require("dj.module.articleTabs");dojo.require("dj.util.History");(function(){var b=dj.widget.article.video;(b.ArticleTabVideo=function(a,c){this.tabModule=a;this.tabPlayObserver=c;this.tabName="video";if(a){var d=this;a.observePanels(function(e,f){if(a.hasPanel(e))if(e==d.tabName)d.play();else if(f==d.tabName){d.player&&d.player.setBookMark();dj.util.History.get("video")&&dj.util.History.set("video","",false)}})}this.tabPlayObserver&&this.tabPlayObserver.subscribe(dojo.hitch(this,"tabplay"))}).prototype={guidconfig:{videoPlayerDivId:"videoPlayer",videoSummaryDivId:"videoSummary",registeredVideosDivId:"videoRelated",advertisementDivId:"videoAd",sideNavUlId:"videoSideNav",videoResultsDivId:"videoSearchResults",searchDivId:"videoSearchForm"},register:function(a){if(this.isguid(a)){if(!this.guidvideos)this.guidvideos=[];this.guidvideos.push(a)}},setdefault:function(a){this.defaultvid=a},playbyid:function(a){if(a&&this.isguid(a)){this.player.loadVideo(a,"articlePage");return true}else return false},playdefault:function(){if(this.defaultvid){this.isguid(this.defaultvid)?this.player.loadVideo(this.defaultvid,"articlePage"):this.player.loadVideo("","articlePage");this.defaultvid=null}else this.player.loadVideo("","articlePage")},play:function(){if(!this.player){this.player=new dj.widget.video.video(this.guidconfig,"dj.module.articleVideoPlayer.player");if(this.guidvideos)for(var a=this.guidvideos.length,c=0;c<a;c++)this.player.registerVideo(this.guidvideos[c])}(a=dj.util.History.get("video"))?this.playbyid(a):this.playdefault();if((a=dojo.query("div.articleHeadlineBox"))&&a[0]){a=dojo.position(a[0],true).y;c=dojo.getViewport().t;a<c&&window.scrollTo(0,a)}},tabplay:function(a){this.setdefault(a);dj.util.History.set("video",a);this.tabModule.setActivePanel("video")},playbookmark:function(){this.tabModule.getActivePanel()=="video"&&this.play()},popupvideo:function(){this.player.openPopUpPlayer()},isguid:function(a){a=""+a;if(a.substring(0,1)!="{")a="{"+a;return a.substring(0,1)=="{"&&a.substring(9,10)=="-"&&a.substring(14,15)=="-"&&a.substring(19,20)=="-"?true:false}}})();dojo.provide("dj.widget.article.comments.ArticleComments");dojo.require("dj.widget.ad.AdManager");dojo.require("dj.util.Tracking");dojo.require("dj.module.comments.comments");dojo.require("dj.module.fbLikeButton");dojo.declare("dj.widget.article.comments.ArticleComments",null,{constructor:function(b){this.tabModule=b;this.tabName="comments";this.omniture={};this.omniture.saveVars=["pageName","section","aheadline","atype","abasedocid","csource","apage","caccess","basesection","author"];this.omniture.saveValues=[];this.omniture.ctype="comments_tab";this.omniture.section="Community";this.omniture.abasedocid="";this.omniture.aheadline="";this.omniture.author="";this.omniture.pageNameSuffix="_comments";this.callWhenCommentsActive(b)},callWhenCommentsActive:function(b){var a=false;b.addChangeListener("success",function(c){a=this.play(a,c.getId())},this);a=this.play(a,b.getActive().getId())},play:function(b,a){if(this.tabName!==a)return b||false;this.loadAd();this.omniturefirepixel(true);b||dj.module.comments.showCommentsOnCommentTab();return true},loadAd:function(){if(!this.ads)this.ads=dj.widget.ad.AdManager;this.ads.loadAds(this.tabName)},tabplay:function(){},playbookmark:function(){this.tabModule.getActivePanel()==this.tabName&&this.play(true)},omnituresavepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.saveValues[a]=this.omniture.pixel.getMetaData(this.omniture.saveVars[a])},omniturerestorepixel:function(){for(var b=this.omniture.saveVars.length,a=0;a<b;a++)this.omniture.pixel.setMetaData(this.omniture.saveVars[a],this.omniture.saveValues[a])},omniturefirepixel:function(){if(!this.omniture.pixel)this.omniture.pixel=dj.util.Tracking.omniture;var b=this.omniture.pixel.getMetaData("pageName");if(b.indexOf("FreeRegScrimForm")==-1){this.omniture.pixel.resetPixel();this.omnituresavepixel();if(b.indexOf("Flash Interactive")!=-1){this.omniture.ctype="comments_tab_interactives";s.prop21="";s.prop8="DJ Infographics"}this.omniture.pixel.setMetaData("ctype",this.omniture.ctype);this.omniture.pixel.setMetaData("section","Community");this.omniture.pixel.setMetaData("aheadline",this.omniture.aheadline);this.omniture.pixel.setMetaData("abasedocid",this.omniture.abasedocid);this.omniture.pixel.setMetaData("author",this.omniture.author);this.omniture.pixel.setMetaData("pageName",b+this.omniture.pageNameSuffix);if(b.indexOf("WSJ PDF Document")!==-1||b.indexOf("WSJ_PDF_")!==-1){this.omniture.pixel.setMetaData("apage","WSJ_Community_PDFs");this.omniture.pixel.setMetaData("atype","WSJ_Community_PDFs");this.omniture.pixel.setMetaData("aheadline","WSJ_pdf_"+s.prop4);this.omniture.pixel.setMetaData("csource","DJ PDFs");this.omniture.pixel.setMetaData("caccess","free");this.omniture.pixel.setMetaData("author","");this.omniture.pixel.setMetaData("abasedocid","pdf_"+this.omniture.abasedocid);s.prop2=="WSJ_Infographic"&&this.omniture.pixel.setMetaData("basesection","WSJ_PDFs")}this.omniture.pixel.firePixel(true);this.omniturerestorepixel()}}});dojo.provide("dj.module.article.bluegrassUtil");
var _userOffset = new Date().getTimezoneOffset() / 60;
if(!BlueGrass) {
  BlueGrass = {};
}
BlueGrass.Utility = {
            arrayRemove: function(array, from, to) {
                // Array Remove - By John Resig (MIT Licensed)
                var rest = array.slice((to || from) + 1 || array.length);
                array.length = from < 0 ? array.length + from : from;
                return array.push.apply(array, rest);
                // End Array Remove

            },
            convertToExchangeTime: function(utcDateString, offset) {
                if (offset && offset !== 0) {
                    offset = offset + _userOffset;
                } else {
                    offset = 0; }
                var converted = parseInt(utcDateString, 10);
                if (isNaN(converted)) {
                    if (utcDateString.indexOf("-") >= 0 || utcDateString.indexOf("+") >= 0) {
                        utcDateString = utcDateString.substring(6, utcDateString.length - 7);
                        
                    } else {
                        utcDateString = utcDateString.substring(6, utcDateString.length - 2);
                    }
                    converted = parseInt(utcDateString, 10);
                }
                converted += 3600000 * offset;
                var dateTime = new Date(converted);
                return dateTime;
            },
            prettyDate: function(date, offset) {
                if (typeof (date) != "object")
                    { date = this.convertToExchangeTime(date, offset); }
                /*
                * Javascript Humane Dates
                * Copyright (c) 2008 Dean Landolt (deanlandolt.com)
                * Re-write by Zach Leatherman (zachleat.com)
                * 
                * Adopted from the John Resig's pretty.js
                * at http://ejohn.org/blog/javascript-pretty-date
                * and henrah's proposed modification 
                * at http://ejohn.org/blog/javascript-pretty-date/#comment-297458
                * 
                * Licensed under the MIT license.
                */

                //i modified the below script - it no longer adjusts based on timezone and
                //it just uses the date above instead of expecting a microformats formatted
                //date that it then create a date object with.
                var time_formats = [
                  [60, 'Just Now'],
                  [90, '1 Minute'], // 60*1.5
                  [3600, 'Minutes', 60], // 60*60, 60
                  [5400, '1 Hour'], // 60*60*1.5
                  [86400, 'Hours', 3600], // 60*60*24, 60*60
                  [129600, '1 Day'], // 60*60*24*1.5
                  [604800, 'Days', 86400], // 60*60*24*7, 60*60*24
                  [907200, '1 Week'], // 60*60*24*7*1.5
                  [2628000, 'Weeks', 604800], // 60*60*24*(365/12), 60*60*24*7
                  [3942000, '1 Month'], // 60*60*24*(365/12)*1.5
                  [31536000, 'Months', 2628000], // 60*60*24*365, 60*60*24*(365/12)
                  [47304000, '1 Year'], // 60*60*24*365*1.5
                  [3153600000, 'Years', 31536000], // 60*60*24*365*100, 60*60*24*365
                  [4730400000, '1 Century'] // 60*60*24*365*100*1.5
                ];

                var dt = new Date(),
                  seconds = (dt - date) / 1000,
                  token = ' Ago',
                  i = 0,
                  format;

                if (seconds < 0) {
                    seconds = Math.abs(seconds);
                    token = '';
                }

                while (format = time_formats[i++]) {
                    if (seconds < format[0]) {
                        if (format.length == 2) {
                            return format[1] + (i > 1 ? token : ''); // Conditional so we don't return Just Now Ago
                        } else {
                            return Math.round(seconds / format[2]) + ' ' + format[1] + (i > 1 ? token : '');
                        }
                    }
                }

                // overflow for centuries
                if (seconds > 4730400000)
                     { return Math.round(seconds / 4730400000) + ' Centuries' + token; }

                return date_str;
            }
        };
dojo.provide("dj.module.article.chart");
dojo.require("dj.module.marketdata.thunderball");
dojo.require("dj.module.marketdata.marketwatch");
dojo.require("dj.module.article.bluegrassUtil");

var _PrevClose = 0; //Previous Close value for the index
var _isDEEdition = false;

var WSJIndexChartStyle = {
  background : "#ffffff",
  border : "#E6E2D7",
  closelineStyle : "#e36825",
  horizontalGridLineStyle : "#f4f3f1",
  highIndicatorStyle : "#093c71",
  highlowLineStyle : "#015190",
  lowIndicatorStyle : "#093c71",
  mainLineStyle : "#557BA0",
  mainPriceLineFill : "rgba(85,123,160,0.15)",
  mainPriceLineWidth : 1,
  maxPriceLines : 4,
  verticalGridLineStyle : "rgba(180,201,202,0.5)",
  verticalGridLineStyle_Opaque : "rgba(180,201,202,1.0)",
  vPadding : 12,
  YAxisLabelStyle : 1, //High Low Price Close = 1
  YAxisLabelHeight : 12,
  showDecimals : 1,
  regionStyles : {
    0 : '#cde2e0', // Premarket
    1 : '#cde2e0', //Postmarket
    2 : 'rgba(51,51,51,0.06)'//Intersession
  },
  comparelineStyles : {
    0 : '#cc3333', //Strong red:
    1 : '#3b8dad', //Strong blue:
    2 : '#c9932e', //Strong yellow
    3 : '#b78383', //Weak red:
    4 : '#8eb3bc', //Weak blue:
    5 : '#dbb782' //Weak yellow:
  }
};

function LegacyChart(container, legacyQueryString, width, height) {
  //var _chartBox = $(container);
  var _chartBox = dojo.byId(container);
  var _legacyQueryString = legacyQueryString;
  var _width = width;
  var _height = height;
  var _currentsymbol = null;

  var start = legacyQueryString.indexOf("symb=") + 5;
  var end = legacyQueryString.indexOf("&", start);
  if (end == -1) {
    _currentsymbol = legacyQueryString.substr(start).toUpperCase();
  } else {
    _currentsymbol = legacyQueryString.substr(start, end - start).toUpperCase();
  }

  var _showChart = function() {
    //_chartBox.html("");
    _chartBox.innerHTML = "";

    _djl.place('<img src="//www.marketwatch.com/charts/big.chart' + _legacyQueryString + '" />', _chartBox);
    //$('<img src="//www.marketwatch.com/charts/big.chart' + _legacyQueryString + '" />').appendTo(_chartBox).get(0);
    //_chartBox.innerHTML = "<img src=\"www.marketwatch.com/charts/big.chart\"" + _legacyQueryString + "\" />\"";
  };

  return {
    ShowChart : function(symbol) {
      if (symbol !== null && symbol != undefined && _currentsymbol != symbol.toUpperCase()) {
        _currentsymbol = symbol.toUpperCase();

        _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=");

        if (_currentsymbol.indexOf("US:CRUDE OIL - ELECTRONIC") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=");
          if (_legacyQueryString.indexOf("sid=") > -1) {
            _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=3343724");
          } else {
            _legacyQueryString = _legacyQueryString + "&sid=3343724";
          }
        } else if (_currentsymbol.indexOf("US:FUTURE-US-GOLD") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=");
          if (_legacyQueryString.indexOf("sid=") > -1) {
            _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=1782661");
          } else {
            _legacyQueryString = _legacyQueryString + "&sid=1782661";
          }
        } else if (_currentsymbol.indexOf("DX:DAX") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=");
          if (_legacyQueryString.indexOf("sid=") > -1) {
            _legacyQueryString = _legacyQueryString.replace(/sid=[^&^\n]*/i, "sid=125284");
          } else {
            _legacyQueryString = _legacyQueryString + "&sid=125284";
          }
        } else {
          _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=" + _currentsymbol);
        }
      }

      _showChart();
    },
    TickSubscribe : function() {
    },
    UpdateAllCharts : function(time, freq, startdate, enddate) {
      this.UpdateChart(time, freq, startdate, enddate);
    },
    UpdateChart : function(time, freq, startdate, enddate) {
      _legacyQueryString = _legacyQueryString.replace(/freq=[^&^\n]*/i, "freq=" + freq);

      if (time === null || time == undefined) {
        _legacyQueryString = _legacyQueryString.replace(/time=[^&^\n]*/i, "time=");
      } else {
        _legacyQueryString = _legacyQueryString.replace(/time=[^&^\n]*/i, "time=" + time);
      }

      if (startdate === null || startdate == undefined) {
        _legacyQueryString = _legacyQueryString.replace(/startdate=[^&^\n]*/i, "startdate=");
      } else {
        if (_legacyQueryString.indexOf("startdate=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/startdate=[^&^\n]*/i, "startdate=" + startdate);
        } else {
          _legacyQueryString = _legacyQueryString + "&startdate=" + startdate;
        }
      }

      if (enddate === null || enddate != undefined) {
        _legacyQueryString = _legacyQueryString.replace(/enddate=[^&^\n]*/i, "enddate=");
      } else {
        if (_legacyQueryString.indexOf("enddate=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/enddate=[^&^\n]*/i, "enddate=" + enddate);
        } else {
          _legacyQueryString = _legacyQueryString + "&enddate=" + enddate;
        }
      }

      _showChart();
    },
    ChangeSymbol : function(symbol) {
      var symbols = symbol.toUpperCase().split('|');

      _currentsymbol = symbols[0];
      _legacyQueryString = _legacyQueryString.replace(/symb=[^&^\n]*/i, "symb=" + _currentsymbol);

      if (symbols.length > 1) {
        if (_legacyQueryString.indexOf("compidx=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/compidx=[^&^\n]*/i, "compidx=" + symbols[1]);
        } else {
          _legacyQueryString = _legacyQueryString + "&compidx=" + symbols[1];
        }
      } else {
        _legacyQueryString = _legacyQueryString.replace(/compidx=[^&^\n]*/i, "compidx=");
      }

      if (symbols.length > 2) {
        var comp = "";
        for ( var i = 2; i < symbols.length; i++) {
          if (comp.length > 0) {
            comp = comp + ",";
          }
          comp = comp + symbols[i];
        }
        if (_legacyQueryString.indexOf("comp=") > -1) {
          _legacyQueryString = _legacyQueryString.replace(/comp=[^&^\n]*/i, "comp=" + comp);
        } else {
          _legacyQueryString = _legacyQueryString + "&comp=" + comp;
        }
      } else {
        _legacyQueryString = _legacyQueryString.replace(/comp=[^&^\n]*/i, "comp=");
      }

      _showChart();
    },
    SetChartRefresh : function(rate) {
      setInterval(_showChart, rate);
    }
  }
}

//new method to take care of the Previous Close for various time (chart ranges)
function EmbeddedChartMDM(container, style, width, height, time, freq, startdate, enddate, chartdata, symbol, prevClose, isDEEdition) {
  _PrevClose = 0; //default value
  _PrevClose = prevClose;
  _isDEEdition = false; //default value
  _isDEEdition = isDEEdition;
  return new EmbeddedChart(container, style, width, height, time, freq, startdate, enddate, chartdata, symbol);
}

function EmbeddedChart(container, style, width, height, time, freq, startdate, enddate, chartdata, symbol) {
  var _chartBox = document.getElementById(container);
  var _style = style;
  var _width = width;
  var _height = height;
  var _time = time;
  var _freq = freq;
  var _startdate = startdate;
  var _enddate = enddate;
  var _pagedata = null;
  var _currentsymbol = null;
  var _firstsymbol = symbol;
  var _symbolCount = 0;
  var _chart = null;
  var _tick = false;
  var _ticktimeout = null;
  var _currentchannel = null;
  var _connection = null;
  var _url = "/Market/ECProxy/ChartData";

  var _setPageData = function(data) {
    if (data !== null && data != undefined && data.length > 0) {
      if (_pagedata === null) {
        _pagedata = [];
      }
      for ( var i = 0; i < data.length; i++) {
        if (data[i].Value !== null && data[i].Value != undefined && data[i].Key != '') {
          _pagedata[data[i].Key] = data[i].Value;
          if (_pagedata[data[i].Key].Data !== null) {
            for ( var j = 0; j < _pagedata[data[i].Key].Data.length; j++) {
              for ( var k = 0; k < _pagedata[data[i].Key].Data[j].Value.Sessions.length; k++) {
                var session = _pagedata[data[i].Key].Data[j].Value.Sessions[k];
                session.Start = new Date(Thunderball.Utilities.FormatDate(session.Start));
                session.Stop = new Date(Thunderball.Utilities.FormatDate(session.Stop));
              }
            }
          }
        }
      }
    }
  };

  var _showChart = function(symbol) {
    if (_pagedata === null) {
      _chart = new JSChart(_chartBox, symbol.split('|'), _width, _height, _style, _freq, _time, _startdate, _enddate,
          undefined, MarketWatch.getBaseUrl() + _url);
      _currentsymbol = symbol;
    } else {
      if (symbol != _currentsymbol) {
        if (_chart !== null) {
          _pagedata[_currentsymbol] = _chart.data;
          _chart.data = null;
          _chart = null;
        }
        var symbols = symbol.split('|');
        _chart = new JSChart(_chartBox, symbols, _width, _height, _style, _freq, _time, _startdate, _enddate,
            _pagedata[symbol], MarketWatch.getBaseUrl() + _url);
        _currentsymbol = symbol;
        _symbolCount = symbols.length;
      }
    }
  };

  _setPageData(chartdata);

  var _refreshPageData = function() {
    var symbols = [];
    for ( var symbol in _pagedata) {
      symbols.push(symbol);
    }
    _refreshData(symbols, "mo");
  };

  var _refreshData = function(symbols, cachekey) {
    requestObject = {
      freq : _freq,
      time : _time,
      Symbol : symbols,
      StartDate : _startdate,
      EndDate : _enddate,
      Width : _width,
      Height : _height,
      CacheKey : cachekey
    };

    _djl.rawXhrPost( {
      url : MarketWatch.getBaseUrl() + _url,
      postData : requestObject,
      handleAs : "json",
      load : function(response, ioArgs) {
        if (response !== null) {
          _setPageData(response);
          response = null;
          if (_chart !== null) {
            _chart.data = _pagedata[_currentsymbol];
            _chart._didLoad();
          }
        }

        return response;
      }
    });
    /*
     * $.ajax({ type: "POST", url: MarketWatch.getBaseUrl() + _url, dataType: "json", data: requestObject, success:
     * function(data) { if (data !== null) { _setPageData(data); data = null; if (_chart !== null) { _chart.data =
     * _pagedata[_currentsymbol]; _chart._didLoad(); } } } });
     */
    requestObject = null;
  };

  var _reloadChart = function() {
    if (_chart !== null) {
      _chart.time = _time;
      _chart.freq = _freq;
      _chart.startDate = _startdate;
      _chart.endDate = _enddate;
      _chart.reload();
    }
  }

  return {
    ShowChart : function(symbol) {
      if (symbol === undefined) {
        symbol = _firstsymbol;
      }

      symbol = symbol.toUpperCase();

      if (symbol != _currentsymbol) {
        if (_pagedata[symbol] !== null && _pagedata[symbol] !== undefined) {
          _showChart(symbol);
          return true;
        } else {
          return false;
        }
      }
    },
    
    TickUpdate : function(symbol, message) {
      if (_chart !== null && _chart.data !== null && _symbolCount == 1) {
        for ( var symbol in _pagedata) {
          for ( var i = 0; i < _pagedata[symbol].Data.length; i++) {
            if (_pagedata[symbol].Data[i].Value.BlueGrassChannel !== null
                && _pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase() == message.h.t) {
              if (symbol.toUpperCase() === _currentsymbol.toUpperCase()) {
                _chart.addTick(symbol, message.b.z, message.b.l, message.b.e);
              }
              break;
            }
          }
        }
      }
    },
    
    TickSubscribe : function() {
      if (_chart !== null) {
        _tick = true;

        var chartSubscribeCallback = function(message) {
          if (_chart !== null && _chart.data !== null && _symbolCount == 1) {
            for ( var symbol in _pagedata) {
              for ( var i = 0; i < _pagedata[symbol].Data.length; i++) {
                if (_pagedata[symbol].Data[i].Value.BlueGrassChannel !== null
                    && _pagedata[symbol].Data[i].Value.BlueGrassChannel.toLowerCase() == message.h.t) {
                  if (symbol.toUpperCase() === _currentsymbol.toUpperCase()) {
                    _chart.addTick(symbol, message.b.z, message.b.l, message.b.e);
                  }
                  break;
                }
              }
            }
          }
        };

        var chartConnectionCallback = function(connection, type) {
          if (type == "connect") {
            _connection = connection;
            if (_pagedata[_currentsymbol] !== null) {
              _currentchannel = _connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,
                  chartSubscribeCallback);
            }
          }
        };

        if (_currentchannel !== null) {
          _currentchannel.removeCallback(chartSubscribeCallback);
        }

        if (_connection !== null) {
          if (_pagedata[_currentsymbol] !== null) {
            _currentchannel = _connection.subscribe(_pagedata[_currentsymbol].Data[0].Value.BlueGrassChannel,
                chartSubscribeCallback);
          }
        } else {
          if (BlueGrass !== null && BlueGrass.Runtime !== null) {
            BlueGrass.Runtime.openConnection( {}, chartConnectionCallback);
          }
        }
      }
    },
    UpdateAllCharts : function(time, freq, startdate, enddate) {
      if (_chart !== null) {
        this.UpdateChart(time, freq, startdate, enddate);
        setTimeout(_refreshPageData, 5);
      }
    },
    UpdateChart : function(time, freq, startdate, enddate) {
      if (_chart !== null) {
        _time = time;
        _freq = freq;
        _startdate = startdate;
        _enddate = enddate;

        _reloadChart();
      }
    },
    ChangeSymbol : function(symbol) {
      //symbol needs country code otherwise symbols like UK:VOD and US:VOD will be mixed up.
    if (_chart !== null) {
      _currentsymbol = symbol;
      _chart.setSymbols(symbol.split('|'));
      _symbolCount = _chart.symbols.length;
      _reloadChart();
    }
  },
  SetChartRefresh : function(rate) {
    setInterval(_refreshPageData, rate);
  }
  }
}

var JSChart = function(targetSelector, symbols, width, height, style, freq, time, startDate, endDate, data, url) {

  this.targetSelector = targetSelector;

  if (style === undefined) {
    this.style = LargeChartStyle;
  } else {
    this.style = style;
  }
  if (url !== undefined) {
    this.url = url;
  }

  this.width = width;
  this.height = height;

  this.symbols = symbols;
  this.selectedSymbol = symbols[0];

  if (freq === undefined) {
    this.freq = "1mi";
  } else {
    this.freq = freq;
  }

  if (time === undefined) {
    this.time = "1dy";
  } else {
    this.time = time;
  }

  if (startDate !== undefined) {
    this.startDate = startDate;
  }

  if (endDate !== undefined) {
    this.endDate = endDate;
  }

  var self = this;

  if (data === undefined) {
    $(function() {
      self.reload();
    });
  } else {
    self.preload(data);
  }
};

JSChart.prototype = {
  freq : "1mi",
  time : "1dy",
  unit : "Minute",
  url : "./HistoricChartData.aspx",
  span : 1,
  step : 1,
  startDate : '',
  endDate : '',
  data : null,
  selectedSymbol : null,
  width : 0,
  height : 0,
  drawingContext : null,
  style : null,
  highPrice : null,
  highPoint : {
    "x" : null,
    "y" : null
  },
  lowPoint : {
    "x" : null,
    "y" : null
  },
  lowPrice : null,
  lastPoint : {
    "x" : null,
    "y" : null
  },
  lastPrice : null,
  closePrice : null,

  buildRequest : function() {

    var requestObject;

    var symbol = "";
    for ( var i = 0; i < this.symbols.length; i++) {
      if (i > 0) {
        symbol += "|";
      }
      symbol += this.symbols[i];
    }

    requestObject = {
      freq : this.freq,
      time : this.time,
      Symbol : symbol,
      StartDate : this.startDate,
      EndDate : this.endDate,
      Width : this.width
    };

    return requestObject;
  },

  lastTickPrice : 0,
  lastTickChange : 0,
  lastTickX : 0,

  addTick : function(tickSymbol, Timestamp, Price, offSet) {
    var where = Thunderball.Utilities.addTick(this.data, tickSymbol, Timestamp, Price, offSet);

    if (where.Historical == false) {

      if (where.x === null) {
        // this.reload();
        return;
      } else {
        if (Price != this.lastTickPrice) {
          this.lastTickChange = Price - this.lastTickPrice;
          this.lastTickPrice = Price;
        } else if (where.x == this.lastTickX) {
          // same price, same x - don't redraw                
          return;
        }

        this.lastTickX = where.x;
        this._didLoad();
      }
    }
  },

  setSymbols : function(symbols) {
    this.symbols = symbols;

    this.selectedSymbol = symbols[0];
  },

  reload : function() {
    this._resetState();
    var d = new Date();
    var requestId = this.symbols[0] + d.getTime();

    this.requestId = requestId;

    Thunderball.Utilities.Requesters.push(this);
    Thunderball.Utilities.GetData(this);
  },

  preload : function(data) {
    this._resetState();
    this.data = data;
    this._didLoad();
  },

  _resetState : function() {
    this.lastTickPrice = this.lastTickChange = this.lastTickX = 0;
  },

  /* This method does DOM manipulation, so care is needed under IE */
  redraw : function() {

    this._prepareCanvas();
    this._clearLabels();

    var ctx = this.drawingContext;

    ctx.clearRect(0, 0, this.width, this.height);

    ctx.save();

    this._drawChartBackground();
    //this._debugTiming("drawChartBackground");

    var Data = Thunderball.Utilities._getSessionByTicker(this.data, this.selectedSymbol);

    if (Data !== null) {
      //this._debugTiming("init");
      for ( var i = 0; i < Data.length; i++) {
        this._drawRegions(Data[i]);
      }
      //this._debugTiming("drawRegions");
      if (this.style.type == 'Spark') {
        this._drawSpark(Data[Data.length - 1]);
      } else {
        this._determineTypeOfChart(Data);

        this._setHLC(Data);
        //this._debugTiming("setHLC");

        this._fillTrades(Data);
        //this._debugTiming("fillTrades");

        this._drawPriceLines();
        //this._debugTiming("drawPriceLines");

        this._createYAxisLabels(this.symbols.length);
        //this._debugTiming("createYAxisLabels");

        Thunderball.Utilities.addXAxisLabels(this);
        //this._debugTiming("addXaxisLabels");

        Thunderball.Utilities.drawXaxisLines(this);
        //this._debugTiming("drawXaxisLines");

        //this._strokeFillTrades(Data, this.style.mainLineStyle);
        //this._debugTiming("strokeFillTrades");

        this._drawCloseLines(Data);
        //this._debugTiming("drawCloseLines");

        var st = this.style;
        if (this.highPoint.y != this.lowPoint.y) {
          this._priceIndicator(this.highPoint, "", st.highIndicatorStyle, "chartPointer chartPoint-high", false);
          this._priceIndicator(this.lowPoint, "", st.lowIndicatorStyle, "chartPointer chartPoint-low", false);
        }

        this._priceIndicator(this.lastPoint, "", "", "lastLbl", true);
        //this._debugTiming("priceIndicator");

        if (this.symbols.length > 1) { //Do compare chart
          for ( var j = 1; j < this.symbols.length; j++) {

            var Session = Thunderball.Utilities._getSessionByTicker(this.data, this.symbols[j]);

            if (Session !== null) {
              //this._setSession(Session);
              var compareColor = 'black';
              if (j <= 6) {
                compareColor = this.style.comparelineStyles[j - 1];
              }
              this._strokeTrades(Session, compareColor);
            }
          }
        }

        this._strokeTrades(Data, this.style.mainLineStyle);
        //this._debugTiming("strokeTrades");

        //this._drawNewsOverlay(Data);                

        this._drawChartBorder();
        //this._debugTiming("drawChartBorder");

        if (this.highPoint.y != this.lowPoint.y) {
          this._drawHorizontalLine(this.highPoint.y);
          this._drawHorizontalLine(this.lowPoint.y);
          //this._debugTiming("drawHorizontalLine");
        }

        this.startTime = this.overallStartTime;

        //if (Data.length >= 1) {
        //this._debugTiming("Total (" + Data[0].Trades.length + " trades)");
        //}

      }
    }

    ctx.restore();
  },

  _x : 0,
  _xscale : 0,
  _y : 0,
  _yscale : 0,
  _bump : false,
  _fillStyle : 'black',
  _padding : 0,
  _events : [],
  _barFactor : 0,
  _barSize : 1,
  _priceLines : [],
  _timeLines : [],
  _opaqueTimeLines : [],
  _historical : false,
  _customDateRange : false,
  _chartUnit : 1,
  _displayUnit : 1,
  _xAxisLabels : [],

  _findOpaqueGridLines : function(time) {
    var xAxisInfo = this._xAxisLabels;
    var timeLines = this._timeLines;
    var data = this.data;
    var opaqueTimeLines = [];
    this._opaqueTimeLines = [];
    if (this._displayUnit === 1 || this._displayUnit === 2) {
      //if the label is a day label, we want the line to be opaque
      if(_isDEEdition){
        this._convertGridLinesForGermany(xAxisInfo, time, opaqueTimeLines);
      } else {
        for ( var i = 0; i < xAxisInfo.length; i++) {
            var patt = /^M$|^T$|^W$|^F$|^S$/;
            if (xAxisInfo[i].element.match(patt)) {
              opaqueTimeLines.push(xAxisInfo[i].x);
          }
      }
      }
    } else {
      for ( var i = 0; i < xAxisInfo.length; i++) {
        //if the label is a year label (when the label type is months), we want
        //the line to be opaque
        var patt = /^\d{2}$/;
        if (xAxisInfo[i].element.match(patt) && xAxisInfo[i].x !== (.5 * timeLines[0])) {
          opaqueTimeLines.push(xAxisInfo[i].x);
        }
      }
    }
    if (opaqueTimeLines.length > 0) {
      for ( var i = 0; i < opaqueTimeLines.length; i++) {
        this._opaqueTimeLines.push(opaqueTimeLines[i]);
      }
    }
  },

  _convertGridLinesForGermany : function(xAxisInfo, time, opaqueTimeLines) {
    var patt = /^M$|^T$|^W$|^F$|^S$/; //US week pattern
    var pattDE = /^M$|^D$|^F$|^S$/; //Germany week pattern
    if(time.toString()=="1dy"){ //charts for 1 day
      var xElement = "";
      var length = xAxisInfo.length; 
      for ( var i = 0; i < length; i++) {
        xElement = xAxisInfo[i];
        if(xElement!=undefined){
        //this case is usually for Forex and for some Future indexes
        if (length==1 && (xElement.element.match(patt) || xElement.element.match(pattDE))){
          this._convertGridLinesForGermany5dy(xAxisInfo, time, opaqueTimeLines);
          return;
        }
        var len =  xElement.element.length;
            var hour = xElement.element;
            var ap = xElement.element.substring(len-1);
            if((len==2 || len==3)&&(ap=="a" || ap==="p")){ //E.g.: 9a, 11a, 3p, 4p
              hour = xElement.element.substring(0,len-1); 
            }
            if(ap=="p" && hour!="12"){
              hour = parseFloat(hour) + parseFloat(12);
            } else if(hour.length==1){
              hour = "0"+hour;
            }
            //element details gets directly updated in 'xAxisInfo' array
            xElement.element=hour.toString();
        }
        } 
    } else if(time.toString()=="5dy"){  //charts for 5 days
      this._convertGridLinesForGermany5dy(xAxisInfo, time, opaqueTimeLines);
      return;   
    }
  },
  
  //data is received in a sequence - Monday to Saturday
  _convertGridLinesForGermany5dy : function(xAxisInfo, time, opaqueTimeLines) {
    //var patt = /^Mo$|^D$|^M$|^Do$|^F$|^Sa$/; //Germany week pattern - old
    var pattDE = /^M$|^D$|^F$|^S$/; //Germany week pattern
    var xElement = "";
    var length = xAxisInfo.length; 
    for ( var i = 0; i < length; i++) {
      xElement = xAxisInfo[i];
      if(xElement!=undefined){
          if(xElement.element=="M"){
            xElement.element="M"; //Monday
          } else if(xElement.element=="W"){
            xElement.element="M"; //Wednesday
          } else if(xElement.element=="F"){
            xElement.element="F"; //Friday
          } else if(xElement.element=="S"){
            xElement.element="S"; //Saturday
          } else if(xElement.element=="T"){
            xElement.element="D"; //Tuesday or Thursday
            
            /*Commented this code for old German week pattern
            //special case in 1dy charts
            if(length==1 && time.toString()=="1dy"){
              var timeS = this.data.Data[0].Value.Sessions[0].Stop.toString().toLowerCase();
              if(timeS.indexOf("tue")!=-1){
                xElement.element="D";
              } else if(timeS.indexOf("thu")!=-1){
                xElement.element="Do";
              }
            }             
            else if((i==0 && xAxisInfo[i+1].element=="W")
                || (i!=0 && (i+1)<=length && xAxisInfo[i-1].element=="Mo")){
              //if next = Wed or prev = Mon
              xElement.element="D"; //Tuesday
            } else if((i==0 && xAxisInfo[i+1].element=="F")
                || (i!=0 && (i+1)<=length && xAxisInfo[i-1].element=="M")){
              //if next = Fri or prev = Wed
              xElement.element="Do";  //Thursday
            }*/
            
          }
          if (xElement.element.match(pattDE)) {
            opaqueTimeLines.push(xElement.x);
      }
      }
    }
  },
  
  _didLoad : function() {
    if (!this.data)
      return;
    if (this.data.Error) {
      var target = this.targetSelector;
      var errorMessage = "<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>Error, the chart cannot be displayed.</div>";
      if (this.data.Error == "Error: Time") {
        errorMessage = "<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";
      }
      var ctx = this.drawingContext;
      if (ctx !== null) {
        ctx.clearRect(0, 0, this.width, this.height);
        this._clearLabels();
        _djl.place(errorMessage, target);
        //target.append(errorMessage);
      }
      return;
    }
    var data = this.data.Data;
    //only do this when there is a comparison chart
    if (data.length > 1) {
      var tradesExist = false;
      for ( var i = 0; i < data.length; i++) {
        var value = data[i].Value;
        var sessions = value.Sessions;
        for ( var j = 0; j < sessions.length; j++) {
          if (sessions[j].Trades.length > 0) {
            tradesExist = true;
            continue;
          }
        }
      }
      if (!tradesExist) {
        var target = this.targetSelector;
        var errorMessage = "<div style='position: absolute; top:0px;left:0px; class='xValueLbl'>One or more of the symbols you have chosen does not contain trade data for this time frame. Please choose a longer timeframe.</div>";
        var ctx = this.drawingContext;
        if (ctx !== null) {
          ctx.clearRect(0, 0, this.width, this.height);
          this._clearLabels();
          _djl.place(errorMessage, target);
          //target.append(errorMessage);
        }
        return;
      }
    }
    this._barFactor = this.data.BarFactor;
    this._barSize = this.data.BarSize;
    this._chartUnit = this.data.xAxisLabelInfo.chartUnit;
    this._displayUnit = this.data.xAxisLabelInfo.displayUnit;
    this._timeLines = this.data.xAxisLabelsObj.timeLines;
    this._xAxisLabels = this.data.xAxisLabelsObj.ElementList;
    if (this._displayUnit === 1 || this._displayUnit === 2 || this._displayUnit === 3) {
      //only want opaque lines on hour, day, and month labeled charts
      this._findOpaqueGridLines(this.time);
    }
    this._customDateRange = this.data.CustomDateRange;

    try {
      for ( var j = 0; j < this.symbols.length; j++) {
        var Sessions = Thunderball.Utilities._getSessionByTicker(this.data, this.symbols[j]);
        if (Sessions !== null) {
          if (this.symbols.length > 1) {
            this._changeDataToPercentage(Sessions);
          }

          _djl.forEach(Sessions, function(Session, i) {

//                    $.each(Sessions, function(i, Session) {
              if (Session.Trades === undefined) {
                Session.Trades = [];
              }
              if (Session.Events === undefined) {
                Session.Events = [];
              }
              if (Session.News === undefined) {
                Session.News = [];
              }
              if (Session.Weight === undefined) {
                //alert();
            }
            if (Session.Start === undefined) {
              //alert();
            }
            if (Session.Stop === undefined) {
              // alert();
            }

            //format from string into JS datetime if needed
            var sessionStartFormat = Thunderball.Utilities.FormatDate(Session.Start);
            var sessionStopFormat = Thunderball.Utilities.FormatDate(Session.Stop);

            Session.Start = new Date(sessionStartFormat);
            Session.Stop = new Date(sessionStopFormat);
          });

          this._layoutSessions(Sessions);
        }
      }
    } catch (e) {
      //suppress for now
    }
    this._autoScale(this.data.Data, this.time);

    this.redraw();
  },

  _changeDataToPercentage : function(Sessions) {
    var basePrice = null;
    for ( var k = 0; k < Sessions.length; k++) {
      var trades = Sessions[k].Trades;
      for ( var l = 0; l < trades.length; l++) {
        if (trades[l] !== null && basePrice === null) {
          basePrice = trades[l];
          break;
        }
      }
      if (basePrice !== null) {
        break;
      }
    }
    if (basePrice !== null && basePrice > 0) {
      for ( var k = 0; k < Sessions.length; k++) {
        var trades = Sessions[k].Trades;
        for ( var l = 0; l < trades.length; l++) {
          if (trades[l] !== null) {
            trades[l] = 100 * ((trades[l] - basePrice) / basePrice);
          }
        }
        if (Sessions[k].Low !== null) {
          Sessions[k].Low.Price = 100 * ((Sessions[k].Low.Price - basePrice) / basePrice);
        }

        if (Sessions[k].High !== null) {
          Sessions[k].High.Price = 100 * ((Sessions[k].High.Price - basePrice) / basePrice);
        }
      }
    }
  },

  _drawHorizontalLine : function(y) {

    if (this.style.highlowLineStyle) {
      var ctx = this.drawingContext;
      this._bump = true;

      ctx.beginPath();
      ctx.lineWidth = 1;

      ctx.moveTo(0, y + 0.5);

      ctx.lineTo(this.width, y + 0.5);

      ctx.strokeStyle = this.style.highlowLineStyle;
      ctx.stroke();
    }
  },

  _priceIndicator : function(point, string, style, cssClass, lastPoint) {

    if (point.x === null || point.y === null) {
      return;
    }
    if (lastPoint) {
      if (point.x > this.width - 3) {
        point.x = this.width - 3;
      }

      var y = point.y - 10; //lastpoint animated gif is 20px height
      var x = point.x - 2;

      if (this.lastTickChange < 0) {
        lastPointIcon = "<div class='chartDownIndicator'></div>";
      } else if (this.lastTickChange > 0) {
        lastPointIcon = "<div class='chartUpIndicator'></div>";
      } else {
        lastPointIcon = "<div class='chartIndicator'></div>";
        y = point.y - 3;
      }

      //var elm = "<div style='position: absolute; top:" + y + "px;left:" + x + "px; ' class ='lastPointAnimated'>" + lastPointIcon + "</div>"
      //_djl.place(elm, this.targetSelector);
      //this.targetSelector.append(elm);
      return;

    } else {
      //this._drawRoundDot(style, point.x, point.y, 3);
    }
  },

  _createYAxisLabels : function(type) {

    if (!this.style.maxPriceLines)
      return;

    var decimalsToShow = 2;
    var YAxisContent = "";
    var displayValue = "";
    var x, y, p;

    var elmHeight = this.style.YAxisLabelHeight; //TODO get font size from style and choose elmHeight
    var excludeLabel = [];

    if (!this.style.yAxisLabelPadding) {
      this.style.yAxisLabelPadding = 2;
    }

    function addCommas(nStr) {
      nStr += '';
      x = nStr.split('.');
      x1 = x[0];
      x2 = x.length > 1 ? '.' + x[1] : '';
      var rgx = /(\d+)(\d{3})/;
      while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
      }
      return x1 + x2;
    }

    function decimalsNeeded(lineNum, range) {
      var Tol = 5.0e-6;
      if (range === 0 || lineNum === 0)
        return 0;
      var maxDecimals = 6;
      var division = range / lineNum;
      var decimals = 0;
      while (decimals <= maxDecimals) {
        var divtest = division * Math.pow(10, decimals);
        if (Math.abs(divtest - Math.round(divtest)) < Tol)
          break;
        //never display just one decimal place
        decimals += (decimals == 0) ? 2 : 1;
      }
      return decimals;
    }

    //determine if we need to show decimals
    if (this._priceLines.length > 1) {
      this._priceLines.sort(function(a, b) {
        return a - b
      });
      var firstValue = this._priceLines[0];
      var lastValue = this._priceLines[this._priceLines.length - 1];
      var diffValue = lastValue - firstValue;
      var totalNumber = this._priceLines.length - 1;

      if (this.style.showDecimals === 0) {
        decimalsToShow = 0;
      } else if (this.style.YAxisLabelStyle === 1) {
        if (lastValue < 10)
          decimalsToShow = 3;
        else if (lastValue < 100)
          decimalsToShow = 2;
        else
          decimalsToShow = 0;
      } else {
        decimalsToShow = decimalsNeeded(totalNumber, diffValue);
      }
    }

    try {
      var current = false;
      for ( var i = this._priceLines.length - 1; i >= 0; i--) {
        var drawLabel = true;
        p = this._priceLines[i];

        if (this._priceLines[i] === this.lastPrice) {
          y = (this.ty(p) - (elmHeight / 2) - 1); //vertical center label                
        } else if (this._priceLines[i] === this.highPrice) {
          y = (this.ty(p) - elmHeight);
        } else if (this._priceLines[i] === this.lowPrice) {
          y = this.ty(p) - 1;
        } else if (this._priceLines[i] === this.closePrice) {
          y = (this.ty(p) - (elmHeight / 2) - 1);
        } else {
          y = this.ty(p) - (elmHeight / 2);
        }
        //y = this.ty(p) - (elmHeight / 2); //vertical center label
        x = this.style.yAxisLabelPadding + this.width; //add padding between chart and label

        //loop through the other labels and find out if they overlap. Skip looping through labels that have already been excluded.

        //CG** Need to make sure that labels are not duplicated per Charles.
        //Several ways of doing this.

        if (this.style.YAxisLabelStyle === 1) {

          for ( var j = 0; j < this._priceLines.length; j++) {
            if (this._priceLines[i] != this.lastPrice && j != i && excludeLabel[j] != 1) {
              var cp = this._priceLines[j];
              if (this._priceLines[j] === this.lastPrice) {
                cy = (this.ty(cp) - (elmHeight / 2)) - 1;
              } else if (this._priceLines[j] === this.closePrice) {
                cy = (this.ty(cp) - (elmHeight / 2)) - 1;
              } else if (this._priceLines[j] === this.highPrice) {
                cy = (this.ty(cp) - elmHeight) - 1;
              } else if (this._priceLines[j] === this.lowPrice) {
                cy = this.ty(cp) - 1;
              } else {
                drawLabel = false;
              }
              if (Math.abs(Math.abs(cy) - Math.abs(y)) < elmHeight + 1) {
                //This can be commented back in, if we want the top line on the chart to display, even if it is the previous close. 
                //This line will make the highest line always display, unless the price line would have to be removed to accomodate it.
                //if (i != this._priceLines.length - 1 || this._priceLines[j] === this.lastPrice) {
                if (this._priceLines[j] != this.closePrice) {//never block due to the close price.
                  drawLabel = false;
                  excludeLabel[i] = 1;
                }
              }
            }
          }
        }

        if (type > 1) {//Percentage Labels
          displayValue = p.toFixed(decimalsToShow) + "%";
        } else { //Price Labels
          displayValue = p.toFixed(decimalsToShow);
        }

        //This is to handle different current price coloring for chartValueIndicators style charts.
        var labelClass = "priceLbl";

        if (this.style.YAxisLabelStyle === 1) {
          var width = 5; //Figure out something to do here so that this can be dynamic.
          if (this._priceLines[i] === this.lastPrice
              && (this._priceLines[i] >= this.closePrice || this.closePrice === null) && !current) {
            labelClass = "chartPointer chartLastPoint chartPoint-pos";
            current = true;
          } else if (this._priceLines[i] === this.lastPrice && this._priceLines[i] < this.closePrice && !current) {
            labelClass = "chartPointer chartLastPoint chartPoint-neg";
            current = true;
          } else if (this._priceLines[i] === this.lowPrice) {
            if (this.lowPrice === this.lastPrice && current) {
              drawLabel = false;
            }
            labelClass = "chartPointer chartPoint-low";

          } else if (this._priceLines[i] === this.highPrice) {
            if (this.highPrice === this.lastPrice && current) {
              drawLabel = false;
            }
            labelClass = "chartPointer chartPoint-high";

          } else if (this.closePrice && this._priceLines[i] === this.closePrice) {
            if (this.closePrice === this.lastPrice && current) {
              drawLabel = false;
            }
            labelClass = "chartPointer chartPoint-close";
          }
        }
        if (drawLabel === true && this.style.YAxisLabelStyle === 1) {
          YAxisContent = YAxisContent + "<div style='position: absolute; top:" + y + "px;left:" + x + "px; ' class='"
              + labelClass + "'>" + displayValue + "</div>";
        } else if (drawLabel === true) {
          YAxisContent = YAxisContent + "<div style='position: absolute; top:" + y + "px;left:" + x + "px; ' class='"
              + labelClass + "'>" + displayValue + "</div>"
        }
      }
    } catch (e) {
      //suppress for now
    }
    dojo.query('.chartPointer', this.targetSelector).orphan();
    dojo.query('.priceLbl', this.targetSelector).orphan();
    dojo.query('.xValueLbl', this.targetSelector).orphan();
    _djl.place(YAxisContent, this.targetSelector);
    //this.targetSelector.append(YAxisContent);
  },

  _determineTypeOfChart : function(Sessions) {

    if (Sessions.length >= 1 && Sessions[0].Regions.length >= 1) {
      var numberOfRegions = Sessions[0].Regions.length;

      if (numberOfRegions == 1 && Sessions[0].Regions[0].Type != 4) {
        this._historical = true;
      } else {
        this._historical = false;
      }
    }
  },

  _setHLC : function(Sessions) {

    this.lastPoint.x = null;
    this.lastPoint.y = null;
    this.lowPoint.x = null;
    this.lowPoint.y = null;
    this.highPoint.x = null;
    this.highPoint.y = null;

    var MinMax = this._getMinMax(Sessions, false);
    var needsBump = false;
    if (this.data.Data[0].Value.IsIndex === 1 && this._barSize === 60) {
      needsBump = true;
    }
    //Finds low from the min found in the _getMinMax function
    if (MinMax.MinPoint !== null || MinMax.Min !== null) {
      this.lowPoint = MinMax.MinPoint;
      //this.lowPrice = MinMax.Min.toFixed(decimalsToShow);
    }
    //Finds high from the max found in the _getMinMax function
    if (MinMax.MaxPoint !== null || MinMax.Max !== null) {
      this.highPoint = MinMax.MaxPoint;
      //this.highPrice = MinMax.Max.toFixed(decimalsToShow);
    }

    //Finds last price point in the last session's trade array.
    for ( var i = 0; i < Sessions.length; i++) {

      var Session = Sessions[i];
      this._setSession(Session);

      if (Session.Trades && Session.Trades.length !== 0) {

        var lastIndex = Session.Trades.length - 1;

        var price = Session.Trades[lastIndex];
        //if there is a price where at the last index of the trades array,
        //use that.
        if (price) {
          this.lastPoint.y = this.ty(price);
          if (this._historical) {
            this.lastPoint.x = this.tx(lastIndex / this._barSize);
          } else {
            if (needsBump) {
              this.lastPoint.x = this.tx(lastIndex + 0.5);
            } else {
              this.lastPoint.x = this.tx(lastIndex);
            }
          }
          //this.lastPrice = price.toFixed(decimalsToShow);
        } else { //If there isn't a price at the last index of the
          //trades array, must search for last price value
          for ( var j = lastIndex; j >= 0; j--) {

            price = Session.Trades[j];

            if (price) {
              this.lastPoint.y = this.ty(price);
              if (this._historical) {
                this.lastPoint.x = this.tx(j / this._barSize);
              } else {
                if (needsBump) {
                  this.lastPoint.x = this.tx(j + 0.5);
                } else {
                  this.lastPoint.x = this.tx(lastIndex);
                }

              }
              //this.lastPrice = price.toFixed(decimalsToShow);
              break;
            }
          }
        }
      }
    }
  },

  _drawRoundIndicator : function(color, x, y, circleSize) {
    if (x !== null && y !== null) {
      var ctx = this.drawingContext;

      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, 3, 0, Math.PI * 2, true);
      ctx.fill();

      ctx.strokeStyle = color;
      ctx.beginPath();
      ctx.save();
      ctx.lineWidth = 1.5;
      ctx.arc(x, y, circleSize, 0, Math.PI * 2, true);
      ctx.stroke();
      ctx.restore();
    }
  },

  _drawRoundDot : function(color, x, y, size) {
    if (x !== null && y !== null) {
      var ctx = this.drawingContext;

      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, size, 0, Math.PI * 2, true);
      ctx.fill();
    }
  },

  _drawNewsOverlay : function(Sessions) {
    this._bump = false;

    for ( var i = 0; i < Sessions.length; i++) {
      this._setSession(Sessions[i]);
      var news = Sessions[i].News;

      for ( var j = 0; j < news.length; j++) {
        var story = news[j];

        var x = this.tx(story.At);
        var p;

        /*
         * this does not display news stories that are published _before_ the first trade of the day
         */
        var Trades = Sessions[i].Trades;
        for ( var k = 0; k < Trades.length && k < story.At; k++) {
          if (Trades[k]) {
            p = Trades[k];
          }
        }

        if (p) {
          var newsLink = $('<a></a>').attr('href', story.Url);
          var icon = $('<img />').attr('border', 0).attr('src', this.style.newsBackground).attr('title', story.Text)
              .appendTo(newsLink);
        }
      }
    }
  },

  _drawPriceLines : function() {

    if (this.style.horizontalGridLineStyle) {
      var ctx = this.drawingContext;
      this._bump = true;

      ctx.beginPath();

      var ticks = this._priceLines;
      for ( var i = 0; i < ticks.length; i++) {
        var y = this.ty(ticks[i]);

        ctx.moveTo(0, y);
        ctx.lineTo(this.width, y);
      }

      ctx.strokeStyle = this.style.horizontalGridLineStyle;
      ctx.stroke();
    }
  },

  _drawChartBorder : function() {

    if (this.style.border) {

      var ctx = this.drawingContext;
      ctx.beginPath();
      ctx.strokeStyle = this.style.border;
      ctx.strokeRect(0, 0, this.width, this.height);
    }
  },

  _drawChartBackground : function() {

    if (this.style.background) {

      var ctx = this.drawingContext;
      ctx.beginPath();
      ctx.fillStyle = this.style.background;
      ctx.fillRect(0, 0, this.width, this.height);
    }
  },

  _drawCloseLines : function(Sessions) {
    var ctx = this.drawingContext;
    this._bump = true;

    var x = 0;

    ctx.beginPath();
    for ( var i = 0; i < Sessions.length; i++) {
      var session = Sessions[i];

      this._setSession(session);

      var w = session.SessionWidth;

      var x2 = x + w;

      if (session.PreviousClose !== undefined && session.PreviousClose !== null && (this.symbols.length == 1)) {
        var y = this.ty(session.PreviousClose);

        ctx.moveTo(x, y);
        ctx.lineTo(x2, y);
      }

      x = x2;
    }

    ctx.strokeStyle = this.style.closelineStyle;
    ctx.stroke();
  },

  _drawRegions : function(session) {
    var ctx = this.drawingContext;

    this._setSession(session);
    this._bump = false;

    for ( var i = 0; i < session.Regions.length; i++) {
      var Region = session.Regions[i];
      var Color = this._regionStyles[Region.Type];

      if (!Color || Color == this.style.background) {
        continue;
      }

      var x1 = this.tx(Region.Start);
      var x2;
      //only do comparison if it is the first region (premarket) and premarket is available
      if (i === 0 && this._barSize === 60 && (Region.Stop + Region.Start > 0)) {
        x2 = this.tx(Region.Stop + 0.5);
      } else {
        x2 = this.tx(Region.Stop);
      }

      ctx.fillStyle = Color;
      ctx.fillRect(x1, 0, x2 - x1, this.height);
    }
  },

  _buildTradePath : function(Sessions) {
    var ctx = this.drawingContext;
    var data = this.data;
    var isIndex = data.Data[0].Value.IsIndex;
    var first = true;
    var x = 0;
    var firstx;
    var prev = null;
    var last;
    for ( var i = 0; i < Sessions.length; i++) {
      var Session = Sessions[i];
      this._setSession(Session);

      //if (!this._historical) {
      //if (prev !== null && i !== Sessions.length - 1) {
      //ctx.lineTo(this.tx(0), this.ty(prev));
      //If we are not historical or the last session line to prevouse tick price
      //}
      //}

      if (Session.Trades) {

        for ( var j = 0; j < Session.Trades.length; j++) {
          var price = Session.Trades[j];

          if (price === null) {
            if (prev === null)
              continue;

            price = prev;
          }

          prev = price;

          var y = this.ty(price);
          if (this._historical) {
            x = this.tx(j / this._barSize);
          } else {
            if (isIndex === 1 && this._barSize === 60) {
              x = this.tx(j + 0.5);
            } else {
              x = this.tx(j);
            }
          }
          if (first) {
            firstx = x;
            ctx.moveTo(0, y);
            ctx.lineTo(firstx, y);
            first = false;
          } else {
            ctx.lineTo(x, y);
          }
        }
      }
    }

    return {
      firstx : firstx,
      lastx : x
    };
  },

  _strokeFillTrades : function(Sessions, strokeStyle) {
    var ctx = this.drawingContext;
    ctx.save();
    ctx.lineWidth = this.style.mainPriceLineWidth;
    ctx.strokeStyle = strokeStyle;
    ctx.beginPath();

    this._bump = true;

    var x = this._buildTradePath(Sessions);

    if (x.lastx != undefined && x.firstx != undefined) {
      ctx.stroke();
      ctx.lineTo(x.lastx, this.height);
      ctx.lineTo(0, this.height);

      ctx.fillStyle = this.style.mainPriceLineFill;
      ctx.fill();
    }

    ctx.restore();
  },

  _strokeTrades : function(Sessions, strokeStyle) {
    var ctx = this.drawingContext;
    ctx.save();
    ctx.miterLimit = 0; //limit chart spikes
    ctx.lineJoin = "round";
    ctx.lineWidth = this.style.mainPriceLineWidth;
    ctx.strokeStyle = strokeStyle;
    ctx.beginPath();

    this._bump = true;

    var x = this._buildTradePath(Sessions);

    ctx.stroke();
    ctx.restore();
  },

  _fillTrades : function(Sessions) {
    var ctx = this.drawingContext;
    ctx.fillStyle = this._fillStyle;
    ctx.beginPath();

    this._bump = false;

    var points = this._buildTradePath(Sessions);

    if (points.lastx != undefined && points.firstx != undefined) {
      ctx.lineTo(points.lastx, this.height);
      ctx.lineTo(0, this.height);
    }

    ctx.fill();
  },

  _precomputeStyles : function() {

    if (this.style.gradientFillStyle) {
      this._fillStyle = this._makeStyle(this.style.gradientFillStyle);
    }

    if (this.style.mainPriceLineFill) {
      this._fillStyle = this.style.mainPriceLineFill;
    }

    this._regionStyles = {};
    var styles = this.style.regionStyles;
    for ( var style in styles) {
      this._regionStyles[style] = this._makeStyle(styles[style]);
    }
  },

  _prepareCanvas : function() {
    if (!this.drawingContext || this.drawingContext === null) {
      var canvasWidth = this.width;
      var canvasHeight = this.height;
      this.targetSelector.innerHTML = "";
      //this.targetSelector.html(""); // clear target

      if (canvasWidth <= 0 || canvasHeight <= 0) {
        throw "Invalid dimensions - width = " + canvasWidth + ", height = " + canvasHeight;
      }

      // 01/15/2009 PTE - Change to work with IE 8 and excanvas.js revision 43.
      //var canvas = $('<canvas width="' + canvasWidth + '" height="' + canvasHeight + '"></canvas>').appendTo(this.targetSelector).get(0);

      var canvas = document.createElement('canvas');
      canvas.setAttribute('width', canvasWidth);
      canvas.setAttribute('height', canvasHeight);
      //this.targetSelector.get(0).appendChild(canvas); jquery to dojo
      _djl.place(canvas, this.targetSelector);

      if (!Thunderball.Utilities.check_canvas()) {
        canvas = window.G_vmlCanvasManager.initElement(canvas, canvasWidth, canvasHeight);
      }

      this.drawingContext = canvas.getContext("2d");
    }

    this._precomputeStyles();
  },

  orphan : function(node) {
    node.parentNode.removeChild(node);
  },

  _clearLabels : function() {
    var label = dojo.query("#" + this.targetSelector.id + " > div");
    //if(label) { this.orphan(label); }
    //if(label) { label.orphan(); }
    //$(this.targetSelector).children("div").remove();
  },

  _layoutSessions : function(Sessions) {
    var TotalSessionWeight = 0;
    _djl.forEach(Sessions, function(value, index) {
      TotalSessionWeight += value.Weight;
    });
    /*
     * $.each(Sessions, function(i, s) { TotalSessionWeight += s.Weight; });
     */
    var x = 0;

    for ( var i = 0; i < Sessions.length; i++) {
      var Session = Sessions[i];

      var SessionWidth;
      SessionWidth = Math.floor(this.width * Session.Weight / TotalSessionWeight);
      Session.SessionWidth = SessionWidth;

      // All sessions are the same width
      Session._x = x;
      x += SessionWidth;

      // Get the scale factor
      var SessionStart = Session.Start.getTime();
      var SessionStop = Session.Stop.getTime();

      var SessionTime = SessionStop - SessionStart;

      Session._xscale = SessionWidth * this._barFactor / (SessionTime);
    }
  },

  _autoScale : function(Data, time) {
    var Min = null;
    var Max = null;
    var High = null;
    var Low = null;
    var Close = null;

    var self = this;

    //this._debugTimingInit();

    var chartValueIndicators = this.style.YAxisLabelStyle;
    //     try {
    //$.each(Data, function(i, Sessions) {
    _djl.forEach(Data, function(Sessions, i) {

      var includePreviousClose = true;

      //for charts with more than one symbol or charts in which there are no session values and no previous close
        //values defined, we should not include the previous close line.
        if (self.symbols.length > 1 || Sessions.Value === undefined || Sessions.Value.Sessions === undefined
            || Sessions.Value.Sessions.length < 1 || Sessions.Value.Sessions[0].PreviousClose === undefined
            || Sessions.Value.Sessions[0].PreviousClose === null) {
          includePreviousClose = false;
        }

        // Do y-axis scaling
        var MinMax = self._getMinMax(Sessions.Value.Sessions, includePreviousClose);

        //Collect the high and low for the MarketOverview. Set the previous close if we are using it. 
        if (chartValueIndicators === 1) {
          self._determineLastTrade(Sessions.Value.Sessions[Sessions.Value.Sessions.length - 1].Trades);
          //the only chart that uses previous close is the market overview. Check here
          //to see if the other requirements are met for using the previous close price
          Low = MinMax.Low;
          High = MinMax.High;

          if (includePreviousClose && time=="1dy") { //existing logic as per time=1dy
            Close = Sessions.Value.Sessions[0].PreviousClose;
            self.closePrice = Close;
          } 
          else if(!includePreviousClose && time!="1dy"){            
            //for 5dy, 1mo, 3mo, 6mo and 1yr chart ranges
            if(_PrevClose!=null && _PrevClose>=0){
              Close = _PrevClose;
              self.closePrice = Close;
            }
          }
        }
        if (!Min || MinMax.Min < Min) {
          Min = MinMax.Min;
        }
        if (!Max || MinMax.Max > Max) {
          Max = MinMax.Max;
        }
      });

    function dStart() {
      this.value = 0;
    }

    function dFinish() {
      this.value = 0;
    }

    if (this.style.maxPriceLines >= 1) {

      var dFinishObj = new dFinish();
      var dStartObj = new dStart();

      var scale = Thunderball.ChartScalingV2.CalculateDelta2(this.style.maxPriceLines, false, true, Min, Max,
          dStartObj, dFinishObj);

      if (dStartObj.value < 0 && self.symbols.length === 1) {
        scale = Thunderball.ChartScalingV2.CalculateDelta2(Math.round(this.style.maxPriceLines / 2), false, true, Min,
            Max, dStartObj, dFinishObj);
      }

      if (chartValueIndicators === 1) {

        //if both high and low are null and close is not null,
        //set the max and min values to an offset of the close price.
        //If the close price is also null, then the max and min should be 1 and 0
        //respectively.
        if (High === null && Low === null) {
          if (close !== null) {
            Max = Close + (Close * .01);
            Min = Close - (Close * .01);
          } else {
            Max = 1;
            Min = 0;
          }
        }

        //Min = Math.min(Min, dStartObj.value);
        //Max = Math.max(Max, dFinishObj.value);               

        this._priceLines = [];
        var ticks = this._priceLines;

        //If this is the MarketOverview, we will set the price lines to High, Low and Prev Close if it is available. 
        if (Low !== null) {
          ticks.push(Low);
          this.lowPrice = Low;
        }
        if (this.lastPrice !== null) {
          ticks.push(this.lastPrice);

        }
        //push close onto array of pricelines only if it is not undefined or null
        if ((!(Close === undefined || Close === null))) {
          ticks.push(Close);

          if (High !== null) {
            ticks.push(High);
            this.highPrice = High;
          }
        } else {
          if (High !== null) {
            ticks.push(High);
            this.highPrice = High;
          }
        }
        //if the chart is a non-market overview chart, get the scaling from the Thunderball.js
        //function objects of dStartObj and dFinishObj.
      } else {

        Min = Math.min(Min, dStartObj.value);
        Max = Math.max(Max, dFinishObj.value);

        this._priceLines = [];
        var ticks = this._priceLines;

        if (scale > 0) {
          for ( var p = dStartObj.value; p <= dFinishObj.value + ((dFinishObj.value - dStartObj.value) * .05); p += scale) {
            ticks[ticks.length] = p;
          }
        }
      }
    }
    // }
    // catch (e) {
    //suppress for now
    // }

    var pad = this.style.vPadding;
    var height = this.height - 2.0 * pad;

    //final check to prevent dividing by zero
    if (Max - Min === 0) {

      if (Max < Min) {
        var Tmp = Min;
        Min = Max;
        Max = Tmp;
      }

      var Max = Math.abs(Max);
      if (Max == 0)
        Max = 1;

      if (Max < 0)
        Max = 0;
      else if (Max == 0)
        Max = 1;
      else
        Min = 0;
    }

    this._yscale = -height / (Max - Min);
    this._y = height - Min * this._yscale + pad;

  },

  _setSession : function(session) {
    this._xscale = session._xscale;
    this._x = session._x;
  },

  tx : function(x) {
    if (!this._x) {
      this._x = 1;
    }
    if (!this._xscale) {
      this._xscale = 1;
    }
    return Math.floor(this._xscale * x + this._x) + (this._bump ? 0.5 : 0);
  },

  ty : function(y) {
    return Math.floor(this._yscale * y + this._y) + (this._bump ? 0.5 : 0);
  },

  _makeStyle : function(spec) {
    var steps = spec.split('-');

    if (steps.length == 2) {
      var gradient = this.drawingContext.createLinearGradient(0, 0, 0, this.height);
      gradient.addColorStop(0, steps[0]);
      gradient.addColorStop(1, steps[1]);
      return gradient;
    } else {
      return spec;
    }
  },

  _determineLastTrade : function(Trades) {

    var latestPrice = null;
    for ( var k = Trades.length - 1; k >= 0 && latestPrice === null; k--) {
      if (Trades[k]) {
        latestPrice = Trades[k];
      }
    }
    this.lastPrice = latestPrice;
  },

  _getMinMax : function(Sessions, IncludePreviousClose) {
    var MinPoint;
    var MaxPoint;
    var Min;
    var Max;
    var LowPrice;
    var HighPrice;
    var SessionHighPoint = {
      Index : null,
      Price : null,
      SessionIndex : null
    };
    var SessionLowPoint = {
      Index : null,
      Price : null,
      SessionIndex : null
    };

    if (IncludePreviousClose && Sessions[0].PreviousClose !== null) {
      Max = Min = Sessions[0].PreviousClose;
    }

    var needsBump = false;
    if (this.data.Data[0].Value.IsIndex === 1 && this._barSize === 60) {
      needsBump = true;
    }
    //walk through each session to find the high and the low
  for ( var i = 0; i < Sessions.length; i++) {
    var Session = Sessions[i];

    this._setSession(Session);

    if (!Session.Trades) {
      Session.Trades = [];
    }

    // get market hours high low
    var Low = Session.Low;
    var High = Session.High;

    if (Low || High) {
      if (Low && (!Min || Low.Price < Min)) {
        Min = Low.Price;
        if (this._historical) {
          MinPoint = {
            x : this.tx(Low.Index / this._barSize),
            y : this.ty(Min)
          };
        } else {
          if (needsBump) {//TODO handle this on server
            MinPoint = {
              x : this.tx(Low.Index + 0.5),
              y : this.ty(Min)
            };
          } else {
            MinPoint = {
              x : this.tx(Low.Index),
              y : this.ty(Min)
            };
          }
        }
        SessionLowPoint.Index = Low.Index;
        SessionLowPoint.Price = Low.Price;
        SessionLowPoint.SessionIndex = i;
      }
      if (High && (!Max || High.Price > Max)) {
        Max = High.Price;
        if (this._historical) {
          MaxPoint = {
            x : this.tx(High.Index / this._barSize),
            y : this.ty(Max)
          };
        } else {
          if (needsBump) {
            MaxPoint = {
              x : this.tx(High.Index + 0.5),
              y : this.ty(Max)
            };
          } else {
            MaxPoint = {
              x : this.tx(High.Index),
              y : this.ty(Max)
            };
          }
        }
        SessionHighPoint.Index = High.Index;
        SessionHighPoint.Price = High.Price;
        SessionHighPoint.SessionIndex = i;
      }

      if (Low && (!LowPrice || Low.Price < LowPrice)) {
        LowPrice = Low.Price;
      }
      if (High && (!HighPrice || High.Price > HighPrice)) {
        HighPrice = High.Price;
      }
    }
  }

  var UniqueHighPoint = null;
  var UniqueLowPoint = null;

  //Insert highest and lowest points on the chart line. 
  if (SessionHighPoint.Index !== null && SessionHighPoint.Price !== null && SessionHighPoint.SessionIndex !== null) {

    if (SessionHighPoint.SessionIndex < Sessions.length
        && SessionHighPoint.Index < Sessions[SessionHighPoint.SessionIndex].Trades.length) {
      UniqueHighPoint = SessionHighPoint.Price;
      HighPrice = SessionHighPoint.Price;
    }
  }

  if (SessionLowPoint.Index !== null && SessionLowPoint.Price !== null && SessionLowPoint.SessionIndex !== null) {

    if (SessionLowPoint.SessionIndex < Sessions.length
        && SessionLowPoint.Index < Sessions[SessionLowPoint.SessionIndex].Trades.length) {
      UniqueLowPoint = SessionLowPoint.Price;
      LowPrice = SessionLowPoint.Price;
    }
  }

  //check if we have a high and low point value
  if (UniqueHighPoint !== null && UniqueLowPoint !== null) {
    //check if they are in the same session.
    if (SessionLowPoint.SessionIndex == SessionHighPoint.SessionIndex) {
      //if low and high are in the same interval don't plot either on the chart line.
      if (SessionLowPoint.Index !== SessionHighPoint.Index) {
        Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index] = UniqueLowPoint;
        Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index] = UniqueHighPoint;
      }
    } else//if not in the same session plot points
    {
      Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index] = UniqueLowPoint;
      Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index] = UniqueHighPoint;
    }
  } else if (UniqueHighPoint !== null) {
    Sessions[SessionHighPoint.SessionIndex].Trades[SessionHighPoint.Index] = UniqueHighPoint;
  } else if (UniqueLowPoint !== null) {
    Sessions[SessionLowPoint.SessionIndex].Trades[SessionLowPoint.Index] = UniqueLowPoint;
  }

  return ( {
    Min : Min,
    Max : Max,
    Low : LowPrice,
    High : HighPrice,
    MinPoint : MinPoint,
    MaxPoint : MaxPoint
  });
}
};
dojo.provide("dj.widget.article.ArticleTickerPopUpView");
dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");
dojo.require("dj.lang");
dojo.require("dj.module.article.chart");
dojo.require("dojo.date");


dojo.declare("dj.widget.article.ArticleTickerPopUpView", [], {
  DEFAULT_CONFIG : {},
  constructor: function(container, args, callback) {
    this.conf = {
        tickerName: "",
        country: "",
        baseClass : "inlineTicker",
        tooltipIdPrefix : "tickerTooltip_",
        fragmentUrl : '/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?ticker=',
        TTL: "1m",
        version: 6,
        containerId: "",
        realTimeChannel : "",
        delayedChannel : "",
        chartRefreshTimeout : 180000
    };
    _djl = dj.lang;

    if(_djl.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
        '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
        '#default#VML');
      } 
    }
    dojo.mixin(this.conf, args);
    this.hidePopupTimeout = 150;
    this.insidePopup = false;
    this.insideTicker = false;
    this.container = container;
    this.loader = new dj.widget.fragmentloader.FragmentJSONLoader(this.conf.fragmentUrl + this.conf.tickerName + "&country=" + this.conf.country, 
        this.conf.version, {TTL: this.conf.TTL});
    this._connectToLoaderEvents(callback);
    this.loader.load();

  },

  _connectToLoaderEvents: function(callback) {
    dojo.connect(this.loader, "onLoadJson", dojo.hitch(this, function(data){
      this.createTooltip(data.jsonFile.data, callback);
    }));
  },

  createTooltip: function(data, callback) {
    if(dojo.trim(data) === '') {
      return;
    }
    this.random = Math.abs(Math.random() * 100);
    this.tooltip = new dijit.TooltipDialog({
      id: this.conf.tooltipIdPrefix + this.conf.tickerName + this.random,
      content: data,
      baseClass: this.conf.baseClass,
      onMouseLeave: dojo.hitch(this, function(){
        this.insidePopup = false;
        setTimeout(dojo.hitch(this,this.close), this.hidePopupTimeout);
      }),
      onMouseEnter: dojo.hitch(this, function(){
        this.insidePopup = true;
      })
    });

    this.show();
    this.removeOwnArticle();

    this.drawChart();
    this.setChartRefreshTimer();

    if(callback && typeof callback === "function") {
      callback();
    }
  },

  removeOwnArticle : function() {
    if(AT_VARS && AT_VARS.baseDocId) {
      dojo.query("[data-widget='dj.article'][data-doc-id='"+AT_VARS.baseDocId+"']", this.tooltipContainer).orphan();
    }
  },

  show: function() {
    if(this.open) {
      return;
    }
    this.open = true;
    if(!this.tooltip || this.tooltip === 'undefined') {
      return;
    }
    dijit.popup.open({
      popup: this.tooltip,
      around: this.container
    });

    if(!this.tooltipContainer) {
      this.tooltipContainer = dojo.byId(this.conf.tooltipIdPrefix + this.conf.tickerName + this.random);
    } 

    if(!this.chartContainerId) {
      this.chartContainerId = 'chart_' + this.conf.tooltipIdPrefix + this.conf.tickerName + this.random;
      dojo.query('.tkrChartC', this.tooltipContainer)[0].id = this.chartContainerId;
    }

    if(!this.tickerSymbol) {
      this.tickerSymbol = dojo.query('.tkrPriceSign', this.tooltipContainer);
    }
    if(this.tickerSymbol) {
      dojo.forEach(this.tickerSymbol, dojo.hitch(this,function(obj){ obj.innerHTML = this.container.getAttribute('data-iso');}));
    }  
    
  },
  
  showHideAfterHours:function(afterHourShowHide){    
      var afterHourModuleArr = dojo.query(".tkrValueAfter", this.tooltipContainer);
      var afterHourModule = afterHourModuleArr.length > 0 ? afterHourModuleArr[0] : null;
      if(afterHourShowHide === "show"){
        if(afterHourModule && dojo.hasClassName(afterHourModule, "hidden") ){
           dojo.removeClass(afterHourModule, "hidden");
        }        
      }else if(afterHourShowHide === "hide"){
        if(afterHourModule && !dojo.hasClassName(afterHourModule, "hidden") ){
          dojo.addClass(afterHourModule, "hidden");
       }
      }
  },

  render: function(data) {
    var cssClass = "Neutral";
    var symbol = '';
    var previousClose = 0.00;
    var percentChange = 0.00;
    var last = data.b.l;
    var theDate = "";
    var change = 0.00;
    if(data && data.b) {
      cssClass = (data.b.c >= 0) ? 'Positive':'Negative';
      symbol = (data.b.c >= 0) ? '+':'';
      if(data.b.c === 0) {
        cssClass = 'Neutral';
        symbol = '';
      }
      previousClose = this.container.getAttribute('data-pc');
      percentChange = (data.b.c / previousClose) * 100 ;
      if(isNaN(percentChange)) {
        percentChange = 0.00;
        cssClass = 'Neutral';
        symbol = '';
      }
      last = data.b.l;
      change = data.b.c;
      theDate = data.b.z;
      if(theDate.indexOf('/Date') !== -1) {
        var offset = this.container.getAttribute('data-offset');
        offset = parseFloat(offset);
        var userOffset = new Date().getTimezoneOffset() / 60;
        offset = offset + userOffset;
        var dateObj = new Date(parseInt(theDate.replace(/[^0-9]/g,''), 10));
        dateObj = dojo.date.add(dateObj, "hour", offset);
        theDate = dj.util.Date.simpleDateFormat.format(dateObj, 'NNN d, yyyy h:mm a ');
      }
    } else {
      return;
    }

    var info = {last: last.toFixed(2), change: change, previousClose: previousClose, percentChange: percentChange, date: theDate, symbol: symbol, cssClass: cssClass};
    if(data && data.b && data.b.y) {
      console.log("data.b.y " + data.b.y);
      console.log("data.h.t " + data.h.t);
      console.log("this.conf.realTimeChannel " + this.conf.realTimeChannel);
      if(data.b.y === 'premarket') {
        if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
          this.callType = "premarket";
        }
      }else if(data.b.y === 'normal') {        
        if(this.callType !== null && typeof this.callType !== "undefined" && this.callType === "premarket" ){
          console.log("BlueGrass market transitioned for " + data.h.t);
          this.showHideAfterHours("hide");
          this.drawChart();
        }
        this.callType = "normal";
        // update the normal hour
        if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
          this.updateNormalValues(info);
        }
        if(data.b.v) {
          this.updateNormalVolume(data.b.v);
        }
        this.updateChartTick(data);
      } else if(data.b.y === 'aftermarket') { 
          this.callType = "aftermarket";
          // update after market
          if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
            this.updateAfterMarketValues(info);
          }
          if(data.b.v) {
            this.updateAfterMarketVolume(data.b.v);
          }
          this.updateChartTick(data);
      }      
      
    }
  },

  updateNormalValues: function(data) {
    // Price
    if(!this.normalPrice) {
      this.normalPrice = dojo.query('.tkrModTop .tkrPriceNumber', this.tooltipContainer)[0];
    }
    if(this.normalPrice){
      this.normalPrice.innerHTML = data.last;
    }

    // Change and Percent Change
    if(!this.normalChange) {
      this.normalChange = dojo.query('.tkrModTop .tkrPriceValue', this.tooltipContainer)[0];
    }
    if(this.normalChange){
      dojo.removeClass(this.normalChange, 'tkrPriceValueNeutral');
      dojo.removeClass(this.normalChange, 'tkrPriceValuePositive');
      dojo.removeClass(this.normalChange, 'tkrPriceValueNegative');
      dojo.addClass(this.normalChange, 'tkrPriceValue' + data.cssClass);
      this.normalChange.innerHTML = data.symbol + data.change.toFixed(2) + " " + data.symbol + data.percentChange.toFixed(2) + "%";
    }
    // Arrow
    if(!this.normalArrow) {
      this.normalArrow = dojo.query('.tkrModTop .tkrPriceArrow', this.tooltipContainer)[0];
    }
    if(this.normalArrow) {
      dojo.removeClass(this.normalArrow, 'tkrPriceArrowNeutral');
      dojo.removeClass(this.normalArrow, 'tkrPriceArrowPositive');
      dojo.removeClass(this.normalArrow, 'tkrPriceArrowNegative');
      dojo.addClass(this.normalArrow, 'tkrPriceArrow' + data.cssClass);
    }

    // Date
    if(!this.normalDate) {
      this.normalDate = dojo.query('.tkrModTop .tkrVolumeDate', this.tooltipContainer)[0];
    }
    if(this.normalDate) {
      this.normalDate.innerHTML = data.date;
    }
  },

  updateNormalVolume: function(volume) {
    if(!this.normalMarketVolume) {
      this.normalMarketVolume = dojo.query('.tkrModTop .tkrVolumeNum .tkrStrong', this.tooltipContainer)[0];
    }
    if(this.normalMarketVolume) {
      this.normalMarketVolume.innerHTML = this.setVol(volume);
    }
  },

  updateAfterMarketValues: function(data) {
    // Price
    if(!this.afterMarketPrice) {
      this.afterMarketPrice = dojo.query('.tkrModAfter .tkrPriceNumber', this.tooltipContainer)[0];
    }
    if(this.afterMarketPrice) {
      this.afterMarketPrice.innerHTML = data.last;
    }

    // Change and Percent Change
    if(!this.afterMarketChange) {
      this.afterMarketChange = dojo.query('.tkrModAfter .tkrPriceValue', this.tooltipContainer)[0];
    }
    if(this.afterMarketChange) {
      dojo.removeClass(this.afterMarketChange, 'tkrPriceValueNeutral');
      dojo.removeClass(this.afterMarketChange, 'tkrPriceValuePositive');
      dojo.removeClass(this.afterMarketChange, 'tkrPriceValueNegative');
      dojo.addClass(this.afterMarketChange, 'tkrPriceValue' + data.cssClass);
      this.afterMarketChange.innerHTML = data.symbol + data.change.toFixed(2) + " " + data.symbol + data.percentChange.toFixed(2) + "%";
    }

    // Arrow
    if(!this.afterMarketArrow) {
      this.afterMarketArrow = dojo.query('.tkrModAfter .tkrPriceArrow', this.tooltipContainer)[0];
    }
    if(this.afterMarketArrow) {
      dojo.removeClass(this.afterMarketArrow, 'tkrPriceArrowNeutral');
      dojo.removeClass(this.afterMarketArrow, 'tkrPriceArrowPositive');
      dojo.removeClass(this.afterMarketArrow, 'tkrPriceArrowNegative');
      dojo.addClass(this.afterMarketArrow, 'tkrPriceArrow' + data.cssClass);
    }

    // Date
    if(!this.afterMarketDate) {
      this.afterMarketDate = dojo.query('.tkrModAfter .tkrVolumeDate', this.tooltipContainer)[0];
    }
    if(this.afterMarketDate) {
      this.afterMarketDate.innerHTML = data.date;
    }
  },

  updateAfterMarketVolume: function(volume) {
    /* It looks like we dont update volume for after hours from bluegrass
     * Bluegrass is returning the same number for after hours volume
    if(!this.afterMarketVolume) {
      this.afterMarketVolume = dojo.query('.tkrModAfter .tkrVolumeNum .tkrStrong')[0];
    }
    this.afterMarketVolume.innerHTML = this.setVol(volume);
     */
  },  

  drawChart: function() {
    var WSJIndexChartStyle = {
        background : "#ffffff",
        border : "#E6E2D7",
        closelineStyle : "#e36825",
        horizontalGridLineStyle : "#f4f3f1",
        highIndicatorStyle : "#093c71",
        highlowLineStyle : "#015190",
        lowIndicatorStyle : "#093c71",
        mainLineStyle : "#557BA0",
        mainPriceLineFill : "rgba(85,123,160,0.15)",
        mainPriceLineWidth : 1,
        maxPriceLines : 4,
        verticalGridLineStyle : "rgba(180,201,202,0.5)",
        verticalGridLineStyle_Opaque : "rgba(180,201,202,1.0)",
        vPadding : 12,
        YAxisLabelStyle : 0, //High Low Price Close = 1
        YAxisLabelHeight : 12,
        showDecimals : 1,
        regionStyles : {
          0 : '#cde2e0', // Premarket
          1 : '#cde2e0', //Postmarket
          2 : 'rgba(51,51,51,0.06)'//Intersession
        },
        comparelineStyles : {
          0 : '#cc3333', //Strong red:
          1 : '#3b8dad', //Strong blue:
          2 : '#c9932e', //Strong yellow
          3 : '#b78383', //Weak red:
          4 : '#8eb3bc', //Weak blue:
          5 : '#dbb782' //Weak yellow:
        }
    };
    this.chartSymbol = this.conf.country+":"+this.container.getAttribute('data-ticker');
    dojo.xhrPost({
      url : '/thunderball/HistoricChartData.aspx',
      handleAs : 'json',
      load : dojo.hitch(this, function(response, xhr){
        var chartData = response;

        this.chart = new EmbeddedChart(this.chartContainerId, WSJIndexChartStyle,
            234, 92, null, null,null,null, chartData, this.chartSymbol , '');

        this.chartExists = this.chart.ShowChart();
      }),
      content : {
        Symbol : this.chartSymbol,
        Width : 234,
        freq : "1mi",
        time : "1dy"
      },
      error : function(error, ioArgs) {
        console.error("MarketBannerTickers - Error on loading charts");
        console.log(error);
        console.log(ioArgs);
      }
    });
  },

  setChartRefreshTimer:function(){
    setTimeout(dojo.hitch(this,function(){
      this.drawChart();
      this.setChartRefreshTimer();
    }), this.conf.chartRefreshTimeout, null);
  },

  updateChartTick: function(data) {
    if(this.chartExists && this.chart && typeof this.chart.TickUpdate === "function" ) {
      this.chart.TickUpdate(this.chartSymbol, data);
    }
  },

  close: function() {
    if(!this.insidePopup && !this.insideTicker) {
      this.open = false;
      dijit.popup.close(this.tooltip);
    }
  },

  setVol:function(number){
    var fmtNumber=number;
    if(number > 999999 && number <= 99999999){
      fmtNumber=number/1000000;
      fmtNumber = fmtNumber.toPrecision(4);
      //fmtNumber=dj.cr.dashboard.mdad_quotes.roundNumber(fmtNumber,3);
      fmtNumber = fmtNumber + "M";
    }else if(number > 999999){
      fmtNumber=number/1000000;
      fmtNumber = fmtNumber.toPrecision(3);
      //fmtNumber=dj.cr.dashboard.mdad_quotes.roundNumber(fmtNumber,2);
      fmtNumber = fmtNumber + "M";
    }
    return fmtNumber;
  },
  
  setDelayedChannel:function(channel){
    this.conf.delayedChannel = channel;
  },
  
  setRealTimeChannel:function(channel){
    this.conf.realTimeChannel = channel;
  }  

});
dojo.provide("dj.widget.article.ArticleTickerView");
dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");
dojo.require("dijit.TooltipDialog");
dojo.require("dj.util.Date");
dojo.require("dj.widget.article.ArticleTickerPopUpView");
dojo.require("dojo.date");


dojo.declare("dj.widget.article.ArticleTickerView", [], {
  constructor: function(container, userConf, initialData) {
    this.conf = {
        fragmentUrl : '/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?ticker=',
        popupFragmentNoCacheURL: '/public/npage/0_0_WG_Article_Ticker_Popup_Q_noCache.html?ticker=',
        TTL: "1m",
        version: 1,
        realTimeChannel : "",
        delayedChannel : "",
        enablePopup : true,
        chartRefreshTimeout : 180000
    };
    dojo.mixin(this.conf, userConf);
    this.container = container;
    this.popUpView = null;

    this.popupLoaded = false;
    this.hidePopupTimeout = 150;
    this.showPopUpTimeout = 300;
    
    if(initialData) {
      this.render(initialData);
    }
    
    if(this.conf.enablePopup) {
      this.addEvents();
    }
  },
  
  render: function(data) {
    if(data) {
      if(data.b) {
        if(data.b.y === 'premarket') {
            this.callType = "premarket";
        }else if(data.b.y === 'normal') {
          
//          if(this.callType && this.callType === "premarket"){
//            if(this.popUpView){
//              this.createPopUpView(this.conf.popupFragmentNoCacheURL);
//            }
//          }
          
          if(this.conf.realTimeChannel === '' || data.h.t === this.conf.realTimeChannel) {
            this.callType = "normal";
            var cssClass = (data.b.c >= 0) ? 'Positive':'Negative';
            var symbol = (data.b.c >= 0) ? '+':'';
            if(data.b.c === 0) {
              cssClass = 'Neutral';
              symbol = '';
            }
            var pc = this.container.getAttribute('data-pc');
            this.tickerName = this.container.getAttribute('data-ticker-name');
            this.country = this.container.getAttribute('data-country');
            var pcp = (data.b.c / pc) * 100 ;
            if(isNaN(pcp)) {
              pcp = 0;
              cssClass = 'Neutral';
              symbol = '';
            }
            if(this.container) {

              if( gcDomain.indexOf( 'marketwatch' ) !== -1 )
              {
                this.container.innerHTML = "<a href='http://www.marketwatch.com/investing/index/" + this.tickerName + "?countrycode=" + this.country + "' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.tickerName +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
              }
              else
              {
                this.container.innerHTML = "<a href='/public/quotes/main.html?type=djn&symbol="+ this.tickerName +"' class='tkrQuote tkr"+ cssClass +"'><span class='tkrName'>"+ this.tickerName +"</span>&nbsp;<span class='tkrChange'>"+symbol + pcp.toFixed(2) +"%</span></a>";
              }
            } else {
              console.error('Cannot deliver the message');
              console.log(data);
            }
            
            var theDate = data.b.z;
            if(!data.preload) {
              var offset = this.container.getAttribute('data-offset');
              offset = parseFloat(offset);
              var userOffset = new Date().getTimezoneOffset() / 60;
              offset = offset + userOffset;
              var dateObj = new Date(parseInt(theDate.replace(/[^0-9]/g,''), 10));
              dateObj = dojo.date.add(dateObj, "hour", offset);
              theDate = dj.util.Date.simpleDateFormat.format(dateObj, 'NNN d, yyyy h:mm a ');
            }
            var dataObj = {last: data.b.l, pcp: pcp, change: data.b.c, symbol: symbol, pnClass: cssClass, date: theDate};
            this.updateContainerData(dataObj);
            
          }
        }else if(data.b.y === 'aftermarket') {        
          if(this.callType && this.callType === "normal" ){
            console.log("BlueGrass market transitioned for " + data.h.t);
            if(this.popUpView){
              if(this.insideTicker ){
                if(typeof this.dylanCallPending === "undefined" || this.dylanCallPending){
                  this.createPopUpView(new Date().getTime());
                  this.dylanCallPending = false;
                }
              }else{
                this.dylanCallPending = true;
              }
            }
          }
          this.callType = "aftermarket";
        }
      }
      
      // Send the data to the popup view
      if(this.popUpView) {
        this.popUpView.render(data);
      }
    }
    return;
  },
  
  addEvents : function() {
    dojo.connect(this.container, "onmouseenter", dojo.hitch(this, function(event){
      this.insideTicker = true;
      setTimeout(dojo.hitch(this, function(){
        if(this.insideTicker) {         
          this.showPopUp();
        }
        }), this.showPopUpTimeout);
    }));
    dojo.connect(this.container, "onmouseleave", dojo.hitch(this, function(event){
      this.insideTicker = false;
      if(this.popUpView) { 
        this.popUpView.insideTicker = false; 
        setTimeout(dojo.hitch(this.popUpView,this.popUpView.close), this.hidePopupTimeout);
      }
    }));
  },
  
  showPopUp: function() {
    if(this.dylanCallPending){
      this.createPopUpView(new Date().getTime());
      this.dylanCallPending = false;
    }
    if(!this.popUpView) {
      this.createPopUpView(this.conf.version);
    } else {
      this.popUpView.show();
      this.popUpView.insideTicker = true;
    }
  },
  
  createPopUpView:function(inputVersion){
    this.popUpView = new dj.widget.article.ArticleTickerPopUpView(this.container, 
       {tickerName: this.tickerName, 
        country: this.country,
        realTimeChannel : this.conf.realTimeChannel,
        delayedChannel : this.conf.delayedChannel,        
        chartRefreshTimeout : this.conf.chartRefreshTimeout,
        version : inputVersion
       },
       dojo.hitch(this, function(){
           if(this.popUpView) {
             this.popUpView.render({b:{y:"normal", l: parseFloat(this.container.getAttribute('data-price')) , c: parseFloat(this.container.getAttribute('data-change')) , z: this.container.getAttribute('data-datetime')}, h:{t:this.conf.realTimeChannel}});
           }
       }) 
      );
  
  },
  
  updateContainerData: function(data) {
    this.container.setAttribute('data-price', data.last);
    this.container.setAttribute('data-datetime', data.date);
    this.container.setAttribute('data-change', data.change);
    this.container.setAttribute('data-changepercent', data.pcp);
  },
  
  setDelayedChannel:function(channel){
    this.conf.delayedChannel = channel;
    if(this.popUpView){
      this.popUpView.setDelayedChannel(channel);
    }
  },
  
  setRealTimeChannel:function(channel){
    this.conf.realTimeChannel = channel;
    if(this.popUpView){
      this.popUpView.setRealTimeChannel(channel);
    }
  },
  
  setAfterHourState:function(afterHourShowHide){   
    
    if(afterHourShowHide === "show"){
      if(this.popUpView){
        if(this.insideTicker ){
          if(typeof this.dylanCallPending === "undefined" || this.dylanCallPending){
            this.createPopUpView(new Date().getTime());
            this.dylanCallPending = false;
          }
        }else{
          this.dylanCallPending = true;
        }
      }
    }else if(afterHourShowHide === "hide"){
      if(this.popUpView ){      
        this.popUpView.showHideAfterHours(afterHourShowHide);
      }
    }
    
  }

  
 });
dojo.provide("dj.module.article.ticker");


dojo.require("dj.widget.fragmentloader.FragmentJSONLoader");
dojo.require("dj.service.livenews.BluegrassProvider");
dojo.require("dj.widget.article.ArticleTickerView");

dj.module.article.ticker = {
    DEFAULT_CONFIG : {
      fragmentUrl : "/public/npage/0_0_WG_Tickers_Information_Q.html?q=",
      version : 6,
      TTL : "1m",
      popupFragmentURL : "/public/npage/0_0_WG_Article_Ticker_Popup_Q.html?ticker=",
      popupFragmentNoCacheURL : "/public/npage/0_0_WG_Article_Ticker_Popup_Q_noCache.html?ticker=",
      popupTTL : "5m",
      popupVersion: 4,
      popupBaseClass : "inlineTicker",
      endURL : "",
      channelRefreshTimeout : 180000,
      chartRefreshTimeout : 180000
    },
    init: function(args) {
      this.conf = dojo.mixin(this.DEFAULT_CONFIG, args);
      this.tickerList = [];
      dojo.query("[data-widget='dj.ticker']").forEach(dojo.hitch(this, function(obj){
        var ticker = obj.getAttribute('data-ticker-name').replace(' ','').replace('&', '');
        if(dojo.indexOf(this.tickerList, ticker) === -1) {
          this.tickerList.push(ticker);
        }
      }));
      
      if(this.tickerList.length > 0) {
        this.loader = new dj.widget.fragmentloader.FragmentJSONLoader(this.conf.fragmentUrl + this.tickerList.join(',') + this.conf.endURL, 
            this._getVersion(), {TTL: this.conf.TTL});
        this._connectToLoaderEvents();
        this.loader.load();
        this.setDataRefreshTimer();
      }
    }, 
    
    _connectToLoaderEvents: function() {
   
      dojo.connect(this.loader, "onLoadJson", dojo.hitch(this, function(data){
        var obj = dojo.fromJson(data.jsonFile.data);
        this.initialDataBackupArr = [];
        this.countriesList = "";
        dojo.forEach(obj.tickers, dojo.hitch(this, function(ticker, index) {
          if(index === 0) {
            // Initialize the bluegrass provider
            this.bluegrassProvider = new dj.service.livenews.BluegrassProvider();
          }
          var placement = dojo.query("[data-widget='dj.ticker'][data-ticker-name='"+ ticker.tickerName +"']");
          placement.forEach(dojo.hitch(this, function(t){
            t.setAttribute('data-pc', ticker.pc);
            t.setAttribute('data-ticker-name', ticker.tickerName.toUpperCase());
            t.setAttribute('data-ticker', ticker.name.toUpperCase());
            t.setAttribute('data-company-name', ticker.commonName);
            t.setAttribute('data-price', ticker.price);
            t.setAttribute('data-volume', ticker.volume);
            t.setAttribute('data-datetime', ticker.tickerDateTime);
            t.setAttribute('data-offset', ticker.offset);
            t.setAttribute('data-iso', ticker.iso);
            t.setAttribute('data-change', ticker.netChange);
            t.setAttribute('data-changepercent', ticker.changePercent);
            t.setAttribute('data-country', ticker.country);
            t.setAttribute('id', Math.random());
            var view = new dj.widget.article.ArticleTickerView(t, 
                {
                  TTL: this.conf.popupTTL, 
                  fragmentUrl: this.conf.popupFragmentURL, 
                  popupFragmentNoCacheURL: this.conf.popupFragmentNoCacheURL,
                  version: this._getPopupVersion(), 
                  baseClass : this.conf.popupBaseClass,
                  delayedChannel : ticker.delayedChannel,
                  realTimeChannel : ticker.realTimeChannel,
                  chartRefreshTimeout : this.conf.chartRefreshTimeout
                },
                {
                  b:{
                     y:"normal", 
                     c:parseFloat(ticker.netChange.replace(',','')) , 
                     l:parseFloat(ticker.price.replace(',','')), 
                     z:ticker.tickerDateTime 
                  },
                  h:{
                    t:ticker.realTimeChannel
                  },
                  preload: true
                });
            
            if(ticker.realTimeChannel && ticker.realTimeChannel !== "") {
              this.bluegrassProvider.subscribeToChannel(ticker.realTimeChannel, view);
            }
            
            if(ticker.delayedChannel && ticker.delayedChannel !== "") {
              this.bluegrassProvider.subscribeToChannel(ticker.delayedChannel, view);
            }
            
            
            
            var initialDataBackup = {
                viewObj : view,
                realTimeChannel : ticker.realTimeChannel,
                delayedChannel : ticker.delayedChannel,
                tickerName : ticker.name.toUpperCase(),
                country : ticker.country,
                tickerDateTime: ticker.tickerDateTime,
                marketState: ticker.marketState
            };
            
            this.initialDataBackupArr.push(initialDataBackup);
            
            if(this.countriesList === ""){
               this.countriesList = ticker.country;
            }else if(this.countriesList.indexOf(ticker.country) === -1){
              this.countriesList = this.countriesList + ticker.country;
            }
            
          }));
        }));
        if(this.bluegrassProvider) {
          try{
            this.bluegrassProvider.connect();
          }catch(e){
              try{
                this.bluegrassProvider.connect();
              }catch(e1){
                this.blueGrassConnectionFailed = true;
                console.err("connection to blueGrass provider failed" + e1);
              }
            
          }
        }
      }));
    },
    
    
    setDataRefreshTimer:function(){
      setTimeout(dojo.hitch(this,function(){
        this.initRefresh();
        this.setDataRefreshTimer();
      }), this.conf.channelRefreshTimeout, null);
    },
    
    initRefresh: function(args) {
      console.log("refreshing channel " + new Date());
      if(this.tickerList.length > 0) {
        var queryParam = "&country=" + this.countriesList;
        this.refreshLoader = new dj.widget.fragmentloader.FragmentJSONLoader(this.conf.fragmentUrl + this.tickerList.join(',') + queryParam + this.conf.endURL, 
            this._getVersion(), {TTL: this.conf.TTL});
        this._connectToRefreshLoaderEvents();
        this.refreshLoader.load();
      }
    }, 
    
    _connectToRefreshLoaderEvents:function(){

      dojo.connect(this.refreshLoader, "onLoadJson", dojo.hitch(this, function(data){
        var connectAgain = false;
        var obj = dojo.fromJson(data.jsonFile.data);
        dojo.forEach(obj.tickers, dojo.hitch(this, function(ticker, index) {
              
              var placement = dojo.query("[data-widget='dj.ticker'][data-ticker-name='"+ ticker.tickerName +"']");
              placement.forEach(dojo.hitch(this, function(t){
                var index = -1;
                var backupObj = null;
                for(i=0;i<this.initialDataBackupArr.length;i++){
                  backupObj = this.initialDataBackupArr[i];
                  if(backupObj.tickerName === ticker.name.toUpperCase()){
                    index = i;
                    break;
                  }
                }
                connectAgain = false;
                if(backupObj){
                    if(backupObj.realTimeChannel){
                      if(ticker.realTimeChannel){
                          if(backupObj.realTimeChannel !== ticker.realTimeChannel  ){
                            connectAgain = true;
                            console.log("subscribing to realtime channel again ************** " + ticker.realTimeChannel);
                             backupObj.viewObj.setRealTimeChannel(ticker.realTimeChannel);
                             this.bluegrassProvider.subscribeToChannel(ticker.realTimeChannel, backupObj.viewObj);
                             if(index >= 0){
                                 this.initialDataBackupArr[index].realTimeChannel = ticker.realTimeChannel;
                             }
                          }
                      }
                    }else{
                      if(ticker.realTimeChannel){
                          connectAgain = true;
                          console.log("subscribing to realtime channel again ************** " + ticker.realTimeChannel);
                          backupObj.viewObj.setRealTimeChannel(ticker.realTimeChannel);
                          this.bluegrassProvider.subscribeToChannel(ticker.realTimeChannel, backupObj.viewObj);
                          if(index >= 0){
                            this.initialDataBackupArr[index].realTimeChannel = ticker.realTimeChannel;
                          }
                      }
                    }
                    
                    
                      if(backupObj.delayedChannel){
                        if(ticker.delayedChannel){
                            if(backupObj.delayedChannel !== ticker.delayedChannel  ){
                               connectAgain = true;
                               console.log("subscribing to delayed channel again ************** " + ticker.delayedChannel);
                               backupObj.viewObj.setDelayedChannel(ticker.delayedChannel);                               
                               this.bluegrassProvider.subscribeToChannel(ticker.delayedChannel, backupObj.viewObj);   
                               if(index >= 0){
                                 this.initialDataBackupArr[index].delayedChannel = ticker.delayedChannel;
                               }
                            }
                        }
                      }else{
                        if(ticker.delayedChannel){
                            connectAgain = true;
                            console.log("subscribing to delayed channel again ************** " + ticker.delayedChannel);
                            backupObj.viewObj.setDelayedChannel(ticker.delayedChannel);
                            this.bluegrassProvider.subscribeToChannel(ticker.delayedChannel, backupObj.viewObj); 
                            if(index >= 0){
                              this.initialDataBackupArr[index].delayedChannel = ticker.delayedChannel;
                            }
                        }
                      }
                      
                      if(backupObj.marketState === "Premarket" && ticker.marketState === "Normal"){
                        console.log("dylan morning market transitioned for " + backupObj.tickerName);
                        backupObj.viewObj.setAfterHourState("hide");
                        backupObj.viewObj.setRealTimeChannel(ticker.realTimeChannel);
                        if(index >= 0){
                          this.initialDataBackupArr[index].marketState = ticker.marketState;
                          this.initialDataBackupArr[index].realTimeChannel = ticker.realTimeChannel;
                        }
                        
                      }
                      if(backupObj.marketState === "Normal" && ticker.marketState === "AfterHours"){
                        console.log("dylan evening market transitioned for " + backupObj.tickerName);
                          backupObj.viewObj.setAfterHourState("show");
                          if(index >= 0){
                            this.initialDataBackupArr[index].marketState = ticker.marketState;
                          }
                      }
                      if(connectAgain){
                        try{
                            this.bluegrassProvider.connect();
                        }catch(e1){
                            this.blueGrassConnectionFailed = true;
                            console.err("connection to blueGrass provider failed" + e1);
                        }
                      }
                }
         // }
            
            
          }));
        }));
        if(this.blueGrassConnectionFailed) {
          try{
            this.bluegrassProvider.connect();
          }catch(e){
              try{
                this.bluegrassProvider.connect();
              }catch(e1){
                this.blueGrassConnectionFailed = true;
                console.err("connection to blueGrass provider failed" + e1);
              }
            
          }
        }
      }));
    
    },
    
    /**
     * If we're in debugMode (chip or query param), 
     * then the current time will be used as version.
     */
    _getVersion: function() {
      var d = new Date(),
          ctxVersion = this.conf.version;

     // v = [ctxVersion, this.cfg.version].join("");

      if (dojo.doc.location.toString().indexOf("debugMode") > -1) {
         ctxVersion = d.getTime();
      }

      return ctxVersion;
    },
    
    /**
     * If we're in debugMode (chip or query param), 
     * then the current time will be used as version.
     */
    _getPopupVersion: function() {
      var d = new Date(),
          ctxVersion = this.conf.popupVersion;

     // v = [ctxVersion, this.cfg.version].join("");

      if (dojo.doc.location.toString().indexOf("debugMode") > -1) {
         ctxVersion = d.getTime();
      }

      return ctxVersion;
    }
    
    
    
};

dojo.provide("dj.widget.newsreel.NewsReelLoader");dojo.require("dj.widget.fragmentloader.FragmentLoader");dojo.require("dj.util.user.EnvironmentDao");dojo.require("dj.util.Region");dojo.require("dj.util.User");dojo.declare("dj.widget.newsreel.NewsReelLoader",dj.widget.fragmentloader.FragmentLoader,{NEWSREEL_CONFIG:{newsreelContainer:"newsReel",adRegisterKey:"newsReelAd",TTL:"24h"},constructor:function(userEnv,mstPageId,version,domNodeId,config){this.cfg=dojo.delegate(this.DEFAULT_CONFIG,this.NEWSREEL_CONFIG);dojo.mixin(this.cfg,config);var dataset=dj.util.Element.getDataset(dojo.byId(domNodeId)||{});if(dataset){this.mstPageId=dataset.newsreelpage||this.mstPageId;}
this.cfg.isLoadCss=false;this.cfg.isLoadJs=false;this._initNewsReelRenderers();console.info("this.cfg.isLoadHtml="+this.cfg.isLoadHtml);},onHtmlLoad:function(){dj.module.newsReel.init(this.cfg.newsreelContainer,this.cfg.adRegisterKey);},_initRenderers:function(){},_initNewsReelRenderers:function(){var localContextCore=dojo.clone(dj.context.core);this.userEnv=this._getUserEnv();localContextCore.customCacheCdnPrefix=dj.context.core.cdnPrefix;var fragmentDao=new dj.widget.fragmentloader.dao.FileServiceDao(dj.util.io.script,localContextCore,{TTL:this.cfg.TTL});var checker=new dj.util.PollingConditionChecker();this.fragmentBo=new dj.widget.fragmentloader.bo.FragmentBo(fragmentDao,this.userEnv,this.cfg);this.fileRenderer=new dj.widget.fragmentloader.renderer.FileRenderer(dj.util.animation,checker);},_getUserEnv:function(){var env=this.userEnv;if(!env){var dao=new dj.util.user.EnvironmentDao(dj.util.Region,dj.util.User);env=dao.getEnvironment();}
return env;}});
dojo.provide("dj.module.CCS");dojo.require("dj.lang");dojo.require("dj.util.Cookie");dojo.require("dj.util.User");dj.module.CCS={init:function(cfg){this._cfg=dj.lang.cloneMixin(this.DEFAULT_CONFIG,cfg);this.product='WSJ';var prefixDtext=(typeof window.nSP!='undefined')?window.nSP:"";this.dtext=['<table cellpadding="0" cellspacing="0" border="0" width="100%"><tr>','<td class="p10" style="padding:4px 0px 5px 0px;border-right:1px solid #9BADCE;" align="center"><a href="'+prefixDtext+'/acct/setup_account" class="unvisited p10">My Account</a></td>','<td class="p10" style="padding:4px 0px 5px 0px;border-right:1px solid #9BADCE;" align="center"><a href="'+prefixDtext+'/msgcenter/view_messages.html?product='+this.product+'" class="unvisited p10">Messages</a></td>','<td class="p10" style="padding:4px 0px 5px 0px;" align="center"><a href="'+prefixDtext+'/setup/setup_center_mainpage" class="unvisited p10">Preferences</a></td>','</tr></table>'];var prefixAtext=(typeof window.nSP!='undefined')?window.nSP:"";this.atext=['<a href="'+prefixAtext+'/msgcenter/view_messages.html?product='+this.product+'">','<img src="/img/message_alert_icon.gif" border="0" width="25" height="16" style="padding:0px;margin:0px;vertical-align:middle;"/><span class="p11" style="vertical-align:middle;">You have an important message</span>','</a>'];var prefixNtext=(typeof window.nSP!='undefined')?window.nSP:"";this.ntext=['<a href="'+prefixNtext+'/msgcenter/view_messages.html?product='+this.product+'">','<img src="/img/message_icon_WSJ.gif" border="0" width="15" height="11" style="padding:0px;margin:0px;vertical-align:middle;"/><span class="p11" style="vertical-align:middle;">You have a new message</span>','</a>'];},DEFAULT_CONFIG:{product:null,messageCenterRequest:null,messageCenterTimeout:null,displayedInterstitialRequest:null,displayedInterstitialTimeout:null,readRequest:null,readTimeout:null,getContentRequest:null,getContentTimeout:null,changeOrderRequest:null,changeOrderTimeout:null,dtext:null,atext:null,ntext:null,VarX:null,y:null,z:null},changeStyle:function(httpRequest,msgid){var v=document.getElementById('m_'+msgid+'_f');v.style.fontWeight='';v=document.getElementById('m_'+msgid+'_s');v.style.fontWeight='';v=document.getElementById('m_'+msgid+'_r');v.style.fontWeight='';v=document.getElementById('m_'+msgid+'_e');v.style.fontWeight='';},displayMessages:function(httpRequest){var m=document.getElementById("messages");m.innerHTML=httpRequest.xhr.responseText;},closeMessage:function(){this.y.style.display='none';this.VarX.style.display='none';},checkAll:function(){var f=document.getElementById("mform");var num=f.elements.length;for(var i=0;i<num;i++){var e=f.elements[i];if(e.type=='checkbox'){e.checked=true;}}},uncheckAll:function(){var f=document.getElementById("mform");var num=f.elements.length;for(var i=0;i<num;i++){var e=f.elements[i];if(e.type=='checkbox'){e.checked=false;}}},displayDiv:function(content,mid,mname,isInterstitial){this.VarX=dojo.byId('modal');this.y=dojo.byId('message');this.z=dojo.byId('messagecontent');this.z.innerHTML=content;this.y.style.zIndex=1000000001;this.y.style.display='block';this.y.style.overflow='hidden';this.VarX.style.zIndex=1000000000;this.VarX.style.display='block';this.VarX.style.height=document.body.scrollHeight+'px';var s;if(typeof s==='undefined'){s=(typeof window.s!='undefined')?window.s:"";}
if(s!==""){s.events="event30";if(isInterstitial){s.eVar30='WSJ Interstitial - '+mname;}else{s.eVar30='WSJ Message - '+mname;}
s.linkTrackVars="eVar30,events";s.linkTrackEvents="event30";if(isInterstitial){s.tl(true,'o','WSJ Interstitial - '+mname);}else{s.tl(true,'o','WSJ Message - '+mname);}}},showInterstitialContent:function(content,mid,uid,umid,mname){var tmp='';try{tmp=(new XMLSerializer()).serializeToString(content);}catch(e){tmp=content.xml;}
tmp=tmp.replace(/&amp;/g,'&');tmp=tmp.replace(/<user\/>/g,userName);tmp=tmp.replace(/gotosite/g,'WSJ.com');tmp=tmp.replace(/myacctsite/g,'https://commerce.wsj.com/myaccount/do/viewBillingInfo');tmp=tmp.replace(/modvalue/g,'mc_wsj_interstitial_'+mname);tmp=tmp.replace(/<site_name\/>/g,'WSJ.com');tmp=tmp.replace(/site/g,'wsj');tmp=tmp.replace(/msgbg/g,'#364A92');var d=new Date();tmp=tmp.replace(/<year\/>/g,d.getFullYear());tmp=tmp.substring(9,tmp.indexOf("</content>"));this.displayDiv(tmp,mid,mname,true);this.sendDisplayedInterstitialRequest(uid,umid);},processTop:function(httpRequest){try{var strDtext=this.dtext.join("");var strAtext=this.atext.join("");var strNtext=this.ntext.join("");var message=httpRequest.xhr.responseXML.getElementsByTagName("message")[0];if(message!==null){if(message.firstChild!==null){var mid=(message.getElementsByTagName("mid")[0]).firstChild.nodeValue;var uid=(message.getElementsByTagName("uid")[0]).firstChild.nodeValue;var umid=(message.getElementsByTagName("umid")[0]).firstChild.nodeValue;var mname=(message.getElementsByTagName("messageid")[0]).firstChild.nodeValue;var priority=message.getElementsByTagName("priority")[0];var display=message.getElementsByTagName("display")[0];if(display!==null){var dvalue=display.firstChild.nodeValue;if(dvalue=='true'){var content=message.getElementsByTagName("content")[0];this.showInterstitialContent(content,mid,uid,umid,mname);}else{if(priority!==null){var value=priority.firstChild.nodeValue;if(value==1){dojo.byId('msgCenter').innerHTML=strAtext;dj.util.Cookie.setCookie('CMCAlert',strAtext,1);}else{dojo.byId('msgCenter').innerHTML=strNtext;dj.util.Cookie.setCookie('CMCAlert',strNtext,1);}}}}else{dojo.byId('msgCenter').innerHTML=strDtext;}}else{dojo.byId('msgCenter').innerHTML=strDtext;}}else{dojo.byId('msgCenter').innerHTML=strDtext;}
return true;}catch(e){console.error("Exception while processing response",e);return false;}},reloadMessageCenter:function(){this.init();var cmcalertcookie=dj.util.Cookie.getCookie("CMCAlert");if(cmcalertcookie!==null){dojo.byId('msgCenter').innerHTML=cmcalertcookie;}
var cmccookie=dj.util.Cookie.getCookie("CMC");if(cmccookie===null){if(this.messageCenterRequest!==null){this.messageCenterRequest=null;}
dj.util.Cookie.setCookie('CMC','top',1);var processX;var d=new Date();var dataUrl='/msgcenter/top_message.html';var dataUrlParams={product:this.product,d:d.getTime()};var that=this;dojo.xhrGet({url:dataUrl,content:dataUrlParams,load:function(data,ioargs){processX=that.processTop(ioargs);},error:function(exception,ioargs){console.error('Exception occured during Ajax Request to retrieve data: %o',exception);}});}},sendDisplayedInterstitialRequest:function(uid,umid){if(this.displayedInterstitialRequest!==null){this.displayedInterstitialRequest=null;}
var params={uId:uid,umId:umid,product:this.product};var postUrl='/msgcenter/displayed_interstitial.html';var that=this;dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(params),error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(data,ioargs){that.reloadMessageCenter();}});},sendReadRequest:function(msgid,umid){if(this.readRequest!==null){this.readRequest=null;}
var params={umId:umid,product:this.product};var postUrl='/msgcenter/read_message.html';var that=this;dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(params),error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(data,ioargs){that.changeStyle(ioargs,msgid);that.reloadMessageCenter();}});},showMessage:function(httpRequest,msgid,umid,mname){var message=httpRequest.xhr.responseText.replace(/&amp;/g,'&');var ccsuser1=document.getElementById('CCS_USER');if(ccsuser1){dj.util.User.renderCallsign(ccsuser1);}
message=message.replace(/gotosite/g,'WSJ.com');message=message.replace(/myacctsite/g,'https://commerce.wsj.com/myaccount/do/viewBillingInfo');message=message.replace(/modvalue/g,'mc_wsj_message_'+mname);var d=new Date();message=message.replace(/<year\/>/g,d.getFullYear());message=message.replace(/<site_name\/>/g,'WSJ.com');message=message.replace(/site/g,'wsj');message=message.replace(/msgbg/g,'#364A92');dj.util.Cookie.setCookie('CMCAlert','',-1);this.displayDiv(message,msgid,mname,false);this.sendReadRequest(msgid,umid);},loadMessageContent:function(msgid,uid,umid,read,mname){if(this.getContentRequest!==null){this.getContentRequest=null;}
var dataUrl='/msgcenter/get_message.html?messageId='+msgid+'&product='+this.product;var that=this;dojo.xhrGet({url:dataUrl,load:function(data,ioargs){that.showMessage(ioargs,msgid,umid,mname);},error:function(exception,ioargs){console.error('Exception occured during Ajax Request to retrieve data: %o',exception);}});},sendChangeOrderRequest:function(order,product){if(this.changeOrderRequest!==null){this.changeOrderRequest=null;}
var dataUrl='/msgcenter/order_messages.html?order='+order+'&product='+product;var that=this;dojo.xhrGet({url:dataUrl,load:function(data,ioargs){that.displayMessages(ioargs);},error:function(exception,ioargs){console.error('Exception occured during Ajax Request to retrieve data: %o',exception);}});},updateusermessagestatuscode:function(){if(this.readRequest!==null){this.readRequest=null;}
var params={product:this.product};var postUrl='/umsl/user_messages/do_not_show';var that=this;dojo.xhrPost({url:postUrl,postData:dojo.objectToQuery(params),error:function(exception,ioargs){console.error('Exception occured while posting posting Ajax Request : '+exception);},handle:function(data,ioargs){that.reloadMessageCenter();}});}};dojo.provide("dj.module.globalNav");

dj.module.globalNav = {
  setupQuicklinks : function(globalSubNavId, quicklinksContainerId){
    this.oHideQuickLinks = dojo.query('.hideQuickLinks');
    this.oGlobalSubNav = dojo.byId(globalSubNavId);
    this.oQuicklinksContainer = dojo.byId(quicklinksContainerId);
    
    if(typeof this.oHideQuickLinks === 'undefined'){
      if(this.oGlobalSubNav === null){
        if(this.oQuicklinksContainer != null){
          dojo.removeClass(this.oQuicklinksContainer,"subnav_hide");
          dojo.addClass(this.oQuicklinksContainer,"subnav_show");
        }
      }
    }
  }
};
/* global document, dj, dojo, console, Ajax */
dojo.provide("dj.module.header.localWeather");
dojo.require("dj.util.Cookie");
dojo.require("dj.util.User");

/* Local Weather:
 *   This module sets the user's local weather in the WSJ header.  Currently
 *   there are strict xhtml dependencies to the wsj header structure.  This
 *   code will update several cookies and the pzn service to store the
 *   weather data.  The weather data will be populated next to the timestamp.
 *
 * TODO: Move the utility functions at the bottom into the utilities bundle.
 *
 * Testing Commands: (use this to clear the cookie cache)
 *   dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherUser");
 *   dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherCode");
 *   dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherExpire");
 *   dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherJson");
 *
 *   Config with defaultLocation overridden:
 *   dj.module.header.localWeather.init({defaultLocation:"08054"});
 */

(function() {

  dj.module.header.localWeather = {
    init : function(cfg) {

      var defaultConfig = {
        defaultLocation   : "10005",
        expireInterval    : "1200", // in seconds
        htmlService       : "/public/page/0_0_WC_HeaderWeather",
        populateEl        : "weatherContent",
        iframeId          : "iframeweatherDetails",
        iframeParam       : "location",
        locationNameId    : "locationName",
        pznUrl            : "/pznusersvc/update/user/profile",
        setPznWeatherUrl  : "/pznusersvc/view/user/profile?profileType=weatherCode",
        redirectUrl       : "http://commerce.wsj.com/auth/login",
        locationSavedTxt  : "Default location saved"
      };

      dojo.mixin(defaultConfig, cfg);
      this.config = defaultConfig;
      this.cookieWeatherCode = this.getCookie("weatherCode");
      this.cookieWeatherJson = this.getCookie("weatherJson");

      // limiting the header weather to US region
      if (dj.util.Region.getViewByRegion() == "na,us") {
        this._load();
      }
    },

    /**
     * Loads the weather data in the WSJ header.  Weather data can be pulled
     * from cookie data or the PZN service, assuming the user is logged in.
     * Load essentially retrieves the weather data and sets appropriate cookie
     * data to optimize future requests.
     *
     * TODO: Update code to disallow non reg/freereg users
     *
     */
    _load : function() {
      var that = this;

      dj.util.User.isLoggedIn(function(isLoggedIn) {
        if (isLoggedIn) {
          dj.util.User.getUserId(function(userId) {
            if (that.getCookie("weatherUser") == userId) {
              try {
                that.populateHeaderJson(dojo.fromJson(that.cookieWeatherJson));
              }
              catch(err) { // just show default weather if the cookies are screwed up
                var wc = that.getCookie("weatherCode");
                if (wc) {
                  that.getHTML(wc);
                }
                else {
                  that.getHTML(that.config.defaultLocation);
                }
              }
            }
            else {
              that.clearWeatherCookies();
              that.getPznLocalWeather();
            }
          });
        }
        else {
          if (that.isExpired("weatherExpire")) {
            that.getHTML(that.config.defaultLocation);
          }
          else {
            if (that.getCookie("weatherCode") == that.config.defaultLocation) {
              if (that.cookieWeatherJson) {
                that.populateHeaderJson(dojo.fromJson(that.cookieWeatherJson));
              }
              else {
                that.getHTML(that.config.defaultLocation);
              }
            }
            else {
              that.getHTML(that.config.defaultLocation);
            }
          }
        }
      });
    },

    /**
     * Retrieves weather XHTML for ajax requests
     *
     * @param {String}
     *          location, location code (zip code).  Service requires a
     *          location to pull weather data from.
     */
    getHTML : function(location) {
      var that = this;

      dojo.xhrGet( {
         url : that.config.htmlService+'-'+location+".html",
         headers : {
           Accept : 'application/html'
         },
         handleAs : "text",
         load : function(response, ioArgs) {
           var requestStatus = ioArgs.xhr.getResponseHeader('Status');

           // don't do any dom manipulation if the xhtml service fails
           if (response.match(/<ul class="local-info">/)) {
             that.populateHeaderHtml(response);

             dj.util.User.getUserId(function(userId) {
               that.setCookie("weatherUser", userId);
             });

             that.setCookie("weatherJson", dojo.toJson(that.parseHTML(response)));
             that.setCookie("weatherExpire", that.calcDate(that.config.expireInterval+"s+"));
             that.setCookie("weatherCode", location);
           }
           else {
             console.error("Could not pull weather from xhtml service.");
           }
         },
         error: function(response, ioArgs) {
           console.error("HTTP status code: ", ioArgs.xhr.status);
           return response;
         }
      });
    },

    /**
     * Updates DOM with xhtml content
     *
     * @param {String}
     *          content, xhtml content pulled from an xhtml service
     */
    populateHeaderHtml : function(content) {
      dojo.byId(this.config.populateEl).innerHTML = content;
    },

    /**
     * Populates Header with weather data pulled from weatherJson cookie
     *
     * @param {Object}
     *          weatherJson, Object with weather data pulled from weatherJson
     *          cookie.
     */
    populateHeaderJson : function(weatherJson) {
      var icon = dojo.byId('w_icon');
      var location = dojo.byId('w_location');

      dojo.addClass(icon, "wsj-"+weatherJson.image);
      dojo.byId('w_high').innerHTML = weatherJson.high + "&#186;";
      dojo.byId('w_low').innerHTML = weatherJson.low + "&#186";

      icon.href = weatherJson.url;
      location.href = weatherJson.url;
      location.innerHTML = weatherJson.city;

      dojo.removeClass(dojo.query(".temperature.divider")[0], "hidden");
    },

    /**
     * Populates Header with weather data pulled from the pzn service
     */
    populateFromPznSvc : function() {
      var pznHTML = this.getHTML(pznWeather);
      this.setCookie("weatherCode", pznWeather);
      this.populateHeaderHtml(pznHTML);
      this.setLocalWeatherJson(pznHTML);
    },

    /**
     * Wrapper to get DJ cookie data
     *
     * @param {String}
     *          name, name of sub-cookie value to be retrieved
     */
    getCookie : function(name) {
      return dj.util.Cookie.getGroupCookie("DJCOOKIE", name);
    },

    /**
     * Wrapper to set DJ cookie data
     *
     * @param {String}
     *          name, name of sub-cookie value to be set
     * @param {String}
     *          value, value of sub-cookie to be set
     */
    setCookie : function(name, value) {
      dj.util.Cookie.setGroupCookie("DJCOOKIE", name, value, 365);
    },

    /**
     * Writes weather data to weatherJson cookie from the parsed htmlFragment.
     *
     * @param {String}
     *          htmlFragment, fragment of header code to parse into weatherJson cookie
     */
    setLocalWeatherJson : function(htmlFragment) {
      dj.util.Cookie.setGroupCookie("DJCOOKIE", "weatherJson", dojo.fromJson(this.parseHTML(htmlFragment)), 365);
    },

    /**
     * This method is specifically for setting the User's local weather on the Accuweather
     * detail page (0_0_WP_AccuWeather_Details).  On that page exists an iFrame to accuweather
     * that has the location code stored in the iFrame src attribute, named "location".  We
     * then update the pzn service with the code (if the user is logged in), delete existing
     * weather cookies and re-run the weather initialization.
     *
     * @param {String}
     *          locationEl, ID of the iframe you are targeting
     */
    setDefaultLocation : function(locationId) {
      var that = this;
      var locationEl = dojo.byId(locationId);
      var iFrameParam =  that.getIframeParam(this.config.iframeId, this.config.iframeParam);
      var locationCode = iFrameParam !== "" ? iFrameParam : this.config.defaultLocation;

      dojo.byId(this.config.locationNameId).innerHTML = unescape(this.getIframeParam(that.config.iframeId, "name"));

      dj.util.User.isLoggedIn(function(isLoggedIn) {
        if (isLoggedIn) {
          if (locationCode != that.getCookie("weatherCode")) {
            dojo.connect(locationEl, "click", function(ev) {
              dojo.stopEvent(ev);
              that.clearWeatherCookies();
              that.setPznLocalWeather(locationCode);
              that.getHTML(locationCode);
              dojo.addClass(locationEl, "hidden");
              dojo.place("<span style='font-size:1.1em'>"+that.config.locationSavedTxt+"</span>", locationEl, "before");
            });
          }
          else {
            dojo.addClass(locationEl, "hidden");
          }
        }
        else {
          dojo.connect(locationEl, "click", function(ev) {
            dojo.stopEvent(ev);
            window.location = that.getCommerceRedirectUrl();
          });
        }
      });
    },

    /**
     * Parses HTML into json object.  The regular expressions are very sensitive to xhtml
     * changes.  Whenever and xhtml change happens, this function should be tested.  In the
     * event of a failure, the error will be caught and should not produce a catastrophic
     * breakage.
     *
     * @param {String}
     *          htmlFragment, fragment of header code to be parsed by regex's
     */
    parseHTML : function(frag) {
      try {
        var city      = frag.match(/([^>]*)<\/a>/)[1];
        var imageCode = frag.match(/class="wsj-(\d*)/)[1];
        var high      = frag.match(/(\d+)&#186;/g)[0].match(/\d*/);
        var low       = frag.match(/(\d+)&#186;/g)[1].match(/\d*/);
        var url       = frag.match(/href\="([^"]*)/)[1];

        return {city: city, image: imageCode, high: high, low: low, url: url};
      }
      catch(err) {
        console.error("Unable to parse xhtml service: %s",err);
        return false;
      }
    },

    /**
     * Asynchronous request to pull in weather data from pzn service.  User must be
     * logged in and have populated their pzn settings with their local weather.  PZN
     * service knows if the user is logged in, so there is no need to pass that status.
     */
    getPznLocalWeather : function() {
      var that = this;
      dojo.xhrGet( {
       url : that.config.setPznWeatherUrl,
       headers : {
         Accept : 'application/json'
       },
       handleAs : "json",
       load : function(response, ioArgs) {
         var requestStatus = ioArgs.xhr.getResponseHeader('Status');

         if ( 200 !== ioArgs.xhr.status ) {
           console.error("Error message: Service is not working with Error Code: " + ioArgs.xhr.status);
           return;
         }
         var profileData = response.User.profileData[0];

         if (profileData !== undefined) {
           that.getHTML(profileData.weatherCode);
         }
         else {
           that.getHTML(that.config.defaultLocation);
         }
       },
       error: function(response, ioArgs) {
         console.error("HTTP status code: ", ioArgs.xhr.status);
         return response;
       }
      });
    },

    /**
     * Sets a Reg/FreeReg user's local weather code (most often a zip code)
     *
     * @param {String}
     *          code, local weather code (zip code)
     */
    setPznLocalWeather : function(code) {
      var data = {"profileType":"weatherCode","profileName":"weatherCode","params":[{"weatherCode": code}]};

      var xhrArgs = {
        url: this.config.pznUrl,
        postData: dojo.toJson(data),
        handleAs: "json",
        contentType: "application/json",
        accept: "application/json",
        load: function(data){},
        error: function(error){}
      };
      var deferred = dojo.xhrPost(xhrArgs);
    },

    /**
     * Delete DJCOOKIE group cookie related to custom weather settings
     */
    clearWeatherCookies : function() {
      dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherUser");
      dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherCode");
      dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherExpire");
      dj.util.Cookie.deleteGroupCookie("DJCOOKIE", "weatherJson");
    },

    // TODO: Move utilities below to utilities bundle **********

    /**
     * Returns a url to commerce login with the current page as the redirect (after success)
     *
     * TODO: detect whether a "?" or "&" should be passed
     * @param {String}
     *          urll, param to point to commerce login page, not required
     */
    getCommerceRedirectUrl : function(urll) {
      var url = urll || this.config.redirectUrl;
      return url+"&url="+escape(window.location);
    },

    /*
     * @param D: ##(m|d|s)(+|-)
     * @examples: "9d+", 9 days in future, "90s+", 90 seconds in future, "30m-" 30 months in past
     */
    calcDate :function(D){
      // args TimeValue & (Months|Days|Seconds) & (+|-)
      var MS = this.calcMilliseconds(D), dO = new Date();
      dO.setTime((D.substring(D.length-1,D.length)=="+")?dO.getTime()+MS:dO.getTime()-MS);
      return dO.toGMTString();
    },

    calcMilliseconds : function(D) {
      // args TimeValue & (Months|Days|Seconds) & (+|-)
      var TD=D.substring(0,D.length-2),TC=D.substring(D.length-2,D.length-1).toLowerCase(),MS=0;
      MS=(TC=="m")?TD*((24*60*60*1000)*30):MS;
      MS=(TC=="d")?TD*(24*60*60*1000):MS;
      MS=(TC=="s")?TD*1000:MS;
      return MS;
    },

    isExpired : function(cookieName) {
      var expireTime = new Date(this.getCookie(cookieName));
      var status = expireTime - (new Date());

      if (status > 0) { // cookie has not expired
        return false;
      }
      else { // cookie has expired
        return true;
      }
    },

    getIframeParam : function(iframeId, name) {
      var iframeSrc = dojo.byId(iframeId).src;
      var location = name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");
      var regexS = "[\\?&]" + location + "=([^&#]*)";
      var regex = new RegExp( regexS );
      var results = regex.exec(iframeSrc);

      if( results === null ) {
        return "";
      }
      else {
        return results[1];
      }
    }
  };
 }());
dojo.provide("dj.module.header.sectionMenu");
dojo.require("dj.widget.panel.LiveModalPanel");
dojo.require("dj.util.Element");
dojo.require("dj.lang");
dojo.require("dj.widget.panel.SelectDropdownPanel");

(function() {
  dj.module.header.sectionMenu = {
    init: function() {      
      // functions automatically called
	    var isInitDone = false;
      this.delayedMouseOver("._exp", function(el) {
        if (!isInitDone) {
          this.initializeHeaderPanels();
          this.setEvents();
          isInitDone = true;
        }
        this.initShowData(el);
      }, 250);

      this.fadeInArrows();
    },

    /**
     * Initialize Panels object for menu dropdown
     * 
     */  
    initializeHeaderPanels: function() {
      var headerMenu = new dj.widget.panel.LiveModalPanel(
      {
        container : ".linklist_dropdown .wsjmn_dropdown_container",
        containerInd : ".linklist_dropdown .wsjmn_dropdown_container .mnExpand",
        dropdownContent : ".wsjmn_dropdownContent",
        actionEvent : "click",
        stateContainer : ".wsjmn_dropdownTree",
        stateCollapsed : "wsjmn_ddState-collapsed",
        stateExpanded : "wsjmn_ddState-expanded",
        navContainer : ".pmMainNav",
        stateHover : "mndd_ddState-hover",
        queryUpClass : "wsjmn_dropdownTree",
        addMouseEvents : false
      });
    },

    initShowData: function(el) {
      var svcUrl = this.getDropdownIndex(el);
      var ddi = dj.util.Element.getDataset(el).dropdownindex;
      var ddiEl = dojo.byId(ddi+"_content");
      
      this.showData(svcUrl, ddiEl, el);
    },

    showData: function(svcUrl, ddiEl, dataEl) {
      var that = this;
      var initDelay = false;

      initDelay = setTimeout(function() {
        // data class ensures that multiple requests aren't initiated by the click and mouseover events 
        if ((dojo.hasClassName(dataEl, "_data") === false)) {
          dojo.addClass(dataEl, '_data');
          that.getHTML(svcUrl, ddiEl, dataEl);  // replaces spinner html with menu content
        }
      });
    },
    
    getDropdownIndex: function(el) {
      var sEl = dj.util.Element.getDataset(el);
      var svcEl = dj.util.Element.getDataset(dojo.byId(sEl.dropdownindex));
      return svcEl.panelServiceUri;
    },

    setIframeShimHeights: function(el) {
      var elData = dj.util.Element.getDataset(el).dropdownindex;
      var elNum = elData.match(/(\d.*)/)[0];
      var iFrameId = "wsjmn_dropdown_iframe"+elNum;
      var dropdownId = "wsjmn_dropdown"+elNum+"_content";
      var content = dojo.byId(dropdownId);
	    var iFrameEl = dojo.byId(iFrameId);
	  
	    for (var i=0;i<=content.length - 1;i++) {
	      try {
	        iFrameEl.offsetHeight = dojo.byId("wsjmn_dropdown_content"+elNum).offsetHeight;
	      }
	      catch(err) {}       
	    }

	    try {
	      iFrameEl.offsetHeight = dojo.byId("wsjmn_dropdown_content"+elNum).offsetHeight;
	    }
	    catch(e) {}
    },	
    
    setEvents: function() {
      var that = this;

      dj.lang.addLiveEvent("._exp", "mousedown", function(ev) {
        var el = (ev.target || ev.srcElement);
        that.initShowData(el);
      });
      
      dj.lang.addLiveEvent(".subExpand", "mousedown", function(ev) {
        var el = (ev.target || ev.srcElement);
        that.subFlyoutToggle("1-3");
      });
    },
    
    delayedMouseOver: function(containerClass, func, time) {
      var doInit = false, initDelay;
      var that = this;

      // debugger;
      var outEvent = dj.lang.addLiveEvent(containerClass, "mouseout", function() { doInit = false; });
      var overEvent = dj.lang.addLiveEvent(containerClass, "mouseover", function(ev) {
      if (initDelay) { clearTimeout(initDelay); }
        doInit = true;
        var el = this;
        initDelay = setTimeout(function() {
          if (!doInit) { 
            return; 
          }
          //dj.lang.removeLiveEvent(overEvent);
          //dj.lang.removeLiveEvent(outEvent);
          func.call(that, el);
        }, time);
      });
    },

    getHTML: function(location, el, dataEl) {
      var that = this;
      
      dojo.xhrGet( {
         url: location,
         headers: {
           Accept: 'application/html'
         },
         handleAs: "text",
         load: function(response, ioArgs) {
           var requestStatus = ioArgs.xhr.getResponseHeader('Status');
           el.innerHTML = response;
           // try{that.setIframeShimHeights(dataEl);}catch(err){} // IE Specific
           // when the comment below is matched in the request a special panel is initialized 
           if (response.match(/<!--BusinessDropdown-->/)) {
             var panel = new dj.widget.panel.SelectDropdownPanel('subIndDropdown');
           }
         },
         error: function(response, ioArgs) {
           console.error("HTTP status code: ", ioArgs.xhr.status);
           return response;
         }
      });
    },

    subFlyoutToggle: function(n) {
      // Get the dropdown
      var el = dojo.byId("wsjsub_flyout" + n);
      
      if (el === null) {
        return false;
      }
       
      var currentClass = el.className;
      // Toggle between the classes mn_ddState-collapsed and mn_ddState-expanded
      if(currentClass.indexOf("wsjsub_ddState-collapsed") != -1) {
        el.className = currentClass.replace( /wsjsub_ddState-collapsed/, "wsjsub_ddState-expanded");
      } 
      else {
        el.className = currentClass.replace(/wsjsub_ddState-expanded/, "wsjsub_ddState-collapsed");
      }
      return false;	
    },

    fadeInArrows: function() {
      var arrowNodes = dojo.query(".mnExpand._exp");

      for (var i=0;i<=arrowNodes.length - 1;i++) {
        dojo.fadeIn({
          node: arrowNodes[i],
          duration: (1.0 * 1000)
        }).play();
      }
    }
  };
}());
dojo.provide("dj.module.globalHeader");

dojo.deprecated("dj.module.globalHeader", "use dj.module.header.globalHeader instead", "1.4.1");

dojo.require("dj.lang");
dojo.require("dj.util.Config");
dojo.require("dj.util.Cookie");
dojo.require("dj.util.Date");
dojo.require("dj.util.Region");
dojo.require("dj.util.Element");
dojo.require("dj.util.User");

/**
 * Javascript functions to initialize and setup for Global Header
 *
 * Lookups are done only to find the first element matching the class in the header container. This can be updated to
 * lookup multiple elements and apply the required functionality if required.
 */
dj.module.globalHeader = function() {

  var DEFAULT_CONFIG = {
     HEADER_CONTAINER_CLASS: ".header",
     TIMESTAMP_CLASS: ".date",
     WSJ_LOGO_ID: "wsjLogo",
     WSJ_LARGE_LOGO_CLASSNAME: "logo_large",
     WSJ_SMALL_LOGO_CLASSNAME: "logo_small",
     CURRENT_SUBSECTION_DISPLAY_CLASS: ".currentSubSection",
     GLOBALNAV_SUBSECTION_ELEMENT_ID: "currentGlobalNavSubSection",
     SUBSCRIBER_LOGIN_CLASS: ".login",
     HEADER_PROMO_CLASS: ".promo",
     SUBSCRIBER_DETAILS_ELEMENT_ID: "subscribedUserDetailsId",
     COMMUNITY_FORUMS_LINK_CLASS: ".communityForumsLink",
     TODAYS_PAPER_LINK_CLASS: ".todaysPaperLink",
     MOJ_LINK_CLASS: ".myOnlineJournalLink",
     MESSAGE_CENTER_LINK_CLASS: ".messageCenterLink",
     MESSAGE_COUNT_CLASS: ".messageCount",
     LOGIN_USERNAME_ELEMENT_ID: "login_username",
     LOGIN_PASSWORD_ELEMENT_ID: "login_password",
     LOGIN_FORM_ID: "login_form",
     PAGE_URL_ELEMENT_ID: "page_url",
     LOGOUT_LINK_ELEMENT_ID: "logoutLink",
     LOGIN_BUTTON_ELEMENT_ID: "login_button",
     USER_NAME_ELEMENT_ID: "userName",
     WSJ_LOGO_FADE_APPEAR_DURATION: "1.0",
     WSJ_LOGO_DELAY_DURATION: "2000",
     LOGGED_IN_COMMUNITY_URL: "/community",
     //LOGGED_IN_TODAYS_PAPER_URL: "/page/us_in_todays_paper.html?mod=WSJ_formfactor",
     LOGGED_IN_TODAYS_PAPER_URL: "/itp?mod=WSJ_formfactor",
     LOGGED_IN_TODAYS_PAPER_URL_ASIA: "/itp/asia?mod=WSJ_formfactor",
     LOGGED_IN_TODAYS_PAPER_URL_EUROPE: "/itp/europe?mod=WSJ_formfactor",
     MESSAGE_CENTER_POST_URL: "/community/integration/userinfo.html",
      // MESSAGE_CENTER_POST_URL : "/community/integration/messagescount.html",
     LOGOUT_URL: "/static_html_files/logout_confirmation.htm",
     SUBSCRIBER_HOMEPAGE_PID: "0_0_WH_0001",
     NONSUBSCRIBER_HOMEPAGE_PID: "0_0_WH_0001_public",
     ASIA_PAGE_PID: "0_0_WP_2103",
     EUROPE_PAGE_PID: "0_0_WP_2104",
     NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID: "5_6007",
     NONSUBSCRIBER_SEARCH_PAGE_PID: "3_0466",
     HOMEPAGE_SUBSCRIBER_URL: "/",
     SEARCH_PAGE_SUBSCRIBER_URL: "/search",
     TODAYS_PAPER_LINK_CONTAINER_CLASS: ".todaysPaperLinkContainer",
     VIDEO_LINK_CONTAINER_CLASS: ".videoLinkContainer",
     COLUMNS_LINK_CONTAINER_CLASS: ".columnsLinkContainer",
     BLOGS_LINK_CONTAINER_CLASS: ".blogsLinkContainer",
     INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS: ".interactiveGraphicsLinkContainer",
     TOPICS_LINK_CONTAINER_CLASS: ".topicsLinkContainer",
     COMMUNITY_FORUMS_LINK_CONTAINER_CLASS: ".communityForumsLinkContainer",
     TODAYS_PAPER_PID: "0_0_WP_40",
     TODAYS_PAPER_US_NONSUB_PID: "2_0433",
     TODAYS_PAPER_EUROPE_NONSUB_PID: "2_0434",
     TODAYS_PAPER_ASIA_NONSUB_PID: "2_0435",
     TODAYS_PAPER_US_PID: "2_0133",
     TODAYS_PAPER_EUROPE_PID: "2_0134",
     TODAYS_PAPER_ASIA_PID: "2_0135",
     TODAYS_PAPER_PAST_EDITIONS_PID: "2_0233",
     TODAYS_PAPER_INDEX_BIZ_PID: "2_0156",
     TODAYS_PAPER_INDEX_PEOPLE_PID: "2_0155",
     TODAYS_PAPER_CORRECTIONS_PID: "Corrections",
     VIDEO_PID: "0_0_WP_3000",
     BLOGS_PID: "8_0019",
     COLUMNS_PID: "2_0140",
     INTERACTIVE_GRAPHICS_PID: "0_0_WP_2003",
     TOPICS_PID: "0_0_WT_0001",
     NEWSLETTERS_ALERTS_SUB_PID: "5_6001",
     NEWSLETTERS_ALERTS_PUB_PID: "5_6003",
     MOJ_LINK_URL: "/page/my-journal-main.html",
     MDC_LINK_URL: "/mdc/page/marketsdata.html",
     MDC_PAGE_PID: "2_3000",
     COMMUNITY_HIGHLIGHT_COMPARE_URL: "/community",
     FORUMS_HIGHLIGHT_COMPARE_URL: "forums.wsj.com",
     FREE_REG_CLASS: ".freereg",
     LOCATION_NAV_CLASS: ".location_nav",
     LOCATION_NAV_COLLAPSED_CLASSNAME: "location_collapsed",
     LOCATION_NAV_EXPANDED_CLASSNAME: "location_expanded",
     US_EDITION_LINK_CLASS: ".map_us",
     EU_EDITION_LINK_CLASS: ".map_europe",
     ASIA_EDITION_LINK_CLASS: ".map_asia",
     IN_EDITION_LINK_CLASS: ".map_india",
     US_EDITION_MDC_URL: "/marketsdata",
     EU_EDITION_MDC_URL: "/mdc/public/page/marketsdata_europe.html",
     ASIA_EDITION_MDC_URL: "/mdc/public/page/marketsdata_asia.html",
     IN_EDITION_MDC_URL: "/mdc/public/page/marketsdata_asia.html",
     MDC_COMPARE_URL: "/mdc/",
     FOOTER_CONTAINER_CLASS: ".pagefooter",
     //PRO_HOOK
     GO_PRO_HOOK: "goprohook",
     GO_PRO_HOOK_REGION: ["na,us"]
  };


  return {
    /**
     * Initialize the Global Header Logo bar (G2)
     *
     * @param {Object}
     *            config
     */
    initialize: function(config) {

      this.cfg = dj.lang.cloneMixin(DEFAULT_CONFIG, config);

      var headerContainerClass = this.cfg.HEADER_CONTAINER_CLASS;
      this.oHeader = dojo.query(headerContainerClass)[0];

      //Edition dropdown setUp
      this.editionDropdownSetUp();

      //Display subsection
      this.displaySubSection();

      //Display timestamp
      this.displayTimeStamp();

      //Subscriber Details
      var that = this;

      //Current Region
      this.currRegion = dj.util.Region.getViewByRegion();

      this.concatURL = '';
      if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
        this.concatURL = "http://" + gcDomain;
      } else {
        this.concatURL = "http://" + document.domain;
      }

      dj.util.User.isLoggedIn(function(isLoggedIn) {
        if (isLoggedIn) {
          that.displaySubscriberDetails();
          that.setupLogout();
        } else {

          that.setupLogin();

          var freeregClass = that.cfg.FREE_REG_CLASS;
          that.ofreereg = dojo.query(freeregClass, that.oHeader)[0];
          var registerModule = dojo.query("#register_module", that.ofreereg)[0];
          dojo.style(registerModule, {display: "none"});
          dojo.style(that.ofreereg, { display: "block" });

          var subscriberLoginClass = that.cfg.SUBSCRIBER_LOGIN_CLASS;
          that.oSubscriberLogin = dojo.query(subscriberLoginClass, that.oHeader)[0];
          var loginModule = dojo.query(".login_module", that.oSubscriberLogin)[0];
          dojo.style(loginModule, {display: "none"});
          dojo.style(that.oSubscriberLogin, { display: "block" });

          var headerPromoClass = that.cfg.HEADER_PROMO_CLASS;
          that.oHeaderPromo = dojo.query(headerPromoClass, that.oHeader)[0];
          dojo.style(that.oHeaderPromo, { display: "block" });
        }
      });

      //Form factor links highlighting
      this.highlightFormFactorLinks();

      //Setup Region Specific - Todays's Newspaper url

      var todaysPaperLinkClass = this.cfg.TODAYS_PAPER_LINK_CLASS;
      this.oTodaysPaperLink = dojo.query(todaysPaperLinkClass, this.oHeader)[0];
      var loggedInTodaysPaperUrl = this.cfg.LOGGED_IN_TODAYS_PAPER_URL;
      var loggedInTodaysPaperUrlAsia = this.cfg.LOGGED_IN_TODAYS_PAPER_URL_ASIA;
      var loggedInTodaysPaperUrlEurope = this.cfg.LOGGED_IN_TODAYS_PAPER_URL_EUROPE;

      var currEdition = "";

      if (this.currRegion == "asia" || this.currRegion == "asia,india") {
        loggedInTodaysPaperUrl = loggedInTodaysPaperUrlAsia;
      } else if (this.currRegion == "europe") {
        loggedInTodaysPaperUrl = loggedInTodaysPaperUrlEurope;
      }

      if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
        this.oTodaysPaperLink.href = "http://" + gcDomain + loggedInTodaysPaperUrl;
      } else {
        this.oTodaysPaperLink.href = loggedInTodaysPaperUrl;
      }

      //var that = this;

     /* dj.util.User.isSubLoggedIn(function(subLoggedIn) {
        if (!subLoggedIn) {

          if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
            that.oTodaysPaperLink.href = "http://" + gcDomain + "/public" + loggedInTodaysPaperUrl;
          } else {
            that.oTodaysPaperLink.href = "/public" + loggedInTodaysPaperUrl;
          }
        }
      });*/

      dj.util.User.isSubLoggedIn(function(subLoggedIn){
        if(subLoggedIn) {
          //IE doesn't support Array.indexOf, so...
          var region_index = -1;
          dojo.forEach(
            that.cfg.GO_PRO_HOOK_REGION,
            function(element,index){
              if(element===that.currRegion){
                region_index = index;
              }
            }
          );
          if(that.cfg.GO_PRO_HOOK_REGION==="all" || region_index!==-1) {
            dojo.removeClass(that.cfg.GO_PRO_HOOK, "hidden");
          }
        }
      });

    },

    toggleDropdownClass : function() {
      var selLocDrpdwnCollapsedClassName = this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME;
      var selLocDrpdwnExpandedClassName = this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;

      if (dojo.hasClass(this.oLocDropDownContainer, selLocDrpdwnCollapsedClassName)) {
        dojo.removeClass(this.oLocDropDownContainer, selLocDrpdwnCollapsedClassName);
        dojo.addClass(this.oLocDropDownContainer, selLocDrpdwnExpandedClassName);
      } else if (dojo.hasClass(this.oLocDropDownContainer, selLocDrpdwnExpandedClassName)) {
        dojo.addClass(this.oLocDropDownContainer, selLocDrpdwnCollapsedClassName);
      }
    },
    /**
     * Edition Dropdown SetUp
     *
     * @param {Object}
     *            oLocationNav
     */
    editionDropdownSetUp: function() {
      var that=this;

      var locationNavClass = this.cfg.LOCATION_NAV_CLASS;
      this.oLocationNav = dojo.query(locationNavClass, this.oHeader)[0];

      //Observer to open/close the location dropdown
      var selLocDrpdwnCollapsedClassName = this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME;
      var selLocDrpdwnExpandedClassName = this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;

      var usEditionLinkClassName = this.cfg.US_EDITION_LINK_CLASS;

      var usEditionLinkClassName = this.cfg.US_EDITION_LINK_CLASS;
      var euEditionLinkClassName = this.cfg.EU_EDITION_LINK_CLASS;
      var inEditionLinkClassName = this.cfg.IN_EDITION_LINK_CLASS;
      var asiaEditionLinkClassName = this.cfg.ASIA_EDITION_LINK_CLASS;

      this.usEditionMDCUrl = this.cfg.US_EDITION_MDC_URL;
      this.euEditionMDCUrl = this.cfg.EU_EDITION_MDC_URL;
      this.inEditionMDCUrl = this.cfg.IN_EDITION_MDC_URL;
      this.asiaEditionMDCUrl = this.cfg.ASIA_EDITION_MDC_URL;

      var mdcCompareUrl = this.cfg.MDC_COMPARE_URL;

      this.oCurrentEdition = dojo.byId("currentEdition");

      this.oUsEdition = dojo.byId("usEdition");
      this.oEuEdition = dojo.byId("europeEdition");
      this.oInEdition = dojo.byId("indiaEdition");
      this.oAsiaEdition = dojo.byId("asiaEdition");
      this.oChiEdition = dojo.byId("chiEdition");
      this.oJpnEdition = dojo.byId("jpnEdition");
      this.oSpaEdition = dojo.byId("spaEdition");
      this.oPorEdition = dojo.byId("porEdition");
      this.osectionFooterSub = dojo.byId("hrefNonSubId");
      this.osectionFooterNonSub = dojo.byId("hrefSubId");

      this.oUsEditionFooter = dojo.byId("usEditionFooter");

      this.currRegion = dj.util.Region.getViewByRegion();
      var currEdition = "";

      if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
        this.tempConcatURL = "http://" + gcDomain;
      } else {
        this.tempConcatURL = "http://" + document.domain;
      }

      this.isMDCPageFlag = ((document.location.href) && (document.location.href !== "") && (document.location.href
          .indexOf(mdcCompareUrl) !== -1));

      if (this.oUsEdition) {

        dojo.connect(this.oUsEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          dj.util.Region.setViewByRegion('na,us');
          dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home-page", 365);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.usEditionMDCUrl : this.oUsEdition.href;
        });
      }

      if (this.oUsEditionFooter) {
        dojo.connect(this.oUsEditionFooter,"onclick", this, function(ev) {
          dojo.stopEvent(ev);
          dj.util.Region.setViewByRegion('na,us');
          dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/us", 365);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.usEditionMDCUrl
              : this.oUsEditionFooter.href;
        });
      }

      if (this.oEuEdition) {
        dojo.connect( this.oEuEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.euEditionMDCUrl : this.oEuEdition.href;

          if (this.isMDCPageFlag) {
            dj.util.Region.setViewByRegion("europe");
            dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/europe", 365);
          }

        });
      }

      if (this.oInEdition) {
        dojo.connect( this.oInEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.inEditionMDCUrl : this.oInEdition.href;

          if (this.isMDCPageFlag) {
            dj.util.Region.setViewByRegion("asia,india");
            dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/india", 365);
          }

        });
      }

      if (this.oAsiaEdition) {
        dojo.connect( this.oAsiaEdition, "onclick", this,
            function(ev) {
              dojo.stopEvent(ev);
              window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.asiaEditionMDCUrl
                  : this.oAsiaEdition.href;

              if (this.isMDCPageFlag) {
                dj.util.Region.setViewByRegion("asia");
                dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/asia", 365);
              }

            });
      }

      if (this.oChiEdition) {
        dojo.connect( this.oChiEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.open(this.oChiEdition.href);
        });
      }

      if (this.oJpnEdition) {
        dojo.connect( this.oJpnEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.open(this.oJpnEdition.href);
        });
      }

      if (this.oSpaEdition) {
        dojo.connect( this.oSpaEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.oSpaEdition.href;
        });
      }

      if (this.oPorEdition) {
        dojo.connect( this.oPorEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.oPorEdition.href;
        });
      }

      if (this.osectionFooterSub) {
        dojo.connect( this.osectionFooterSub, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.osectionFooterSub.href;
        });
      }

      if (this.osectionFooterNonSub) {
        dojo.connect( this.osectionFooterNonSub, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.osectionFooterNonSub.href;
        });
      }

      if (this.currRegion == "asia") {
        currEdition = "Asia Edition";
        this.oSelectedEdition = dojo.query(asiaEditionLinkClassName, this.oHeader)[0];
      } else if (this.currRegion == "asia,india") {
        currEdition = "Asia Edition";
        this.oSelectedEdition = dojo.query(inEditionLinkClassName, this.oHeader)[0];
      } else if (this.currRegion == "europe") {
        currEdition = "Europe Edition";
        this.oSelectedEdition = dojo.query(euEditionLinkClassName, this.oHeader)[0];
      } else {
        // For US Edition we are using the new header, no need to execute this code
        currEdition = "U.S. Edition";
        this.oSelectedEdition = dojo.query(usEditionLinkClassName, this.oHeader)[0];
      }

      dojo.addClass(this.oSelectedEdition, "selected");

      this.oCurrentEdition.innerHTML = currEdition;

      this.oFormFactorContainer = dojo.byId("formFactorContainer");
      dojo.style(this.oFormFactorContainer, {"display": ""});

      this.oLocDropDownContainer = dojo.byId("locNavContainer");
      dojo.style(this.oLocDropDownContainer, {"display": ""});

      if (this.oLocDropDownContainer) {
        var toggleDropdownClass = function() {
          if (dojo.hasClass(that.oLocDropDownContainer, selLocDrpdwnCollapsedClassName)) {
            dojo.removeClass(that.oLocDropDownContainer, selLocDrpdwnCollapsedClassName);
            dojo.addClass(that.oLocDropDownContainer, selLocDrpdwnExpandedClassName);
          } else if (dojo.hasClass(that.oLocDropDownContainer, selLocDrpdwnExpandedClassName)) {
            dojo.removeClass(that.oLocDropDownContainer, selLocDrpdwnExpandedClassName);
            dojo.addClass(that.oLocDropDownContainer, selLocDrpdwnCollapsedClassName);
          }
        };

        dojo.connect( this.oLocationNav, "onclick", this, function(event) {
          dojo.stopEvent(event);
          toggleDropdownClass();
        });

        //Close the dropdown when a click happens outside the locNavContainer
        dojo.connect(document, "onclick", this, function(event) {
          var isMousePointerinModalContainer = dj.util.Element.contains(this.oLocDropDownContainer, event.clientX,
              event.clientY);
          if (isMousePointerinModalContainer == false) {
            if (dojo.hasClass(this.oLocDropDownContainer, selLocDrpdwnExpandedClassName)) {
              dojo.removeClass(this.oLocDropDownContainer, selLocDrpdwnExpandedClassName);
              dojo.addClass(this.oLocDropDownContainer, selLocDrpdwnCollapsedClassName);
            }
          }
        });

        this.oSectionFooterNonSub = dojo.byId("sectionFooterNonSub");
        this.oSectionFooterSub = dojo.byId("sectionFooterSub");

        dj.util.User.isLoggedIn(function(isLoggedIn) {
          if (isLoggedIn) {
            dojo.style(that.oSectionFooterNonSub, {"display":"none" });
            dojo.style(that.oSectionFooterSub, {"display": "" });
          } else {
            dojo.style(that.oSectionFooterNonSub, {"display": "" });
            dojo.style(that.oSectionFooterSub, {"display":"none" });
          }
        });
      }
    },

    /**
     * Timestamp display
     *
     * @param {Object}
     *            oTimestamp
     */
    displayTimeStamp: function() {
      var timestampClass = this.cfg.TIMESTAMP_CLASS;
      this.oTimestamp = dojo.query(timestampClass, this.oHeader)[0];

      if ((typeof pDate !== "undefined") && (this.oTimestamp)) {
        if (window.pStl == "renovation") {
          var pubDate = dj.util.Date.displayTime(pDate, pDateinGMT);
          this.oTimestamp.innerHTML= pubDate;
        } else {
          this.oTimestamp.innerHTML = pDate;
        }
      }
    },

    /**
     * Display the subsection
     *
     * @param {Object}
     *            oCurrentSubSection
     */
    displaySubSection: function() {
      this.oCurrentSubSection = dojo.query(this.cfg.CURRENT_SUBSECTION_DISPLAY_CLASS, this.oHeader)[0];

      if ((typeof globalHeaderPageTitle !== "undefined") && (globalHeaderPageTitle)
          && (globalHeaderPageTitle !== "")) {
        this.oCurrentSubSection.innerHTML = globalHeaderPageTitle;
        this._delayedFadeInSubSection();
      }
    },

    _delayedFadeInSubSection: function() {
      setTimeout(dojo.hitch(this, function() {
        // prepare for the fadeIn
        dojo.style(this.oCurrentSubSection, {
          "display": "inline",
          "opacity": 0
        });

        dojo.fadeIn({
          node: this.oCurrentSubSection,
          duration: (this.cfg.WSJ_LOGO_FADE_APPEAR_DURATION * 1000)
        }).play();
      }), this.cfg.WSJ_LOGO_DELAY_DURATION);
    },

    /**
     * Display the subscriber details
     */
    displaySubscriberDetails: function() {
      // Display the username
      var userNameElementId = this.cfg.USER_NAME_ELEMENT_ID;

      dj.util.User.renderCallsign(userNameElementId);

      // Construct Links for logged-in user
      this.setupSubscriberLinks();
      var messageCenterLinkClass = this.cfg.MESSAGE_CENTER_LINK_CLASS;
      this.oMessageCenterLink = dojo.query(messageCenterLinkClass, this.oHeader)[0];

      var that = this;

      dj.util.User.isSubLoggedIn(function(subLoggedIn) {
        if (subLoggedIn) {
          that.setupMessageCenter();
        } else {
          that.setUpMJLinksForReg();
          dojo.style(that.oMessageCenterLink, {"display":"none" });
        }
      });

      // Display the links specific to subscribed user
      var subscriberDetailsElementId = this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID;
      this.oSubscriberDetails = dojo.byId(subscriberDetailsElementId);
      dojo.removeClass(this.oSubscriberDetails, "hidden");
    },

    /**
     * Setup MJ Links for Reg user
     */
    setUpMJLinksForReg: function() {
      //Exception added below for handling footer link for MJ in-here
      var footerContainerClass = this.cfg.FOOTER_CONTAINER_CLASS;
      this.oFooter = dojo.query(footerContainerClass)[0];

      var mojLinkUrl = this.cfg.MOJ_LINK_URL;

      var mojLinkClass = this.cfg.MOJ_LINK_CLASS;
      this.oMojLinkHeader = dojo.query(mojLinkClass, this.oHeader)[0];
      this.oMojLinkFooter = dojo.query(mojLinkClass, this.oFooter)[0];

      if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
        this.oMojLinkHeader.href = "http://" + gcDomain + mojLinkUrl;
        this.oMojLinkFooter.href = "http://" + gcDomain + mojLinkUrl;
      } else {
        this.oMojLinkHeader.href = mojLinkUrl;
        this.oMojLinkFooter.href = mojLinkUrl;
      }
    },

    /**
     * Setup Subscriber Links
     */
    setupSubscriberLinks: function() {

      var todaysPaperLinkClass = this.cfg.TODAYS_PAPER_LINK_CLASS;
      this.oTodaysPaperLink = dojo.query(todaysPaperLinkClass, this.oHeader)[0];
      var loggedInTodaysPaperUrl = this.cfg.LOGGED_IN_TODAYS_PAPER_URL;

      var that = this;

      dj.util.User.isSubLoggedIn(function(subLoggedIn) {
        if (subLoggedIn) {
          if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
            that.oTodaysPaperLink.href = "http://" + gcDomain + loggedInTodaysPaperUrl;
          } else {
            that.oTodaysPaperLink.href = loggedInTodaysPaperUrl;
          }
        }
      });

    },

    /**
     * Message Center Setup
     */
    setupMessageCenter: function() {
      var messageCenterLinkClass = this.cfg.MESSAGE_CENTER_LINK_CLASS;
      this.oMessageCenterLink = dojo.query(messageCenterLinkClass, this.oHeader)[0];

      var messageCountClass = this.cfg.MESSAGE_COUNT_CLASS;
      this.oMessageCount = dojo.query(messageCountClass, this.oHeader)[0];

      // Url for Message Center and the no of messages
      var that = this;
      var setupMsgCenterLink = function(noOfMessages) {
        if (noOfMessages == '-1') {
          dojo.style(that.oMessageCenterLink, {"display":"none" });
        } else {
          that.oMessageCount.innerHTML = noOfMessages;
        }
      };

      var noOfMessages = dj.util.Cookie.getCookie("msgCount");

      if (noOfMessages === null) {
        var messageCenterPostUrl = this.cfg.MESSAGE_CENTER_POST_URL;


        var messageCountReq = dojo.xhrPost({
          url : messageCenterPostUrl,
          handleAs : "json",
          handle : function(data, ioargs) {
            var jsonObj = data;
            noOfMessages = jsonObj.MessagesCount;
            var userStatus = jsonObj.Status; //Set for expiry = 5 min == (5/24/60)
            dj.util.Cookie.setCookie("msgCount", noOfMessages, (5 / 24 / 60));
            dj.util.Cookie.setCookie("userStatus", userStatus, (5 / 24 / 60));
            setupMsgCenterLink(noOfMessages);
          },

          error: function(transport, exception) {
            console.error("Exception occured while posting posting Ajax Request: %s", exception);
          }

        });
      } else {
        setupMsgCenterLink(noOfMessages);
      }
    },

    /**
     * Subscriber Login
     */
    setupLogin: function() {
      var loginUserElementId = this.cfg.LOGIN_USERNAME_ELEMENT_ID;
      this.oUserName = dojo.byId(loginUserElementId);

      var loginPasswordElementId = this.cfg.LOGIN_PASSWORD_ELEMENT_ID;
      this.oPassword = dojo.byId(loginPasswordElementId);

      var loginButtonImageId = this.cfg.LOGIN_BUTTON_ELEMENT_ID;
      this.oLoginImg = dojo.byId(loginButtonImageId);

      var loginFormId = this.cfg.LOGIN_FORM_ID;
      this.oLoginForm = dojo.byId(loginFormId);
      if(this.oLoginForm != null){
    	  this.oLoginForm.reset();
      }

      var pageUrlId = this.cfg.PAGE_URL_ELEMENT_ID;
      this.oPageUrl = dojo.byId(pageUrlId);

      var that = this;

      if (this.oPageUrl) {

        var nonSubscriberHomepagePid = this.cfg.NONSUBSCRIBER_HOMEPAGE_PID;
        var nonSubscriberSearchPagePid = this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID;
        var nonSubNewslettersAlertsPagePid = this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID;
        var mdcPagePid = this.cfg.MDC_PAGE_PID;

        var concatURL;

        if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
          concatURL = "http://" + gcDomain;
        } else {
          concatURL = "http://" + document.domain;
        }

        var oCurrentUrl;

        if (dojo.isIE) {
          oCurrentUrl = window.location.href;
        } else {
          oCurrentUrl = document.location.href;
        }

        var url_value = oCurrentUrl;
        if (typeof pID !== "undefined") {
          if (pID === nonSubscriberHomepagePid) {
            url_value = concatURL + this.cfg.HOMEPAGE_SUBSCRIBER_URL;
          } else if (pID === nonSubNewslettersAlertsPagePid) {
            url_value = concatURL + "/email";
          } else if (pID === nonSubscriberSearchPagePid) {
            url_value = concatURL + this.cfg.SEARCH_PAGE_SUBSCRIBER_URL;
          } else if (pID === mdcPagePid) {
            url_value = concatURL + this.cfg.MDC_LINK_URL;
          } else {
            url_value = oCurrentUrl;
          }
          if (dojo.isIE) {
            document.login_form.url.value = url_value;
          } else {
            this.oPageUrl.value = url_value;
          }

        }

        if (this.oUserName) {
          dojo.connect(this.oUserName, "onfocus", this, function(event) {
            dj.util.Form.clearValue(this.oUserName, "User Name");
          });

          dojo.connect(this.oUserName, "onclick", this, function(event) {
            dj.util.Form.clearValue(this.oUserName, "User Name");
          });

        }

        if (this.oPassword) {

          dojo.connect(this.oPassword, "onfocus", this, function(event) {
            dj.util.Form.clearValue(that.oPassword, "Password");
            this.oPassword.type = "password";
          });

          dojo.connect(this.oPassword, "onclick", this, function(event) {
            dj.util.Form.clearValue(that.oPassword, "Password");
            //     this.oPassword.type = "password";
            });

          dojo.connect(this.oPassword, "onchange", this, function(event) {
            dj.util.Form.clearValue(that.oPassword, "Password");
            //    this.oPassword.type = "password";
            });
        }

        if (dojo.isIE) {
          dojo.connect(this.oLoginImg, "onclick", this, function(e) {
            document.login_form.url.value = oCurrentUrl;
            console.log("coming in to img onlick in IE" + oCurrentUrl);
            this.oLoginForm.submit();
          });
        }

        dojo.connect(this.oPassword, "onkeypress", this, function(e) {
          var cKeyCode = e.keyCode || e.which;
          if (dojo.isIE) {
            if (cKeyCode == dojo.keys.ENTER) {
              document.login_form.url.value = oCurrentUrl;
              this.oLoginForm.submit();
            }
          }
        });
      }
    },

    /**
     * Logout
     */
    setupLogout: function() {
      var logoutLinkElementId = this.cfg.LOGOUT_LINK_ELEMENT_ID;
      this.oLogout = dojo.byId(logoutLinkElementId);

      if (this.oLogout) {
        //var logoutLinkUrl = this.cfg.LOGOUT_URL;
        //var logoutUrl = (typeof overrideHeaderLogout == "undefined") ? logoutLinkUrl : overrideHeaderLogout;

        dojo.connect(this.oLogout, "onclick", this, function(ev) {
          dojo.stopEvent(ev);

          //Delete the msgCount cookie
            dj.util.Cookie.deleteCookie("msgCount");

            //Delete the HOMEPAGE cookie
            dj.util.Cookie.deleteCookie("HOMEPAGE", true);
            document.cookie = "HOMEPAGE" + "=" + ";path=/" + ";domain=.wsj.com"
                + ";expires=Thu, 01-Jan-1970 00:00:01 GMT";

            //Disconnect from Facebook
            if((typeof dj.module.facebook.connect.logout == "function") && ( FB.getAuthResponse() ) ) {
            	dj.module.facebook.connect.logout( function() {
            		  if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
                    window.location = "/logout?url=http://" + gcDomain;
                  } else {
                    window.location = "/logout";
                  }
              });
            } else {
            	console.info("Facebook API is not available when executing Logout");
            	if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
                window.location = "/logout?url=http://" + gcDomain;
              } else {
                window.location = "/logout";
              }
            }

          });
      }
    },

    /**
     * Highlight form factor links
     */
    highlightFormFactorLinks: function() {

      var todaysPaperLinkContainerClass = this.cfg.TODAYS_PAPER_LINK_CONTAINER_CLASS;
      this.oTodaysPaperLinkContainer = dojo.query(todaysPaperLinkContainerClass, this.oHeader)[0];

      var videoLinkContainerClass = this.cfg.VIDEO_LINK_CONTAINER_CLASS;
      this.oVideoLinkContainer = dojo.query(videoLinkContainerClass, this.oHeader)[0];

      var blogsLinkContainerClass = this.cfg.BLOGS_LINK_CONTAINER_CLASS;
      this.oBlogsLinkContainer = dojo.query(blogsLinkContainerClass, this.oHeader)[0];

      var columnsLinkContainerClass = this.cfg.COLUMNS_LINK_CONTAINER_CLASS;
      this.oColumnsLinkContainer = dojo.query(columnsLinkContainerClass, this.oHeader)[0];

      var interactiveGraphicsLinkContainerClass = this.cfg.INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS;
      this.oInteractiveGraphicsLinkContainer = dojo.query(interactiveGraphicsLinkContainerClass, this.oHeader)[0];

      var topicsLinkContainerClass = this.cfg.TOPICS_LINK_CONTAINER_CLASS;
      this.oTopicsLinkContainer = dojo.query(topicsLinkContainerClass, this.oHeader)[0];

      var communityForumsLinkContainerClass = this.cfg.COMMUNITY_FORUMS_LINK_CONTAINER_CLASS;
      this.oCommunityForumsLinkContainer = dojo.query(communityForumsLinkContainerClass, this.oHeader)[0];

      var todaysPaperPid = this.cfg.TODAYS_PAPER_PID;
      var todaysPaperUsNonSubPid = this.cfg.TODAYS_PAPER_US_NONSUB_PID;
      var todaysPaperEuropeNonSubPid = this.cfg.TODAYS_PAPER_EUROPE_NONSUB_PID;
      var todaysPaperAsiaNonSubPid = this.cfg.TODAYS_PAPER_ASIA_NONSUB_PID;
      var todaysPaperUsPid = this.cfg.TODAYS_PAPER_US_PID;
      var todaysPaperEuropePid = this.cfg.TODAYS_PAPER_EUROPE_PID;
      var todaysPaperAsiaPid = this.cfg.TODAYS_PAPER_ASIA_PID;
      var todaysPaperPastEditionsPid = this.cfg.TODAYS_PAPER_PAST_EDITIONS_PID;
      var todaysPaperIndexBizPid = this.cfg.TODAYS_PAPER_INDEX_BIZ_PID;
      var todaysPaperIndexPeoplePid = this.cfg.TODAYS_PAPER_INDEX_PEOPLE_PID;
      var todaysPaperCorrectionsPid = this.cfg.TODAYS_PAPER_CORRECTIONS_PID;

      var videoPid = this.cfg.VIDEO_PID;
      var interactiveGraphicsPid = this.cfg.INTERACTIVE_GRAPHICS_PID;
      var topicsPid = this.cfg.TOPICS_PID;
      var newslettersAlertsPubPid = this.cfg.NEWSLETTERS_ALERTS_PUB_PID;
      var newslettersAlertsSubPid = this.cfg.NEWSLETTERS_ALERTS_SUB_PID;
      var columnsPid = this.cfg.COLUMNS_PID;
      var blogsPid = this.cfg.BLOGS_PID;

      var hostUrl = document.location.host;
      var communityUrl = hostUrl + this.cfg.COMMUNITY_HIGHLIGHT_COMPARE_URL;
      var compareForumsUrl = this.cfg.FORUMS_HIGHLIGHT_COMPARE_URL;

      if (typeof pID !== "undefined") {

        if ((pID.indexOf(todaysPaperPid)==0) || (pID === todaysPaperUsNonSubPid) || (pID === todaysPaperEuropeNonSubPid)
            || (pID === todaysPaperAsiaNonSubPid) || (pID === todaysPaperUsPid) || (pID === todaysPaperEuropePid)
            || (pID === todaysPaperAsiaPid) || (pID === todaysPaperPastEditionsPid) || (pID === todaysPaperIndexBizPid)
            || (pID === todaysPaperIndexPeoplePid) || (pID === todaysPaperCorrectionsPid)) {
          dojo.addClass(this.oTodaysPaperLinkContainer, "selected");
        } else if (pID === videoPid) {
          dojo.addClass(this.oVideoLinkContainer, "selected");
        } else if (pID === interactiveGraphicsPid) {
          dojo.addClass(this.oInteractiveGraphicsLinkContainer, "selected");
        } else if (pID === columnsPid) {
          dojo.addClass(this.oColumnsLinkContainer, "selected");
        } else if (pID === blogsPid) {
          dojo.addClass(this.oBlogsLinkContainer, "selected");
        } else if (pID === topicsPid) {
          dojo.addClass(this.oTopicsLinkContainer, "selected");
        }
      }
      if ((document.location.href) && (document.location.href !== "")
          && (document.location.href.indexOf(communityUrl) !== -1)
          || (document.location.href.indexOf(compareForumsUrl) !== -1)) {
        dojo.addClass(this.oCommunityForumsLinkContainer, "selected");
      }

    }
  };

}();
dojo.provide("dj.module.header.globalHeader");
dojo.require("dj.lang");
dojo.require("dj.util.Config");
dojo.require("dj.util.Cookie");
dojo.require("dj.util.Date");
dojo.require("dj.util.Region");
dojo.require("dj.util.Element");
dojo.require("dj.util.User");

/**
 * Javascript functions to initialize and setup for Global Header
 *
 * Lookups are done only to find the first element matching the class in the header container. This can be updated to
 * lookup multiple elements and apply the required functionality if required.
 */
dj.module.header.globalHeader = function() {

  var DEFAULT_CONFIG = {
     HEADER_CONTAINER_CLASS: ".header",
     CURRENT_SUBSECTION_DISPLAY_CLASS: ".currentSubSection",
     GLOBALNAV_SUBSECTION_ELEMENT_ID: "currentGlobalNavSubSection",
     MOJ_LINK_URL: "/page/my-journal-main.html",
     MDC_LINK_URL: "/mdc/page/marketsdata.html",
     MDC_PAGE_PID: "2_3000",
     COMMUNITY_HIGHLIGHT_COMPARE_URL: "/community",
     FORUMS_HIGHLIGHT_COMPARE_URL: "forums.wsj.com",
     
     LOCATION_NAV_CLASS: ".location_nav",
     LOCATION_NAV_COLLAPSED_CLASSNAME: "location_collapsed",
     LOCATION_NAV_EXPANDED_CLASSNAME: "location_expanded",
     US_EDITION_LINK_CLASS: ".map_us",
     EU_EDITION_LINK_CLASS: ".map_europe",
     ASIA_EDITION_LINK_CLASS: ".map_asia",
     IN_EDITION_LINK_CLASS: ".map_india",
     
     US_EDITION_MDC_URL: "/marketsdata",
     EU_EDITION_MDC_URL: "/mdc/public/page/marketsdata_europe.html",
     ASIA_EDITION_MDC_URL: "/mdc/public/page/marketsdata_asia.html",
     IN_EDITION_MDC_URL: "/mdc/public/page/marketsdata_asia.html",
     MDC_COMPARE_URL: "/mdc/",
     
     FOOTER_CONTAINER_CLASS: ".pagefooter"
  };


  return {
    initialize: function(config) {
      this.cfg = dj.lang.cloneMixin(DEFAULT_CONFIG, config);
      var headerContainerClass = this.cfg.HEADER_CONTAINER_CLASS;
      this.oHeader = dojo.query(".header")[0];
      this.editionDropdownSetUp();
      this.currRegion = dj.util.Region.getViewByRegion();
      this.oLocToggle = dojo.byId("loc_toggle");
    },

    toggleDropdownClass : function() {
      var selLocDrpdwnCollapsedClassName = this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME;
      var selLocDrpdwnExpandedClassName = this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;
      this.oLocToggle = dojo.byId("loc_toggle");
      
      if (dojo.hasClass(this.oLocToggle, selLocDrpdwnCollapsedClassName)) {
        dojo.removeClass(this.oLocToggle, selLocDrpdwnCollapsedClassName);
        dojo.addClass(this.oLocToggle, selLocDrpdwnExpandedClassName);
      } 
      else if (dojo.hasClass(this.oLocToggle, selLocDrpdwnExpandedClassName)) {
        dojo.removeClass(this.oLocToggle, selLocDrpdwnExpandedClassName);
    	dojo.addClass(this.oLocToggle, selLocDrpdwnCollapsedClassName);
      }
    },

    editionDropdownSetUp: function() {
      var that = this;
      
      this.oLocationNav = dojo.byId("locNavContainer");

      //Observer to open/close the location dropdown
      var selLocDrpdwnCollapsedClassName = this.cfg.LOCATION_NAV_COLLAPSED_CLASSNAME;
      var selLocDrpdwnExpandedClassName = this.cfg.LOCATION_NAV_EXPANDED_CLASSNAME;
      
      var usEditionLinkClassName = this.cfg.US_EDITION_LINK_CLASS;
      var euEditionLinkClassName = this.cfg.EU_EDITION_LINK_CLASS;
      var inEditionLinkClassName = this.cfg.IN_EDITION_LINK_CLASS;
      var asiaEditionLinkClassName = this.cfg.ASIA_EDITION_LINK_CLASS;

      this.usEditionMDCUrl = this.cfg.US_EDITION_MDC_URL;
      this.euEditionMDCUrl = this.cfg.EU_EDITION_MDC_URL;
      this.inEditionMDCUrl = this.cfg.IN_EDITION_MDC_URL;
      this.asiaEditionMDCUrl = this.cfg.ASIA_EDITION_MDC_URL;

      var mdcCompareUrl = this.cfg.MDC_COMPARE_URL;

      this.oCurrentEdition = dojo.byId("currentEdition"); //good
      this.oUsEdition = dojo.byId("usEdition");
      this.oEuEdition = dojo.byId("europeEdition");
      this.oInEdition = dojo.byId("indiaEdition");
      this.oAsiaEdition = dojo.byId("asiaEdition");
      this.oChiEdition = dojo.byId("chiEdition");
      this.oGerEdition = dojo.byId("gerEdition");
      this.oJpnEdition = dojo.byId("jpnEdition");
      this.oSpaEdition = dojo.byId("spaEdition");
      this.oPorEdition = dojo.byId("porEdition");
      this.osectionFooterSub = dojo.byId("hrefNonSubId");
      this.osectionFooterNonSub = dojo.byId("hrefSubId");

      this.oUsEditionFooter = dojo.byId("usEditionFooter");

      this.currRegion = dj.util.Region.getViewByRegion();
      var currEdition = "";

      if ((typeof gcDomain !== "undefined") && (gcDomain) && (gcDomain !== "")) {
        this.tempConcatURL = "http://" + gcDomain;
      } else {
        this.tempConcatURL = "http://" + document.domain;
      }

      this.isMDCPageFlag = ((document.location.href) && (document.location.href !== "") && (document.location.href
          .indexOf(mdcCompareUrl) !== -1));

      if (this.oUsEdition) {

        dojo.connect(this.oUsEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          dj.util.Region.setViewByRegion('na,us');
          dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home-page", 365);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.usEditionMDCUrl : this.oUsEdition.href;
        });
      }

      if (this.oUsEditionFooter) {
        dojo.connect(this.oUsEditionFooter,"onclick", this, function(ev) {
          dojo.stopEvent(ev);
          dj.util.Region.setViewByRegion('na,us');
          dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/us", 365);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.usEditionMDCUrl
              : this.oUsEditionFooter.href;
        });
      }

      if (this.oEuEdition) {
        dojo.connect( this.oEuEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.euEditionMDCUrl : this.oEuEdition.href;

          if (this.isMDCPageFlag) {
            dj.util.Region.setViewByRegion("europe");
            dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/europe", 365);
          }

        });
      }

      if (this.oInEdition) {
        dojo.connect( this.oInEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.inEditionMDCUrl : this.oInEdition.href;

          if (this.isMDCPageFlag) {
            dj.util.Region.setViewByRegion("asia,india");
            dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/india", 365);
          }

        });
      }

      if (this.oAsiaEdition) {
        dojo.connect( this.oAsiaEdition, "onclick", this,
            function(ev) {
              dojo.stopEvent(ev);
              window.location = (this.isMDCPageFlag) ? this.tempConcatURL + this.asiaEditionMDCUrl
                  : this.oAsiaEdition.href;

              if (this.isMDCPageFlag) {
                dj.util.Region.setViewByRegion("asia");
                dj.util.Cookie.setGroupCookie("DJCOOKIE", "HOMEPAGE", "/home/asia", 365);
              }

            });
      }

      if (this.oChiEdition) {
        dojo.connect( this.oChiEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.open(this.oChiEdition.href);
        });
      }

      if (this.oGerEdition) {
        dojo.connect( this.oGerEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.open(this.oGerEdition.href);
        });
      }

      if (this.oJpnEdition) {
        dojo.connect( this.oJpnEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.open(this.oJpnEdition.href);
        });
      }

      if (this.oSpaEdition) {
        dojo.connect( this.oSpaEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.oSpaEdition.href;
        });
      }

      if (this.oPorEdition) {
        dojo.connect( this.oPorEdition, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.oPorEdition.href;
        });
      }

      if (this.osectionFooterSub) {
        dojo.connect( this.osectionFooterSub, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.osectionFooterSub.href;
        });
      }

      if (this.osectionFooterNonSub) {
        dojo.connect( this.osectionFooterNonSub, "onclick", this, function(ev) {
          dojo.stopEvent(ev);
          window.location = this.osectionFooterNonSub.href;
        });
      }

      if (this.currRegion == "asia") {
        currEdition = "Asia Edition Home";
        this.oSelectedEdition = dojo.query(asiaEditionLinkClassName, this.oHeader)[0];
      } else if (this.currRegion == "asia,india") {
        currEdition = "Asia Edition Home";
        this.oSelectedEdition = dojo.query(inEditionLinkClassName, this.oHeader)[0];
      } else if (this.currRegion == "europe") {
        currEdition = "Europe Edition Home";
        this.oSelectedEdition = dojo.query(euEditionLinkClassName, this.oHeader)[0];
      } else {
        
        currEdition = "U.S. Edition Home";
        this.oSelectedEdition = dojo.query(usEditionLinkClassName, this.oHeader)[0];
      }

      dojo.addClass(this.oSelectedEdition, "selected");

      this.oFormFactorContainer = dojo.byId("formFactorContainer");

      this.oLocDropDownContainer = dojo.byId("locNavContainer");
      this.oLocPopupContainer = dojo.byId("popupContainer");

      //dojo.removeClassName(this.oLocDropDownContainer,"location_collapsed");
     // dojo.addClassName(this.oLocDropDownContainer,"location_expanded");
      
      //dojo.style(this.oFormFactorContainer, {"display": ""});

      //dojo.style(this.oLocDropDownContainer, {"display": ""});
      
      if (this.oLocDropDownContainer) {
        var toggleDropdownClass = function() {
          this.oLocToggle = dojo.byId("loc_toggle");
        	
          if (dojo.hasClass(this.oLocToggle, selLocDrpdwnCollapsedClassName)) {
            dojo.removeClass(this.oLocToggle, selLocDrpdwnCollapsedClassName);
            dojo.addClass(this.oLocToggle, selLocDrpdwnExpandedClassName);
          } else if (dojo.hasClass(this.oLocToggle, selLocDrpdwnExpandedClassName)) {
            dojo.removeClass(this.oLocToggle, selLocDrpdwnExpandedClassName);
            dojo.addClass(this.oLocToggle, selLocDrpdwnCollapsedClassName);
          }
        };

        dojo.connect( this.oLocationNav, "onclick", this, function(event) {
          dojo.stopEvent(event);
          toggleDropdownClass();
        });

        //Close the dropdown when a click happens outside the locNavContainer
        dojo.connect(document, "onclick", this, function(event) {

          var isMousePointerinModalContainer = dj.util.Element.contains(this.oLocPopupContainer, event.clientX,
              event.clientY);
          if (isMousePointerinModalContainer == false) {
            if (dojo.hasClass(this.oLocToggle, selLocDrpdwnExpandedClassName)) {
              dojo.removeClass(this.oLocToggle, selLocDrpdwnExpandedClassName);
              dojo.addClass(this.oLocToggle, selLocDrpdwnCollapsedClassName);
            }
          }
        });

        this.oSectionFooterNonSub = dojo.byId("sectionFooterNonSub");
        this.oSectionFooterSub = dojo.byId("sectionFooterSub");
        
        dj.util.User.isLoggedIn(function(isLoggedIn) {
          if (isLoggedIn) {
            //dojo.style(that.oSectionFooterNonSub, {"display":"none" });
            //dojo.style(that.oSectionFooterSub, {"display": "" });
          } else {
            //dojo.style(that.oSectionFooterNonSub, {"display": "" });
            //dojo.style(that.oSectionFooterSub, {"display":"none" });
          }
        });
      }
    }
  };
}();
dojo.provide("dj.module.header.login");

dojo.require("dj.lang");
dojo.require("dj.util.Config");
dojo.require("dj.util.Cookie");
dojo.require("dj.util.Date");
dojo.require("dj.util.Region");
dojo.require("dj.util.Element");
dojo.require("dj.util.User");
dojo.require("dj.module.facebook.connect");

/**
 * Javascript functions to initialize and setup for Global Header
 *
 * Lookups are done only to find the first element matching the class in the header container. This can be updated to
 * lookup multiple elements and apply the required functionality if required.
 */
dj.module.header.login = function() {

  var DEFAULT_CONFIG = {
     HEADER_CONTAINER_CLASS: ".header",
     TIMESTAMP_CLASS: ".date",
     WSJ_LOGO_ID: "wsjLogo",
     WSJ_LARGE_LOGO_CLASSNAME: "logo_large",
     WSJ_SMALL_LOGO_CLASSNAME: "logo_small",
     CURRENT_SUBSECTION_DISPLAY_CLASS: ".currentSubSection",
     GLOBALNAV_SUBSECTION_ELEMENT_ID: "currentGlobalNavSubSection",
     SUBSCRIBER_LOGIN_CLASS: ".login",
     HEADER_PROMO_CLASS: ".promo",
     SUBSCRIBER_DETAILS_ELEMENT_ID: "subscribedUserDetailsId",
     COMMUNITY_FORUMS_LINK_CLASS: ".communityForumsLink",
     TODAYS_PAPER_LINK_CLASS: ".todaysPaperLink",
     MOJ_LINK_CLASS: ".myOnlineJournalLink",
     MESSAGE_CENTER_LINK_CLASS: ".messageCenterLink",
     MESSAGE_COUNT_CLASS: ".messageCount",
     LOGIN_USERNAME_ELEMENT_ID: "login_username",
     LOGIN_PASSWORD_ELEMENT_ID: "login_password",
     LOGIN_FORM_ID: "login_form",
     PAGE_URL_ELEMENT_ID: "page_url",
     LOGOUT_LINK_ELEMENT_ID: "logoutLink",
     LOGIN_BUTTON_ELEMENT_ID: "login_button",
     USER_NAME_ELEMENT_ID: "userName",
     WSJ_LOGO_FADE_APPEAR_DURATION: "1.0",
     WSJ_LOGO_DELAY_DURATION: "2000",
     LOGGED_IN_COMMUNITY_URL: "/community",
     //LOGGED_IN_TODAYS_PAPER_URL: "/page/us_in_todays_paper.html?mod=WSJ_formfactor",
     LOGGED_IN_TODAYS_PAPER_URL: "/itp?mod=WSJ_formfactor",
     LOGGED_IN_TODAYS_PAPER_URL_ASIA: "/itp/asia?mod=WSJ_formfactor",
     LOGGED_IN_TODAYS_PAPER_URL_EUROPE: "/itp/europe?mod=WSJ_formfactor",
     MESSAGE_CENTER_POST_URL: "/community/integration/userinfo.html",
      // MESSAGE_CENTER_POST_URL : "/community/integration/messagescount.html",
     LOGOUT_URL: "/static_html_files/logout_confirmation.htm",
     SUBSCRIBER_HOMEPAGE_PID: "0_0_WH_0001",
     NONSUBSCRIBER_HOMEPAGE_PID: "0_0_WH_0001_public",
     ASIA_PAGE_PID: "0_0_WP_2103",
     EUROPE_PAGE_PID: "0_0_WP_2104",
     NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID: "5_6007",
     NONSUBSCRIBER_SEARCH_PAGE_PID: "3_0466",
     HOMEPAGE_SUBSCRIBER_URL: "/",
     SEARCH_PAGE_SUBSCRIBER_URL: "/search",
     TODAYS_PAPER_LINK_CONTAINER_CLASS: ".todaysPaperLinkContainer",
     VIDEO_LINK_CONTAINER_CLASS: ".videoLinkContainer",
     COLUMNS_LINK_CONTAINER_CLASS: ".columnsLinkContainer",
     BLOGS_LINK_CONTAINER_CLASS: ".blogsLinkContainer",
     INTERACTIVE_GRAPHICS_LINK_CONTAINER_CLASS: ".interactiveGraphicsLinkContainer",
     TOPICS_LINK_CONTAINER_CLASS: ".topicsLinkContainer",
     COMMUNITY_FORUMS_LINK_CONTAINER_CLASS: ".communityForumsLinkContainer",
     TODAYS_PAPER_PID: "0_0_WP_40",
     TODAYS_PAPER_US_NONSUB_PID: "2_0433",
     TODAYS_PAPER_EUROPE_NONSUB_PID: "2_0434",
     TODAYS_PAPER_ASIA_NONSUB_PID: "2_0435",
     TODAYS_PAPER_US_PID: "2_0133",
     TODAYS_PAPER_EUROPE_PID: "2_0134",
     TODAYS_PAPER_ASIA_PID: "2_0135",
     TODAYS_PAPER_PAST_EDITIONS_PID: "2_0233",
     TODAYS_PAPER_INDEX_BIZ_PID: "2_0156",
     TODAYS_PAPER_INDEX_PEOPLE_PID: "2_0155",
     TODAYS_PAPER_CORRECTIONS_PID: "Corrections",
     VIDEO_PID: "0_0_WP_3000",
     BLOGS_PID: "8_0019",
     COLUMNS_PID: "2_0140",
     INTERACTIVE_GRAPHICS_PID: "0_0_WP_2003",
     TOPICS_PID: "0_0_WT_0001",
     NEWSLETTERS_ALERTS_SUB_PID: "5_6001",
     NEWSLETTERS_ALERTS_PUB_PID: "5_6003",
     MOJ_LINK_URL: "/page/my-journal-main.html",
     MDC_LINK_URL: "/mdc/page/marketsdata.html",
     MDC_PAGE_PID: "2_3000",
     COMMUNITY_HIGHLIGHT_COMPARE_URL: "/community",
     FORUMS_HIGHLIGHT_COMPARE_URL: "forums.wsj.com",
     FREE_REG_CLASS: ".freereg",
     LOCATION_NAV_CLASS: ".location_nav",
     LOCATION_NAV_COLLAPSED_CLASSNAME: "location_collapsed",
     LOCATION_NAV_EXPANDED_CLASSNAME: "location_expanded",
     US_EDITION_LINK_CLASS: ".map_us",
     EU_EDITION_LINK_CLASS: ".map_europe",
     ASIA_EDITION_LINK_CLASS: ".map_asia",
     IN_EDITION_LINK_CLASS: ".map_india",
     US_EDITION_MDC_URL: "/mdc/public/page/marketsdata.html",
     EU_EDITION_MDC_URL: "/mdc/public/page/marketsdata_europe.html",
     ASIA_EDITION_MDC_URL: "/mdc/public/page/marketsdata_asia.html",
     IN_EDITION_MDC_URL: "/mdc/public/page/marketsdata_asia.html",
     MDC_COMPARE_URL: "/mdc/",
     FOOTER_CONTAINER_CLASS: ".pagefooter",
     //PRO_HOOK
     GO_PRO_HOOK: "goprohook",
     GO_PRO_HOOK_REGION: ["all"]
  };

  return {
    /**
     * Initialize the Global Header Logo bar (G2)
     *
     * @param {Object}
     *            config
     */
    initialize: function(config) {
      this.cfg = dj.lang.cloneMixin(DEFAULT_CONFIG, config);
      var headerContainerClass = this.cfg.HEADER_CONTAINER_CLASS;
      this.oHeader = dojo.query(headerContainerClass)[0];
      this.currRegion = dj.util.Region.getViewByRegion();
      this.concatURL = '';
      this.subscriberLoginInit();
      this.displayGoPro();

      if ((typeof gcDomain !== "undefined") && (gcDomain !== null) && (gcDomain !== "")) {
        this.concatURL = "http://" + gcDomain;
      } else {
        this.concatURL = "http://" + document.domain;
      }
    },

    /**
     * Display Subscriber Info
     */
    subscriberLoginInit: function() {
      var that = this;
            dj.util.User.isLoggedIn(function(isLoggedIn) {
                if (isLoggedIn) {
                  that.displaySubscriberDetails();
                  that.setupLogout();
                } else {

                  that.setupLogin();

                  //var freeregClass = that.cfg.FREE_REG_CLASS;
                  //that.ofreereg = dojo.query(freeregClass, that.oHeader)[0];
                  //var registerModule = dojo.query("#register_module", that.ofreereg)[0];
                  //dojo.style(registerModule, {display: "none"});
                  //dojo.style(that.ofreereg, { display: "block" });

                  var subscriberLoginClass = that.cfg.SUBSCRIBER_LOGIN_CLASS;
                  that.oSubscriberLogin = dojo.query(subscriberLoginClass, that.oHeader)[0];
                  var loginModule = dojo.query(".login_module", that.oSubscriberLogin)[0];
                  dojo.style(loginModule, {display: "block"});
                  dojo.style(that.oSubscriberLogin, { display: "block" });

                  var headerPromoClass = that.cfg.HEADER_PROMO_CLASS;
                  that.oHeaderPromo = dojo.query(headerPromoClass, that.oHeader)[0];
                  dojo.style(that.oHeaderPromo, { display: "block" });
                }
              });
    },

    /**
     * Display the GoPro Promo
     */
    displayGoPro: function() {
      var that = this;

      dj.util.User.isSubLoggedIn(function(subLoggedIn){
            if(subLoggedIn) {
              var region_index = -1;
              dojo.forEach(
                that.cfg.GO_PRO_HOOK_REGION,
                function(element,index){
                  if(element===that.currRegion){
                    region_index = index;
                  }
                }
              );
              if(that.cfg.GO_PRO_HOOK_REGION[0] === "all" || region_index !== -1) {
                if(dojo.byId(that.cfg.GO_PRO_HOOK)){
                	dojo.removeClass(that.cfg.GO_PRO_HOOK, "hidden");
                }
              }
            }
      });
    },

    /**
     * Display the subscriber details
     */
    displaySubscriberDetails: function() {
      // Display the username
      var userNameElementId = this.cfg.USER_NAME_ELEMENT_ID;

      dj.util.User.renderCallsign(userNameElementId);

      // Construct Links for logged-in user
      // this.setupSubscriberLinks();
      var messageCenterLinkClass = this.cfg.MESSAGE_CENTER_LINK_CLASS;
      this.oMessageCenterLink = dojo.query(messageCenterLinkClass, this.oHeader)[0];

      var that = this;

      dj.util.User.isSubLoggedIn(function(subLoggedIn) {
        if (subLoggedIn) {
          that.setupMessageCenter();
        } else {
          that.setUpMJLinksForReg();
          if(that.oMessageCenterLink){
        	  dojo.style(that.oMessageCenterLink, {"display":"none" });
          }
        }
      });

      // Display the links specific to subscribed user
      var subscriberDetailsElementId = this.cfg.SUBSCRIBER_DETAILS_ELEMENT_ID;
      this.oSubscriberDetails = dojo.byId(subscriberDetailsElementId);
      dojo.removeClass(this.oSubscriberDetails, "hidden");
    },

    /**
     * Setup MJ Links for Reg user
     */
    setUpMJLinksForReg: function() {
      //Exception added below for handling footer link for MJ in-here
      var footerContainerClass = this.cfg.FOOTER_CONTAINER_CLASS;
      this.oFooter = dojo.query(footerContainerClass)[0];

      var mojLinkUrl = this.cfg.MOJ_LINK_URL;

      var mojLinkClass = this.cfg.MOJ_LINK_CLASS;
      this.oMojLinkHeader = dojo.query(mojLinkClass, this.oHeader)[0];
      this.oMojLinkFooter = dojo.query(mojLinkClass, this.oFooter)[0];

      if ((typeof gcDomain !== "undefined") && (gcDomain !== null) && (gcDomain !== "")) {
        if(this.oMojLinkHeader){
        	this.oMojLinkHeader.href = "http://" + gcDomain + mojLinkUrl;
        }
        if(this.oMojLinkFooter){
        	this.oMojLinkFooter.href = "http://" + gcDomain + mojLinkUrl;
        }
      } else {
    	if(this.oMojLinkHeader){  
    		this.oMojLinkHeader.href = mojLinkUrl;
    	}
    	if(this.oMojLinkFooter){
    		this.oMojLinkFooter.href = mojLinkUrl;
    	}	
      }
    },

    /**
     * Setup Subscriber Links
     */
    setupSubscriberLinks: function() {

      var todaysPaperLinkClass = this.cfg.TODAYS_PAPER_LINK_CLASS;
      this.oTodaysPaperLink = dojo.query(todaysPaperLinkClass, this.oHeader)[0];
      var loggedInTodaysPaperUrl = this.cfg.LOGGED_IN_TODAYS_PAPER_URL;

      var that = this;

      dj.util.User.isSubLoggedIn(function(subLoggedIn) {
        if (subLoggedIn) {
          if ((typeof gcDomain !== "undefined") && (gcDomain !== null) && (gcDomain !== "")) {
            that.oTodaysPaperLink.href = "http://" + gcDomain + loggedInTodaysPaperUrl;
          } else {
            that.oTodaysPaperLink.href = loggedInTodaysPaperUrl;
          }
        }
      });

    },

    /**
     * Message Center Setup
     */
    setupMessageCenter: function() {
      var messageCenterLinkClass = this.cfg.MESSAGE_CENTER_LINK_CLASS;
      this.oMessageCenterLink = dojo.query(messageCenterLinkClass, this.oHeader)[0];

      var messageCountClass = this.cfg.MESSAGE_COUNT_CLASS;
      this.oMessageCount = dojo.query(messageCountClass, this.oHeader)[0];

      // Url for Message Center and the no of messages
      var that = this;
      var setupMsgCenterLink = function(noOfMessages) {
        if (noOfMessages == '-1') {
          dojo.style(that.oMessageCenterLink, {"display":"none" });
        } else {
          that.oMessageCount.innerHTML = noOfMessages;
        }
      };

      var noOfMessages = dj.util.Cookie.getCookie("msgCount");

      if (noOfMessages === null) {
        var messageCenterPostUrl = this.cfg.MESSAGE_CENTER_POST_URL;


        var messageCountReq = dojo.xhrPost({
          url : messageCenterPostUrl,
          handleAs : "json",
          handle : function(data, ioargs) {
            var jsonObj = data;
            noOfMessages = jsonObj.MessagesCount;
            var userStatus = jsonObj.Status; //Set for expiry = 5 min == (5/24/60)
            dj.util.Cookie.setCookie("msgCount", noOfMessages, (5 / 24 / 60));
            dj.util.Cookie.setCookie("userStatus", userStatus, (5 / 24 / 60));
            setupMsgCenterLink(noOfMessages);
          },

          error: function(transport, exception) {
            console.error("Exception occured while posting posting Ajax Request: %s", exception);
          }

        });
      } else {
        setupMsgCenterLink(noOfMessages);
      }
    },

    /**
     * Subscriber Login
     */
    setupLogin: function() {
      var loginUserElementId = this.cfg.LOGIN_USERNAME_ELEMENT_ID;
      this.oUserName = dojo.byId(loginUserElementId);

      var loginPasswordElementId = this.cfg.LOGIN_PASSWORD_ELEMENT_ID;
      this.oPassword = dojo.byId(loginPasswordElementId);

      var loginButtonImageId = this.cfg.LOGIN_BUTTON_ELEMENT_ID;
      this.oLoginImg = dojo.byId(loginButtonImageId);

      var loginFormId = this.cfg.LOGIN_FORM_ID;
      this.oLoginForm = dojo.byId(loginFormId);
      if(this.oLoginForm != null){
    	  this.oLoginForm.reset();
      }

      var pageUrlId = this.cfg.PAGE_URL_ELEMENT_ID;
      this.oPageUrl = dojo.byId(pageUrlId);

      var that = this;

      if (this.oPageUrl !== null) {

        var nonSubscriberHomepagePid = this.cfg.NONSUBSCRIBER_HOMEPAGE_PID;
        var nonSubscriberSearchPagePid = this.cfg.NONSUBSCRIBER_SEARCH_PAGE_PID;
        var nonSubNewslettersAlertsPagePid = this.cfg.NONSUBSCRIBER_NEWSLETTERS_ALERTS_PAGE_PID;
        var mdcPagePid = this.cfg.MDC_PAGE_PID;

        var concatURL;

        if ((typeof gcDomain !== "undefined") && (gcDomain !== null) && (gcDomain !== "")) {
          concatURL = "http://" + gcDomain;
        } else {
          concatURL = "http://" + document.domain;
        }

        var oCurrentUrl;

        if (dojo.isIE) {
          oCurrentUrl = window.location.href;
        } else {
          oCurrentUrl = document.location.href;
        }

        var url_value = oCurrentUrl;
        if (typeof pID !== "undefined") {
          if (pID === nonSubscriberHomepagePid) {
            url_value = concatURL + this.cfg.HOMEPAGE_SUBSCRIBER_URL;
          } else if (pID === nonSubNewslettersAlertsPagePid) {
            url_value = concatURL + "/email";
          } else if (pID === nonSubscriberSearchPagePid) {
            url_value = concatURL + this.cfg.SEARCH_PAGE_SUBSCRIBER_URL;
          } else if (pID === mdcPagePid) {
            url_value = concatURL + this.cfg.MDC_LINK_URL;
          } else {
            url_value = oCurrentUrl;
          }

          var cachebuster = (url_value.indexOf("?")!=-1)? "&" : "?";
          //check for ? and add & otherwise
          if(typeof cachebuster!== undefined)
          {
            cachebuster = cachebuster+"_nocache="+new Date().getTime();
            if(url_value.indexOf("#")!=-1){
              url_value = url_value.replace("#",cachebuster+"#");
            }else{
              url_value = url_value + cachebuster;
            }
          }


          if (dojo.isIE) {
            document.login_form.url.value = url_value;
          } else {
            this.oPageUrl.value = url_value;
          }


        }

        if (this.oUserName !== null) {
          dojo.connect(this.oUserName, "onfocus", this, function(event) {
            dj.util.Form.clearValue(this.oUserName, "User Name");
          });

          dojo.connect(this.oUserName, "onclick", this, function(event) {
            dj.util.Form.clearValue(this.oUserName, "User Name");
          });

        }

        if (this.oPassword !== null) {

          dojo.connect(this.oPassword, "onfocus", this, function(event) {
            dj.util.Form.clearValue(that.oPassword, "Password");
            this.oPassword.type = "password";
          });

          dojo.connect(this.oPassword, "onclick", this, function(event) {
            dj.util.Form.clearValue(that.oPassword, "Password");
            //     this.oPassword.type = "password";
            });

          dojo.connect(this.oPassword, "onchange", this, function(event) {
            dj.util.Form.clearValue(that.oPassword, "Password");
            //    this.oPassword.type = "password";
            });
        }

        if (dojo.isIE) {
          dojo.connect(this.oLoginImg, "onclick", this, function(e) {
            document.login_form.url.value = oCurrentUrl;
            console.log("coming in to img onlick in IE" + oCurrentUrl);
            this.oLoginForm.submit();
          });
        }

        dojo.connect(this.oPassword, "onkeypress", this, function(e) {
          var cKeyCode = e.keyCode || e.which;
          if (dojo.isIE) {
            if (cKeyCode == dojo.keys.ENTER) {
              document.login_form.url.value = oCurrentUrl;
              this.oLoginForm.submit();
            }
          }
        });
      }
    },

    /**
     * Logout
     */
    setupLogout: function() {
      var logoutLinkElementId = this.cfg.LOGOUT_LINK_ELEMENT_ID;
      this.oLogout = dojo.byId(logoutLinkElementId);

      if (this.oLogout !== null) {
        //var logoutLinkUrl = this.cfg.LOGOUT_URL;
        //var logoutUrl = (typeof overrideHeaderLogout == "undefined") ? logoutLinkUrl : overrideHeaderLogout;

        dojo.connect(this.oLogout, "onclick", this, function(ev) {
          dojo.stopEvent(ev);

          //Delete the msgCount cookie
            dj.util.Cookie.deleteCookie("msgCount");

            //Delete the HOMEPAGE cookie
            dj.util.Cookie.deleteCookie("HOMEPAGE", true);
            document.cookie = "HOMEPAGE" + "=" + ";path=/" + ";domain=.wsj.com" + ";expires=Thu, 01-Jan-1970 00:00:01 GMT";

            //Disconnect from Facebook
            if((typeof dj.module.facebook.connect.logout == "function") && ( FB.getAuthResponse() ) ) {
            	dj.module.facebook.connect.logout( function() {
            		  if ((typeof gcDomain !== "undefined") && (gcDomain !== null) && (gcDomain !== "")) {
                    window.location = "/logout?url=http://" + gcDomain;
                  } else {
                    window.location = "/logout";
                  }
              });
            } else {
            	console.info("Facebook API is not available when executing Logout");
            	if ((typeof gcDomain !== "undefined") && (gcDomain !== null) && (gcDomain !== "")) {
                window.location = "/logout?url=http://" + gcDomain;
              } else {
                window.location = "/logout";
              }
            }


          });
      }
    }
  };

}();
dojo.provide("dj.module.header.exec._common");
dojo.require("dj.module.header.sectionMenu");

dj.module.header.exec._common = {
  init: function(_cfgObj) {
    var cfgObj = _cfgObj || {};
    this._exec(this.preInit);

    this._exec([
      function() {
        dj.module.header.sectionMenu.init();
      }
    ]);

    this._exec(this.postInit, cfgObj);
  },
  preInit: [],
  postInit: [],

  _exec: function(arr, cfgObj) {
    for (var i = 0; i < arr.length; i++) {
      var fn = arr[i];
      try {
        fn.call(null, cfgObj);
      } catch (e) {
        console.error("HeaderExec-"+i+": ", e);
      }
    }
  }
};
dojo.provide("dj.module.header.exec.NA_WSJ_SUB");
dojo.require("dj.module.header.exec._common");

dojo.require("dj.widget.networkHat.AutoComplete");
dojo.require("dj.module.header.globalHeader");
dojo.require("dj.module.header.localWeather");
dojo.require("dj.module.header.login");
dojo.require("dj.module.facebook.connect");
dojo.require("dj.widget.panel.SelectDropdownPanel");
dojo.require("gravity.beacon");

dj.module.header.exec.NA_WSJ_SUB = dojo.delegate(dj.module.header.exec._common, {
  postInit: [
    function() {
      dj.module.networkHatLoader = new dj.widget.networkHat.AutoComplete();
    },

    function() {
      dj.module.header.globalHeader.initialize();
    },

    function() {
      dj.module.header.localWeather.init({
        defaultLocation:"10005", 
        redirectUrl:"http://commerce.wsj.com/auth/login?roles=FREEREG-BASE&mg=cmy-wsj"
      });
    },

    function() {
      dj.module.header.login.initialize();
    },

    function() {
      dj.module.facebook.connect.init();
    },

    function() {
      var moreNode = dojo.byId("MoreIndustries_Container");
      if (moreNode) {
        dj.module.moreIndustries = new dj.widget.panel.SelectDropdownPanel(moreNode);
      }
    },
    
    function() {
      dj.module.browserPhaseout().init();
    },

    function() {
 	      gravity.beacon.init();
    } 
  ]
});
dojo.provide("dj.module.header.exec.NA_WSJ_PUB");
dojo.require("dj.module.header.exec._common");

dojo.require("dj.widget.networkHat.AutoComplete");
dojo.require("dj.module.header.globalHeader");
dojo.require("dj.module.header.localWeather");
dojo.require("dj.widget.panel.ModalPanel");
dojo.require("dj.module.header.login");
dojo.require("dj.module.facebook.connect");
dojo.require("dj.widget.panel.SelectDropdownPanel");
dojo.require("gravity.beacon");

dj.module.header.exec.NA_WSJ_PUB = dojo.delegate(dj.module.header.exec._common, {
  postInit: [
    function() {
      dj.module.networkHatLoader = new dj.widget.networkHat.AutoComplete();
    },

    function() {
      dj.module.header.globalHeader.initialize();
    },

    function() {
      dj.module.header.localWeather.init({
        defaultLocation:"10005",
        expireInterval: "2400",
        redirectUrl:"http://commerce.wsj.com/auth/login?roles=FREEREG-BASE&mg=cmy-wsj"
      });
    },

    function() {
      dj.module.facebook.connect.init();
    },

    function() {
      var moreNode = dojo.byId("MoreIndustries_Container");
      if (moreNode) {
        dj.module.moreIndustries = new dj.widget.panel.SelectDropdownPanel(moreNode);
      }
    },

    function() {
      if (typeof openHouseMode!=="undefined" && openHouseMode)
      { dojo.byId("hat_top_style").className=""; }      
   } ,

   function() {     
     dj.module.browserPhaseout().init();
   },

   function() {
	      gravity.beacon.init();
   },

   function(cfg){
	   if(typeof cfg != "undefined"){
		   dojo.require("dj.widget.loader.LoginLoader");
		   if (window.console) console.log("here... version is " + cfg.version );
		   dj.widget.loader.LoginLoader({isLoadJs:cfg.isLoadJs,version:cfg.version}).init();
	   }else{
		   if (window.console) console.log("..cfg....is undefined " );
	   }
   }

  ]
});
dojo.provide("dj.module.header.exec.NA_WSJ_REG");
dojo.require("dj.module.header.exec.NA_WSJ_SUB");

dj.module.header.exec.NA_WSJ_REG = dojo.delegate(dj.module.header.exec.NA_WSJ_SUB, {
});

dojo.provide("dj.module.honk.SingleSignOnService");dj.module.honk.SingleSignOnService={DEFAULT_CONFIG:{ssoSvcCall:"/cdssvco/honk/v1/GetMessage",cbfunc:null,cbcontext:null},login:function(svcConfig){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,svcConfig);this.svcresponseurl=null;this.identifier=null;this.callAjaxRequest();},callAjaxRequest:function(){var cb=(Math.floor(10000000*Math.random()));var _url=this.cfg.ssoSvcCall;var _me=this;var _ajaxrequest={url:_url+"?cb="+cb,headers:{Accept:"application/json"},handleAs:"json",load:function(response,ioArgs){var _jsonResponse=response;if(_jsonResponse.Identifier){_me.identifier=_jsonResponse.Identifier;console.log("Identifier in honk.js:::"+_me.identifier);}
if(_jsonResponse.URL){_me.svcresponseurl=_me.cfg.cbcontext.cfg.ssoSvcResponse+_jsonResponse.URL;}else{_me.svcresponseurl=_me.cfg.cbcontext.cfg.honkWebUrl;}
if(_me.cfg.cbfunc){if(_me.cfg.cbcontext){_me.cfg.cbfunc.apply(_me.cfg.cbcontext);}}
_me.svcresponseurl=null;_me.identifier=null;},error:function(response,ioArgs){}};dojo.xhrGet(_ajaxrequest);}};dojo.provide("dj.module.honk.Honk");dojo.require("dj.util.queryParam");dojo.require("dj.module.honk.SingleSignOnService");dojo.require("dojox.encoding.crypto.SimpleAES");dojo.require("dj.util.User");dojo.declare("dj.module.honk.Honk",[],{DEFAULT_CONFIG:{honkUrlDiv:"honkurl",iFrameId:"iframerightContent",defaultUrl:"http://uat.honk.com/wsj",honkWebUrl:"http://uat.honk.com",ajaxCallUrl:"/community/integration/RegisterTrueCarUser",ssoSvcResponse:"http://uat.honk.com/wsj",_ssosvc:dj.module.honk.SingleSignOnService,userLoggedIn:false,setIframe:true,thirdPartyIframeDiv:"truecarDiv",histogramIframe:{show:false,id:""}},constructor:function(honkConfig){this.cfg=dojo.mixin(this.DEFAULT_CONFIG,honkConfig);},init:function(){this.getURL();if(!this.cfg.userLoggedIn){console.log("Iframe src for public user:"+this._url);this.setContentCnt();}},getURL:function(){var honkUrl=this.cfg.defaultUrl;var uUrl=dj.util.queryParam.getQueryStrParam('u');if(uUrl==null||uUrl==""){var url="";var divTag=dojo.byId(this.cfg.honkUrlDiv);if(divTag!=null){url=dojo.byId(this.cfg.honkUrlDiv).innerHTML;honkUrl=this.cfg.honkWebUrl+url;console.log("honk url ------"+honkUrl);}}else{honkUrl=uUrl;}
console.log("testing url"+honkUrl);this._url=honkUrl;if((uUrl==null||uUrl=="")&&(url==null||url=="")&&(this.cfg.userLoggedIn)){this.cfg._ssosvc.login({cbfunc:this.setSSOUrl,cbcontext:this});}},setSSOUrl:function(){console.log("Identifier:::"+this.cfg._ssosvc.identifier);this._identifier=this.cfg._ssosvc.identifier;console.log(this.cfg._ssosvc.svcresponseurl);this._url=this.cfg._ssosvc.svcresponseurl;this.callAjaxRequest();console.log("Iframe src for loggedin user:"+this._url);this.setContentCnt();},setContentCnt:function(){if(this.cfg.setIframe){var index=this._url.indexOf("hideIFrame");if(index>-1){dojo.byId(this.cfg.iFrameId).className="hidden";}else{if(this.cfg.histogramIframe.show){if(dojo.byId(this.cfg.histogramIframe.id)){dojo.byId(this.cfg.histogramIframe.id).className="hidden";}}
dojo.byId(this.cfg.iFrameId).src=this._url;}}else{var that=this;dj.util.User.isLoggedIn(function(isLoggedIn){if(isLoggedIn){if(!that.cfg.userLoggedIn){console.log("inside userloggedin is false");that._identifier='1234';}}
this._identifier=that._identifier;});try{Tcpp.WhiteLabel.Widgets.Iframe.init({parentElement:dojo.byId(this.cfg.thirdPartyIframeDiv),url:this._url,userId:this._identifier,urlParamName:"u"});}catch(e){console.log("TrueCar resizing call failed.");}}},_getUserId:function(){var _userId=0;dj.util.User.getUserId(function(userId){_userId=userId;});return _userId;},callAjaxRequest:function(){var cb=(Math.floor(10000000*Math.random()));var _url=this.cfg.ajaxCallUrl;var _ajaxrequest={url:_url+"?cb="+cb,load:function(response,ioArgs){},error:function(response,ioArgs){}};dojo.xhrGet(_ajaxrequest);}});
dojo.provide("dj.widget.poll.Poll");dojo.require("dojo.cookie");dojo.require("dojox.encoding.digests.MD5");dojo.require("swfobject.swfobject_2_2.swfobject");dojo.declare("dj.widget.poll.Poll",null,{constructor:function(userConf){this.conf={expires:36500,voteOptionsParameter:"dj_vote",voteCookieName:"djpoll_vote",ajaxVoteOption:"noflash"};dojo.mixin(this.conf,userConf);},submitVote:function(voteUrl,pollName,hashKey,pollOption){var response;switch(this.conf.ajaxVoteOption){case'always':response=this.submitAjaxVote(voteUrl,pollName,hashKey,pollOption);break;case'never':break;case'noflash':if(swfobject.getFlashPlayerVersion().major<9){response=this.submitAjaxVote(voteUrl,pollName,hashKey,pollOption);}}
if(response&&response.error){return response;}
this.processCookie(pollOption);return response;},prepareAjaxUrl:function(voteUrl,pollName,hashKey,pollOption){if(dojo.cookie.isSupported()){var isChangedVote;var voteCookie=this.currentCookie;if(voteCookie===undefined){this.voteHash=this.generateVoteHash();}
else{this.voteHash=voteCookie.voteHash;}
var hashString=pollName+pollOption+this.voteHash+hashKey;var saltHash=dojox.encoding.digests.MD5(hashString,dojox.encoding.digests.outputTypes.Hex);var fullVoteUrl=voteUrl+pollName+"/"+pollOption+"/"+this.voteHash+"/"+saltHash;return fullVoteUrl;}},submitAjaxVote:function(voteUrl,pollName,hashKey,pollOption){var fullVoteUrl=this.prepareAjaxUrl(voteUrl,pollName,hashKey,pollOption);if(!this.currentCookie===undefined){fullVoteUrl=fullVoteUrl.replace("/vote/","/modifyvote/");}
var deferred=dojo.xhrPost({url:fullVoteUrl,handleAs:"json",sync:true,timeout:5000});return deferred.results[0]||{};},generateVoteHash:function(){var newdate=new Date();var randomNumber=Math.random();var voteHash=''+
newdate.getUTCFullYear()+
newdate.getUTCMonth()+
newdate.getUTCDate()+
newdate.getUTCHours()+
newdate.getUTCMinutes()+
newdate.getUTCSeconds()+
newdate.getUTCMilliseconds()+randomNumber;return voteHash;},displayPollResultAndFlashVote:function(communityURL,selectedPollOption,target){var resultURL=communityURL+"?"+this.conf.voteOptionsParameter+"="+selectedPollOption;if(target===undefined||target===''||target===null){location.href=resultURL;}
else{window.open(resultURL,target);}},getMyCookie:function(){return this.getMyCookieObject();},getMyCookieObject:function(){if(this.currentCookie===undefined){this.currentCookie=dojo.fromJson(this.getCookie());}
return this.currentCookie;},getCookie:function(){var voteCookie;var voteCookies=dojo.cookie(this.conf.voteCookieName);var oldCookieName='djpoll_vote_'+this.pollId;var oldCookie=dojo.cookie(oldCookieName);voteCookies=dojo.fromJson(voteCookies);if(voteCookies&&this.pollId in voteCookies){voteCookie=voteCookies[this.pollId];voteCookie=dojo.toJson(voteCookie);}else{voteCookie=(function(){})();}
if(oldCookie){var deletedCookie=(function(){})();voteCookie=dojo.fromJson(oldCookie);voteCookies=voteCookies||{};if(!voteCookies[this.pollId]){voteCookies[this.pollId]=voteCookie;this.writeCookie(voteCookies);}
dojo.cookie(oldCookieName,deletedCookie,{path:'/',expires:0});}
return voteCookie;},writeCookie:function(voteCookieObjects){dojo.cookie("djpoll_vote",dojo.toJson(voteCookieObjects),{path:'/',expires:this.conf.expires});this.currentCookie=voteCookieObjects[this.pollId];},processCookie:function(pollOption){if(this.voteHash===undefined){this.voteHash=this.generateVoteHash();}
voteCookieObjects=dojo.fromJson(dojo.cookie("djpoll_vote"))||{};voteCookieObjects[this.pollId]={pollOption:pollOption,voteHash:this.voteHash,time:new Date().getTime()};this.writeCookie(voteCookieObjects);},deletePollCookie:function(pollId){voteCookieObject=dojo.fromJson(dojo.cookie("djpoll_vote"))||{};delete voteCookieObject[pollId];this.writeCookie(voteCookieObject);return;}});dojo.provide("dj.widget.poll.PollView");dojo.require("dj.widget.poll.Poll");dojo.require("dj.lang");dojo.declare("dj.widget.poll.PollView",null,{constructor:function(userConf){this.conf={category:"",hashKey:"r0ckstar",radioButtonPrefix:".js_pollRadio_",submitButtonPrefix:".js_pollSubmit_",radioButtonNamePrefix:"pollSelection_",pollResultsPrefix:"pollResults_"};dojo.mixin(this.conf,userConf);if(this.conf.category===""){console.error("You must define a category");return{};}
this.pollService=new dj.widget.poll.Poll(this.conf);this.setCategroyDivAndPollId();this.setSubmitButton();this.setRadioButtons();this.setPollResultsAnchor();this.setInitialWidgetState();this.addUiEvent();},addUiEvent:function(){var me=this;dj.lang.addLiveEvent(this.conf.radioButtonPrefix+this.pollId,"click",function(event){me.enableSubmitButton();});dj.lang.addLiveEvent(this.conf.submitButtonPrefix+this.pollId,"click",function(event){dojo.stopEvent(event);me.submitVote();});},enableSubmitButton:function(){if(this.submitButton){dojo.removeAttr(this.submitButton,"disabled");dojo.removeClass(this.submitButton,"input-disabled");}else{console.error("%s submit button for poll id %s was not found.",this.conf.submitButtonPrefix+this.pollId,this.pollId);}},submitVote:function(){var submitButtonDisabledValue=dojo.attr(this.submitButton,"disabled");if(submitButtonDisabledValue===false||submitButtonDisabledValue===null||submitButtonDisabledValue===undefined||submitButtonDisabledValue===''){var selectedRadioButtons=this.getSelectedRadioButtons();if(selectedRadioButtons.length===1){var selectedRadioButton=selectedRadioButtons[0];var voteUrl=dojo.byId("voteUrl_"+this.pollId).value;var pollName=dojo.byId("pollName_"+this.pollId).value;var pollOption=selectedRadioButton.value;this.pollService.submitVote(voteUrl,pollName,this.conf.hashKey,pollOption);var displayUrl;var target;if(this.pollResultsAnchor){displayUrl=this.pollResultsAnchor.href;target=this.pollResultsAnchor.target;}
if(displayUrl===undefined||displayUrl===''||displayUrl===null){console.error("Community URL is missing for poll category %s",this.conf.category);}
else{this.pollService.displayPollResultAndFlashVote(displayUrl,pollOption,target);}}}},setCategroyDivAndPollId:function(){var pollDivs=dojo.query("div[data-poll-category='"+this.conf.category+"']");if(pollDivs.length===1){this.categoryDiv=pollDivs[0];this.pollId=dojo.attr(this.categoryDiv,"data-poll-id");this.pollService.pollId=this.pollId;if(this.pollId===null||this.pollId===''||this.pollId===undefined){console.error("No attribute data-poll-id specified for poll category %s",this.conf.category);}}
else{if(pollDivs.length===0){console.error("No poll div for category %s",this.conf.category);}
else{console.error("Too many poll divs for category %s",this.conf.category);}}},setSubmitButton:function(){var submitButtons=dojo.query(this.conf.submitButtonPrefix+this.pollId);if(submitButtons.length===1){this.submitButton=submitButtons[0];}
else{console.error("Expecting 1 submit button for poll category %s. Found %s instead.",this.conf.category,submitButtons.length);}},setRadioButtons:function(){this.radioButtons=dojo.query("input[name='"+this.conf.radioButtonNamePrefix+this.pollId+"']");if(this.radioButtons.length===0){console.error("No radio buttons found for poll category %s.",this.conf.category,submitButtons.length);}},setPollResultsAnchor:function(){var pollResultsAnchors=dojo.query("a[name='"+this.conf.pollResultsPrefix+this.pollId+"']");if(pollResultsAnchors.length===1){this.pollResultsAnchor=pollResultsAnchors[0];}},getSelectedRadioButtons:function(){return dojo.query("input[name='"+this.conf.radioButtonNamePrefix+this.pollId+"']:checked");},setInitialWidgetState:function(){this.setSelectedRadioButton();},setSelectedRadioButton:function(){this.checkDisableSubmitButton();var voteCookieObject=this.pollService.getMyCookieObject();if(voteCookieObject!==undefined){var me=this;dojo.forEach(this.radioButtons,function(item){me.checkRadioButton(item,voteCookieObject.pollOption);});}},checkDisableSubmitButton:function(){if(dojo.cookie.isSupported()){var voteCookie=this.pollService.getMyCookie();if(voteCookie===undefined){dojo.attr(this.submitButton,"disabled","true");}}},checkRadioButton:function(radioButton,cookiePollOption){if(radioButton.value==cookiePollOption){radioButton.checked=true;}}});dojo.provide("dj.util.excanvas");

// Copyright 2006 Google Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


// Known Issues:
//
// * Patterns are not implemented.
// * Radial gradient are not implemented. The VML version of these look very
//   different from the canvas one.
// * Clipping paths are not implemented.
// * Coordsize. The width and height attribute have higher priority than the
//   width and height style values which isn't correct.
// * Painting mode isn't implemented.
// * Canvas width/height should is using content-box by default. IE in
//   Quirks mode will draw the canvas using border-box. Either change your
//   doctype to HTML5
//   (http://www.whatwg.org/specs/web-apps/current-work/#the-doctype)
//   or use Box Sizing Behavior from WebFX
//   (http://webfx.eae.net/dhtml/boxsizing/boxsizing.html)
// * Non uniform scaling does not correctly scale strokes.
// * Optimize. There is always room for speed improvements.

// Only add this code if we do not already have a canvas implementation
if (!document.createElement('canvas').getContext) {

(function() {

    // alias some functions to make (compiled) code shorter
    var m = Math;
    var mr = m.round;
    var ms = m.sin;
    var mc = m.cos;
    var abs = m.abs;
    var sqrt = m.sqrt;

    // this is used for sub pixel precision
    var Z = 10;
    var Z2 = Z / 2;

    /**
    * This funtion is assigned to the <canvas> elements as element.getContext().
    * @this {HTMLElement}
    * @return {CanvasRenderingContext2D_}
    */
    function getContext() {
        return this.context_ ||
        (this.context_ = new CanvasRenderingContext2D_(this));
    }

    var slice = Array.prototype.slice;

    /**
    * Binds a function to an object. The returned function will always use the
    * passed in {@code obj} as {@code this}.
    *
    * Example:
    *
    *   g = bind(f, obj, a, b)
    *   g(c, d) // will do f.call(obj, a, b, c, d)
    *
    * @param {Function} f The function to bind the object to
    * @param {Object} obj The object that should act as this when the function
    *     is called
    * @param {*} var_args Rest arguments that will be used as the initial
    *     arguments when the function is called
    * @return {Function} A new function that has bound this
    */
    function bind(f, obj, var_args) {
        var a = slice.call(arguments, 2);
        return function() {
            return f.apply(obj, a.concat(slice.call(arguments)));
        };
    }

    var G_vmlCanvasManager_ = {
        init: function(opt_doc) {
            if (/MSIE/.test(navigator.userAgent) && !window.opera) {
                var doc = opt_doc || document;
                // Create a dummy element so that IE will allow canvas elements to be
                // recognized.
                doc.createElement('canvas');
                doc.attachEvent('onreadystatechange', bind(this.init_, this, doc));
            }
        },

        init_: function(doc) {
            // create xmlns
            if (!doc.namespaces['g_vml_']) {
                doc.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                           '#default#VML');

            }
            if (!doc.namespaces['g_o_']) {
                doc.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                           '#default#VML');
            }

            // Setup default CSS.  Only add one style sheet per document
            if (!doc.styleSheets['ex_canvas_']) {
                var ss = doc.createStyleSheet();
                ss.owningElement.id = 'ex_canvas_';
                ss.cssText = 'canvas{display:inline-block;overflow:hidden;' +
                // default size is 300x150 in Gecko and Opera
            'text-align:left;width:300px;height:150px}' +
            'g_vml_\\:*{behavior:url(#default#VML)}' +
            'g_o_\\:*{behavior:url(#default#VML)}';

            }

            // find all canvas elements
            var els = doc.getElementsByTagName('canvas');
            for (var i = 0; i < els.length; i++) {
                this.initElement(els[i]);
            }
        },

        /**
        * Public initializes a canvas element so that it can be used as canvas
        * element from now on. This is called automatically before the page is
        * loaded but if you are creating elements using createElement you need to
        * make sure this is called on the element.
        * @param {HTMLElement} el The canvas element to initialize.
        * @return {HTMLElement} the element that was created.
        */
        initElement: function(el, width, height) {
            if (!el.getContext) {

                this.width = width;
                this.height = height;

                el.getContext = getContext;

                // do not use inline function because that will leak memory
                el.attachEvent('onpropertychange', onPropertyChange);
                el.attachEvent('onresize', onResize);

                var attrs = el.attributes;
                if (attrs.width && attrs.width.specified) {
                    // TODO: use runtimeStyle and coordsize
                    // el.getContext().setWidth_(attrs.width.nodeValue);
                    el.style.width = attrs.width.nodeValue + 'px';
                } else {
                    el.width = el.clientWidth;
                }
                if (attrs.height && attrs.height.specified) {
                    // TODO: use runtimeStyle and coordsize
                    // el.getContext().setHeight_(attrs.height.nodeValue);
                    el.style.height = attrs.height.nodeValue + 'px';
                } else {
                    el.height = el.clientHeight;
                }
                //el.getContext().setCoordsize_()
            }
            return el;
        }
    };

    function onPropertyChange(e) {
        var el = e.srcElement;

        switch (e.propertyName) {
            case 'width':
                el.style.width = el.attributes.width.nodeValue + 'px';
                el.getContext().clearRect();
                break;
            case 'height':
                el.style.height = el.attributes.height.nodeValue + 'px';
                el.getContext().clearRect();
                break;
        }
    }

    function onResize(e) {
        var el = e.srcElement;
        if (el.firstChild) {
            el.firstChild.style.width = el.clientWidth + 'px';
            el.firstChild.style.height = el.clientHeight + 'px';
        }
    }

    //G_vmlCanvasManager_.init();

    // precompute "00" to "FF"
    var dec2hex = [];
    for (var i = 0; i < 16; i++) {
        for (var j = 0; j < 16; j++) {
            dec2hex[i * 16 + j] = i.toString(16) + j.toString(16);
        }
    }

    function createMatrixIdentity() {
        return [
      [1, 0, 0],
      [0, 1, 0],
      [0, 0, 1]
    ];
    }

    function matrixMultiply(m1, m2) {
        var result = createMatrixIdentity();

        for (var x = 0; x < 3; x++) {
            for (var y = 0; y < 3; y++) {
                var sum = 0;

                for (var z = 0; z < 3; z++) {
                    sum += m1[x][z] * m2[z][y];
                }

                result[x][y] = sum;
            }
        }
        return result;
    }

    function copyState(o1, o2) {
        o2.fillStyle = o1.fillStyle;
        o2.lineCap = o1.lineCap;
        o2.lineJoin = o1.lineJoin;
        o2.lineWidth = o1.lineWidth;
        o2.miterLimit = o1.miterLimit;
        o2.shadowBlur = o1.shadowBlur;
        o2.shadowColor = o1.shadowColor;
        o2.shadowOffsetX = o1.shadowOffsetX;
        o2.shadowOffsetY = o1.shadowOffsetY;
        o2.strokeStyle = o1.strokeStyle;
        o2.globalAlpha = o1.globalAlpha;
        o2.arcScaleX_ = o1.arcScaleX_;
        o2.arcScaleY_ = o1.arcScaleY_;
        o2.lineScale_ = o1.lineScale_;
    }

    function processStyle(styleString) {
        var str, alpha = 1;

        styleString = String(styleString);
        if (styleString.substring(0, 3) == 'rgb') {
            var start = styleString.indexOf('(', 3);
            var end = styleString.indexOf(')', start + 1);
            var guts = styleString.substring(start + 1, end).split(',');

            str = '#';
            for (var i = 0; i < 3; i++) {
                str += dec2hex[Number(guts[i])];
            }

            if (guts.length == 4 && styleString.substr(3, 1) == 'a') {
                alpha = guts[3];
            }
        } else {
            str = styleString;
        }

        return { color: str, alpha: alpha };
    }

    function processLineCap(lineCap) {
        switch (lineCap) {
            case 'butt':
                return 'flat';
            case 'round':
                return 'round';
            case 'square':
            default:
                return 'square';
        }
    }

    /**
    * This class implements CanvasRenderingContext2D interface as described by
    * the WHATWG.
    * @param {HTMLElement} surfaceElement The element that the 2D context should
    * be associated with
    */
    function CanvasRenderingContext2D_(surfaceElement) {
        this.m_ = createMatrixIdentity();

        this.mStack_ = [];
        this.aStack_ = [];
        this.currentPath_ = [];

        // Canvas context properties
        this.strokeStyle = '#000';
        this.fillStyle = '#000';

        this.lineWidth = 1;
        this.lineJoin = 'miter';
        this.lineCap = 'butt';
        this.miterLimit = Z * 1;
        this.globalAlpha = 1;
        this.canvas = surfaceElement;

        var el = surfaceElement.ownerDocument.createElement('div');
        el.style.width = G_vmlCanvasManager_.width; //surfaceElement.clientWidth + 'px';
        el.style.height = G_vmlCanvasManager_.height;  //surfaceElement.clientHeight + 'px';
        el.style.overflow = 'hidden';
        el.style.position = 'absolute';
        surfaceElement.appendChild(el);

        this.element_ = el;
        this.arcScaleX_ = 1;
        this.arcScaleY_ = 1;
        this.lineScale_ = 1;
    }

    var contextPrototype = CanvasRenderingContext2D_.prototype;
    contextPrototype.clearRect = function() {
        this.element_.innerHTML = '';
        this.currentPath_ = [];
    };

    contextPrototype.beginPath = function() {
        // TODO: Branch current matrix so that save/restore has no effect
        //       as per safari docs.
        this.currentPath_ = [];
    };

    contextPrototype.moveTo = function(aX, aY) {
        var p = this.getCoords_(aX, aY);
        this.currentPath_.push({ type: 'moveTo', x: p.x, y: p.y });
        this.currentX_ = p.x;
        this.currentY_ = p.y;
    };

    contextPrototype.lineTo = function(aX, aY) {
        var p = this.getCoords_(aX, aY);
        this.currentPath_.push({ type: 'lineTo', x: p.x, y: p.y });

        this.currentX_ = p.x;
        this.currentY_ = p.y;
    };

    contextPrototype.bezierCurveTo = function(aCP1x, aCP1y,
                                            aCP2x, aCP2y,
                                            aX, aY) {
        var p = this.getCoords_(aX, aY);
        var cp1 = this.getCoords_(aCP1x, aCP1y);
        var cp2 = this.getCoords_(aCP2x, aCP2y);
        bezierCurveTo(this, cp1, cp2, p);
    };

    // Helper function that takes the already fixed cordinates.
    function bezierCurveTo(self, cp1, cp2, p) {
        self.currentPath_.push({
            type: 'bezierCurveTo',
            cp1x: cp1.x,
            cp1y: cp1.y,
            cp2x: cp2.x,
            cp2y: cp2.y,
            x: p.x,
            y: p.y
        });
        self.currentX_ = p.x;
        self.currentY_ = p.y;
    }

    contextPrototype.quadraticCurveTo = function(aCPx, aCPy, aX, aY) {
        // the following is lifted almost directly from
        // http://developer.mozilla.org/en/docs/Canvas_tutorial:Drawing_shapes

        var cp = this.getCoords_(aCPx, aCPy);
        var p = this.getCoords_(aX, aY);

        var cp1 = {
            x: this.currentX_ + 2.0 / 3.0 * (cp.x - this.currentX_),
            y: this.currentY_ + 2.0 / 3.0 * (cp.y - this.currentY_)
        };
        var cp2 = {
            x: cp1.x + (p.x - this.currentX_) / 3.0,
            y: cp1.y + (p.y - this.currentY_) / 3.0
        };

        bezierCurveTo(this, cp1, cp2, p);
    };

    contextPrototype.arc = function(aX, aY, aRadius,
                                  aStartAngle, aEndAngle, aClockwise) {
        aRadius *= Z;
        var arcType = aClockwise ? 'at' : 'wa';

        var xStart = aX + mc(aStartAngle) * aRadius - Z2;
        var yStart = aY + ms(aStartAngle) * aRadius - Z2;

        var xEnd = aX + mc(aEndAngle) * aRadius - Z2;
        var yEnd = aY + ms(aEndAngle) * aRadius - Z2;

        // IE won't render arches drawn counter clockwise if xStart == xEnd.
        if (xStart == xEnd && !aClockwise) {
            xStart += 0.125; // Offset xStart by 1/80 of a pixel. Use something
            // that can be represented in binary
        }

        var p = this.getCoords_(aX, aY);
        var pStart = this.getCoords_(xStart, yStart);
        var pEnd = this.getCoords_(xEnd, yEnd);

        this.currentPath_.push({ type: arcType,
            x: p.x,
            y: p.y,
            radius: aRadius,
            xStart: pStart.x,
            yStart: pStart.y,
            xEnd: pEnd.x,
            yEnd: pEnd.y
        });

    };

    contextPrototype.rect = function(aX, aY, aWidth, aHeight) {
        this.moveTo(aX, aY);
        this.lineTo(aX + aWidth, aY);
        this.lineTo(aX + aWidth, aY + aHeight);
        this.lineTo(aX, aY + aHeight);
        this.closePath();
    };

    contextPrototype.strokeRect = function(aX, aY, aWidth, aHeight) {
        // Will destroy any existing path (same as FF behaviour)
        this.beginPath();
        this.moveTo(aX, aY);
        this.lineTo(aX + aWidth, aY);
        this.lineTo(aX + aWidth, aY + aHeight);
        this.lineTo(aX, aY + aHeight);
        this.closePath();
        this.stroke();
        this.currentPath_ = [];
    };

    contextPrototype.fillRect = function(aX, aY, aWidth, aHeight) {
        // Will destroy any existing path (same as FF behaviour)
        this.beginPath();
        this.moveTo(aX, aY);
        this.lineTo(aX + aWidth, aY);
        this.lineTo(aX + aWidth, aY + aHeight);
        this.lineTo(aX, aY + aHeight);
        this.closePath();
        this.fill();
        this.currentPath_ = [];
    };

    contextPrototype.createLinearGradient = function(aX0, aY0, aX1, aY1) {
        var gradient = new CanvasGradient_('gradient');
        gradient.x0_ = aX0;
        gradient.y0_ = aY0;
        gradient.x1_ = aX1;
        gradient.y1_ = aY1;
        return gradient;
    };

    contextPrototype.createRadialGradient = function(aX0, aY0, aR0,
                                                   aX1, aY1, aR1) {
        var gradient = new CanvasGradient_('gradientradial');
        gradient.x0_ = aX0;
        gradient.y0_ = aY0;
        gradient.r0_ = aR0;
        gradient.x1_ = aX1;
        gradient.y1_ = aY1;
        gradient.r1_ = aR1;
        return gradient;
    };

    contextPrototype.drawImage = function(image, var_args) {
        var dx, dy, dw, dh, sx, sy, sw, sh;

        // to find the original width we overide the width and height
        var oldRuntimeWidth = image.runtimeStyle.width;
        var oldRuntimeHeight = image.runtimeStyle.height;
        image.runtimeStyle.width = 'auto';
        image.runtimeStyle.height = 'auto';

        // get the original size
        var w = image.width;
        var h = image.height;

        // and remove overides
        image.runtimeStyle.width = oldRuntimeWidth;
        image.runtimeStyle.height = oldRuntimeHeight;

        if (arguments.length == 3) {
            dx = arguments[1];
            dy = arguments[2];
            sx = sy = 0;
            sw = dw = w;
            sh = dh = h;
        } else if (arguments.length == 5) {
            dx = arguments[1];
            dy = arguments[2];
            dw = arguments[3];
            dh = arguments[4];
            sx = sy = 0;
            sw = w;
            sh = h;
        } else if (arguments.length == 9) {
            sx = arguments[1];
            sy = arguments[2];
            sw = arguments[3];
            sh = arguments[4];
            dx = arguments[5];
            dy = arguments[6];
            dw = arguments[7];
            dh = arguments[8];
        } else {
            throw Error('Invalid number of arguments');
        }

        var d = this.getCoords_(dx, dy);

        var w2 = sw / 2;
        var h2 = sh / 2;

        var vmlStr = [];

        var W = 10;
        var H = 10;

        // For some reason that I've now forgotten, using divs didn't work
        vmlStr.push(' <g_vml_:group',
                ' coordsize="', Z * W, ',', Z * H, '"',
                ' coordorigin="0,0"',
                ' style="width:', W, 'px;height:', H, 'px;position:absolute;');

        // If filters are necessary (rotation exists), create them
        // filters are bog-slow, so only create them if abbsolutely necessary
        // The following check doesn't account for skews (which don't exist
        // in the canvas spec (yet) anyway.

        if (this.m_[0][0] != 1 || this.m_[0][1]) {
            var filter = [];

            // Note the 12/21 reversal
            filter.push('M11=', this.m_[0][0], ',',
                  'M12=', this.m_[1][0], ',',
                  'M21=', this.m_[0][1], ',',
                  'M22=', this.m_[1][1], ',',
                  'Dx=', mr(d.x / Z), ',',
                  'Dy=', mr(d.y / Z), '');

            // Bounding box calculation (need to minimize displayed area so that
            // filters don't waste time on unused pixels.
            var max = d;
            var c2 = this.getCoords_(dx + dw, dy);
            var c3 = this.getCoords_(dx, dy + dh);
            var c4 = this.getCoords_(dx + dw, dy + dh);

            max.x = m.max(max.x, c2.x, c3.x, c4.x);
            max.y = m.max(max.y, c2.y, c3.y, c4.y);

            vmlStr.push('padding:0 ', mr(max.x / Z), 'px ', mr(max.y / Z),
                  'px 0;filter:progid:DXImageTransform.Microsoft.Matrix(',
                  filter.join(''), ", sizingmethod='clip');")
        } else {
            vmlStr.push('top:', mr(d.y / Z), 'px;left:', mr(d.x / Z), 'px;');
        }

        vmlStr.push(' ">',
                '<g_vml_:image src="', image.src, '"',
                ' style="width:', Z * dw, 'px;',
                ' height:', Z * dh, 'px;"',
                ' cropleft="', sx / w, '"',
                ' croptop="', sy / h, '"',
                ' cropright="', (w - sx - sw) / w, '"',
                ' cropbottom="', (h - sy - sh) / h, '"',
                ' />',
                '</g_vml_:group>');

        this.element_.insertAdjacentHTML('BeforeEnd',
                                    vmlStr.join(''));
    };

    contextPrototype.stroke = function(aFill) {
        var lineStr = [];
        var lineOpen = false;
        var a = processStyle(aFill ? this.fillStyle : this.strokeStyle);
        var color = a.color;
        var opacity = a.alpha * this.globalAlpha;

        var W = 10;
        var H = 10;

        lineStr.push('<g_vml_:shape',
                 ' filled="', !!aFill, '"',
                 ' style="position:absolute;width:', W, 'px;height:', H, 'px;"',
                 ' coordorigin="0 0" coordsize="', Z * W, ' ', Z * H, '"',
                 ' stroked="', !aFill, '"',
                 ' path="');

        var newSeq = false;
        var min = { x: null, y: null };
        var max = { x: null, y: null };

        for (var i = 0; i < this.currentPath_.length; i++) {
            var p = this.currentPath_[i];
            var c;

            switch (p.type) {
                case 'moveTo':
                    c = p;
                    lineStr.push(' m ', mr(p.x), ',', mr(p.y));
                    break;
                case 'lineTo':
                    lineStr.push(' l ', mr(p.x), ',', mr(p.y));
                    break;
                case 'close':
                    lineStr.push(' x ');
                    p = null;
                    break;
                case 'bezierCurveTo':
                    lineStr.push(' c ',
                       mr(p.cp1x), ',', mr(p.cp1y), ',',
                       mr(p.cp2x), ',', mr(p.cp2y), ',',
                       mr(p.x), ',', mr(p.y));
                    break;
                case 'at':
                case 'wa':
                    lineStr.push(' ', p.type, ' ',
                       mr(p.x - this.arcScaleX_ * p.radius), ',',
                       mr(p.y - this.arcScaleY_ * p.radius), ' ',
                       mr(p.x + this.arcScaleX_ * p.radius), ',',
                       mr(p.y + this.arcScaleY_ * p.radius), ' ',
                       mr(p.xStart), ',', mr(p.yStart), ' ',
                       mr(p.xEnd), ',', mr(p.yEnd));
                    break;
            }


            // TODO: Following is broken for curves due to
            //       move to proper paths.

            // Figure out dimensions so we can do gradient fills
            // properly
            if (p) {
                if (min.x == null || p.x < min.x) {
                    min.x = p.x;
                }
                if (max.x == null || p.x > max.x) {
                    max.x = p.x;
                }
                if (min.y == null || p.y < min.y) {
                    min.y = p.y;
                }
                if (max.y == null || p.y > max.y) {
                    max.y = p.y;
                }
            }
        }
        lineStr.push(' ">');

        if (!aFill) {
            var lineWidth = this.lineScale_ * this.lineWidth;

            // VML cannot correctly render a line if the width is less than 1px.
            // In that case, we dilute the color to make the line look thinner.
            if (lineWidth < 1) {
                opacity *= lineWidth;
            }

            lineStr.push(
        '<g_vml_:stroke',
        ' opacity="', opacity, '"',
        ' joinstyle="', this.lineJoin, '"',
        ' miterlimit="', this.miterLimit, '"',
        ' endcap="', processLineCap(this.lineCap), '"',
        ' weight="', lineWidth, 'px"',
        ' color="', color, '" />'
      );
        } else if (typeof this.fillStyle == 'object') {
            var fillStyle = this.fillStyle;
            var angle = 0;
            var focus = { x: 0, y: 0 };

            // additional offset
            var shift = 0;
            // scale factor for offset
            var expansion = 1;

            if (fillStyle.type_ == 'gradient') {
                var x0 = fillStyle.x0_ / this.arcScaleX_;
                var y0 = fillStyle.y0_ / this.arcScaleY_;
                var x1 = fillStyle.x1_ / this.arcScaleX_;
                var y1 = fillStyle.y1_ / this.arcScaleY_;
                var p0 = this.getCoords_(x0, y0);
                var p1 = this.getCoords_(x1, y1);
                var dx = p1.x - p0.x;
                var dy = p1.y - p0.y;
                angle = Math.atan2(dx, dy) * 180 / Math.PI;

                // The angle should be a non-negative number.
                if (angle < 0) {
                    angle += 360;
                }

                // Very small angles produce an unexpected result because they are
                // converted to a scientific notation string.
                if (angle < 1e-6) {
                    angle = 0;
                }
            } else {
                var p0 = this.getCoords_(fillStyle.x0_, fillStyle.y0_);
                var width = max.x - min.x;
                var height = max.y - min.y;
                focus = {
                    x: (p0.x - min.x) / width,
                    y: (p0.y - min.y) / height
                };

                width /= this.arcScaleX_ * Z;
                height /= this.arcScaleY_ * Z;
                var dimension = m.max(width, height);
                shift = 2 * fillStyle.r0_ / dimension;
                expansion = 2 * fillStyle.r1_ / dimension - shift;
            }

            // We need to sort the color stops in ascending order by offset,
            // otherwise IE won't interpret it correctly.
            var stops = fillStyle.colors_;
            stops.sort(function(cs1, cs2) {
                return cs1.offset - cs2.offset;
            });

            var length = stops.length;
            var color1 = stops[0].color;
            var color2 = stops[length - 1].color;
            var opacity1 = stops[0].alpha * this.globalAlpha;
            var opacity2 = stops[length - 1].alpha * this.globalAlpha;

            var colors = [];
            for (var i = 0; i < length; i++) {
                var stop = stops[i];
                colors.push(stop.offset * expansion + shift + ' ' + stop.color);
            }

            // When colors attribute is used, the meanings of opacity and o:opacity2
            // are reversed.
            lineStr.push('<g_vml_:fill type="', fillStyle.type_, '"',
                   ' method="none" focus="100%"',
                   ' color="', color1, '"',
                   ' color2="', color2, '"',
                   ' colors="', colors.join(','), '"',
                   ' opacity="', opacity2, '"',
                   ' g_o_:opacity2="', opacity1, '"',
                   ' angle="', angle, '"',
                   ' focusposition="', focus.x, ',', focus.y, '" />');
        } else {
            lineStr.push('<g_vml_:fill color="', color, '" opacity="', opacity,
                   '" />');
        }

        lineStr.push('</g_vml_:shape>');

        this.element_.insertAdjacentHTML('beforeEnd', lineStr.join(''));
    };

    contextPrototype.fill = function() {
        this.stroke(true);
    }

    contextPrototype.closePath = function() {
        this.currentPath_.push({ type: 'close' });
    };

    /**
    * @private
    */
    contextPrototype.getCoords_ = function(aX, aY) {
        var m = this.m_;
        return {
            x: Z * (aX * m[0][0] + aY * m[1][0] + m[2][0]) - Z2,
            y: Z * (aX * m[0][1] + aY * m[1][1] + m[2][1]) - Z2
        }
    };

    contextPrototype.save = function() {
        var o = {};
        copyState(this, o);
        this.aStack_.push(o);
        this.mStack_.push(this.m_);
        this.m_ = matrixMultiply(createMatrixIdentity(), this.m_);
    };

    contextPrototype.restore = function() {
        copyState(this.aStack_.pop(), this);
        this.m_ = this.mStack_.pop();
    };

    contextPrototype.translate = function(aX, aY) {
        var m1 = [
      [1, 0, 0],
      [0, 1, 0],
      [aX, aY, 1]
    ];

        this.m_ = matrixMultiply(m1, this.m_);
    };

    contextPrototype.rotate = function(aRot) {
        var c = mc(aRot);
        var s = ms(aRot);

        var m1 = [
      [c, s, 0],
      [-s, c, 0],
      [0, 0, 1]
    ];

        this.m_ = matrixMultiply(m1, this.m_);
    };

    contextPrototype.scale = function(aX, aY) {
        this.arcScaleX_ *= aX;
        this.arcScaleY_ *= aY;
        var m1 = [
      [aX, 0, 0],
      [0, aY, 0],
      [0, 0, 1]
    ];

        var m = this.m_ = matrixMultiply(m1, this.m_);

        // Get the line scale.
        // Determinant of this.m_ means how much the area is enlarged by the
        // transformation. So its square root can be used as a scale factor
        // for width.
        var det = m[0][0] * m[1][1] - m[0][1] * m[1][0];
        this.lineScale_ = sqrt(abs(det));
    };

    /******** STUBS ********/
    contextPrototype.clip = function() {
        // TODO: Implement
    };

    contextPrototype.arcTo = function() {
        // TODO: Implement
    };

    contextPrototype.createPattern = function() {
        return new CanvasPattern_;
    };

    // Gradient / Pattern Stubs
    function CanvasGradient_(aType) {
        this.type_ = aType;
        this.x0_ = 0;
        this.y0_ = 0;
        this.r0_ = 0;
        this.x1_ = 0;
        this.y1_ = 0;
        this.r1_ = 0;
        this.colors_ = [];
    }

    CanvasGradient_.prototype.addColorStop = function(aOffset, aColor) {
        aColor = processStyle(aColor);
        this.colors_.push({ offset: aOffset,
            color: aColor.color,
            alpha: aColor.alpha
        });
    };

    function CanvasPattern_() { }

    // set up externs
    G_vmlCanvasManager = G_vmlCanvasManager_;
    CanvasRenderingContext2D = CanvasRenderingContext2D_;
    CanvasGradient = CanvasGradient_;
    CanvasPattern = CanvasPattern_;

})();

} // if
dojo.provide("dj.widget.livenews.view.baseLiveUpdateView");

dojo.declare("dj.widget.livenews.view.baseLiveUpdateView", null, {
	actions : {NONE:0,INSERT:1,UPDATE:2,DELETE:3},
	containerObject : null,
	DEFAULT_CONFIG : {
		updateCount : 10,
		imagePrefix : 'http://si.wsj.net/public/resources/images/',
		multiArray : null,
		chartPrefix : 'http://si.wsj.net/public/resources/images/',
		chartMultiArray : null,
		wrapperImgClass : 'newsImage newsImage-A'
	},

	constructor: function(args){
	    dojo.safeMixin(this, args);
	},

  	render : function(response) {
		console.error("{baseLiveUpdateView:render} - This is an abstract class, please define implementation");
	},

	CleanBad : function(string) {
	   for (var i=0, output='', valid="eE-0123456789."; i<string.length; i++)
	   if (valid.indexOf(string.charAt(i)) != -1)
		   output += string.charAt(i)
	   return output;
	},

	getTime : function(time) {
	   var that = this;
	   var sAve = 0;
	   var ez1 = "";
	   var ml3 = "00";
	   var pw3 = parseFloat(that.CleanBad(time));
	   var pm4 = that.CleanBad(time);
	   var pm5 = that.CleanBad(time);
	   var len = pm4.length;
	   if (len != 4) {
		   return time;
	   }
	   else if (pw3>2401) {
		   return time;
	   }
	   else if (pw3>1259) {
		   pw3 = pw3 - 1200;

		   var pm4 = String(pw3);

		   var len = pm4.length;
		   if (len < 4) {
			   pm4 = "0"+ pm4;
		   }

		   if (pm4.substring(0, 1) == "0") {
			   var hours = pm4.substring(1, 2);
		   }
		   else {
			   	var hours = pm4.substring(0, 2);
		   }
		   var mins = pm4.substring(2, 4);
		   ez1 = " P.M.";
		   if (hours == "12") ez1 = " A.M.";
		   if (mins > "59") mins = "???";
		   return hours + ":" + mins + ez1;
	   }
	   else {
		   if (pm4.substring(0, 1) == "0") {
			   var hours = pm4.substring(1, 2);
		   }
		   else {
			   var hours = pm4.substring(0, 2);
		   }
		   var mins = pm4.substring(2, 4);
		   ez1 = " A.M.";
		   if (hours == "12") {
			   ez1 = " P.M.";
		   }
		   if (pm5.substring(0, 2) == "00") {
			   hours = "12";
		   }
		   if (mins > "59")
			   mins = "???";

		   return hours + ":" + mins + ez1;
	   }
	  }

});
dojo.provide("dj.widget.livenews.view.mrktView");

dojo.declare("dj.widget.livenews.view.mrktView", null, {

  containerObject : null,
  constructor: function(userConf) {
	this.conf = {
    };
    dojo.safeMixin(this.conf, userConf);
  },

  render : function(data) {
	  that = this;

	  var containerLi = dojo.query("[data-bluegrass-channel='"+data.h.t+"']");
	  dojo.forEach(containerLi, function(liElement) {

		  var innerEle;
		  var spanEle;
		  var spanEleSec;
		  var deltaClass = "deltaType-noChange";
		  var pos_sign = '+';

		  var updateFlag = that.getMetaData(data, "Y");
		  if(updateFlag !== "normal") {
			  return;
		  }

		  if(liElement.id == 'marketdata_stocks')
		  {
			  innerEle = liElement.children;
			  var sChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(sChange !== "error" && (la !== null && la !== "error")) {
				  if(sChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  spanEle = innerEle[1].children[0].children;
				  spanEle[1].innerHTML = la;

				  spanEleSec = innerEle[1].children;

				  spanEleSec[1].innerHTML = '<span class="marketDelta '+deltaClass+'"> '+pos_sign + sChange +' ('+pos_sign+that.getMetaData(data, "PC")+'%)</span>';
			  }

		  } else if(liElement.id == 'marketdata_actives')
		  {
			  innerEle = liElement.children[0].children;
			  var aChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if(aChange !== "error") {
				  if(aChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  var delayChannel = dj.util.Element.getData(liElement  , "delayed-bluegrass-channel");
				  if((delayChannel == null || delayChannel === undefined) && (vl !== null && vl !== "error")) {
					  innerEle[1].innerHTML = '<div class="info_int"><span class="info_intValue">'+vl+'</span></div>'+
		            	'<div class="marketDelta '+deltaClass+'"> '+pos_sign+aChange+'<span class="marketDeltaDivider"> | </span>'+pos_sign+that.getMetaData(data, "PC")+'%</div>';
				  } else {
					  spanEle = innerEle[1].children;
					  dojo.removeClass(spanEle[1],"deltaType-positive");
					  dojo.removeClass(spanEle[1],"deltaType-negative");
					  dojo.addClass(spanEle[1],deltaClass );
				  	  spanEle[1].innerHTML = pos_sign+aChange+'<span class="marketDeltaDivider"> | </span>'+pos_sign+that.getMetaData(data, "PC")+'%';
				  }
			  }
		  } else if(liElement.id == 'marketdata_gainers' || liElement.id == 'marketdata_decliners')
		  {
			  innerEle = liElement.children[0].children;
			  var gChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(gChange !== "error" && (la !== null && la !== "error")) {
				  if(gChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  spanEle = innerEle[1].children;
				  spanEle[0].innerHTML = '<span class="info_intValue '+deltaClass+'">'+pos_sign+that.getMetaData(data, "PC")+'%</span>';
				  spanEleSec = innerEle[1].children[1].children;
				  var currency = spanEleSec[1].innerHTML;
				  spanEle[1].innerHTML = '<span class="'+deltaClass+'">'+pos_sign+gChange+'</span> <span class="marketDeltaDivider"> '+currency+'</span>'+la;
			  }

		  } else if(liElement.id == 'marketdata_volume')
		  {
			  innerEle = liElement.children[0].children;
			  divInnerEle = innerEle[1].children;
			  var vChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if( vChange !== "error" ) {
				  if(vChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }
				  var delayChannel = dj.util.Element.getData(liElement  , "delayed-bluegrass-channel");
				  if( (delayChannel == null || delayChannel === undefined) && (vl !== null && vl !== "error")){
					  var avgVol = divInnerEle[0].children[2].innerHTML.replace(/,/g,"");
					  var newVolume = vl.replace(/,/g,"");
					  var diffVol = ( ((newVolume - avgVol) / avgVol) * 100);
					  if (diffVol.toFixed){
						  diffVol = diffVol.toFixed(2);
				      }
					  newVolume = that.formatCurrency(newVolume, 'VL');
					  diffVol = that.formatCurrency(diffVol, 'LA');

					  divInnerEle[0].children[1].innerHTML = diffVol;

					  divInnerEle[1].innerHTML = '<span class="market_intValue">'+newVolume+' </span> <span class="marketDeltaDivider"> | </span> <span class="'+deltaClass+'">'+pos_sign+vChange+'%</span>';
				  } else {
					  divInnerEle[1].innerHTML = '<span class="market_intValue">'+divInnerEle[1].children[0].innerHTML + '</span><span class="marketDeltaDivider"> | </span> <span class="'+deltaClass+'">'+pos_sign+vChange+'%</span>';
				  }
			  }
		  } else if(liElement.id == 'live_market_stocks')
		  {
			  innerEle = liElement.children;

			  var sChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(sChange !== "error" && (la !== null && la !== "error")) {
				  if(sChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  spanEle = innerEle[1].children[0].children;
				  spanEle[1].innerHTML = la;
				  spanEleSec = innerEle[1].children;

				  //spanEleSec[1].innerHTML = '<span class="marketDelta '+deltaClass+'"> '+pos_sign + sChange +' ('+pos_sign+that.getMetaData(data, "PC")+'%)</span>';
				  spanEleSec[1].innerHTML = ' '+pos_sign + sChange +' ('+pos_sign+that.getMetaData(data, "PC")+'%)';
				  dojo.removeClass(spanEleSec[1], "deltaType-negative");
				  dojo.removeClass(spanEleSec[1], "deltaType-positive");
				  dojo.addClass(spanEleSec[1], deltaClass);
			  } else {
				  console.error("Data is incorrect for : "+ data.b.t + "[ " + data.b.c + ", "+  la +  " ]");
			  }

		  } else if(liElement.id == 'live_market_charts')
		  {
			  innerEle = liElement.children;
			  innerEleChild = innerEle[0].children;

			  var sChange = that.getMetaData(data, "CH");
			  var la = that.getMetaData(data, "LA");

			  if(sChange !== "error" && (la !== null && la !== "error")) {
				  innerEleChild[1].children[1].innerHTML = la;

				  if(sChange.indexOf('-') === -1 ){
					  deltaClass = "deltaType-positive";
					  pos_sign = '+';
				  } else {
					  deltaClass = "deltaType-negative";
					  pos_sign = '';
				  }

				  innerEle[1].innerHTML = '<span class="marketDelta '+deltaClass+'"> '+pos_sign+sChange+ ' ('+pos_sign+that.getMetaData(data, "PC")+'%)</span>';
			  }
		  }

	  });

	  var delayedLi = dojo.query("[data-delayed-bluegrass-channel='"+data.h.t+"']");
	  that.populateDelayedData(delayedLi, data, that);
  },

 populateDelayedData : function(containerLi, data, that){

	  dojo.forEach(containerLi, function(liElement) {

		  var innerEle;
		  var spanEle;
		  var spanEleSec;
		  var deltaClass = "deltaType-noChange";
		  var pos_sign = '+';

		  var updateFlag = that.getMetaData(data, "Y");
		  if(updateFlag !== "normal") {
			  return;
		  }

		  if(liElement.id == 'marketdata_actives')
		  {
			  innerEle = liElement.children[0].children;
			  var aChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if(vl !== null && vl !== "error") {

				  var realChannel = dj.util.Element.getData(liElement  , "bluegrass-channel");
				  if((realChannel == null || realChannel === undefined) && aChange !== "error") {
					  if(aChange.indexOf('-') === -1 ){
						  deltaClass = "deltaType-positive";
						  pos_sign = '+';
					  } else {
						  deltaClass = "deltaType-negative";
						  pos_sign = '';
					  }
					  innerEle[1].innerHTML = '<div class="info_int"><span class="info_intValue">'+vl+'</span></div>'+
		            	'<div class="marketDelta '+deltaClass+'"> '+pos_sign+aChange+'<span class="marketDeltaDivider"> | </span>'+pos_sign+that.getMetaData(data, "PC")+'%</div>';
				  } else {
					  spanEle = innerEle[1].children;
				  	  spanEle[0].innerHTML = '<span class="info_intValue">'+vl +'</span></div>';
				  }
			  }
		  } else if(liElement.id == 'marketdata_volume')
		  {
			  innerEle = liElement.children[0].children;
			  divInnerEle = innerEle[1].children;
			  var vChange = that.getMetaData(data, "CH");
			  var vl = that.getMetaData(data, "VL");

			  if( vl !== null && vl !== "error" ) {
				  var avgVol = divInnerEle[0].children[2].innerHTML.replace(/,/g,"");
				  var newVolume = vl.replace(/,/g,"");
				  var diffVol = ( ((newVolume - avgVol) / avgVol) * 100);
				  if (diffVol.toFixed){
					  diffVol = diffVol.toFixed(2);
			      }
				  newVolume = that.formatCurrency(newVolume, 'VL');
				  diffVol = that.formatCurrency(diffVol, 'LA');

				  divInnerEle[0].children[1].innerHTML = diffVol;


				  var realChannel = dj.util.Element.getData(liElement  , "bluegrass-channel");
				  if( (realChannel == null || realChannel === undefined) && vChange !== "error"){
					  if(vChange.indexOf('-') === -1 ){
						  deltaClass = "deltaType-positive";
						  pos_sign = '+';
					  } else {
						  deltaClass = "deltaType-negative";
						  pos_sign = '';
					  }
					  divInnerEle[1].innerHTML = '<span class="market_intValue">'+newVolume+' </span> <span class="marketDeltaDivider"> | </span> <span class="'+deltaClass+'">'+pos_sign+vChange+'%</span>';
				  } else {
					  divInnerEle[1].children[0].innerHTML = '<span class="market_intValue">'+newVolume+' </span>';
				  }
			  }
		  }

	  });


  },

  getMetaData : function(_d, _t, _cont) {

	  var _m ="";
	  try{
	      switch(_t) {
		      case "CH": // Change
		        _m = _d.b.c;
		        if(_m === null){
		        	_m = "error"; // Error scenario not expected
		        }
		        break;
		      case "Y": // updateflag
			        _m = _d.b.y;
			        if(_m === null){
			        	_m = "error"; // Error scenario not expected
			        }
	            break;
		      case "PC": // % Change
		        _m = ((_d.b.c*100)/(_d.b.l - _d.b.c) );
		        break;
		      case "VL": // Volume
		        _m = _d.b.v;
		        if(_m !== null){
		        	_m = that.formatCurrency(_m, 'VL');
		        }
		        break;
		      case "LA": // Last-Price
		        _m = _d.b.l;
		        if(_m !== null){
		        	_m = that.formatCurrency(_m, 'LA');
		        }
		        break;
		      default : // default - Last
		        _m = _d.b.l;
		        break;
	      }
	      if(_m !== null){
	      	if (_m.toFixed){
	      		_m = _m.toFixed(2);
	      	}
	      }
	  }catch(err)
	  {
		  console.log("error while calculating either price, change or volume.");
		  _m = "error";
	  }

      return _m;
  },

  formatCurrency : function(num, type) {
		  num = num.toString().replace(/\$|\,/g,'');
		  if(isNaN(num)) {
			  num = "0";
		  }
		  sign = (num == (num = Math.abs(num)));
		  num = Math.floor(num*100+0.50000000001);
		  cents = num%100;
		  num = Math.floor(num/100).toString();

		  for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
		  num = num.substring(0,num.length-(4*i+3))+','+ num.substring(num.length-(4*i+3));

		  if(type === 'LA') {
			  if(cents > 10) {
				  num = num + '.' + cents;
			  } else if(cents > 0 && cents<10) {
				  num = num + '.0' + cents;
			  } else if( cents == 0) {
				  num = num + '.00';
			  }
		  }
		  return (((sign)?'':'-') + num);

  }

});
dojo.provide("dj.module.marketdataticker.marketDataRenderer");

dojo.require("dj.widget.panels.PanelsFactory");
dojo.require("dj.util.Page");

if (typeof dj.module === "undefined") {
  dj.module = {};
}

if (typeof dj.module.marketdataticker.marketDataRenderer === "undefined") {
	dj.module.marketdataticker.marketDataRenderer = {};
}

var _djl = dj.lang;
var _djp = dj.util.Page;

dj.module.marketdataticker.marketDataRenderer = {

  init : function(conf) {
    // Check for IE to change canvas for VML
    if(_djl.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                   '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                   '#default#VML');
      }
    }

    // Default Configuration
    this.configuration = {
      moduleName : "marketDataModule",
      defaultTab : 1,
      refreshModule : false,
      refreshRate : 60,

      moduleContainer : "marketDataContainer",
      tabs : ["stocksinnews", "actives", "gainers", "decliners", "unusualVolume"],

      dataContainer : "marketDataTable_",
      showMyMarkets: true

    };
    _djl.mixin(this.configuration, conf);

    this.timer = "";

    this.panelData = [];
    this.panels = this.createPanels(this.configuration.moduleContainer);

    if(this.configuration.refreshModule) {
      _djp.enableModuleRefresh(this.configuration.moduleName);
      //this.setRefresh(this.configuration.refreshRate);
    }
  },

  showHideTip: function(objId) {

	  var toolTipDiv = dojo.byId(objId);

	  var indexVal = toolTipDiv.className.indexOf("hidden");

      if((toolTipDiv.className).indexOf("hidden") == -1)
      {
          dojo.addClass(toolTipDiv,"hidden");
      }
      else
      {
    	  dojo.removeClass(toolTipDiv, "hidden");
      }
 },


  /**
   * Refresh rate in seconds
   */
  setRefresh: function(refreshRate) {
    var that = this;
    that.timer = setInterval(function(){
      if(_djp.isModuleRefreshEnabled(that.configuration.moduleName)) {
        /*that.getTableData();
        that.renderChart();
        that.getChartData();
        console.log("Refreshed Market Data");*/
      }
    }, refreshRate * 1000);
  },

  createPanels : function(container) {
    var that = this;

    return dj.widget.panels.PanelsFactory.create(container, {
      core: {
        panelPrefix:     "marketDataPanel_",
        panels:          that.configuration.tabs,
        enableHistory:   false,
        activePanel:     that.configuration.defaultTab
      },

      tabs: {
        tabPrefix:       "marketDataTab_",
        tabOnStyle:      "selected",
        tabOffStyle:     ""
      }
    });
  }
};
dojo.provide("dj.module.stockinnews.mrktProvider");
dojo.require("dj.lang");
dojo.require("dj.util.bluegrass");

dojo.declare("dj.module.stockinnews.mrktProvider", null, {
    channels : [],
    _cfg : {},
    connectFlag : null,

    DEFAULT_CONFIG : {
      toURL : dj.context.marketdata.bluegrass.toURL,
      viaURL : dj.context.marketdata.bluegrass.viaURL
    },


    constructor : function(cfg) {
        this._cfg = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
     },

    subscribeToChannel : function(channel, theView) {
      this.channels.push( {
        channelName : channel,
        view : theView
      });
    },

    subscribeToChannels : function(channels, theView) {
      var that = this;
      dojo.forEach(channels, function(channel){
    	that.subscribeToChannel(channel, theView);
      });
    },

    dynamicSubscribeChannel : function(dynamicChannels, theView, channels) {
    that = this;

	 try{
	      var connection = dj.util.bluegrass.Runtime.getConnection();
	      if (connection != null) {
	          dojo.forEach(dynamicChannels,function(channel) {
	              if (typeof channel.view.render == "function") {
	                var callback = dojo.hitch(channel.view,channel.view.render);
	                channel = connection.subscribe(channel.channelName, callback);
	              } else {
	                console.log("View object for channel %s does not have a render method",
	                        channelName);
	              }
	            });
	        } else {
	        	console.log("{dynamicSubscribeChannel} subscribeToChannels");
	        	that.subscribeToChannels(channels, theView);
	        }

	      } catch (e){
	    	  console.log(e);
	      }
    },


    connectCallback : function(backendConnection, type) {
      if (type == "connect") {
        connection = backendConnection;
        this.connectFlag = true;
        var channelsArray = this.channelList;

        dojo.forEach(channelsArray,function(channel) {
            if (typeof channel.view.render == "function") {
              var callback = dojo.hitch(channel.view,channel.view.render);
              channel = connection.subscribe(channel.channelName, callback);
            } else {
              console.log("View object for channel %s does not have a render method",
                      channelName);
            }
          });

      }
    },

    connect : function(callerCallback) {
    	if(callerCallback !== null && callerCallback !== undefined){
	      dj.util.bluegrass.Runtime.openConnection( {to : this._cfg.toURL, via : this._cfg.viaURL }, callerCallback);
    	} else {
    		var channelObject = {channelList: this.channels};
    	    var callback = dojo.hitch(channelObject, this.connectCallback);
    	    dj.util.bluegrass.Runtime.openConnection( {to : this._cfg.toURL, via : this._cfg.viaURL }, callback);
    	}
    }

  });
dojo.provide("dj.widget.livenews.view.liveUpdateView");
dojo.require("dj.widget.livenews.view.baseLiveUpdateView");
dojo.require("dj.util.Region");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");

dojo
    .declare(
        "dj.widget.livenews.view.liveUpdateView",
        dj.widget.livenews.view.baseLiveUpdateView,
        {

          constructor : function(cfg) {
            this.DEFAULT_CONFIG = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
          },

          render : function(response, initialLoad) {
            var that = this;
            if (response !== undefined && response !== null) {
              if (response.length !== undefined) {
                // that.DEFAULT_CONFIG.nohCount = response.length -
                // that.DEFAULT_CONFIG.nosCount;
                var noOfElements = response.length;
                console.log(response.length);
                for ( var i = response.length - 1; i > -1; i--) {
                  that.populateData(response[i], initialLoad);
                }
              } else {
                that.populateData(response);
              }
            }
          },

          populateData : function(data, initialLoad) {

        	if ( (initialLoad === null || initialLoad === undefined || initialLoad !== "initialLoad") &&
        		  (data.b.y === null || data.b.y === undefined || data.b.y !== "normal") ){
			  return;
		    }

            var that = this;
            var channelName = data.h.t;
            var checkDuplicate = null;
            var outerId = "";

            var publishDate = "";
            var today = new Date();
            var innerEle;
            var deltaClass = "deltaType-noChange";
            var outerEle = null;
            var region = dj.util.Region.getViewByRegion();

            if (channelName !== null && channelName !== undefined) {
              for ( var ch = 0; ch < that.DEFAULT_CONFIG.multiArray.length; ch++) {
                if (channelName === that.DEFAULT_CONFIG.multiArray[ch][0]) {
                  outerEle = dojo.query(that.DEFAULT_CONFIG.multiArray[ch][1])[0];
                  outerId = that.DEFAULT_CONFIG.multiArray[ch][1];
                  break;
                }
              }
            }
            var articleFlag = false;
            var blogFlag = false;
            var tpu = '';

            try {
              if (data.b.tpu !== undefined && data.b.tpu !== null) {
                tpu = data.b.tpu;
              }
              if (tpu !== null && tpu !== '' && tpu.indexOf('http') === 0 && tpu.indexOf('blog') != -1) {
                blogFlag = true;
              }
            } catch (e) {
              console.error("Error while reteriving tpu: " + e);
            }

            if (data.b.ei !== null && data.b.ei !== '') {
              articleFlag = true;
            }

            if (outerEle !== null && outerEle !== undefined
                && (blogFlag === true || articleFlag === true)) {
              var sbNum = data.b.ei;
              sbNum = sbNum.substring(0, sbNum.indexOf("."));

              var liEle = document.createElement('li');
              liEle.setAttribute('id', outerId + "_liveArticle_" + sbNum);
              // liEle.setAttribute('class', 'firstList');
              dojo.addClass(liEle, "firstList");

              var h5Ele = document.createElement('h5');
              // h5Ele.setAttribute('class', 'timestamp');
              dojo.addClass(h5Ele, "timestamp");

              liEle.appendChild(h5Ele);

              var aEle = document.createElement('a');
              aEle.setAttribute('href', '#');
              liEle.appendChild(aEle);

              var h2Ele = document.createElement('h2');

              var a2Ele = document.createElement('a');
              a2Ele.appendChild(document.createTextNode(data.b.h));
              h2Ele.appendChild(a2Ele);
              liEle.appendChild(h2Ele);

              var pEle = document.createElement('p');

              var summary = data.b.a;
              if (summary.length > 250) {
                summary = summary.substring(0, 250);
                var limit = summary.lastIndexOf(" ");
                summary = summary.substring(0, limit) + "...";
              }

              // if (that.DEFAULT_CONFIG.nohCount <= 0) {
              pEle.appendChild(document.createTextNode(summary));
              // }
              // that.DEFAULT_CONFIG.nohCount = that.DEFAULT_CONFIG.nohCount -1;

              liEle.appendChild(pEle);

              /**
               * Start of Org pub date logic.
               */
              var blogDate = data.b.z;
              var printDate = true;
              if (blogDate !== undefined && blogDate !== null) {
                var blogIndex = blogDate.indexOf("(");
                blogDate = blogDate.substring(blogIndex + 1,
                    blogDate.length - 2);
                blogDate = parseInt(blogDate);
                publishDate = new Date(blogDate);
              } else {
                console.error("Blogs org-pub-date is null.");
                printDate = false;
              }

              var dateVal = "";
              var lPublishDate = "";

              try {
                if (printDate) {
                  dateVal = dojo.date.locale.format(publishDate, {
                    selector : "time",
                    timePattern : "h:mm a"
                  });

                  if (dateVal !== "") {

                    for ( var dateCount = 0; dateCount < that.DEFAULT_CONFIG.latestDateArray.length; dateCount++) {
                      if (outerId === that.DEFAULT_CONFIG.latestDateArray[dateCount][0]) {
                        var tempDate = that.DEFAULT_CONFIG.latestDateArray[dateCount][1];
                        if (tempDate === "" || tempDate === undefined || tempDate === null) {
                          that.DEFAULT_CONFIG.latestDateArray[dateCount][1] = publishDate;
                        } else if (tempDate.getTime() < publishDate.getTime()) {
                          that.DEFAULT_CONFIG.latestDateArray[dateCount][1] = publishDate;
                        }
                        break;
                      }
                    }

                    if (today.getDate() != publishDate.getDate()) {
                      dateVal = dojo.date.locale.format(publishDate, {
                        selector : "date",
                        datePattern : "MMM. dd, yyyy"
                      });
                    }
                    h5Ele.appendChild(document.createTextNode(dateVal));
                  }
                }

              } catch (e) {
                console.log("Error while calculating org pub date." + e);
              }
              /**
               * End of org pub date logic.
               */

              var channelsArr = [];
              if (blogFlag === true) {
                a2Ele.setAttribute('href', tpu + '?mod='
                    + that.DEFAULT_CONFIG.modMarkets);
              } else {
                a2Ele.setAttribute('href', dj.context.core.urlPrefix
                    + '/article/' + sbNum + '.html?mod='
                    + that.DEFAULT_CONFIG.modMarkets);
              }

              var blogUpdate = false;
              checkDuplicate = dojo.byId(outerId + "_liveArticle_" + sbNum);
              if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                blogUpdate = true;
              } else if (initialLoad !== null && initialLoad !== undefined
                  && initialLoad === "initialLoad") {
                if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                  outerEle
                      .removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                }

                if (outerEle.children.length == 0) {
                  outerEle.appendChild(liEle);
                } else {
                  outerEle.insertBefore(liEle, outerEle.children[0]);
                  // outerEle.children[1].removeAttribute('class', 'firstList');
                  dojo.removeClass(outerEle.children[1], "firstList");
                }
              }

              if (blogFlag === true) {

                try {

                  if (dateVal != null && dateVal !== undefined) {
                    var today = new Date();

                    if (initialLoad === null || initialLoad === undefined) {

                      if (outerEle.children.length == 0) {
                        outerEle.appendChild(liEle);
                      } else {
                        for ( var dateCount = 0; dateCount < that.DEFAULT_CONFIG.latestDateArray.length; dateCount++) {
                          if (outerId === that.DEFAULT_CONFIG.latestDateArray[dateCount][0]) {
                            lPublishDate = that.DEFAULT_CONFIG.latestDateArray[dateCount][1];
                            break;
                          }
                        }

                        checkDuplicate = dojo.byId(outerId + "_liveArticle_"
                            + sbNum);
                        if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                          blogUpdate = true;
                        } else if ((lPublishDate == null || lPublishDate == "")
                            || (lPublishDate.getTime() <= publishDate.getTime())) {
                          if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                            outerEle
                                .removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                          }

                          if (outerEle.children.length == 0) {
                            outerEle.appendChild(liEle);
                          } else {
                            outerEle.insertBefore(liEle, outerEle.children[0]);
                            // outerEle.children[1].removeAttribute('class',
                            // 'firstList');
                            dojo.removeClass(outerEle.children[1], "firstList");
                          }
                        } else {
                          console.log("Old blog");
                        }

                      }
                    }

                  }
                } catch (dateErr) {
                  console.log("Date Parsing Error: " + dateErr);
                }

                if (blogUpdate === true) {
                  try {
                    checkDuplicate.innerHTML = liEle.innerHTML;
                    if (outerEle.children[1] != null
                        && outerEle.children[1] != undefined) {
                      // outerEle.children[1].removeAttribute('class',
                      // 'firstList');
                      dojo.removeClass(outerEle.children[1], "firstList");
                    }
                  } catch (err) {
                    console.log("Error while updating edited blog : " + err);
                  }
                }

                return;

              }// End blog's Ajax call.

              try {
                dojo
                    .xhrGet( {
                      url : '/public/page/NA_WSJ_PUB:0_0_WG_Live_Market_News-'
                          + sbNum + '.html',
                      preventCache : true,
                      load : function(data, xhr) {
                        data = data.replace('<div class="fullwide">', '');
                        data = data.replace('</div>', '');

                        var start = data.indexOf("<!--");
                        while (start > 0) {
                          var stringObj = data;
                          var end = data.indexOf("-->");
                          data = data.substring(0, start);
                          stringObj = stringObj.substring(end + 3);
                          data = data + stringObj;
                          start = data.indexOf("<!--");
                        }// While

                        var jsonObj = null;
                        try {
                          jsonObj = dojo.fromJson(data);
                        } catch (jsonExp) {
                          console.log("{liveUpdateView }error parsing JSON: "
                              + jsonExp);
                          jsonObj = null;
                          return;
                        }

                        if (jsonObj !== null
                            && jsonObj.Summary.article !== 'notFound') {

                          var ulEle2 = document.createElement('ul');
                          // ulEle2.setAttribute('class', 'marketTickerSymbol');
                          dojo.addClass(ulEle2, "marketTickerSymbol");

                          try {

                            if ((initialLoad === null || initialLoad === undefined)
                                && (null === checkDuplicate || typeof checkDuplicate === 'undefined')) {

                              if (outerEle.children.length == 0) {
                                outerEle.appendChild(liEle);
                              } else {
                                for ( var dateCount = 0; dateCount < that.DEFAULT_CONFIG.latestDateArray.length; dateCount++) {
                                  if (outerId === that.DEFAULT_CONFIG.latestDateArray[dateCount][0]) {
                                    lPublishDate = that.DEFAULT_CONFIG.latestDateArray[dateCount][1];
                                    break;
                                  }
                                }

                                checkDuplicate = dojo.byId(outerId
                                    + "_liveArticle_" + sbNum);
                                if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                                  try {
                                    checkDuplicate.innerHTML = liEle.innerHTML;
                                    if (outerEle.children[1] != null
                                        && outerEle.children[1] != undefined) {
                                      // outerEle.children[1].removeAttribute('class',
                                      // 'firstList');
                                      dojo.removeClass(outerEle.children[1],
                                          "firstList");
                                    }
                                  } catch (err) {
                                    console
                                        .log("Error while updating edited story in inner block: "
                                            + err);
                                  }
                                } else if ((lPublishDate == null || lPublishDate == "")
                                    || (lPublishDate.getTime() <= publishDate
                                        .getTime())) {
                                  if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                                    outerEle
                                        .removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                                  }

                                  if (outerEle.children.length == 0) {
                                    outerEle.appendChild(liEle);
                                  } else {
                                    outerEle.insertBefore(liEle,
                                        outerEle.children[0]);
                                    // outerEle.children[1].removeAttribute('class',
                                    // 'firstList');
                                    dojo.removeClass(outerEle.children[1],
                                        "firstList");
                                    /**** remove 20th element *******/
                                    try {
                                    	dojo.destroy(outerEle.children[20])
                                    }
                                    catch (err){
                                    	console.log("List has less than 20 elements");
                                    }
                                    /***** end****/
                                  }
                                } else {
                                  console.log("Old article");
                                  return;
                                }

                              }
                            }

                          } catch (err) {
                            console.log("Error Parsing jsonObj: " + err);
                          }

                          if (jsonObj.Summary.image != undefined
                              && jsonObj.Summary.image != "") {

                            var wrapperDiv = document.createElement('div');
                            if(that.DEFAULT_CONFIG.wrapperImgClass != null && that.DEFAULT_CONFIG.wrapperImgClass != undefined) {
                            	wrapperDiv.setAttribute('class', that.DEFAULT_CONFIG.wrapperImgClass);
                            } else {
                            	wrapperDiv.setAttribute('class', 'newsImage newsImage-A');
                            }

                            var imgEle = document.createElement('img');
                            imgEle.setAttribute('alt', 'image');
                            imgEle.setAttribute('src',
                                'http://si.wsj.net/public/resources/images/'
                                    + jsonObj.Summary.image);
                            aEle.setAttribute('href', dj.context.core.urlPrefix
                                + '/article/' + sbNum + '.html?mod='
                                + that.DEFAULT_CONFIG.modMarkets);

                            wrapperDiv.appendChild(imgEle);
                            aEle.appendChild(wrapperDiv);

                          }

                          for ( var count = 0; count < jsonObj.Summary.tickers.length; count++) {
                            if (jsonObj.Summary.tickers[count].name != undefined) {
                              var liEle2 = document.createElement('li');
                              liEle2.setAttribute('id', 'live_market_stocks');
                              // liEle2.setAttribute('class',
                              // 'bluegrass_channel');
                              dojo.addClass(liEle2, "bluegrass_channel");
                              liEle2.setAttribute('data-bluegrass-channel',
                                  jsonObj.Summary.tickers[count].bgChannel);
                              channelsArr
                                  .push(jsonObj.Summary.tickers[count].bgChannel);

                              var spanEle = document.createElement('span');
                              // spanEle.setAttribute('class', 'info_sym');
                              dojo.addClass(spanEle, "info_sym");
                              var spanEle2 = document.createElement('span');
                              // spanEle2.setAttribute('class', 'info_sym_com');
                              dojo.addClass(spanEle2, "info_sym_com");

                              var aTic = document.createElement('a');
                              var tickerSymbol = jsonObj.Summary.tickers[count].name;
                              var countryCode = jsonObj.Summary.tickers[count].company;
                              if (countryCode !== undefined
                                  && countryCode !== "") {
                                tickerSymbol = countryCode + "/" + tickerSymbol;
                              }
                              aTic.setAttribute('href',
                                  dj.context.core.urlPrefix
                                      + '/public/quotes/main.html?symbol='
                                      + tickerSymbol);
                              spanEle2.appendChild(aTic);

                              var spanEle3 = document.createElement('span');
                              // spanEle3.setAttribute('class',
                              // 'info_sym_exchange');
                              dojo.addClass(spanEle3, "info_sym_exchange");

                              var aTictext = document
                                  .createTextNode(jsonObj.Summary.tickers[count].name);
                              aTic.appendChild(aTictext);
                              var spantext2 = document.createTextNode(' ('
                                  + jsonObj.Summary.tickers[count].exchange
                                  + ')');
                              spanEle3.appendChild(spantext2);

                              spanEle.appendChild(spanEle2);
                              spanEle.appendChild(spanEle3);

                              var spanEle4 = document.createElement('span');
                              // spanEle4.setAttribute('class',
                              // 'info_valueContainer');
                              dojo.addClass(spanEle4, "info_valueContainer");

                              var spanEle5 = document.createElement('span');
                              // spanEle5.setAttribute('class', 'info_price');
                              dojo.addClass(spanEle5, "info_price");
                              var supEle = document.createElement('sup');
                              // supEle.setAttribute('class', 'cursym');
                              dojo.addClass(supEle, "cursym");
                              var currency = null;
                              try {
                                currency = jsonObj.Summary.tickers[count].iso;
                                if (currency === undefined || currency === null
                                    || currency === "") {
                                  currency = '$';
                                }
                              } catch (currErr) {
                                currency = '$';
                                console.log("Couldn't find the currency");
                              }
                              /*
                               * var cursymtext = document.createTextNode("
                               * "+currency); supEle.appendChild(cursymtext);
                               */
                              supEle.innerHTML = " " + currency;
                              spanEle5.appendChild(supEle);

                              var spanEle6 = document.createElement('span');
                              // spanEle6.setAttribute('class', 'int');
                              dojo.addClass(spanEle6, "int");
                              var spantext6 = document
                                  .createTextNode(jsonObj.Summary.tickers[count].price
                                      + ' ');
                              spanEle6.appendChild(spantext6);
                              spanEle5.appendChild(spanEle6);
                              spanEle4.appendChild(spanEle5);

                              var spanEle7 = document.createElement('span');
                              var netChange = jsonObj.Summary.tickers[count].netChange;
                              var deltaClass = 'deltaType-positive';
                              var sign = '+';
                              if (netChange < 0) {
                                deltaClass = 'deltaType-negative';
                                sign = '';
                              }
                              // spanEle7.setAttribute('class', 'marketDelta
                              // '+deltaClass);
                              dojo.addClass(spanEle7, 'marketDelta '
                                  + deltaClass);
                              var spanEle7text = document.createTextNode(sign + netChange + ' (' + sign + jsonObj.Summary.tickers[count].changePercent + '%) ');
                              spanEle7.appendChild(spanEle7text);
                              spanEle4.appendChild(spanEle7);

                              liEle2.appendChild(spanEle);
                              liEle2.appendChild(spanEle4);

                              ulEle2.appendChild(liEle2);
                            }
                          }

                          liEle.appendChild(ulEle2);

                          if (!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
                            try {
                              checkDuplicate.innerHTML = liEle.innerHTML;
                              if (outerEle.children[1] != null
                                  && outerEle.children[1] != undefined) {
                                // outerEle.children[1].removeAttribute('class',
                                // 'firstList');
                                dojo.removeClass(outerEle.children[1],
                                    "firstList");
                              }
                            } catch (err) {
                              console
                                  .log("Error while updating rest of edited story: "
                                      + err);
                            }
                          }

                        } // jsonObj If
                        else {
                          console.error('Article not found: ' + sbNum);
                          return;
                        }
                        that.DEFAULT_CONFIG.context
                            .bluegrassSubscribeChannel(channelsArr);
                      }

                    });

              } catch (error) {
                console.log("Error: " + error);
              }
            }// If Tag

          }

        });
dojo.provide("dj.widget.livenews.view.liveUpdateChartsView");
dojo.require("dj.widget.livenews.view.baseLiveUpdateView");
dojo.require("dj.util.Region");
dojo.require("dj.module.marketdata.chart");
dojo.require("dj.util.excanvas");
dojo.require("dojo.date");
dojo.require("dojo.date.locale");

dojo.declare("dj.widget.livenews.view.liveUpdateChartsView", dj.widget.livenews.view.baseLiveUpdateView,
{
  constructor : function(cfg) {
    this.DEFAULT_CONFIG = dj.lang.cloneMixin(this.DEFAULT_CONFIG, cfg);
    this.SmartQuotesChartStyle = {
        background : "#ffffff",
        border : "#C4C4C4",
        closelineStyle : "rgba(196,196,196,0.5)",
        horizontalGridLineStyle : "rgba(196,196,196,0.5)",
        highIndicatorStyle : "rgba(196,196,196,0.5)",
        highlowLineStyle : "rgba(196,196,196,0.5)",
        lowIndicatorStyle : "rgba(196,196,196,0.5)",
        mainLineStyle : "#4B4B4B",
        mainPriceLineFill : "#FFFFFF",
        mainPriceLineWidth : 2,
        yAxisLabelPadding : -174,
        maxPriceLines : 4,
        verticalGridLineStyle : "rgba(196,196,196,0.5)",
        verticalGridLineStyle_Opaque : "rgba(196,196,196,1.0)",
        vPadding : 12,
        YAxisLabelStyle : 1, //High Low Price Close = 1
        YAxisLabelHeight : 12,
        showDecimals : 1,
        regionStyles : {
          0 : '#cde2e0', // Premarket
          1 : '#cde2e0', //Postmarket
          2 : 'rgba(51,51,51,0.06)'//Intersession
        },
        comparelineStyles : {
          0 : '#cc3333', //Strong red:
          1 : '#3b8dad', //Strong blue:
          2 : '#c9932e', //Strong yellow
          3 : '#b78383', //Weak red:
          4 : '#8eb3bc', //Weak blue:
          5 : '#dbb782' //Weak yellow:
        }
      };
    if(dojo.isIE) {
      if (!document.namespaces.g_vml_) {
        document.namespaces.add('g_vml_', 'urn:schemas-microsoft-com:vml',
                   '#default#VML');
      }
      if (!document.namespaces.g_o_) {
        document.namespaces.add('g_o_', 'urn:schemas-microsoft-com:office:office',
                   '#default#VML');
      }
    }
  },

  render : function(response, pos) {
    if (response !== undefined && response !== null) {
      if (response.length !== undefined) {
    	  console.log(response.length);
    	  for(var i = response.length-1; i > -1; i--) {
          var position = 0;
          if(pos !== undefined && pos[i] !== undefined) {
        	  position = pos[i];
          }
          this.populateCharts(response[i], position );
        }
      } else {
        this.populateCharts(response);
      }
    }
  },

  populateCharts : function(data, position) {
    var that = this;
    var pos = position;
    var content = null;
    var channelName = null;
    var action = null;
    var item = null;
    var checkDuplicate = null;

    if(pos !== undefined && pos !== null){
    	content = data.a;
        channelName = that.DEFAULT_CONFIG.chartMultiArray[0][0];
        action = 1;
        item = data.a.ID;
    }else {
    	content = data.b.r.a;
        channelName = data.h.t;
        action = (data.b.r.o) ? data.b.r.o : 1;
        item = (data.b.r.p) ? data.b.r.p : 0;
    }

    var chartTimeDelay = 1800000;
    try{
    	chartTimeDelay = that.DEFAULT_CONFIG.chartTimeDelay;
    } catch(e) {
    	console.error("chartTimeDelay is undefined" + e);
    }

    if (null === content || typeof content === 'undefined') {
      console.error("{liveUpdateChartsView} - Error receiving data from Bluegrass[Blogs]");
      return;
    }

    try {
      if(typeof content != 'object') {
        content = dojo.fromJson(content);
      }
    } catch (e) {
      console.error("{liveUpdateChartsView} - Error parsing jsonObject : " + content);
    }
    var itemID = (item === 0) ? content.ID : item;
    itemID = "liveChart_" + itemID;

    var ticker = content.postmeta.article_quote;
    var tickerCountry = "";
    var tickerArray = null;
    try {
	    tickerArray = ticker.split(':');
	    if(tickerArray.length > 1) {
	      tickerCountry = tickerArray[0];
	      ticker = tickerArray[1];
	      ticker = ticker.toUpperCase();
	      tickerCountry = tickerCountry.toUpperCase();
	    } else {
	    	ticker = ticker.toUpperCase();
	    }

    } catch(exp){
    	ticker = ticker.toUpperCase();
    	console.log("Error while parsing ticker" + exp);
    }

    var deltaClass = "deltaType-noChange";
    var outerEle = null;
    var selectedId = null;

    for ( var ch = 0; ch < that.DEFAULT_CONFIG.chartMultiArray.length; ch++) {
      if (channelName === that.DEFAULT_CONFIG.chartMultiArray[ch][0]) {
        outerEle = dojo.query(that.DEFAULT_CONFIG.chartMultiArray[ch][1])[0];
        break;
      }
    }

    if (action == that.actions.DELETE) {
		try{
	      dojo.destroy(itemID);
	      if (outerEle !== null && outerEle !== undefined) {
		      var nextItem = outerEle.children[0];
		      if(nextItem !== null && nextItem !== undefined){
		      	dojo.addClass(nextItem, "firstList");
		      }
	      }
		}catch(err){
			console.log("Error while deleting: "+err);
		}
		return;
    }

    if (action == that.actions.INSERT) {
		try{
		  checkDuplicate =  dojo.byId(itemID);
		  if(!(null === checkDuplicate || typeof checkDuplicate === 'undefined')) {
			  return;
		  }
		}catch(err){
			console.log("Error while checking Duplicate blogs: "+err);
		}
    }

    if (outerEle !== null && outerEle !== undefined) {
      var main = "";
      try {
        dojo.xhrGet({
          url : '/public/page/NA_WSJ_PUB:0_0_WG_Live_Charts-' + ticker + '-'+tickerCountry+ '.html',
          preventCache: true,
          load : function(loadData, xhr){

            var region = dj.util.Region.getViewByRegion();
            var start = loadData.indexOf("<!--");
            while (start > 0) {
              var stringObj = loadData;
              var end = loadData.indexOf("-->");
              loadData = loadData.substring(0, start);
              stringObj = stringObj.substring(end + 3);
              loadData = loadData + stringObj;
              start = loadData.indexOf("<!--");
            }// While

            var indexVal = loadData.indexOf('BGInfo');
            var channelsArr = [];
            var articleData = "";

            if(indexVal > 0)
            {
            	channelsArr.push(loadData.substring(0, indexVal));
            	articleData = loadData.substring(indexVal + 6);
            } else {
            	articleData = loadData.trim();
            }

            var dateVal = "";
        	 if(typeof content.post_date_gmt != 'undefined') {
        		 try{
        			 var pubDate = content.post_date_gmt;
        			 var displayDate = new Date();
        			 var fullDateParts = pubDate.split("+");
        			 if(fullDateParts.length == 2) {
        			   var dateParts = fullDateParts[0].split("-");
        			   var timeParts = fullDateParts[1].split(":");
        			   if(dateParts.length == 3 && timeParts.length == 3) {
        			     var utcDate = Date.UTC(dateParts[0],parseInt(dateParts[1])-1,dateParts[2],timeParts[0],timeParts[1],timeParts[2]);
        			     displayDate = new Date(utcDate);
        			   }
        			 }

	        		 dateVal = dojo.date.locale.format(displayDate, {selector:"time", timePattern:"h:mm a"});

	        		 if(dateVal != null && dateVal !== "") {
	        		    var today = new Date();
	        		    var todayTime = today.getTime();
	        		    var displayTime = displayDate.getTime();
	     		        if(todayTime - displayTime  > chartTimeDelay){
	     		        	 return;
	     		        }
	        		 }
        		 }catch(dateErr){
        			 console.log("Date Parsing Error: "+dateErr);
        		 }
           }

            var main = '<h5 class="timestamp">' + dateVal + '</h5><h2>'
                + content.post_title.replace(/\+/g, " ")
                + '</h2><p>'
                + content.post_content.replace(/\+/g, " ") + '</p>';
            if (articleData !== null) {
              var chartContainer = "liveUpdateChart_" + ticker;
              articleData = main + '<div class="marketCharts">' + articleData;
              articleData += "<div class='chart_overview' id='"+ chartContainer +"'></div>";

              if(pos != null && pos != undefined)
        	  {
            	  if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                      outerEle.removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                   }

            	  var newClass = 'superDeco';
            	  if(pos == 0) {
            		  newClass = 'superDeco firstList';
            	  }
            	  var newItem = dojo.create("li", {
                      "class" : newClass,
                      "id" : itemID,
                      innerHTML : articleData
                    });

            	   if(dojo.isIE && pos > 0) {
            		   pos = pos -1;
            	   }
                   dojo.place(newItem, outerEle, pos);

                   if(pos == 0) {
	                   var nextItem = newItem.parentNode.children[1];
	                    if(nextItem !== null && nextItem !== undefined){
	                    	dojo.removeClass(nextItem, "firstList");
	                   }
                   }
        	  } else if ( action == that.actions.INSERT) {

    		    checkDuplicate =  dojo.byId(itemID);
    		    if(null === checkDuplicate || typeof checkDuplicate === 'undefined') {
    		    	console.log("inserting...");
	                if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
	                  outerEle.removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
	                }

	                var newItem = dojo.create("li", {
	                  "class" : "superDeco firstList",
	                  "id" : itemID,
	                  innerHTML : articleData
	                }, outerEle, "first");

	                var nextItem = newItem.parentNode.children[1];
	                if(nextItem !== null && nextItem !== undefined){
	                	dojo.removeClass(nextItem, "firstList");
	                }
    		    }

              } else if (action == that.actions.UPDATE) {
                var updatedPost = dojo.byId(itemID);
                if (null !== updatedPost
                    && typeof updatedPost !== 'undefined') {
                  updatedPost.innerHTML = articleData;
                } else {
                  if (outerEle.children.length == that.DEFAULT_CONFIG.updateCount) {
                    outerEle.removeChild(outerEle.children[that.DEFAULT_CONFIG.updateCount - 1]);
                  }

                  var newItem = dojo.create("li", {
                    "class" : "superDeco firstList",
                    "id" : itemID,
                    innerHTML : articleData
                  }, outerEle, "first");

                  var nextItem = newItem.parentNode.children[1];
                  if(nextItem !== null && nextItem !== undefined){
                  	dojo.removeClass(nextItem, "firstList");
                  }
                }
              }

              if(channelsArr.length > 0) {
                that.DEFAULT_CONFIG.context.bluegrassSubscribeChannel(channelsArr);
              }
            } else {
              console.error('Article not found: ' + sbNum);
            }

            //Rendering chart
            that.renderChart(chartContainer, tickerCountry, ticker, that.SmartQuotesChartStyle);
          },

          error : function(error, ioArgs) {
            console.log("error while reteriving ticker info: " + error);
          }
        });
      } catch (error) {
        console.log("Error: " + error);
      }

    }

  },

  renderChart: function(chartContainer, tickerCountry, ticker, smartQuotesChartStyle) {
	var that = this;
	var tickerCountry = tickerCountry;
	var ticker = ticker;
	var smartQuotesChartStyle = smartQuotesChartStyle;

    try {
      dojo.xhrPost({
        url : '/thunderball/HistoricChartData.aspx',
        handleAs : 'json',
        load : function(response, xhr){
          var chartData = response;

          var stockchartChart = new EmbeddedChart(chartContainer, smartQuotesChartStyle,
              176, 51,"5dy", "5mi", null, null, chartData, tickerCountry+":"+ticker, '');

          var chartExists = stockchartChart.ShowChart();
        },
        content : {
          Symbol : tickerCountry + ":" + ticker,
          Width : 176,
          freq : "5mi",
          time : "5dy"
        },
        error : function(error, ioArgs) {
          console.error("Error on loading charts");
          console.log(error);
          console.log(ioArgs);
        }
      });
    } catch(e) {
      console.error("{liveUpdateChartsView - Error loading chart.");
    }
  }

});
dojo.provide("dj.module.liveupdate.liveUpdates");
dojo.require("dj.module.stockinnews.mrktProvider");
dojo.require("dj.widget.livenews.view.liveUpdateView");
dojo.require("dj.widget.livenews.view.liveUpdateChartsView");
dojo.require("dj.widget.livenews.view.mrktView");
dojo.require("dj.util.bluegrass");

dj.module.liveupdate.liveUpdates = {
	liveUpdateView : null,
	liveUpdateChartsView : null,
	marketView : null,
	multiArray : null,
	latestDateArray : null,
	chartMultiArray : null,
	channels: [],
	chartChannels: [],
	feedURL: [],
	blogsFeedURL:'',
	subscribedList: [],
	updateCount: 10,
//	nohCount: 0,
//	nosCount: 10,
	chartPosition: [1,4],
	calledFlag: false,
	channelJSON: {},
	modMarkets: 'WSJ_markets_liveupdate',
	chartTimeDelay: 1800000,

	init: function (_scope){
		var that = this;

		var channelCount = _scope.channelJSON.length;
		var chartChannelCount = _scope.chartContainerArr.length;

		that.channelJSON = _scope.channelJSON;
		that.chartChannels = _scope.chartChannelArr;
		that.feedURL.push(that.channelJSON[0].blogsFeedURL);

		that.multiArray=new Array(channelCount);
		that.latestDateArray=new Array(channelCount);
		for (var i=0; i < channelCount ; i++) {
			that.multiArray[i]=new Array(2);
			that.latestDateArray[i]=new Array(2);
			that.channels.push(that.channelJSON[i].channelName);
			that.multiArray [i][0] = that.channelJSON[i].channelName;
			that.multiArray [i][1] = that.channelJSON[i].container;
			that.latestDateArray [i][0] = that.channelJSON[i].container;
			that.latestDateArray [i][1] = "";
		}

		that.chartMultiArray=new Array(chartChannelCount);
		for (var J=0; J < chartChannelCount ; J++) {
			that.chartMultiArray[J]=new Array(2);
			that.chartMultiArray [J][0] = that.chartChannels[J];
			that.chartMultiArray [J][1] = _scope.chartContainerArr[J];
		}

		if(_scope.updateCount !== undefined) {
			that.updateCount = _scope.updateCount;
		}

	    /*if(_scope.nohCount !== undefined) {
	      that.nohCount = _scope.nohCount;
	    }

	    if(_scope.nosCount !== undefined) {
	      that.nosCount = _scope.nosCount;
	    }*/


		that.blogsFeedURL = _scope.blogsFeedURL;
		if(_scope.chartPosition !== undefined) {
			that.chartPosition = _scope.chartPosition;
		}

		if(_scope.modMarkets !== undefined) {
			that.modMarkets = _scope.modMarkets;
		}
		if(_scope.chartTimeDelay !== undefined) {
			that.chartTimeDelay = _scope.chartTimeDelay;
		}

		if(!dj.context.marketdata.bluegrassProvider){
			dj.context.marketdata.bluegrassProvider = new dj.module.stockinnews.mrktProvider({});
		}

		that.liveUpdateChartsView = new dj.widget.livenews.view.liveUpdateChartsView({chartMultiArray: that.chartMultiArray, updateCount : that.updateCount, chartTimeDelay: that.chartTimeDelay, context: that});

//		that.liveUpdateView = new dj.widget.livenews.view.liveUpdateView({multiArray: that.multiArray, updateCount : that.updateCount, nohCount : that.nohCount, nosCount : that.nosCount, context: that, modMarkets: that.modMarkets, latestDateArray: that.latestDateArray});
		that.liveUpdateView = new dj.widget.livenews.view.liveUpdateView({multiArray: that.multiArray, updateCount : that.updateCount, context: that, modMarkets: that.modMarkets, latestDateArray: that.latestDateArray});

		that.marketView = new dj.widget.livenews.view.mrktView({});

		var connection = dj.util.bluegrass.Runtime.getConnection();
	    if (connection === null || connection === undefined) {
	    	dj.context.marketdata.bluegrassProvider.connect();
	    }
		that.populateModules();

	},

	bluegrassSubscribeChannel: function(tickerChannels, viewComp){
		try{
			var that = this;
			var dynamicChannels = [];
			var channelView = null;

			if(viewComp !== null && viewComp !== undefined) {
				channelView = viewComp;
			} else {
				channelView = that.marketView;
			}

			dojo.forEach(tickerChannels, function(tChannel) {
				if(dojo.indexOf(that.subscribedList, tChannel)  === -1) {
					dynamicChannels.push({
				          channelName : tChannel,
				          view : channelView
			        });
					that.subscribedList.push(tChannel);
				}
			});

			if(dynamicChannels.length > 0) {
				dj.context.marketdata.bluegrassProvider.dynamicSubscribeChannel(dynamicChannels, channelView, tickerChannels);
			}

		}catch(e){
			console.log("Error: " + e);

		}
	},

	populateModules: function(feedINFO){
		var that = this;

		var feed_url = that.feedURL;
		if(feedINFO !== null && feedINFO !== undefined && feedINFO !== ""){
			feed_url = feedINFO;
		}
		dojo.forEach(feed_url, function(feedUrl) {
			dojo.xhrGet({
				 url: feedUrl,
				 handleAs: "json",
			     load: function(data, xhr){
					that.liveUpdateView.render(data, "initialLoad");
					if(that.calledFlag == false){
						that.calledFlag = true;
						that.populateBlogs();
					}
		     	 },
		     	 error: function(error, ioArgs) {
		     		if(that.calledFlag == false){
		     			that.calledFlag = true;
		     			that.populateBlogs();
		     		}
		             console.log(error);
		         }

			});

		});

	},

	populateBlogs: function(){
		var that = this;
			dojo.xhrGet({
				 url: that.blogsFeedURL,
				 handleAs: "text",
			     load: function(response, xhr){
					try{
						var cleanData = response.substring(response.indexOf("<return>") + 8);
				        cleanData = cleanData.substring(0, cleanData.indexOf("</return>"));
				        cleanData = cleanData.replace(/&lt;/g,"<");
				        cleanData = cleanData.replace(/&amp;#/g,"&#");
				        var blogsData = dojo.fromJson(cleanData);
						that.liveUpdateChartsView.render(blogsData, that.chartPosition);
					} catch(err) {
						console.log("populateBlogs: "+err);
					}
					that.bluegrassSubscribeChannel(that.channels, that.liveUpdateView);
					that.bluegrassSubscribeChannel(that.chartChannels, that.liveUpdateChartsView);
		     	 },
		     	 error: function(error, ioArgs) {
		             console.error("{populateBlogs}: "+error);
		             that.bluegrassSubscribeChannel(that.channels, that.liveUpdateView);
		     		 that.bluegrassSubscribeChannel(that.chartChannels, that.liveUpdateChartsView);
		         }

			});

	},

	populateInitialLoad: function(objId) {
		that = this;
		var feedurl = [];
		if(objId  !== null && objId  !== undefined) {
			for (var i=0; i < that.channelJSON.length ; i++) {
				if("#"+objId === that.channelJSON[i].container) {
					var container = dojo.query("#"+objId)[0];
					if(dojo.hasClass(container, 'notInitiallized'))
					{
						dojo.removeClass(container, "notInitiallized");
						feedurl.push(that.channelJSON[i].blogsFeedURL);
						that.populateModules(feedurl);
					}
					break;
				}
			}
		}
	 }

};

dojo.provide("dj.widget.entitlements.ClickTrack");dojo.declare("dj.widget.entitlements.ClickTrack",null,{constructor:function(cfg){this._cfg=dojo.mixin(this.DEFAULT_CONFIG,cfg);this._duc=dj.util.Cookie;},DEFAULT_CONFIG:{djCookieName:"DJCOOKIE",djSubCookieCountName:"GC",djSubCookieExpiryName:"GX",djCcookieGroupExpirationDays:90,referringDomain:["google.",".wsj.com/mobileConfig"],expirationInterval:"1d+",testReferrerMode:false},checkEntitlements:function(){var articleTrial=this.getTrialState();var articleFree=this.getFreeState();if(articleTrial&&!articleFree){if(this.isReferrerEntitled()||this._cfg.testReferrerMode){this.updateCountInformation();}}},getTrialState:function(){if(typeof isTrial=="undefined"){return false;}else{return isTrial===true||isTrial.toLowerCase()=="true";}},getFreeState:function(){if(typeof isReferrerArticleFree=="undefined"){if(typeof ArticleType=="undefined"){return true;}else{return ArticleType;}}else{return isReferrerArticleFree;}},updateCountInformation:function(){var expireCookieValue=this.getExpiryFromCookie();var now=new Date();if(expireCookieValue){var expireDate=new Date(expireCookieValue);if((expireDate-now)>0){this.updateCountCookie();}else{this.resetCountCookie();this.setExpiryCookie();}}else{this.resetCountCookie();this.setExpiryCookie();}},isReferrerEntitled:function(){if(this._cfg.testReferrerMode){return true;}
if(document.referrer){for(var ref=0;ref<this._cfg.referringDomain.length;ref++){if((document.referrer.indexOf(this._cfg.referringDomain[ref])>-1)){return true;}}}
return this._cfg.testReferrerMode;},getCountFromCookie:function(){var cookieCountValue=this._duc.getGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieCountName);if(typeof cookieCountValue=="undefined"){return 0;}else{try{return parseInt(cookieCountValue,10);}catch(e){return 0;}}},getExpiryFromCookie:function(){return this._duc.getGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieExpiryName);},updateCountCookie:function(){var count=1+this.getCountFromCookie();this._duc.setGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieCountName,count,this._cfg.djCcookieGroupExpirationDays);},resetCountCookie:function(){this._duc.setGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieCountName,1,this._cfg.djCcookieGroupExpirationDays);},setExpiryCookie:function(){var expiryDate=this._calcDate(this._cfg.expirationInterval);this._duc.setGroupCookie(this._cfg.djCookieName,this._cfg.djSubCookieExpiryName,expiryDate,this._cfg.djCcookieGroupExpirationDays);},_calcDate:function(D){var MS=this._calcMilliseconds(D),dO=new Date();dO.setTime((D.substring(D.length-1,D.length)=="+")?dO.getTime()+MS:dO.getTime()-MS);return dO.toGMTString();},_calcMilliseconds:function(D){var TD=D.substring(0,D.length-2),TC=D.substring(D.length-2,D.length-1).toLowerCase(),MS=0;MS=(TC=="m")?TD*((24*60*60*1000)*30):MS;MS=(TC=="d")?TD*(24*60*60*1000):MS;MS=(TC=="s")?TD*1000:MS;return MS;}});dojo.provide("dj.module.entitlements.googleClickTrack");dojo.require("dj.widget.entitlements.ClickTrack");dj.module.entitlements.googleClickTrack={init:function(cfg){this.widget=new dj.widget.entitlements.ClickTrack(cfg);this.widget.checkEntitlements();}};
dojo.provide("dj.module.mostPopular.newsReel")
dojo.require("dj.util.Region");dojo.require("dj.lang");dj.module.mostPopular.newsReel={init:function(args){this.defaultArgs={iframeDivId:"",iframeHeight:"103",mapping:{"na,us":"/public/page/NA_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html","asia":"/public/page/ASIA_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html","asia,india":"/public/page/ASIA_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html","europe":"/public/page/EUROPE_WSJ_PUB:0_0_WP_MostPopular_NewsReel.html"}};try{dj.lang.deepMixin(this.defaultArgs,args);if(typeof this.defaultArgs.iframeDivId!='undefined'&&this.defaultArgs.iframeDivId!=""){var module=dojo.byId(this.defaultArgs.iframeDivId);var moduleIsVisible=!((module.style.display=="none")||(module.style.display==""));if(moduleIsVisible){this.render(this.defaultArgs.iframeDivId);}}}catch(error){console.log(error);}},render:function(iframeDivId){var wsjRegion=dj.util.Region.getViewByRegion();var srcURL="";if(typeof this.defaultArgs.mapping[wsjRegion]!='undefined'){srcURL=this.defaultArgs.mapping[wsjRegion];}
if(srcURL!=""){var ele1=document.getElementById(iframeDivId);if(ele1){ele1.src=srcURL;ele1.height=this.defaultArgs.iframeHeight;}}}};
dojo.provide("dj.module.article.snippet");dj.module.article.snippet={copyAndMove:function(userConfiguration){this.configuration={articleParagraphSelector:"div.article p",articleAdSelector:"#snippet_big_ad",startHTML:"",endHTML:"<p></p>",articleParagraphThreshold:4,underThreshold:1,overThreshold:2,articleAdPosition:"after",timeout:1000,modValues:["WSJiPhone_article_snippet","WSJiPad_article_snippet"],adZone:"WSJ_iOS_Snippet"};dojo.mixin(this.configuration,userConfiguration);var modValue=dj.util.Page.getQueryParam("mod");var articleFree=false;var articleTrial=false;if(typeof isFree!='undefined'){articleFree=isFree;}
if(typeof isTrial!='undefined'){articleTrial=isTrial;}
if(dojo.indexOf(this.configuration.modValues,modValue)!=-1&&(articleFree=="true"||articleTrial=="true")){var that=this;try{setTimeout(function(){that.doMove();},this.configuration.timeout);}catch(e){console.error(e);}}},doMove:function(){var ad=dojo.query(this.configuration.articleAdSelector)[0];var paragraphs=dojo.query(this.configuration.articleParagraphSelector);var adPosition=(paragraphs.length<this.configuration.articleParagraphThreshold)?this.configuration.underThreshold:this.configuration.overThreshold;var adHTML=ad.innerHTML;var indexOfZone=adHTML.indexOf("interactive.wsj.com/")+20;var html=adHTML.substring(0,indexOfZone)+this.configuration.adZone+adHTML.substring(adHTML.indexOf(";"));dojo.place(this.configuration.startHTML+html+this.configuration.endHTML,paragraphs[adPosition],this.configuration.articleAdPosition);}};
dojo.provide("dj.module.subscribeBar");dojo.require("dj.util.User");dojo.require("dj.lang");dj.module.subscribeBar={init:function(userConfiguration){dojo.mixin(this.getConfiguration(),userConfiguration);this.subbarContainerObject=this.subbarContainerObject||dojo.byId(this.configuration.barId);this.subBarCloseObject=this.subBarCloseObject||dojo.byId(this.configuration.subBarCloseId);this.subBarToggleObject=this.subBarToggleObject||dojo.byId(this.configuration.subBarToggleId);if(this.shouldDisplay()){if(this.configuration.isMboxSession){this.addMboxSession();}
this.showBar();this.saveNewDisplayCount();this.addUiEvent();var me=this;if(this.configuration.autoClose){setTimeout(function(){me.closeBarWithAnimation();},me.configuration.autoCloseTime+me.configuration.animationDuration);}}},getConfiguration:function(){if(!this.configuration){this.configuration={userTypes:[],barId:"subscribeNowSmallBar",subBarCloseId:"subscribeNowMediumClose",subBarToggleId:"subscribeNowMediumToggle",subBarLinkClass:".js_subscribeNowMediumShopAndBuyLink",animationDuration:1200,useAnimation:true,animateClose:true,barOpenBottom:0,barCloseBottom:-32,barCloseSize:34,isMboxSession:false,closedStateClass:"state-closed",openStateClass:"state-open",sessionDisplayCount:1,cookieName:"subscribeNowSmallBarCookie",autoClose:false,autoCloseTime:8000};}
return this.configuration;},addUiEvent:function(){var me=this;if(this.subBarCloseObject){dojo.connect(this.subBarCloseObject,"click",null,function(ev){dojo.stopEvent(ev);me.closeBar();});}
if(this.subBarToggleObject){dojo.connect(this.subBarToggleObject,"click",null,function(ev){dojo.stopEvent(ev);me.toggleState();});}},addMbox:function(){console.log(this);if('undefined'!==typeof USER_TYPE){if(this.configuration.isArticlePage){mboxCreate(this.configuration.mboxLocation,"subscriberType="+USER_TYPE,"siteSection="+ARTICLE_SECTION,"articlePubDate="+PUB_DATE,"freeArticle="+FREE_ARTICLE,"articleType="+AT_VARS.articleType);}
else{mboxCreate(this.configuration.mboxLocation,"subscriberType="+USER_TYPE);}}
else{console.log("USER_TYPE is not defined, mbox for this location cannot be created:"+this.configuration.mboxLocation);}},addMboxSession:function(){var anchorNodes=dojo.query('a#'+this.configuration.subBarLinkClass);var sessionId=mboxFactoryDefault.getSessionId().getId();console.log("anchor nodes");console.log(anchorNodes);dojo.forEach(anchorNodes,function(anchorNode){var currentLink=dojo.attr(anchorNode,"href");if(currentLink){var parameterSeparator="?";if(currentLink.indexOf("?")>=0){parameterSeparator="&";}
var newLink=dojo.attr(anchorNode,"href")+parameterSeparator+"mboxSession="+sessionId;console.log(newLink);dojo.attr(anchorNode,"href",newLink);}});},showBar:function(){if(this.configuration.useAnimation){this.showBarWithAnimation();}
else{this.subbarContainerObject.style.bottom=this.configuration.barOpenBottom+'px';}},showBarWithAnimation:function(){this.setPreOpenState();var me=this;dojo.animateProperty({node:me.subbarContainerObject,duration:me.configuration.animationDuration,properties:{bottom:{end:0}}}).play();},closeBar:function(){if(this.configuration.useAnimation){this.closeBarWithAnimation();}
else{this.setClosedState();}},closeBarWithAnimation:function(){var me=this;dojo.animateProperty({node:me.subbarContainerObject,duration:me.configuration.animationDuration,properties:{bottom:{end:me.configuration.barCloseBottom+me.configuration.barCloseSize}}}).play();setTimeout(function(){me.setClosedState();},me.configuration.animationDuration);},setClosedState:function(){if(this.subbarContainerObject.style.bottom==((this.configuration.barCloseBottom+this.configuration.barCloseSize)+'px')){this.subbarContainerObject.style.bottom=this.configuration.barOpenBottom+'px';dojo.removeClass(this.subbarContainerObject,this.configuration.openStateClass);dojo.addClass(this.subbarContainerObject,this.configuration.closedStateClass);}
else{var me=this;setTimeout(function(){me.setClosedState();},10);}},setPreOpenState:function(){console.log(this.subbarContainerObject.style.bottom);if(this.subbarContainerObject.style.bottom!=(this.configuration.barCloseBottom+'px')){this.subbarContainerObject.style.bottom=(this.configuration.barCloseBottom+this.configuration.barCloseSize)+'px';}
dojo.removeClass(this.subbarContainerObject,this.configuration.closedStateClass);dojo.addClass(this.subbarContainerObject,this.configuration.openStateClass);},toggleState:function(){if(dojo.hasClass(this.subbarContainerObject,this.configuration.openStateClass)){this.closeBar();}
else{this.showBar();}},mboxInit:function(userConfiguration){dojo.mixin(this.getConfiguration(),userConfiguration);if(this.shouldDisplay()){if('function'!==typeof mboxCreate){console.log("loading mbox js");var d=dojo;d.require("dj.util.mbox");}
this.addMbox();}},shouldDisplay:function(){var displayBar=false;var displayForUser=false;var subscriptionTypeArray=dj.util.User.getSubscriptionType().results;console.log("Display for user types:"+this.configuration.userTypes.toString());console.log("User Subscription type:"+subscriptionTypeArray.toString());if(this.configuration.userTypes.length>0){for(var i=0;i<subscriptionTypeArray.length&&!displayForUser;i++){var subscriptionType=subscriptionTypeArray[i];if(subscriptionType){displayForUser=(dojo.indexOf(this.configuration.userTypes,subscriptionType.toUpperCase())>=0);}}}
else{displayForUser=true;}
displayBar=(displayForUser&&this.getNewDisplayCount()<=this.configuration.sessionDisplayCount);console.log("Display Bar:");console.log(displayBar);return displayBar;},saveNewDisplayCount:function(){document.cookie=this.configuration.cookieName+"="+this.getNewDisplayCount();},getNewDisplayCount:function(){if(!this.newDisplayCount){this.newDisplayCount=this.getCookie(this.configuration.cookieName);if(!this.newDisplayCount){this.newDisplayCount=1;}
else{this.newDisplayCount=parseInt(this.newDisplayCount,10)+1;}}
return this.newDisplayCount;},getCookie:function(Name){var search=Name+"=";var returnvalue="";if(document.cookie.length>0){offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.length;}
returnvalue=unescape(document.cookie.substring(offset,end));}}
return returnvalue;}};
dojo.provide("dj.util.referralFinance");dojo.require("dj.util.Page");dj.util.referralFinance={getReferrar:function(args){this.defaultArgs={enginesMapping:"",tickerMapping:""};try{dj.lang.deepMixin(this.defaultArgs,args);var referrar_local="";if(document.referrer!==undefined&&document.referrer!==null&&document.referrer!==""){referrar_local=document.referrer;}
else
{var fixedTicker=dj.util.Page.getQueryParam("fixedTicker");if(fixedTicker!==""){return{engine:"DUMMY",ticker:fixedTicker};}}
if(referrar_local!=='')
{var searchEnginePattern=this.defaultArgs.enginesMapping;var queryEngine=referrar_local.match(searchEnginePattern);var queryArr=referrar_local.match(this.defaultArgs.tickerMapping[queryEngine]);var ticker=queryArr[1];var qEndIndex=queryArr[1].indexOf('&',0);if(qEndIndex!=-1)
{ticker=queryArr[1].substring(0,qEndIndex);}
if(ticker!==undefined&&ticker!==null){return{engine:queryEngine,ticker:ticker};}else if(queryEngine!==null&&queryEngine!==undefined&&(ticker===null||ticker===undefined)){return{engine:queryEngine,ticker:""};}}
else
{return{engine:"DUMMY",ticker:""};}}catch(error){console.log("{referralFinance} "+error);}}};dojo.provide("dj.util.renderChart");dojo.require("dj.module.marketdata.chart");dojo.require("dj.util.excanvas");dojo.require("dj.lang");dojo.require("dj.util.Element");var _djl=dj.lang;dojo.declare("dj.util.renderChart",null,{constructor:function(){this.SmartQuotesChartStyle={background:"#ffffff",border:"#C4C4C4",closelineStyle:"rgba(196,196,196,0.5)",horizontalGridLineStyle:"rgba(196,196,196,0.5)",highIndicatorStyle:"rgba(196,196,196,0.5)",highlowLineStyle:"rgba(196,196,196,0.5)",lowIndicatorStyle:"rgba(196,196,196,0.5)",mainLineStyle:"#4B4B4B",mainPriceLineFill:"#FFFFFF",mainPriceLineWidth:2,yAxisLabelPadding:-218,maxPriceLines:4,verticalGridLineStyle:"rgba(196,196,196,0.5)",verticalGridLineStyle_Opaque:"rgba(196,196,196,1.0)",vPadding:14,YAxisLabelStyle:1,YAxisLabelHeight:12,showDecimals:1,regionStyles:{0:'#cde2e0',1:'#cde2e0',2:'rgba(51,51,51,0.06)'},comparelineStyles:{0:'#cc3333',1:'#3b8dad',2:'#c9932e',3:'#b78383',4:'#8eb3bc',5:'#dbb782'}};if(dojo.isIE){if(!document.namespaces.g_vml_){document.namespaces.add('g_vml_','urn:schemas-microsoft-com:vml','#default#VML');}
if(!document.namespaces.g_o_){document.namespaces.add('g_o_','urn:schemas-microsoft-com:office:office','#default#VML');}}},populateCharts:function(containerId,widthChart,heightChart){var that=this;var tickerCountry="US";var tickerObj=dojo.query("#tickerBasedModule");var tickerSymbol=dj.util.Element.getData(tickerObj[0],"ticker");var tickerArray=tickerSymbol.split(':');if(tickerArray.length>1){tickerCountry=tickerArray[0];tickerSymbol=tickerArray[1];}
else{tickerArray=tickerSymbol.split('/');if(tickerArray.length>1){tickerCountry=tickerArray[0];tickerSymbol=tickerArray[1];}}
tickerSymbol=tickerSymbol.toUpperCase();tickerCountry=tickerCountry.toUpperCase();try
{that.render(containerId,tickerCountry,tickerSymbol,that.SmartQuotesChartStyle,widthChart,heightChart);}
catch(error)
{console.log("{renderChart} error rendering the ticker-Chart");}},render:function(chartContainer,vTickerCountry,vTicker,vSmartQuotesChartStyle,width,height){var that=this;var containerId=chartContainer;var tickerCountry=vTickerCountry;var ticker=vTicker;var smartQuotesChartStyle=vSmartQuotesChartStyle;try{dojo.xhrPost({url:'/thunderball/HistoricChartData.aspx',handleAs:'json',load:function(response,xhr){var chartData=response;var stockchartChart=new EmbeddedChart(containerId,smartQuotesChartStyle,width,height,"5dy","5mi",null,null,chartData,tickerCountry+":"+ticker,'');var chartExists=stockchartChart.ShowChart();},content:{Symbol:tickerCountry+":"+ticker,Width:width,freq:"5mi",time:"5dy"},error:function(error,ioArgs){console.error("{renderChart} Error on loading charts");console.log(error);console.log(ioArgs);}});}catch(e){console.error("{renderChart} - Error loading chart.");}}});dojo.provide("dj.module.article.tickerBasedArticleModule");dojo.require("dj.util.referralFinance");dojo.require("dj.util.renderChart");dojo.require("dj.util.Element");dj.module.article.tickerBasedArticleModule={init:function(args){try{this.defaultArgs={targetId:"TestingVar",recipeAttributeName:"recipe",enginesMapping:"finance.yahoo|money.msn|marketwatch|barrons|smartmoney",tickerMapping:{"finance.yahoo":/.*s=(\w*)/i,"money.msn":/.*symbol=(\w*)/i,"marketwatch":/.*stock\/(\w*)/i,"barrons":/.*com\/(\w*)/i,"smartmoney":/.*quote\/(\w*)/i},moduleType:"",moduleClass:"",placeholderPositon:0,articleId:"",renderChart:false,chartDivId:"",moduleBasePrefix:"Module-",moduleChartPrefix:"Chart_Module-",moduleNoChartPrefix:"NoChart_Module-",moduleSearchBasedUrlPrefix:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_TickerSearch_",moduleFirstTickerUrlPrefix:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_TickerFirst_",moduleStocksInNewsFirstTickerUrlPrefix:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_StocksInNews_",moduleArticleTickersURL:"/public/page/NA_WSJ_PUB:0_0_WP_Articles_Tickers_Module-",renderNews:false,widthChart:219,tickerHiddenId:"ticker_value",heightChart:111};dojo.mixin(this.defaultArgs,args);var recipe=this.getRecipe().toLowerCase();if(recipe=='a'||recipe=='b'){if(recipe=='a'){this.defaultArgs.renderChart=true;}
else{this.defaultArgs.renderChart=false;}
this.post_init();}}catch(error){console.log("{tickerBasedArticleModule} "+error);}},post_init:function(args){try{var tickerChart=null;var referralArgs={enginesMapping:this.defaultArgs.enginesMapping,tickerMapping:this.defaultArgs.tickerMapping};if(typeof this.defaultArgs.moduleType!=='undefined'&&this.defaultArgs.moduleType!=="")
{var tickerHiddenDivId=dojo.byId(this.defaultArgs.tickerHiddenId);if(tickerHiddenDivId===undefined||tickerHiddenDivId===null){this.getTicker(referralArgs,this.defaultArgs.tickerHiddenId);}
var tickerObj=dojo.query("#"+this.defaultArgs.tickerHiddenId);var ticker=dj.util.Element.getData(tickerObj[0],"ticker");var searchEngine=dj.util.Element.getData(tickerObj[0],"engine");if(ticker!==''||searchEngine!=='')
{var result="";if(this.defaultArgs.renderNews===false)
{result=this.getInsetPlaceholder(this.defaultArgs.moduleType,this.defaultArgs.moduleClass,this.defaultArgs.placeholderPositon);}
else
{result="renderNews";}
if(result=="success"||result=="renderNews")
{if(this.defaultArgs.renderChart===true){tickerChartInstance=new dj.util.renderChart();}else{tickerChartInstance=null;}
var module=dojo.byId(this.defaultArgs.moduleType);var moduleIsVisible=!((dojo.hasClass(module,"hidden"))&&((module.style.display=="none")||(module.style.display==="")));if(moduleIsVisible)
{if(searchEngine!==''&&ticker===''){if(this.defaultArgs.renderNews===false)
{this.render(module,"",this.defaultArgs.articleId,this.defaultArgs.renderChart,tickerChartInstance,this.defaultArgs.chartDivId,this.defaultArgs.widthChart,this.defaultArgs.heightChart,this.defaultArgs.moduleFirstTickerUrlPrefix);}
else
{this.renderNews(module,"",this.defaultArgs.moduleFirstTickerUrl,this.defaultArgs.articleId);}
console.log("{tickerBasedArticleModule} Displayed the Ticker Based Module");}else if(searchEngine!==''){if(ticker&&ticker!==''){if(this.defaultArgs.renderNews===false)
{this.render(module,ticker,this.defaultArgs.articleId,this.defaultArgs.renderChart,tickerChartInstance,this.defaultArgs.chartDivId,this.defaultArgs.widthChart,this.defaultArgs.heightChart,this.defaultArgs.moduleSearchBasedUrlPrefix);}
else
{this.renderNews(module,ticker,this.defaultArgs.moduleSearchBasedUrlPrefix,this.defaultArgs.articleId);}}
else{this.render(module,"","",this.defaultArgs.renderChart,tickerChartInstance,this.defaultArgs.chartDivId,this.defaultArgs.widthChart,this.defaultArgs.heightChart,this.defaultArgs.moduleStocksInNewsFirstTickerUrlPrefix);}
console.log("{tickerBasedArticleModule} Displayed the Ticker Based Module");}}}}}}catch(error){console.log("{tickerBasedArticleModule} "+error);}},getRecipe:function(){try{this.targetObject=dojo.byId(this.defaultArgs.targetId);var recipe=dojo.attr(this.targetObject,this.defaultArgs.recipeAttributeName);return recipe;}catch(error){console.log("{tickerBasedArticleModule}Error in creating the placeholder for CR inset ");return"failure";}},getInsetPlaceholder:function(moduleType,moduleClass,position){try{dojo.create("div",{"id":moduleType,"class":moduleClass},dojo.query(".articlePage>p")[position],"after");void(0);return"success";}catch(error){console.log("{tickerBasedArticleModule}Error in creating the placeholder for CR inset ");return"failure";}},render:function(module,ticker,articleId,renderchart,tickerchartinstance,chartcontainer,widthChart,heightChart,URL){var urlChips='';var tickerSlashIndex=-1;var tickerDotIndex=-1;if(typeof ticker!=='undefined'&&ticker!==''){tickerSlashIndex=ticker.indexOf("/");if(tickerSlashIndex>-1){var tickerParts=ticker.split("/");var countryCode=tickerParts[0];var tickerSymbol=tickerParts[1];urlChips=urlChips+countryCode+"-"+tickerSymbol+"-"+articleId;}
else{tickerDotIndex=ticker.indexOf(".");if(tickerDotIndex>-1){var tickerParts=ticker.split(".");var countryCode=tickerParts[1];var tickerSymbol=tickerParts[0];urlChips=urlChips+countryCode+"-"+tickerSymbol+"-"+articleId;}
else{urlChips=urlChips+ticker+"-"+articleId+"-"+renderchart;}}}
else{if(typeof articleId!=='undefined'&&articleId!==''){urlChips=urlChips+articleId+"-"+renderchart;}
else{urlChips=urlChips+renderchart;}}
if(urlChips!=''){var coUrl='';var urlPrefix='';if(tickerSlashIndex==-1&&tickerDotIndex==-1){urlPrefix=this.defaultArgs.moduleBasePrefix;}
else{if(renderchart===true){urlPrefix=this.defaultArgs.moduleChartPrefix;}
else{urlPrefix=this.defaultArgs.moduleNoChartPrefix;}}
coUrl=URL+urlPrefix+urlChips+".html";dj.lang.xhrGet({url:coUrl,preventCache:true,handleAs:"text",load:function(response){module.innerHTML=response;console.log(" load response");if(renderchart===true&&tickerchartinstance!==null){try{tickerchartinstance.populateCharts(chartcontainer,widthChart,heightChart);}catch(error){console.log("{"+URL+"} Error in Populate Charts");}}},error:function(response){console.log("{"+URL+"} error response");module.innerHTML="";}});}},renderNews:function(module,ticker,URL,articleId){var urlChips='';if(typeof ticker!=='undefined'&&ticker!==''){urlChips=urlChips+ticker;}
else if(typeof ticker=='undefined'||ticker===''){urlChips=articleId+"-"+"renderNews";}
if(urlChips!=''){var urlPrefix=this.defaultArgs.moduleNoChartPrefix;coUrl=URL+urlPrefix+urlChips+".html";dj.lang.xhrGet({url:coUrl,preventCache:true,handleAs:"text",load:function(response){module.innerHTML=response;console.log("{"+URL+"} load response");},error:function(response){console.log("{"+URL+"} error response");module.innerHTML="";}});}},getArticleTickersFor:function(docId){var me=this;dojo.xhrGet({url:me.defaultArgs.moduleArticleTickersURL+docId+".html",sync:true,handleAs:'text',load:function(response,xhr){me.setArticleTickers(response);},headers:{'Content-Type':'text/html; charset=UTF-8'},error:function(error,ioArgs){me.setArticleTickers('[]');console.log(error);console.log(ioArgs);}});},setArticleTickers:function(tickersResponse){var commentIndex=tickersResponse.indexOf('<!-- fast');if(commentIndex>-1){this.articleTickers=dojo.fromJson(tickersResponse.substr(0,commentIndex));}
else{this.articleTickers=dojo.fromJson(tickersResponse);}},getTicker:function(referralArgs,tickerId)
{var queryObject=dj.util.referralFinance.getReferrar(referralArgs);try{if(typeof queryObject!='undefined'&&queryObject.engine!==''&&queryObject.ticker!=='')
{dojo.create("div",{"id":tickerId,"data-ticker":queryObject.ticker,"data-engine":queryObject.engine},dojo.query(".articlePage>p")[0],"after");}
else{this.getArticleTickersFor(this.defaultArgs.articleId)
if(this.articleTickers.length>=1){dojo.create("div",{"id":tickerId,"data-ticker":this.articleTickers[0].t,"data-engine":"DUMMY"},dojo.query(".articlePage>p")[0],"after");}
else{dojo.create("div",{"id":tickerId,"data-engine":"DUMMY"},dojo.query(".articlePage>p")[0],"after");}}
void(0);}
catch(e)
{console.log("{get ticker}error");}}};
dojo.provide("dj.module.mst.preview.decorator");dojo.require("dijit.Menu");dojo.require("dijit.MenuItem");dojo.require("dijit.form.DropDownButton");dojo.require("dijit.form.ToggleButton");dj.module.mst.preview.decorator={override:false,showMasks:true,init:function(){var hn=document.location.hostname;var domain=hn.substring(hn.substring(0,hn.lastIndexOf(".")).lastIndexOf(".")+1,hn.length);if(domain==="dowjones.net"){this.injectCSS("http://ajax.googleapis.com/ajax/libs/dojo/1.6/dijit/themes/tundra/tundra.css");dojo.addClass(dojo.body()," tundra ");if(window.parent!==window.self||this.override){var self=this;dojo.query("div[data-module-id]").forEach(function(node,index,arr){if(dojo.query("div[data-module-id]",node).length===0){dojo.connect(node,"onmouseenter",function(ev){self.placeMask(node);});}});dojo.query(".filteredNode").forEach(function(node,index,arr){dojo.style(node,"border","2px dashed black");dojo.style(node,"height","30px");dojo.style(node,"margin","5px 0px 5px 0px");dojo.style(node,"backgroundColor","#DCDCDC");dojo.style(node,"display","none");node.innerHTML="Name: "+node.getAttribute("data-module-name")+", Rank: "+node.getAttribute("data-module-rank")||"???";});var microPageToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:false,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:5px;",onChange:dojo.hitch(this,function(val){this.toggleMicroPageIncludes();}),label:"Show MicroPageIncludes"});var moduleToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:false,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:200px;",onChange:dojo.hitch(this,function(val){this.toggleFilteredNodes();}),label:"Show Hidden Modules"});var maskToggleButton=new dijit.form.ToggleButton({showLabel:true,checked:true,iconClass:"dijitCheckBoxIcon",style:"position:absolute;z-index:2000000;top:5px;left:380px;",onChange:dojo.hitch(this,function(val){this.toggleMask();}),label:"Show Module Highlight"});document.body.appendChild(microPageToggleButton.domNode);document.body.appendChild(moduleToggleButton.domNode);document.body.appendChild(maskToggleButton.domNode);}else{var button=new dijit.form.Button({label:"Edit in MST",id:"mstButton",style:"position:absolute;z-index:2000000;top:5px;left:5px;",onClick:function(){document.location.href="/CDSTools/MST/#!"+pID;}});document.body.appendChild(button.domNode);}}},toggleMicroPageIncludes:function(){dojo.query("div[data-module-name=MicroPageInclude]").forEach(function(node,index,arr){dojo.style(node,"border",dojo.style(node,"border")==="2px solid blue"?"0px":"2px solid blue");dojo.style(node,"padding",dojo.style(node,"padding")===2?"0px":"2px");});},toggleFilteredNodes:function(){dojo.query(".filteredNode").forEach(function(node,index,arr){dojo.style(node,"display",dojo.style(node,"display")==="none"?"":"none");});},injectCSS:function(url){var e=document.createElement("link");e.href=url;e.type="text/css";e.rel="stylesheet";e.media="screen";document.getElementsByTagName("head")[0].appendChild(e);},createDrop:function(){this.ele=dojo.create("div",{id:"mask",style:"background-image:url('/static_html_files/mstTool/mask.png');z-index:1000050;position:absolute;"},dojo.body(),"first");var menu=new dijit.Menu({id:"previewMenu",style:"display: none;z-index:1000100"});dojo.connect(menu,"onOpen",menu,function(){this._popupWrapper.style.zIndex="1000100";dojo.style("previewMenu","z-index","1000100");});var menuItem1=new dijit.MenuItem({label:"Edit",id:"previewMaskEdit",maskedElementId:"M565903",onClick:function(){window.parent.dj.util.mst.toolApi.jumpToNode(this.maskedElementId);}});menu.addChild(menuItem1);var menuItem2=new dijit.MenuItem({label:"Copy",onClick:function(){}});var menuItem3=new dijit.MenuItem({label:"Hide/Disable",onClick:function(){}});var button=new dijit.form.DropDownButton({label:"Options",dropDown:menu,id:"optionsButton"});this.ele.appendChild(button.domNode);dojo.create("p",{id:"maskText",style:"color:white;float:right;font-size:1.5em"},this.ele,"last");},placeMask:function(node){if(!this.showMasks){return true;}
var button=dijit.byId("optionsButton");if(!node&&this.ele){if(button){button.closeDropDown();}
dojo.style(this.ele,"display","none");return;}
var targetPos=dojo.position(node,true);if(!this.ele){this.createDrop();dojo.connect(this.ele,"onmouseleave",dojo.hitch(this,function(ev){if(ev.relatedTarget&&(ev.relatedTarget.id.indexOf("Menu")>-1||ev.relatedTarget.id.indexOf("previewMaskEdit")>-1)){return;}else{this.placeMask();}}));}
if(!dojo.hasClass(node,"filteredNode")){dojo.byId("maskText").innerHTML="Name: "+node.getAttribute("data-module-name")+", Rank: "+node.getAttribute("data-module-rank")||"???";}else{dojo.byId("maskText").innerHTML="";}
if(button){button.closeDropDown();}
dijit.byId("previewMaskEdit").maskedElementId="M"+dojo.attr(node,"data-module-id");dojo.style(this.ele,"display","");dojo.style(this.ele,"top",targetPos.y+"px");dojo.style(this.ele,"left",targetPos.x+"px");dojo.style(this.ele,"width",targetPos.w+"px");dojo.style(this.ele,"height",targetPos.h+"px");},toggleMask:function(){this.showMasks=this.showMasks?false:true;}};dojo.provide("dj.widget.geotargeting.moduleShow");
dojo.require("dj.util.Cookie");

dojo.declare("dj.widget.geotargeting.moduleShow", [], {
  constructor: function (conf) {
    // Default cfx
    this.cfx = {
    //   at : Austria, de: Germany, ch: Switzerland
      countries : ["at", "de", "ch"],
      country : "",
      moduleIds : ["gmHeadlines", "gmSingleHeadline"]
    };

    this.findCountry();
    this.moduleVisibleMaker();    
  },

  findCountry : function() {
    this.cfx.country = dj.util.Cookie.getGroupCookie('DJSESSION','country');
  },

  isInTargetCountries : function() {
    var countries = this.cfx.countries;
    for (var i=0; i<countries.length; i++)
    {
      if(countries[i] == this.cfx.country) {
        return true;
      }
    }
    return false;
  },

  moduleVisibleMaker : function() {
   
    var moduleIds = this.cfx.moduleIds;
    if (this.isInTargetCountries()){
      for (var i=0; i<moduleIds.length; i++)
      {
        if(dojo.query(moduleIds[i])) {
          classname = '.' + moduleIds[i];
          dojo.query(classname).forEach(function(node, index, arr){
            dojo.style(node, "display", "");
            dojo.style(node, "cursor", "pointer");
            dojo.connect(node, "onclick", function() {
              window.location.href = "http://www.wallstreetjournal.de";
             });
          });
        }
      }
    }
  }
  
});
dojo.provide("dj.module.geotargeting.germanyScrim");
dojo.require("dj.lang");
dojo.require("dj.util.Cookie");

dj.module.geotargeting.germanyScrim = {

  init : function(conf) {

    this.cfx = {
      countries : [ "at", "de", "ch" ],
      country : "",
      firstVisitTime : 0,
      lastVisitTime : 0,
      isVisitedOnce : "false",
      isClickedWSJDE : "false",
      isFirstTimeVisit : "false"
    };
    dj.lang.mixin(this.cfx, conf);
    this.findCountry();
    this.isInTargetCountries();
    if (dj.util.Cookie.getGroupCookie('DJSESSION', 'isClickedWSJDE')) {
      this.cfx.isClickedWSJDE = "true";
    }
    if ((this.isInTargetCountries() == "true") && (this.cfx.isClickedWSJDE == "false")) {
      if (!dj.util.Cookie.getGroupCookie('DJSESSION', 'isVisitedOnce')) { 
        this.setCookieDataForFirstVisit();
      }
      this.getCookieData();
      this.onLoadHomePage();
      this.onWSJDEClick();
      this.onNoThanksClick();
      this.onCloseButtonClick();
    }
  },

  findCountry : function() {
    this.cfx.country = dj.util.Cookie.getGroupCookie('DJSESSION', 'country');
  },

  isInTargetCountries : function() {
    var countries = this.cfx.countries;
    for ( var i = 0; i < countries.length; i++) {
      if (countries[i] == this.cfx.country) {
        return "true";
      }
    }
    return "false";
  },

  setCookieDataForFirstVisit : function() {
    currentVisit = new Date();
    visitTime = currentVisit.getTime();
    dj.util.Cookie.setGroupCookie('DJSESSION', 'isVisitedOnce', "true", 730);
    dj.util.Cookie.setGroupCookie('DJSESSION', 'firstVisitTime', visitTime, 28);
    dj.util.Cookie.setGroupCookie('DJSESSION', 'lastVisitTime', visitTime, 28);
    this.cfx.isFirstTimeVisit = "true";
  },

  getCookieData : function() {
    this.cfx.isVisitedOnce = dj.util.Cookie.getGroupCookie('DJSESSION',
        'isVisitedOnce');
    this.cfx.firstVisitTime = dj.util.Cookie.getGroupCookie('DJSESSION',
        'firstVisitTime');
    this.cfx.lastVisitTime = dj.util.Cookie.getGroupCookie('DJSESSION',
        'lastVisitTime');
  },

  onLoadHomePage : function() {
    if (this.cfx.isFirstTimeVisit == "true") {
      this.showScrim();
      this.cfx.isFirstTimeVisit = "false";
    } else {
      this.onRepeatedVisit();
    }
  },

  showScrim : function() {
    dojo.query(".scrimWSJ_overlay").forEach(function(node, index, arr) {
      dojo.style(node, "display", "");
    });
  },

  onRepeatedVisit : function() {
    dayMiliSecs = 24 * 60 * 60 * 1000;
    weekMiliSecs = 7 * dayMiliSecs;
    marketingPeriodMiliSecs = 4 * weekMiliSecs;

    newVisit = new Date();
    newVisitTime = newVisit.getTime();
    sinceFirstVisitTime = newVisitTime - this.cfx.firstVisitTime;
    sinceLastVisitTime = newVisitTime - this.cfx.lastVisitTime;

    if (sinceLastVisitTime > weekMiliSecs
        && sinceFirstVisitTime < marketingPeriodMiliSecs) {
      this.showScrim();
    }
    dj.util.Cookie.setGroupCookie('DJSESSION', 'lastVisitTime', newVisitTime);
  },

  onWSJDEClick : function() {
    dojo.query(".gmDeviceScrimBtn").forEach(function(node, index, arr) {
      dojo.connect(node, "onclick", function(evt) {
        window.location.href = "http://www.wallstreetjournal.de";
        this.cfx.isClickedWSJDE = dj.util.Cookie.setGroupCookie('DJSESSION',
            'isClickedWSJDE', "true", 730);
      });
    });
  },

  onNoThanksClick : function() {
    var that = this;
    dojo.query(".gmDeviceScrimReadMore").forEach(function(node, index, arr) {
      dojo.connect(node, "onclick", function(evt) {
        that.hideScrim();
      });
    });
  },
  
  onCloseButtonClick : function() {
	    var that = this;
	    dojo.query(".gmDeviceScrimCloseBtn").forEach(function(node, index, arr) {
	      dojo.connect(node, "onclick", function(evt) {
	        that.hideScrim();
	      });
	    });
	},

  hideScrim : function() {
    dojo.query(".scrimWSJ_overlay").forEach(function(node, index, arr) {
      dojo.style(node, "display", "none");
    });
  }

};
dojo.provide("dj.module.geotargeting.moduleShow");
dojo.require("dj.widget.geotargeting.moduleShow");

dj.module.geotargeting.moduleShow = {
  init: function() {
    this.moduleShow = new dj.widget.geotargeting.moduleShow();     
  }
};
dojo.provide("dj.util.vlttools.Article");

dj.util.vlttools.Article = {

  getParentByNodeName: function(O,N){
    if(O.nodeName.toLowerCase()==N||O.parentNode===null){return O;}
    return dj.util.Article.getParentByNodeName(O.parentNode,N);
  },
  
  isFloat: function (N){
    return (/\d+\.\d+/).test(N);
  },  
  
  CopyrightPopUp: function(){
	  var art = AT_VARS;
	  var reprintUrl = "https://s100.copyright.com/Clients/wsj_com/FairUse.jsp?";

	  var params = [];
	  params.push("PublisherName=" + escape(art.publicationName));
	  params.push("ContentID=" + escape(art.baseDocId + art.baseDocExtension));
	  params.push("orderReset=true");
	  params.push("Title=" + escape(art.articleHeadline));
	  params.push("Author=" + escape(art.authors));
	  params.push("CreditLine=" + escape(art.byLine || ""));
	  params.push("PublicationDate=" + escape(art.publicationDate));
	  params.push("ArticleType=" + escape(art.articleType));
	  params.push("DJType=" + escape(art.djType));
	  params.push("orderSource=wsj.com");

	  dj.util.Url.openWin((reprintUrl + params.join("&")), "reprints", 515, 440, "scroll,resizable", true);
	}

};
dojo.provide("dj.widget.vlttools.NetworkTools");

dojo.require("hogan");
dojo.require("dj.lang");
dojo.require("dj.util.Element");
dojo.declare("dj.widget.vlttools.NetworkTools", null, {
  
  expanded : false,
  
  constructor : function (options) {
    dojo.safeMixin(this, options);
    this.container = dojo.query(this.valetToolsLeftContainer)[0];
    
    this.placeholders = dojo.byId("placeholderContainer");
    this.actuals = dojo.byId("thirdPartyContainer"); 
    this.topOverlayDivs = dojo.query(this.valetToolsTopContainer+" div.vlt_overlay");  
    this.bottomOverlayDivs = dojo.query(this.valetToolsBottomContainer+" div.vlt_overlay");
    this.topSocialLiElements = dojo.query(this.valetToolsTopContainer+" ul.vltSocialLinks li");  
    this.bottomSocialLiElements = dojo.query(this.valetToolsBottomContainer+" ul.vltSocialLinks li");
    this.allSocialLiElements = this.topSocialLiElements.concat(this.bottomSocialLiElements);    
       
    this.templateData = {
      url: this.getOgTag("url"),
      image: this.getOgTag("image"),
      description: this.getOgTag("description"),
      shortUrl: this.getShortUrl()
    };     

    this.loadSocialScripts(this.socialNetworksJS);
    this.loadLeftSocialHtml(this.leftSocialTemplates);
    this.loadSocialTopBottomHtml(this.topSocialTemplates,this.topOverlayDivs);
    this.loadSocialTopBottomHtml(this.bottomSocialTemplates,this.bottomOverlayDivs);

   if (this.isIpad() || this.isKindleFire()) {
      this.addTouchEvents();
    } else {
      this.addEvents();      
    } 
},

getShortUrl: function() {    
  var shortUrlNode = dojo.query(this.twitterShortUrlNode)[0];
  var twittershorUrl;
  if (shortUrlNode) {
    twittershorUrl = dojo.attr(shortUrlNode,"data-shortURL");
  } else {
    twittershorUrl = this.getOgTag("url");
  }  
  return twittershorUrl;
},

addTouchEvents: function(){
  var that = this; 
  
  dj.lang.addLiveEvent(this.valetToolsLeftContainer, "click", function(ev) {
      if(that.expanded){
        that.shrinkAndSwap(false);
        }else{
         that.expandAndSwap();
       }
    });  
  
    dj.lang.addLiveEvent(".vltanchor", "click", function (event) {
      dojo.stopEvent(event);
      var node = (event.target || event.srcElement);
      var containerParentLI = node.parentNode;
      dojo.attr(containerParentLI,"data-current-node","true");
      
      dojo.forEach(that.allSocialLiElements, function(entry, i){
        var isCurrentNode = dojo.attr(entry,"data-current-node");
        if (isCurrentNode == "true"){
            if (dojo.hasClass(entry,"overlay_open")){
              dojo.removeClass(entry,"overlay_open");  
              dojo.attr(entry,"data-current-node","false");
            } else {
              dojo.addClass(entry,"overlay_open");  
            } 
        } else if (isCurrentNode == "false" || isCurrentNode === null ) {
          dojo.attr(entry,"data-current-node","false");
          dojo.removeClass(entry,"overlay_open");  
        }
      });           
    });     
    
    dojo.connect(document, "onclick", function (event) {
       dojo.stopEvent(event);
        dojo.forEach(that.allSocialLiElements, function(entry, i){
                if (dojo.hasClass(entry,"overlay_open")){
                  dojo.removeClass(entry,"overlay_open");
                  dojo.attr(entry,"data-current-node","false");
                }
          });  
    });
  },

  expandAndSwap: function(){    
    dojo.style(this.placeholders,"display", "none");
    dojo.style(this.actuals,"display", "");
    dojo.removeClass(this.container,"compact");
    dojo.addClass(this.container,"medium");   
    this.expanded = true;
  },

  shrinkAndSwap: function(ignoreMouseOut){    
    if(!ignoreMouseOut){
      dojo.style(this.placeholders,"display", "");
      dojo.style(this.actuals,"display", "none");
      dojo.addClass(this.container,"compact");
      dojo.removeClass(this.container,"medium");
      this.expanded = false;
   }
  },
  
addEvents: function(){
  var that = this;  
  
    dj.lang.addLiveEvent(".vltSocialLinks", "mouseout", function (event) {
        dojo.stopEvent(event);        
        var node = (event.target || event.srcElement);    
        var parentEle = node.parentNode;
        if (parentEle.className=="vltTools horizontal") {
          var socialLinksUL = dojo.query(".vltSocialLinks")[0];     
                dojo.forEach(that.allSocialLiElements, function(entry, i){
                      dojo.removeClass(entry,"overlay_open");                   
             });        
          }    
    });
  
  dj.lang.addLiveEvent(".vltanchor", "mouseover", function (event) {
    dojo.stopEvent(event);
    var node = (event.target || event.srcElement);
    var containerParentLI = node.parentNode;
    dj.module.currContainer = containerParentLI;
    //onfirst mouseover assign values
    if (!dj.module.prevContainer) {    
      //open overlay for currContainer
      dojo.addClass(dj.module.currContainer,"overlay_open");      
      dj.module.prevContainer = dj.module.currContainer;
      }
    else{
      dojo.removeClass(dj.module.prevContainer,"overlay_open");    
      dojo.addClass(dj.module.currContainer,"overlay_open");      
      dj.module.prevContainer = dj.module.currContainer;
    }            
  });         

    dj.lang.addLiveEvent(".vlt_overlay", "mouseout", function (event) {
      dojo.stopEvent(event);
      var node = (event.target || event.srcElement);    
      var containerParentLI = node.parentNode;
      var anchorElement = node.previousSibling;
      var facebookBubble = dojo.query("span.fb_edge_comment_widget")[0];
      var googleBubble = dojo.query(".gc-bubbleDefault")[0];   
      if (facebookBubble) {
        return;
      } else if (googleBubble) {
        return;
      }
      if (anchorElement) {
          var isPointerinModalContainer = dj.util.Element.contains(anchorElement, event.clientX, event.clientY);      
          if (isPointerinModalContainer === false) {
            dojo.removeClass(containerParentLI,"overlay_open");
          }    	  
      }
    });
  
  dj.lang.addLiveEvent(this.valetToolsLeftContainer, "click", function(ev) {
    if(that.expanded){
      that.shrinkAndSwap(false);
      }else{
       that.expandAndSwap();
     }
  });
  
  dj.lang.addLiveEvent(this.valetToolsLeftContainer, "mouseover", function(ev){
    dojo.stopEvent(ev);
    dj.module.valetIgnoreMouseOut = true;
    setTimeout(function (){
      that.expandAndSwap();
    },300);
    
 });  

  dj.lang.addLiveEvent(this.valetToolsLeftContainer, "mouseout", function(ev){
    dojo.stopEvent(ev);
    dj.module.valetIgnoreMouseOut = false;    
      if (that._timeout !== null) {
          clearTimeout(that._timeout);
        }
      var facebookBubble = dojo.query("span.fb_edge_comment_widget")[0];
      var googleBubble = dojo.query(".gc-bubbleDefault")[0];    
      var leftSaveToNode = dojo.query(that.leftSaveToContainer)[0];
      if (leftSaveToNode) { var isSaveToOpen = dojo.hasClass(leftSaveToNode,'ddState-expanded'); }
      if (facebookBubble) {
        return;
      } else if (googleBubble) {
        var bubbleVisibility = dojo.style(googleBubble,"visibility");
        if (bubbleVisibility=="visible") {
          return;
          }
        else{
          that._timeout = setTimeout(function (){
            that.shrinkAndSwap(dj.module.valetIgnoreMouseOut);
          },500);
        }
      } else if (isSaveToOpen) {
        return;
      } else {
        that._timeout = setTimeout(function (){
          that.shrinkAndSwap(dj.module.valetIgnoreMouseOut);
        },300);
      }
    });  
    
    if (this.SaveToAnchors) {
      dj.lang.addLiveEvent(this.SaveToAnchors, "mouseover", function (event) {
            dojo.stopEvent(event);
            var node = (event.target || event.srcElement);
             var SaveToContainer = dojo.query(node).closest(".dropdownTree");
              if (SaveToContainer[0]){
              dojo.addClass(SaveToContainer[0],'ddState-hover');
            }
          });      
      }
      
      if (this.SaveToAnchors) {
      dj.lang.addLiveEvent(this.SaveToAnchors, "mouseout", function (event) {
            dojo.stopEvent(event);
            var node = (event.target || event.srcElement);
             var SaveToContainer = dojo.query(node).closest(".dropdownTree");
              if (SaveToContainer[0]){
              dojo.removeClass(SaveToContainer[0],'ddState-hover');
            }
          });   
      }
  },  
 
  isIpad: function() {
      return (navigator.userAgent.match(/iPad/i) !== null);
  },

  isKindleFire: function() {
   return (navigator.userAgent.match(/Kindle Fire/i) !== null);
  },
  
  loadLeftSocialHtml: function(config){
    var html, newLi, i; 
    for(i = 0; i < config.length; i++){    
      var tpl = hogan.compile(config[i].template);
      html = tpl.render(this.templateData);      
      if (html.indexOf("<script")!== -1 && html.indexOf("</script>")!== -1 && html.indexOf("IN/Share")!== -1) {
        var script2 = document.createElement("script");
          script2.type = "IN/Share";
          script2.setAttribute("data-url",this.templateData.url);
          script2.setAttribute("data-counter","right");
        newLi = dojo.create('li');
        newLi.appendChild(script2);
        }
      else {          
        if (config[i].templateid) {
         newLi = dojo.create('li', {innerHTML:html,id:config[i].templateid});
        } else {
          newLi = dojo.create('li', {innerHTML:html});
        }
      }
      dojo.place(newLi,this.actuals,"last");
    }
  },

  loadSocialTopBottomHtml: function(config,overlays){
    var html, newLi, i;
    for(i = 0; i < config.length; i++) {
      var tpl = hogan.compile(config[i].template);
      html = tpl.render(this.templateData);      
      if (html.indexOf("<script")!== -1 && html.indexOf("</script>")!== -1 && html.indexOf("IN/Share")!== -1) {
        var script2 = document.createElement("script");
          script2.type = "IN/Share";
          script2.setAttribute("data-url",this.templateData.url);
          script2.setAttribute("data-counter","right");          
        overlays[i].appendChild(script2);
        }
      else {
          overlays[i].innerHTML = html;
      }
    }  
  }, 

  loadSocialScripts: function(config){
    var url, id, js, fjs, i;
    for(i = 0; i < config.length; i++){
      var tags =  dojo.query("script[src=http:"+config[i].jsurl+"]");
      if(tags.length === 0){ //load only if the script is not pre-loaded
        url = config[i].jsurl;
        id = config[i].jsid;
        fjs = dojo.query('script')[0];
        js = dojo.create('script'); 
        js.id = id;
        js.async = true; 
        js.src = url;
        dojo.place(js, fjs,"before");
      }
    }
  },

  getOgTag: function(property){
    var tags = dojo.query("meta[property=og:"+property+"]");
    if(tags.length > 0){
      var content = tags[0].content;   
      if (content.indexOf("s.dev.") !== -1){
        return content.replace(/s.dev./,"");  
      }
      else if (content.indexOf("f.dev.") !== -1){
        return content.replace(/f.dev./,"");
      }
      else {
       return content;
      }      
    }
  }
});
dojo.provide("dj.widget.vlttools.Button");

dojo.require("dj.util.vlttools.Article");

dojo.declare( "dj.widget.vlttools.Button", null, {
  constructor: function(I,H,L) {
    this.id=I;
    this.clickHandler=H;
    if(H){
      this.clickHandler=dojo.hitch(this, this.clickHandler);
    }
    this.isLink=L;
    return this;
  },

  init:function(){
    if(this.isLink){
      this.clickHandler();
    }
    else{
      var oId = dojo.byId(this.id);
      if (oId && this.clickHandler) {
        dojo.connect( oId, "onclick", this, this.clickHandler );
      }
    }
    dojo.connect( document, "onclick", this, function(e){
      this.handleDocClick(e);
    });
    return this;
  },
  handleDocClick:function(e){
    var x=dj.util.vlttools.Article.getParentByNodeName(e.target,'a');
    if(x.id===this.id&&!this.isLink){
      dojo.stopEvent(e);
    }
  }
});
dojo.provide("dj.widget.vlttools.ArticleTools");

dojo.require("dj.widget.vlttools.Button");
dojo.require("dj.widget.article.tools.TextBuddy");
dojo.require("dj.util.vlttools.Article");
dojo.require("clickability.w-button");
dojo.declare("dj.widget.vlttools.ArticleTools", null, {

  constructor: function(options) {
	 dojo.safeMixin(this, options);
	 
	 var that = this;
	 
     var leftemailButton = new dj.widget.vlttools.Button('atl.at.emailthis', function(){
          var mod="wsj_valetleft_email";
          ET(mod);
          }, false);
     leftemailButton.init();
      
      var leftprintButton = new dj.widget.vlttools.Button('atl.at.print', function(){
            var l=''.concat(document.location),x=l.indexOf('#');
            if(x!==-1){l=l.substring(0,x);}
            dj.util.Url.openWin(l+that.printMode,"printFriendly",800,600,'',true);
          }, false);
      leftprintButton.init();
      
      var leftreprintButton = new dj.widget.vlttools.Button('atl.at.reprint',function(){
    	  dj.util.vlttools.Article.CopyrightPopUp();
	        },false);
      leftreprintButton.init();
      
      var bottomreprintButton = new dj.widget.vlttools.Button('atb.at.reprint',function(){
        dj.util.vlttools.Article.CopyrightPopUp();
          },false);
      bottomreprintButton.init();
      
      var topemailButton = new dj.widget.vlttools.Button('att.at.emailthis', function(){
        var mod="wsj_valettop_email";
        ET(mod);
        }, false);
      topemailButton.init();
      
      var topprintButton = new dj.widget.vlttools.Button('att.at.print', function(){
            var l=''.concat(document.location),x=l.indexOf('#');
            if(x!==-1){l=l.substring(0,x);}
            dj.util.Url.openWin(l+that.printMode,"printFriendly",800,600,'',true);
          }, false);
      topprintButton.init();   
      
      var bottomemailButton = new dj.widget.vlttools.Button('atb.at.emailthis', function(){
        var mod="wsj_valetbottom_email";
        ET(mod);
        }, false);
      bottomemailButton.init();
      
      var bottomprintButton = new dj.widget.vlttools.Button('atb.at.print', function(){
            var l=''.concat(document.location),x=l.indexOf('#');
            if(x!==-1){l=l.substring(0,x);}
            dj.util.Url.openWin(l+that.printMode,"printFriendly",800,600,'',true);
          }, false);
      bottomprintButton.init();   
      
      var topTextBuddy = new dj.widget.article.tools.TextBuddy('att.at.tbl','att.at.tbs','att.at.tbm');
      topTextBuddy.init(true);
      
      var bodyTextBuddy = new dj.widget.article.tools.TextBuddy('atbody.at.tbl','atbody.at.tbs','atbody.at.tbm');
      bodyTextBuddy.init(true);      
  }

});
dojo.provide("dj.module.vlttools.animations");

dojo.require("dj.widget.vlttools.NetworkTools");
dojo.require("dj.widget.vlttools.ArticleTools");

dj.module.vlttools.animations = {
  init: function(conf){
    this.configuration = {
        viewportState:"WIDE",
        valetToolsLeftContainer : "#valetTools-left",
        valetToolsTopContainer : "#valetTools-top",
        valetToolsBottomContainer : "#valetTools-bottom",
        leftSaveToContainer: "",
        SaveToAnchors:"",
        articleResizeContainer:"",
        headlineNode : ".articleHeadlineBox h1",
        pageFooterContainer: "#footerWrapper",
        topToolsPlacementContainer: "#article_story",
        bottomToolsPlacementContainer: "#morein",
        printMode: "#printMode",
        twitterShortUrlNode: "#valetToolsTwitterShortURL",
        socialNetworksJS : [
          {'name' : 'facebook', 'jsurl' : '//connect.facebook.net/en_US/all.js', 'jsid' : 'facebook-jssdk'},
          {'name' : 'twitter', 'jsurl' : '//platform.twitter.com/widgets.js', 'jsid' : 'twitter-wsj'},
          {'name' : 'gplus', 'jsurl' : 'https://apis.google.com/js/plusone.js', 'jsid' : 'google-jssdk'},
          {'name' : 'linkedin', 'jsurl' : '//platform.linkedin.com/in.js', 'jsid' : 'linkedin-jssdk'}
          ],
        leftSocialTemplates : [
          {'template' : '<div class="fb-like" data-href="{{url}}" data-send="false" data-layout="button_count" data-show-faces="false" data-action="recommend"></div>'},
          {'template' : '<a href="https://twitter.com/share"  data-counturl="{{url}}" data-url="{{shortUrl}}" class="twitter-share-button" data-via="WSJ" data-lang="en">Tweet</a>'},
          {'template' : '<div class="g-plusone" data-href="{{url}}" data-size="medium"></div>'},
          {'template' : '<script type="IN/Share" data-url="{{url}}" data-counter="right"></script>'}
          ],          
       topSocialTemplates : [
         {'template' : '<div class="fb-like" data-href="{{url}}" data-send="false" data-layout="button_count" data-show-faces="false" data-action="recommend"></div>'},
         {'template' : '<a href="https://twitter.com/share" data-counturl="{{url}}" data-url="{{shortUrl}}" class="twitter-share-button" data-via="WSJ" data-lang="en">Tweet</a>'},
         {'template' : '<div class="g-plusone" data-href="{{url}}" data-size="medium"></div>'},   
         {'template' : '<script type="IN/Share" data-url="{{url}}" data-counter="right"></script>'}
         ],
        bottomSocialTemplates :  [
          {'template' : '<div class="fb-like" data-href="{{url}}" data-send="false" data-layout="button_count" data-show-faces="false" data-action="recommend"></div>'},
          {'template' : '<a href="https://twitter.com/share" data-counturl="{{url}}" data-url="{{shortUrl}}" class="twitter-share-button" data-via="WSJ" data-lang="en">Tweet</a>'},
          {'template' : '<div class="g-plusone" data-href="{{url}}" data-size="medium"></div>'},       
          {'template' : '<script type="IN/Share" data-url="{{url}}" data-counter="right"></script>'}
          ]     
      };

    if (conf) { dojo.safeMixin(this.configuration, conf); }
    
    var stt = dojo.query(this.configuration.valetToolsTopContainer)[0];
    var stl = dojo.query(this.configuration.valetToolsLeftContainer)[0];
    var stb = dojo.query(this.configuration.valetToolsBottomContainer)[0];
    
     if (this.configuration.articleResizeContainer!== "") {var articleBodyTools = dojo.query(this.configuration.articleResizeContainer)[0]; }
    
    var headline = dojo.query(this.configuration.headlineNode)[0];
    var top = dojo.position(headline).y;
    var footerDiv = dojo.query(this.configuration.pageFooterContainer)[0];
    this.placeVerticalNode(stl, footerDiv, "first");
    dojo.style(stl,"top",top+"px");   
    
    var topToolsDiv = dojo.query(this.configuration.topToolsPlacementContainer)[0];
    this.placeHorizontalNode(stt, topToolsDiv, "first");

    var bottomToolsDiv = dojo.query(this.configuration.bottomToolsPlacementContainer)[0];
    this.placeHorizontalNode(stb, bottomToolsDiv, "after");
    
    //Place and Animate depending on resolution
    if(stl !== null && dojo.window.getBox().w > 1038){
      this.viewportState = "WIDE";
      if (articleBodyTools) {dojo.style(articleBodyTools,"display","block");}     
     }
    if(stt !== null && dojo.window.getBox().w <= 1038){
      this.viewportState = "NARROW";
      if (articleBodyTools) {dojo.style(articleBodyTools,"display","none"); } 
      this.customCrossFadeOut(stl);
      this.customCrossFadeIn(stt);   
    }
    if(stb !== null && dojo.window.getBox().w <= 1038){      
      this.viewportState = "NARROW";
      if (articleBodyTools) {dojo.style(articleBodyTools,"display","none"); }         
      this.customCrossFadeOut(stl);      
      this.customCrossFadeIn(stb); 
    }
    
    dojo.connect(window,"scroll",this,function(){         	
    	var bodyPosition = dojo.window.getBox().t;
    	var topHeadlinePos =  dojo.position(headline).y;   	
    	var yLimit =  bodyPosition - (topHeadlinePos);
    	if (yLimit > 312) {
    	  dojo.style(stl,"position","fixed");   
        dojo.style(stl,"top","20px");   
    	} else {
        dojo.style(stl,"position","fixed");   
        dojo.style(stl,"top",topHeadlinePos+"px");   
		}
    }); 
    
    //then connect resize event so the widgets can respond
    dojo.connect(window,"resize",this,function(){
      if (dojo.window.getBox().w > 1038 && this.viewportState === "NARROW") {
        this.viewportState = "WIDE";
        if (articleBodyTools) {dojo.style(articleBodyTools,"display","block");}                   
        this.customCrossFadeIn(stl);        
        this.customCrossFadeOut(stt);
        this.customCrossFadeOut(stb);
      }else if(dojo.window.getBox().w <= 1038 && this.viewportState === "WIDE"){
        this.viewportState = "NARROW";
        if (articleBodyTools) {dojo.style(articleBodyTools,"display","none"); }           
        this.customCrossFadeOut(stl);
        this.customCrossFadeIn(stt);
        this.customCrossFadeIn(stb);
      }
    });
    
    dj.widget.valetNetworkTools = new dj.widget.vlttools.NetworkTools(this.configuration);
    dj.widget.valetArticleTools = new dj.widget.vlttools.ArticleTools(this.configuration);
  },

  placeHorizontalNode: function(node, containerId, position) {    
    dojo.style(node, "display", "none");
    dojo.place(node, containerId, position);
  },

  placeVerticalNode: function(node, containerId, position) {
    dojo.place(node, containerId, position);
  },

  customCrossFadeIn: function(node){
   dojo.style(node, "display", "block");
  },

  customCrossFadeOut: function(node){
    dojo.style(node, "display", "none");
  }
};

